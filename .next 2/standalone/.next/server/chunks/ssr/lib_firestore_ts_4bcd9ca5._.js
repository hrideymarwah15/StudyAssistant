module.exports=[19337,a=>{"use strict";a.i(69387);var b=a.i(60574);a.i(60121);var c=a.i(18740);async function d(a){return(await (0,b.getDocs)((0,b.collection)(c.db,"materialFolders"))).docs.map(a=>{let b=a.data();return{id:a.id,...b,createdAt:b.createdAt?.toDate()||new Date}}).filter(b=>b.userId===a).sort((a,b)=>a.name.localeCompare(b.name))}async function e(a){return(await (0,b.addDoc)((0,b.collection)(c.db,"materialFolders"),{...a,createdAt:(0,b.serverTimestamp)()})).id}async function f(a){for(let d of(await (0,b.deleteDoc)((0,b.doc)(c.db,"materialFolders",a)),(await (0,b.getDocs)((0,b.collection)(c.db,"materials"))).docs.filter(b=>b.data().folderId===a)))await (0,b.updateDoc)(d.ref,{folderId:null})}async function g(a,d){await (0,b.updateDoc)((0,b.doc)(c.db,"materials",a),{folderId:d})}async function h(a,d){let e=(await (0,b.getDocs)((0,b.collection)(c.db,"materials"))).docs.map(a=>{let b=a.data();return{id:a.id,...b,createdAt:b.createdAt?.toDate()||new Date}}).filter(b=>b.userId===a);return void 0!==d&&(e=e.filter(a=>(a.folderId||null)===d)),e.sort((a,b)=>b.createdAt.getTime()-a.createdAt.getTime())}async function i(a){return(await (0,b.addDoc)((0,b.collection)(c.db,"materials"),{...a,createdAt:(0,b.serverTimestamp)()})).id}async function j(a){await (0,b.deleteDoc)((0,b.doc)(c.db,"materials",a))}async function k(a){return(await (0,b.getDocs)((0,b.collection)(c.db,"flashcardDecks"))).docs.map(a=>{let b=a.data();return{id:a.id,...b,createdAt:b.createdAt?.toDate()||new Date}}).filter(b=>b.userId===a).sort((a,b)=>b.createdAt.getTime()-a.createdAt.getTime())}async function l(a){return(await (0,b.addDoc)((0,b.collection)(c.db,"flashcardDecks"),{...a,cardCount:0,createdAt:(0,b.serverTimestamp)()})).id}async function m(a){return(await (0,b.getDocs)((0,b.collection)(c.db,"flashcards"))).docs.map(a=>({id:a.id,...a.data()})).filter(b=>b.deckId===a)}async function n(a){let d=await (0,b.addDoc)((0,b.collection)(c.db,"flashcards"),{...a,createdAt:new Date}),e=(0,b.doc)(c.db,"flashcardDecks",a.deckId),f=await (0,b.getDoc)(e);return f.exists()&&await (0,b.updateDoc)(e,{cardCount:(f.data().cardCount||0)+1}),d.id}async function o(a){return(await (0,b.getDocs)((0,b.collection)(c.db,"studyPlans"))).docs.map(a=>{let b=a.data();return{id:a.id,...b,examDate:b.examDate?.toDate()||new Date,createdAt:b.createdAt?.toDate()||new Date}}).filter(b=>b.userId===a).sort((a,b)=>a.examDate.getTime()-b.examDate.getTime())}async function p(a){return(await (0,b.addDoc)((0,b.collection)(c.db,"studyPlans"),{...a,completedTasks:0,examDate:b.Timestamp.fromDate(a.examDate),createdAt:(0,b.serverTimestamp)()})).id}async function q(a){for(let d of(await (0,b.deleteDoc)((0,b.doc)(c.db,"studyPlans",a)),(await (0,b.getDocs)((0,b.collection)(c.db,"studyTasks"))).docs.filter(b=>b.data().planId===a)))await (0,b.deleteDoc)(d.ref)}async function r(a,d){await (0,b.updateDoc)((0,b.doc)(c.db,"studyPlans",a),{completedTasks:d})}async function s(a,d){await (0,b.updateDoc)((0,b.doc)(c.db,"studyPlans",a),{totalTasks:d})}async function t(a,d){return(await (0,b.getDocs)((0,b.collection)(c.db,"studyTasks"))).docs.map(a=>{let b=a.data();return{id:a.id,...b,dueDate:b.dueDate?.toDate()||new Date,priority:b.priority||"medium",status:b.status||"pending"}}).filter(b=>b.userId===a&&(!d||b.planId===d)).sort((a,b)=>a.day-b.day)}async function u(a){return(await (0,b.addDoc)((0,b.collection)(c.db,"studyTasks"),{...a,completed:!1,dueDate:b.Timestamp.fromDate(a.dueDate)})).id}async function v(a,d,e){if(await (0,b.updateDoc)((0,b.doc)(c.db,"studyTasks",a),{completed:d}),e){let f=(await (0,b.getDocs)((0,b.collection)(c.db,"studyTasks"))).docs.filter(a=>a.data().planId===e).filter(b=>b.data().completed||b.id===a&&d).length;await r(e,f)}}async function w(a){await (0,b.deleteDoc)((0,b.doc)(c.db,"studyTasks",a))}async function x(a){let d=(await (0,b.getDocs)((0,b.collection)(c.db,"studyGroups"))).docs.map(a=>({id:a.id,...a.data(),createdAt:a.data().createdAt?.toDate()||new Date}));return a&&(d=d.filter(b=>b.members.some(b=>b.userId===a))),d.sort((a,b)=>b.createdAt.getTime()-a.createdAt.getTime())}async function y(a){let d=await (0,b.getDoc)((0,b.doc)(c.db,"studyGroups",a));return d.exists()?{id:d.id,...d.data(),createdAt:d.data().createdAt?.toDate()||new Date}:null}async function z(a){return(await (0,b.addDoc)((0,b.collection)(c.db,"studyGroups"),{...a,memberCount:a.members.length,createdAt:(0,b.serverTimestamp)()})).id}async function A(a,d){let e=(0,b.doc)(c.db,"studyGroups",a),f=await (0,b.getDoc)(e);if(f.exists()){let a=f.data(),c=a.members||[];if(c.length>=(a.maxMembers||10))throw Error("Group is full");c.some(a=>a.userId===d.userId)||await (0,b.updateDoc)(e,{members:[...c,d],memberCount:c.length+1})}}function B(a,d){return(0,b.onSnapshot)((0,b.collection)(c.db,"groupMessages"),b=>{d(b.docs.map(a=>{let b=a.data();return{id:a.id,...b,createdAt:b.createdAt?.toDate()||new Date}}).filter(b=>b.groupId===a).sort((a,b)=>a.createdAt.getTime()-b.createdAt.getTime()))})}async function C(a){return(await (0,b.addDoc)((0,b.collection)(c.db,"groupMessages"),{...a,createdAt:(0,b.serverTimestamp)()})).id}async function D(a,d){let e=(await (0,b.getDocs)((0,b.collection)(c.db,"tasks"))).docs.map(a=>{let b=a.data();return{id:a.id,...b,dueDate:b.dueDate?.toDate(),scheduledDate:b.scheduledDate?.toDate(),completedAt:b.completedAt?.toDate(),createdAt:b.createdAt?.toDate()||new Date,updatedAt:b.updatedAt?.toDate()||new Date,subtasks:b.subtasks||[],tags:b.tags||[],links:b.links||[]}}).filter(b=>b.userId===a);return d?.status&&(e=e.filter(a=>a.status===d.status)),d?.priority&&(e=e.filter(a=>a.priority===d.priority)),d?.course&&(e=e.filter(a=>a.course===d.course)),d?.tag&&(e=e.filter(a=>a.tags.includes(d.tag))),d?.dateRange&&(e=e.filter(a=>a.dueDate&&a.dueDate>=d.dateRange.start&&a.dueDate<=d.dateRange.end)),e.sort((a,b)=>{let c={urgent:0,high:1,medium:2,low:3};return c[a.priority]-c[b.priority]})}async function E(a){return(await (0,b.addDoc)((0,b.collection)(c.db,"tasks"),{...a,createdAt:(0,b.serverTimestamp)(),updatedAt:(0,b.serverTimestamp)()})).id}async function F(a,d){await (0,b.updateDoc)((0,b.doc)(c.db,"tasks",a),{...d,updatedAt:(0,b.serverTimestamp)()})}async function G(a){await (0,b.deleteDoc)((0,b.doc)(c.db,"tasks",a))}async function H(a,d){let e=(await (0,b.getDocs)((0,b.collection)(c.db,"calendarEvents"))).docs.map(a=>{let b=a.data();return{id:a.id,...b,startTime:b.startTime?.toDate()||new Date,endTime:b.endTime?.toDate()||new Date,createdAt:b.createdAt?.toDate()||new Date,recurrence:b.recurrence?{...b.recurrence,endDate:b.recurrence.endDate?.toDate(),exceptions:b.recurrence.exceptions?.map(a=>a.toDate())||[]}:void 0}}).filter(b=>b.userId===a);return d&&(e=e.filter(a=>a.startTime>=d.start&&a.startTime<=d.end)),e.sort((a,b)=>a.startTime.getTime()-b.startTime.getTime())}async function I(a){return(await (0,b.addDoc)((0,b.collection)(c.db,"calendarEvents"),{...a,createdAt:(0,b.serverTimestamp)()})).id}async function J(a,d){await (0,b.updateDoc)((0,b.doc)(c.db,"calendarEvents",a),d)}async function K(a){await (0,b.deleteDoc)((0,b.doc)(c.db,"calendarEvents",a))}async function L(a){let d=await (0,b.getDoc)((0,b.doc)(c.db,"pomodoroSettings",a));return d.exists()?d.data():null}async function M(a){await (0,b.setDoc)((0,b.doc)(c.db,"pomodoroSettings",a.userId),a)}async function N(a){return(await (0,b.addDoc)((0,b.collection)(c.db,"pomodoroSessions"),a)).id}async function O(a,d){let e=(await (0,b.getDocs)((0,b.collection)(c.db,"pomodoroSessions"))).docs.map(a=>{let b=a.data();return{id:a.id,...b,startTime:b.startTime?.toDate()||new Date,endTime:b.endTime?.toDate()}}).filter(b=>b.userId===a);return d&&(e=e.filter(a=>a.startTime>=d.start&&a.startTime<=d.end)),e.sort((a,b)=>b.startTime.getTime()-a.startTime.getTime())}async function P(a,d){let e=(await (0,b.getDocs)((0,b.collection)(c.db,"studySessions"))).docs.map(a=>{let b=a.data();return{id:a.id,...b,startTime:b.startTime?.toDate()||new Date,endTime:b.endTime?.toDate()||new Date,tags:b.tags||[]}}).filter(b=>b.userId===a);return d&&(e=e.filter(a=>a.startTime>=d.start&&a.startTime<=d.end)),e.sort((a,b)=>b.startTime.getTime()-a.startTime.getTime())}async function Q(a,d){let e=await (0,b.getDoc)((0,b.doc)(c.db,"dailyStats",`${a}_${d}`));if(!e.exists())return null;let f=e.data();return{id:e.id,...f,date:f.date?.toDate()||new Date,coursesStudied:f.coursesStudied||[]}}async function R(a){return(await (0,b.getDocs)((0,b.collection)(c.db,"courses"))).docs.map(a=>{let b=a.data();return{id:a.id,...b,schedule:b.schedule||[],examDate:b.examDate?.toDate()}}).filter(b=>b.userId===a)}async function S(a){return(await (0,b.getDocs)((0,b.collection)(c.db,"habits"))).docs.map(a=>{let b=a.data();return{id:a.id,...b,createdAt:b.createdAt?.toDate()||new Date,completions:b.completions||[]}}).filter(b=>b.userId===a&&!b.isArchived)}async function T(a){return(await (0,b.addDoc)((0,b.collection)(c.db,"habits"),{...a,currentStreak:0,longestStreak:0,completions:[],createdAt:(0,b.serverTimestamp)()})).id}async function U(a,d){let e=(0,b.doc)(c.db,"habits",a),f=await (0,b.getDoc)(e);if(!f.exists())return;let g=f.data(),h=g.completions||[],i=h.findIndex(a=>a.date===d);i>=0?h[i].completed=!h[i].completed:h.push({date:d,completed:!0});let j=0,k=new Date;for(let a=0;a<365;a++){let b=new Date(k);b.setDate(b.getDate()-a);let c=b.toISOString().split("T")[0],d=h.find(a=>a.date===c);if(d?.completed)j++;else if(a>0)break}let l=Math.max(g.longestStreak||0,j);await (0,b.updateDoc)(e,{completions:h,currentStreak:j,longestStreak:l})}async function V(a,d){let e=new Date(d);e.setHours(0,0,0,0);let f=new Date(d);return f.setHours(23,59,59,999),(await (0,b.getDocs)((0,b.collection)(c.db,"timeBlocks"))).docs.map(a=>{let b=a.data();return{id:a.id,...b,startTime:b.startTime?.toDate()||new Date,endTime:b.endTime?.toDate()||new Date,createdAt:b.createdAt?.toDate()||new Date}}).filter(b=>b.userId===a&&b.startTime>=e&&b.startTime<=f).sort((a,b)=>a.startTime.getTime()-b.startTime.getTime())}async function W(a){let[b,c,d]=await Promise.all([D(a),R(a),S(a)]),e=new Date().toISOString().split("T")[0],f=await Q(a,e),g=0;return f&&(g=f.streakDay),{tasks:b,courses:c,habits:d,dailyStats:f,userStreak:g}}a.s(["addFlashcard",()=>n,"addMaterial",()=>i,"createCalendarEvent",()=>I,"createFlashcardDeck",()=>l,"createHabit",()=>T,"createMaterialFolder",()=>e,"createStudyGroup",()=>z,"createStudyPlan",()=>p,"createStudyTask",()=>u,"createTask",()=>E,"deleteCalendarEvent",()=>K,"deleteMaterial",()=>j,"deleteMaterialFolder",()=>f,"deleteStudyPlan",()=>q,"deleteStudyTask",()=>w,"deleteTask",()=>G,"getCalendarEvents",()=>H,"getCourses",()=>R,"getDailyStats",()=>Q,"getFlashcardDecks",()=>k,"getFlashcards",()=>m,"getHabits",()=>S,"getMaterialFolders",()=>d,"getMaterials",()=>h,"getPomodoroSessions",()=>O,"getPomodoroSettings",()=>L,"getStudyGroup",()=>y,"getStudyGroups",()=>x,"getStudyPlans",()=>o,"getStudySessions",()=>P,"getStudyTasks",()=>t,"getTasks",()=>D,"getTimeBlocks",()=>V,"getUserData",()=>W,"joinGroup",()=>A,"logPomodoroSession",()=>N,"savePomodoroSettings",()=>M,"sendGroupMessage",()=>C,"subscribeToGroupMessages",()=>B,"toggleHabitCompletion",()=>U,"toggleTaskComplete",()=>v,"updateCalendarEvent",()=>J,"updateMaterialFolder",()=>g,"updatePlanProgress",()=>r,"updatePlanTotalTasks",()=>s,"updateTask",()=>F])}];

//# sourceMappingURL=lib_firestore_ts_4bcd9ca5._.js.map