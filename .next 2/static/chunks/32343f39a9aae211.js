(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,91918,20783,e=>{"use strict";var t=e.i(71645);function n(e,t){if("function"==typeof e)return e(t);null!=e&&(e.current=t)}function r(...e){return t=>{let r=!1,i=e.map(e=>{let i=n(e,t);return r||"function"!=typeof i||(r=!0),i});if(r)return()=>{for(let t=0;t<i.length;t++){let r=i[t];"function"==typeof r?r():n(e[t],null)}}}}function i(...e){return t.useCallback(r(...e),e)}e.s(["composeRefs",()=>r,"useComposedRefs",()=>i],20783);var s=e.i(43476),o=t.forwardRef((e,n)=>{let{children:r,...i}=e,o=t.Children.toArray(r),l=o.find(h);if(l){let e=l.props.children,r=o.map(n=>n!==l?n:t.Children.count(e)>1?t.Children.only(null):t.isValidElement(e)?e.props.children:null);return(0,s.jsx)(a,{...i,ref:n,children:t.isValidElement(e)?t.cloneElement(e,void 0,r):null})}return(0,s.jsx)(a,{...i,ref:n,children:r})});o.displayName="Slot";var a=t.forwardRef((e,n)=>{let{children:i,...s}=e;if(t.isValidElement(i)){var o;let e,a,l=(o=i,(a=(e=Object.getOwnPropertyDescriptor(o.props,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?o.ref:(a=(e=Object.getOwnPropertyDescriptor(o,"ref")?.get)&&"isReactWarning"in e&&e.isReactWarning)?o.props.ref:o.props.ref||o.ref);return t.cloneElement(i,{...function(e,t){let n={...t};for(let r in t){let i=e[r],s=t[r];/^on[A-Z]/.test(r)?i&&s?n[r]=(...e)=>{s(...e),i(...e)}:i&&(n[r]=i):"style"===r?n[r]={...i,...s}:"className"===r&&(n[r]=[i,s].filter(Boolean).join(" "))}return{...e,...n}}(s,i.props),ref:n?r(n,l):l})}return t.Children.count(i)>1?t.Children.only(null):null});a.displayName="SlotClone";var l=({children:e})=>(0,s.jsx)(s.Fragment,{children:e});function h(e){return t.isValidElement(e)&&e.type===l}e.s(["Slot",()=>o,"Slottable",()=>l],91918)},7670,e=>{"use strict";function t(){for(var e,t,n=0,r="",i=arguments.length;n<i;n++)(e=arguments[n])&&(t=function e(t){var n,r,i="";if("string"==typeof t||"number"==typeof t)i+=t;else if("object"==typeof t)if(Array.isArray(t)){var s=t.length;for(n=0;n<s;n++)t[n]&&(r=e(t[n]))&&(i&&(i+=" "),i+=r)}else for(r in t)t[r]&&(i&&(i+=" "),i+=r);return i}(e))&&(r&&(r+=" "),r+=t);return r}e.s(["clsx",()=>t])},25913,e=>{"use strict";var t=e.i(7670);let n=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,r=t.clsx;e.s(["cva",0,(e,t)=>i=>{var s;if((null==t?void 0:t.variants)==null)return r(e,null==i?void 0:i.class,null==i?void 0:i.className);let{variants:o,defaultVariants:a}=t,l=Object.keys(o).map(e=>{let t=null==i?void 0:i[e],r=null==a?void 0:a[e];if(null===t)return null;let s=n(t)||n(r);return o[e][s]}),h=i&&Object.entries(i).reduce((e,t)=>{let[n,r]=t;return void 0===r||(e[n]=r),e},{});return r(e,l,null==t||null==(s=t.compoundVariants)?void 0:s.reduce((e,t)=>{let{class:n,className:r,...i}=t;return Object.entries(i).every(e=>{let[t,n]=e;return Array.isArray(n)?n.includes({...a,...h}[t]):({...a,...h})[t]===n})?[...e,n,r]:e},[]),null==i?void 0:i.class,null==i?void 0:i.className)}])},47163,e=>{"use strict";var t=e.i(7670);let n=(e,t)=>{if(0===e.length)return t.classGroupId;let r=e[0],i=t.nextPart.get(r),s=i?n(e.slice(1),i):void 0;if(s)return s;if(0===t.validators.length)return;let o=e.join("-");return t.validators.find(({validator:e})=>e(o))?.classGroupId},r=/^\[(.+)\]$/,i=(e,t,n,r)=>{e.forEach(e=>{if("string"==typeof e){(""===e?t:s(t,e)).classGroupId=n;return}"function"==typeof e?o(e)?i(e(r),t,n,r):t.validators.push({validator:e,classGroupId:n}):Object.entries(e).forEach(([e,o])=>{i(o,s(t,e),n,r)})})},s=(e,t)=>{let n=e;return t.split("-").forEach(e=>{n.nextPart.has(e)||n.nextPart.set(e,{nextPart:new Map,validators:[]}),n=n.nextPart.get(e)}),n},o=e=>e.isThemeGetter,a=(e,t)=>t?e.map(([e,n])=>[e,n.map(e=>"string"==typeof e?t+e:"object"==typeof e?Object.fromEntries(Object.entries(e).map(([e,n])=>[t+e,n])):e)]):e,l=e=>{if(e.length<=1)return e;let t=[],n=[];return e.forEach(e=>{"["===e[0]?(t.push(...n.sort(),e),n=[]):n.push(e)}),t.push(...n.sort()),t},h=/\s+/;function u(){let e,t,n=0,r="";for(;n<arguments.length;)(e=arguments[n++])&&(t=c(e))&&(r&&(r+=" "),r+=t);return r}let c=e=>{let t;if("string"==typeof e)return e;let n="";for(let r=0;r<e.length;r++)e[r]&&(t=c(e[r]))&&(n&&(n+=" "),n+=t);return n},d=e=>{let t=t=>t[e]||[];return t.isThemeGetter=!0,t},f=/^\[(?:([a-z-]+):)?(.+)\]$/i,p=/^\d+\/\d+$/,m=new Set(["px","full","screen"]),g=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,y=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,_=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,v=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,w=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,b=e=>T(e)||m.has(e)||p.test(e),E=e=>M(e,"length",F),T=e=>!!e&&!Number.isNaN(Number(e)),C=e=>M(e,"number",T),I=e=>!!e&&Number.isInteger(Number(e)),S=e=>e.endsWith("%")&&T(e.slice(0,-1)),k=e=>f.test(e),R=e=>g.test(e),N=new Set(["length","size","percentage"]),A=e=>M(e,N,U),x=e=>M(e,"position",U),P=new Set(["image","url"]),D=e=>M(e,P,j),O=e=>M(e,"",V),L=()=>!0,M=(e,t,n)=>{let r=f.exec(e);return!!r&&(r[1]?"string"==typeof t?r[1]===t:t.has(r[1]):n(r[2]))},F=e=>y.test(e)&&!_.test(e),U=()=>!1,V=e=>v.test(e),j=e=>w.test(e),q=function(e,...t){let s,o,c,d=function(l){let h;return o=(s={cache:(e=>{if(e<1)return{get:()=>void 0,set:()=>{}};let t=0,n=new Map,r=new Map,i=(i,s)=>{n.set(i,s),++t>e&&(t=0,r=n,n=new Map)};return{get(e){let t=n.get(e);return void 0!==t?t:void 0!==(t=r.get(e))?(i(e,t),t):void 0},set(e,t){n.has(e)?n.set(e,t):i(e,t)}}})((h=t.reduce((e,t)=>t(e),e())).cacheSize),parseClassName:(e=>{let{separator:t,experimentalParseClassName:n}=e,r=1===t.length,i=t[0],s=t.length,o=e=>{let n,o=[],a=0,l=0;for(let h=0;h<e.length;h++){let u=e[h];if(0===a){if(u===i&&(r||e.slice(h,h+s)===t)){o.push(e.slice(l,h)),l=h+s;continue}if("/"===u){n=h;continue}}"["===u?a++:"]"===u&&a--}let h=0===o.length?e:e.substring(l),u=h.startsWith("!"),c=u?h.substring(1):h;return{modifiers:o,hasImportantModifier:u,baseClassName:c,maybePostfixModifierPosition:n&&n>l?n-l:void 0}};return n?e=>n({className:e,parseClassName:o}):o})(h),...(e=>{let t=(e=>{let{theme:t,prefix:n}=e,r={nextPart:new Map,validators:[]};return a(Object.entries(e.classGroups),n).forEach(([e,n])=>{i(n,r,e,t)}),r})(e),{conflictingClassGroups:s,conflictingClassGroupModifiers:o}=e;return{getClassGroupId:e=>{let i=e.split("-");return""===i[0]&&1!==i.length&&i.shift(),n(i,t)||(e=>{if(r.test(e)){let t=r.exec(e)[1],n=t?.substring(0,t.indexOf(":"));if(n)return"arbitrary.."+n}})(e)},getConflictingClassGroupIds:(e,t)=>{let n=s[e]||[];return t&&o[e]?[...n,...o[e]]:n}}})(h)}).cache.get,c=s.cache.set,d=f,f(l)};function f(e){let t=o(e);if(t)return t;let n=((e,t)=>{let{parseClassName:n,getClassGroupId:r,getConflictingClassGroupIds:i}=t,s=[],o=e.trim().split(h),a="";for(let e=o.length-1;e>=0;e-=1){let t=o[e],{modifiers:h,hasImportantModifier:u,baseClassName:c,maybePostfixModifierPosition:d}=n(t),f=!!d,p=r(f?c.substring(0,d):c);if(!p){if(!f||!(p=r(c))){a=t+(a.length>0?" "+a:a);continue}f=!1}let m=l(h).join(":"),g=u?m+"!":m,y=g+p;if(s.includes(y))continue;s.push(y);let _=i(p,f);for(let e=0;e<_.length;++e){let t=_[e];s.push(g+t)}a=t+(a.length>0?" "+a:a)}return a})(e,s);return c(e,n),n}return function(){return d(u.apply(null,arguments))}}(()=>{let e=d("colors"),t=d("spacing"),n=d("blur"),r=d("brightness"),i=d("borderColor"),s=d("borderRadius"),o=d("borderSpacing"),a=d("borderWidth"),l=d("contrast"),h=d("grayscale"),u=d("hueRotate"),c=d("invert"),f=d("gap"),p=d("gradientColorStops"),m=d("gradientColorStopPositions"),g=d("inset"),y=d("margin"),_=d("opacity"),v=d("padding"),w=d("saturate"),N=d("scale"),P=d("sepia"),M=d("skew"),F=d("space"),U=d("translate"),V=()=>["auto","contain","none"],j=()=>["auto","hidden","clip","visible","scroll"],q=()=>["auto",k,t],z=()=>[k,t],B=()=>["",b,E],$=()=>["auto",T,k],W=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],H=()=>["solid","dashed","dotted","double","none"],K=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],G=()=>["start","end","center","between","around","evenly","stretch"],Q=()=>["","0",k],Y=()=>["auto","avoid","all","avoid-page","page","left","right","column"],X=()=>[T,k];return{cacheSize:500,separator:":",theme:{colors:[L],spacing:[b,E],blur:["none","",R,k],brightness:X(),borderColor:[e],borderRadius:["none","","full",R,k],borderSpacing:z(),borderWidth:B(),contrast:X(),grayscale:Q(),hueRotate:X(),invert:Q(),gap:z(),gradientColorStops:[e],gradientColorStopPositions:[S,E],inset:q(),margin:q(),opacity:X(),padding:z(),saturate:X(),scale:X(),sepia:Q(),skew:X(),space:z(),translate:z()},classGroups:{aspect:[{aspect:["auto","square","video",k]}],container:["container"],columns:[{columns:[R]}],"break-after":[{"break-after":Y()}],"break-before":[{"break-before":Y()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...W(),k]}],overflow:[{overflow:j()}],"overflow-x":[{"overflow-x":j()}],"overflow-y":[{"overflow-y":j()}],overscroll:[{overscroll:V()}],"overscroll-x":[{"overscroll-x":V()}],"overscroll-y":[{"overscroll-y":V()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[g]}],"inset-x":[{"inset-x":[g]}],"inset-y":[{"inset-y":[g]}],start:[{start:[g]}],end:[{end:[g]}],top:[{top:[g]}],right:[{right:[g]}],bottom:[{bottom:[g]}],left:[{left:[g]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",I,k]}],basis:[{basis:q()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",k]}],grow:[{grow:Q()}],shrink:[{shrink:Q()}],order:[{order:["first","last","none",I,k]}],"grid-cols":[{"grid-cols":[L]}],"col-start-end":[{col:["auto",{span:["full",I,k]},k]}],"col-start":[{"col-start":$()}],"col-end":[{"col-end":$()}],"grid-rows":[{"grid-rows":[L]}],"row-start-end":[{row:["auto",{span:[I,k]},k]}],"row-start":[{"row-start":$()}],"row-end":[{"row-end":$()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",k]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",k]}],gap:[{gap:[f]}],"gap-x":[{"gap-x":[f]}],"gap-y":[{"gap-y":[f]}],"justify-content":[{justify:["normal",...G()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...G(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...G(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[v]}],px:[{px:[v]}],py:[{py:[v]}],ps:[{ps:[v]}],pe:[{pe:[v]}],pt:[{pt:[v]}],pr:[{pr:[v]}],pb:[{pb:[v]}],pl:[{pl:[v]}],m:[{m:[y]}],mx:[{mx:[y]}],my:[{my:[y]}],ms:[{ms:[y]}],me:[{me:[y]}],mt:[{mt:[y]}],mr:[{mr:[y]}],mb:[{mb:[y]}],ml:[{ml:[y]}],"space-x":[{"space-x":[F]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[F]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",k,t]}],"min-w":[{"min-w":[k,t,"min","max","fit"]}],"max-w":[{"max-w":[k,t,"none","full","min","max","fit","prose",{screen:[R]},R]}],h:[{h:[k,t,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[k,t,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[k,t,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[k,t,"auto","min","max","fit"]}],"font-size":[{text:["base",R,E]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",C]}],"font-family":[{font:[L]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",k]}],"line-clamp":[{"line-clamp":["none",T,C]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",b,k]}],"list-image":[{"list-image":["none",k]}],"list-style-type":[{list:["none","disc","decimal",k]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[_]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[_]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...H(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",b,E]}],"underline-offset":[{"underline-offset":["auto",b,k]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:z()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",k]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",k]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[_]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...W(),x]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",A]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},D]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[m]}],"gradient-via-pos":[{via:[m]}],"gradient-to-pos":[{to:[m]}],"gradient-from":[{from:[p]}],"gradient-via":[{via:[p]}],"gradient-to":[{to:[p]}],rounded:[{rounded:[s]}],"rounded-s":[{"rounded-s":[s]}],"rounded-e":[{"rounded-e":[s]}],"rounded-t":[{"rounded-t":[s]}],"rounded-r":[{"rounded-r":[s]}],"rounded-b":[{"rounded-b":[s]}],"rounded-l":[{"rounded-l":[s]}],"rounded-ss":[{"rounded-ss":[s]}],"rounded-se":[{"rounded-se":[s]}],"rounded-ee":[{"rounded-ee":[s]}],"rounded-es":[{"rounded-es":[s]}],"rounded-tl":[{"rounded-tl":[s]}],"rounded-tr":[{"rounded-tr":[s]}],"rounded-br":[{"rounded-br":[s]}],"rounded-bl":[{"rounded-bl":[s]}],"border-w":[{border:[a]}],"border-w-x":[{"border-x":[a]}],"border-w-y":[{"border-y":[a]}],"border-w-s":[{"border-s":[a]}],"border-w-e":[{"border-e":[a]}],"border-w-t":[{"border-t":[a]}],"border-w-r":[{"border-r":[a]}],"border-w-b":[{"border-b":[a]}],"border-w-l":[{"border-l":[a]}],"border-opacity":[{"border-opacity":[_]}],"border-style":[{border:[...H(),"hidden"]}],"divide-x":[{"divide-x":[a]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[a]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[_]}],"divide-style":[{divide:H()}],"border-color":[{border:[i]}],"border-color-x":[{"border-x":[i]}],"border-color-y":[{"border-y":[i]}],"border-color-s":[{"border-s":[i]}],"border-color-e":[{"border-e":[i]}],"border-color-t":[{"border-t":[i]}],"border-color-r":[{"border-r":[i]}],"border-color-b":[{"border-b":[i]}],"border-color-l":[{"border-l":[i]}],"divide-color":[{divide:[i]}],"outline-style":[{outline:["",...H()]}],"outline-offset":[{"outline-offset":[b,k]}],"outline-w":[{outline:[b,E]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:B()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[_]}],"ring-offset-w":[{"ring-offset":[b,E]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",R,O]}],"shadow-color":[{shadow:[L]}],opacity:[{opacity:[_]}],"mix-blend":[{"mix-blend":[...K(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":K()}],filter:[{filter:["","none"]}],blur:[{blur:[n]}],brightness:[{brightness:[r]}],contrast:[{contrast:[l]}],"drop-shadow":[{"drop-shadow":["","none",R,k]}],grayscale:[{grayscale:[h]}],"hue-rotate":[{"hue-rotate":[u]}],invert:[{invert:[c]}],saturate:[{saturate:[w]}],sepia:[{sepia:[P]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[n]}],"backdrop-brightness":[{"backdrop-brightness":[r]}],"backdrop-contrast":[{"backdrop-contrast":[l]}],"backdrop-grayscale":[{"backdrop-grayscale":[h]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[u]}],"backdrop-invert":[{"backdrop-invert":[c]}],"backdrop-opacity":[{"backdrop-opacity":[_]}],"backdrop-saturate":[{"backdrop-saturate":[w]}],"backdrop-sepia":[{"backdrop-sepia":[P]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[o]}],"border-spacing-x":[{"border-spacing-x":[o]}],"border-spacing-y":[{"border-spacing-y":[o]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",k]}],duration:[{duration:X()}],ease:[{ease:["linear","in","out","in-out",k]}],delay:[{delay:X()}],animate:[{animate:["none","spin","ping","pulse","bounce",k]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[N]}],"scale-x":[{"scale-x":[N]}],"scale-y":[{"scale-y":[N]}],rotate:[{rotate:[I,k]}],"translate-x":[{"translate-x":[U]}],"translate-y":[{"translate-y":[U]}],"skew-x":[{"skew-x":[M]}],"skew-y":[{"skew-y":[M]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",k]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",k]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":z()}],"scroll-mx":[{"scroll-mx":z()}],"scroll-my":[{"scroll-my":z()}],"scroll-ms":[{"scroll-ms":z()}],"scroll-me":[{"scroll-me":z()}],"scroll-mt":[{"scroll-mt":z()}],"scroll-mr":[{"scroll-mr":z()}],"scroll-mb":[{"scroll-mb":z()}],"scroll-ml":[{"scroll-ml":z()}],"scroll-p":[{"scroll-p":z()}],"scroll-px":[{"scroll-px":z()}],"scroll-py":[{"scroll-py":z()}],"scroll-ps":[{"scroll-ps":z()}],"scroll-pe":[{"scroll-pe":z()}],"scroll-pt":[{"scroll-pt":z()}],"scroll-pr":[{"scroll-pr":z()}],"scroll-pb":[{"scroll-pb":z()}],"scroll-pl":[{"scroll-pl":z()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",k]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[b,E,C]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}});function z(...e){return q((0,t.clsx)(e))}function B(e,t=7){let n,r=new Date(new Date().getTime()-24*t*36e5),i=e.filter(e=>new Date(e.startTime)>=r),s=i.reduce((e,t)=>e+t.duration,0),o=(i.length>0?i.reduce((e,t)=>e+(t.focusScore||80),0)/i.length:80)/100*(s/(2*t*60)*100);return n=o<40?"low":o<80?"optimal":o<110?"high":"overloaded",{current:Math.min(o,150),optimal:75,status:n}}function $(e,t=new Date){return e.map(e=>{let n=Math.floor((t.getTime()-e.lastReviewed.getTime())/864e5),r=[1,3,7,14,30,60,120,240],i=Math.max(.5,Math.min(2,e.difficulty+.5)),s=Math.min(.1*e.correctStreak,1),o=Math.min(Math.floor(n/7),r.length-1),a=r[o]*i*(1+s);a=Math.min(a,365);let l=new Date(e.lastReviewed);l.setDate(l.getDate()+a);let h=Math.max(0,t.getTime()-l.getTime())/864e5,u=Math.min(2*e.difficulty+.5*h+(e.correctStreak>0?0:1),10);return{itemId:e.id,nextReview:l,priority:u,interval:Math.round(a)}}).sort((e,t)=>t.priority-e.priority)}function W(e,t,n=30){let r=new Date;r.getTime();let i=e.reduce((e,t)=>{let n=`Topic_${t.deckId}`;return e[n]||(e[n]=[]),e[n].push(t),e},{}),s=[];for(let[e,t]of Object.entries(i)){let n=Math.min((10*(t.reduce((e,t)=>e+t.correctStreak,0)/t.length)+t.reduce((e,t)=>e+(t.totalAttempts>0?t.correctStreak/t.totalAttempts*100:0),0)/t.length)/2,100),i=t.reduce((e,t)=>t.lastReviewed>e?t.lastReviewed:e,new Date(0)),o=Math.floor((r.getTime()-i.getTime())/864e5),a=Math.max(1,7-Math.floor(n/20)),l=new Date(i.getTime()+24*a*36e5),h="low";n<50||o>14?h="high":(n<75||o>7)&&(h="medium"),s.push({topic:e.replace("Topic_","Subject "),confidence:n,lastReviewed:i,recommendedReview:l,priority:h})}return s.sort((e,t)=>{let n={high:3,medium:2,low:1},r=n[t.priority]-n[e.priority];return 0!==r?r:e.confidence-t.confidence})}e.s(["analyzeKnowledgeGaps",()=>W,"calculateCognitiveLoad",()=>B,"cn",()=>z,"generateSpacedRepetitionSchedule",()=>$],47163)},67881,e=>{"use strict";var t=e.i(43476),n=e.i(91918),r=e.i(25913),i=e.i(47163);let s=(0,r.cva)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-lg text-sm font-medium transition-all duration-200 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive active:scale-[0.98] transform",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90 hover:shadow-lg hover:shadow-primary/25 focus-visible:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 hover:shadow-lg hover:shadow-destructive/25 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border-2 bg-background shadow-sm hover:bg-accent hover:text-accent-foreground hover:border-accent-foreground/20 hover:shadow-md dark:bg-input/30 dark:border-input dark:hover:bg-input/50 dark:hover:border-accent-foreground/20",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80 hover:shadow-md focus-visible:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground hover:shadow-sm dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline hover:text-primary/80",success:"bg-green-600 text-white hover:bg-green-700 hover:shadow-lg hover:shadow-green-500/25 focus-visible:bg-green-700",warning:"bg-orange-600 text-white hover:bg-orange-700 hover:shadow-lg hover:shadow-orange-500/25 focus-visible:bg-orange-700"},size:{default:"h-10 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5 text-xs",lg:"h-12 rounded-lg px-6 has-[>svg]:px-4 text-base",xl:"h-14 rounded-lg px-8 has-[>svg]:px-5 text-lg",icon:"size-10","icon-sm":"size-8","icon-lg":"size-12"}},defaultVariants:{variant:"default",size:"default"}});function o({className:e,variant:r,size:o,asChild:a=!1,...l}){let h=a?n.Slot:"button";return(0,t.jsx)(h,{"data-slot":"button",className:(0,i.cn)(s({variant:r,size:o,className:e})),...l})}e.s(["Button",()=>o])},51718,18357,98925,36180,61086,76009,e=>{"use strict";let t,n,r,i,s,o,a,l,h,u,c,d,f,p,m;var g,y,_,v,w,b,E,T,C,I,S,k,R,N,A,x,P,D,O,L,M,F,U,V=e.i(47167);let j=function(e,t){if(!e)throw q(t)},q=function(e){return Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+e)},z=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:((64512&i)==55296&&r+1<e.length&&(64512&e.charCodeAt(r+1))==56320?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128):t[n++]=i>>12|224,t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t},B=function(e){let t=[],n=0,r=0;for(;n<e.length;){let i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){let s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){let s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{let s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")},$={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){let i=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,l=a?e[t+2]:0,h=i>>2,u=(3&i)<<4|o>>4,c=(15&o)<<2|l>>6,d=63&l;!a&&(d=64,s||(c=64)),r.push(n[h],n[u],n[c],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(z(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):B(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){let i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0,o=++t<e.length?n[e.charAt(t)]:64,a=++t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==o||null==a)throw new W;let l=i<<2|s>>4;if(r.push(l),64!==o){let e=s<<4&240|o>>2;if(r.push(e),64!==a){let e=o<<6&192|a;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class W extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let H=function(e){let t=z(e);return $.encodeByteArray(t,!0)},K=function(e){return H(e).replace(/\./g,"")},G=function(e){try{return $.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},Q=()=>{try{return("undefined"!=typeof self?self:"undefined"!=typeof window?window:e.g).__FIREBASE_DEFAULTS__||(()=>{if(void 0===V.default||void 0===V.default.env)return;let e=V.default.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)})()||(()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&G(e[1]);return t&&JSON.parse(t)})()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},Y=e=>Q()?.emulatorHosts?.[e],X=e=>{let t=Y(e);if(!t)return;let n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw Error(`Invalid host ${t} with no separate hostname and port!`);let r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},J=()=>Q()?.config,Z=e=>Q()?.[`_${e}`];class ee{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,n))}}}function et(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch{return!1}}async function en(e){return(await fetch(e,{credentials:"include"})).ok}function er(e,t){if(e.uid)throw Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw Error("mockUserToken must contain 'sub' or 'user_id' field!");let s={iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}},...e};return[K(JSON.stringify({alg:"none",type:"JWT"})),K(JSON.stringify(s)),""].join(".")}let ei={},es=!1;function eo(e,t){if("undefined"==typeof window||"undefined"==typeof document||!et(window.location.host)||ei[e]===t||ei[e]||es)return;function n(e){return`__firebase__banner__${e}`}ei[e]=t;let r="__firebase__banner",i=function(){let e={prod:[],emulator:[]};for(let t of Object.keys(ei))ei[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){let e,t,s=(e=document.getElementById(r),t=!1,e||((e=document.createElement("div")).setAttribute("id",r),t=!0),{created:t,element:e}),o=n("text"),a=document.getElementById(o)||document.createElement("span"),l=n("learnmore"),h=document.getElementById(l)||document.createElement("a"),u=n("preprendIcon"),c=document.getElementById(u)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(s.created){let e,t=s.element;t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center",h.setAttribute("id",l),h.innerText="Learn more",h.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",h.setAttribute("target","__blank"),h.style.paddingLeft="5px",h.style.textDecoration="underline";let n=((e=document.createElement("span")).style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{let e;es=!0,(e=document.getElementById(r))&&e.remove()},e);c.setAttribute("width","24"),c.setAttribute("id",u),c.setAttribute("height","24"),c.setAttribute("viewBox","0 0 24 24"),c.setAttribute("fill","none"),c.style.marginLeft="-6px",t.append(c,a,h,n),document.body.appendChild(t)}i?(a.innerText="Preview backend disconnected.",c.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(c.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,a.innerText="Preview backend running in this workspace."),a.setAttribute("id",o)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}function ea(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function el(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(ea())}function eh(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function eu(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function ec(){return false}class ed extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,ed.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ef.prototype.create)}}class ef{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){var n,r;let i=t[0]||{},s=`${this.service}/${e}`,o=this.errors[e],a=o?(n=o,r=i,n.replace(ep,(e,t)=>{let n=r[t];return null!=n?String(n):`<${t}?>`})):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new ed(s,l,i)}}let ep=/\{\$([^}]+)}/g;function em(e){return JSON.parse(e)}function eg(e){return JSON.stringify(e)}let ey=function(e){let t={},n={},r={},i="";try{let s=e.split(".");t=em(G(s[0])||""),n=em(G(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}},e_=function(e){let t=ey(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")},ev=function(e){let t=ey(e).claims;return"object"==typeof t&&!0===t.admin};function ew(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function eb(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function eE(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function eT(e,t,n){let r={};for(let i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function eC(e,t){if(e===t)return!0;let n=Object.keys(e),r=Object.keys(t);for(let i of n){if(!r.includes(i))return!1;let n=e[i],s=t[i];if(eI(n)&&eI(s)){if(!eC(n,s))return!1}else if(n!==s)return!1}for(let e of r)if(!n.includes(e))return!1;return!0}function eI(e){return null!==e&&"object"==typeof e}function eS(e){let t=[];for(let[n,r]of Object.entries(e))Array.isArray(r)?r.forEach(e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}function ek(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[n,r]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(r)}}),t}function eR(e){let t=e.indexOf("?");if(!t)return"";let n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class eN{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=0x67452301,this.chain_[1]=0xefcdab89,this.chain_[2]=0x98badcfe,this.chain_[3]=0x10325476,this.chain_[4]=0xc3d2e1f0,this.inbuf_=0,this.total_=0}compress_(e,t){let n,r;t||(t=0);let i=this.W_;if("string"==typeof e)for(let n=0;n<16;n++)i[n]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let n=0;n<16;n++)i[n]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){let t=i[e-3]^i[e-8]^i[e-14]^i[e-16];i[e]=(t<<1|t>>>31)&0xffffffff}let s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],l=this.chain_[3],h=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(n=l^o&(a^l),r=0x5a827999):(n=o^a^l,r=0x6ed9eba1):e<60?(n=o&a|l&(o|a),r=0x8f1bbcdc):(n=o^a^l,r=0xca62c1d6);let t=(s<<5|s>>>27)+n+h+r+i[e]|0;h=l,l=a,a=(o<<30|o>>>2)&0xffffffff,o=s,s=t}this.chain_[0]=this.chain_[0]+s|0,this.chain_[1]=this.chain_[1]+o|0,this.chain_[2]=this.chain_[2]+a|0,this.chain_[3]=this.chain_[3]+l|0,this.chain_[4]=this.chain_[4]+h|0}update(e,t){if(null==e)return;void 0===t&&(t=e.length);let n=t-this.blockSize,r=0,i=this.buf_,s=this.inbuf_;for(;r<t;){if(0===s)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[s]=e.charCodeAt(r),++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}else for(;r<t;)if(i[s]=e[r],++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){let e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let r=24;r>=0;r-=8)e[n]=this.chain_[t]>>r&255,++n;return e}}class eA{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,n){let r;if(void 0===e&&void 0===t&&void 0===n)throw Error("Missing Observer.");void 0===(r=!function(e,t){if("object"!=typeof e||null===e)return!1;for(let n of t)if(n in e&&"function"==typeof e[n])return!0;return!1}(e,["next","error","complete"])?{next:e,error:t,complete:n}:e).next&&(r.next=ex),void 0===r.error&&(r.error=ex),void 0===r.complete&&(r.complete=ex);let i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch(e){}}),this.observers.push(r),i}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function ex(){}let eP=function(e){let t=[],n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);if(i>=55296&&i<=56319){let t=i-55296;j(++r<e.length,"Surrogate pair missing trail surrogate."),i=65536+(t<<10)+(e.charCodeAt(r)-56320)}i<128?t[n++]=i:(i<2048?t[n++]=i>>6|192:(i<65536?t[n++]=i>>12|224:(t[n++]=i>>18|240,t[n++]=i>>12&63|128),t[n++]=i>>6&63|128),t[n++]=63&i|128)}return t},eD=function(e){let t=0;for(let n=0;n<e.length;n++){let r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t};function eO(e){return e&&e._delegate?e._delegate:e}class eL{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let eM="[DEFAULT]";class eF{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new ee;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){let t=this.normalizeInstanceIdentifier(e?.identifier),n=e?.optional??!1;if(this.isInitialized(t)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:t})}catch(e){if(n)return null;throw e}if(n)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:eM})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let n=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=eM){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=eM){return this.instances.has(e)}getOptions(e=eM){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(let[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(r);return r}onInit(e,t){let n=this.normalizeInstanceIdentifier(t),r=this.onInitCallbacks.get(n)??new Set;r.add(e),this.onInitCallbacks.set(n,r);let i=this.instances.get(n);return i&&e(i,n),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){let n=this.onInitCallbacks.get(t);if(n)for(let r of n)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var n;let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e)===eM?void 0:n,options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=eM){return this.component?this.component.multipleInstances?e:eM:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class eU{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new eF(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}let eV=[];(g=b||(b={}))[g.DEBUG=0]="DEBUG",g[g.VERBOSE=1]="VERBOSE",g[g.INFO=2]="INFO",g[g.WARN=3]="WARN",g[g.ERROR=4]="ERROR",g[g.SILENT=5]="SILENT";let ej={debug:b.DEBUG,verbose:b.VERBOSE,info:b.INFO,warn:b.WARN,error:b.ERROR,silent:b.SILENT},eq=b.INFO,ez={[b.DEBUG]:"log",[b.VERBOSE]:"log",[b.INFO]:"info",[b.WARN]:"warn",[b.ERROR]:"error"},eB=(e,t,...n)=>{if(t<e.logLevel)return;let r=new Date().toISOString(),i=ez[t];if(i)console[i](`[${r}]  ${e.name}:`,...n);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class e${constructor(e){this.name=e,this._logLevel=eq,this._logHandler=eB,this._userLogHandler=null,eV.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in b))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?ej[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,b.DEBUG,...e),this._logHandler(this,b.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,b.VERBOSE,...e),this._logHandler(this,b.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,b.INFO,...e),this._logHandler(this,b.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,b.WARN,...e),this._logHandler(this,b.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,b.ERROR,...e),this._logHandler(this,b.ERROR,...e)}}let eW=new WeakMap,eH=new WeakMap,eK=new WeakMap,eG=new WeakMap,eQ=new WeakMap,eY={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return eH.get(e);if("objectStoreNames"===t)return e.objectStoreNames||eK.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return eX(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function eX(e){if(e instanceof IDBRequest){let t;return(t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(eX(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)})).then(t=>{t instanceof IDBCursor&&eW.set(t,e)}).catch(()=>{}),eQ.set(t,e),t}if(eG.has(e))return eG.get(e);let r=function(e){if("function"==typeof e)return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(n||(n=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(eJ(this),t),eX(eW.get(this))}:function(...t){return eX(e.apply(eJ(this),t))}:function(t,...n){let r=e.call(eJ(this),t,...n);return eK.set(r,t.sort?t.sort():[t]),eX(r)};return e instanceof IDBTransaction&&function(e){if(eH.has(e))return;let t=new Promise((t,n)=>{let r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});eH.set(e,t)}(e),(t||(t=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>e instanceof t)?new Proxy(e,eY):e}(e);return r!==e&&(eG.set(e,r),eQ.set(r,e)),r}let eJ=e=>eQ.get(e),eZ=["get","getKey","getAll","getAllKeys","count"],e0=["put","add","delete","clear"],e1=new Map;function e2(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(e1.get(t))return e1.get(t);let n=t.replace(/FromIndex$/,""),r=t!==n,i=e0.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||eZ.includes(n)))return;let s=async function(e,...t){let s=this.transaction(e,i?"readwrite":"readonly"),o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return e1.set(t,s),s}eY={...m=eY,get:(e,t,n)=>e2(e,t)||m.get(e,t,n),has:(e,t)=>!!e2(e,t)||m.has(e,t)};class e3{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{let t;if(t=e.getComponent(),t?.type!=="VERSION")return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let e6="@firebase/app",e4="0.14.5",e5=new e$("@firebase/app"),e8="[DEFAULT]",e7={[e6]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},e9=new Map,te=new Map,tt=new Map;function tn(e,t){try{e.container.addComponent(t)}catch(n){e5.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function tr(e,t){e.container.addOrOverwriteComponent(t)}function ti(e){let t=e.name;if(tt.has(t))return e5.debug(`There were multiple attempts to register component ${t}.`),!1;for(let n of(tt.set(t,e),e9.values()))tn(n,e);for(let t of te.values())tn(t,e);return!0}function ts(e,t){let n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function to(e,t,n=e8){ts(e,t).clearInstance(n)}function ta(e){return void 0!==e.options}function tl(e){return!ta(e)&&("authIdToken"in e||"appCheckToken"in e||"releaseOnDeref"in e||"automaticDataCollectionEnabled"in e)}function th(e){return null!=e&&void 0!==e.settings}function tu(){tt.clear()}let tc=new ef("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class td{constructor(e,t,n){this._isDeleted=!1,this._options={...e},this._config={...t},this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new eL("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw tc.create("app-deleted",{appName:this._name})}}function tf(e,t){let n=G(e.split(".")[1]);null===n?console.error(`FirebaseServerApp ${t} is invalid: second part could not be parsed.`):void 0===JSON.parse(n).exp?console.error(`FirebaseServerApp ${t} is invalid: expiration claim could not be parsed`):1e3*JSON.parse(n).exp-new Date().getTime()<=0&&console.error(`FirebaseServerApp ${t} is invalid: the token has expired.`)}class tp extends td{constructor(e,t,n,r){const i=void 0===t.automaticDataCollectionEnabled||t.automaticDataCollectionEnabled,s={name:n,automaticDataCollectionEnabled:i};void 0!==e.apiKey?super(e,s,r):super(e.options,s,r),this._serverConfig={automaticDataCollectionEnabled:i,...t},this._serverConfig.authIdToken&&tf(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&tf(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,"undefined"!=typeof FinalizationRegistry&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,tb(e6,e4,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,void 0!==e&&null!==this._finalizationRegistry&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){tw(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw tc.create("server-app-deleted")}}let tm="12.5.0";function tg(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});let r={name:e8,automaticDataCollectionEnabled:!0,...t},i=r.name;if("string"!=typeof i||!i)throw tc.create("bad-app-name",{appName:String(i)});if(n||(n=J()),!n)throw tc.create("no-options");let s=e9.get(i);if(s)if(eC(n,s.options)&&eC(r,s.config))return s;else throw tc.create("duplicate-app",{appName:i});let o=new eU(i);for(let e of tt.values())o.addComponent(e);let a=new td(n,r,o);return e9.set(i,a),a}function ty(e,t={}){let n;if(("undefined"!=typeof window||eh())&&!eh())throw tc.create("invalid-server-app-environment");let r=t||{};if(e&&(ta(e)?n=e.options:tl(e)?r=e:n=e),void 0===r.automaticDataCollectionEnabled&&(r.automaticDataCollectionEnabled=!0),n||(n=J()),!n)throw tc.create("no-options");let i={...r,...n};if(void 0!==i.releaseOnDeref&&delete i.releaseOnDeref,void 0!==r.releaseOnDeref&&"undefined"==typeof FinalizationRegistry)throw tc.create("finalization-registry-not-supported",{});let s=""+[...JSON.stringify(i)].reduce((e,t)=>Math.imul(31,e)+t.charCodeAt(0)|0,0),o=te.get(s);if(o)return o.incRefCount(r.releaseOnDeref),o;let a=new eU(s);for(let e of tt.values())a.addComponent(e);let l=new tp(n,r,s,a);return te.set(s,l),l}function t_(e=e8){let t=e9.get(e);if(!t&&e===e8&&J())return tg();if(!t)throw tc.create("no-app",{appName:e});return t}function tv(){return Array.from(e9.values())}async function tw(e){let t=!1,n=e.name;e9.has(n)?(t=!0,e9.delete(n)):te.has(n)&&0>=e.decRefCount()&&(te.delete(n),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function tb(e,t,n){let r=e7[e]??e;n&&(r+=`-${n}`);let i=r.match(/\s|\//),s=t.match(/\s|\//);if(i||s){let e=[`Unable to register library "${r}" with version "${t}":`];i&&e.push(`library name "${r}" contains illegal characters (whitespace or "/")`),i&&s&&e.push("and"),s&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),e5.warn(e.join(" "));return}ti(new eL(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}function tE(e,t){if(null!==e&&"function"!=typeof e)throw tc.create("invalid-log-argument");for(let n of eV){let r=null;t&&t.level&&(r=ej[t.level]),null===e?n.userLogHandler=null:n.userLogHandler=(t,n,...i)=>{let s=i.map(e=>{if(null==e)return null;if("string"==typeof e)return e;if("number"==typeof e||"boolean"==typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(e){return null}}).filter(e=>e).join(" ");n>=(r??t.logLevel)&&e({level:b[n].toLowerCase(),message:s,args:i,type:t.name})}}}function tT(e){eV.forEach(t=>{t.setLogLevel(e)})}let tC="firebase-heartbeat-store",tI=null;function tS(){return tI||(tI=(function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){let o=indexedDB.open(e,1),a=eX(o);return r&&o.addEventListener("upgradeneeded",e=>{r(eX(o.result),e.oldVersion,e.newVersion,eX(o.transaction),e)}),n&&o.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),a.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(tC)}catch(e){console.warn(e)}}}).catch(e=>{throw tc.create("idb-open",{originalErrorMessage:e.message})})),tI}async function tk(e){try{let t=(await tS()).transaction(tC),n=await t.objectStore(tC).get(tN(e));return await t.done,n}catch(e){if(e instanceof ed)e5.warn(e.message);else{let t=tc.create("idb-get",{originalErrorMessage:e?.message});e5.warn(t.message)}}}async function tR(e,t){try{let n=(await tS()).transaction(tC,"readwrite"),r=n.objectStore(tC);await r.put(t,tN(e)),await n.done}catch(e){if(e instanceof ed)e5.warn(e.message);else{let t=tc.create("idb-set",{originalErrorMessage:e?.message});e5.warn(t.message)}}}function tN(e){return`${e.name}!${e.options.appId}`}class tA{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new tP(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{let e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=tx();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===t||this._heartbeatsCache.heartbeats.some(e=>e.date===t))return;if(this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats.length>30){let e=function(e){if(0===e.length)return -1;let t=0,n=e[0].date;for(let r=1;r<e.length;r++)e[r].date<n&&(n=e[r].date,t=r);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){e5.warn(e)}}async getHeartbeatsHeader(){try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||0===this._heartbeatsCache.heartbeats.length)return"";let e=tx(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){let n=[],r=e.slice();for(let i of e){let e=n.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),tD(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),tD(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),r=K(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return e5.warn(e),""}}}function tx(){return new Date().toISOString().substring(0,10)}class tP{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise((e,t)=>{try{let n=!0,r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{t(i.error?.message||"")}}catch(e){t(e)}}).then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await tk(this.app);return e?.heartbeats?e:{heartbeats:[]}}}async overwrite(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return tR(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){let t=await this.read();return tR(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??t.lastSentHeartbeatDate,heartbeats:[...t.heartbeats,...e.heartbeats]})}}}function tD(e){return K(JSON.stringify({version:2,heartbeats:e})).length}function tO(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}ti(new eL("platform-logger",e=>new e3(e),"PRIVATE")),ti(new eL("heartbeat",e=>new tA(e),"PRIVATE")),tb(e6,e4,""),tb(e6,e4,"esm2020"),tb("fire-js",""),e.s(["SDK_VERSION",()=>tm,"_DEFAULT_ENTRY_NAME",()=>e8,"_addComponent",()=>tn,"_addOrOverwriteComponent",()=>tr,"_apps",()=>e9,"_clearComponents",()=>tu,"_components",()=>tt,"_getProvider",()=>ts,"_isFirebaseApp",()=>ta,"_isFirebaseServerApp",()=>th,"_isFirebaseServerAppSettings",()=>tl,"_registerComponent",()=>ti,"_removeServiceInstance",()=>to,"_serverApps",()=>te,"deleteApp",()=>tw,"getApp",()=>t_,"getApps",()=>tv,"initializeApp",()=>tg,"initializeServerApp",()=>ty,"onLog",()=>tE,"registerVersion",()=>tb,"setLogLevel",()=>tT],92953);let tL=new ef("auth","Firebase",tO()),tM=new e$("@firebase/auth");function tF(e,...t){tM.logLevel<=b.ERROR&&tM.error(`Auth (${tm}): ${e}`,...t)}function tU(e,...t){throw tz(e,...t)}function tV(e,...t){return tz(e,...t)}function tj(e,t,n){return new ef("auth","Firebase",{...tO(),[t]:n}).create(t,{appName:e.name})}function tq(e){return tj(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function tz(e,...t){if("string"!=typeof e){let n=t[0],r=[...t.slice(1)];return r[0]&&(r[0].appName=e.name),e._errorFactory.create(n,...r)}return tL.create(e,...t)}function tB(e,t,...n){if(!e)throw tz(t,...n)}function t$(e){let t="INTERNAL ASSERTION FAILED: "+e;throw tF(t),Error(t)}function tW(){return"undefined"!=typeof self&&self.location?.href||""}function tH(){return"undefined"!=typeof self&&self.location?.protocol||null}class tK{constructor(e,t){var n;this.shortDelay=e,this.longDelay=t,n="Short delay should be less than long delay!",t>e||t$(n),this.isMobile=el()||eu()}get(){let e;return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===tH()||"https:"===tH()||"object"==typeof(e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==e.id||"connection"in navigator))||navigator.onLine?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function tG(e,t){var n,r;n=e.emulator,r="Emulator should always be set here",n||t$(r);let{url:i}=e.emulator;return t?`${i}${t.startsWith("/")?t.slice(1):t}`:i}class tQ{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void t$("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void t$("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void t$("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}let tY={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},tX=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],tJ=new tK(3e4,6e4);function tZ(e,t){return e.tenantId&&!t.tenantId?{...t,tenantId:e.tenantId}:t}async function t0(e,t,n,r,i={}){return t1(e,i,async()=>{let i={},s={};r&&("GET"===t?s=r:i={body:JSON.stringify(r)});let o=eS({key:e.config.apiKey,...s}).slice(1),a=await e._getAdditionalHeaders();a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode);let l={method:t,headers:a,...i};return("undefined"==typeof navigator||"Cloudflare-Workers"!==navigator.userAgent)&&(l.referrerPolicy="no-referrer"),e.emulatorConfig&&et(e.emulatorConfig.host)&&(l.credentials="include"),tQ.fetch()(await t3(e,e.config.apiHost,n,o),l)})}async function t1(e,t,n){e._canInitEmulator=!1;let r={...tY,...t};try{let t=new t6(e),i=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();let s=await i.json();if("needConfirmation"in s)throw t4(e,"account-exists-with-different-credential",s);if(i.ok&&!("errorMessage"in s))return s;{let[t,n]=(i.ok?s.errorMessage:s.error.message).split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===t)throw t4(e,"credential-already-in-use",s);if("EMAIL_EXISTS"===t)throw t4(e,"email-already-in-use",s);if("USER_DISABLED"===t)throw t4(e,"user-disabled",s);let o=r[t]||t.toLowerCase().replace(/[_\s]+/g,"-");if(n)throw tj(e,o,n);tU(e,o)}}catch(t){if(t instanceof ed)throw t;tU(e,"network-request-failed",{message:String(t)})}}async function t2(e,t,n,r,i={}){let s=await t0(e,t,n,r,i);return"mfaPendingCredential"in s&&tU(e,"multi-factor-auth-required",{_serverResponse:s}),s}async function t3(e,t,n,r){let i=`${t}${n}?${r}`,s=e.config.emulator?tG(e.config,i):`${e.config.apiScheme}://${i}`;return tX.includes(n)&&(await e._persistenceManagerAvailable,"COOKIE"===e._getPersistenceType())?e._getPersistence()._getFinalTarget(s).toString():s}class t6{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((e,t)=>{this.timer=setTimeout(()=>t(tV(this.auth,"network-request-failed")),tJ.get())})}}function t4(e,t,n){let r={appName:e.name};n.email&&(r.email=n.email),n.phoneNumber&&(r.phoneNumber=n.phoneNumber);let i=tV(e,t,r);return i.customData._tokenResponse=n,i}function t5(e){return void 0!==e&&void 0!==e.enterprise}class t8{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(let t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)switch(t.enforcementState){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function t7(e,t){return t0(e,"GET","/v2/recaptchaConfig",tZ(e,t))}async function t9(e,t){return t0(e,"POST","/v1/accounts:delete",t)}async function ne(e,t){return t0(e,"POST","/v1/accounts:lookup",t)}function nt(e){if(e)try{let t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}async function nn(e,t=!1){let n=eO(e),r=await n.getIdToken(t),i=ni(r);tB(i&&i.exp&&i.auth_time&&i.iat,n.auth,"internal-error");let s="object"==typeof i.firebase?i.firebase:void 0,o=s?.sign_in_provider;return{claims:i,token:r,authTime:nt(nr(i.auth_time)),issuedAtTime:nt(nr(i.iat)),expirationTime:nt(nr(i.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}}function nr(e){return 1e3*Number(e)}function ni(e){let[t,n,r]=e.split(".");if(void 0===t||void 0===n||void 0===r)return tF("JWT malformed, contained fewer than 3 sections"),null;try{let e=G(n);if(!e)return tF("Failed to decode base64 JWT payload"),null;return JSON.parse(e)}catch(e){return tF("Caught error parsing JWT payload as JSON",e?.toString()),null}}function ns(e){let t=ni(e);return tB(t,"internal-error"),tB(void 0!==t.exp,"internal-error"),tB(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function no(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof ed&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class na{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){if(!e)return this.errorBackoff=3e4,Math.max(0,(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5);{let e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class nl{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=nt(this.lastLoginAt),this.creationTime=nt(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function nh(e){var t,n;let r=e.auth,i=await e.getIdToken(),s=await no(e,ne(r,{idToken:i}));tB(s?.users.length,r,"internal-error");let o=s.users[0];e._notifyReloadListener(o);let a=o.providerUserInfo?.length?nc(o.providerUserInfo):[],l=(t=e.providerData,n=a,[...t.filter(e=>!n.some(t=>t.providerId===e.providerId)),...n]),h=e.isAnonymous,u=!(e.email&&o.passwordHash)&&!l?.length;Object.assign(e,{uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:l,metadata:new nl(o.createdAt,o.lastLoginAt),isAnonymous:!!h&&u})}async function nu(e){let t=eO(e);await nh(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function nc(e){return e.map(({providerId:e,...t})=>({providerId:e,uid:t.rawId||"",displayName:t.displayName||null,email:t.email||null,phoneNumber:t.phoneNumber||null,photoURL:t.photoUrl||null}))}async function nd(e,t){let n=await t1(e,{},async()=>{let n=eS({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:r,apiKey:i}=e.config,s=await t3(e,r,"/v1/token",`key=${i}`),o=await e._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";let a={method:"POST",headers:o,body:n};return e.emulatorConfig&&et(e.emulatorConfig.host)&&(a.credentials="include"),tQ.fetch()(s,a)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function nf(e,t){return t0(e,"POST","/v2/accounts:revokeToken",tZ(e,t))}class np{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){tB(e.idToken,"internal-error"),tB(void 0!==e.idToken,"internal-error"),tB(void 0!==e.refreshToken,"internal-error");let t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):ns(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){tB(0!==e.length,"internal-error");let t=ns(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(tB(this.refreshToken,e,"user-token-expired"),this.refreshToken)?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){let{accessToken:n,refreshToken:r,expiresIn:i}=await nd(e,t);this.updateTokensAndExpiration(n,r,Number(i))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){let{refreshToken:n,accessToken:r,expirationTime:i}=t,s=new np;return n&&(tB("string"==typeof n,"internal-error",{appName:e}),s.refreshToken=n),r&&(tB("string"==typeof r,"internal-error",{appName:e}),s.accessToken=r),i&&(tB("number"==typeof i,"internal-error",{appName:e}),s.expirationTime=i),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new np,this.toJSON())}_performRefresh(){return t$("not implemented")}}function nm(e,t){tB("string"==typeof e||void 0===e,"internal-error",{appName:t})}class ng{constructor({uid:e,auth:t,stsTokenManager:n,...r}){this.providerId="firebase",this.proactiveRefresh=new na(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=t,this.stsTokenManager=n,this.accessToken=n.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new nl(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(e){let t=await no(this,this.stsTokenManager.getToken(this.auth,e));return tB(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return nn(this,e)}reload(){return nu(this)}_assign(e){this!==e&&(tB(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(e=>({...e})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new ng({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return t.metadata._copy(this.metadata),t}_onReload(e){tB(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await nh(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(th(this.auth.app))return Promise.reject(tq(this.auth));let e=await this.getIdToken();return await no(this,t9(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){let n=t.displayName??void 0,r=t.email??void 0,i=t.phoneNumber??void 0,s=t.photoURL??void 0,o=t.tenantId??void 0,a=t._redirectEventId??void 0,l=t.createdAt??void 0,h=t.lastLoginAt??void 0,{uid:u,emailVerified:c,isAnonymous:d,providerData:f,stsTokenManager:p}=t;tB(u&&p,e,"internal-error");let m=np.fromJSON(this.name,p);tB("string"==typeof u,e,"internal-error"),nm(n,e.name),nm(r,e.name),tB("boolean"==typeof c,e,"internal-error"),tB("boolean"==typeof d,e,"internal-error"),nm(i,e.name),nm(s,e.name),nm(o,e.name),nm(a,e.name),nm(l,e.name),nm(h,e.name);let g=new ng({uid:u,auth:e,email:r,emailVerified:c,displayName:n,isAnonymous:d,photoURL:s,phoneNumber:i,tenantId:o,stsTokenManager:m,createdAt:l,lastLoginAt:h});return f&&Array.isArray(f)&&(g.providerData=f.map(e=>({...e}))),a&&(g._redirectEventId=a),g}static async _fromIdTokenResponse(e,t,n=!1){let r=new np;r.updateFromServerResponse(t);let i=new ng({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:n});return await nh(i),i}static async _fromGetAccountInfoResponse(e,t,n){let r=t.users[0];tB(void 0!==r.localId,"internal-error");let i=void 0!==r.providerUserInfo?nc(r.providerUserInfo):[],s=!(r.email&&r.passwordHash)&&!i?.length,o=new np;o.updateFromIdToken(n);let a=new ng({uid:r.localId,auth:e,stsTokenManager:o,isAnonymous:s});return Object.assign(a,{uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:i,metadata:new nl(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!i?.length}),a}}let ny=new Map;function n_(e){var t,n;t="Expected a class definition",e instanceof Function||t$(t);let r=ny.get(e);return r?(n="Instance stored in cache mismatched with class",r instanceof e||t$(n)):(r=new e,ny.set(e,r)),r}class nv{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){let t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}function nw(e,t,n){return`firebase:${e}:${t}:${n}`}nv.type="NONE";class nb{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:r,name:i}=this.auth;this.fullUserKey=nw(this.userKey,r.apiKey,i),this.fullPersistenceKey=nw("persistence",r.apiKey,i),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){let e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){let t=await ne(this.auth,{idToken:e}).catch(()=>void 0);return t?ng._fromGetAccountInfoResponse(this.auth,t,e):null}return ng._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;let t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new nb(n_(nv),e,n);let r=(await Promise.all(t.map(async e=>{if(await e._isAvailable())return e}))).filter(e=>e),i=r[0]||n_(nv),s=nw(n,e.config.apiKey,e.name),o=null;for(let n of t)try{let t=await n._get(s);if(t){let r;if("string"==typeof t){let n=await ne(e,{idToken:t}).catch(()=>void 0);if(!n)break;r=await ng._fromGetAccountInfoResponse(e,n,t)}else r=ng._fromJSON(e,t);n!==i&&(o=r),i=n;break}}catch{}let a=r.filter(e=>e._shouldAllowMigration);return i._shouldAllowMigration&&a.length&&(i=a[0],o&&await i._set(s,o.toJSON()),await Promise.all(t.map(async e=>{if(e!==i)try{await e._remove(s)}catch{}}))),new nb(i,e,n)}}function nE(e){let t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";{if(nS(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(nT(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(nR(t))return"Blackberry";if(nN(t))return"Webos";if(nC(t))return"Safari";if((t.includes("chrome/")||nI(t))&&!t.includes("edge/"))return"Chrome";if(nk(t))return"Android";let n=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(n?.length===2)return n[1]}return"Other"}function nT(e=ea()){return/firefox\//i.test(e)}function nC(e=ea()){let t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function nI(e=ea()){return/crios\//i.test(e)}function nS(e=ea()){return/iemobile/i.test(e)}function nk(e=ea()){return/android/i.test(e)}function nR(e=ea()){return/blackberry/i.test(e)}function nN(e=ea()){return/webos/i.test(e)}function nA(e=ea()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function nx(e=ea()){return nA(e)||nk(e)||nN(e)||nR(e)||/windows phone/i.test(e)||nS(e)}function nP(e,t=[]){let n;switch(e){case"Browser":n=nE(ea());break;case"Worker":n=`${nE(ea())}-${e}`;break;default:n=e}let r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${tm}/${r}`}class nD{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let n=t=>new Promise((n,r)=>{try{let r=e(t);n(r)}catch(e){r(e)}});n.onAbort=t,this.queue.push(n);let r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;let t=[];try{for(let n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){for(let e of(t.reverse(),t))try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:e?.message})}}}async function nO(e,t={}){return t0(e,"GET","/v2/passwordPolicy",tZ(e,t))}class nL{constructor(e){const t=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=t.minPasswordLength??6,t.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=t.maxPasswordLength),void 0!==t.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=t.containsLowercaseCharacter),void 0!==t.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=t.containsUppercaseCharacter),void 0!==t.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=t.containsNumericCharacter),void 0!==t.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=t.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){let t={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,t),this.validatePasswordCharacterOptions(e,t),t.isValid&&(t.isValid=t.meetsMinPasswordLength??!0),t.isValid&&(t.isValid=t.meetsMaxPasswordLength??!0),t.isValid&&(t.isValid=t.containsLowercaseLetter??!0),t.isValid&&(t.isValid=t.containsUppercaseLetter??!0),t.isValid&&(t.isValid=t.containsNumericCharacter??!0),t.isValid&&(t.isValid=t.containsNonAlphanumericCharacter??!0),t}validatePasswordLengthOptions(e,t){let n=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let r=0;r<e.length;r++)n=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,r,i){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=i))}}class nM{constructor(e,t,n,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new nF(this),this.idTokenSubscription=new nF(this),this.beforeStateQueue=new nD(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=tL,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(e=>this._resolvePersistenceManagerAvailable=e)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=n_(t)),this._initializationPromise=this.queue(async()=>{if(!this._deleted){if(this.persistenceManager=await nb.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=this.currentUser?.uid||null,this._deleted||(this._isInitialized=!0)}}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;let e=await this.assertedPersistence.getCurrentUser();if(this.currentUser||e){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{let t=await ne(this,{idToken:e}),n=await ng._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(th(this.app)){let e=this.app.settings.authIdToken;return e?new Promise(t=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(e).then(t,t))}):this.directlySetCurrentUser(null)}let t=await this.assertedPersistence.getCurrentUser(),n=t,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();let t=this.redirectUser?._redirectEventId,i=n?._redirectEventId,s=await this.tryRedirectSignIn(e);(!t||t===i)&&s?.user&&(n=s.user,r=!0)}if(!n)return this.directlySetCurrentUser(null);if(!n._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(n)}catch(e){n=t,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(e))}return n?this.reloadAndSetCurrentUserOrClear(n):this.directlySetCurrentUser(null)}return(tB(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===n._redirectEventId)?this.directlySetCurrentUser(n):this.reloadAndSetCurrentUserOrClear(n)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await nh(e)}catch(e){if(e?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;let e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(th(this.app))return Promise.reject(tq(this));let t=e?eO(e):null;return t&&tB(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&tB(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return th(this.app)?Promise.reject(tq(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return th(this.app)?Promise.reject(tq(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(n_(e))})}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){let e=new nL(await nO(this));null===this.tenantId?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new ef("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let n=this.onAuthStateChanged(()=>{n(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){let t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await nf(this,t)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,t){let n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){let t=e&&n_(e)||this._popupRedirectResolver;tB(t,this,"argument-error"),this.redirectPersistenceManager=await nb.create(this,[n_(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return(this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e)?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,r){if(this._deleted)return()=>{};let i="function"==typeof t?t:t.next.bind(t),s=!1,o=this._isInitialized?Promise.resolve():this._initializationPromise;if(tB(o,this,"internal-error"),o.then(()=>{s||i(this.currentUser)}),"function"==typeof t){let i=e.addObserver(t,n,r);return()=>{s=!0,i()}}{let n=e.addObserver(t);return()=>{s=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return tB(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=nP(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){let e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);let t=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();t&&(e["X-Firebase-Client"]=t);let n=await this._getAppCheckToken();return n&&(e["X-Firebase-AppCheck"]=n),e}async _getAppCheckToken(){if(th(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&function(e,...t){tM.logLevel<=b.WARN&&tM.warn(`Auth (${tm}): ${e}`,...t)}(`Error while retrieving App Check token: ${e.error}`),e?.token}}class nF{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){let n=new eA(e,void 0);return n.subscribe.bind(n)}(e=>this.observer=e)}get next(){return tB(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let nU={async loadJS(){throw Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function nV(e){return`__${e}${Math.floor(1e6*Math.random())}`}class nj{constructor(){this.enterprise=new nq}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class nq{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}let nz="NO_RECAPTCHA";class nB{constructor(e){this.type="recaptcha-enterprise",this.auth=eO(e)}async verify(e="verify",t=!1){async function n(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise(async(t,n)=>{t7(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(r=>{if(void 0===r.recaptchaKey)n(Error("recaptcha Enterprise site key undefined"));else{let n=new t8(r);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}}).catch(e=>{n(e)})})}function r(t,n,r){let i=window.grecaptcha;t5(i)?i.enterprise.ready(()=>{i.enterprise.execute(t,{action:e}).then(e=>{n(e)}).catch(()=>{n(nz)})}):r(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new nj().execute("siteKey",{action:"verify"}):new Promise((e,i)=>{n(this.auth).then(n=>{if(!t&&t5(window.grecaptcha))r(n,e,i);else{var s;if("undefined"==typeof window)return void i(Error("RecaptchaVerifier is only supported in browser"));let t=nU.recaptchaEnterpriseScript;0!==t.length&&(t+=n),(s=t,nU.loadJS(s)).then(()=>{r(n,e,i)}).catch(e=>{i(e)})}}).catch(e=>{i(e)})})}}async function n$(e,t,n,r=!1,i=!1){let s,o=new nB(e);if(i)s=nz;else try{s=await o.verify(n)}catch(e){s=await o.verify(n,!0)}let a={...t};if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in a){let e=a.phoneEnrollmentInfo.phoneNumber,t=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){let e=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return r?Object.assign(a,{captchaResp:s}):Object.assign(a,{captchaResponse:s}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function nW(e,t,n,r,i){if("EMAIL_PASSWORD_PROVIDER"===i)if(!e._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER"))return r(e,t).catch(async i=>{if("auth/missing-recaptcha-token"!==i.code)return Promise.reject(i);{console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);let i=await n$(e,t,n,"getOobCode"===n);return r(e,i)}});else{let i=await n$(e,t,n,"getOobCode"===n);return r(e,i)}if("PHONE_PROVIDER"!==i)return Promise.reject(i+" provider is not supported.");if(e._getRecaptchaConfig()?.isProviderEnabled("PHONE_PROVIDER")){let i=await n$(e,t,n);return r(e,i).catch(async i=>{if(e._getRecaptchaConfig()?.getProviderEnforcementState("PHONE_PROVIDER")==="AUDIT"&&("auth/missing-recaptcha-token"===i.code||"auth/invalid-app-credential"===i.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${n} flow.`);let i=await n$(e,t,n,!1,!0);return r(e,i)}return Promise.reject(i)})}{let i=await n$(e,t,n,!1,!0);return r(e,i)}}async function nH(e){let t=eO(e),n=new t8(await t7(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}));null==t.tenantId?t._agentRecaptchaConfig=n:t._tenantRecaptchaConfigs[t.tenantId]=n,n.isAnyProviderEnabled()&&new nB(t).verify()}function nK(e){let t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function nG(e){if(!e)return null;let t=Number(e);return isNaN(t)?null:t}class nQ{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return t$("not implemented")}_getIdTokenResponse(e){return t$("not implemented")}_linkToIdToken(e,t){return t$("not implemented")}_getReauthenticationResolver(e){return t$("not implemented")}}async function nY(e,t){return t0(e,"POST","/v1/accounts:signUp",t)}async function nX(e,t){return t2(e,"POST","/v1/accounts:signInWithPassword",tZ(e,t))}async function nJ(e,t){return t2(e,"POST","/v1/accounts:signInWithEmailLink",tZ(e,t))}async function nZ(e,t){return t2(e,"POST","/v1/accounts:signInWithEmailLink",tZ(e,t))}class n0 extends nQ{constructor(e,t,n,r=null){super("password",n),this._email=e,this._password=t,this._tenantId=r}static _fromEmailAndPassword(e,t){return new n0(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new n0(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){let t="string"==typeof e?JSON.parse(e):e;if(t?.email&&t?.password){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);else if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return nW(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",nX,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return nJ(e,{email:this._email,oobCode:this._password});default:tU(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return nW(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",nY,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return nZ(e,{idToken:t,email:this._email,oobCode:this._password});default:tU(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function n1(e,t){return t2(e,"POST","/v1/accounts:signInWithIdp",tZ(e,t))}class n2 extends nQ{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){let t=new n2(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):tU("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){let{providerId:t,signInMethod:n,...r}="string"==typeof e?JSON.parse(e):e;if(!t||!n)return null;let i=new n2(t,n);return i.idToken=r.idToken||void 0,i.accessToken=r.accessToken||void 0,i.secret=r.secret,i.nonce=r.nonce,i.pendingToken=r.pendingToken||null,i}_getIdTokenResponse(e){return n1(e,this.buildRequest())}_linkToIdToken(e,t){let n=this.buildRequest();return n.idToken=t,n1(e,n)}_getReauthenticationResolver(e){let t=this.buildRequest();return t.autoCreate=!1,n1(e,t)}buildRequest(){let e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{let t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=eS(t)}return e}}async function n3(e,t){return t0(e,"POST","/v1/accounts:sendVerificationCode",tZ(e,t))}async function n6(e,t){return t2(e,"POST","/v1/accounts:signInWithPhoneNumber",tZ(e,t))}async function n4(e,t){let n=await t2(e,"POST","/v1/accounts:signInWithPhoneNumber",tZ(e,t));if(n.temporaryProof)throw t4(e,"account-exists-with-different-credential",n);return n}let n5={USER_NOT_FOUND:"user-not-found"};async function n8(e,t){return t2(e,"POST","/v1/accounts:signInWithPhoneNumber",tZ(e,{...t,operation:"REAUTH"}),n5)}class n7 extends nQ{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new n7({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new n7({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return n6(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return n4(e,{idToken:t,...this._makeVerificationRequest()})}_getReauthenticationResolver(e){return n8(e,this._makeVerificationRequest())}_makeVerificationRequest(){let{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:r}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:r}}toJSON(){let e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));let{verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}=e;return n||t||r||i?new n7({verificationId:t,verificationCode:n,phoneNumber:r,temporaryProof:i}):null}}class n9{constructor(e){const t=ek(eR(e)),n=t.apiKey??null,r=t.oobCode??null,i=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(t.mode??null);tB(n&&r&&i,"argument-error"),this.apiKey=n,this.operation=i,this.code=r,this.continueUrl=t.continueUrl??null,this.languageCode=t.lang??null,this.tenantId=t.tenantId??null}static parseLink(e){let t,n,r,i=(n=(t=ek(eR(e)).link)?ek(eR(t)).deep_link_id:null,((r=ek(eR(e)).deep_link_id)?ek(eR(r)).link:null)||r||n||t||e);try{return new n9(i)}catch{return null}}}class re{constructor(){this.providerId=re.PROVIDER_ID}static credential(e,t){return n0._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){let n=n9.parseLink(t);return tB(n,"argument-error"),n0._fromEmailAndCode(e,n.code,n.tenantId)}}re.PROVIDER_ID="password",re.EMAIL_PASSWORD_SIGN_IN_METHOD="password",re.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class rt{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class rn extends rt{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class rr extends rn{constructor(){super("facebook.com")}static credential(e){return n2._fromParams({providerId:rr.PROVIDER_ID,signInMethod:rr.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return rr.credentialFromTaggedObject(e)}static credentialFromError(e){return rr.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return rr.credential(e.oauthAccessToken)}catch{return null}}}rr.FACEBOOK_SIGN_IN_METHOD="facebook.com",rr.PROVIDER_ID="facebook.com";class ri extends rn{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return n2._fromParams({providerId:ri.PROVIDER_ID,signInMethod:ri.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return ri.credentialFromTaggedObject(e)}static credentialFromError(e){return ri.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return ri.credential(t,n)}catch{return null}}}ri.GOOGLE_SIGN_IN_METHOD="google.com",ri.PROVIDER_ID="google.com";class rs extends rn{constructor(){super("github.com")}static credential(e){return n2._fromParams({providerId:rs.PROVIDER_ID,signInMethod:rs.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return rs.credentialFromTaggedObject(e)}static credentialFromError(e){return rs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return rs.credential(e.oauthAccessToken)}catch{return null}}}rs.GITHUB_SIGN_IN_METHOD="github.com",rs.PROVIDER_ID="github.com";class ro extends rn{constructor(){super("twitter.com")}static credential(e,t){return n2._fromParams({providerId:ro.PROVIDER_ID,signInMethod:ro.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return ro.credentialFromTaggedObject(e)}static credentialFromError(e){return ro.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return ro.credential(t,n)}catch{return null}}}async function ra(e,t){return t2(e,"POST","/v1/accounts:signUp",tZ(e,t))}ro.TWITTER_SIGN_IN_METHOD="twitter.com",ro.PROVIDER_ID="twitter.com";class rl{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,r=!1){return new rl({user:await ng._fromIdTokenResponse(e,n,r),providerId:rh(n),_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){return await e._updateTokensIfNecessary(n,!0),new rl({user:e,providerId:rh(n),_tokenResponse:n,operationType:t})}}function rh(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class ru extends ed{constructor(e,t,n,r){super(t.code,t.message),this.operationType=n,this.user=r,Object.setPrototypeOf(this,ru.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,r){return new ru(e,t,n,r)}}function rc(e,t,n,r){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch(n=>{if("auth/multi-factor-auth-required"===n.code)throw ru._fromErrorAndOperation(e,n,t,r);throw n})}async function rd(e,t,n=!1){let r=await no(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return rl._forOperation(e,"link",r)}async function rf(e,t,n=!1){let{auth:r}=e;if(th(r.app))return Promise.reject(tq(r));let i="reauthenticate";try{let s=await no(e,rc(r,i,t,e),n);tB(s.idToken,r,"internal-error");let o=ni(s.idToken);tB(o,r,"internal-error");let{sub:a}=o;return tB(e.uid===a,r,"user-mismatch"),rl._forOperation(e,i,s)}catch(e){throw e?.code==="auth/user-not-found"&&tU(r,"user-mismatch"),e}}async function rp(e,t,n=!1){if(th(e.app))return Promise.reject(tq(e));let r="signIn",i=await rc(e,r,t),s=await rl._fromIdTokenResponse(e,r,i);return n||await e._updateCurrentUser(s.user),s}async function rm(e,t){return rp(eO(e),t)}class rg{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?ry._fromServerResponse(e,t):"totpInfo"in t?r_._fromServerResponse(e,t):tU(e,"internal-error")}}class ry extends rg{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new ry(t)}}class r_ extends rg{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new r_(t)}}async function rv(e){let t=eO(e);t._getPasswordPolicyInternal()&&await t._updatePasswordPolicy()}async function rw(e,t,n){if(th(e.app))return Promise.reject(tq(e));let r=eO(e),i=nW(r,{returnSecureToken:!0,email:t,password:n,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",ra,"EMAIL_PASSWORD_PROVIDER"),s=await i.catch(t=>{throw"auth/password-does-not-meet-requirements"===t.code&&rv(e),t}),o=await rl._fromIdTokenResponse(r,"signIn",s);return await r._updateCurrentUser(o.user),o}function rb(e,t,n){return th(e.app)?Promise.reject(tq(e)):rm(eO(e),re.credential(t,n)).catch(async t=>{throw"auth/password-does-not-meet-requirements"===t.code&&rv(e),t})}function rE(e,t){return eO(e).setPersistence(t)}function rT(e,t,n,r){return eO(e).onAuthStateChanged(t,n,r)}function rC(e){return eO(e).signOut()}function rI(e,t){return t0(e,"POST","/v2/accounts/mfaEnrollment:start",tZ(e,t))}new WeakMap;let rS="__sak";class rk{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{if(!this.storage)return Promise.resolve(!1);return this.storage.setItem(rS,"1"),this.storage.removeItem(rS),Promise.resolve(!0)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){let t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class rR extends rk{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=nx(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(let t of Object.keys(this.listeners)){let n=this.storage.getItem(t),r=this.localCache[t];n!==r&&e(t,r,n)}}onStorageEvent(e,t=!1){let n;if(!e.key)return void this.forAllChangedKeys((e,t,n)=>{this.notifyListeners(e,n)});let r=e.key;t?this.detachListener():this.stopPolling();let i=()=>{let e=this.storage.getItem(r);(t||this.localCache[r]!==e)&&this.notifyListeners(r,e)},s=this.storage.getItem(r);((n=ea()).indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0)&&10===document.documentMode&&s!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,10):i()}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){let t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}rR.type="LOCAL";class rN extends rk{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}rN.type="SESSION";class rA{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){let t=this.receivers.find(t=>t.isListeningto(e));if(t)return t;let n=new rA(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){let{eventId:t,eventType:n,data:r}=e.data,i=this.handlersMap[n];if(!i?.size)return;e.ports[0].postMessage({status:"ack",eventId:t,eventType:n});let s=Array.from(i).map(async t=>t(e.origin,r)),o=await Promise.all(s.map(async e=>{try{let t=await e;return{fulfilled:!0,value:t}}catch(e){return{fulfilled:!1,reason:e}}}));e.ports[0].postMessage({status:"done",eventId:t,eventType:n,response:o})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function rx(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}rA.receivers=[];class rP{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){let r,i,s="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!s)throw Error("connection_unavailable");return new Promise((o,a)=>{let l=rx("",20);s.port1.start();let h=setTimeout(()=>{a(Error("unsupported_event"))},n);i={messageChannel:s,onMessage(e){if(e.data.eventId===l)switch(e.data.status){case"ack":clearTimeout(h),r=setTimeout(()=>{a(Error("timeout"))},3e3);break;case"done":clearTimeout(r),o(e.data.response);break;default:clearTimeout(h),clearTimeout(r),a(Error("invalid_response"))}}},this.handlers.add(i),s.port1.addEventListener("message",i.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[s.port2])}).finally(()=>{i&&this.removeMessageHandler(i)})}}function rD(){return window}function rO(){return void 0!==rD().WorkerGlobalScope&&"function"==typeof rD().importScripts}async function rL(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}let rM="firebaseLocalStorageDb",rF="firebaseLocalStorage",rU="fbase_key";class rV{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function rj(e,t){return e.transaction([rF],t?"readwrite":"readonly").objectStore(rF)}function rq(){let e=indexedDB.open(rM,1);return new Promise((t,n)=>{e.addEventListener("error",()=>{n(e.error)}),e.addEventListener("upgradeneeded",()=>{let t=e.result;try{t.createObjectStore(rF,{keyPath:rU})}catch(e){n(e)}}),e.addEventListener("success",async()=>{let n=e.result;n.objectStoreNames.contains(rF)?t(n):(n.close(),await new rV(indexedDB.deleteDatabase(rM)).toPromise(),t(await rq()))})})}async function rz(e,t,n){return new rV(rj(e,!0).put({[rU]:t,value:n})).toPromise()}async function rB(e,t){let n=rj(e,!1).get(t),r=await new rV(n).toPromise();return void 0===r?null:r.value}function r$(e,t){return new rV(rj(e,!0).delete(t)).toPromise()}class rW{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db||(this.db=await rq()),this.db}async _withRetries(e){let t=0;for(;;)try{let t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return rO()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=rA._getInstance(rO()?self:null),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await rL(),!this.activeServiceWorker)return;this.sender=new rP(this.activeServiceWorker);let e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(this.sender&&this.activeServiceWorker&&(navigator?.serviceWorker?.controller||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;let e=await rq();return await rz(e,rS,"1"),await r$(e,rS),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(n=>rz(n,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){let t=await this._withRetries(t=>rB(t,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>r$(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){let e=await this._withRetries(e=>new rV(rj(e,!1).getAll()).toPromise());if(!e||0!==this.pendingWrites)return[];let t=[],n=new Set;if(0!==e.length)for(let{fbase_key:r,value:i}of e)n.add(r),JSON.stringify(this.localCache[r])!==JSON.stringify(i)&&(this.notifyListeners(r,i),t.push(r));for(let e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;let n=this.listeners[e];if(n)for(let e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}function rH(e,t){return t0(e,"POST","/v2/accounts/mfaSignIn:start",tZ(e,t))}rW.type="LOCAL",nV("rcb"),new tK(3e4,6e4);let rK="recaptcha";async function rG(e,t,n){if(!e._getRecaptchaConfig())try{await nH(e)}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let r;if(r="string"==typeof t?{phoneNumber:t}:t,"session"in r){let t=r.session;if("phoneNumber"in r){tB("enroll"===t.type,e,"internal-error");let i={idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:r.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},s=async(e,t)=>{if(t.phoneEnrollmentInfo.captchaResponse===nz){tB(n?.type===rK,e,"argument-error");let r=await rQ(e,t,n);return rI(e,r)}return rI(e,t)},o=nW(e,i,"mfaSmsEnrollment",s,"PHONE_PROVIDER");return(await o.catch(e=>Promise.reject(e))).phoneSessionInfo.sessionInfo}{tB("signin"===t.type,e,"internal-error");let i=r.multiFactorHint?.uid||r.multiFactorUid;tB(i,e,"missing-multi-factor-info");let s={mfaPendingCredential:t.credential,mfaEnrollmentId:i,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},o=async(e,t)=>{if(t.phoneSignInInfo.captchaResponse===nz){tB(n?.type===rK,e,"argument-error");let r=await rQ(e,t,n);return rH(e,r)}return rH(e,t)},a=nW(e,s,"mfaSmsSignIn",o,"PHONE_PROVIDER");return(await a.catch(e=>Promise.reject(e))).phoneResponseInfo.sessionInfo}}{let t={phoneNumber:r.phoneNumber,clientType:"CLIENT_TYPE_WEB"},i=async(e,t)=>{if(t.captchaResponse===nz){tB(n?.type===rK,e,"argument-error");let r=await rQ(e,t,n);return n3(e,r)}return n3(e,t)},s=nW(e,t,"sendVerificationCode",i,"PHONE_PROVIDER");return(await s.catch(e=>Promise.reject(e))).sessionInfo}}finally{n?._reset()}}async function rQ(e,t,n){tB(n.type===rK,e,"argument-error");let r=await n.verify();tB("string"==typeof r,e,"argument-error");let i={...t};if("phoneEnrollmentInfo"in i){let e=i.phoneEnrollmentInfo.phoneNumber,t=i.phoneEnrollmentInfo.captchaResponse,n=i.phoneEnrollmentInfo.clientType,s=i.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(i,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:r,captchaResponse:t,clientType:n,recaptchaVersion:s}}),i}if(!("phoneSignInInfo"in i))return Object.assign(i,{recaptchaToken:r}),i;{let e=i.phoneSignInInfo.captchaResponse,t=i.phoneSignInInfo.clientType,n=i.phoneSignInInfo.recaptchaVersion;return Object.assign(i,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:e,clientType:t,recaptchaVersion:n}}),i}}class rY{constructor(e){this.providerId=rY.PROVIDER_ID,this.auth=eO(e)}verifyPhoneNumber(e,t){return rG(this.auth,e,eO(t))}static credential(e,t){return n7._fromVerification(e,t)}static credentialFromResult(e){return rY.credentialFromTaggedObject(e)}static credentialFromError(e){return rY.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;let{phoneNumber:t,temporaryProof:n}=e;return t&&n?n7._fromTokenResponse(t,n):null}}function rX(e,t){return t?n_(t):(tB(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}rY.PROVIDER_ID="phone",rY.PHONE_SIGN_IN_METHOD="phone";class rJ extends nQ{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return n1(e,this._buildIdpRequest())}_linkToIdToken(e,t){return n1(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return n1(e,this._buildIdpRequest())}_buildIdpRequest(e){let t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function rZ(e){return rp(e.auth,new rJ(e),e.bypassAuthState)}function r0(e){let{auth:t,user:n}=e;return tB(n,t,"internal-error"),rf(n,new rJ(e),e.bypassAuthState)}async function r1(e){let{auth:t,user:n}=e;return tB(n,t,"internal-error"),rd(n,new rJ(e),e.bypassAuthState)}class r2{constructor(e,t,n,r,i=!1){this.auth=e,this.resolver=n,this.user=r,this.bypassAuthState=i,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}})}async onAuthEvent(e){let{urlResponse:t,sessionId:n,postBody:r,tenantId:i,error:s,type:o}=e;if(s)return void this.reject(s);let a={auth:this.auth,requestUri:t,sessionId:n,tenantId:i||void 0,postBody:r||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return rZ;case"linkViaPopup":case"linkViaRedirect":return r1;case"reauthViaPopup":case"reauthViaRedirect":return r0;default:tU(this.auth,"internal-error")}}resolve(e){var t,n;t=this.pendingPromise,n="Pending promise was never set",t||t$(n),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){var t,n;t=this.pendingPromise,n="Pending promise was never set",t||t$(n),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}let r3=new tK(2e3,1e4);async function r6(e,t,n){if(th(e.app))return Promise.reject(tV(e,"operation-not-supported-in-this-environment"));let r=eO(e);if(!(t instanceof rt))throw rt.name!==t.constructor.name&&tU(e,"argument-error"),tj(e,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`);let i=rX(r,n);return new r4(r,"signInViaPopup",t,i).executeNotNull()}class r4 extends r2{constructor(e,t,n,r,i){super(e,t,r,i),this.provider=n,this.authWindow=null,this.pollId=null,r4.currentPopupAction&&r4.currentPopupAction.cancel(),r4.currentPopupAction=this}async executeNotNull(){let e=await this.execute();return tB(e,this.auth,"internal-error"),e}async onExecution(){var e,t;e=1===this.filter.length,t="Popup operations only handle one event",e||t$(t);let n=rx();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],n),this.authWindow.associatedEvent=n,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(tV(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(tV(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,r4.currentPopupAction=null}pollUserCancellation(){let e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(tV(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,r3.get())};e()}}r4.currentPopupAction=null;let r5=new Map;class r8 extends r2{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=r5.get(this.auth._key());if(!e){try{let t=await r7(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}r5.set(this.auth._key(),e)}return this.bypassAuthState||r5.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"===e.type)return void this.resolve(null);if(e.eventId){let t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function r7(e,t){var n;let r=nw("pendingRedirect",(n=t).config.apiKey,n.name),i=n_(e._redirectPersistence);if(!await i._isAvailable())return!1;let s=await i._get(r)==="true";return await i._remove(r),s}function r9(e,t){r5.set(e._key(),t)}async function ie(e,t,n=!1){if(th(e.app))return Promise.reject(tq(e));let r=eO(e),i=rX(r,t),s=new r8(r,i,n),o=await s.execute();return o&&!n&&(delete o.user._redirectEventId,await r._persistUserIfCurrent(o.user),await r._setRedirectUser(null,t)),o}class it{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ii(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){if(e.error&&!ii(e)){let n=e.error.code?.split("auth/")[1]||"internal-error";t.onError(tV(this.auth,n))}else t.onAuthEvent(e)}isEventForConsumer(e,t){let n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(ir(e))}saveEventToCache(e){this.cachedEventUids.add(ir(e)),this.lastProcessedEventTime=Date.now()}}function ir(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter(e=>e).join("-")}function ii({type:e,error:t}){return"unknown"===e&&t?.code==="auth/no-auth-event"}async function is(e,t={}){return t0(e,"GET","/v1/projects",t)}let io=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,ia=/^https?/;async function il(e){if(e.config.emulator)return;let{authorizedDomains:t}=await is(e);for(let e of t)try{if(function(e){let t=tW(),{protocol:n,hostname:r}=new URL(t);if(e.startsWith("chrome-extension://")){let i=new URL(e);return""===i.hostname&&""===r?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&i.hostname===r}if(!ia.test(n))return!1;if(io.test(e))return r===e;let i=e.replace(/\./g,"\\.");return RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}(e))return}catch{}tU(e,"unauthorized-domain")}let ih=new tK(3e4,6e4);function iu(){let e=rD().___jsl;if(e?.H){for(let t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}}let ic=null,id=new tK(5e3,15e3),ip={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},im=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);async function ig(e){let t,n,r,i,s,o=await (ic=ic||new Promise((t,n)=>{function r(){iu(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{iu(),n(tV(e,"network-request-failed"))},timeout:ih.get()})}if(rD().gapi?.iframes?.Iframe)t(gapi.iframes.getContext());else if(rD().gapi?.load)r();else{var i;let t=nV("iframefcb");return rD()[t]=()=>{gapi.load?r():n(tV(e,"network-request-failed"))},(i=`${nU.gapiScript}?onload=${t}`,nU.loadJS(i)).catch(e=>n(e))}}).catch(e=>{throw ic=null,e})),a=rD().gapi;return tB(a,e,"internal-error"),o.open({where:document.body,url:(tB((t=e.config).authDomain,e,"auth-domain-config-required"),n=t.emulator?tG(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:tm},(i=im.get(e.config.apiHost))&&(r.eid=i),(s=e._getFrameworks()).length&&(r.fw=s.join(",")),`${n}?${eS(r).slice(1)}`),messageHandlersFilter:a.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:ip,dontclear:!0},t=>new Promise(async(n,r)=>{await t.restyle({setHideOnLeave:!1});let i=tV(e,"network-request-failed"),s=rD().setTimeout(()=>{r(i)},id.get());function o(){rD().clearTimeout(s),n(t)}t.ping(o).then(o,()=>{r(i)})}))}let iy={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class i_{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}let iv=encodeURIComponent("fac");async function iw(e,t,n,r,i,s){tB(e.config.authDomain,e,"auth-domain-config-required"),tB(e.config.apiKey,e,"invalid-api-key");let o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:tm,eventId:i};if(t instanceof rt)for(let[n,r]of(t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",eE(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters())),Object.entries(s||{})))o[n]=r;if(t instanceof rn){let e=t.getScopes().filter(e=>""!==e);e.length>0&&(o.scopes=e.join(","))}for(let t of(e.tenantId&&(o.tid=e.tenantId),Object.keys(o)))void 0===o[t]&&delete o[t];let a=await e._getAppCheckToken(),l=a?`#${iv}=${encodeURIComponent(a)}`:"";return`${function({config:e}){return e.emulator?tG(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${eS(o).slice(1)}${l}`}let ib="webStorageSupport",iE=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=rN,this._completeRedirectFn=ie,this._overrideRedirectResult=r9}async _openPopup(e,t,n,r){var i,s;i=this.eventManagers[e._key()]?.manager,s="_initialize() not called before _openPopup()",i||t$(s);let o=await iw(e,t,n,tW(),r);return function(e,t,n,r=500,i=600){let s=Math.max((window.screen.availHeight-i)/2,0).toString(),o=Math.max((window.screen.availWidth-r)/2,0).toString(),a="",l={...iy,width:r.toString(),height:i.toString(),top:s,left:o},h=ea().toLowerCase();n&&(a=nI(h)?"_blank":n),nT(h)&&(t=t||"http://localhost",l.scrollbars="yes");let u=Object.entries(l).reduce((e,[t,n])=>`${e}${t}=${n},`,"");if(function(e=ea()){return nA(e)&&!!window.navigator?.standalone}(h)&&"_self"!==a){var c,d;let e,n;return c=t||"",d=a,(e=document.createElement("a")).href=c,e.target=d,(n=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),e.dispatchEvent(n),new i_(null)}let f=window.open(t||"",a,u);tB(f,e,"popup-blocked");try{f.focus()}catch(e){}return new i_(f)}(e,o,rx())}async _openRedirect(e,t,n,r){var i;return await this._originValidation(e),i=await iw(e,t,n,tW(),r),rD().location.href=i,new Promise(()=>{})}_initialize(e){let t=e._key();if(this.eventManagers[t]){var n;let{manager:e,promise:r}=this.eventManagers[t];return e?Promise.resolve(e):(n="If manager is not set, promise should be",r||t$(n),r)}let r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){let t=await ig(e),n=new it(e);return t.register("authEvent",t=>(tB(t?.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(ib,{type:ib},n=>{let r=n?.[0]?.[ib];void 0!==r&&t(!!r),tU(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){let t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=il(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return nx()||nC()||nA()}};var iT="@firebase/auth",iC="1.11.1";class iI{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return(this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser)?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(t=>{e(t?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){tB(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}let iS=Z("authIdTokenMaxAge")||300,ik=null;function iR(e=t_()){let t=ts(e,"auth");if(t.isInitialized())return t.getImmediate();let n=function(e,t){let n=ts(e,"auth");if(n.isInitialized()){let e=n.getImmediate();if(eC(n.getOptions(),t??{}))return e;tU(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:iE,persistence:[rW,rR,rN]}),r=Z("authTokenSyncURL");if(r&&"boolean"==typeof isSecureContext&&isSecureContext){let e=new URL(r,location.origin);if(location.origin===e.origin){let t,r=(t=e.toString(),async e=>{let n=e&&await e.getIdTokenResult(),r=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(r&&r>iS)return;let i=n?.token;ik!==i&&(ik=i,await fetch(t,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});eO(n).beforeAuthStateChanged(r,()=>r(n.currentUser)),eO(n).onIdTokenChanged(e=>r(e),void 0,void 0)}}let i=Y("auth");return i&&function(e,t,n){let r=eO(e);tB(/^https?:\/\//.test(t),r,"invalid-emulator-scheme");let i=nK(t),{host:s,port:o}=function(e){let t=nK(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};let r=n[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){let e=i[1];return{host:e,port:nG(r.substr(e.length+1))}}{let[e,t]=r.split(":");return{host:e,port:nG(t)}}}(t),a=null===o?"":`:${o}`,l={url:`${i}//${s}${a}/`},h=Object.freeze({host:s,port:o,protocol:i.replace(":",""),options:Object.freeze({disableWarnings:!1})});if(!r._canInitEmulator){tB(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),tB(eC(l,r.config.emulator)&&eC(h,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=l,r.emulatorConfig=h,r.settings.appVerificationDisabledForTesting=!0,et(s)?(en(`${i}//${s}${a}`),eo("Auth",!0)):function(){function e(){let e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${i}`),n}nU={loadJS:e=>new Promise((t,n)=>{let r=document.createElement("script");r.setAttribute("src",e),r.onload=t,r.onerror=e=>{let t=tV("internal-error");t.customData=e,n(t)},r.type="text/javascript",r.charset="UTF-8",(document.getElementsByTagName("head")?.[0]??document).appendChild(r)}),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},y="Browser",ti(new eL("auth",(e,{options:t})=>{let n,r,i=e.getProvider("app").getImmediate(),s=e.getProvider("heartbeat"),o=e.getProvider("app-check-internal"),{apiKey:a,authDomain:l}=i.options;tB(a&&!a.includes(":"),"invalid-api-key",{appName:i.name});let h=new nM(i,s,o,{apiKey:a,authDomain:l,clientPlatform:y,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:nP(y)});return r=(Array.isArray(n=t?.persistence||[])?n:[n]).map(n_),t?.errorMap&&h._updateErrorMap(t.errorMap),h._initializeWithPersistence(r,t?.popupRedirectResolver),h},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,n)=>{e.getProvider("auth-internal").initialize()})),ti(new eL("auth-internal",e=>new iI(eO(e.getProvider("auth").getImmediate())),"PRIVATE").setInstantiationMode("EXPLICIT")),tb(iT,iC,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}(y)),tb(iT,iC,"esm2020"),e.s([],58556),e.s([],51718),e.i(58556),e.s(["GoogleAuthProvider",()=>ri,"browserLocalPersistence",()=>rR,"createUserWithEmailAndPassword",()=>rw,"getAuth",()=>iR,"onAuthStateChanged",()=>rT,"setPersistence",()=>rE,"signInWithEmailAndPassword",()=>rb,"signInWithPopup",()=>r6,"signOut",()=>rC],18357),tb("firebase","12.5.0","app"),e.i(92953);var iN=e.i(67034),iA="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,ix={};(function(){function e(){this.blockSize=-1,this.blockSize=64,this.g=[,,,,],this.C=Array(this.blockSize),this.o=this.h=0,this.u()}var t=function(){this.blockSize=-1};function n(){}function r(e,t,n){n||(n=0);let r=Array(16);if("string"==typeof t)for(var i=0;i<16;++i)r[i]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(i=0;i<16;++i)r[i]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],i=e.g[2];let s=e.g[3],o;o=t+(s^n&(i^s))+r[0]+0xd76aa478|0,o=s+(i^(t=n+(o<<7|o>>>25))&(n^i))+r[1]+0xe8c7b756|0,o=i+(n^(s=t+(o<<12|o>>>20))&(t^n))+r[2]+0x242070db|0,o=n+(t^(i=s+(o<<17|o>>>15))&(s^t))+r[3]+0xc1bdceee|0,o=t+(s^(n=i+(o<<22|o>>>10))&(i^s))+r[4]+0xf57c0faf|0,o=s+(i^(t=n+(o<<7|o>>>25))&(n^i))+r[5]+0x4787c62a|0,o=i+(n^(s=t+(o<<12|o>>>20))&(t^n))+r[6]+0xa8304613|0,o=n+(t^(i=s+(o<<17|o>>>15))&(s^t))+r[7]+0xfd469501|0,o=t+(s^(n=i+(o<<22|o>>>10))&(i^s))+r[8]+0x698098d8|0,o=s+(i^(t=n+(o<<7|o>>>25))&(n^i))+r[9]+0x8b44f7af|0,o=i+(n^(s=t+(o<<12|o>>>20))&(t^n))+r[10]+0xffff5bb1|0,o=n+(t^(i=s+(o<<17|o>>>15))&(s^t))+r[11]+0x895cd7be|0,o=t+(s^(n=i+(o<<22|o>>>10))&(i^s))+r[12]+0x6b901122|0,o=s+(i^(t=n+(o<<7|o>>>25))&(n^i))+r[13]+0xfd987193|0,o=i+(n^(s=t+(o<<12|o>>>20))&(t^n))+r[14]+0xa679438e|0,o=n+(t^(i=s+(o<<17|o>>>15))&(s^t))+r[15]+0x49b40821|0,n=i+(o<<22|o>>>10),o=t+(i^s&(n^i))+r[1]+0xf61e2562|0,t=n+(o<<5|o>>>27),o=s+(n^i&(t^n))+r[6]+0xc040b340|0,s=t+(o<<9|o>>>23),o=i+(t^n&(s^t))+r[11]+0x265e5a51|0,i=s+(o<<14|o>>>18),o=n+(s^t&(i^s))+r[0]+0xe9b6c7aa|0,n=i+(o<<20|o>>>12),o=t+(i^s&(n^i))+r[5]+0xd62f105d|0,t=n+(o<<5|o>>>27),o=s+(n^i&(t^n))+r[10]+0x2441453|0,s=t+(o<<9|o>>>23),o=i+(t^n&(s^t))+r[15]+0xd8a1e681|0,i=s+(o<<14|o>>>18),o=n+(s^t&(i^s))+r[4]+0xe7d3fbc8|0,n=i+(o<<20|o>>>12),o=t+(i^s&(n^i))+r[9]+0x21e1cde6|0,t=n+(o<<5|o>>>27),o=s+(n^i&(t^n))+r[14]+0xc33707d6|0,s=t+(o<<9|o>>>23),o=i+(t^n&(s^t))+r[3]+0xf4d50d87|0,i=s+(o<<14|o>>>18),o=n+(s^t&(i^s))+r[8]+0x455a14ed|0,n=i+(o<<20|o>>>12),o=t+(i^s&(n^i))+r[13]+0xa9e3e905|0,t=n+(o<<5|o>>>27),o=s+(n^i&(t^n))+r[2]+0xfcefa3f8|0,s=t+(o<<9|o>>>23),o=i+(t^n&(s^t))+r[7]+0x676f02d9|0,i=s+(o<<14|o>>>18),o=n+(s^t&(i^s))+r[12]+0x8d2a4c8a|0,o=t+((n=i+(o<<20|o>>>12))^i^s)+r[5]+0xfffa3942|0,o=s+((t=n+(o<<4|o>>>28))^n^i)+r[8]+0x8771f681|0,o=i+((s=t+(o<<11|o>>>21))^t^n)+r[11]+0x6d9d6122|0,o=n+((i=s+(o<<16|o>>>16))^s^t)+r[14]+0xfde5380c|0,o=t+((n=i+(o<<23|o>>>9))^i^s)+r[1]+0xa4beea44|0,o=s+((t=n+(o<<4|o>>>28))^n^i)+r[4]+0x4bdecfa9|0,o=i+((s=t+(o<<11|o>>>21))^t^n)+r[7]+0xf6bb4b60|0,o=n+((i=s+(o<<16|o>>>16))^s^t)+r[10]+0xbebfbc70|0,o=t+((n=i+(o<<23|o>>>9))^i^s)+r[13]+0x289b7ec6|0,o=s+((t=n+(o<<4|o>>>28))^n^i)+r[0]+0xeaa127fa|0,o=i+((s=t+(o<<11|o>>>21))^t^n)+r[3]+0xd4ef3085|0,o=n+((i=s+(o<<16|o>>>16))^s^t)+r[6]+0x4881d05|0,o=t+((n=i+(o<<23|o>>>9))^i^s)+r[9]+0xd9d4d039|0,o=s+((t=n+(o<<4|o>>>28))^n^i)+r[12]+0xe6db99e5|0,o=i+((s=t+(o<<11|o>>>21))^t^n)+r[15]+0x1fa27cf8|0,o=n+((i=s+(o<<16|o>>>16))^s^t)+r[2]+0xc4ac5665|0,n=i+(o<<23|o>>>9),o=t+(i^(n|~s))+r[0]+0xf4292244|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~i))+r[7]+0x432aff97|0,s=t+(o<<10|o>>>22),o=i+(t^(s|~n))+r[14]+0xab9423a7|0,i=s+(o<<15|o>>>17),o=n+(s^(i|~t))+r[5]+0xfc93a039|0,n=i+(o<<21|o>>>11),o=t+(i^(n|~s))+r[12]+0x655b59c3|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~i))+r[3]+0x8f0ccc92|0,s=t+(o<<10|o>>>22),o=i+(t^(s|~n))+r[10]+0xffeff47d|0,i=s+(o<<15|o>>>17),o=n+(s^(i|~t))+r[1]+0x85845dd1|0,n=i+(o<<21|o>>>11),o=t+(i^(n|~s))+r[8]+0x6fa87e4f|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~i))+r[15]+0xfe2ce6e0|0,s=t+(o<<10|o>>>22),o=i+(t^(s|~n))+r[6]+0xa3014314|0,i=s+(o<<15|o>>>17),o=n+(s^(i|~t))+r[13]+0x4e0811a1|0,n=i+(o<<21|o>>>11),o=t+(i^(n|~s))+r[4]+0xf7537e82|0,t=n+(o<<6|o>>>26),o=s+(n^(t|~i))+r[11]+0xbd3af235|0,s=t+(o<<10|o>>>22),o=i+(t^(s|~n))+r[2]+0x2ad7d2bb|0,i=s+(o<<15|o>>>17),o=n+(s^(i|~t))+r[9]+0xeb86d391|0,e.g[0]=e.g[0]+t|0,e.g[1]=e.g[1]+(i+(o<<21|o>>>11))|0,e.g[2]=e.g[2]+i|0,e.g[3]=e.g[3]+s|0}function i(e,t){this.h=t;let n=[],r=!0;for(let i=e.length-1;i>=0;i--){let s=0|e[i];r&&s==t||(n[i]=s,r=!1)}this.g=n}n.prototype=t.prototype,e.F=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.D=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)},e.prototype.u=function(){this.g[0]=0x67452301,this.g[1]=0xefcdab89,this.g[2]=0x98badcfe,this.g[3]=0x10325476,this.o=this.h=0},e.prototype.v=function(e,t){void 0===t&&(t=e.length);let n=t-this.blockSize,i=this.C,s=this.h,o=0;for(;o<t;){if(0==s)for(;o<=n;)r(this,e,o),o+=this.blockSize;if("string"==typeof e){for(;o<t;)if(i[s++]=e.charCodeAt(o++),s==this.blockSize){r(this,i),s=0;break}}else for(;o<t;)if(i[s++]=e[o++],s==this.blockSize){r(this,i),s=0;break}}this.h=s,this.o+=t},e.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var n=e.length-8;n<e.length;++n)e[n]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,n=0;n<4;++n)for(let r=0;r<32;r+=8)e[t++]=this.g[n]>>>r&255;return e};var s,o={};function a(e){var t;return -128<=e&&e<128?(t=function(e){return new i([0|e],e<0?-1:0)},Object.prototype.hasOwnProperty.call(o,e)?o[e]:o[e]=t(e)):new i([0|e],e<0?-1:0)}function l(e){if(isNaN(e)||!isFinite(e))return h;if(e<0)return p(l(-e));let t=[],n=1;for(let r=0;e>=n;r++)t[r]=e/n|0,n*=0x100000000;return new i(t,0)}var h=a(0),u=a(1),c=a(0x1000000);function d(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function f(e){return -1==e.h}function p(e){let t=e.g.length,n=[];for(let r=0;r<t;r++)n[r]=~e.g[r];return new i(n,~e.h).add(u)}function m(e,t){return e.add(p(t))}function g(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function y(e,t){this.g=e,this.h=t}function _(e,t){if(d(t))throw Error("division by zero");if(d(e))return new y(h,h);if(f(e))return t=_(p(e),t),new y(p(t.g),p(t.h));if(f(t))return t=_(e,p(t)),new y(p(t.g),t.h);if(e.g.length>30){if(f(e)||f(t))throw Error("slowDivide_ only works with positive integers.");for(var n=u,r=t;0>=r.l(e);)n=v(n),r=v(r);var i=w(n,1),s=w(r,1);for(r=w(r,2),n=w(n,2);!d(r);){var o=s.add(r);0>=o.l(e)&&(i=i.add(n),s=o),r=w(r,1),n=w(n,1)}return t=m(e,i.j(t)),new y(i,t)}for(i=h;e.l(t)>=0;){for(r=(r=Math.ceil(Math.log(n=Math.max(1,Math.floor(e.m()/t.m())))/Math.LN2))<=48?1:Math.pow(2,r-48),o=(s=l(n)).j(t);f(o)||o.l(e)>0;)n-=r,o=(s=l(n)).j(t);d(s)&&(s=u),i=i.add(s),e=m(e,o)}return new y(i,e)}function v(e){let t=e.g.length+1,n=[];for(let r=0;r<t;r++)n[r]=e.i(r)<<1|e.i(r-1)>>>31;return new i(n,e.h)}function w(e,t){let n=t>>5;t%=32;let r=e.g.length-n,s=[];for(let i=0;i<r;i++)s[i]=t>0?e.i(i+n)>>>t|e.i(i+n+1)<<32-t:e.i(i+n);return new i(s,e.h)}(s=i.prototype).m=function(){if(f(this))return-p(this).m();let e=0,t=1;for(let n=0;n<this.g.length;n++){let r=this.i(n);e+=(r>=0?r:0x100000000+r)*t,t*=0x100000000}return e},s.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(d(this))return"0";if(f(this))return"-"+p(this).toString(e);let t=l(Math.pow(e,6));var n=this;let r="";for(;;){let i=_(n,t).g,s=(((n=m(n,i.j(t))).g.length>0?n.g[0]:n.h)>>>0).toString(e);if(d(n=i))return s+r;for(;s.length<6;)s="0"+s;r=s+r}},s.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},s.l=function(e){return f(e=m(this,e))?-1:+!d(e)},s.abs=function(){return f(this)?p(this):this},s.add=function(e){let t=Math.max(this.g.length,e.g.length),n=[],r=0;for(let i=0;i<=t;i++){let t=r+(65535&this.i(i))+(65535&e.i(i)),s=(t>>>16)+(this.i(i)>>>16)+(e.i(i)>>>16);r=s>>>16,t&=65535,s&=65535,n[i]=s<<16|t}return new i(n,-0x80000000&n[n.length-1]?-1:0)},s.j=function(e){if(d(this)||d(e))return h;if(f(this))return f(e)?p(this).j(p(e)):p(p(this).j(e));if(f(e))return p(this.j(p(e)));if(0>this.l(c)&&0>e.l(c))return l(this.m()*e.m());let t=this.g.length+e.g.length,n=[];for(var r=0;r<2*t;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(let t=0;t<e.g.length;t++){let i=this.i(r)>>>16,s=65535&this.i(r),o=e.i(t)>>>16,a=65535&e.i(t);n[2*r+2*t]+=s*a,g(n,2*r+2*t),n[2*r+2*t+1]+=i*a,g(n,2*r+2*t+1),n[2*r+2*t+1]+=s*o,g(n,2*r+2*t+1),n[2*r+2*t+2]+=i*o,g(n,2*r+2*t+2)}for(e=0;e<t;e++)n[e]=n[2*e+1]<<16|n[2*e];for(e=t;e<2*t;e++)n[e]=0;return new i(n,0)},s.B=function(e){return _(this,e).h},s.and=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)&e.i(r);return new i(n,this.h&e.h)},s.or=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)|e.i(r);return new i(n,this.h|e.h)},s.xor=function(e){let t=Math.max(this.g.length,e.g.length),n=[];for(let r=0;r<t;r++)n[r]=this.i(r)^e.i(r);return new i(n,this.h^e.h)},e.prototype.digest=e.prototype.A,e.prototype.reset=e.prototype.u,e.prototype.update=e.prototype.v,T=ix.Md5=e,i.prototype.add=i.prototype.add,i.prototype.multiply=i.prototype.j,i.prototype.modulo=i.prototype.B,i.prototype.compare=i.prototype.l,i.prototype.toNumber=i.prototype.m,i.prototype.toString=i.prototype.toString,i.prototype.getBits=i.prototype.i,i.fromNumber=l,i.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if((n=n||10)<2||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return p(e(t.substring(1),n));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');let r=l(Math.pow(n,8)),i=h;for(let e=0;e<t.length;e+=8){var s=Math.min(8,t.length-e);let o=parseInt(t.substring(e,e+s),n);s<8?(s=l(Math.pow(n,s)),i=i.j(s).add(l(o))):i=(i=i.j(r)).add(l(o))}return i},E=ix.Integer=i}).apply(void 0!==iA?iA:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var iP="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g,iD={};(function(){var e,t,n=Object.defineProperty,r=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof iP&&iP];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);function i(e,t){if(t)e:{var i=r;e=e.split(".");for(var s=0;s<e.length-1;s++){var o=e[s];if(!(o in i))break e;i=i[o]}(t=t(s=i[e=e[e.length-1]]))!=s&&null!=t&&n(i,e,{configurable:!0,writable:!0,value:t})}}i("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),i("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),i("Object.entries",function(e){return e||function(e){var t,n=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&n.push([t,e[t]]);return n}});var s=s||{},o=this||self;function a(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function l(e,t,n){return e.call.apply(e.bind,arguments)}function h(e,t,n){return(h=l).apply(null,arguments)}function u(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function c(e,t){function n(){}n.prototype=t.prototype,e.Z=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Ob=function(e,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[n].apply(e,i)}}var d="undefined"!=typeof AsyncContext&&"function"==typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function f(e){let t=e.length;if(t>0){let n=Array(t);for(let r=0;r<t;r++)n[r]=e[r];return n}return[]}function p(e,t){for(let t=1;t<arguments.length;t++){let r=arguments[t];var n=typeof r;if("array"==(n="object"!=n?n:r?Array.isArray(r)?"array":n:"null")||"object"==n&&"number"==typeof r.length){n=e.length||0;let t=r.length||0;e.length=n+t;for(let i=0;i<t;i++)e[n+i]=r[i]}else e.push(r)}}var m=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new g,e=>e.reset());class g{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let y,_=!1,v=new class{constructor(){this.h=this.g=null}add(e,t){let n=m.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},w=()=>{let e=Promise.resolve(void 0);y=()=>{e.then(b)}};function b(){let e;for(var t;e=null,v.g&&(e=v.g,v.g=v.g.next,v.g||(v.h=null),e.next=null),t=e;){try{t.h.call(t.g)}catch(e){!function(e){o.setTimeout(()=>{throw e},0)}(e)}m.j(t),m.h<100&&(m.h++,t.next=m.g,m.g=t)}_=!1}function E(){this.u=this.u,this.C=this.C}function T(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}E.prototype.u=!1,E.prototype.dispose=function(){this.u||(this.u=!0,this.N())},E.prototype[Symbol.dispose]=function(){this.dispose()},E.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},T.prototype.h=function(){this.defaultPrevented=!0};var P=function(){if(!o.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{let e=()=>{};o.addEventListener("test",e,t),o.removeEventListener("test",e,t)}catch(e){}return e}();function D(e){return/^[\s\xa0]*$/.test(e)}function O(e,t){T.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}c(O,T),O.prototype.init=function(e,t){let n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement)),this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&O.Z.h.call(this)},O.prototype.h=function(){O.Z.h.call(this);let e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var L="closure_listenable_"+(1e6*Math.random()|0),M=0;function F(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=i,this.key=++M,this.da=this.fa=!1}function U(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function V(e,t,n){for(let r in e)t.call(n,e[r],r,e)}function j(e){let t={};for(let n in e)t[n]=e[n];return t}let q="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function z(e,t){let n,r;for(let t=1;t<arguments.length;t++){for(n in r=arguments[t])e[n]=r[n];for(let t=0;t<q.length;t++)n=q[t],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function B(e){this.src=e,this.g={},this.h=0}function $(e,t){let n=t.type;if(n in e.g){var r,i=e.g[n],s=Array.prototype.indexOf.call(i,t,void 0);(r=s>=0)&&Array.prototype.splice.call(i,s,1),r&&(U(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function W(e,t,n,r){for(let i=0;i<e.length;++i){let s=e[i];if(!s.da&&s.listener==t&&!!n==s.capture&&s.ha==r)return i}return -1}B.prototype.add=function(e,t,n,r,i){let s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);let o=W(e,t,r,i);return o>-1?(t=e[o],n||(t.fa=!1)):((t=new F(t,this.src,s,!!r,i)).fa=n,e.push(t)),t};var H="closure_lm_"+(1e6*Math.random()|0),K={};function G(e,t,n,r,i,s){if(!t)throw Error("Invalid event type");let o=a(i)?!!i.capture:!!i,l=J(e);if(l||(e[H]=l=new B(e)),(n=l.add(t,n,r,o,s)).proxy)return n;if(r=function e(t){return X.call(e.src,e.listener,t)},n.proxy=r,r.src=e,r.listener=n,e.addEventListener)P||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(Y(t.toString()),r);else if(e.addListener&&e.removeListener)e.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return n}function Q(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[L])$(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(Y(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=J(t))?($(n,e),0==n.h&&(n.src=null,t[H]=null)):U(e)}}}function Y(e){return e in K?K[e]:K[e]="on"+e}function X(e,t){if(e.da)e=!0;else{t=new O(t,this);let n=e.listener,r=e.ha||e.src;e.fa&&Q(e),e=n.call(r,t)}return e}function J(e){return(e=e[H])instanceof B?e:null}var Z="__closure_events_fn_"+(1e9*Math.random()>>>0);function ee(e){return"function"==typeof e?e:(e[Z]||(e[Z]=function(t){return e.handleEvent(t)}),e[Z])}function et(){E.call(this),this.i=new B(this),this.M=this,this.G=null}function en(e,t){let n,r;var i,s=e.G;if(s)for(i=[];s;s=s.G)i.push(s);if(e=e.M,s=t.type||t,"string"==typeof t)t=new T(t,e);else if(t instanceof T)t.target=t.target||e;else{var o=t;z(t=new T(s,e),o)}if(o=!0,i)for(r=i.length-1;r>=0;r--)o=er(n=t.g=i[r],s,!0,t)&&o;if(o=er(n=t.g=e,s,!0,t)&&o,o=er(n,s,!1,t)&&o,i)for(r=0;r<i.length;r++)o=er(n=t.g=i[r],s,!1,t)&&o}function er(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let i=!0;for(let s=0;s<t.length;++s){let o=t[s];if(o&&!o.da&&o.capture==n){let t=o.listener,n=o.ha||o.src;o.fa&&$(e.i,o),i=!1!==t.call(n,r)&&i}}return i&&!r.defaultPrevented}c(et,E),et.prototype[L]=!0,et.prototype.removeEventListener=function(e,t,n,r){!function e(t,n,r,i,s){if(Array.isArray(n))for(var o=0;o<n.length;o++)e(t,n[o],r,i,s);else(i=a(i)?!!i.capture:!!i,r=ee(r),t&&t[L])?(t=t.i,(o=String(n).toString())in t.g&&(r=W(n=t.g[o],r,i,s))>-1&&(U(n[r]),Array.prototype.splice.call(n,r,1),0==n.length&&(delete t.g[o],t.h--))):t&&(t=J(t))&&(n=t.g[n.toString()],t=-1,n&&(t=W(n,r,i,s)),(r=t>-1?n[t]:null)&&Q(r))}(this,e,t,n,r)},et.prototype.N=function(){if(et.Z.N.call(this),this.i){var e=this.i;for(let t in e.g){let n=e.g[t];for(let e=0;e<n.length;e++)U(n[e]);delete e.g[t],e.h--}}this.G=null},et.prototype.J=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},et.prototype.K=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};class ei extends E{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:function e(t){t.g=function(e,t){if("function"!=typeof e)if(e&&"function"==typeof e.handleEvent)e=h(e.handleEvent,e);else throw Error("Invalid listener argument");return Number(t)>0x7fffffff?-1:o.setTimeout(e,t||0)}(()=>{t.g=null,t.i&&(t.i=!1,e(t))},t.l);let n=t.h;t.h=null,t.m.apply(null,n)}(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function es(e){E.call(this),this.h=e,this.g={}}c(es,E);var eo=[];function ea(e){V(e.g,function(e,t){this.g.hasOwnProperty(t)&&Q(e)},e),e.g={}}es.prototype.N=function(){es.Z.N.call(this),ea(this)},es.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var el=o.JSON.stringify,eh=o.JSON.parse,eu=class{stringify(e){return o.JSON.stringify(e,void 0)}parse(e){return o.JSON.parse(e,void 0)}};function ec(){}function ed(){}var ef={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ep(){T.call(this,"d")}function em(){T.call(this,"c")}c(ep,T),c(em,T);var eg={},ey=null;function e_(){return ey=ey||new et}function ev(e){T.call(this,eg.Ia,e)}function ew(e){let t=e_();en(t,new ev(t))}function eb(e,t){T.call(this,eg.STAT_EVENT,e),this.stat=t}function eE(e){let t=e_();en(t,new eb(t,e))}function eT(e,t){T.call(this,eg.Ja,e),this.size=t}function eC(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){e()},t)}function eI(){this.g=!0}function eS(e,t,n,r){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{let s=JSON.parse(t);if(s){for(e=0;e<s.length;e++)if(Array.isArray(s[e])){var n=s[e];if(!(n.length<2)){var r=n[1];if(Array.isArray(r)&&!(r.length<1)){var i=r[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(let e=1;e<r.length;e++)r[e]=""}}}}return el(s)}catch(e){return t}}(e,n)+(r?" "+r:"")})}eg.Ia="serverreachability",c(ev,T),eg.STAT_EVENT="statevent",c(eb,T),eg.Ja="timingevent",c(eT,T),eI.prototype.ua=function(){this.g=!1},eI.prototype.info=function(){};var ek={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},eR={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function eN(){}function eA(e){return encodeURIComponent(String(e))}function ex(e,t,n,r){this.j=e,this.i=t,this.l=n,this.S=r||1,this.V=new es(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new eP}function eP(){this.i=null,this.g="",this.h=!1}c(eN,ec),eN.prototype.g=function(){return new XMLHttpRequest},e=new eN;var eD={},eO={};function eL(e,t,n){e.M=1,e.A=e4(e0(t)),e.u=n,e.R=!0,eM(e,null)}function eM(e,t){e.F=Date.now(),eU(e),e.B=e0(e.A);var n,r,i,s,o,l,u=e.B,c=e.S;Array.isArray(c)||(c=[String(c)]),th(u.i,"t",c),e.C=0,u=e.j.L,e.h=new eP,e.g=tQ(e.j,u?t:null,!e.u),e.P>0&&(e.O=new ei(h(e.Y,e,e.g),e.P)),t=e.V,u=e.g,c=e.ba;var d="readystatechange";Array.isArray(d)||(d&&(eo[0]=d.toString()),d=eo);for(let e=0;e<d.length;e++){let n=function e(t,n,r,i,s){if(i&&i.once)return function e(t,n,r,i,s){if(Array.isArray(n)){for(let o=0;o<n.length;o++)e(t,n[o],r,i,s);return null}return r=ee(r),t&&t[L]?t.K(n,r,a(i)?!!i.capture:!!i,s):G(t,n,r,!0,i,s)}(t,n,r,i,s);if(Array.isArray(n)){for(let o=0;o<n.length;o++)e(t,n[o],r,i,s);return null}return r=ee(r),t&&t[L]?t.J(n,r,a(i)?!!i.capture:!!i,s):G(t,n,r,!1,i,s)}(u,d[e],c||t.handleEvent,!1,t.h||t);if(!n)break;t.g[n.key]=n}t=e.J?j(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),ew(),n=e.i,r=e.v,i=e.B,s=e.l,o=e.S,l=e.u,n.info(function(){if(n.g)if(l){var e="",t=l.split("&");for(let n=0;n<t.length;n++){var a=t[n].split("=");if(a.length>1){let t=a[0];a=a[1];let n=t.split("_");e=n.length>=2&&"type"==n[1]?e+(t+"=")+a+"&":e+(t+"=redacted&")}}}else e=null;else e=l;return"XMLHTTP REQ ("+s+") [attempt "+o+"]: "+r+"\n"+i+"\n"+e})}function eF(e){return!!e.g&&"GET"==e.v&&2!=e.M&&e.j.Aa}function eU(e){e.T=Date.now()+e.H,eV(e,e.H)}function eV(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=eC(h(e.aa,e),t)}function ej(e){e.D&&(o.clearTimeout(e.D),e.D=null)}function eq(e){0==e.j.I||e.K||t$(e.j,e)}function ez(e){ej(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,ea(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function eB(e,t){try{var n=e.j;if(0!=n.I&&(n.g==e||eG(n.h,e))){if(!e.L&&eG(n.h,e)&&3==n.I){try{var r=n.Ba.g.parse(t)}catch(e){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){e:if(!n.v){if(n.g)if(n.g.F+3e3<e.F)tB(n),tD(n);else break e;tj(n),eE(18)}}else n.xa=i[1],0<n.xa-n.K&&i[2]<37500&&n.F&&0==n.A&&!n.C&&(n.C=eC(h(n.Va,n),6e3));1>=eK(n.h)&&n.ta&&(n.ta=void 0)}else tH(n,11)}else if((e.L||n.g==e)&&tB(n),!D(t))for(i=n.Ba.g.parse(t),t=0;t<i.length;t++){let a=i[t],l=a[0];if(!(l<=n.K))if(n.K=l,a=a[1],2==n.I)if("c"==a[0]){n.M=a[1],n.ba=a[2];let t=a[3];null!=t&&(n.ka=t,n.j.info("VER="+n.ka));let i=a[4];null!=i&&(n.za=i,n.j.info("SVER="+n.za));let l=a[5];null!=l&&"number"==typeof l&&l>0&&(n.O=r=1.5*l,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;let h=e.g;if(h){let e=h.g?h.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=r.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(eQ(s,s.h),s.h=null))}if(r.G){let e=h.g?h.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(r.wa=e,e6(r.J,r.G,e))}}if(n.I=3,n.l&&n.l.ra(),n.aa&&(n.T=Date.now()-e.F,n.j.info("Handshake RTT: "+n.T+"ms")),(r=n).na=tG(r,r.L?r.ba:null,r.W),e.L){eY(r.h,e);var o=r.O;o&&(e.H=o),e.D&&(ej(e),eU(e)),r.g=e}else tV(r);n.i.length>0&&tL(n)}else"stop"!=a[0]&&"close"!=a[0]||tH(n,7);else 3==n.I&&("stop"==a[0]||"close"==a[0]?"stop"==a[0]?tH(n,7):tP(n):"noop"!=a[0]&&n.l&&n.l.qa(a),n.A=0)}}ew(4)}catch(e){}}ex.prototype.ba=function(e){e=e.target;let t=this.O;t&&3==tR(e)?t.j():this.Y(e)},ex.prototype.Y=function(e){try{if(e==this.g)e:{let f=tR(this.g),p=this.g.ya(),m=this.g.ca();if(!(f<3)&&(3!=f||this.g&&(this.h.h||this.g.la()||tN(this.g)))){this.K||4!=f||7==p||(8==p||m<=0?ew(3):ew(2)),ej(this);var t=this.g.ca();this.X=t;var n=function(e){if(!eF(e))return e.g.la();let t=tN(e.g);if(""===t)return"";let n="",r=t.length,i=4==tR(e.g);if(!e.h.i){if("undefined"==typeof TextDecoder)return ez(e),eq(e),"";e.h.i=new o.TextDecoder}for(let s=0;s<r;s++)e.h.h=!0,n+=e.h.i.decode(t[s],{stream:!(i&&s==r-1)});return t.length=0,e.h.g+=n,e.C=0,e.h.g}(this);if(this.o=200==t,r=this.i,i=this.v,s=this.B,a=this.l,l=this.S,r.info(function(){return"XMLHTTP RESP ("+a+") [ attempt "+l+"]: "+i+"\n"+s+"\n"+f+" "+t}),this.o){if(this.U&&!this.L){t:{if(this.g){var r,i,s,a,l,h,u=this.g;if((h=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!D(h)){var c=h;break t}}c=null}if(e=c)eS(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,eB(this,e);else{this.o=!1,this.m=3,eE(12),ez(this),eq(this);break e}}if(this.R){let t;for(e=!0;!this.K&&this.C<n.length;)if((t=function(e,t){var n=e.C,r=t.indexOf("\n",n);return -1==r?eO:isNaN(n=Number(t.substring(n,r)))?eD:(r+=1)+n>t.length?eO:(t=t.slice(r,r+n),e.C=r+n,t)}(this,n))==eO){4==f&&(this.m=4,eE(14),e=!1),eS(this.i,this.l,null,"[Incomplete Response]");break}else if(t==eD){this.m=4,eE(15),eS(this.i,this.l,n,"[Invalid Chunk]"),e=!1;break}else eS(this.i,this.l,t,null),eB(this,t);if(eF(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=f||0!=n.length||this.h.h||(this.m=1,eE(16),e=!1),this.o=this.o&&e,e){if(n.length>0&&!this.W){this.W=!0;var d=this.j;d.g==this&&d.aa&&!d.P&&(d.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),tq(d),d.P=!0,eE(11))}}else eS(this.i,this.l,n,"[Invalid Chunked Response]"),ez(this),eq(this)}else eS(this.i,this.l,n,null),eB(this,n);4==f&&ez(this),this.o&&!this.K&&(4==f?t$(this.j,this):(this.o=!1,eU(this)))}else(function(e){let t={};e=(e.g&&tR(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<e.length;r++){if(D(e[r]))continue;var n=function(e){var t=1;e=e.split(":");let n=[];for(;t>0&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}(e[r]);let i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();let s=t[i]||[];t[i]=s,s.push(n)}var r=function(e){return e.join(", ")};for(let e in t)r.call(void 0,t[e],e,t)})(this.g),400==t&&n.indexOf("Unknown SID")>0?(this.m=3,eE(12)):(this.m=0,eE(13)),ez(this),eq(this)}}}catch(e){}finally{}},ex.prototype.cancel=function(){this.K=!0,ez(this)},ex.prototype.aa=function(){var e,t;this.D=null;let n=Date.now();n-this.T>=0?(e=this.i,t=this.B,e.info(function(){return"TIMEOUT: "+t}),2!=this.M&&(ew(),eE(17)),ez(this),this.m=2,eq(this)):eV(this,this.T-n)};var e$=class{constructor(e,t){this.g=e,this.map=t}};function eW(e){this.l=e||10,e=o.PerformanceNavigationTiming?(e=o.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function eH(e){return!!e.h||!!e.g&&e.g.size>=e.j}function eK(e){return e.h?1:e.g?e.g.size:0}function eG(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function eQ(e,t){e.g?e.g.add(t):e.h=t}function eY(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function eX(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(let n of e.g.values())t=t.concat(n.G);return t}return f(e.i)}eW.prototype.cancel=function(){if(this.i=eX(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(let e of this.g.values())e.cancel();this.g.clear()}};var eJ=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function eZ(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof eZ?(this.l=e.l,e1(this,e.j),this.o=e.o,this.g=e.g,e2(this,e.u),this.h=e.h,e3(this,tu(e.i)),this.m=e.m):e&&(t=String(e).match(eJ))?(this.l=!1,e1(this,t[1]||"",!0),this.o=e5(t[2]||""),this.g=e5(t[3]||"",!0),e2(this,t[4]),this.h=e5(t[5]||"",!0),e3(this,t[6]||"",!0),this.m=e5(t[7]||"")):(this.l=!1,this.i=new ti(null,this.l))}function e0(e){return new eZ(e)}function e1(e,t,n){e.j=n?e5(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function e2(e,t){if(t){if(isNaN(t=Number(t))||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function e3(e,t,n){var r,i;t instanceof ti?(e.i=t,r=e.i,(i=e.l)&&!r.j&&(ts(r),r.i=null,r.g.forEach(function(e,t){let n=t.toLowerCase();t!=n&&(to(this,t),th(this,n,e))},r)),r.j=i):(n||(t=e8(t,tn)),e.i=new ti(t,e.l))}function e6(e,t,n){e.i.set(t,n)}function e4(e){return e6(e,"zx",Math.floor(0x80000000*Math.random()).toString(36)+Math.abs(Math.floor(0x80000000*Math.random())^Date.now()).toString(36)),e}function e5(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function e8(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,e7),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function e7(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}eZ.prototype.toString=function(){let e=[];var t=this.j;t&&e.push(e8(t,e9,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(e8(t,e9,!0),"@"),e.push(eA(n).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.u)&&e.push(":",String(n))),(n=this.h)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(e8(n,"/"==n.charAt(0)?tt:te,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",e8(n,tr)),e.join("")},eZ.prototype.resolve=function(e){let t=e0(this),n=!!e.j;n?e1(t,e.j):n=!!e.o,n?t.o=e.o:n=!!e.g,n?t.g=e.g:n=null!=e.u;var r=e.h;if(n)e2(t,e.u);else if(n=!!e.h){if("/"!=r.charAt(0))if(this.g&&!this.h)r="/"+r;else{var i=t.h.lastIndexOf("/");-1!=i&&(r=t.h.slice(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(-1!=i.indexOf("./")||-1!=i.indexOf("/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");let e=[];for(let t=0;t<i.length;){let n=i[t++];"."==n?r&&t==i.length&&e.push(""):".."==n?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),r&&t==i.length&&e.push("")):(e.push(n),r=!0)}r=e.join("/")}else r=i}return n?t.h=r:n=""!==e.i.toString(),n?e3(t,tu(e.i)):n=!!e.m,n&&(t.m=e.m),t};var e9=/[#\/\?@]/g,te=/[#\?:]/g,tt=/[#\?]/g,tn=/[#\?@]/g,tr=/#/g;function ti(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function ts(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let n=0;n<e.length;n++){let r=e[n].indexOf("="),i,s=null;r>=0?(i=e[n].substring(0,r),s=e[n].substring(r+1)):i=e[n],t(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)}))}function to(e,t){ts(e),t=tc(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function ta(e,t){return ts(e),t=tc(e,t),e.g.has(t)}function tl(e,t){ts(e);let n=[];if("string"==typeof t)ta(e,t)&&(n=n.concat(e.g.get(tc(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)n=n.concat(e[t]);return n}function th(e,t,n){to(e,t),n.length>0&&(e.i=null,e.g.set(tc(e,t),f(n)),e.h+=n.length)}function tu(e){let t=new ti;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function tc(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function td(e,t,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(e){}}function tf(){this.g=new eu}function tp(e){this.i=e.Sb||null,this.h=e.ab||!1}function tm(e,t){et.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function tg(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function ty(e){e.readyState=4,e.l=null,e.j=null,e.B=null,t_(e)}function t_(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function tv(e){let t="";return V(e,function(e,n){t+=n,t+=":",t+=e,t+="\r\n"}),t}function tw(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=tv(n),"string"==typeof e?null!=n&&eA(n):e6(e,t,n))}function tb(e){et.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(t=ti.prototype).add=function(e,t){ts(this),this.i=null,e=tc(this,e);let n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},t.forEach=function(e,t){ts(this),this.g.forEach(function(n,r){n.forEach(function(n){e.call(t,n,r,this)},this)},this)},t.set=function(e,t){return ts(this),this.i=null,ta(this,e=tc(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},t.get=function(e,t){return e&&(e=tl(this,e)).length>0?String(e[0]):t},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";let e=[],t=Array.from(this.g.keys());for(let r=0;r<t.length;r++){var n=t[r];let i=eA(n);n=tl(this,n);for(let t=0;t<n.length;t++){let r=i;""!==n[t]&&(r+="="+eA(n[t])),e.push(r)}}return this.i=e.join("&")},c(tp,ec),tp.prototype.g=function(){return new tm(this.i,this.h)},c(tm,et),(t=tm.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,t_(this)},t.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;let t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||o).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,ty(this)),this.readyState=0},t.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,t_(this)),this.g&&(this.readyState=3,t_(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(void 0!==o.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;tg(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},t.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?ty(this):t_(this),3==this.readyState&&tg(this)}},t.Oa=function(e){this.g&&(this.response=this.responseText=e,ty(this))},t.Na=function(e){this.g&&(this.response=e,ty(this))},t.ga=function(){this.g&&ty(this)},t.setRequestHeader=function(e,t){this.A.append(e,t)},t.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";let e=[],t=this.h.entries();for(var n=t.next();!n.done;)e.push((n=n.value)[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(tm.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),c(tb,et);var tE=/^https?$/i,tT=["POST","PUT"];function tC(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,tI(e),tk(e)}function tI(e){e.A||(e.A=!0,en(e,"complete"),en(e,"error"))}function tS(e){if(e.h&&void 0!==s){if(e.v&&4==tR(e))setTimeout(e.Ca.bind(e),0);else if(en(e,"readystatechange"),4==tR(e)){e.h=!1;try{let s=e.ca();switch(s){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t,n,r=!0;break;default:r=!1}if(!(t=r)){if(n=0===s){let t=String(e.D).match(eJ)[1]||null;!t&&o.self&&o.self.location&&(t=o.self.location.protocol.slice(0,-1)),n=!tE.test(t?t.toLowerCase():"")}t=n}if(t)en(e,"complete"),en(e,"success");else{e.o=6;try{var i=tR(e)>2?e.g.statusText:""}catch(e){i=""}e.l=i+" ["+e.ca()+"]",tI(e)}}finally{tk(e)}}}}function tk(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);let n=e.g;e.g=null,t||en(e,"ready");try{n.onreadystatechange=null}catch(e){}}}function tR(e){return e.g?e.g.readyState:0}function tN(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tA(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function tx(e){this.za=0,this.i=[],this.j=new eI,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=tA("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=tA("baseRetryDelayMs",5e3,e),this.Za=tA("retryDelaySeedMs",1e4,e),this.Ta=tA("forwardChannelMaxRetries",2,e),this.va=tA("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new eW(e&&e.concurrentRequestLimit),this.Ba=new tf,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function tP(e){if(tO(e),3==e.I){var t=e.V++,n=e0(e.J);if(e6(n,"SID",e.M),e6(n,"RID",t),e6(n,"TYPE","terminate"),tF(e,n),(t=new ex(e,e.j,t)).M=2,t.A=e4(e0(n)),n=!1,o.navigator&&o.navigator.sendBeacon)try{n=o.navigator.sendBeacon(t.A.toString(),"")}catch(e){}!n&&o.Image&&((new Image).src=t.A,n=!0),n||(t.g=tQ(t.j,null),t.g.ea(t.A)),t.F=Date.now(),eU(t)}tK(e)}function tD(e){e.g&&(tq(e),e.g.cancel(),e.g=null)}function tO(e){tD(e),e.v&&(o.clearTimeout(e.v),e.v=null),tB(e),e.h.cancel(),e.m&&("number"==typeof e.m&&o.clearTimeout(e.m),e.m=null)}function tL(e){if(!eH(e.h)&&!e.m){e.m=!0;var t=e.Ea;y||w(),_||(y(),_=!0),v.add(t,e),e.D=0}}function tM(e,t){var n;n=t?t.l:e.V++;let r=e0(e.J);e6(r,"SID",e.M),e6(r,"RID",n),e6(r,"AID",e.K),tF(e,r),e.u&&e.o&&tw(r,e.u,e.o),n=new ex(e,e.j,n,e.D+1),null===e.u&&(n.J=e.o),t&&(e.i=t.G.concat(e.i)),t=tU(e,n,1e3),n.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),eQ(e.h,n),eL(n,r,t)}function tF(e,t){e.H&&V(e.H,function(e,n){e6(t,n,e)}),e.l&&V({},function(e,n){e6(t,n,e)})}function tU(e,t,n){n=Math.min(e.i.length,n);let r=e.l?h(e.l.Ka,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){let e=["count="+n];-1==t?n>0?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let l=!0;for(let h=0;h<n;h++){var s=i[h].g;let n=i[h].map;if((s-=t)<0)t=Math.max(0,i[h].g-100),l=!1;else try{s="req"+s+"_";try{var o=n instanceof Map?n:Object.entries(n);for(let[t,n]of o){let r=n;a(n)&&(r=el(n)),e.push(s+t+"="+encodeURIComponent(r))}}catch(t){throw e.push(s+"type="+encodeURIComponent("_badmap")),t}}catch(e){r&&r(n)}}if(l){o=e.join("&");break e}}o=void 0}return t.G=e=e.i.splice(0,n),o}function tV(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;y||w(),_||(y(),_=!0),v.add(t,e),e.A=0}}function tj(e){return!e.g&&!e.v&&!(e.A>=3)&&(e.Y++,e.v=eC(h(e.Da,e),tW(e,e.A)),e.A++,!0)}function tq(e){null!=e.B&&(o.clearTimeout(e.B),e.B=null)}function tz(e){e.g=new ex(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=e0(e.na);e6(t,"RID","rpc"),e6(t,"SID",e.M),e6(t,"AID",e.K),e6(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&e6(t,"TO",e.ia),e6(t,"TYPE","xmlhttp"),tF(e,t),e.u&&e.o&&tw(t,e.u,e.o),e.O&&(e.g.H=e.O);var n=e.g;e=e.ba,n.M=1,n.A=e4(e0(t)),n.u=null,n.R=!0,eM(n,e)}function tB(e){null!=e.C&&(o.clearTimeout(e.C),e.C=null)}function t$(e,t){var n,r=null;if(e.g==t){tB(e),tq(e),e.g=null;var i=2}else{if(!eG(e.h,t))return;r=t.G,eY(e.h,t),i=1}if(0!=e.I){if(t.o)if(1==i){r=t.u?t.u.length:0,t=Date.now()-t.F;var s=e.D;en(i=e_(),new eT(i,r)),tL(e)}else tV(e);else if(3==(s=t.m)||0==s&&t.X>0||!(1==i&&(n=t,!(eK(e.h)>=e.h.j-!!e.m)&&(e.m?(e.i=n.G.concat(e.i),!0):1!=e.I&&2!=e.I&&!(e.D>=(e.Sa?0:e.Ta))&&(e.m=eC(h(e.Ea,e,n),tW(e,e.D)),e.D++,!0)))||2==i&&tj(e)))switch(r&&r.length>0&&((t=e.h).i=t.i.concat(r)),s){case 1:tH(e,5);break;case 4:tH(e,10);break;case 3:tH(e,6);break;default:tH(e,2)}}}function tW(e,t){let n=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(n*=2),n*t}function tH(e,t){if(e.j.info("Error code "+t),2==t){let t,s,a;var n,r=h(e.bb,e),i=e.Ua;let l=!i;i=new eZ(i||"//www.google.com/images/cleardot.gif"),o.location&&"http"==o.location.protocol||e1(i,"https"),e4(i),l?function(e,t){let n=new eI;if(o.Image){let r=new Image;r.onload=u(td,n,"TestLoadImage: loaded",!0,t,r),r.onerror=u(td,n,"TestLoadImage: error",!1,t,r),r.onabort=u(td,n,"TestLoadImage: abort",!1,t,r),r.ontimeout=u(td,n,"TestLoadImage: timeout",!1,t,r),o.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=e}else t(!1)}(i.toString(),r):(n=i.toString(),t=new eI,s=new AbortController,a=setTimeout(()=>{s.abort(),td(t,"TestPingServer: timeout",!1,r)},1e4),fetch(n,{signal:s.signal}).then(e=>{clearTimeout(a),e.ok?td(t,"TestPingServer: ok",!0,r):td(t,"TestPingServer: server error",!1,r)}).catch(()=>{clearTimeout(a),td(t,"TestPingServer: error",!1,r)}))}else eE(2);e.I=0,e.l&&e.l.pa(t),tK(e),tO(e)}function tK(e){if(e.I=0,e.ja=[],e.l){let t=eX(e.h);(0!=t.length||0!=e.i.length)&&(p(e.ja,t),p(e.ja,e.i),e.h.i.length=0,f(e.i),e.i.length=0),e.l.oa()}}function tG(e,t,n){var r=n instanceof eZ?e0(n):new eZ(n);if(""!=r.g)t&&(r.g=t+"."+r.g),e2(r,r.u);else{var i=o.location;r=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;let e=new eZ(null);r&&e1(e,r),t&&(e.g=t),i&&e2(e,i),n&&(e.h=n),r=e}return n=e.G,t=e.wa,n&&t&&e6(r,n,t),e6(r,"VER",e.ka),tF(e,r),r}function tQ(e,t,n){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new tb(e.Aa&&!e.ma?new tp({ab:n}):e.ma)).Fa(e.L),t}function tY(){}function tX(){}function tJ(e,t){et.call(this),this.g=new tx(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!D(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!D(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new t1(this)}function tZ(e){ep.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(let n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function t0(){em.call(this),this.status=1}function t1(e){this.g=e}(t=tb.prototype).Fa=function(e){this.H=e},t.ea=function(t,n,r,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);n=n?n.toUpperCase():"GET",this.D=t,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():e.g(),this.g.onreadystatechange=d(h(this.Ca,this));try{this.B=!0,this.g.open(n,String(t),!0),this.B=!1}catch(e){tC(this,e);return}if(t=r||"",r=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var s in i)r.set(s,i[s]);else if("function"==typeof i.keys&&"function"==typeof i.get)for(let e of i.keys())r.set(e,i.get(e));else throw Error("Unknown input type for opt_headers: "+String(i));for(let[e,a]of(i=Array.from(r.keys()).find(e=>"content-type"==e.toLowerCase()),s=o.FormData&&t instanceof o.FormData,!(Array.prototype.indexOf.call(tT,n,void 0)>=0)||i||s||r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),r))this.g.setRequestHeader(e,a);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(t),this.v=!1}catch(e){tC(this,e)}},t.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,en(this,"complete"),en(this,"abort"),tk(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),tk(this,!0)),tb.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?tS(this):this.Xa())},t.Xa=function(){tS(this)},t.isActive=function(){return!!this.g},t.ca=function(){try{return tR(this)>2?this.g.status:-1}catch(e){return -1}},t.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},t.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),eh(t)}},t.ya=function(){return this.o},t.Ha=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=tx.prototype).ka=8,t.I=1,t.connect=function(e,t,n,r){eE(0),this.W=e,this.H=t||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.J=tG(this,null,this.W),tL(this)},t.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;let i=new ex(this,this.j,e),s=this.o;if(this.U&&(s?z(s=j(s),this.U):s=this.U),null!==this.u||this.R||(i.J=s,s=null),this.S)e:{for(var t=0,n=0;n<this.i.length;n++){t:{var r=this.i[n];if("__data__"in r.map&&"string"==typeof(r=r.map.__data__)){r=r.length;break t}r=void 0}if(void 0===r)break;if((t+=r)>4096){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=tU(this,i,t),e6(n=e0(this.J),"RID",e),e6(n,"CVER",22),this.G&&e6(n,"X-HTTP-Session-Id",this.G),tF(this,n),s&&(this.R?t="headers="+eA(tv(s))+"&"+t:this.u&&tw(n,this.u,s)),eQ(this.h,i),this.Ra&&e6(n,"TYPE","init"),this.S?(e6(n,"$req",t),e6(n,"SID","null"),i.U=!0,eL(i,n,null)):eL(i,n,t),this.I=2}}else 3==this.I&&(e?tM(this,e):0==this.i.length||eH(this.h)||tM(this))},t.Da=function(){if(this.v=null,tz(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=eC(h(this.Wa,this),e)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,eE(10),tD(this),tz(this))},t.Va=function(){null!=this.C&&(this.C=null,tD(this),tj(this),eE(19))},t.bb=function(e){e?(this.j.info("Successfully pinged google.com"),eE(2)):(this.j.info("Failed to ping google.com"),eE(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=tY.prototype).ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){},tX.prototype.g=function(e,t){return new tJ(e,t)},c(tJ,et),tJ.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},tJ.prototype.close=function(){tP(this.g)},tJ.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=el(e),e=n);t.i.push(new e$(t.Ya++,e)),3==t.I&&tL(t)},tJ.prototype.N=function(){this.g.l=null,delete this.j,tP(this.g),delete this.g,tJ.Z.N.call(this)},c(tZ,ep),c(t0,em),c(t1,tY),t1.prototype.ra=function(){en(this.g,"a")},t1.prototype.qa=function(e){en(this.g,new tZ(e))},t1.prototype.pa=function(e){en(this.g,new t0)},t1.prototype.oa=function(){en(this.g,"b")},tX.prototype.createWebChannel=tX.prototype.g,tJ.prototype.send=tJ.prototype.o,tJ.prototype.open=tJ.prototype.m,tJ.prototype.close=tJ.prototype.close,x=iD.createWebChannelTransport=function(){return new tX},A=iD.getStatEventTarget=function(){return e_()},N=iD.Event=eg,R=iD.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},ek.NO_ERROR=0,ek.TIMEOUT=8,ek.HTTP_ERROR=6,k=iD.ErrorCode=ek,eR.COMPLETE="complete",S=iD.EventType=eR,ed.EventType=ef,ef.OPEN="a",ef.CLOSE="b",ef.ERROR="c",ef.MESSAGE="d",et.prototype.listen=et.prototype.J,I=iD.WebChannel=ed,iD.FetchXmlHttpFactory=tp,tb.prototype.listenOnce=tb.prototype.K,tb.prototype.getLastError=tb.prototype.Ha,tb.prototype.getLastErrorCode=tb.prototype.ya,tb.prototype.getStatus=tb.prototype.ca,tb.prototype.getResponseJson=tb.prototype.La,tb.prototype.getResponseText=tb.prototype.la,tb.prototype.send=tb.prototype.ea,tb.prototype.setWithCredentials=tb.prototype.Fa,C=iD.XhrIo=tb}).apply(void 0!==iP?iP:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});let iO="@firebase/firestore",iL="4.9.2";class iM{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}iM.UNAUTHENTICATED=new iM(null),iM.GOOGLE_CREDENTIALS=new iM("google-credentials-uid"),iM.FIRST_PARTY=new iM("first-party-uid"),iM.MOCK_USER=new iM("mock-user");let iF="12.3.0",iU=new e$("@firebase/firestore");function iV(){return iU.logLevel}function ij(e,...t){if(iU.logLevel<=b.DEBUG){let n=t.map(iB);iU.debug(`Firestore (${iF}): ${e}`,...n)}}function iq(e,...t){if(iU.logLevel<=b.ERROR){let n=t.map(iB);iU.error(`Firestore (${iF}): ${e}`,...n)}}function iz(e,...t){if(iU.logLevel<=b.WARN){let n=t.map(iB);iU.warn(`Firestore (${iF}): ${e}`,...n)}}function iB(e){if("string"==typeof e)return e;try{return JSON.stringify(e)}catch(t){return e}}function i$(e,t,n){let r="Unexpected state";"string"==typeof t?r=t:n=t,iW(e,r,n)}function iW(e,t,n){let r=`FIRESTORE (${iF}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(e){r+=" CONTEXT: "+n}throw iq(r),Error(r)}function iH(e,t,n,r){let i="Unexpected state";"string"==typeof n?i=n:r=n,e||iW(t,i,r)}let iK={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class iG extends ed{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class iQ{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class iY{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class iX{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(iM.UNAUTHENTICATED))}shutdown(){}}class iJ{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class iZ{constructor(e){this.t=e,this.currentUser=iM.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){iH(void 0===this.o,42304);let n=this.i,r=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve(),i=new iQ;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new iQ,e.enqueueRetryable(()=>r(this.currentUser))};let s=()=>{let t=i;e.enqueueRetryable(async()=>{await t.promise,await r(this.currentUser)})},o=e=>{ij("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>o(e)),setTimeout(()=>{if(!this.auth){let e=this.t.getImmediate({optional:!0});e?o(e):(ij("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new iQ)}},0),s()}getToken(){let e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(ij("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(iH("string"==typeof t.accessToken,31837,{l:t}),new iY(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){let e=this.auth&&this.auth.getUid();return iH(null===e||"string"==typeof e,2055,{h:e}),new iM(e)}}class i0{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=iM.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);let e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class i1{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new i0(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(iM.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class i2{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class i3{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,th(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){iH(void 0===this.o,3512);let n=e=>{null!=e.error&&ij("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);let n=e.token!==this.m;return this.m=e.token,ij("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>n(t))};let r=e=>{ij("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>r(e)),setTimeout(()=>{if(!this.appCheck){let e=this.V.getImmediate({optional:!0});e?r(e):ij("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new i2(this.p));let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(iH("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new i2(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}class i6{static newId(){let e=62*Math.floor(256/62),t="";for(;t.length<20;){let n=function(e){let t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(40);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let e=0;e<40;e++)n[e]=Math.floor(256*Math.random());return n}(0);for(let r=0;r<n.length;++r)t.length<20&&n[r]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return t}}function i4(e,t){return e<t?-1:+(e>t)}function i5(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=e.charAt(r),i=t.charAt(r);if(n!==i)return i8(n)===i8(i)?i4(n,i):i8(n)?1:-1}return i4(e.length,t.length)}function i8(e){let t=e.charCodeAt(0);return t>=55296&&t<=57343}function i7(e,t,n){return e.length===t.length&&e.every((e,r)=>n(e,t[r]))}let i9="__name__";class se{constructor(e,t,n){void 0===t?t=0:t>e.length&&i$(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&i$(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===se.comparator(this,e)}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof se?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let n=Math.min(e.length,t.length);for(let r=0;r<n;r++){let n=se.compareSegments(e.get(r),t.get(r));if(0!==n)return n}return i4(e.length,t.length)}static compareSegments(e,t){let n=se.isNumericId(e),r=se.isNumericId(t);return n&&!r?-1:!n&&r?1:n&&r?se.extractNumericId(e).compare(se.extractNumericId(t)):i5(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return E.fromString(e.substring(4,e.length-2))}}class st extends se{construct(e,t,n){return new st(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){let t=[];for(let n of e){if(n.indexOf("//")>=0)throw new iG(iK.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter(e=>e.length>0))}return new st(t)}static emptyPath(){return new st([])}}let sn=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class sr extends se{construct(e,t,n){return new sr(e,t,n)}static isValidIdentifier(e){return sn.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),sr.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===i9}static keyField(){return new sr([i9])}static fromServerFormat(e){let t=[],n="",r=0,i=()=>{if(0===n.length)throw new iG(iK.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""},s=!1;for(;r<e.length;){let t=e[r];if("\\"===t){if(r+1===e.length)throw new iG(iK.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let t=e[r+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new iG(iK.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,r+=2}else"`"===t?s=!s:"."!==t||s?n+=t:i(),r++}if(i(),s)throw new iG(iK.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new sr(t)}static emptyPath(){return new sr([])}}class si{constructor(e){this.path=e}static fromPath(e){return new si(st.fromString(e))}static fromName(e){return new si(st.fromString(e).popFirst(5))}static empty(){return new si(st.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===st.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return st.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new si(new st(e.slice()))}}function ss(e,t,n){if(!n)throw new iG(iK.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function so(e){if(!si.isDocumentKey(e))throw new iG(iK.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function sa(e){if(si.isDocumentKey(e))throw new iG(iK.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function sl(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function sh(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{var t;let n=(t=e).constructor?t.constructor.name:null;return n?`a custom ${n} object`:"an object"}}return"function"==typeof e?"a function":i$(12329,{type:typeof e})}function su(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new iG(iK.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let n=sh(e);throw new iG(iK.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function sc(e,t){let n={typeString:e};return t&&(n.value=t),n}function sd(e,t){let n;if(!sl(e))throw new iG(iK.INVALID_ARGUMENT,"JSON must be an object");for(let r in t)if(t[r]){let i=t[r].typeString,s="value"in t[r]?{value:t[r].value}:void 0;if(!(r in e)){n=`JSON missing required field: '${r}'`;break}let o=e[r];if(i&&typeof o!==i){n=`JSON field '${r}' must be a ${i}.`;break}if(void 0!==s&&o!==s.value){n=`Expected '${r}' field to equal '${s.value}'`;break}}if(n)throw new iG(iK.INVALID_ARGUMENT,n);return!0}class sf{static now(){return sf.fromMillis(Date.now())}static fromDate(e){return sf.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*1e6);return new sf(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0||t>=1e9)throw new iG(iK.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-0xe7791f700||e>=0x3afff44180)throw new iG(iK.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?i4(this.nanoseconds,e.nanoseconds):i4(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:sf._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(sd(e,sf._jsonSchema))return new sf(e.seconds,e.nanoseconds)}valueOf(){return String(this.seconds- -0xe7791f700).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}sf._jsonSchemaVersion="firestore/timestamp/1.0",sf._jsonSchema={type:sc("string",sf._jsonSchemaVersion),seconds:sc("number"),nanoseconds:sc("number")};class sp{static fromTimestamp(e){return new sp(e)}static min(){return new sp(new sf(0,0))}static max(){return new sp(new sf(0x3afff4417f,0x3b9ac9ff))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class sm{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new sm(sp.min(),si.empty(),-1)}static max(){return new sm(sp.max(),si.empty(),-1)}}class sg{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function sy(e){if(e.code!==iK.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==e.message)throw e;ij("LocalStore","Unexpectedly lost primary lease")}class s_{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&i$(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new s_((n,r)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,r)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof s_?t:s_.resolve(t)}catch(e){return s_.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):s_.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):s_.reject(t)}static resolve(e){return new s_((t,n)=>{t(e)})}static reject(e){return new s_((t,n)=>{n(e)})}static waitFor(e){return new s_((t,n)=>{let r=0,i=0,s=!1;e.forEach(e=>{++r,e.next(()=>{++i,s&&i===r&&t()},e=>n(e))}),s=!0,i===r&&t()})}static or(e){let t=s_.resolve(!1);for(let n of e)t=t.next(e=>e?s_.resolve(e):n());return t}static forEach(e,t){let n=[];return e.forEach((e,r)=>{n.push(t.call(this,e,r))}),this.waitFor(n)}static mapArray(e,t){return new s_((n,r)=>{let i=e.length,s=Array(i),o=0;for(let a=0;a<i;a++){let l=a;t(e[l]).next(e=>{s[l]=e,++o===i&&n(s)},e=>r(e))}})}static doWhile(e,t){return new s_((n,r)=>{let i=()=>{!0===e()?t().next(()=>{i()},r):n()};i()})}}function sv(e){return"IndexedDbTransactionError"===e.name}class sw{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){let e=++this.previousValue;return this.ue&&this.ue(e),e}}sw.ce=-1;function sb(e){return 0===e&&1/e==-1/0}function sE(e){let t=0;for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function sT(e,t){for(let n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function sC(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class sI{constructor(e,t){this.comparator=e,this.root=t||sk.EMPTY}insert(e,t){return new sI(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,sk.BLACK,null,null))}remove(e){return new sI(this.comparator,this.root.remove(e,this.comparator).copy(null,null,sk.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){let r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return -1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,n)=>(e(t,n),!1))}toString(){let e=[];return this.inorderTraversal((t,n)=>(e.push(`${t}:${n}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new sS(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new sS(this.root,e,this.comparator,!1)}getReverseIterator(){return new sS(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new sS(this.root,e,this.comparator,!0)}}class sS{constructor(e,t,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?n(e.key,t):1,t&&r&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class sk{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:sk.RED,this.left=null!=r?r:sk.EMPTY,this.right=null!=i?i:sk.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,r,i){return new sk(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}removeMin(){if(this.left.isEmpty())return sk.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()}remove(e,t){let n,r=this;if(0>t(e,r.key))r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return sk.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}rotateLeft(){let e=this.copy(null,null,sk.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){let e=this.copy(null,null,sk.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){return Math.pow(2,this.check())<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw i$(43730,{key:this.key,value:this.value});if(this.right.isRed())throw i$(14113,{key:this.key,value:this.value});let e=this.left.check();if(e!==this.right.check())throw i$(27949);return e+ +!this.isRed()}}sk.EMPTY=null,sk.RED=!0,sk.BLACK=!1,sk.EMPTY=new class{constructor(){this.size=0}get key(){throw i$(57766)}get value(){throw i$(16141)}get color(){throw i$(16727)}get left(){throw i$(29726)}get right(){throw i$(36894)}copy(e,t,n,r,i){return this}insert(e,t,n){return new sk(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class sR{constructor(e){this.comparator=e,this.data=new sI(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,n)=>(e(t),!1))}forEachInRange(e,t){let n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){let r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new sN(this.data.getIterator())}getIteratorFrom(e){return new sN(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof sR)||this.size!==e.size)return!1;let t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(0!==this.comparator(e,r))return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new sR(this.comparator);return t.data=e,t}}class sN{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class sA{constructor(e){this.fields=e,e.sort(sr.comparator)}static empty(){return new sA([])}unionWith(e){let t=new sR(sr.comparator);for(let e of this.fields)t=t.add(e);for(let n of e)t=t.add(n);return new sA(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return i7(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class sx extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class sP{constructor(e){this.binaryString=e}static fromBase64String(e){return new sP(function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new sx("Invalid base64 string: "+e):e}}(e))}static fromUint8Array(e){return new sP(function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e))}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){var e=this.binaryString;let t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return i4(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}sP.EMPTY_BYTE_STRING=new sP("");let sD=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function sO(e){if(iH(!!e,39018),"string"==typeof e){let t=0,n=sD.exec(e);if(iH(!!n,46558,{timestamp:e}),n[1]){let e=n[1];t=Number(e=(e+"000000000").substr(0,9))}return{seconds:Math.floor(new Date(e).getTime()/1e3),nanos:t}}return{seconds:sL(e.seconds),nanos:sL(e.nanos)}}function sL(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function sM(e){return"string"==typeof e?sP.fromBase64String(e):sP.fromUint8Array(e)}let sF="server_timestamp",sU="__type__",sV="__previous_value__",sj="__local_write_time__";function sq(e){return(e?.mapValue?.fields||{})[sU]?.stringValue===sF}function sz(e){let t=e.mapValue.fields[sV];return sq(t)?sz(t):t}function sB(e){let t=sO(e.mapValue.fields[sj].timestampValue);return new sf(t.seconds,t.nanos)}class s${constructor(e,t,n,r,i,s,o,a,l,h){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=l,this.isUsingEmulator=h}}let sW="(default)";class sH{constructor(e,t){this.projectId=e,this.database=t||sW}static empty(){return new sH("","")}get isDefaultDatabase(){return this.database===sW}isEqual(e){return e instanceof sH&&e.projectId===this.projectId&&e.database===this.database}}let sK="__type__",sG="__max__",sQ={},sY="__vector__",sX="value";function sJ(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?sq(e)?4:on(e)?0x1fffffffffffff:oe(e)?10:11:i$(28295,{value:e})}function sZ(e,t){if(e===t)return!0;let n=sJ(e);if(n!==sJ(t))return!1;switch(n){case 0:case 0x1fffffffffffff:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return sB(e).isEqual(sB(t));case 3:if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;let r=sO(e.timestampValue),i=sO(t.timestampValue);return r.seconds===i.seconds&&r.nanos===i.nanos;case 5:return e.stringValue===t.stringValue;case 6:return sM(e.bytesValue).isEqual(sM(t.bytesValue));case 7:return e.referenceValue===t.referenceValue;case 8:return sL(e.geoPointValue.latitude)===sL(t.geoPointValue.latitude)&&sL(e.geoPointValue.longitude)===sL(t.geoPointValue.longitude);case 2:if("integerValue"in e&&"integerValue"in t)return sL(e.integerValue)===sL(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){let n=sL(e.doubleValue),r=sL(t.doubleValue);return n===r?sb(n)===sb(r):isNaN(n)&&isNaN(r)}return!1;case 9:return i7(e.arrayValue.values||[],t.arrayValue.values||[],sZ);case 10:case 11:let s=e.mapValue.fields||{},o=t.mapValue.fields||{};if(sE(s)!==sE(o))return!1;for(let e in s)if(s.hasOwnProperty(e)&&(void 0===o[e]||!sZ(s[e],o[e])))return!1;return!0;default:return i$(52216,{left:e})}}function s0(e,t){return void 0!==(e.values||[]).find(e=>sZ(e,t))}function s1(e,t){var n,r,i,s,o,a;if(e===t)return 0;let l=sJ(e),h=sJ(t);if(l!==h)return i4(l,h);switch(l){case 0:case 0x1fffffffffffff:return 0;case 1:return i4(e.booleanValue,t.booleanValue);case 2:let u,c;return u=sL(e.integerValue||e.doubleValue),u<(c=sL(t.integerValue||t.doubleValue))?-1:u>c?1:u===c?0:isNaN(u)?isNaN(c)?0:-1:1;case 3:return s2(e.timestampValue,t.timestampValue);case 4:return s2(sB(e),sB(t));case 5:return i5(e.stringValue,t.stringValue);case 6:let d,f;return n=e.bytesValue,r=t.bytesValue,d=sM(n),f=sM(r),d.compareTo(f);case 7:return function(e,t){let n=e.split("/"),r=t.split("/");for(let e=0;e<n.length&&e<r.length;e++){let t=i4(n[e],r[e]);if(0!==t)return t}return i4(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:let p;return i=e.geoPointValue,s=t.geoPointValue,0!==(p=i4(sL(i.latitude),sL(s.latitude)))?p:i4(sL(i.longitude),sL(s.longitude));case 9:return s3(e.arrayValue,t.arrayValue);case 10:let m,g,y,_,v;return o=e.mapValue,a=t.mapValue,m=o.fields||{},g=a.fields||{},y=m[sX]?.arrayValue,_=g[sX]?.arrayValue,0!==(v=i4(y?.values?.length||0,_?.values?.length||0))?v:s3(y,_);case 11:return function(e,t){if(e===sQ&&t===sQ)return 0;if(e===sQ)return 1;if(t===sQ)return -1;let n=e.fields||{},r=Object.keys(n),i=t.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let e=0;e<r.length&&e<s.length;++e){let t=i5(r[e],s[e]);if(0!==t)return t;let o=s1(n[r[e]],i[s[e]]);if(0!==o)return o}return i4(r.length,s.length)}(e.mapValue,t.mapValue);default:throw i$(23264,{he:l})}}function s2(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return i4(e,t);let n=sO(e),r=sO(t),i=i4(n.seconds,r.seconds);return 0!==i?i:i4(n.nanos,r.nanos)}function s3(e,t){let n=e.values||[],r=t.values||[];for(let e=0;e<n.length&&e<r.length;++e){let t=s1(n[e],r[e]);if(t)return t}return i4(n.length,r.length)}function s6(e){var t,n;let r;return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?(r=sO(e.timestampValue),`time(${r.seconds},${r.nanos})`):"stringValue"in e?e.stringValue:"bytesValue"in e?sM(e.bytesValue).toBase64():"referenceValue"in e?(t=e.referenceValue,si.fromName(t).toString()):"geoPointValue"in e?(n=e.geoPointValue,`geo(${n.latitude},${n.longitude})`):"arrayValue"in e?function(e){let t="[",n=!0;for(let r of e.values||[])n?n=!1:t+=",",t+=s6(r);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){let t=Object.keys(e.fields||{}).sort(),n="{",r=!0;for(let i of t)r?r=!1:n+=",",n+=`${i}:${s6(e.fields[i])}`;return n+"}"}(e.mapValue):i$(61005,{value:e})}function s4(e){return!!e&&"integerValue"in e}function s5(e){return!!e&&"arrayValue"in e}function s8(e){return!!e&&"nullValue"in e}function s7(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function s9(e){return!!e&&"mapValue"in e}function oe(e){return(e?.mapValue?.fields||{})[sK]?.stringValue===sY}function ot(e){if(e.geoPointValue)return{geoPointValue:{...e.geoPointValue}};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:{...e.timestampValue}};if(e.mapValue){let t={mapValue:{fields:{}}};return sT(e.mapValue.fields,(e,n)=>t.mapValue.fields[e]=ot(n)),t}if(e.arrayValue){let t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=ot(e.arrayValue.values[n]);return t}return{...e}}function on(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===sG}class or{constructor(e){this.value=e}static empty(){return new or({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(!s9(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ot(t)}setAll(e){let t=sr.emptyPath(),n={},r=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){let e=this.getFieldsMap(t);this.applyChanges(e,n,r),n={},r=[],t=i.popLast()}e?n[i.lastSegment()]=ot(e):r.push(i.lastSegment())});let i=this.getFieldsMap(t);this.applyChanges(i,n,r)}delete(e){let t=this.field(e.popLast());s9(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return sZ(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let r=t.mapValue.fields[e.get(n)];s9(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,n){for(let r of(sT(t,(t,n)=>e[t]=n),n))delete e[r]}clone(){return new or(ot(this.value))}}class oi{constructor(e,t,n,r,i,s,o){this.key=e,this.documentType=t,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new oi(e,0,sp.min(),sp.min(),sp.min(),or.empty(),0)}static newFoundDocument(e,t,n,r){return new oi(e,1,t,sp.min(),n,r,0)}static newNoDocument(e,t){return new oi(e,2,t,sp.min(),sp.min(),or.empty(),0)}static newUnknownDocument(e,t){return new oi(e,3,t,sp.min(),sp.min(),or.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(sp.min())&&(2===this.documentType||0===this.documentType)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=or.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=or.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=sp.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof oi&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new oi(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class os{constructor(e,t){this.position=e,this.inclusive=t}}function oo(e,t,n){let r=0;for(let i=0;i<e.position.length;i++){let s=t[i],o=e.position[i];if(r=s.field.isKeyField()?si.comparator(si.fromName(o.referenceValue),n.key):s1(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function oa(e,t){if(null===e)return null===t;if(null===t||e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!sZ(e.position[n],t.position[n]))return!1;return!0}class ol{constructor(e,t="asc"){this.field=e,this.dir=t}}class oh{}class ou extends oh{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new op(e,t,n):"array-contains"===t?new o_(e,n):"in"===t?new ov(e,n):"not-in"===t?new ow(e,n):"array-contains-any"===t?new ob(e,n):new ou(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new om(e,n):new og(e,n)}matches(e){let t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(s1(t,this.value)):null!==t&&sJ(this.value)===sJ(t)&&this.matchesComparison(s1(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return i$(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class oc extends oh{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new oc(e,t)}matches(e){return od(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function od(e){return"and"===e.op}function of(e){for(let t of e.filters)if(t instanceof oc)return!1;return!0}class op extends ou{constructor(e,t,n){super(e,t,n),this.key=si.fromName(n.referenceValue)}matches(e){let t=si.comparator(e.key,this.key);return this.matchesComparison(t)}}class om extends ou{constructor(e,t){super(e,"in",t),this.keys=oy("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class og extends ou{constructor(e,t){super(e,"not-in",t),this.keys=oy("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function oy(e,t){return(t.arrayValue?.values||[]).map(e=>si.fromName(e.referenceValue))}class o_ extends ou{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return s5(t)&&s0(t.arrayValue,this.value)}}class ov extends ou{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return null!==t&&s0(this.value.arrayValue,t)}}class ow extends ou{constructor(e,t){super(e,"not-in",t)}matches(e){if(s0(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!s0(this.value.arrayValue,t)}}class ob extends ou{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!(!s5(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>s0(this.value.arrayValue,e))}}class oE{constructor(e,t=null,n=[],r=[],i=null,s=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.Te=null}}function oT(e,t=null,n=[],r=[],i=null,s=null,o=null){return new oE(e,t,n,r,i,s,o)}function oC(e){if(null===e.Te){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(e=>(function e(t){if(t instanceof ou)return t.field.canonicalString()+t.op.toString()+s6(t.value);if(of(t)&&od(t))return t.filters.map(t=>e(t)).join(",");{let n=t.filters.map(t=>e(t)).join(",");return`${t.op}(${n})`}})(e)).join(","),t+="|ob:",t+=e.orderBy.map(e=>e.field.canonicalString()+e.dir).join(","),null==e.limit||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>s6(e)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>s6(e)).join(",")),e.Te=t}return e.Te}function oI(e,t){if(e.limit!==t.limit||e.orderBy.length!==t.orderBy.length)return!1;for(let i=0;i<e.orderBy.length;i++){var n,r;if(n=e.orderBy[i],r=t.orderBy[i],!(n.dir===r.dir&&n.field.isEqual(r.field)))return!1}if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!function e(t,n){return t instanceof ou?n instanceof ou&&t.op===n.op&&t.field.isEqual(n.field)&&sZ(t.value,n.value):t instanceof oc?n instanceof oc&&t.op===n.op&&t.filters.length===n.filters.length&&t.filters.reduce((t,r,i)=>t&&e(r,n.filters[i]),!0):void i$(19439)}(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!oa(e.startAt,t.startAt)&&oa(e.endAt,t.endAt)}function oS(e){return si.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class ok{constructor(e,t=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function oR(e){return new ok(e)}function oN(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function oA(e){if(null===e.Ie){let t;e.Ie=[];let n=new Set;for(let t of e.explicitOrderBy)e.Ie.push(t),n.add(t.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(t=new sR(sr.comparator),e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t).forEach(t=>{n.has(t.canonicalString())||t.isKeyField()||e.Ie.push(new ol(t,r))}),n.has(sr.keyField().canonicalString())||e.Ie.push(new ol(sr.keyField(),r))}return e.Ie}function ox(e){return e.Ee||(e.Ee=function(e,t){if("F"===e.limitType)return oT(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{let t="desc"===e.dir?"asc":"desc";return new ol(e.field,t)});let n=e.endAt?new os(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new os(e.startAt.position,e.startAt.inclusive):null;return oT(e.path,e.collectionGroup,t,e.filters,e.limit,n,r)}}(e,oA(e))),e.Ee}function oP(e,t,n){return new ok(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function oD(e,t){return oI(ox(e),ox(t))&&e.limitType===t.limitType}function oO(e){return`${oC(ox(e))}|lt:${e.limitType}`}function oL(e){var t;let n;return`Query(target=${n=(t=ox(e)).path.canonicalString(),null!==t.collectionGroup&&(n+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(n+=`, filters: [${t.filters.map(e=>(function e(t){return t instanceof ou?`${t.field.canonicalString()} ${t.op} ${s6(t.value)}`:t instanceof oc?t.op.toString()+" {"+t.getFilters().map(e).join(" ,")+"}":"Filter"})(e)).join(", ")}]`),null==t.limit||(n+=", limit: "+t.limit),t.orderBy.length>0&&(n+=`, orderBy: [${t.orderBy.map(e=>`${e.field.canonicalString()} (${e.dir})`).join(", ")}]`),t.startAt&&(n+=", startAt: ",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map(e=>s6(e)).join(",")),t.endAt&&(n+=", endAt: ",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map(e=>s6(e)).join(",")),`Target(${n})`}; limitType=${e.limitType})`}function oM(e,t){var n,r,i,s;let o,a,l;return t.isFoundDocument()&&(o=t.key.path,null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(o):si.isDocumentKey(e.path)?e.path.isEqual(o):e.path.isImmediateParentOf(o))&&function(e,t){for(let n of oA(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(let n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&(n=e,r=t,(!n.startAt||(i=n.startAt,a=oo(i,oA(n),r),i.inclusive?!!(a<=0):!!(a<0)))&&(!n.endAt||(s=n.endAt,l=oo(s,oA(n),r),s.inclusive?!!(l>=0):!!(l>0))))}function oF(e){return(t,n)=>{let r=!1;for(let i of oA(e)){let e=function(e,t,n){var r;let i,s,o=e.field.isKeyField()?si.comparator(t.key,n.key):(r=e.field,i=t.data.field(r),s=n.data.field(r),null!==i&&null!==s?s1(i,s):i$(42886));switch(e.dir){case"asc":return o;case"desc":return -1*o;default:return i$(19790,{direction:e.dir})}}(i,t,n);if(0!==e)return e;r=r||i.field.isKeyField()}return 0}}class oU{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){for(let[t,r]of n)if(this.equalsFn(t,e))return r}}has(e){return void 0!==this.get(e)}set(e,t){let n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return void(r[n]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(e){sT(this.inner,(t,n)=>{for(let[t,r]of n)e(t,r)})}isEmpty(){return sC(this.inner)}size(){return this.innerSize}}let oV=new sI(si.comparator),oj=new sI(si.comparator);function oq(...e){let t=oj;for(let n of e)t=t.insert(n.key,n);return t}function oz(e){let t=oj;return e.forEach((e,n)=>t=t.insert(e,n.overlayedDocument)),t}function oB(){return new oU(e=>e.toString(),(e,t)=>e.isEqual(t))}let o$=new sI(si.comparator),oW=new sR(si.comparator);function oH(...e){let t=oW;for(let n of e)t=t.add(n);return t}let oK=new sR(i4);function oG(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:sb(t)?"-0":t}}function oQ(e){return{integerValue:""+e}}class oY{constructor(){this._=void 0}}function oX(e,t){return e instanceof o3?s4(t)||t&&"doubleValue"in t?t:{integerValue:0}:null}class oJ extends oY{}class oZ extends oY{constructor(e){super(),this.elements=e}}function o0(e,t){let n=o4(t);for(let t of e.elements)n.some(e=>sZ(e,t))||n.push(t);return{arrayValue:{values:n}}}class o1 extends oY{constructor(e){super(),this.elements=e}}function o2(e,t){let n=o4(t);for(let t of e.elements)n=n.filter(e=>!sZ(e,t));return{arrayValue:{values:n}}}class o3 extends oY{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function o6(e){return sL(e.integerValue||e.doubleValue)}function o4(e){return s5(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class o5{constructor(e,t){this.field=e,this.transform=t}}class o8{constructor(e,t){this.version=e,this.transformResults=t}}class o7{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new o7}static exists(e){return new o7(void 0,e)}static updateTime(e){return new o7(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function o9(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class ae{}function at(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new ah(e.key,o7.none()):new ai(e.key,e.data,o7.none());{let n=e.data,r=or.empty(),i=new sR(sr.comparator);for(let e of t.fields)if(!i.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?r.delete(e):r.set(e,t),i=i.add(e)}return new as(e.key,r,new sA(i.toArray()),o7.none())}}function an(e,t,n,r){return e instanceof ai?function(e,t,n,r){if(!o9(e.precondition,t))return n;let i=e.value.clone(),s=al(e.fieldTransforms,r,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,n,r):e instanceof as?function(e,t,n,r){if(!o9(e.precondition,t))return n;let i=al(e.fieldTransforms,r,t),s=t.data;return(s.setAll(ao(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===n)?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,n,r):o9(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}function ar(e,t){var n,r;return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&(n=e.fieldTransforms,r=t.fieldTransforms,!!(void 0===n&&void 0===r||!(!n||!r)&&i7(n,r,(e,t)=>{var n,r;return e.field.isEqual(t.field)&&(n=e.transform,r=t.transform,n instanceof oZ&&r instanceof oZ||n instanceof o1&&r instanceof o1?i7(n.elements,r.elements,sZ):n instanceof o3&&r instanceof o3?sZ(n.Ae,r.Ae):n instanceof oJ&&r instanceof oJ)})))&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class ai extends ae{constructor(e,t,n,r=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class as extends ae{constructor(e,t,n,r,i=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function ao(e){let t=new Map;return e.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){let r=e.data.field(n);t.set(n,r)}}),t}function aa(e,t,n){let r=new Map;iH(e.length===n.length,32656,{Re:n.length,Ve:e.length});for(let s=0;s<n.length;s++){var i;let o=e[s],a=o.transform,l=t.data.field(o.field);r.set(o.field,(i=n[s],a instanceof oZ?o0(a,l):a instanceof o1?o2(a,l):i))}return r}function al(e,t,n){let r=new Map;for(let i of e){let e=i.transform,s=n.data.field(i.field);r.set(i.field,function(e,t,n){var r;let i,s,o;return e instanceof oJ?(r=t,i={fields:{[sU]:{stringValue:sF},[sj]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}},r&&sq(r)&&(r=sz(r)),r&&(i.fields[sV]=r),{mapValue:i}):e instanceof oZ?o0(e,t):e instanceof o1?o2(e,t):(o=o6(s=oX(e,t))+o6(e.Ae),s4(s)&&s4(e.Ae)?oQ(o):oG(e.serializer,o))}(e,s,t))}return r}class ah extends ae{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class au extends ae{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class ac{constructor(e,t,n,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(e,t){let n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){let r=this.mutations[t];r.key.isEqual(e.key)&&function(e,t,n){let r,i;e instanceof ai?(r=e.value.clone(),i=aa(e.fieldTransforms,t,n.transformResults),r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()):e instanceof as?function(e,t,n){if(!o9(e.precondition,t))return t.convertToUnknownDocument(n.version);let r=aa(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(ao(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):t.convertToNoDocument(n.version).setHasCommittedMutations()}(r,e,n[t])}}applyToLocalView(e,t){for(let n of this.baseMutations)n.key.isEqual(e.key)&&(t=an(n,e,t,this.localWriteTime));for(let n of this.mutations)n.key.isEqual(e.key)&&(t=an(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let n=oB();return this.mutations.forEach(r=>{let i=e.get(r.key),s=i.overlayedDocument,o=this.applyToLocalView(s,i.mutatedFields),a=at(s,o=t.has(r.key)?null:o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(sp.min())}),n}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),oH())}isEqual(e){return this.batchId===e.batchId&&i7(this.mutations,e.mutations,(e,t)=>ar(e,t))&&i7(this.baseMutations,e.baseMutations,(e,t)=>ar(e,t))}}class ad{constructor(e,t,n,r){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=r}static from(e,t,n){iH(e.mutations.length===n.length,58842,{me:e.mutations.length,fe:n.length});let r=o$,i=e.mutations;for(let e=0;e<i.length;e++)r=r.insert(i[e].key,n[e].version);return new ad(e,t,n,r)}}class af{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class ap{constructor(e,t){this.count=e,this.unchangedNames=t}}function am(e){if(void 0===e)return iq("GRPC error has no .code"),iK.UNKNOWN;switch(e){case P.OK:return iK.OK;case P.CANCELLED:return iK.CANCELLED;case P.UNKNOWN:return iK.UNKNOWN;case P.DEADLINE_EXCEEDED:return iK.DEADLINE_EXCEEDED;case P.RESOURCE_EXHAUSTED:return iK.RESOURCE_EXHAUSTED;case P.INTERNAL:return iK.INTERNAL;case P.UNAVAILABLE:return iK.UNAVAILABLE;case P.UNAUTHENTICATED:return iK.UNAUTHENTICATED;case P.INVALID_ARGUMENT:return iK.INVALID_ARGUMENT;case P.NOT_FOUND:return iK.NOT_FOUND;case P.ALREADY_EXISTS:return iK.ALREADY_EXISTS;case P.PERMISSION_DENIED:return iK.PERMISSION_DENIED;case P.FAILED_PRECONDITION:return iK.FAILED_PRECONDITION;case P.ABORTED:return iK.ABORTED;case P.OUT_OF_RANGE:return iK.OUT_OF_RANGE;case P.UNIMPLEMENTED:return iK.UNIMPLEMENTED;case P.DATA_LOSS:return iK.DATA_LOSS;default:return i$(39323,{code:e})}}(D=P||(P={}))[D.OK=0]="OK",D[D.CANCELLED=1]="CANCELLED",D[D.UNKNOWN=2]="UNKNOWN",D[D.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",D[D.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",D[D.NOT_FOUND=5]="NOT_FOUND",D[D.ALREADY_EXISTS=6]="ALREADY_EXISTS",D[D.PERMISSION_DENIED=7]="PERMISSION_DENIED",D[D.UNAUTHENTICATED=16]="UNAUTHENTICATED",D[D.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",D[D.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",D[D.ABORTED=10]="ABORTED",D[D.OUT_OF_RANGE=11]="OUT_OF_RANGE",D[D.UNIMPLEMENTED=12]="UNIMPLEMENTED",D[D.INTERNAL=13]="INTERNAL",D[D.UNAVAILABLE=14]="UNAVAILABLE",D[D.DATA_LOSS=15]="DATA_LOSS";let ag=new E([0xffffffff,0xffffffff],0);function ay(e){let t=(new TextEncoder).encode(e),n=new T;return n.update(t),new Uint8Array(n.digest())}function a_(e){let t=new DataView(e.buffer),n=t.getUint32(0,!0),r=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new E([n,r],0),new E([i,s],0)]}class av{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new aw(`Invalid padding: ${t}`);if(n<0||e.length>0&&0===this.hashCount)throw new aw(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new aw(`Invalid padding when bitmap length is 0: ${t}`);this.ge=8*e.length-t,this.pe=E.fromNumber(this.ge)}ye(e,t,n){let r=e.add(t.multiply(E.fromNumber(n)));return 1===r.compare(ag)&&(r=new E([r.getBits(0),r.getBits(1)],0)),r.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;let[t,n]=a_(ay(e));for(let e=0;e<this.hashCount;e++){let r=this.ye(t,n,e);if(!this.we(r))return!1}return!0}static create(e,t,n){let r=new av(new Uint8Array(Math.ceil(e/8)),e%8==0?0:8-e%8,t);return n.forEach(e=>r.insert(e)),r}insert(e){if(0===this.ge)return;let[t,n]=a_(ay(e));for(let e=0;e<this.hashCount;e++){let r=this.ye(t,n,e);this.Se(r)}}Se(e){let t=Math.floor(e/8);this.bitmap[t]|=1<<e%8}}class aw extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class ab{constructor(e,t,n,r,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,n){let r=new Map;return r.set(e,aE.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new ab(sp.min(),r,new sI(i4),oV,oH())}}class aE{constructor(e,t,n,r,i){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new aE(n,t,oH(),oH(),oH())}}class aT{constructor(e,t,n,r){this.be=e,this.removedTargetIds=t,this.key=n,this.De=r}}class aC{constructor(e,t){this.targetId=e,this.Ce=t}}class aI{constructor(e,t,n=sP.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=r}}class aS{constructor(){this.ve=0,this.Fe=aN(),this.Me=sP.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=oH(),t=oH(),n=oH();return this.Fe.forEach((r,i)=>{switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:i$(38017,{changeType:i})}}),new aE(this.Me,this.xe,e,t,n)}qe(){this.Oe=!1,this.Fe=aN()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,iH(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class ak{constructor(e){this.Ge=e,this.ze=new Map,this.je=oV,this.Je=aR(),this.He=aR(),this.Ye=new sI(i4)}Ze(e){for(let t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(let t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{let n=this.nt(t);switch(e.state){case 0:this.rt(t)&&n.Le(e.resumeToken);break;case 1:n.Ke(),n.Ne||n.qe(),n.Le(e.resumeToken);break;case 2:n.Ke(),n.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(n.We(),n.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),n.Le(e.resumeToken));break;default:i$(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,n)=>{this.rt(n)&&t(n)})}st(e){let t=e.targetId,n=e.Ce.count,r=this.ot(t);if(r){let i=r.target;if(oS(i))if(0===n){let e=new si(i.path);this.et(t,e,oi.newNoDocument(e,sp.min()))}else iH(1===n,20013,{expectedCount:n});else{let r=this._t(t);if(r!==n){let n=this.ut(e),i=n?this.ct(n,e,r):1;0!==i&&(this.it(t),this.Ye=this.Ye.insert(t,2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch"))}}}}ut(e){let t,n,r=e.Ce.unchangedNames;if(!r||!r.bits)return null;let{bits:{bitmap:i="",padding:s=0},hashCount:o=0}=r;try{t=sM(i).toUint8Array()}catch(e){if(e instanceof sx)return iz("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{n=new av(t,s,o)}catch(e){return iz(e instanceof aw?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===n.ge?null:n}ct(e,t,n){return 2*(t.Ce.count!==n-this.Pt(e,t.targetId))}Pt(e,t){let n=this.Ge.getRemoteKeysForTarget(t),r=0;return n.forEach(n=>{let i=this.Ge.ht(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;e.mightContain(s)||(this.et(t,n,null),r++)}),r}Tt(e){let t=new Map;this.ze.forEach((n,r)=>{let i=this.ot(r);if(i){if(n.current&&oS(i.target)){let t=new si(i.target.path);this.It(t).has(r)||this.Et(r,t)||this.et(r,t,oi.newNoDocument(t,e))}n.Be&&(t.set(r,n.ke()),n.qe())}});let n=oH();this.He.forEach((e,t)=>{let r=!0;t.forEachWhile(e=>{let t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(r=!1,!1)}),r&&(n=n.add(e))}),this.je.forEach((t,n)=>n.setReadTime(e));let r=new ab(e,t,this.Ye,this.je,n);return this.je=oV,this.Je=aR(),this.He=aR(),this.Ye=new sI(i4),r}Xe(e,t){if(!this.rt(e))return;let n=2*!!this.Et(e,t.key);this.nt(e).Qe(t.key,n),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,n){if(!this.rt(e))return;let r=this.nt(e);this.Et(e,t)?r.Qe(t,1):r.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),n&&(this.je=this.je.insert(t,n))}removeTarget(e){this.ze.delete(e)}_t(e){let t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new aS,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new sR(i4),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new sR(i4),this.Je=this.Je.insert(e,t)),t}rt(e){let t=null!==this.ot(e);return t||ij("WatchChangeAggregator","Detected inactive target",e),t}ot(e){let t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new aS),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function aR(){return new sI(si.comparator)}function aN(){return new sI(si.comparator)}let aA={asc:"ASCENDING",desc:"DESCENDING"},ax={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},aP={and:"AND",or:"OR"};class aD{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function aO(e,t){return e.useProto3Json||null==t?t:{value:t}}function aL(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function aM(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function aF(e){let t;return iH(!!e,49232),sp.fromTimestamp(new sf((t=sO(e)).seconds,t.nanos))}function aU(e,t){return aV(e,t).canonicalString()}function aV(e,t){let n=new st(["projects",e.projectId,"databases",e.database]).child("documents");return void 0===t?n:n.child(t)}function aj(e){let t=st.fromString(e);return iH(aQ(t),10190,{key:t.toString()}),t}function aq(e,t){return aU(e.databaseId,t.path)}function az(e,t){let n=aj(t);if(n.get(1)!==e.databaseId.projectId)throw new iG(iK.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new iG(iK.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new si(aW(n))}function aB(e,t){return aU(e.databaseId,t)}function a$(e){return new st(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function aW(e){return iH(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function aH(e,t,n){return{name:aq(e,t),fields:n.value.mapValue.fields}}function aK(e){return{fieldPath:e.canonicalString()}}function aG(e){return sr.fromServerFormat(e.fieldPath)}function aQ(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class aY{constructor(e,t,n,r,i=sp.min(),s=sp.min(),o=sP.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new aY(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new aY(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new aY(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new aY(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class aX{constructor(e){this.yt=e}}class aJ{Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(+!!e.booleanValue);else if("integerValue"in e)this.Ft(t,15),t.Mt(sL(e.integerValue));else if("doubleValue"in e){let n=sL(e.doubleValue);isNaN(n)?this.Ft(t,13):(this.Ft(t,15),sb(n)?t.Mt(0):t.Mt(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ft(t,20),"string"==typeof n&&(n=sO(n)),t.xt(`${n.seconds||""}`),t.Mt(n.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(sM(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){let n=e.geoPointValue;this.Ft(t,45),t.Mt(n.latitude||0),t.Mt(n.longitude||0)}else"mapValue"in e?on(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):oe(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):i$(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){let n=e.fields||{};for(let e of(this.Ft(t,55),Object.keys(n)))this.Ot(e,t),this.Ct(n[e],t)}kt(e,t){let n=e.fields||{};this.Ft(t,53);let r=n[sX].arrayValue?.values?.length||0;this.Ft(t,15),t.Mt(sL(r)),this.Ot(sX,t),this.Ct(n[sX],t)}Qt(e,t){let n=e.values||[];for(let e of(this.Ft(t,50),n))this.Ct(e,t)}Lt(e,t){this.Ft(t,37),si.fromName(e).path.forEach(e=>{this.Ft(t,60),this.Ut(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}aJ.Kt=new aJ;class aZ{constructor(){this.Cn=new a0}addToCollectionParentIndex(e,t){return this.Cn.add(t),s_.resolve()}getCollectionParents(e,t){return s_.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return s_.resolve()}deleteFieldIndex(e,t){return s_.resolve()}deleteAllFieldIndexes(e){return s_.resolve()}createTargetIndexes(e,t){return s_.resolve()}getDocumentsMatchingTarget(e,t){return s_.resolve(null)}getIndexType(e,t){return s_.resolve(0)}getFieldIndexes(e,t){return s_.resolve([])}getNextCollectionGroupToUpdate(e){return s_.resolve(null)}getMinOffset(e,t){return s_.resolve(sm.min())}getMinOffsetFromCollectionGroup(e,t){return s_.resolve(sm.min())}updateCollectionGroup(e,t,n){return s_.resolve()}updateIndexEntries(e,t){return s_.resolve()}}class a0{constructor(){this.index={}}add(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new sR(st.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}has(e){let t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}getEntries(e){return(this.index[e]||new sR(st.comparator)).toArray()}}new Uint8Array(0);let a1={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class a2{static withCacheSize(e){return new a2(e,a2.DEFAULT_COLLECTION_PERCENTILE,a2.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}a2.DEFAULT_COLLECTION_PERCENTILE=10,a2.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,a2.DEFAULT=new a2(0x2800000,a2.DEFAULT_COLLECTION_PERCENTILE,a2.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),a2.DISABLED=new a2(-1,0,0);class a3{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new a3(0)}static cr(){return new a3(-1)}}let a6="LruGarbageCollector";function a4([e,t],[n,r]){let i=i4(e,n);return 0===i?i4(t,r):i}class a5{constructor(e){this.Ir=e,this.buffer=new sR(a4),this.Er=0}dr(){return++this.Er}Ar(e){let t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{let e=this.buffer.last();0>a4(t,e)&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class a8{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(e){ij(a6,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){sv(e)?ij(a6,"Ignoring IndexedDB error during garbage collection: ",e):await sy(e)}await this.Vr(3e5)})}}class a7{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return s_.resolve(sw.ce);let n=new a5(t);return this.mr.forEachTarget(e,e=>n.Ar(e.sequenceNumber)).next(()=>this.mr.pr(e,e=>n.Ar(e))).next(()=>n.maxValue)}removeTargets(e,t,n){return this.mr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return -1===this.params.cacheSizeCollectionThreshold?(ij("LruGarbageCollector","Garbage collection skipped; disabled"),s_.resolve(a1)):this.getCacheSize(e).next(n=>n<this.params.cacheSizeCollectionThreshold?(ij("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),a1):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let n,r,i,s,o,a,l,h=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(ij("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),r=this.params.maximumSequenceNumbersToCollect):r=t,s=Date.now(),this.nthSequenceNumber(e,r))).next(r=>(n=r,o=Date.now(),this.removeTargets(e,n,t))).next(t=>(i=t,a=Date.now(),this.removeOrphanedDocuments(e,n))).next(e=>(l=Date.now(),iV()<=b.DEBUG&&ij("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${s-h}ms
	Determined least recently used ${r} in `+(o-s)+"ms\n"+`	Removed ${i} targets in `+(a-o)+"ms\n"+`	Removed ${e} documents in `+(l-a)+"ms\n"+`Total Duration: ${l-h}ms`),s_.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})))}}class a9{constructor(){this.changes=new oU(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,oi.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let n=this.changes.get(t);return void 0!==n?s_.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class le{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class lt{constructor(e,t,n,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=r}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(n=r,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==n&&an(n.mutation,e,sA.empty(),sf.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,oH()).next(()=>t))}getLocalViewOfDocuments(e,t,n=oH()){let r=oB();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,n).next(e=>{let t=oq();return e.forEach((e,n)=>{t=t.insert(e,n.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){let n=oB();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,oH()))}populateOverlays(e,t,n){let r=[];return n.forEach(e=>{t.has(e)||r.push(e)}),this.documentOverlayCache.getOverlays(e,r).next(e=>{e.forEach((e,n)=>{t.set(e,n)})})}computeViews(e,t,n,r){let i=oV,s=oB(),o=oB();return t.forEach((e,t)=>{let o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof as)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),an(o.mutation,t,o.mutation.getFieldMask(),sf.now())):s.set(t.key,sA.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>o.set(e,new le(t,s.get(e)??null))),o))}recalculateAndSaveOverlays(e,t){let n=oB(),r=new sI((e,t)=>e-t),i=oH();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(let i of e)i.keys().forEach(e=>{let s=t.get(e);if(null===s)return;let o=n.get(e)||sA.empty();o=i.applyToLocalView(s,o),n.set(e,o);let a=(r.get(i.batchId)||oH()).add(e);r=r.insert(i.batchId,a)})}).next(()=>{let s=[],o=r.getReverseIterator();for(;o.hasNext();){let r=o.getNext(),a=r.key,l=r.value,h=oB();l.forEach(e=>{if(!i.has(e)){let r=at(t.get(e),n.get(e));null!==r&&h.set(e,r),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,a,h))}return s_.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,n,r){return si.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):null!==t.collectionGroup?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,r):this.getDocumentsMatchingCollectionQuery(e,t,n,r)}getNextDocuments(e,t,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next(i=>{let s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):s_.resolve(oB()),o=-1,a=i;return s.next(t=>s_.forEach(t,(t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(t)?s_.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{a=a.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,a,t,oH())).next(e=>({batchId:o,changes:oz(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new si(t)).next(e=>{let t=oq();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,n,r){let i=t.collectionGroup,s=oq();return this.indexManager.getCollectionParents(e,i).next(o=>s_.forEach(o,o=>{let a=new ok(o.child(i),null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt);return this.getDocumentsMatchingCollectionQuery(e,a,n,r).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,i,r))).next(e=>{i.forEach((t,n)=>{let r=n.getKey();null===e.get(r)&&(e=e.insert(r,oi.newInvalidDocument(r)))});let n=oq();return e.forEach((e,r)=>{let s=i.get(e);void 0!==s&&an(s.mutation,r,sA.empty(),sf.now()),oM(t,r)&&(n=n.insert(e,r))}),n})}}class ln{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return s_.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,{id:t.id,version:t.version,createTime:aF(t.createTime)}),s_.resolve()}getNamedQuery(e,t){return s_.resolve(this.kr.get(t))}saveNamedQuery(e,t){var n;let r;return this.kr.set(t.name,{name:t.name,query:(r=function(e){var t,n,r,i;let s,o,a,l,h,u=4===(s=aj(e.parent)).length?st.emptyPath():aW(s),c=e.structuredQuery,d=c.from?c.from.length:0,f=null;if(d>0){iH(1===d,65062);let e=c.from[0];e.allDescendants?f=e.collectionId:u=u.child(e.collectionId)}let p=[];c.where&&(p=(o=function e(t){return void 0!==t.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":let t=aG(e.unaryFilter.field);return ou.create(t,"==",{doubleValue:NaN});case"IS_NULL":let n=aG(e.unaryFilter.field);return ou.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=aG(e.unaryFilter.field);return ou.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=aG(e.unaryFilter.field);return ou.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return i$(61313);default:return i$(60726)}}(t):void 0!==t.fieldFilter?ou.create(aG(t.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return i$(58110);default:return i$(50506)}}(t.fieldFilter.op),t.fieldFilter.value):void 0!==t.compositeFilter?oc.create(t.compositeFilter.filters.map(t=>e(t)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return i$(1026)}}(t.compositeFilter.op)):i$(30097,{filter:t})}(c.where))instanceof oc&&of(t=o)&&od(t)?o.getFilters():[o]);let m=[];c.orderBy&&(m=c.orderBy.map(e=>new ol(aG(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))));let g=null;c.limit&&(g=null==(a="object"==typeof(n=c.limit)?n.value:n)?null:a);let y=null;c.startAt&&(l=!!(r=c.startAt).before,y=new os(r.values||[],l));let _=null;return c.endAt&&(h=!(i=c.endAt).before,_=new os(i.values||[],h)),new ok(u,f,m,p,g,"F",y,_)}({parent:(n=t.bundledQuery).parent,structuredQuery:n.structuredQuery}),"LAST"===n.limitType?oP(r,r.limit,"L"):r),readTime:aF(t.readTime)}),s_.resolve()}}class lr{constructor(){this.overlays=new sI(si.comparator),this.qr=new Map}getOverlay(e,t){return s_.resolve(this.overlays.get(t))}getOverlays(e,t){let n=oB();return s_.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&n.set(t,e)})).next(()=>n)}saveOverlays(e,t,n){return n.forEach((n,r)=>{this.St(e,t,r)}),s_.resolve()}removeOverlaysForBatchId(e,t,n){let r=this.qr.get(n);return void 0!==r&&(r.forEach(e=>this.overlays=this.overlays.remove(e)),this.qr.delete(n)),s_.resolve()}getOverlaysForCollection(e,t,n){let r=oB(),i=t.length+1,s=new si(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){let e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>n&&r.set(e.getKey(),e)}return s_.resolve(r)}getOverlaysForCollectionGroup(e,t,n,r){let i=new sI((e,t)=>e-t),s=this.overlays.getIterator();for(;s.hasNext();){let e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=i.get(e.largestBatchId);null===t&&(t=oB(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}let o=oB(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((e,t)=>o.set(e,t)),!(o.size()>=r)););return s_.resolve(o)}St(e,t,n){let r=this.overlays.get(n.key);if(null!==r){let e=this.qr.get(r.largestBatchId).delete(n.key);this.qr.set(r.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new af(t,n));let i=this.qr.get(t);void 0===i&&(i=oH(),this.qr.set(t,i)),this.qr.set(t,i.add(n.key))}}class li{constructor(){this.sessionToken=sP.EMPTY_BYTE_STRING}getSessionToken(e){return s_.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,s_.resolve()}}class ls{constructor(){this.Qr=new sR(lo.$r),this.Ur=new sR(lo.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){let n=new lo(e,t);this.Qr=this.Qr.add(n),this.Ur=this.Ur.add(n)}Wr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Gr(new lo(e,t))}zr(e,t){e.forEach(e=>this.removeReference(e,t))}jr(e){let t=new si(new st([])),n=new lo(t,e),r=new lo(t,e+1),i=[];return this.Ur.forEachInRange([n,r],e=>{this.Gr(e),i.push(e.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){let t=new si(new st([])),n=new lo(t,e),r=new lo(t,e+1),i=oH();return this.Ur.forEachInRange([n,r],e=>{i=i.add(e.key)}),i}containsKey(e){let t=new lo(e,0),n=this.Qr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class lo{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return si.comparator(e.key,t.key)||i4(e.Yr,t.Yr)}static Kr(e,t){return i4(e.Yr,t.Yr)||si.comparator(e.key,t.key)}}class la{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new sR(lo.$r)}checkEmpty(e){return s_.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,r){let i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let s=new ac(i,t,n,r);for(let t of(this.mutationQueue.push(s),r))this.Zr=this.Zr.add(new lo(t.key,i)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return s_.resolve(s)}lookupMutationBatch(e,t){return s_.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){let n=this.ei(t+1),r=n<0?0:n;return s_.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return s_.resolve(0===this.mutationQueue.length?-1:this.tr-1)}getAllMutationBatches(e){return s_.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let n=new lo(t,0),r=new lo(t,1/0),i=[];return this.Zr.forEachInRange([n,r],e=>{let t=this.Xr(e.Yr);i.push(t)}),s_.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new sR(i4);return t.forEach(e=>{let t=new lo(e,0),r=new lo(e,1/0);this.Zr.forEachInRange([t,r],e=>{n=n.add(e.Yr)})}),s_.resolve(this.ti(n))}getAllMutationBatchesAffectingQuery(e,t){let n=t.path,r=n.length+1,i=n;si.isDocumentKey(i)||(i=i.child(""));let s=new lo(new si(i),0),o=new sR(i4);return this.Zr.forEachWhile(e=>{let t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e.Yr)),!0)},s),s_.resolve(this.ti(o))}ti(e){let t=[];return e.forEach(e=>{let n=this.Xr(e);null!==n&&t.push(n)}),t}removeMutationBatch(e,t){iH(0===this.ni(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Zr;return s_.forEach(t.mutations,r=>{let i=new lo(r.key,t.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.Zr=n})}ir(e){}containsKey(e,t){let n=new lo(t,0),r=this.Zr.firstAfterOrEqual(n);return s_.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return this.mutationQueue.length,s_.resolve()}ni(e,t){return this.ei(e)}ei(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Xr(e){let t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class ll{constructor(e){this.ri=e,this.docs=new sI(si.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let n=t.key,r=this.docs.get(n),i=r?r.size:0,s=this.ri(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let n=this.docs.get(t);return s_.resolve(n?n.document.mutableCopy():oi.newInvalidDocument(t))}getEntries(e,t){let n=oV;return t.forEach(e=>{let t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():oi.newInvalidDocument(e))}),s_.resolve(n)}getDocumentsMatchingQuery(e,t,n,r){let i=oV,s=t.path,o=new si(s.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){let{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||0>=function(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n||0!==(n=si.comparator(e.documentKey,t.documentKey))?n:i4(e.largestBatchId,t.largestBatchId)}(new sm(o.readTime,o.key,-1),n)||(r.has(o.key)||oM(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return s_.resolve(i)}getAllFromCollectionGroup(e,t,n,r){i$(9500)}ii(e,t){return s_.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new lh(this)}getSize(e){return s_.resolve(this.size)}}class lh extends a9{constructor(e){super(),this.Nr=e}applyChanges(e){let t=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?t.push(this.Nr.addEntry(e,r)):this.Nr.removeEntry(n)}),s_.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class lu{constructor(e){this.persistence=e,this.si=new oU(e=>oC(e),oI),this.lastRemoteSnapshotVersion=sp.min(),this.highestTargetId=0,this.oi=0,this._i=new ls,this.targetCount=0,this.ai=a3.ur()}forEachTarget(e,t){return this.si.forEach((e,n)=>t(n)),s_.resolve()}getLastRemoteSnapshotVersion(e){return s_.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return s_.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),s_.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.oi&&(this.oi=t),s_.resolve()}Pr(e){this.si.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.ai=new a3(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,s_.resolve()}updateTargetData(e,t){return this.Pr(t),s_.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,s_.resolve()}removeTargets(e,t,n){let r=0,i=[];return this.si.forEach((s,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.si.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),r++)}),s_.waitFor(i).next(()=>r)}getTargetCount(e){return s_.resolve(this.targetCount)}getTargetData(e,t){let n=this.si.get(t)||null;return s_.resolve(n)}addMatchingKeys(e,t,n){return this._i.Wr(t,n),s_.resolve()}removeMatchingKeys(e,t,n){this._i.zr(t,n);let r=this.persistence.referenceDelegate,i=[];return r&&t.forEach(t=>{i.push(r.markPotentiallyOrphaned(e,t))}),s_.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),s_.resolve()}getMatchingKeysForTargetId(e,t){let n=this._i.Hr(t);return s_.resolve(n)}containsKey(e,t){return s_.resolve(this._i.containsKey(t))}}class lc{constructor(e,t){this.ui={},this.overlays={},this.ci=new sw(0),this.li=!1,this.li=!0,this.hi=new li,this.referenceDelegate=e(this),this.Pi=new lu(this),this.indexManager=new aZ,this.remoteDocumentCache=new ll(e=>this.referenceDelegate.Ti(e)),this.serializer=new aX(t),this.Ii=new ln(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new lr,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ui[e.toKey()];return n||(n=new la(t,this.referenceDelegate),this.ui[e.toKey()]=n),n}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,n){ij("MemoryPersistence","Starting transaction:",e);let r=new ld(this.ci.next());return this.referenceDelegate.Ei(),n(r).next(e=>this.referenceDelegate.di(r).next(()=>e)).toPromise().then(e=>(r.raiseOnCommittedEvent(),e))}Ai(e,t){return s_.or(Object.values(this.ui).map(n=>()=>n.containsKey(e,t)))}}class ld extends sg{constructor(e){super(),this.currentSequenceNumber=e}}class lf{constructor(e){this.persistence=e,this.Ri=new ls,this.Vi=null}static mi(e){return new lf(e)}get fi(){if(this.Vi)return this.Vi;throw i$(60996)}addReference(e,t,n){return this.Ri.addReference(n,t),this.fi.delete(n.toString()),s_.resolve()}removeReference(e,t,n){return this.Ri.removeReference(n,t),this.fi.add(n.toString()),s_.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),s_.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(e=>this.fi.add(e.toString()));let n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.fi.add(e.toString()))}).next(()=>n.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){let t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return s_.forEach(this.fi,n=>{let r=si.fromPath(n);return this.gi(e,r).next(e=>{e||t.removeEntry(r,sp.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(e=>{e?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return s_.or([()=>s_.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class lp{constructor(e,t){this.persistence=e,this.pi=new oU(e=>(function(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t+="\x01\x01"),t=function(e,t){let n=t,r=e.length;for(let t=0;t<r;t++){let r=e.charAt(t);switch(r){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=r}}return n}(e.get(n),t);return t+"\x01\x01"})(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=new a7(this,t)}static mi(e,t){return new lp(e,t)}Ei(){}di(e){return s_.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){let t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}wr(e){let t=0;return this.pr(e,e=>{t++}).next(()=>t)}pr(e,t){return s_.forEach(this.pi,(n,r)=>this.br(e,n,r).next(e=>e?s_.resolve():t(r)))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0,r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.ii(e,r=>this.br(e,r,t).next(e=>{e||(n++,i.removeEntry(r,sp.min()))})).next(()=>i.apply(e)).next(()=>n)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),s_.resolve()}removeTarget(e,t){let n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),s_.resolve()}removeReference(e,t,n){return this.pi.set(n,e.currentSequenceNumber),s_.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),s_.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=function e(t){switch(sJ(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:let n=sz(t);return n?16+e(n):16;case 5:return 2*t.stringValue.length;case 6:return sM(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(t.arrayValue.values||[]).reduce((t,n)=>t+e(n),0);case 10:case 11:var r;let i;return r=t.mapValue,i=0,sT(r.fields,(t,n)=>{i+=t.length+e(n)}),i;default:throw i$(13486,{value:t})}}(e.data.value)),t}br(e,t,n){return s_.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{let e=this.pi.get(t);return s_.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class lm{constructor(e,t,n,r){this.targetId=e,this.fromCache=t,this.Es=n,this.ds=r}static As(e,t){let n=oH(),r=oH();for(let e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:r=r.add(e.doc.key)}return new lm(e,t.fromCache,n,r)}}class lg{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class ly{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=function(){let t;return!function(){let t=Q()?.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(e.g.process)}catch(e){return!1}}()&&navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")?8:Number((t=ea().match(/Android ([\d.]+)/i))?t[1].split(".").slice(0,2).join("."):"-1")>0?6:4}()}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,n,r){let i={result:null};return this.ys(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.ws(e,t,r,n).next(e=>{i.result=e})}).next(()=>{if(i.result)return;let n=new lg;return this.Ss(e,t,n).next(r=>{if(i.result=r,this.Vs)return this.bs(e,t,n,r.size)})}).next(()=>i.result)}bs(e,t,n,r){return n.documentReadCount<this.fs?(iV()<=b.DEBUG&&ij("QueryEngine","SDK will not create cache indexes for query:",oL(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),s_.resolve()):(iV()<=b.DEBUG&&ij("QueryEngine","Query:",oL(t),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.gs*r?(iV()<=b.DEBUG&&ij("QueryEngine","The SDK decides to create cache indexes for query:",oL(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,ox(t))):s_.resolve())}ys(e,t){if(oN(t))return s_.resolve(null);let n=ox(t);return this.indexManager.getIndexType(e,n).next(r=>0===r?null:(null!==t.limit&&1===r&&(n=ox(t=oP(t,null,"F"))),this.indexManager.getDocumentsMatchingTarget(e,n).next(r=>{let i=oH(...r);return this.ps.getDocuments(e,i).next(r=>this.indexManager.getMinOffset(e,n).next(n=>{let s=this.Ds(t,r);return this.Cs(t,s,i,n.readTime)?this.ys(e,oP(t,null,"F")):this.vs(e,s,t,n)}))})))}ws(e,t,n,r){return oN(t)||r.isEqual(sp.min())?s_.resolve(null):this.ps.getDocuments(e,n).next(i=>{let s,o,a=this.Ds(t,i);return this.Cs(t,a,n,r)?s_.resolve(null):(iV()<=b.DEBUG&&ij("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),oL(t)),this.vs(e,a,t,(s=r.toTimestamp().seconds,o=r.toTimestamp().nanoseconds+1,new sm(sp.fromTimestamp(1e9===o?new sf(s+1,0):new sf(s,o)),si.empty(),-1))).next(e=>e))})}Ds(e,t){let n=new sR(oF(e));return t.forEach((t,r)=>{oM(e,r)&&(n=n.add(r))}),n}Cs(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;let i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ss(e,t,n){return iV()<=b.DEBUG&&ij("QueryEngine","Using full collection scan to execute query:",oL(t)),this.ps.getDocumentsMatchingQuery(e,t,sm.min(),n)}vs(e,t,n,r){return this.ps.getDocumentsMatchingQuery(e,n,r).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}let l_="LocalStore";class lv{constructor(e,t,n,r){this.persistence=e,this.Fs=t,this.serializer=r,this.Ms=new sI(i4),this.xs=new oU(e=>oC(e),oI),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(n)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new lt(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}async function lw(e,t){return await e.persistence.runTransaction("Handle user change","readonly",n=>{let r;return e.mutationQueue.getAllMutationBatches(n).next(i=>(r=i,e.Bs(t),e.mutationQueue.getAllMutationBatches(n))).next(t=>{let i=[],s=[],o=oH();for(let e of r)for(let t of(i.push(e.batchId),e.mutations))o=o.add(t.key);for(let e of t)for(let t of(s.push(e.batchId),e.mutations))o=o.add(t.key);return e.localDocuments.getDocuments(n,o).next(e=>({Ls:e,removedBatchIds:i,addedBatchIds:s}))})})}function lb(e){return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Pi.getLastRemoteSnapshotVersion(t))}async function lE(e,t,n){let r=e.Ms.get(t);try{n||await e.persistence.runTransaction("Release target",n?"readwrite":"readwrite-primary",t=>e.persistence.referenceDelegate.removeTarget(t,r))}catch(e){if(!sv(e))throw e;ij(l_,`Failed to update sequence numbers for target ${t}: ${e}`)}e.Ms=e.Ms.remove(t),e.xs.delete(r.target)}function lT(e,t,n){let r=sp.min(),i=oH();return e.persistence.runTransaction("Execute query","readwrite",s=>{var o;let a;return(o=ox(t),void 0!==(a=e.xs.get(o))?s_.resolve(e.Ms.get(a)):e.Pi.getTargetData(s,o)).next(t=>{if(t)return r=t.lastLimboFreeSnapshotVersion,e.Pi.getMatchingKeysForTargetId(s,t.targetId).next(e=>{i=e})}).next(()=>e.Fs.getDocumentsMatchingQuery(s,t,n?r:sp.min(),n?i:oH())).next(n=>{var r,s,o;let a;return r=e,s=t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2)),o=n,a=r.Os.get(s)||sp.min(),o.forEach((e,t)=>{t.readTime.compareTo(a)>0&&(a=t.readTime)}),r.Os.set(s,a),{documents:n,Qs:i}})})}class lC{constructor(){this.activeTargetIds=oK}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){return JSON.stringify({activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()})}}class lI{constructor(){this.Mo=new lC,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,n){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new lC,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class lS{Oo(e){}shutdown(){}}let lk="ConnectivityMonitor";class lR{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){for(let e of(ij(lk,"Network connectivity changed: AVAILABLE"),this.qo))e(0)}ko(){for(let e of(ij(lk,"Network connectivity changed: UNAVAILABLE"),this.qo))e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let lN=null;function lA(){return null===lN?lN=0x10000000+Math.round(0x80000000*Math.random()):lN++,"0x"+lN.toString(16)}let lx="RestConnection",lP={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class lD{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko=`projects/${n}/databases/${r}`,this.Wo=this.databaseId.database===sW?`project_id=${n}`:`project_id=${n}&database_id=${r}`}Go(e,t,n,r,i){let s=lA(),o=this.zo(e,t.toUriEncodedString());ij(lx,`Sending RPC '${e}' ${s}:`,o,n);let a={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(a,r,i);let{host:l}=new URL(o),h=et(l);return this.Jo(e,o,a,n,h).then(t=>(ij(lx,`Received RPC '${e}' ${s}: `,t),t),t=>{throw iz(lx,`RPC '${e}' ${s} failed with error: `,t,"url: ",o,"request:",n),t})}Ho(e,t,n,r,i,s){return this.Go(e,t,n,r,i)}jo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+iF,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,n)=>e[n]=t),n&&n.headers.forEach((t,n)=>e[n]=t)}zo(e,t){let n=lP[e];return`${this.Uo}/v1/${t}:${n}`}terminate(){}}class lO{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}let lL="WebChannelConnection";class lM extends lD{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,n,r,i){let s=lA();return new Promise((i,o)=>{let a=new C;a.setWithCredentials(!0),a.listenOnce(S.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case k.NO_ERROR:let t=a.getResponseJson();ij(lL,`XHR for RPC '${e}' ${s} received:`,JSON.stringify(t)),i(t);break;case k.TIMEOUT:ij(lL,`RPC '${e}' ${s} timed out`),o(new iG(iK.DEADLINE_EXCEEDED,"Request time out"));break;case k.HTTP_ERROR:let n=a.getStatus();if(ij(lL,`RPC '${e}' ${s} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);let t=e?.error;if(t&&t.status&&t.message){let e,n=(e=t.status.toLowerCase().replace(/_/g,"-"),Object.values(iK).indexOf(e)>=0?e:iK.UNKNOWN);o(new iG(n,t.message))}else o(new iG(iK.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new iG(iK.UNAVAILABLE,"Connection failed."));break;default:i$(9055,{l_:e,streamId:s,h_:a.getLastErrorCode(),P_:a.getLastError()})}}finally{ij(lL,`RPC '${e}' ${s} completed.`)}});let l=JSON.stringify(r);ij(lL,`RPC '${e}' ${s} sending request:`,r),a.send(t,"POST",l,n,15)})}T_(e,t,n){let r=lA(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=x(),o=A(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(a.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(a.useFetchStreams=!0),this.jo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;let h=i.join("");ij(lL,`Creating RPC '${e}' stream ${r}: ${h}`,a);let u=s.createWebChannel(h,a);this.I_(u);let c=!1,d=!1,f=new lO({Yo:t=>{d?ij(lL,`Not sending because RPC '${e}' stream ${r} is closed:`,t):(c||(ij(lL,`Opening RPC '${e}' stream ${r} transport.`),u.open(),c=!0),ij(lL,`RPC '${e}' stream ${r} sending:`,t),u.send(t))},Zo:()=>u.close()}),p=(e,t,n)=>{e.listen(t,e=>{try{n(e)}catch(e){setTimeout(()=>{throw e},0)}})};return p(u,I.EventType.OPEN,()=>{d||(ij(lL,`RPC '${e}' stream ${r} transport opened.`),f.o_())}),p(u,I.EventType.CLOSE,()=>{d||(d=!0,ij(lL,`RPC '${e}' stream ${r} transport closed`),f.a_(),this.E_(u))}),p(u,I.EventType.ERROR,t=>{d||(d=!0,iz(lL,`RPC '${e}' stream ${r} transport errored. Name:`,t.name,"Message:",t.message),f.a_(new iG(iK.UNAVAILABLE,"The operation could not be completed")))}),p(u,I.EventType.MESSAGE,t=>{if(!d){let n=t.data[0];iH(!!n,16349);let i=n?.error||n[0]?.error;if(i){ij(lL,`RPC '${e}' stream ${r} received error:`,i);let t=i.status,n=function(e){let t=P[e];if(void 0!==t)return am(t)}(t),s=i.message;void 0===n&&(n=iK.INTERNAL,s="Unknown error status: "+t+" with message "+i.message),d=!0,f.a_(new iG(n,s)),u.close()}else ij(lL,`RPC '${e}' stream ${r} received:`,n),f.u_(n)}}),p(o,N.STAT_EVENT,t=>{t.stat===R.PROXY?ij(lL,`RPC '${e}' stream ${r} detected buffering proxy`):t.stat===R.NOPROXY&&ij(lL,`RPC '${e}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{f.__()},0),f}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function lF(){return"undefined"!=typeof document?document:null}function lU(e){return new aD(e,!0)}class lV{constructor(e,t,n=1e3,r=1.5,i=6e4){this.Mi=e,this.timerId=t,this.d_=n,this.A_=r,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();let t=Math.floor(this.V_+this.y_()),n=Math.max(0,Date.now()-this.f_),r=Math.max(0,t-n);r>0&&ij("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.V_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,r,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}let lj="PersistentStream";class lq{constructor(e,t,n,r,i,s,o,a){this.Mi=e,this.S_=n,this.b_=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new lV(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===iK.RESOURCE_EXHAUSTED?(iq(t.toString()),iq("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===iK.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;let e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([e,n])=>{this.D_===t&&this.G_(e,n)},t=>{e(()=>{let e=new iG(iK.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){let n=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{n(()=>this.listener.Xo())}),this.stream.t_(()=>{n(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(e=>{n(()=>this.z_(e))}),this.stream.onMessage(e=>{n(()=>1==++this.F_?this.J_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return ij(lj,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(ij(lj,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class lz extends lq{constructor(e,t,n,r,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();let t=function(e,t){let n;if("targetChange"in t){var r,i;t.targetChange;let s="NO_CHANGE"===(r=t.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===r?1:"REMOVE"===r?2:"CURRENT"===r?3:"RESET"===r?4:i$(39313,{state:r}),o=t.targetChange.targetIds||[],a=(i=t.targetChange.resumeToken,e.useProto3Json?(iH(void 0===i||"string"==typeof i,58123),sP.fromBase64String(i||"")):(iH(void 0===i||i instanceof iN.Buffer||i instanceof Uint8Array,16193),sP.fromUint8Array(i||new Uint8Array))),l=t.targetChange.cause;n=new aI(s,o,a,l&&new iG(void 0===l.code?iK.UNKNOWN:am(l.code),l.message||"")||null)}else if("documentChange"in t){t.documentChange;let r=t.documentChange;r.document,r.document.name,r.document.updateTime;let i=az(e,r.document.name),s=aF(r.document.updateTime),o=r.document.createTime?aF(r.document.createTime):sp.min(),a=new or({mapValue:{fields:r.document.fields}}),l=oi.newFoundDocument(i,s,o,a);n=new aT(r.targetIds||[],r.removedTargetIds||[],l.key,l)}else if("documentDelete"in t){t.documentDelete;let r=t.documentDelete;r.document;let i=az(e,r.document),s=r.readTime?aF(r.readTime):sp.min(),o=oi.newNoDocument(i,s);n=new aT([],r.removedTargetIds||[],o.key,o)}else if("documentRemove"in t){t.documentRemove;let r=t.documentRemove;r.document;let i=az(e,r.document);n=new aT([],r.removedTargetIds||[],i,null)}else{if(!("filter"in t))return i$(11601,{Rt:t});{t.filter;let e=t.filter;e.targetId;let{count:r=0,unchangedNames:i}=e,s=new ap(r,i);n=new aC(e.targetId,s)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return sp.min();let t=e.targetChange;return t.targetIds&&t.targetIds.length?sp.min():t.readTime?aF(t.readTime):sp.min()}(e);return this.listener.H_(t,n)}Y_(e){let t,n={};n.database=a$(this.serializer),n.addTarget=function(e,t){var n,r;let i,s,o,a,l,h,u,c=t.target;if((i=oS(c)?{documents:{documents:[aB(e,c.path)]}}:{query:(o={structuredQuery:{}},a=c.path,null!==c.collectionGroup?(s=a,o.structuredQuery.from=[{collectionId:c.collectionGroup,allDescendants:!0}]):(s=a.popLast(),o.structuredQuery.from=[{collectionId:a.lastSegment()}]),o.parent=aB(e,s),(l=function(e){if(0!==e.length)return function e(t){var n;let r;return t instanceof ou?function(e){if("=="===e.op){if(s7(e.value))return{unaryFilter:{field:aK(e.field),op:"IS_NAN"}};if(s8(e.value))return{unaryFilter:{field:aK(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(s7(e.value))return{unaryFilter:{field:aK(e.field),op:"IS_NOT_NAN"}};if(s8(e.value))return{unaryFilter:{field:aK(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:aK(e.field),op:ax[e.op],value:e.value}}}(t):t instanceof oc?1===(r=(n=t).getFilters().map(t=>e(t))).length?r[0]:{compositeFilter:{op:aP[n.op],filters:r}}:i$(54877,{filter:t})}(oc.create(e,"and"))}(c.filters))&&(o.structuredQuery.where=l),(h=function(e){if(0!==e.length)return e.map(e=>({field:aK(e.field),direction:aA[e.dir]}))}(c.orderBy))&&(o.structuredQuery.orderBy=h),null!==(u=aO(e,c.limit))&&(o.structuredQuery.limit=u),c.startAt&&(o.structuredQuery.startAt={before:(n=c.startAt).inclusive,values:n.position}),c.endAt&&(o.structuredQuery.endAt={before:!(r=c.endAt).inclusive,values:r.position}),{ft:o,parent:s}).ft}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0){i.resumeToken=aM(e,t.resumeToken);let n=aO(e,t.expectedCount);null!==n&&(i.expectedCount=n)}else if(t.snapshotVersion.compareTo(sp.min())>0){i.readTime=aL(e,t.snapshotVersion.toTimestamp());let n=aO(e,t.expectedCount);null!==n&&(i.expectedCount=n)}return i}(this.serializer,e);let r=(this.serializer,null==(t=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return i$(28987,{purpose:e})}}(e.purpose))?null:{"goog-listen-tags":t});r&&(n.labels=r),this.q_(n)}Z_(e){let t={};t.database=a$(this.serializer),t.removeTarget=e,this.q_(t)}}class lB extends lq{constructor(e,t,n,r,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,r,s),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return iH(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,iH(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){var t,n;iH(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();let r=(t=e.writeResults,n=e.commitTime,t&&t.length>0?(iH(void 0!==n,14353),t.map(e=>{let t;return(t=e.updateTime?aF(e.updateTime):aF(n)).isEqual(sp.min())&&(t=aF(n)),new o8(t,e.transformResults||[])})):[]),i=aF(e.commitTime);return this.listener.na(i,r)}ra(){let e={};e.database=a$(this.serializer),this.q_(e)}ea(e){let t={streamToken:this.lastStreamToken,writes:e.map(e=>(function(e,t){var n,r;let i;if(t instanceof ai)i={update:aH(e,t.key,t.value)};else if(t instanceof ah)i={delete:aq(e,t.key)};else if(t instanceof as){let n;i={update:aH(e,t.key,t.data),updateMask:(r=t.fieldMask,n=[],r.fields.forEach(e=>n.push(e.canonicalString())),{fieldPaths:n})}}else{if(!(t instanceof au))return i$(16599,{Vt:t.type});i={verify:aq(e,t.key)}}return t.fieldTransforms.length>0&&(i.updateTransforms=t.fieldTransforms.map(e=>(function(e,t){let n=t.transform;if(n instanceof oJ)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof oZ)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof o1)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof o3)return{fieldPath:t.field.canonicalString(),increment:n.Ae};throw i$(20930,{transform:t.transform})})(0,e))),t.precondition.isNone||(i.currentDocument=void 0!==(n=t.precondition).updateTime?{updateTime:aL(e,n.updateTime.toTimestamp())}:void 0!==n.exists?{exists:n.exists}:i$(27497)),i})(this.serializer,e))};this.q_(t)}}class l${}class lW extends l${constructor(e,t,n,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=r,this.ia=!1}sa(){if(this.ia)throw new iG(iK.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,n,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.Go(e,aV(t,n),r,i,s)).catch(e=>{throw"FirebaseError"===e.name?(e.code===iK.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new iG(iK.UNKNOWN,e.toString())})}Ho(e,t,n,r,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Ho(e,aV(t,n),r,s,o,i)).catch(e=>{throw"FirebaseError"===e.name?(e.code===iK.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new iG(iK.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class lH{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(iq(t),this.aa=!1):ij("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}let lK="RemoteStore";class lG{constructor(e,t,n,r,i){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(e=>{n.enqueueAndForget(async()=>{l3(this)&&(ij(lK,"Restarting streams for network reachability change."),await async function(e){e.Ea.add(4),await lY(e),e.Ra.set("Unknown"),e.Ea.delete(4),await lQ(e)}(this))})}),this.Ra=new lH(n,r)}}async function lQ(e){if(l3(e))for(let t of e.da)await t(!0)}async function lY(e){for(let t of e.da)await t(!1)}function lX(e,t){e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),l2(e)?l1(e):hh(e).O_()&&lZ(e,t))}function lJ(e,t){let n=hh(e);e.Ia.delete(t),n.O_()&&l0(e,t),0===e.Ia.size&&(n.O_()?n.L_():l3(e)&&e.Ra.set("Unknown"))}function lZ(e,t){if(e.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(sp.min())>0){let n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}hh(e).Y_(t)}function l0(e,t){e.Va.Ue(t),hh(e).Z_(t)}function l1(e){e.Va=new ak({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),hh(e).start(),e.Ra.ua()}function l2(e){return l3(e)&&!hh(e).x_()&&e.Ia.size>0}function l3(e){return 0===e.Ea.size}async function l6(e){e.Ra.set("Online")}async function l4(e){e.Ia.forEach((t,n)=>{lZ(e,t)})}async function l5(e,t){e.Va=void 0,l2(e)?(e.Ra.ha(t),l1(e)):e.Ra.set("Unknown")}async function l8(e,t,n){if(e.Ra.set("Online"),t instanceof aI&&2===t.state&&t.cause)try{await async function(e,t){let n=t.cause;for(let r of t.targetIds)e.Ia.has(r)&&(await e.remoteSyncer.rejectListen(r,n),e.Ia.delete(r),e.Va.removeTarget(r))}(e,t)}catch(n){ij(lK,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await l7(e,n)}else if(t instanceof aT?e.Va.Ze(t):t instanceof aC?e.Va.st(t):e.Va.tt(t),!n.isEqual(sp.min()))try{let t,r=await lb(e.localStore);n.compareTo(r)>=0&&await ((t=e.Va.Tt(n)).targetChanges.forEach((t,r)=>{if(t.resumeToken.approximateByteSize()>0){let i=e.Ia.get(r);i&&e.Ia.set(r,i.withResumeToken(t.resumeToken,n))}}),t.targetMismatches.forEach((t,n)=>{let r=e.Ia.get(t);if(!r)return;e.Ia.set(t,r.withResumeToken(sP.EMPTY_BYTE_STRING,r.snapshotVersion)),l0(e,t);let i=new aY(r.target,t,n,r.sequenceNumber);lZ(e,i)}),e.remoteSyncer.applyRemoteEvent(t))}catch(t){ij(lK,"Failed to raise snapshot:",t),await l7(e,t)}}async function l7(e,t,n){if(!sv(t))throw t;e.Ea.add(1),await lY(e),e.Ra.set("Offline"),n||(n=()=>lb(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{ij(lK,"Retrying IndexedDB access"),await n(),e.Ea.delete(1),await lQ(e)})}function l9(e,t){return t().catch(n=>l7(e,n,t))}async function he(e){var t;let n=hu(e),r=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:-1;for(;l3(t=e)&&t.Ta.length<10;)try{let t=await function(e,t){return e.persistence.runTransaction("Get next mutation batch","readonly",n=>(void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)))}(e.localStore,r);if(null===t){0===e.Ta.length&&n.L_();break}r=t.batchId,function(e,t){e.Ta.push(t);let n=hu(e);n.O_()&&n.X_&&n.ea(t.mutations)}(e,t)}catch(t){await l7(e,t)}ht(e)&&hn(e)}function ht(e){return l3(e)&&!hu(e).x_()&&e.Ta.length>0}function hn(e){hu(e).start()}async function hr(e){hu(e).ra()}async function hi(e){let t=hu(e);for(let n of e.Ta)t.ea(n.mutations)}async function hs(e,t,n){let r=e.Ta.shift(),i=ad.from(r,t,n);await l9(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await he(e)}async function ho(e,t){t&&hu(e).X_&&await async function(e,t){var n;if(function(e){switch(e){case iK.OK:return i$(64938);case iK.CANCELLED:case iK.UNKNOWN:case iK.DEADLINE_EXCEEDED:case iK.RESOURCE_EXHAUSTED:case iK.INTERNAL:case iK.UNAVAILABLE:case iK.UNAUTHENTICATED:return!1;case iK.INVALID_ARGUMENT:case iK.NOT_FOUND:case iK.ALREADY_EXISTS:case iK.PERMISSION_DENIED:case iK.FAILED_PRECONDITION:case iK.ABORTED:case iK.OUT_OF_RANGE:case iK.UNIMPLEMENTED:case iK.DATA_LOSS:return!0;default:return i$(15467,{code:e})}}(n=t.code)&&n!==iK.ABORTED){let n=e.Ta.shift();hu(e).B_(),await l9(e,()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t)),await he(e)}}(e,t),ht(e)&&hn(e)}async function ha(e,t){e.asyncQueue.verifyOperationInProgress(),ij(lK,"RemoteStore received new credentials");let n=l3(e);e.Ea.add(3),await lY(e),n&&e.Ra.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await lQ(e)}async function hl(e,t){t?(e.Ea.delete(2),await lQ(e)):t||(e.Ea.add(2),await lY(e),e.Ra.set("Unknown"))}function hh(e){var t,n,r;return e.ma||(t=e.datastore,n=e.asyncQueue,r={Xo:l6.bind(null,e),t_:l4.bind(null,e),r_:l5.bind(null,e),H_:l8.bind(null,e)},t.sa(),e.ma=new lz(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.da.push(async t=>{t?(e.ma.B_(),l2(e)?l1(e):e.Ra.set("Unknown")):(await e.ma.stop(),e.Va=void 0)})),e.ma}function hu(e){var t,n,r;return e.fa||(t=e.datastore,n=e.asyncQueue,r={Xo:()=>Promise.resolve(),t_:hr.bind(null,e),r_:ho.bind(null,e),ta:hi.bind(null,e),na:hs.bind(null,e)},t.sa(),e.fa=new lB(n,t.connection,t.authCredentials,t.appCheckCredentials,t.serializer,r),e.da.push(async t=>{t?(e.fa.B_(),await he(e)):(await e.fa.stop(),e.Ta.length>0&&(ij(lK,`Stopping write stream with ${e.Ta.length} pending writes`),e.Ta=[]))})),e.fa}class hc{constructor(e,t,n,r,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new iQ,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,r,i){let s=new hc(e,t,Date.now()+n,r,i);return s.start(n),s}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new iG(iK.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function hd(e,t){if(iq("AsyncQueue",`${t}: ${e}`),sv(e))return new iG(iK.UNAVAILABLE,`${t}: ${e}`);throw e}class hf{static emptySet(e){return new hf(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||si.comparator(t.key,n.key):(e,t)=>si.comparator(e.key,t.key),this.keyedMap=oq(),this.sortedSet=new sI(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,n)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof hf)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){let e=t.getNext().key,r=n.getNext().key;if(!e.isEqual(r))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){let n=new hf;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class hp{constructor(){this.ga=new sI(si.comparator)}track(e){let t=e.doc.key,n=this.ga.get(t);n?0!==e.type&&3===n.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==n.type?this.ga=this.ga.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.ga=this.ga.remove(t):1===e.type&&2===n.type?this.ga=this.ga.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):i$(63341,{Rt:e,pa:n}):this.ga=this.ga.insert(t,e)}ya(){let e=[];return this.ga.inorderTraversal((t,n)=>{e.push(n)}),e}}class hm{constructor(e,t,n,r,i,s,o,a,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,r,i){let s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new hm(e,t,hf.emptySet(t),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&oD(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;let t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class hg{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class hy{constructor(){this.queries=h_(),this.onlineState="Unknown",this.Ca=new Set}terminate(){var e;let t;e=new iG(iK.ABORTED,"Firestore shutting down"),t=this.queries,this.queries=h_(),t.forEach((t,n)=>{for(let t of n.Sa)t.onError(e)})}}function h_(){return new oU(e=>oO(e),oD)}async function hv(e,t){let n=3,r=t.query,i=e.queries.get(r);i?!i.ba()&&t.Da()&&(n=2):(i=new hg,n=+!t.Da());try{switch(n){case 0:i.wa=await e.onListen(r,!0);break;case 1:i.wa=await e.onListen(r,!1);break;case 2:await e.onFirstRemoteStoreListen(r)}}catch(n){let e=hd(n,`Initialization of query '${oL(t.query)}' failed`);return void t.onError(e)}e.queries.set(r,i),i.Sa.push(t),t.va(e.onlineState),i.wa&&t.Fa(i.wa)&&hT(e)}async function hw(e,t){let n=t.query,r=3,i=e.queries.get(n);if(i){let e=i.Sa.indexOf(t);e>=0&&(i.Sa.splice(e,1),0===i.Sa.length?r=+!t.Da():!i.ba()&&t.Da()&&(r=2))}switch(r){case 0:return e.queries.delete(n),e.onUnlisten(n,!0);case 1:return e.queries.delete(n),e.onUnlisten(n,!1);case 2:return e.onLastRemoteStoreUnlisten(n);default:return}}function hb(e,t){let n=!1;for(let r of t){let t=r.query,i=e.queries.get(t);if(i){for(let e of i.Sa)e.Fa(r)&&(n=!0);i.wa=r}}n&&hT(e)}function hE(e,t,n){let r=e.queries.get(t);if(r)for(let e of r.Sa)e.onError(n);e.queries.delete(t)}function hT(e){e.Ca.forEach(e=>{e.next()})}(L=O||(O={})).Ma="default",L.Cache="cache";class hC{constructor(e,t,n){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=n||{}}Fa(e){if(!this.options.includeMetadataChanges){let t=[];for(let n of e.docChanges)3!==n.type&&t.push(n);e=new hm(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){return!(e.fromCache&&this.Da())||(!this.options.qa||"Offline"===t)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;let t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=hm.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==O.Cache}}class hI{constructor(e){this.key=e}}class hS{constructor(e){this.key=e}}class hk{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=oH(),this.mutatedKeys=oH(),this.eu=oF(e),this.tu=new hf(this.eu)}get nu(){return this.Ya}ru(e,t){let n=t?t.iu:new hp,r=t?t.tu:this.tu,i=t?t.mutatedKeys:this.mutatedKeys,s=r,o=!1,a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,l="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((e,t)=>{let h=r.get(e),u=oM(this.query,t)?t:null,c=!!h&&this.mutatedKeys.has(h.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations),f=!1;h&&u?h.data.isEqual(u.data)?c!==d&&(n.track({type:3,doc:u}),f=!0):this.su(h,u)||(n.track({type:2,doc:u}),f=!0,(a&&this.eu(u,a)>0||l&&0>this.eu(u,l))&&(o=!0)):!h&&u?(n.track({type:0,doc:u}),f=!0):h&&!u&&(n.track({type:1,doc:h}),f=!0,(a||l)&&(o=!0)),f&&(u?(s=s.add(u),i=d?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){let e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),n.track({type:1,doc:e})}return{tu:s,iu:n,Cs:o,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,r){let i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;let s=e.iu.ya();s.sort((e,t)=>{var n,r;let i;return n=e.type,r=t.type,(i=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return i$(20277,{Rt:e})}})(n)-i(r)||this.eu(e.doc,t.doc)}),this.ou(n),r=r??!1;let o=t&&!r?this._u():[],a=0===this.Xa.size&&this.current&&!r?1:0,l=a!==this.Za;return(this.Za=a,0!==s.length||l)?{snapshot:new hm(this.query,e.tu,i,s,e.mutatedKeys,0===a,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),au:o}:{au:o}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new hp,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Ya=this.Ya.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ya=this.Ya.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];let e=this.Xa;this.Xa=oH(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Xa=this.Xa.add(e.key))});let t=[];return e.forEach(e=>{this.Xa.has(e)||t.push(new hS(e))}),this.Xa.forEach(n=>{e.has(n)||t.push(new hI(n))}),t}cu(e){this.Ya=e.Qs,this.Xa=oH();let t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return hm.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}let hR="SyncEngine";class hN{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class hA{constructor(e){this.key=e,this.hu=!1}}class hx{constructor(e,t,n,r,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Pu={},this.Tu=new oU(e=>oO(e),oD),this.Iu=new Map,this.Eu=new Set,this.du=new sI(si.comparator),this.Au=new Map,this.Ru=new ls,this.Vu={},this.mu=new Map,this.fu=a3.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function hP(e,t,n=!0){let r,i=hZ(e),s=i.Tu.get(t);return s?(i.sharedClientState.addLocalQueryTarget(s.targetId),r=s.view.lu()):r=await hO(i,t,n,!0),r}async function hD(e,t){let n=hZ(e);await hO(n,t,!0,!1)}async function hO(e,t,n,r){var i,s;let o,a=await (i=e.localStore,s=ox(t),i.persistence.runTransaction("Allocate target","readwrite",e=>{let t;return i.Pi.getTargetData(e,s).next(n=>n?(t=n,s_.resolve(t)):i.Pi.allocateTargetId(e).next(n=>(t=new aY(s,n,"TargetPurposeListen",e.currentSequenceNumber),i.Pi.addTargetData(e,t).next(()=>t))))}).then(e=>{let t=i.Ms.get(e.targetId);return(null===t||e.snapshotVersion.compareTo(t.snapshotVersion)>0)&&(i.Ms=i.Ms.insert(e.targetId,e),i.xs.set(s,e.targetId)),e})),l=a.targetId,h=e.sharedClientState.addLocalQueryTarget(l,n);return r&&(o=await hL(e,t,l,"current"===h,a.resumeToken)),e.isPrimaryClient&&n&&lX(e.remoteStore,a),o}async function hL(e,t,n,r,i){e.pu=(t,n,r)=>(async function(e,t,n,r){let i=t.view.ru(n);i.Cs&&(i=await lT(e.localStore,t.query,!1).then(({documents:e})=>t.view.ru(e,i)));let s=r&&r.targetChanges.get(t.targetId),o=r&&null!=r.targetMismatches.get(t.targetId),a=t.view.applyChanges(i,e.isPrimaryClient,s,o);return hG(e,t.targetId,a.au),a.snapshot})(e,t,n,r);let s=await lT(e.localStore,t,!0),o=new hk(t,s.Qs),a=o.ru(s.documents),l=aE.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==e.onlineState,i),h=o.applyChanges(a,e.isPrimaryClient,l);hG(e,n,h.au);let u=new hN(t,n,o);return e.Tu.set(t,u),e.Iu.has(n)?e.Iu.get(n).push(t):e.Iu.set(n,[t]),h.snapshot}async function hM(e,t,n){let r=e.Tu.get(t),i=e.Iu.get(r.targetId);i.length>1?(e.Iu.set(r.targetId,i.filter(e=>!oD(e,t))),e.Tu.delete(t)):e.isPrimaryClient?(e.sharedClientState.removeLocalQueryTarget(r.targetId),e.sharedClientState.isActiveQueryTarget(r.targetId)||await lE(e.localStore,r.targetId,!1).then(()=>{e.sharedClientState.clearQueryState(r.targetId),n&&lJ(e.remoteStore,r.targetId),hH(e,r.targetId)}).catch(sy)):(hH(e,r.targetId),await lE(e.localStore,r.targetId,!0))}async function hF(e,t){let n=e.Tu.get(t),r=e.Iu.get(n.targetId);e.isPrimaryClient&&1===r.length&&(e.sharedClientState.removeLocalQueryTarget(n.targetId),lJ(e.remoteStore,n.targetId))}async function hU(e,t,n){var r,i,s;let o=((r=e).remoteStore.remoteSyncer.applySuccessfulWrite=hz.bind(null,r),r.remoteStore.remoteSyncer.rejectFailedWrite=hB.bind(null,r),r);try{let e,r,a,l,h,u=await (i=o.localStore,a=sf.now(),l=t.reduce((e,t)=>e.add(t.key),oH()),i.persistence.runTransaction("Locally write mutations","readwrite",n=>{let s=oV,o=oH();return i.Ns.getEntries(n,l).next(e=>{(s=e).forEach((e,t)=>{t.isValidDocument()||(o=o.add(e))})}).next(()=>i.localDocuments.getOverlayedDocuments(n,s)).next(r=>{e=r;let s=[];for(let n of t){let t=function(e,t){let n=null;for(let r of e.fieldTransforms){let e=t.data.field(r.field),i=oX(r.transform,e||null);null!=i&&(null===n&&(n=or.empty()),n.set(r.field,i))}return n||null}(n,e.get(n.key).overlayedDocument);null!=t&&s.push(new as(n.key,t,function e(t){let n=[];return sT(t.fields,(t,r)=>{let i=new sr([t]);if(s9(r)){let t=e(r.mapValue).fields;if(0===t.length)n.push(i);else for(let e of t)n.push(i.child(e))}else n.push(i)}),new sA(n)}(t.value.mapValue),o7.exists(!0)))}return i.mutationQueue.addMutationBatch(n,a,s,t)}).next(t=>{r=t;let s=t.applyToLocalDocumentSet(e,o);return i.documentOverlayCache.saveOverlays(n,t.batchId,s)})}).then(()=>({batchId:r.batchId,changes:oz(e)})));o.sharedClientState.addPendingMutation(u.batchId),s=u.batchId,(h=o.Vu[o.currentUser.toKey()])||(h=new sI(i4)),h=h.insert(s,n),o.Vu[o.currentUser.toKey()]=h,await hY(o,u.changes),await he(o.remoteStore)}catch(t){let e=hd(t,"Failed to persist write");n.reject(e)}}async function hV(e,t){var n;try{let r,i,s=await (n=e.localStore,r=t.snapshotVersion,i=n.Ms,n.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{var s,o,a;let l,h,u=n.Ns.newChangeBuffer({trackRemovals:!0});i=n.Ms;let c=[];t.targetChanges.forEach((s,o)=>{var a;let l=i.get(o);if(!l)return;c.push(n.Pi.removeMatchingKeys(e,s.removedDocuments,o).next(()=>n.Pi.addMatchingKeys(e,s.addedDocuments,o)));let h=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(o)?h=h.withResumeToken(sP.EMPTY_BYTE_STRING,sp.min()).withLastLimboFreeSnapshotVersion(sp.min()):s.resumeToken.approximateByteSize()>0&&(h=h.withResumeToken(s.resumeToken,r)),i=i.insert(o,h),a=h,(0===l.resumeToken.approximateByteSize()||a.snapshotVersion.toMicroseconds()-l.snapshotVersion.toMicroseconds()>=3e8||s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size>0)&&c.push(n.Pi.updateTargetData(e,h))});let d=oV,f=oH();if(t.documentUpdates.forEach(r=>{t.resolvedLimboDocuments.has(r)&&c.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))}),c.push((s=e,o=u,a=t.documentUpdates,l=oH(),h=oH(),a.forEach(e=>l=l.add(e)),o.getEntries(s,l).next(e=>{let t=oV;return a.forEach((n,r)=>{let i=e.get(n);r.isFoundDocument()!==i.isFoundDocument()&&(h=h.add(n)),r.isNoDocument()&&r.version.isEqual(sp.min())?(o.removeEntry(n,r.readTime),t=t.insert(n,r)):!i.isValidDocument()||r.version.compareTo(i.version)>0||0===r.version.compareTo(i.version)&&i.hasPendingWrites?(o.addEntry(r),t=t.insert(n,r)):ij(l_,"Ignoring outdated watch update for ",n,". Current version:",i.version," Watch version:",r.version)}),{ks:t,qs:h}})).next(e=>{d=e.ks,f=e.qs})),!r.isEqual(sp.min())){let t=n.Pi.getLastRemoteSnapshotVersion(e).next(t=>n.Pi.setTargetsMetadata(e,e.currentSequenceNumber,r));c.push(t)}return s_.waitFor(c).next(()=>u.apply(e)).next(()=>n.localDocuments.getLocalViewOfDocuments(e,d,f)).next(()=>d)}).then(e=>(n.Ms=i,e)));t.targetChanges.forEach((t,n)=>{let r=e.Au.get(n);r&&(iH(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?r.hu=!0:t.modifiedDocuments.size>0?iH(r.hu,14607):t.removedDocuments.size>0&&(iH(r.hu,42227),r.hu=!1))}),await hY(e,s,t)}catch(e){await sy(e)}}function hj(e,t,n){var r;if(e.isPrimaryClient&&0===n||!e.isPrimaryClient&&1===n){let n,i=[];e.Tu.forEach((e,n)=>{let r=n.view.va(t);r.snapshot&&i.push(r.snapshot)}),(r=e.eventManager).onlineState=t,n=!1,r.queries.forEach((e,r)=>{for(let e of r.Sa)e.va(t)&&(n=!0)}),n&&hT(r),i.length&&e.Pu.H_(i),e.onlineState=t,e.isPrimaryClient&&e.sharedClientState.setOnlineState(t)}}async function hq(e,t,n){e.sharedClientState.updateQueryState(t,"rejected",n);let r=e.Au.get(t),i=r&&r.key;if(i){let n=new sI(si.comparator);n=n.insert(i,oi.newNoDocument(i,sp.min()));let r=oH().add(i),s=new ab(sp.min(),new Map,new sI(i4),n,r);await hV(e,s),e.du=e.du.remove(i),e.Au.delete(t),hQ(e)}else await lE(e.localStore,t,!1).then(()=>hH(e,t,n)).catch(sy)}async function hz(e,t){var n;let r=t.batch.batchId;try{let i=await (n=e.localStore,n.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{let r,i,s,o=t.batch.keys(),a=n.Ns.newChangeBuffer({trackRemovals:!0});return(i=(r=t.batch).keys(),s=s_.resolve(),i.forEach(n=>{s=s.next(()=>a.getEntry(e,n)).next(e=>{let i=t.docVersions.get(n);iH(null!==i,48541),0>e.version.compareTo(i)&&(r.applyToRemoteDocument(e,t),e.isValidDocument()&&(e.setReadTime(t.commitVersion),a.addEntry(e)))})}),s.next(()=>n.mutationQueue.removeMutationBatch(e,r))).next(()=>a.apply(e)).next(()=>n.mutationQueue.performConsistencyCheck(e)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(e,o,t.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=oH();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))).next(()=>n.localDocuments.getDocuments(e,o))}));hW(e,r,null),h$(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),await hY(e,i)}catch(e){await sy(e)}}async function hB(e,t,n){var r;try{let i=await (r=e.localStore,r.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return r.mutationQueue.lookupMutationBatch(e,t).next(t=>(iH(null!==t,37113),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t))).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>r.localDocuments.getDocuments(e,n))}));hW(e,t,n),h$(e,t),e.sharedClientState.updateMutationState(t,"rejected",n),await hY(e,i)}catch(e){await sy(e)}}function h$(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function hW(e,t,n){let r=e.Vu[e.currentUser.toKey()];if(r){let i=r.get(t);i&&(n?i.reject(n):i.resolve(),r=r.remove(t)),e.Vu[e.currentUser.toKey()]=r}}function hH(e,t,n=null){for(let r of(e.sharedClientState.removeLocalQueryTarget(t),e.Iu.get(t)))e.Tu.delete(r),n&&e.Pu.yu(r,n);e.Iu.delete(t),e.isPrimaryClient&&e.Ru.jr(t).forEach(t=>{e.Ru.containsKey(t)||hK(e,t)})}function hK(e,t){e.Eu.delete(t.path.canonicalString());let n=e.du.get(t);null!==n&&(lJ(e.remoteStore,n),e.du=e.du.remove(t),e.Au.delete(n),hQ(e))}function hG(e,t,n){for(let r of n)r instanceof hI?(e.Ru.addReference(r.key,t),function(e,t){let n=t.key,r=n.path.canonicalString();e.du.get(n)||e.Eu.has(r)||(ij(hR,"New document in limbo: "+n),e.Eu.add(r),hQ(e))}(e,r)):r instanceof hS?(ij(hR,"Document no longer in limbo: "+r.key),e.Ru.removeReference(r.key,t),e.Ru.containsKey(r.key)||hK(e,r.key)):i$(19791,{wu:r})}function hQ(e){for(;e.Eu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){let t=e.Eu.values().next().value;e.Eu.delete(t);let n=new si(st.fromString(t)),r=e.fu.next();e.Au.set(r,new hA(n)),e.du=e.du.insert(n,r),lX(e.remoteStore,new aY(ox(oR(n.path)),r,"TargetPurposeLimboResolution",sw.ce))}}async function hY(e,t,n){let r=[],i=[],s=[];e.Tu.isEmpty()||(e.Tu.forEach((o,a)=>{s.push(e.pu(a,t,n).then(t=>{if((t||n)&&e.isPrimaryClient){let r=t?!t.fromCache:n?.targetChanges.get(a.targetId)?.current;e.sharedClientState.updateQueryState(a.targetId,r?"current":"not-current")}if(t){r.push(t);let e=lm.As(a.targetId,t);i.push(e)}}))}),await Promise.all(s),e.Pu.H_(r),await async function(e,t){try{await e.persistence.runTransaction("notifyLocalViewChanges","readwrite",n=>s_.forEach(t,t=>s_.forEach(t.Es,r=>e.persistence.referenceDelegate.addReference(n,t.targetId,r)).next(()=>s_.forEach(t.ds,r=>e.persistence.referenceDelegate.removeReference(n,t.targetId,r)))))}catch(e){if(!sv(e))throw e;ij(l_,"Failed to update sequence numbers: "+e)}for(let n of t){let t=n.targetId;if(!n.fromCache){let n=e.Ms.get(t),r=n.snapshotVersion,i=n.withLastLimboFreeSnapshotVersion(r);e.Ms=e.Ms.insert(t,i)}}}(e.localStore,i))}async function hX(e,t){if(!e.currentUser.isEqual(t)){ij(hR,"User change. New user:",t.toKey());let n=await lw(e.localStore,t);e.currentUser=t,e.mu.forEach(e=>{e.forEach(e=>{e.reject(new iG(iK.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),e.mu.clear(),e.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),await hY(e,n.Ls)}}function hJ(e,t){let n=e.Au.get(t);if(n&&n.hu)return oH().add(n.key);{let n=oH(),r=e.Iu.get(t);if(!r)return n;for(let t of r){let r=e.Tu.get(t);n=n.unionWith(r.view.nu)}return n}}function hZ(e){return e.remoteStore.remoteSyncer.applyRemoteEvent=hV.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=hJ.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=hq.bind(null,e),e.Pu.H_=hb.bind(null,e.eventManager),e.Pu.yu=hE.bind(null,e.eventManager),e}class h0{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=lU(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){var t,n;return t=this.persistence,n=new ly,new lv(t,n,e.initialUser,this.serializer)}Cu(e){return new lc(lf.mi,this.serializer)}Du(e){return new lI}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}h0.provider={build:()=>new h0};class h1 extends h0{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){return iH(this.persistence.referenceDelegate instanceof lp,46915),new a8(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Cu(e){let t=void 0!==this.cacheSizeBytes?a2.withCacheSize(this.cacheSizeBytes):a2.DEFAULT;return new lc(e=>lp.mi(e,t),this.serializer)}}class h2{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>hj(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=hX.bind(null,this.syncEngine),await hl(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new hy}createDatastore(e){var t;let n=lU(e.databaseInfo.databaseId),r=new lM(e.databaseInfo);return t=e.authCredentials,new lW(t,e.appCheckCredentials,r,n)}createRemoteStore(e){var t,n;return t=this.localStore,n=this.datastore,new lG(t,n,e.asyncQueue,e=>hj(this.syncEngine,e,0),lR.v()?new lR:new lS)}createSyncEngine(e,t){var n,r,i,s,o,a;let l;return n=this.localStore,r=this.remoteStore,i=this.eventManager,s=this.sharedClientState,o=e.initialUser,a=e.maxConcurrentLimboResolutions,l=new hx(n,r,i,s,o,a),t&&(l.gu=!0),l}async terminate(){await async function(e){ij(lK,"RemoteStore shutting down."),e.Ea.add(5),await lY(e),e.Aa.shutdown(),e.Ra.set("Unknown")}(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}h2.provider={build:()=>new h2};class h3{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):iq("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}let h6="FirestoreClient";class h4{constructor(e,t,n,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=r,this.user=iM.UNAUTHENTICATED,this.clientId=i6.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async e=>{ij(h6,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(n,e=>(ij(h6,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();let e=new iQ;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){let t=hd(n,"Failed to shutdown persistence");e.reject(t)}}),e.promise}}async function h5(e,t){e.asyncQueue.verifyOperationInProgress(),ij(h6,"Initializing OfflineComponentProvider");let n=e.configuration;await t.initialize(n);let r=n.initialUser;e.setCredentialChangeListener(async e=>{r.isEqual(e)||(await lw(t.localStore,e),r=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function h8(e,t){e.asyncQueue.verifyOperationInProgress();let n=await h7(e);ij(h6,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener(e=>ha(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,n)=>ha(t.remoteStore,n)),e._onlineComponents=t}async function h7(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){ij(h6,"Using user provided OfflineComponentProvider");try{await h5(e,e._uninitializedComponentsProvider._offline)}catch(t){if(!("FirebaseError"===t.name?t.code===iK.FAILED_PRECONDITION||t.code===iK.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code))throw t;iz("Error using user provided cache. Falling back to memory cache: "+t),await h5(e,new h0)}}else ij(h6,"Using default OfflineComponentProvider"),await h5(e,new h1(void 0));return e._offlineComponents}async function h9(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(ij(h6,"Using user provided OnlineComponentProvider"),await h8(e,e._uninitializedComponentsProvider._online)):(ij(h6,"Using default OnlineComponentProvider"),await h8(e,new h2))),e._onlineComponents}async function ue(e){let t=await h9(e),n=t.eventManager;return n.onListen=hP.bind(null,t.syncEngine),n.onUnlisten=hM.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=hD.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=hF.bind(null,t.syncEngine),n}function ut(e){let t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}let un=new Map,ur="firestore.googleapis.com";class ui{constructor(e){if(void 0===e.host){if(void 0!==e.ssl)throw new iG(iK.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=ur,this.ssl=!0}else this.host=e.host,this.ssl=e.ssl??!0;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=0x2800000;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new iG(iK.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,r){if(!0===t&&!0===r)throw new iG(iK.INVALID_ARGUMENT,`${e} and ${n} cannot be used together.`)})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=ut(e.experimentalLongPollingOptions??{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new iG(iK.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new iG(iK.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new iG(iK.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){var t,n;return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(t=this.experimentalLongPollingOptions,n=e.experimentalLongPollingOptions,t.timeoutSeconds===n.timeoutSeconds)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class us{constructor(e,t,n,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ui({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new iG(iK.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new iG(iK.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ui(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new iX;switch(e.type){case"firstParty":return new i1(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new iG(iK.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){let e;return(e=un.get(this))&&(ij("ComponentProvider","Removing Datastore"),un.delete(this),e.terminate()),Promise.resolve()}}class uo{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new uo(this.firestore,e,this._query)}}class ua{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ul(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ua(this.firestore,e,this._key)}toJSON(){return{type:ua._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(sd(t,ua._jsonSchema))return new ua(e,n||null,new si(st.fromString(t.referencePath)))}}ua._jsonSchemaVersion="firestore/documentReference/1.0",ua._jsonSchema={type:sc("string",ua._jsonSchemaVersion),referencePath:sc("string")};class ul extends uo{constructor(e,t,n){super(e,t,oR(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new ua(this.firestore,null,new si(e))}withConverter(e){return new ul(this.firestore,e,this._path)}}function uh(e,t,...n){if(e=eO(e),ss("collection","path",t),e instanceof us){let r=st.fromString(t,...n);return sa(r),new ul(e,null,r)}{if(!(e instanceof ua||e instanceof ul))throw new iG(iK.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(st.fromString(t,...n));return sa(r),new ul(e.firestore,null,r)}}function uu(e,t,...n){if(e=eO(e),1==arguments.length&&(t=i6.newId()),ss("doc","path",t),e instanceof us){let r=st.fromString(t,...n);return so(r),new ua(e,null,new si(r))}{if(!(e instanceof ua||e instanceof ul))throw new iG(iK.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=e._path.child(st.fromString(t,...n));return so(r),new ua(e.firestore,e instanceof ul?e.converter:null,new si(r))}}let uc="AsyncQueue";class ud{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new lV(this,"async_queue_retry"),this._c=()=>{let e=lF();e&&ij(uc,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=lF();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;let t=lF();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});let t=new iQ;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(0!==this.Xu.length){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!sv(e))throw e;ij(uc,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){let t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,iq("INTERNAL UNHANDLED ERROR: ",uf(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,n){this.uc(),this.oc.indexOf(e)>-1&&(t=0);let r=hc.createAndSchedule(this,e,t,n,e=>this.hc(e));return this.tc.push(r),r}uc(){this.nc&&i$(47125,{Pc:uf(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(let t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{for(let t of(this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs),this.tc))if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){let t=this.tc.indexOf(e);this.tc.splice(t,1)}}function uf(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}function up(e){if("object"!=typeof e||null===e)return!1;for(let t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}class um extends us{constructor(e,t,n,r){super(e,t,n,r),this.type="firestore",this._queue=new ud,this._persistenceKey=r?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){let e=this._firestoreClient.terminate();this._queue=new ud(e),this._firestoreClient=void 0,await e}}}function ug(e,t){let n=ts("object"==typeof e?e:t_(),"firestore").getImmediate({identifier:"string"==typeof e?e:t||sW});if(!n._initialized){let e=X("firestore");e&&function(e,t,n,r={}){e=su(e,us);let i=et(t),s=e._getSettings(),o={...s,emulatorOptions:e._getEmulatorOptions()},a=`${t}:${n}`;i&&(en(`https://${a}`),eo("Firestore",!0)),s.host!==ur&&s.host!==a&&iz("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");let l={...s,host:a,ssl:i,emulatorOptions:r};if(!eC(l,o)&&(e._setSettings(l),r.mockUserToken)){let t,n;if("string"==typeof r.mockUserToken)t=r.mockUserToken,n=iM.MOCK_USER;else{t=er(r.mockUserToken,e._app?.options.projectId);let i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new iG(iK.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new iM(i)}e._authCredentials=new iJ(new iY(t,n))}}(n,...e)}return n}function uy(e){if(e._terminated)throw new iG(iK.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,n,r;let i,s=e._freezeSettings(),o=(t=e._databaseId,n=e._app?.options.appId||"",new s$(t,n,e._persistenceKey,s.host,s.ssl,s.experimentalForceLongPolling,s.experimentalAutoDetectLongPolling,ut(s.experimentalLongPollingOptions),s.useFetchStreams,s.isUsingEmulator));e._componentsProvider||s.localCache?._offlineComponentProvider&&s.localCache?._onlineComponentProvider&&(e._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),e._firestoreClient=new h4(e._authCredentials,e._appCheckCredentials,e._queue,o,e._componentsProvider&&(r=e._componentsProvider,i=r?._online.build(),{_offline:r?._offline.build(i),_online:i}))}(e),e._firestoreClient}class u_{constructor(e){this._byteString=e}static fromBase64String(e){try{return new u_(sP.fromBase64String(e))}catch(e){throw new iG(iK.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new u_(sP.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:u_._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(sd(e,u_._jsonSchema))return u_.fromBase64String(e.bytes)}}u_._jsonSchemaVersion="firestore/bytes/1.0",u_._jsonSchema={type:sc("string",u_._jsonSchemaVersion),bytes:sc("string")};class uv{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new iG(iK.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new sr(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class uw{constructor(e){this._methodName=e}}class ub{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new iG(iK.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new iG(iK.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return i4(this._lat,e._lat)||i4(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:ub._jsonSchemaVersion}}static fromJSON(e){if(sd(e,ub._jsonSchema))return new ub(e.latitude,e.longitude)}}ub._jsonSchemaVersion="firestore/geoPoint/1.0",ub._jsonSchema={type:sc("string",ub._jsonSchemaVersion),latitude:sc("number"),longitude:sc("number")};class uE{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}toJSON(){return{type:uE._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(sd(e,uE._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new uE(e.vectorValues);throw new iG(iK.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}uE._jsonSchemaVersion="firestore/vectorValue/1.0",uE._jsonSchema={type:sc("string",uE._jsonSchemaVersion),vectorValues:sc("object")};let uT=/^__.*__$/;class uC{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new as(e,this.data,this.fieldMask,t,this.fieldTransforms):new ai(e,this.data,t,this.fieldTransforms)}}class uI{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new as(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function uS(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw i$(40011,{Ac:e})}}class uk{constructor(e,t,n,r,i,s){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new uk({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){let t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.gc(e),n}yc(e){let t=this.path?.child(e),n=this.Vc({path:t,fc:!1});return n.Rc(),n}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return uj(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(0===e.length)throw this.Sc("Document fields must not be empty");if(uS(this.Ac)&&uT.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class uR{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||lU(e)}Cc(e,t,n,r=!1){return new uk({Ac:e,methodName:t,Dc:n,path:sr.emptyPath(),fc:!1,bc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function uN(e){let t=e._freezeSettings(),n=lU(e._databaseId);return new uR(e._databaseId,!!t.ignoreUndefinedProperties,n)}function uA(e,t,n,r,i,s={}){let o,a,l=e.Cc(s.merge||s.mergeFields?2:0,t,n,i);uM("Data must be an object, but it was:",l,r);let h=uO(r,l);if(s.merge)o=new sA(l.fieldMask),a=l.fieldTransforms;else if(s.mergeFields){let e=[];for(let r of s.mergeFields){let i=uF(t,r,n);if(!l.contains(i))throw new iG(iK.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);uq(e,i)||e.push(i)}o=new sA(e),a=l.fieldTransforms.filter(e=>o.covers(e.field))}else o=null,a=l.fieldTransforms;return new uC(new or(h),o,a)}class ux extends uw{_toFieldTransform(e){if(2!==e.Ac)throw 1===e.Ac?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof ux}}class uP extends uw{_toFieldTransform(e){return new o5(e.path,new oJ)}isEqual(e){return e instanceof uP}}function uD(e,t){if(uL(e=eO(e)))return uM("Unsupported field value:",t,e),uO(e,t);if(e instanceof uw)return function(e,t){if(!uS(t.Ac))throw t.Sc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.Sc(`${e._methodName}() is not currently supported inside arrays`);let n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.fc&&4!==t.Ac)throw t.Sc("Nested arrays are not supported");let n=[],r=0;for(let i of e){let e=uD(i,t.wc(r));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),r++}return{arrayValue:{values:n}}}return function(e,t){var n,r,i;if(null===(e=eO(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return n=t.serializer,"number"==typeof(i=r=e)&&Number.isInteger(i)&&!sb(i)&&i<=Number.MAX_SAFE_INTEGER&&i>=Number.MIN_SAFE_INTEGER?oQ(r):oG(n,r);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){let n=sf.fromDate(e);return{timestampValue:aL(t.serializer,n)}}if(e instanceof sf){let n=new sf(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:aL(t.serializer,n)}}if(e instanceof ub)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof u_)return{bytesValue:aM(t.serializer,e._byteString)};if(e instanceof ua){let n=t.databaseId,r=e.firestore._databaseId;if(!r.isEqual(n))throw t.Sc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:aU(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof uE)return{mapValue:{fields:{[sK]:{stringValue:sY},[sX]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.Sc("VectorValues must only contain numeric values.");return oG(t.serializer,e)})}}}}};throw t.Sc(`Unsupported field value: ${sh(e)}`)}(e,t)}function uO(e,t){let n={};return sC(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):sT(e,(e,r)=>{let i=uD(r,t.mc(e));null!=i&&(n[e]=i)}),{mapValue:{fields:n}}}function uL(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof sf||e instanceof ub||e instanceof u_||e instanceof ua||e instanceof uw||e instanceof uE)}function uM(e,t,n){if(!uL(n)||!sl(n)){let r=sh(n);throw"an object"===r?t.Sc(e+" a custom object"):t.Sc(e+" "+r)}}function uF(e,t,n){if((t=eO(t))instanceof uv)return t._internalPath;if("string"==typeof t)return uV(e,t);throw uj("Field path arguments must be of type string or ",e,!1,void 0,n)}let uU=RegExp("[~\\*/\\[\\]]");function uV(e,t,n){if(t.search(uU)>=0)throw uj(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new uv(...t.split("."))._internalPath}catch(r){throw uj(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function uj(e,t,n,r,i){let s=r&&!r.isEmpty(),o=void 0!==i,a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new iG(iK.INVALID_ARGUMENT,a+e+l)}function uq(e,t){return e.some(e=>e.isEqual(t))}class uz{constructor(e,t,n,r,i){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new ua(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){let e=new uB(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){let t=this._document.data.field(u$("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class uB extends uz{data(){return super.data()}}function u$(e,t){return"string"==typeof t?uV(e,t):t instanceof uv?t._internalPath:t._delegate._internalPath}function uW(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new iG(iK.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class uH{convertValue(e,t="none"){switch(sJ(e)){case 0:return null;case 1:return e.booleanValue;case 2:return sL(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(sM(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw i$(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let n={};return sT(e,(e,r)=>{n[e]=this.convertValue(r,t)}),n}convertVectorValue(e){return new uE(e.fields?.[sX].arrayValue?.values?.map(e=>sL(e.doubleValue)))}convertGeoPoint(e){return new ub(sL(e.latitude),sL(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":let n=sz(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(sB(e));default:return null}}convertTimestamp(e){let t=sO(e);return new sf(t.seconds,t.nanos)}convertDocumentKey(e,t){let n=st.fromString(e);iH(aQ(n),9688,{name:e});let r=new sH(n.get(1),n.get(3)),i=new si(n.popFirst(5));return r.isEqual(t)||iq(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),i}}function uK(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}class uG{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class uQ extends uz{constructor(e,t,n,r,i,s){super(e,t,n,r,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){let t=new uY(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){let n=this._document.data.field(u$("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new iG(iK.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e=this._document,t={};return t.type=uQ._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()&&(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),this._firestore,this.ref.path,t.bundle="NOT SUPPORTED"),t}}uQ._jsonSchemaVersion="firestore/documentSnapshot/1.0",uQ._jsonSchema={type:sc("string",uQ._jsonSchemaVersion),bundleSource:sc("string","DocumentSnapshot"),bundleName:sc("string"),bundle:sc("string")};class uY extends uQ{data(e={}){return super.data(e)}}class uX{constructor(e,t,n,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new uG(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(n=>{e.call(t,new uY(this._firestore,this._userDataWriter,n.key,n,new uG(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new iG(iK.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(n=>{let r=new uY(e._firestore,e._userDataWriter,n.doc.key,n.doc,new uG(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:t++}})}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{let r=new uY(e._firestore,e._userDataWriter,t.doc.key,t.doc,new uG(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,s=-1;return 0!==t.type&&(i=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(s=(n=n.add(t.doc)).indexOf(t.doc.key)),{type:function(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return i$(61501,{type:e})}}(t.type),doc:r,oldIndex:i,newIndex:s}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new iG(iK.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");let e={};e.type=uX._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=i6.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;let t=[],n=[],r=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),n.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),r.push(e.ref.path))}),this._firestore,this.query._query,e.bundleName,e.bundle="NOT SUPPORTED",e}}function uJ(e){e=su(e,ua);let t=su(e.firestore,um);return(function(e,t,n={}){let r=new iQ;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let o,a;return i=await ue(e),s=e.asyncQueue,o=new h3({next:e=>{o.Nu(),s.enqueueAndForget(()=>hw(i,a));let l=e.docs.has(t);!l&&e.fromCache?r.reject(new iG(iK.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&e.fromCache&&n&&"server"===n.source?r.reject(new iG(iK.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):r.resolve(e)},error:e=>r.reject(e)}),hv(i,a=new hC(oR(t.path),o,{includeMetadataChanges:!0,qa:!0}))}),r.promise})(uy(t),e._key).then(n=>u8(t,e,n))}uX._jsonSchemaVersion="firestore/querySnapshot/1.0",uX._jsonSchema={type:sc("string",uX._jsonSchemaVersion),bundleSource:sc("string","QuerySnapshot"),bundleName:sc("string"),bundle:sc("string")};class uZ extends uH{constructor(e){super(),this.firestore=e}convertBytes(e){return new u_(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new ua(this.firestore,null,t)}}function u0(e){e=su(e,uo);let t=su(e.firestore,um),n=uy(t),r=new uZ(t);return uW(e._query),(function(e,t,n={}){let r=new iQ;return e.asyncQueue.enqueueAndForget(async()=>{var i,s;let o,a;return i=await ue(e),s=e.asyncQueue,a=new hC(t,o=new h3({next:e=>{o.Nu(),s.enqueueAndForget(()=>hw(i,a)),e.fromCache&&"server"===n.source?r.reject(new iG(iK.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):r.resolve(e)},error:e=>r.reject(e)}),{includeMetadataChanges:!0,qa:!0}),hv(i,a)}),r.promise})(n,e._query).then(n=>new uX(t,r,e,n))}function u1(e,t,n){e=su(e,ua);let r=su(e.firestore,um),i=uK(e.converter,t,n);return u5(r,[uA(uN(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,o7.none())])}function u2(e,t,n,...r){var i,s,o;let a,l,h;e=su(e,ua);let u=su(e.firestore,um),c=uN(u);return u5(u,[("string"==typeof(t=eO(t))||t instanceof uv?function(e,t,n,r,i,s){let o=e.Cc(1,t,n),a=[uF(t,r,n)],l=[i];if(s.length%2!=0)throw new iG(iK.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<s.length;e+=2)a.push(uF(t,s[e])),l.push(s[e+1]);let h=[],u=or.empty();for(let e=a.length-1;e>=0;--e)if(!uq(h,a[e])){let t=a[e],n=l[e];n=eO(n);let r=o.yc(t);if(n instanceof ux)h.push(t);else{let e=uD(n,r);null!=e&&(h.push(t),u.set(t,e))}}return new uI(u,new sA(h),o.fieldTransforms)}(c,"updateDoc",e._key,t,n,r):(i="updateDoc",s=e._key,o=t,uM("Data must be an object, but it was:",a=c.Cc(1,i,s),o),l=[],h=or.empty(),sT(o,(e,t)=>{let n=uV(i,e,s);t=eO(t);let r=a.yc(n);if(t instanceof ux)l.push(n);else{let e=uD(t,r);null!=e&&(l.push(n),h.set(n,e))}}),new uI(h,new sA(l),a.fieldTransforms))).toMutation(e._key,o7.exists(!0))])}function u3(e){return u5(su(e.firestore,um),[new ah(e._key,o7.none())])}function u6(e,t){let n=su(e.firestore,um),r=uu(e),i=uK(e.converter,t);return u5(n,[uA(uN(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,o7.exists(!1))]).then(()=>r)}function u4(e,...t){var n;let r,i,s,o,a;e=eO(e);let l={includeMetadataChanges:!1,source:"default"},h=0;"object"!=typeof t[0]||up(t[h])||(l=t[h++]);let u={includeMetadataChanges:l.includeMetadataChanges,source:l.source};if(up(t[h])){let e=t[h];t[h]=e.next?.bind(e),t[h+1]=e.error?.bind(e),t[h+2]=e.complete?.bind(e)}if(e instanceof ua)i=su(e.firestore,um),s=oR(e._key.path),r={next:n=>{t[h]&&t[h](u8(i,e,n))},error:t[h+1],complete:t[h+2]};else{let n=su(e,uo);i=su(n.firestore,um),s=n._query;let o=new uZ(i);r={next:e=>{t[h]&&t[h](new uX(i,o,n,e))},error:t[h+1],complete:t[h+2]},uW(e._query)}return n=uy(i),a=new hC(s,o=new h3(r),u),n.asyncQueue.enqueueAndForget(async()=>hv(await ue(n),a)),()=>{o.Nu(),n.asyncQueue.enqueueAndForget(async()=>hw(await ue(n),a))}}function u5(e,t){var n;let r;return n=uy(e),r=new iQ,n.asyncQueue.enqueueAndForget(async()=>hU(await h9(n).then(e=>e.syncEngine),t,r)),r.promise}function u8(e,t,n){let r=n.docs.get(t._key),i=new uZ(e);return new uQ(e,i,t._key,r,new uG(n.hasPendingWrites,n.fromCache),t.converter)}function u7(){return new uP("serverTimestamp")}new WeakMap,function(e=!0){iF=tm,ti(new eL("firestore",(t,{instanceIdentifier:n,options:r})=>{let i=t.getProvider("app").getImmediate(),s=new um(new iZ(t.getProvider("auth-internal")),new i3(i,t.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new iG(iK.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new sH(e.options.projectId,t)}(i,n),i);return r={useFetchStreams:e,...r},s._setSettings(r),s},"PUBLIC").setMultipleInstances(!0)),tb(iO,iL,void 0),tb(iO,iL,"esm2020")}(),e.s(["Timestamp",()=>sf,"addDoc",()=>u6,"collection",()=>uh,"deleteDoc",()=>u3,"doc",()=>uu,"getDoc",()=>uJ,"getDocs",()=>u0,"getFirestore",()=>ug,"onSnapshot",()=>u4,"serverTimestamp",()=>u7,"setDoc",()=>u1,"updateDoc",()=>u2],98925),e.s([],36180);let u9="firebasestorage.googleapis.com";class ce extends ed{constructor(e,t,n=0){super(ct(e),`Firebase Storage: ${t} (${ct(e)})`),this.status_=n,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,ce.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return ct(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message=`${this._baseMessage}
${this.customData.serverResponse}`:this.message=this._baseMessage}}function ct(e){return"storage/"+e}function cn(e){return new ce(M.INVALID_ARGUMENT,e)}function cr(){return new ce(M.APP_DELETED,"The Firebase app was deleted.")}(_=M||(M={})).UNKNOWN="unknown",_.OBJECT_NOT_FOUND="object-not-found",_.BUCKET_NOT_FOUND="bucket-not-found",_.PROJECT_NOT_FOUND="project-not-found",_.QUOTA_EXCEEDED="quota-exceeded",_.UNAUTHENTICATED="unauthenticated",_.UNAUTHORIZED="unauthorized",_.UNAUTHORIZED_APP="unauthorized-app",_.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",_.INVALID_CHECKSUM="invalid-checksum",_.CANCELED="canceled",_.INVALID_EVENT_NAME="invalid-event-name",_.INVALID_URL="invalid-url",_.INVALID_DEFAULT_BUCKET="invalid-default-bucket",_.NO_DEFAULT_BUCKET="no-default-bucket",_.CANNOT_SLICE_BLOB="cannot-slice-blob",_.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",_.NO_DOWNLOAD_URL="no-download-url",_.INVALID_ARGUMENT="invalid-argument",_.INVALID_ARGUMENT_COUNT="invalid-argument-count",_.APP_DELETED="app-deleted",_.INVALID_ROOT_OPERATION="invalid-root-operation",_.INVALID_FORMAT="invalid-format",_.INTERNAL_ERROR="internal-error",_.UNSUPPORTED_ENVIRONMENT="unsupported-environment";class ci{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){let e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let n;try{n=ci.makeFromUrl(e,t)}catch(t){return new ci(e,"")}if(""===n.path)return n;throw new ce(M.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+e+"'.")}static makeFromUrl(e,t){let n=null,r="([A-Za-z0-9.\\-_]+)",i=RegExp("^gs://"+r+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}let o=t.replace(/[.]/g,"\\."),a=RegExp(`^https?://${o}/v[A-Za-z0-9_]+/b/${r}/o(/([^?#]*).*)?$`,"i"),l=t===u9?"(?:storage.googleapis.com|storage.cloud.google.com)":t,h=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:a,indices:{bucket:1,path:3},postModify:s},{regex:RegExp(`^https?://${l}/${r}/([^?#]*)`,"i"),indices:{bucket:1,path:2},postModify:s}];for(let t=0;t<h.length;t++){let r=h[t],i=r.regex.exec(e);if(i){let e=i[r.indices.bucket],t=i[r.indices.path];t||(t=""),n=new ci(e,t),r.postModify(n);break}}if(null==n)throw new ce(M.INVALID_URL,"Invalid URL '"+e+"'.");return n}}class cs{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(e=!1){}}function co(e,t,n,r){if(r<t)throw cn(`Invalid value for '${e}'. Expected ${t} or greater.`);if(r>n)throw cn(`Invalid value for '${e}'. Expected ${n} or less.`)}(v=F||(F={}))[v.NO_ERROR=0]="NO_ERROR",v[v.NETWORK_ERROR=1]="NETWORK_ERROR",v[v.ABORT=2]="ABORT";class ca{constructor(e,t,n,r,i,s,o,a,l,h,u,c=!0,d=!1){this.url_=e,this.method_=t,this.headers_=n,this.body_=r,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=o,this.errorCallback_=a,this.timeout_=l,this.progressCallback_=h,this.connectionFactory_=u,this.retry=c,this.isUsingEmulator=d,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){let e=(e,t)=>{if(t)return void e(!1,new cl(!1,null,!0));let n=this.connectionFactory_();this.pendingConnection_=n;let r=e=>{let t=e.loaded,n=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,n)};null!==this.progressCallback_&&n.addUploadProgressListener(r),n.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{var t;let i,s,o;null!==this.progressCallback_&&n.removeUploadProgressListener(r),this.pendingConnection_=null;let a=n.getErrorCode()===F.NO_ERROR,l=n.getStatus();!a||(t=this.additionalRetryCodes_,i=l>=500&&l<600,s=-1!==[408,429].indexOf(l),o=-1!==t.indexOf(l),(i||s||o)&&this.retry)?e(!1,new cl(!1,null,n.getErrorCode()===F.ABORT)):e(!0,new cl(-1!==this.successCodes_.indexOf(l),n))})},t=(e,t)=>{let n=this.resolve_,r=this.reject_,i=t.connection;if(t.wasSuccessCode)try{let e=this.callback_(i,i.getResponse());void 0!==e?n(e):n()}catch(e){r(e)}else if(null!==i){let e=new ce(M.UNKNOWN,"An unknown error occurred, please check the error payload for server response.");e.serverResponse=i.getErrorText(),r(this.errorCallback_?this.errorCallback_(i,e):e)}else r(t.canceled?this.appDelete_?cr():new ce(M.CANCELED,"User canceled the upload/download."):new ce(M.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again."))};this.canceled_?t(!1,new cl(!1,null,!0)):this.backoffId_=function(e,t,n){let r=1,i=null,s=null,o=!1,a=0,l=!1;function h(...e){l||(l=!0,t.apply(null,e))}function u(t){i=setTimeout(()=>{i=null,e(d,2===a)},t)}function c(){s&&clearTimeout(s)}function d(e,...t){let n;if(l)return void c();if(e||2===a||o){c(),h.call(null,e,...t);return}r<64&&(r*=2),1===a?(a=2,n=0):n=(r+Math.random())*1e3,u(n)}let f=!1;function p(e){f||(f=!0,c(),!l&&(null!==i?(e||(a=2),clearTimeout(i),u(0)):e||(a=1)))}return u(0),s=setTimeout(()=>{o=!0,p(!0)},n),p}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class cl{constructor(e,t,n){this.wasSuccessCode=e,this.connection=t,this.canceled=!!n}}class ch{constructor(e,t){this._service=e,t instanceof ci?this._location=t:this._location=ci.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new ch(e,t)}get root(){let e=new ci(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){var e;let t;return -1===(t=(e=this._location.path).lastIndexOf("/",e.length-2))?e:e.slice(t+1)}get storage(){return this._service}get parent(){let e=function(e){if(0===e.length)return null;let t=e.lastIndexOf("/");return -1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;let t=new ci(this._location.bucket,e);return new ch(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw new ce(M.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}}function cu(e,t){let n=t?.storageBucket;return null==n?null:ci.makeFromBucketSpec(n,e)}class cc{constructor(e,t,n,r,i,s=!1){this.app=e,this._authProvider=t,this._appCheckProvider=n,this._url=r,this._firebaseVersion=i,this._isUsingEmulator=s,this._bucket=null,this._host=u9,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,null!=r?this._bucket=ci.makeFromBucketSpec(r,this._host):this._bucket=cu(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=ci.makeFromBucketSpec(this._url,e):this._bucket=cu(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){co("time",0,1/0,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){co("time",0,1/0,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;let e=this._authProvider.getImmediate({optional:!0});if(e){let t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){if(th(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let e=this._appCheckProvider.getImmediate({optional:!0});return e?(await e.getToken()).token:null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new ch(this,e)}_makeRequest(e,t,n,r,i=!0){if(this._deleted)return new cs(cr());{let s=function(e,t,n,r,i,s,o=!0,a=!1){let l=function(e){let t=encodeURIComponent,n="?";for(let r in e)e.hasOwnProperty(r)&&(n=n+(t(r)+"=")+t(e[r])+"&");return n.slice(0,-1)}(e.urlParams),h=e.url+l,u=Object.assign({},e.headers);return t&&(u["X-Firebase-GMPID"]=t),null!==n&&n.length>0&&(u.Authorization="Firebase "+n),u["X-Firebase-Storage-Version"]="webjs/"+(s??"AppManager"),null!==r&&(u["X-Firebase-AppCheck"]=r),new ca(h,e.method,u,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,i,o,a)}(e,this._appId,n,r,t,this._firebaseVersion,i,this._isUsingEmulator);return this._requests.add(s),s.getPromise().then(()=>this._requests.delete(s),()=>this._requests.delete(s)),s}}async makeRequestWithTokens(e,t){let[n,r]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,n,r).getPromise()}}let cd="@firebase/storage",cf="0.14.0",cp="storage";ti(new eL(cp,function(e,{instanceIdentifier:t}){return new cc(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t,tm)},"PUBLIC").setMultipleInstances(!0)),tb(cd,cf,""),tb(cd,cf,"esm2020"),e.s([],61086);let cm="@firebase/database",cg="1.1.0",cy="";class c_{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),eg(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:em(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class cv{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return ew(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}let cw=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){let t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new c_(t)}}catch(e){}return new cv},cb=cw("localStorage"),cE=cw("sessionStorage"),cT=new e$("@firebase/database"),cC=(p=1,function(){return p++}),cI=function(e){let t=eP(e),n=new eN;n.update(t);let r=n.digest();return $.encodeByteArray(r)},cS=function(...e){let t="";for(let n=0;n<e.length;n++){let r=e[n];Array.isArray(r)||r&&"object"==typeof r&&"number"==typeof r.length?t+=cS.apply(null,r):"object"==typeof r?t+=eg(r):t+=r,t+=" "}return t},ck=null,cR=!0,cN=function(e,t){j(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(cT.logLevel=b.VERBOSE,ck=cT.log.bind(cT),t&&cE.set("logging_enabled",!0)):"function"==typeof e?ck=e:(ck=null,cE.remove("logging_enabled"))},cA=function(...e){if(!0===cR&&(cR=!1,null===ck&&!0===cE.get("logging_enabled")&&cN(!0)),ck){let t=cS.apply(null,e);ck(t)}},cx=function(e){return function(...t){cA(e,...t)}},cP=function(...e){let t="FIREBASE INTERNAL ERROR: "+cS(...e);cT.error(t)},cD=function(...e){let t=`FIREBASE FATAL ERROR: ${cS(...e)}`;throw cT.error(t),Error(t)},cO=function(...e){let t="FIREBASE WARNING: "+cS(...e);cT.warn(t)},cL=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&cO("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},cM=function(e){return"number"==typeof e&&(e!=e||e===1/0||e===-1/0)},cF=function(e){if(ec()||"complete"===document.readyState)e();else{let t=!1,n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}},cU="[MIN_NAME]",cV="[MAX_NAME]",cj=function(e,t){if(e===t)return 0;{if(e===cU||t===cV)return -1;if(t===cU||e===cV)return 1;let n=cG(e),r=cG(t);if(null!==n)if(null!==r)return n-r==0?e.length-t.length:n-r;else return -1;return null!==r?1:e<t?-1:1}},cq=function(e,t){return e===t?0:e<t?-1:1},cz=function(e,t){if(t&&e in t)return t[e];throw Error("Missing required key ("+e+") in object: "+eg(t))},cB=function(e){if("object"!=typeof e||null===e)return eg(e);let t=[];for(let n in e)t.push(n);t.sort();let n="{";for(let r=0;r<t.length;r++)0!==r&&(n+=","),n+=eg(t[r]),n+=":",n+=cB(e[t[r]]);return n+"}"},c$=function(e,t){let n=e.length;if(n<=t)return[e];let r=[];for(let i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r};function cW(e,t){for(let n in e)e.hasOwnProperty(n)&&t(n,e[n])}let cH=function(e){let t,n,r,i,s;j(!cM(e),"Invalid JSON number");0===e?(n=0,r=0,t=+(1/e==-1/0)):(t=e<0,(e=Math.abs(e))>=22250738585072014e-324?(n=(i=Math.min(Math.floor(Math.log(e)/Math.LN2),1023))+1023,r=Math.round(e*Math.pow(2,52-i)-0x10000000000000)):(n=0,r=Math.round(e/5e-324)));let o=[];for(s=52;s;s-=1)o.push(r%2?1:0),r=Math.floor(r/2);for(s=11;s;s-=1)o.push(n%2?1:0),n=Math.floor(n/2);o.push(+!!t),o.reverse();let a=o.join(""),l="";for(s=0;s<64;s+=8){let e=parseInt(a.substr(s,8),2).toString(16);1===e.length&&(e="0"+e),l+=e}return l.toLowerCase()},cK=RegExp("^-?(0*)\\d{1,10}$"),cG=function(e){if(cK.test(e)){let t=Number(e);if(t>=-0x80000000&&t<=0x7fffffff)return t}return null},cQ=function(e){try{e()}catch(e){setTimeout(()=>{throw cO("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},cY=function(e,t){let n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};class cX{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,th(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(e=>this.appCheck=e)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,n)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.appCheckProvider?.get().then(t=>t.addTokenListener(e))}notifyForInvalidToken(){cO(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class cJ{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(e=>this.auth_=e)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(e=>e&&"auth/token-not-initialized"===e.code?(cA("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((t,n)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,n):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',cO(e)}}class cZ{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}cZ.OWNER="owner";let c0=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,c1="websocket",c2="long_polling";class c3{constructor(e,t,n,r,i=!1,s="",o=!1,a=!1,l=null){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this.emulatorOptions=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=cb.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&cb.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function c6(e,t,n){let r;if(j("string"==typeof t,"typeof type must == string"),j("object"==typeof n,"typeof params must == object"),t===c1)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else if(t===c2)r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?";else throw Error("Unknown connection type: "+t);(e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams)&&(n.ns=e.namespace);let i=[];return cW(n,(e,t)=>{i.push(e+"="+t)}),r+i.join("&")}class c4{constructor(){this.counters_={}}incrementCounter(e,t=1){ew(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return function e(t,n){if(!(n instanceof Object))return n;switch(n.constructor){case Date:return new Date(n.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return n}for(let r in n)n.hasOwnProperty(r)&&"__proto__"!==r&&(t[r]=e(t[r],n[r]));return t}(void 0,this.counters_)}}let c5={},c8={};function c7(e){let t=e.toString();return c5[t]||(c5[t]=new c4),c5[t]}class c9{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&cQ(()=>{this.onMessage_(e[t])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}let de="start";class dt{constructor(e,t,n,r,i,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=cx(e),this.stats_=c7(t),this.urlFn=e=>(this.appCheckToken&&(e.ac=this.appCheckToken),c6(t,c2,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new c9(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),cF(()=>{if(this.isClosed_)return;this.scriptTagHolder=new dn((...e)=>{let[t,n,r,i,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===de)this.id=n,this.password=r;else if("close"===t)n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,()=>{this.onClosed_()})):this.onClosed_();else throw Error("Unrecognized command received: "+t)},(...e)=>{let[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)},()=>{this.onClosed_()},this.urlFn);let e={};e[de]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e.ac=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&c0.test(location.hostname)&&(e.r="f");let t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){dt.forceAllow_=!0}static forceDisallow(){dt.forceDisallow_=!0}static isAvailable(){return!ec()&&(!!dt.forceAllow_||!dt.forceDisallow_&&"undefined"!=typeof document&&null!=document.createElement&&!("object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&("object"!=typeof Windows||"object"!=typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){!this.isClosed_&&(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=eg(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=c$(H(t),1840);for(let e=0;e<n.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,n.length,n[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(ec())return;this.myDisconnFrame=document.createElement("iframe");let n={};n.dframe="t",n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=eg(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class dn{constructor(e,t,n,r){if(this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,ec())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=cC(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=dn.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(n='<script>document.domain="'+document.domain+'";</script>');const r="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(r),this.myIFrame.doc.close()}catch(e){cA("frame writing exception"),e.stack&&cA(e.stack),cA(e)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||cA("No IE domain setting required")}catch(t){e.src="javascript:void((function(){document.open();document.domain='"+document.domain+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(!this.alive||!this.sendNewPolls||!(this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)))return!1;{this.currentSerial++;let e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",r=0;for(;this.pendingSegs.length>0;)if(this.pendingSegs[0].d.length+30+n.length<=1870){let e=this.pendingSegs.shift();n=n+"&seg"+r+"="+e.seg+"&ts"+r+"="+e.ts+"&d"+r+"="+e.d,r++}else break;return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(r),n()})}addTag(e,t){ec()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){let e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{cA("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}},Math.floor(1))}}let dr=null;"undefined"!=typeof MozWebSocket?dr=MozWebSocket:"undefined"!=typeof WebSocket&&(dr=WebSocket);class di{constructor(e,t,n,r,i,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=cx(this.connId),this.stats_=c7(t),this.connURL=di.connectionURL_(t,s,o,r,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r,i){let s={};return s.v="5",!ec()&&"undefined"!=typeof location&&location.hostname&&c0.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),r&&(s.ac=r),i&&(s.p=i),c6(e,c1,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,cb.set("previous_websocket_failure",!0);try{let e;if(ec()){let t=this.nodeAdmin?"AdminNode":"Node";e={headers:{"User-Agent":`Firebase/5/${cy}/${V.default.platform}/${t}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(e.headers["X-Firebase-AppCheck"]=this.appCheckToken);let n=V.default.env,r=0===this.connURL.indexOf("wss://")?n.HTTPS_PROXY||n.https_proxy:n.HTTP_PROXY||n.http_proxy;r&&(e.proxy={origin:r})}this.mySock=new dr(this.connURL,[],e)}catch(t){this.log_("Error instantiating WebSocket.");let e=t.message||t.data;e&&this.log_(e),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");let t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){di.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){let t=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);t&&t.length>1&&4.4>parseFloat(t[1])&&(e=!0)}return!e&&null!==dr&&!di.forceDisallow_}static previouslyFailed(){return cb.isInMemoryStorage||!0===cb.get("previous_websocket_failure")}markConnectionHealthy(){cb.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){let e=this.frames.join("");this.frames=null;let t=em(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(j(null===this.frames,"We already have a frame buffer"),e.length<=6){let t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;let t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{let e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();let t=eg(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let n=c$(t,16384);n.length>1&&this.sendString_(String(n.length));for(let e=0;e<n.length;e++)this.sendString_(n[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){!this.isClosed_&&(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}di.responsesRequiredToBeHealthy=2,di.healthyTimeout=3e4;class ds{static get ALL_TRANSPORTS(){return[dt,di]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){let t=di&&di.isAvailable(),n=t&&!di.previouslyFailed();if(e.webSocketOnly&&(t||cO("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[di];else{let e=this.transports_=[];for(let t of ds.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);ds.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}ds.globalTransportInitialized_=!1;class da{constructor(e,t,n,r,i,s,o,a,l,h){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=l,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=cx("c:"+this.id+":"),this.transportManager_=new ds(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,n)},Math.floor(0));let r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=cY(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){let t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=cz("t",e),n=cz("d",e);if("c"===t)this.onSecondaryControl_(n);else if("d"===t)this.pendingDataMessages.push(n);else throw Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=cz("t",e),n=cz("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){!this.isHealthy_&&(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=cz("t",e);if("d"in e){let n=e.d;if("h"===t){let e={...n};this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?cP("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):cP("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&cO("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),cY(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):cY(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(cb.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class dl{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class dh{constructor(e){this.allowedEvents_=e,this.listeners_={},j(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});let r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);let r=this.listeners_[e]||[];for(let e=0;e<r.length;e++)if(r[e].callback===t&&(!n||n===r[e].context))return void r.splice(e,1)}validateEventType_(e){j(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class du extends dh{static getInstance(){return new du}constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||el()||(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return j("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class dc{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function dd(){return new dc("")}function df(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function dp(e){return e.pieces_.length-e.pieceNum_}function dm(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new dc(e.pieces_,t)}function dg(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function dy(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function d_(e){if(e.pieceNum_>=e.pieces_.length)return null;let t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new dc(t,0)}function dv(e,t){let n=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);if(t instanceof dc)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{let e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new dc(n,0)}function dw(e){return e.pieceNum_>=e.pieces_.length}function db(e,t){let n=df(e),r=df(t);if(null===n)return t;if(n===r)return db(dm(e),dm(t));throw Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function dE(e,t){if(dp(e)!==dp(t))return!1;for(let n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function dT(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(dp(e)>dp(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class dC{constructor(e,t){this.errorPrefix_=t,this.parts_=dy(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=eD(this.parts_[e]);dI(this)}}function dI(e){if(e.byteLength_>768)throw Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+dS(e))}function dS(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class dk extends dh{static getInstance(){return new dk}constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))},!1)}getInitialEvent(e){return j("visible"===e,"Unknown event type: "+e),[this.visible_]}}class dR extends dl{constructor(e,t,n,r,i,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=dR.nextPersistentConnectionId_++,this.log_=cx("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=1e3,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!ec())throw Error("Auth override specified in options, but not supported on non Node.js platforms");dk.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&du.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){let r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_(eg(i)),j(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();let t=new ee,n={p:e._path.toString(),q:e._queryObject};this.outstandingGets_.push({action:"g",request:n,onComplete:e=>{let n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}}),this.outstandingGetCount_++;let r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}listen(e,t,n,r){this.initConnection_();let i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),j(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),j(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");let o={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(s).set(i,o),this.connected_&&this.sendListen_(o)}sendGet_(e){let t=this.outstandingGets_[e];this.sendRequest("g",t.request,n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)})}sendListen_(e){let t=e.query,n=t._path.toString(),r=t._queryIdentifier;this.log_("Listen on "+n+" for "+r);let i={p:n};e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest("q",i,i=>{let s=i.d,o=i.s;dR.warnOnListenWarnings_(s,t),(this.listens.get(n)&&this.listens.get(n).get(r))===e&&(this.log_("listen response",i),"ok"!==o&&this.removeListen_(n,r),e.onComplete&&e.onComplete(o,s))})}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&ew(e,"w")){let n=eb(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){let e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();cO(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||ev(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let e=this.authToken_,t=e_(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,t=>{let n=t.s,r=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,r))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{let t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)})}unlisten(e,t){let n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),j(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);let i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){let i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,e=>{r&&setTimeout(()=>{r(e.s,e.d)},Math.floor(0))})}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();let s={p:t,d:n};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:r}),this.outstandingPutCount_++;let o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){let t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(n.s,n.d)})}reportStats(e){if(this.connected_){let t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,e=>{if("ok"!==e.s){let t=e.d;this.log_("reportStats","Error sending stats: "+t)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+eg(e));let t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else if("error"in e)throw"A server-side error has occurred: "+e.error;else"a"in e&&this.onDataPush_(e.a,e.b)}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):cP("Unrecognized action received from server: "+eg(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){j(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=1e3),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+dR.nextConnectionId_++,i=this.lastSessionId,s=!1,o=null,a=function(){o?o.close():(s=!0,n())};this.realtime_={close:a,sendRequest:function(e){j(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(e)}};let l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[a,h]=await Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)]);s?cA("getToken() completed but was canceled"):(cA("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=h&&h.token,o=new da(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,e=>{cO(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")},i))}catch(e){this.log_("Failed to get token: "+e),s||(this.repoInfo_.nodeAdmin&&cO(e),a())}}}interrupt(e){cA("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){cA("Resuming connection for reason: "+e),delete this.interruptReasons_[e],eE(this.interruptReasons_)&&(this.reconnectDelay_=1e3,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){let t=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){let t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map(e=>cB(e)).join("$"):"default";let r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){let n,r=new dc(e).toString();if(this.listens.has(r)){let e=this.listens.get(r);n=e.get(t),e.delete(t),0===e.size&&this.listens.delete(r)}else n=void 0;return n}onAuthRevoked_(e,t){cA("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===e||"permission_denied"===e)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){cA("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===e||"permission_denied"===e)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){for(let e of(this.tryAuth(),this.tryAppCheck(),this.listens.values()))for(let t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){let e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){let e={},t="js";ec()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+cy.replace(/\./g,"-")]=1,el()?e["framework.cordova"]=1:eu()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){let e=du.getInstance().currentlyOnline();return eE(this.interruptReasons_)&&e}}dR.nextPersistentConnectionId_=0,dR.nextConnectionId_=0;class dN{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new dN(e,t)}}class dA{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let n=new dN(cU,e),r=new dN(cU,t);return 0!==this.compare(n,r)}minPost(){return dN.MIN}}class dx extends dA{static get __EMPTY_NODE(){return r}static set __EMPTY_NODE(e){r=e}compare(e,t){return cj(e.name,t.name)}isDefinedOn(e){throw q("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return dN.MIN}maxPost(){return new dN(cV,r)}makePost(e,t){return j("string"==typeof e,"KeyIndex indexValue must always be a string."),new dN(e,r)}toString(){return".key"}}let dP=new dx;class dD{constructor(e,t,n,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else if(0===s){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}getNext(){let e;if(0===this.nodeStack_.length)return null;let t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class dO{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:dO.RED,this.left=null!=r?r:dL.EMPTY_NODE,this.right=null!=i?i:dL.EMPTY_NODE}copy(e,t,n,r,i){return new dO(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp_()}removeMin_(){if(this.left.isEmpty())return dL.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()}remove(e,t){let n,r;if(n=this,0>t(e,n.key))n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key))if(n.right.isEmpty())return dL.EMPTY_NODE;else r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_());n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e}rotateLeft_(){let e=this.copy(null,null,dO.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){let e=this.copy(null,null,dO.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){let e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){return Math.pow(2,this.check_())<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw Error("Right child of ("+this.key+","+this.value+") is red");let e=this.left.check_();if(e===this.right.check_())return e+ +!this.isRed_();throw Error("Black depths differ")}}dO.RED=!0,dO.BLACK=!1;class dL{constructor(e,t=dL.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new dL(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,dO.BLACK,null,null))}remove(e){return new dL(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,dO.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))if(n.left.isEmpty())if(r)return r.key;else return null;else{for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new dD(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new dD(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new dD(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new dD(this.root_,null,this.comparator_,!0,e)}}function dM(e,t){return cj(e.name,t.name)}function dF(e,t){return cj(e,t)}dL.EMPTY_NODE=new class{copy(e,t,n,r,i){return this}insert(e,t,n){return new dO(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};let dU=function(e){return"number"==typeof e?"number:"+cH(e):"string:"+e},dV=function(e){if(e.isLeafNode()){let t=e.val();j("string"==typeof t||"number"==typeof t||"object"==typeof t&&ew(t,".sv"),"Priority must be a string or number.")}else j(e===i||e.isEmpty(),"priority of unexpected type.");j(e===i||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};class dj{static set __childrenNodeConstructor(e){s=e}static get __childrenNodeConstructor(){return s}constructor(e,t=dj.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,j(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),dV(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new dj(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:dj.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return dw(e)?this:".priority"===df(e)?this.priorityNode_:dj.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:dj.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){let n=df(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(j(".priority"!==n||1===dp(e),".priority must be the last token in a path"),this.updateImmediateChild(n,dj.__childrenNodeConstructor.EMPTY_NODE.updateChild(dm(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+dU(this.priorityNode_.val())+":");let t=typeof this.value_;e+=t+":","number"===t?e+=cH(this.value_):e+=this.value_,this.lazyHash_=cI(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===dj.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof dj.__childrenNodeConstructor?-1:(j(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){let t=typeof e.value_,n=typeof this.value_,r=dj.VALUE_TYPE_ORDER.indexOf(t),i=dj.VALUE_TYPE_ORDER.indexOf(n);return(j(r>=0,"Unknown leaf type: "+t),j(i>=0,"Unknown leaf type: "+n),r!==i)?i-r:"object"===n?0:this.value_<e.value_?-1:1*(this.value_!==e.value_)}withIndex(){return this}isIndexed(){return!0}equals(e){return e===this||!!e.isLeafNode()&&this.value_===e.value_&&this.priorityNode_.equals(e.priorityNode_)}}dj.VALUE_TYPE_ORDER=["object","boolean","number","string"];let dq=new class extends dA{compare(e,t){let n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?cj(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return dN.MIN}maxPost(){return new dN(cV,new dj("[PRIORITY-POST]",a))}makePost(e,t){return new dN(t,new dj("[PRIORITY-POST]",o(e)))}toString(){return".priority"}},dz=Math.log(2);class dB{constructor(e){this.count=parseInt(Math.log(e+1)/dz,10),this.current_=this.count-1;const t=parseInt(Array(this.count+1).join("1"),2);this.bits_=e+1&t}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}}let d$=function(e,t,n,r){e.sort(t);let i=function(t,r){let s,o=r-t;if(0===o)return null;if(1===o)return s=e[t],new dO(n?n(s):s,s.node,dO.BLACK,null,null);{let a=parseInt(o/2,10)+t,l=i(t,a),h=i(a+1,r);return s=e[a],new dO(n?n(s):s,s.node,dO.BLACK,l,h)}};return new dL(r||t,function(t){let r=null,s=null,o=e.length,a=function(t,r){let s=o-t,a=o;o-=t;let h=i(s+1,a),u=e[s];l(new dO(n?n(u):u,u.node,r,null,h))},l=function(e){r?r.left=e:s=e,r=e};for(let e=0;e<t.count;++e){let n=t.nextBitIsOne(),r=Math.pow(2,t.count-(e+1));n?a(r,dO.BLACK):(a(r,dO.BLACK),a(r,dO.RED))}return s}(new dB(e.length)))},dW={};class dH{static get Default(){return j(dW&&dq,"ChildrenNode.ts has not been loaded"),l=l||new dH({".priority":dW},{".priority":dq})}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){let t=eb(this.indexes_,e);if(!t)throw Error("No index defined for "+e);return t instanceof dL?t:null}hasIndex(e){return ew(this.indexSet_,e.toString())}addIndex(e,t){let n;j(e!==dP,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let r=[],i=!1,s=t.getIterator(dN.Wrap),o=s.getNext();for(;o;)i=i||e.isDefinedOn(o.node),r.push(o),o=s.getNext();n=i?d$(r,e.getCompare()):dW;let a=e.toString(),l={...this.indexSet_};l[a]=e;let h={...this.indexes_};return h[a]=n,new dH(h,l)}addToIndexes(e,t){return new dH(eT(this.indexes_,(n,r)=>{let i=eb(this.indexSet_,r);if(j(i,"Missing index implementation for "+r),n===dW)if(!i.isDefinedOn(e.node))return dW;else{let n=[],r=t.getIterator(dN.Wrap),s=r.getNext();for(;s;)s.name!==e.name&&n.push(s),s=r.getNext();return n.push(e),d$(n,i.getCompare())}{let r=t.get(e.name),i=n;return r&&(i=i.remove(new dN(e.name,r))),i.insert(e,e.node)}}),this.indexSet_)}removeFromIndexes(e,t){return new dH(eT(this.indexes_,n=>{if(n===dW)return n;{let r=t.get(e.name);return r?n.remove(new dN(e.name,r)):n}}),this.indexSet_)}}class dK{static get EMPTY_NODE(){return h||(h=new dK(new dL(dF),null,dH.Default))}constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&dV(this.priorityNode_),this.children_.isEmpty()&&j(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||h}updatePriority(e){return this.children_.isEmpty()?this:new dK(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{let t=this.children_.get(e);return null===t?h:t}}getChild(e){let t=df(e);return null===t?this:this.getImmediateChild(t).getChild(dm(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(j(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{let n,r,i=new dN(e,t);t.isEmpty()?(n=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(i,this.children_)):(n=this.children_.insert(e,t),r=this.indexMap_.addToIndexes(i,this.children_));let s=n.isEmpty()?h:this.priorityNode_;return new dK(n,s,r)}}updateChild(e,t){let n=df(e);if(null===n)return t;{j(".priority"!==df(e)||1===dp(e),".priority must be the last token in a path");let r=this.getImmediateChild(n).updateChild(dm(e),t);return this.updateImmediateChild(n,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;let t={},n=0,r=0,i=!0;if(this.forEachChild(dq,(s,o)=>{t[s]=o.val(e),n++,i&&dK.INTEGER_REGEXP_.test(s)?r=Math.max(r,Number(s)):i=!1}),e||!i||!(r<2*n))return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t;{let e=[];for(let n in t)e[n]=t[n];return e}}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+dU(this.getPriority().val())+":"),this.forEachChild(dq,(t,n)=>{let r=n.hash();""!==r&&(e+=":"+t+":"+r)}),this.lazyHash_=""===e?"":cI(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){let r=this.resolveIndex_(n);if(!r)return this.children_.getPredecessorKey(e);{let n=r.getPredecessorKey(new dN(e,t));return n?n.name:null}}getFirstChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.minKey();{let e=t.minKey();return e&&e.name}}getFirstChild(e){let t=this.getFirstChildName(e);return t?new dN(t,this.children_.get(t)):null}getLastChildName(e){let t=this.resolveIndex_(e);if(!t)return this.children_.maxKey();{let e=t.maxKey();return e&&e.name}}getLastChild(e){let t=this.getLastChildName(e);return t?new dN(t,this.children_.get(t)):null}forEachChild(e,t){let n=this.resolveIndex_(e);return n?n.inorderTraversal(e=>t(e.name,e.node)):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,e=>e);{let n=this.children_.getIteratorFrom(e.name,dN.Wrap),r=n.peek();for(;null!=r&&0>t.compare(r,e);)n.getNext(),r=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){let n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,e=>e);{let n=this.children_.getReverseIteratorFrom(e.name,dN.Wrap),r=n.peek();for(;null!=r&&t.compare(r,e)>0;)n.getNext(),r=n.peek();return n}}compareTo(e){if(this.isEmpty())if(e.isEmpty())return 0;else return -1;return e.isLeafNode()||e.isEmpty()?1:e===dG?-1:0}withIndex(e){if(e===dP||this.indexMap_.hasIndex(e))return this;{let t=this.indexMap_.addIndex(e,this.children_);return new dK(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===dP||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode()||!this.getPriority().equals(e.getPriority()))return!1;if(this.children_.count()!==e.children_.count())return!1;{let t=this.getIterator(dq),n=e.getIterator(dq),r=t.getNext(),i=n.getNext();for(;r&&i;){if(r.name!==i.name||!r.node.equals(i.node))return!1;r=t.getNext(),i=n.getNext()}return null===r&&null===i}}resolveIndex_(e){return e===dP?null:this.indexMap_.get(e.toString())}}dK.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;let dG=new class extends dK{constructor(){super(new dL(dF),dK.EMPTY_NODE,dH.Default)}compareTo(e){return+(e!==this)}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return dK.EMPTY_NODE}isEmpty(){return!1}};function dQ(e,t=null){if(null===e)return dK.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),j(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new dj(e,dQ(t));if(e instanceof Array){let n=dK.EMPTY_NODE;return cW(e,(t,r)=>{if(ew(e,t)&&"."!==t.substring(0,1)){let e=dQ(r);(e.isLeafNode()||!e.isEmpty())&&(n=n.updateImmediateChild(t,e))}}),n.updatePriority(dQ(t))}{let n=[],r=!1;if(cW(e,(e,t)=>{if("."!==e.substring(0,1)){let i=dQ(t);i.isEmpty()||(r=r||!i.getPriority().isEmpty(),n.push(new dN(e,i)))}}),0===n.length)return dK.EMPTY_NODE;let i=d$(n,dM,e=>e.name,dF);if(!r)return new dK(i,dQ(t),dH.Default);{let e=d$(n,dq.getCompare());return new dK(i,dQ(t),new dH({".priority":e},{".priority":dq}))}}}Object.defineProperties(dN,{MIN:{value:new dN(cU,dK.EMPTY_NODE)},MAX:{value:new dN(cV,dG)}}),dx.__EMPTY_NODE=dK.EMPTY_NODE,dj.__childrenNodeConstructor=dK,i=dG,a=dG,o=dQ;class dY extends dA{constructor(e){super(),this.indexPath_=e,j(!dw(e)&&".priority"!==df(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?cj(e.name,t.name):i}makePost(e,t){let n=dQ(e);return new dN(t,dK.EMPTY_NODE.updateChild(this.indexPath_,n))}maxPost(){return new dN(cV,dK.EMPTY_NODE.updateChild(this.indexPath_,dG))}toString(){return dy(this.indexPath_,0).join("/")}}let dX=new class extends dA{compare(e,t){let n=e.node.compareTo(t.node);return 0===n?cj(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return dN.MIN}maxPost(){return dN.MAX}makePost(e,t){return new dN(t,dQ(e))}toString(){return".value"}};function dJ(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class dZ{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=dq}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return j(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return(j(this.startSet_,"Only valid if start has been set"),this.startNameSet_)?this.indexStartName_:cU}hasEnd(){return this.endSet_}getIndexEndValue(){return j(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return(j(this.endSet_,"Only valid if end has been set"),this.endNameSet_)?this.indexEndName_:cV}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return j(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===dq}copy(){let e=new dZ;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function d0(e){let t,n={};if(e.isDefault())return n;if(e.index_===dq?t="$priority":e.index_===dX?t="$value":e.index_===dP?t="$key":(j(e.index_ instanceof dY,"Unrecognized index type!"),t=e.index_.toString()),n.orderBy=eg(t),e.startSet_){let t=e.startAfterSet_?"startAfter":"startAt";n[t]=eg(e.indexStartValue_),e.startNameSet_&&(n[t]+=","+eg(e.indexStartName_))}if(e.endSet_){let t=e.endBeforeSet_?"endBefore":"endAt";n[t]=eg(e.indexEndValue_),e.endNameSet_&&(n[t]+=","+eg(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_),n}function d1(e){let t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==dq&&(t.i=e.index_.toString()),t}class d2 extends dl{reportStats(e){throw Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(j(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=cx("p:rest:"),this.listens_={}}listen(e,t,n,r){let i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);let s=d2.getListenId_(e,n),o={};this.listens_[s]=o;let a=d0(e._queryParams);this.restRequest_(i+".json",a,(e,t)=>{let a=t;(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(i,a,!1,n),eb(this.listens_,s)===o)&&r(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)})}unlisten(e,t){let n=d2.getListenId_(e,t);delete this.listens_[n]}get(e){let t=d0(e._queryParams),n=e._path.toString(),r=new ee;return this.restRequest_(n+".json",t,(e,t)=>{let i=t;404===e&&(i=null,e=null),null===e?(this.onDataUpdate_(n,i,!1,null),r.resolve(i)):r.reject(Error(i))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,i])=>{r&&r.accessToken&&(t.auth=r.accessToken),i&&i.token&&(t.ac=i.token);let s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+eS(t);this.log_("Sending REST request for "+s);let o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=em(o.responseText)}catch(e){cO("Failed to parse JSON response for "+s+": "+o.responseText)}n(null,e)}else 401!==o.status&&404!==o.status&&cO("Got unsuccessful REST response for "+s+" Status: "+o.status),n(o.status);n=null}},o.open("GET",s,!0),o.send()})}}class d3{constructor(){this.rootNode_=dK.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function d6(){return{value:null,children:new Map}}function d4(e,t,n){var r,i;null!==e.value?n(t,e.value):(r=e,i=(e,r)=>{d4(r,new dc(t.toString()+"/"+e),n)},r.children.forEach((e,t)=>{i(t,e)}))}class d5{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t={...e};return this.last_&&cW(this.last_,(e,n)=>{t[e]=t[e]-n}),this.last_=e,t}}class d8{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new d5(e);const n=1e4+2e4*Math.random();cY(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){let e=this.statsListener_.get(),t={},n=!1;cW(e,(e,r)=>{r>0&&ew(this.statsToReport_,e)&&(t[e]=r,n=!0)}),n&&this.server_.reportStats(t),cY(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}function d7(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function d9(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function fe(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(w=U||(U={}))[w.OVERWRITE=0]="OVERWRITE",w[w.MERGE=1]="MERGE",w[w.ACK_USER_WRITE=2]="ACK_USER_WRITE",w[w.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class ft{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=U.ACK_USER_WRITE,this.source=d7()}operationForChild(e){if(!dw(this.path))return j(df(this.path)===e,"operationForChild called for unrelated child."),new ft(dm(this.path),this.affectedTree,this.revert);if(null!=this.affectedTree.value)return j(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new dc(e));return new ft(dd(),t,this.revert)}}}class fn{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=U.OVERWRITE}operationForChild(e){return dw(this.path)?new fn(this.source,dd(),this.snap.getImmediateChild(e)):new fn(this.source,dm(this.path),this.snap)}}class fr{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=U.MERGE}operationForChild(e){if(!dw(this.path))return j(df(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new fr(this.source,dm(this.path),this.children);{let t=this.children.subtree(new dc(e));return t.isEmpty()?null:t.value?new fn(this.source,dd(),t.value):new fr(this.source,dd(),t)}}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class fi{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(dw(e))return this.isFullyInitialized()&&!this.filtered_;let t=df(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}function fs(e,t,n,r,i,s){let o=r.filter(e=>e.type===n);o.sort((t,n)=>(function(e,t,n){if(null==t.childName||null==n.childName)throw q("Should only compare child_ events.");let r=new dN(t.childName,t.snapshotNode),i=new dN(n.childName,n.snapshotNode);return e.index_.compare(r,i)})(e,t,n)),o.forEach(n=>{var r,o,a;let l=(r=e,o=n,a=s,"value"===o.type||"child_removed"===o.type||(o.prevName=a.getPredecessorChildName(o.childName,o.snapshotNode,r.index_)),o);i.forEach(r=>{r.respondsTo(n.type)&&t.push(r.createEvent(l,e.query_))})})}function fo(e,t){return{eventCache:e,serverCache:t}}function fa(e,t,n,r){return fo(new fi(t,n,r),e.serverCache)}function fl(e,t,n,r){return fo(e.eventCache,new fi(t,n,r))}function fh(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function fu(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}class fc{static fromObject(e){let t=new fc(null);return cW(e,(e,n)=>{t=t.set(new dc(e),n)}),t}constructor(e,t=(!u&&(u=new dL(cq)),u)){this.value=e,this.children=t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:dd(),value:this.value};{if(dw(e))return null;let n=df(e),r=this.children.get(n);if(null===r)return null;{let i=r.findRootMostMatchingPathAndValue(dm(e),t);return null!=i?{path:dv(new dc(n),i.path),value:i.value}:null}}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(dw(e))return this;{let t=df(e),n=this.children.get(t);return null!==n?n.subtree(dm(e)):new fc(null)}}set(e,t){if(dw(e))return new fc(t,this.children);{let n=df(e),r=(this.children.get(n)||new fc(null)).set(dm(e),t),i=this.children.insert(n,r);return new fc(this.value,i)}}remove(e){if(dw(e))if(this.children.isEmpty())return new fc(null);else return new fc(null,this.children);{let t=df(e),n=this.children.get(t);if(!n)return this;{let r,i=n.remove(dm(e));return(r=i.isEmpty()?this.children.remove(t):this.children.insert(t,i),null===this.value&&r.isEmpty())?new fc(null):new fc(this.value,r)}}}get(e){if(dw(e))return this.value;{let t=df(e),n=this.children.get(t);return n?n.get(dm(e)):null}}setTree(e,t){if(dw(e))return t;{let n,r=df(e),i=(this.children.get(r)||new fc(null)).setTree(dm(e),t);return n=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new fc(this.value,n)}}fold(e){return this.fold_(dd(),e)}fold_(e,t){let n={};return this.children.inorderTraversal((r,i)=>{n[r]=i.fold_(dv(e,r),t)}),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,dd(),t)}findOnPath_(e,t,n){let r=!!this.value&&n(t,this.value);if(r)return r;{if(dw(e))return null;let r=df(e),i=this.children.get(r);return i?i.findOnPath_(dm(e),dv(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,dd(),t)}foreachOnPath_(e,t,n){if(dw(e))return this;{this.value&&n(t,this.value);let r=df(e),i=this.children.get(r);return i?i.foreachOnPath_(dm(e),dv(t,r),n):new fc(null)}}foreach(e){this.foreach_(dd(),e)}foreach_(e,t){this.children.inorderTraversal((n,r)=>{r.foreach_(dv(e,n),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,n)=>{n.value&&e(t,n.value)})}}class fd{constructor(e){this.writeTree_=e}static empty(){return new fd(new fc(null))}}function ff(e,t,n){if(dw(t))return new fd(new fc(n));{let r=e.writeTree_.findRootMostValueAndPath(t);if(null!=r){let i=r.path,s=r.value,o=db(i,t);return s=s.updateChild(o,n),new fd(e.writeTree_.set(i,s))}{let r=new fc(n);return new fd(e.writeTree_.setTree(t,r))}}}function fp(e,t,n){let r=e;return cW(n,(e,n)=>{r=ff(r,dv(t,e),n)}),r}function fm(e,t){return dw(t)?fd.empty():new fd(e.writeTree_.setTree(t,new fc(null)))}function fg(e,t){return null!=fy(e,t)}function fy(e,t){let n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(db(n.path,t)):null}function f_(e){let t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(dq,(e,n)=>{t.push(new dN(e,n))}):e.writeTree_.children.inorderTraversal((e,n)=>{null!=n.value&&t.push(new dN(e,n.value))}),t}function fv(e,t){if(dw(t))return e;{let n=fy(e,t);return new fd(null!=n?new fc(n):e.writeTree_.subtree(t))}}function fw(e){return e.writeTree_.isEmpty()}function fb(e,t){return function e(t,n,r){if(null!=n.value)return r.updateChild(t,n.value);{let i=null;return n.children.inorderTraversal((n,s)=>{".priority"===n?(j(null!==s.value,"Priority writes must always be leaf nodes"),i=s.value):r=e(dv(t,n),s,r)}),r.getChild(t).isEmpty()||null===i||(r=r.updateChild(dv(t,".priority"),i)),r}}(dd(),e.writeTree_,t)}function fE(e){return e.visible}function fT(e,t,n){let r=fd.empty();for(let i=0;i<e.length;++i){let s=e[i];if(t(s)){let e,t=s.path;if(s.snap)dT(n,t)?r=ff(r,e=db(n,t),s.snap):dT(t,n)&&(e=db(t,n),r=ff(r,dd(),s.snap.getChild(e)));else if(s.children){if(dT(n,t))r=fp(r,e=db(n,t),s.children);else if(dT(t,n))if(dw(e=db(t,n)))r=fp(r,dd(),s.children);else{let t=eb(s.children,df(e));if(t){let n=t.getChild(dm(e));r=ff(r,dd(),n)}}}else throw q("WriteRecord should have .snap or .children")}}return r}function fC(e,t,n,r,i){if(r||i){let s=fv(e.visibleWrites,t);return!i&&fw(s)?n:i||null!=n||fg(s,dd())?fb(fT(e.allWrites,function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(dT(e.path,t)||dT(t,e.path))},t),n||dK.EMPTY_NODE):null}{let r=fy(e.visibleWrites,t);if(null!=r)return r;{let r=fv(e.visibleWrites,t);return fw(r)?n:null!=n||fg(r,dd())?fb(r,n||dK.EMPTY_NODE):null}}}function fI(e,t,n,r){return fC(e.writeTree,e.treePath,t,n,r)}function fS(e,t){return function(e,t,n){let r=dK.EMPTY_NODE,i=fy(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(dq,(e,t)=>{r=r.updateImmediateChild(e,t)}),r;if(!n)return f_(fv(e.visibleWrites,t)).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r;{let i=fv(e.visibleWrites,t);return n.forEachChild(dq,(e,t)=>{let n=fb(fv(i,new dc(e)),t);r=r.updateImmediateChild(e,n)}),f_(i).forEach(e=>{r=r.updateImmediateChild(e.name,e.node)}),r}}(e.writeTree,e.treePath,t)}function fk(e,t,n,r){return function(e,t,n,r,i){j(r||i,"Either existingEventSnap or existingServerSnap must exist");let s=dv(t,n);if(fg(e.visibleWrites,s))return null;{let t=fv(e.visibleWrites,s);return fw(t)?i.getChild(n):fb(t,i.getChild(n))}}(e.writeTree,e.treePath,t,n,r)}function fR(e,t){var n,r;return n=e.writeTree,r=dv(e.treePath,t),fy(n.visibleWrites,r)}function fN(e,t,n){var r,i;let s,o;return r=e.writeTree,i=e.treePath,s=dv(i,t),null!=(o=fy(r.visibleWrites,s))?o:n.isCompleteForChild(t)?fb(fv(r.visibleWrites,s),n.getNode().getImmediateChild(t)):null}function fA(e,t){return fx(dv(e.treePath,t),e.writeTree)}function fx(e,t){return{treePath:e,writeTree:t}}class fP{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,n=e.childName;j("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),j(".priority"!==n,"Only non-priority child changes can be tracked.");let r=this.changeMap.get(n);if(r){let i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,dJ(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,{type:"child_removed",snapshotNode:r.oldSnap,childName:n});else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,{type:"child_added",snapshotNode:e.snapshotNode,childName:n});else if("child_changed"===t&&"child_changed"===i)this.changeMap.set(n,dJ(n,e.snapshotNode,r.oldSnap));else throw q("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}let fD=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class fO{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let t=null!=this.optCompleteServerCache_?new fi(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return fN(this.writes_,e,t)}}getChildAfterChild(e,t,n){var r;let i=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:fu(this.viewCache_),s=(r=this.writes_,function(e,t,n,r,i,s,o){let a,l=fv(e.visibleWrites,t),h=fy(l,dd());if(null!=h)a=h;else{if(null==n)return[];a=fb(l,n)}if((a=a.withIndex(o)).isEmpty()||a.isLeafNode())return[];{let e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o),i=n.getNext();for(;i&&e.length<1;)0!==t(i,r)&&e.push(i),i=n.getNext();return e}}(r.writeTree,r.treePath,i,t,1,n,e));return 0===s.length?null:s[0]}}function fL(e,t,n,r,i,s){let o=t.eventCache;if(null!=fR(r,n))return t;{let a,l;if(dw(n))if(j(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){let n=fu(t),i=fS(r,n instanceof dK?n:dK.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),i,s)}else{let n=fI(r,fu(t));a=e.filter.updateFullNode(t.eventCache.getNode(),n,s)}else{let h=df(n);if(".priority"===h){j(1===dp(n),"Can't have a priority with additional path components");let i=o.getNode(),s=fk(r,n,i,l=t.serverCache.getNode());a=null!=s?e.filter.updatePriority(i,s):o.getNode()}else{let u,c=dm(n);if(o.isCompleteForChild(h)){l=t.serverCache.getNode();let e=fk(r,n,o.getNode(),l);u=null!=e?o.getNode().getImmediateChild(h).updateChild(c,e):o.getNode().getImmediateChild(h)}else u=fN(r,h,t.serverCache);a=null!=u?e.filter.updateChild(o.getNode(),h,u,c,i,s):o.getNode()}}return fa(t,a,o.isFullyInitialized()||dw(n),e.filter.filtersNodes())}}function fM(e,t,n,r,i,s,o,a){let l,h=t.serverCache,u=o?e.filter:e.filter.getIndexedFilter();if(dw(n))l=u.updateFullNode(h.getNode(),r,null);else if(u.filtersNodes()&&!h.isFiltered()){let e=h.getNode().updateChild(n,r);l=u.updateFullNode(h.getNode(),e,null)}else{let e=df(n);if(!h.isCompleteForPath(n)&&dp(n)>1)return t;let i=dm(n),s=h.getNode().getImmediateChild(e).updateChild(i,r);l=".priority"===e?u.updatePriority(h.getNode(),s):u.updateChild(h.getNode(),e,s,i,fD,null)}let c=fl(t,l,h.isFullyInitialized()||dw(n),u.filtersNodes()),d=new fO(i,c,s);return fL(e,c,n,i,d,a)}function fF(e,t,n,r,i,s,o){let a,l,h=t.eventCache,u=new fO(i,t,s);if(dw(n))l=e.filter.updateFullNode(t.eventCache.getNode(),r,o),a=fa(t,l,!0,e.filter.filtersNodes());else{let i=df(n);if(".priority"===i)l=e.filter.updatePriority(t.eventCache.getNode(),r),a=fa(t,l,h.isFullyInitialized(),h.isFiltered());else{let s,l=dm(n),c=h.getNode().getImmediateChild(i);if(dw(l))s=r;else{let e=u.getCompleteChild(i);s=null!=e?".priority"===dg(l)&&e.getChild(d_(l)).isEmpty()?e:e.updateChild(l,r):dK.EMPTY_NODE}a=c.equals(s)?t:fa(t,e.filter.updateChild(h.getNode(),i,s,l,u,o),h.isFullyInitialized(),e.filter.filtersNodes())}}return a}function fU(e,t){return e.eventCache.isCompleteForChild(t)}function fV(e,t,n){return n.foreach((e,n)=>{t=t.updateChild(e,n)}),t}function fj(e,t,n,r,i,s,o,a){let l;if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let h=t;l=dw(n)?r:new fc(null).setTree(n,r);let u=t.serverCache.getNode();return l.children.inorderTraversal((n,r)=>{if(u.hasChild(n)){let l=fV(e,t.serverCache.getNode().getImmediateChild(n),r);h=fM(e,h,new dc(n),l,i,s,o,a)}}),l.children.inorderTraversal((n,r)=>{let l=!t.serverCache.isCompleteForChild(n)&&null===r.value;if(!u.hasChild(n)&&!l){let l=fV(e,t.serverCache.getNode().getImmediateChild(n),r);h=fM(e,h,new dc(n),l,i,s,o,a)}}),h}function fq(e,t,n,r){var i,s;t.type===U.MERGE&&null!==t.source.queryId&&(j(fu(e.viewCache_),"We should always have a full cache before handling merges"),j(fh(e.viewCache_),"Missing event cache, even though we have a server cache"));let o=e.viewCache_,a=function(e,t,n,r,i){var s,o,a,l,h,u,c,d,f,p,m,g;let y,_,v=new fP;if(n.type===U.OVERWRITE)n.source.fromUser?y=fF(e,t,n.path,n.snap,r,i,v):(j(n.source.fromServer,"Unknown source."),_=n.source.tagged||t.serverCache.isFiltered()&&!dw(n.path),y=fM(e,t,n.path,n.snap,r,i,_,v));else if(n.type===U.MERGE){let d;n.source.fromUser?(s=e,o=t,a=n.path,l=n.children,h=r,u=i,c=v,d=o,l.foreach((e,t)=>{let n=dv(a,e);fU(o,df(n))&&(d=fF(s,d,n,t,h,u,c))}),l.foreach((e,t)=>{let n=dv(a,e);fU(o,df(n))||(d=fF(s,d,n,t,h,u,c))}),y=d):(j(n.source.fromServer,"Unknown source."),_=n.source.tagged||t.serverCache.isFiltered(),y=fj(e,t,n.path,n.children,r,i,_,v))}else if(n.type===U.ACK_USER_WRITE)y=n.revert?function(e,t,n,r,i,s){let o;if(null!=fR(r,n))return t;{let a,l=new fO(r,t,i),h=t.eventCache.getNode();if(dw(n)||".priority"===df(n)){let n;if(t.serverCache.isFullyInitialized())n=fI(r,fu(t));else{let e=t.serverCache.getNode();j(e instanceof dK,"serverChildren would be complete if leaf node"),n=fS(r,e)}a=e.filter.updateFullNode(h,n,s)}else{let i=df(n),u=fN(r,i,t.serverCache);null==u&&t.serverCache.isCompleteForChild(i)&&(u=h.getImmediateChild(i)),(a=null!=u?e.filter.updateChild(h,i,u,dm(n),l,s):t.eventCache.getNode().hasChild(i)?e.filter.updateChild(h,i,dK.EMPTY_NODE,dm(n),l,s):h).isEmpty()&&t.serverCache.isFullyInitialized()&&(o=fI(r,fu(t))).isLeafNode()&&(a=e.filter.updateFullNode(a,o,s))}return o=t.serverCache.isFullyInitialized()||null!=fR(r,dd()),fa(t,a,o,e.filter.filtersNodes())}}(e,t,n.path,r,i,v):function(e,t,n,r,i,s,o){if(null!=fR(i,n))return t;let a=t.serverCache.isFiltered(),l=t.serverCache;if(null!=r.value)if(dw(n)&&l.isFullyInitialized()||l.isCompleteForPath(n))return fM(e,t,n,l.getNode().getChild(n),i,s,a,o);else{if(!dw(n))return t;let r=new fc(null);return l.getNode().forEachChild(dP,(e,t)=>{r=r.set(new dc(e),t)}),fj(e,t,n,r,i,s,a,o)}{let h=new fc(null);return r.foreach((e,t)=>{let r=dv(n,e);l.isCompleteForPath(r)&&(h=h.set(e,l.getNode().getChild(r)))}),fj(e,t,n,h,i,s,a,o)}}(e,t,n.path,n.affectedTree,r,i,v);else if(n.type===U.LISTEN_COMPLETE){let i;d=e,f=t,p=n.path,m=r,g=v,i=f.serverCache,y=fL(d,fl(f,i.getNode(),i.isFullyInitialized()||dw(p),i.isFiltered()),p,m,fD,g)}else throw q("Unknown operation type: "+n.type);let w=v.getChanges();return function(e,t,n){let r=t.eventCache;if(r.isFullyInitialized()){let i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=fh(e);!(n.length>0)&&e.eventCache.isFullyInitialized()&&(!i||r.getNode().equals(s))&&r.getNode().getPriority().equals(s.getPriority())||n.push({type:"value",snapshotNode:fh(t)})}}(t,y,w),{viewCache:y,changes:w}}(e.processor_,o,t,n,r);return i=e.processor_,j((s=a.viewCache).eventCache.getNode().isIndexed(i.filter.getIndex()),"Event snap not indexed"),j(s.serverCache.getNode().isIndexed(i.filter.getIndex()),"Server snap not indexed"),j(a.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=a.viewCache,function(e,t,n,r){var i;let s,o,a=(0,e.eventRegistrations_);return i=e.eventGenerator_,s=[],o=[],t.forEach(e=>{var t;"child_changed"===e.type&&i.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&o.push((t=e.childName,{type:"child_moved",snapshotNode:e.snapshotNode,childName:t}))}),fs(i,s,"child_removed",t,a,n),fs(i,s,"child_added",t,a,n),fs(i,s,"child_moved",o,a,n),fs(i,s,"child_changed",t,a,n),fs(i,s,"value",t,a,n),s}(e,a.changes,a.viewCache.eventCache.getNode(),null)}function fz(e,t,n,r){let i=t.source.queryId;if(null!==i){let s=e.views.get(i);return j(null!=s,"SyncTree gave us an op for an invalid query."),fq(s,t,n,r)}{let i=[];for(let s of e.views.values())i=i.concat(fq(s,t,n,r));return i}}function fB(e,t){let n=null;for(let r of e.views.values())n=n||function(e,t){let n=fu(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!dw(t)&&!n.getImmediateChild(df(t)).isEmpty())?n.getChild(t):null}(r,t);return n}class f${constructor(e){this.listenProvider_=e,this.syncPointTree_=new fc(null),this.pendingWriteTree_={visibleWrites:fd.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function fW(e,t,n=!1){let r=function(e,t){for(let n=0;n<e.allWrites.length;n++){let r=e.allWrites[n];if(r.writeId===t)return r}return null}(e.pendingWriteTree_,t);if(!function(e,t){var n;let r=e.allWrites.findIndex(e=>e.writeId===t);j(r>=0,"removeWrite called with nonexistent writeId.");let i=e.allWrites[r];e.allWrites.splice(r,1);let s=i.visible,o=!1,a=e.allWrites.length-1;for(;s&&a>=0;){let t=e.allWrites[a];t.visible&&(a>=r&&function(e,t){if(e.snap)return dT(e.path,t);for(let n in e.children)if(e.children.hasOwnProperty(n)&&dT(dv(e.path,n),t))return!0;return!1}(t,i.path)?s=!1:dT(i.path,t.path)&&(o=!0)),a--}return!!s&&(o?((n=e).visibleWrites=fT(n.allWrites,fE,dd()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1):i.snap?e.visibleWrites=fm(e.visibleWrites,i.path):cW(i.children,t=>{e.visibleWrites=fm(e.visibleWrites,dv(i.path,t))}),!0)}(e.pendingWriteTree_,t))return[];{let t=new fc(null);return null!=r.snap?t=t.set(dd(),!0):cW(r.children,e=>{t=t.set(new dc(e),!0)}),fG(e,new ft(r.path,t,n))}}function fH(e,t,n){return fG(e,new fn(d9(),t,n))}function fK(e,t,n){let r=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,(e,n)=>{let r=fB(n,db(e,t));if(r)return r});return fC(r,t,i,n,!0)}function fG(e,t){var n;return function e(t,n,r,i){if(dw(t.path))return function e(t,n,r,i){let s=n.get(dd());null==r&&null!=s&&(r=fB(s,dd()));let o=[];return n.children.inorderTraversal((n,s)=>{let a=r?r.getImmediateChild(n):null,l=fA(i,n),h=t.operationForChild(n);h&&(o=o.concat(e(h,s,a,l)))}),s&&(o=o.concat(fz(s,t,i,r))),o}(t,n,r,i);{let s=n.get(dd());null==r&&null!=s&&(r=fB(s,dd()));let o=[],a=df(t.path),l=t.operationForChild(a),h=n.children.get(a);if(h&&l){let t=r?r.getImmediateChild(a):null,n=fA(i,a);o=o.concat(e(l,h,t,n))}return s&&(o=o.concat(fz(s,t,i,r))),o}}(t,e.syncPointTree_,null,(n=e.pendingWriteTree_,fx(dd(),n)))}function fQ(e,t){return e.tagToQueryMap.get(t)}function fY(e){let t=e.indexOf("$");return j(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new dc(e.substr(0,t))}}function fX(e,t,n){let r=e.syncPointTree_.get(t);return j(r,"Missing sync point for query tag that we're tracking"),fz(r,n,fx(t,e.pendingWriteTree_),null)}class fJ{constructor(e){this.node_=e}getImmediateChild(e){return new fJ(this.node_.getImmediateChild(e))}node(){return this.node_}}class fZ{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=dv(this.path_,e);return new fZ(this.syncTree_,t)}node(){return fK(this.syncTree_,this.path_)}}let f0=function(e,t,n){return e&&"object"==typeof e?(j(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"])?f1(e[".sv"],t,n):"object"==typeof e[".sv"]?f2(e[".sv"],t):void j(!1,"Unexpected server value: "+JSON.stringify(e,null,2)):e},f1=function(e,t,n){if("timestamp"===e)return n.timestamp;j(!1,"Unexpected server value: "+e)},f2=function(e,t,n){e.hasOwnProperty("increment")||j(!1,"Unexpected server value: "+JSON.stringify(e,null,2));let r=e.increment;"number"!=typeof r&&j(!1,"Unexpected increment value: "+r);let i=t.node();if(j(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;let s=i.getValue();return"number"!=typeof s?r:s+r};function f3(e,t,n){let r,i=f0(e.getPriority().val(),t.getImmediateChild(".priority"),n);if(!e.isLeafNode())return r=e,i!==e.getPriority().val()&&(r=r.updatePriority(new dj(i))),e.forEachChild(dq,(e,i)=>{let s=f3(i,t.getImmediateChild(e),n);s!==i&&(r=r.updateImmediateChild(e,s))}),r;{let r=f0(e.getValue(),t,n);return r!==e.getValue()||i!==e.getPriority().val()?new dj(r,dQ(i)):e}}class f6{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function f4(e,t){let n=t instanceof dc?t:new dc(t),r=e,i=df(n);for(;null!==i;){let e=eb(r.node.children,i)||{children:{},childCount:0};r=new f6(i,r,e),i=df(n=dm(n))}return r}function f5(e){return e.node.value}function f8(e,t){e.node.value=t,function e(t){null!==t.parent&&function(t,n,r){let i=void 0===f5(r)&&!f7(r),s=ew(t.node.children,n);i&&s?(delete t.node.children[n],t.node.childCount--,e(t)):i||s||(t.node.children[n]=r.node,t.node.childCount++,e(t))}(t.parent,t.name,t)}(e)}function f7(e){return e.node.childCount>0}function f9(e,t){cW(e.node.children,(n,r)=>{t(new f6(n,e,r))})}function pe(e){return new dc(null===e.parent?e.name:pe(e.parent)+"/"+e.name)}let pt=/[\[\].#$\/\u0000-\u001F\u007F]/,pn=/[\[\].#$\u0000-\u001F\u007F]/,pr=function(e){return"string"==typeof e&&0!==e.length&&!pt.test(e)},pi=function(e){var t;return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),"string"==typeof(t=e)&&0!==t.length&&!pn.test(t)},ps=function(e,t,n){let r=n instanceof dc?new dC(n,e):n;if(void 0===t)throw Error(e+"contains undefined "+dS(r));if("function"==typeof t)throw Error(e+"contains a function "+dS(r)+" with contents = "+t.toString());if(cM(t))throw Error(e+"contains "+t.toString()+" "+dS(r));if("string"==typeof t&&t.length>3495253.3333333335&&eD(t)>0xa00000)throw Error(e+"contains a string greater than 10485760 utf8 bytes "+dS(r)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,i=!1;if(cW(t,(t,s)=>{let o;if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(i=!0,!pr(t)))throw Error(e+" contains an invalid key ("+t+") "+dS(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');r.parts_.length>0&&(r.byteLength_+=1),r.parts_.push(t),r.byteLength_+=eD(t),dI(r),ps(e,s,r),o=r.parts_.pop(),r.byteLength_-=eD(o),r.parts_.length>0&&(r.byteLength_-=1)}),n&&i)throw Error(e+' contains ".value" child '+dS(r)+" in addition to actual children.")}},po=function(e,t){let n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!pr(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!pi(n))throw Error(`${e} failed: url argument must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};class pa{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function pl(e,t,n){let r=null;for(let t=0;t<n.length;t++){let i=n[t],s=i.getPath();null===r||dE(s,r.path)||(e.eventLists_.push(r),r=null),null===r&&(r={events:[],path:s}),r.events.push(i)}r&&e.eventLists_.push(r),function(e,t){e.recursionDepth_++;let n=!0;for(let r=0;r<e.eventLists_.length;r++){let i=e.eventLists_[r];i&&(t(i.path)?(function(e){for(let t=0;t<e.events.length;t++){let n=e.events[t];if(null!==n){e.events[t]=null;let r=n.getEventRunner();ck&&cA("event: "+n.toString()),cQ(r)}}}(e.eventLists_[r]),e.eventLists_[r]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}(e,e=>dT(e,t)||dT(t,e))}class ph{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new pa,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=d6(),this.transactionQueueTree_=new f6,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function pu(e){var t;let n;return(t=t={timestamp:(n=e.infoData_.getNode(new dc(".info/serverTimeOffset")).val()||0,new Date().getTime()+n)}).timestamp=t.timestamp||new Date().getTime(),t}function pc(e,t,n,r,i){e.dataUpdateCount++;let s=new dc(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(i)if(r){let t=eT(n,e=>dQ(e));o=function(e,t,n,r){let i=fQ(e,r);if(!i)return[];{let r=fY(i),s=r.path,o=r.queryId,a=db(s,t),l=fc.fromObject(n);return fX(e,s,new fr(fe(o),a,l))}}(e.serverSyncTree_,s,t,i)}else{let t=dQ(n);o=function(e,t,n,r){let i=fQ(e,r);if(null==i)return[];{let r=fY(i),s=r.path,o=r.queryId,a=db(s,t);return fX(e,s,new fn(fe(o),a,n))}}(e.serverSyncTree_,s,t,i)}else if(r){var a;let t,r=eT(n,e=>dQ(e));a=e.serverSyncTree_,t=fc.fromObject(r),o=fG(a,new fr(d9(),s,t))}else{let t=dQ(n);o=fH(e.serverSyncTree_,s,t)}let l=s;o.length>0&&(l=pg(e,s)),pl(e.eventQueue_,l,o)}function pd(e,t){var n;let r,i,s;pf(e,"connected",t),!1===t&&(pp(n=e,"onDisconnectEvents"),r=pu(n),i=d6(),d4(n.onDisconnect_,dd(),(e,t)=>{var s;let o=(s=n.serverSyncTree_,f3(t,new fZ(s,e),r));!function e(t,n,r){if(dw(n))t.value=r,t.children.clear();else if(null!==t.value)t.value=t.value.updateChild(n,r);else{let i=df(n);t.children.has(i)||t.children.set(i,d6()),e(t.children.get(i),n=dm(n),r)}}(i,e,o)}),s=[],d4(i,dd(),(e,t)=>{var r,i;let o,a;s=s.concat(fH(n.serverSyncTree_,e,t));let l=(o=pe(py(r=n,i=e)),!function(e,t,n){let r=e.parent;for(;null!==r;){if(t(r))return!0;r=r.parent}}(a=f4(r.transactionQueueTree_,i),e=>{pw(r,e)}),pw(r,a),!function e(t,n,r,i){r&&!i&&n(t),f9(t,t=>{e(t,n,!0,i)}),r&&i&&n(t)}(a,e=>{pw(r,e)}),o);pg(n,l)}),n.onDisconnect_=d6(),pl(n.eventQueue_,dd(),s))}function pf(e,t,n){let r=new dc("/.info/"+t),i=dQ(n);e.infoData_.updateSnapshot(r,i);let s=fH(e.infoSyncTree_,r,i);pl(e.eventQueue_,r,s)}function pp(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),cA(n,...t)}function pm(e,t,n){return fK(e.serverSyncTree_,t,n)||dK.EMPTY_NODE}function pg(e,t){let n=py(e,t),r=pe(n),i=p_(e,n);return function(e,t,n){if(0===t.length)return;let r=[],i=[],s=t.filter(e=>0===e.status).map(e=>e.currentWriteId);for(let o=0;o<t.length;o++){let a=t[o],l=db(n,a.path),h=!1,u;if(j(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===a.status)h=!0,u=a.abortReason,i=i.concat(fW(e.serverSyncTree_,a.currentWriteId,!0));else if(0===a.status)if(a.retryCount>=25)h=!0,u="maxretry",i=i.concat(fW(e.serverSyncTree_,a.currentWriteId,!0));else{let n=pm(e,a.path,s);a.currentInputSnapshot=n;let r=t[o].update(n.val());if(void 0!==r){ps("transaction failed: Data returned ",r,a.path);let t=dQ(r);"object"==typeof r&&null!=r&&ew(r,".priority")||(t=t.updatePriority(n.getPriority()));let o=a.currentWriteId,l=pu(e),h=f3(t,new fJ(n),l);a.currentOutputSnapshotRaw=t,a.currentOutputSnapshotResolved=h,a.currentWriteId=e.nextWriteId_++,s.splice(s.indexOf(o),1),i=(i=i.concat(function(e,t,n,r,i){var s,o;return(s=e.pendingWriteTree_,o=i,j(r>s.lastWriteId,"Stacking an older write on top of newer ones"),void 0===o&&(o=!0),s.allWrites.push({path:t,snap:n,writeId:r,visible:o}),o&&(s.visibleWrites=ff(s.visibleWrites,t,n)),s.lastWriteId=r,i)?fG(e,new fn(d7(),t,n)):[]}(e.serverSyncTree_,a.path,h,a.currentWriteId,a.applyLocally))).concat(fW(e.serverSyncTree_,o,!0))}else h=!0,u="nodata",i=i.concat(fW(e.serverSyncTree_,a.currentWriteId,!0))}pl(e.eventQueue_,n,i),i=[],h&&(t[o].status=2,setTimeout(t[o].unwatcher,Math.floor(0)),t[o].onComplete&&("nodata"===u?r.push(()=>t[o].onComplete(null,!1,t[o].currentInputSnapshot)):r.push(()=>t[o].onComplete(Error(u),!1,null))))}pv(e,e.transactionQueueTree_);for(let e=0;e<r.length;e++)cQ(r[e]);!function e(t,n=t.transactionQueueTree_){if(n||pv(t,n),f5(n)){let r=p_(t,n);j(r.length>0,"Sending zero length transaction queue"),r.every(e=>0===e.status)&&function(t,n,r){let i=pm(t,n,r.map(e=>e.currentWriteId)),s=i,o=i.hash();for(let e=0;e<r.length;e++){let t=r[e];j(0===t.status,"tryToSendTransactionQueue_: items in queue should all be run."),t.status=1,t.retryCount++;let i=db(n,t.path);s=s.updateChild(i,t.currentOutputSnapshotRaw)}let a=s.val(!0);t.server_.put(n.toString(),a,i=>{pp(t,"transaction put response",{path:n.toString(),status:i});let s=[];if("ok"===i){let i=[];for(let e=0;e<r.length;e++)r[e].status=2,s=s.concat(fW(t.serverSyncTree_,r[e].currentWriteId)),r[e].onComplete&&i.push(()=>r[e].onComplete(null,!0,r[e].currentOutputSnapshotResolved)),r[e].unwatcher();pv(t,f4(t.transactionQueueTree_,n)),e(t,t.transactionQueueTree_),pl(t.eventQueue_,n,s);for(let e=0;e<i.length;e++)cQ(i[e])}else{if("datastale"===i)for(let e=0;e<r.length;e++)3===r[e].status?r[e].status=4:r[e].status=0;else{cO("transaction at "+n.toString()+" failed: "+i);for(let e=0;e<r.length;e++)r[e].status=4,r[e].abortReason=i}pg(t,n)}},o)}(t,pe(n),r)}else f7(n)&&f9(n,n=>{e(t,n)})}(e,e.transactionQueueTree_)}(e,i,r),r}function py(e,t){let n,r=e.transactionQueueTree_;for(n=df(t);null!==n&&void 0===f5(r);)r=f4(r,n),n=df(t=dm(t));return r}function p_(e,t){let n=[];return function e(t,n,r){let i=f5(n);if(i)for(let e=0;e<i.length;e++)r.push(i[e]);f9(n,n=>{e(t,n,r)})}(e,t,n),n.sort((e,t)=>e.order-t.order),n}function pv(e,t){let n=f5(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,f8(t,n.length>0?n:void 0)}f9(t,t=>{pv(e,t)})}function pw(e,t){let n=f5(t);if(n){let r=[],i=[],s=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?(j(s===t-1,"All SENT items should be at beginning of queue."),s=t,n[t].status=3,n[t].abortReason="set"):(j(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),i=i.concat(fW(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&r.push(n[t].onComplete.bind(null,Error("set"),!1,null))));-1===s?f8(t,void 0):n.length=s+1,pl(e.eventQueue_,pe(t),i);for(let e=0;e<r.length;e++)cQ(r[e])}}let pb=function(e,t){let n=pE(e),r=n.namespace;"firebase.com"===n.domain&&cD(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||cD("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||cL();let i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new c3(n.host,n.secure,r,i,t,"",r!==n.subdomain),path:new dc(n.pathString)}},pE=function(e){let t="",n="",r="",i="",s="",o=!0,a="https",l=443;if("string"==typeof e){let h=e.indexOf("//");h>=0&&(a=e.substring(0,h-1),e=e.substring(h+2));let u=e.indexOf("/");-1===u&&(u=e.length);let c=e.indexOf("?");-1===c&&(c=e.length),t=e.substring(0,Math.min(u,c)),u<c&&(i=function(e){let t="",n=e.split("/");for(let e=0;e<n.length;e++)if(n[e].length>0){let r=n[e];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch(e){}t+="/"+r}return t}(e.substring(u,c)));let d=function(e){let t={};for(let n of("?"===e.charAt(0)&&(e=e.substring(1)),e.split("&"))){if(0===n.length)continue;let r=n.split("=");2===r.length?t[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):cO(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,c)));(h=t.indexOf(":"))>=0?(o="https"===a||"wss"===a,l=parseInt(t.substring(h+1),10)):h=t.length;let f=t.slice(0,h);if("localhost"===f.toLowerCase())n="localhost";else if(f.split(".").length<=2)n=f;else{let e=t.indexOf(".");r=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=r}"ns"in d&&(s=d.ns)}return{host:t,port:l,domain:n,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}};class pT{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return dw(this._path)?null:dg(this._path)}get ref(){return new pC(this._repo,this._path)}get _queryIdentifier(){let e=cB(d1(this._queryParams));return"{}"===e?"default":e}get _queryObject(){return d1(this._queryParams)}isEqual(e){if(!((e=eO(e))instanceof pT))return!1;let t=this._repo===e._repo,n=dE(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class pC extends pT{constructor(e,t){super(e,t,new dZ,!1)}get parent(){let e=d_(this._path);return null===e?null:new pC(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}j(!c,"__referenceConstructor has already been defined"),c=pC,j(!d,"__referenceConstructor has already been defined"),d=pC;let pI={};class pS{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(!function(e,t,n){var r;let i;if(e.stats_=c7(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new d2(e.repoInfo_,(t,n,r,i)=>{pc(e,t,n,r,i)},e.authTokenProvider_,e.appCheckProvider_),setTimeout(()=>pd(e,!0),0);else{if(null!=n){if("object"!=typeof n)throw Error("Only objects are supported for option databaseAuthVariableOverride");try{eg(n)}catch(e){throw Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new dR(e.repoInfo_,t,(t,n,r,i)=>{pc(e,t,n,r,i)},t=>{pd(e,t)},t=>{var n;n=e,cW(t,(e,t)=>{pf(n,e,t)})},e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener(t=>{e.server_.refreshAuthToken(t)}),e.appCheckProvider_.addTokenChangeListener(t=>{e.server_.refreshAppCheckToken(t.token)}),r=e.repoInfo_,c8[i=r.toString()]||(c8[i]=(()=>new d8(e.stats_,e.server_))()),e.statsReporter_=c8[i],e.infoData_=new d3,e.infoSyncTree_=new f$({startListening:(t,n,r,i)=>{let s=[],o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=fH(e.infoSyncTree_,t._path,o),setTimeout(()=>{i("ok")},0)),s},stopListening:()=>{}}),pf(e,"connected",!1),e.serverSyncTree_=new f$({startListening:(t,n,r,i)=>(e.server_.listen(t,r,n,(n,r)=>{let s=i(n,r);pl(e.eventQueue_,t._path,s)}),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new pC(this._repo,dd())),this._rootInternal}_delete(){if(null!==this._rootInternal){var e,t;let n;e=this._repo,(n=pI[t=this.app.name])&&n[e.key]===e||cD(`Database ${t}(${e.repoInfo_}) has already been deleted.`),e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt"),delete n[e.key],this._repoInternal=null,this._rootInternal=null}return Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&cD("Cannot call "+e+" on a deleted database.")}}dR.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},dR.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},cy=tm,ti(new eL("database",(e,{instanceIdentifier:t})=>{var n,r,i,s;let o,a,l,h,u,c,d,f=e.getProvider("app").getImmediate(),p=e.getProvider("auth-internal"),m=e.getProvider("app-check-internal");return void 0===(l=t||f.options.databaseURL)&&(f.options.projectId||cD("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),cA("Using default host for project ",f.options.projectId),l=`${f.options.projectId}-default-rtdb.firebaseio.com`),u=(h=pb(l,void 0)).repoInfo,void 0!==V.default&&V.default.env&&(c=V.default.env.FIREBASE_DATABASE_EMULATOR_HOST),c?u=(h=pb(l=`http://${c}?ns=${u.namespace}`,void 0)).repoInfo:!h.repoInfo.secure,d=new cJ(f.name,f.options,p),po("Invalid Firebase Database URL",h),dw(h.path)||cD("Database URL must point to the root of a Firebase Database (not including a child path)."),new pS((n=u,r=f,i=d,s=new cX(f,m),(o=pI[r.name])||(o={},pI[r.name]=o),(a=o[n.toURLString()])&&cD("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),a=new ph(n,!1,i,s),o[n.toURLString()]=a,a),f)},"PUBLIC").setMultipleInstances(!0)),tb(cm,cg,void 0),tb(cm,cg,"esm2020");let pk={apiKey:"AIzaSyC5i38Q_4QYx6RWs627_l5xdQ8IAY1b8I8",authDomain:"cnostruct.firebaseapp.com",projectId:"cnostruct",storageBucket:"cnostruct.firebasestorage.app",messagingSenderId:"768135253274",appId:"1:768135253274:web:9662ffb7911766ca5bf0a3",measurementId:"G-J6J233XBCY",databaseURL:"https://cnostruct.firebaseio.com"};if(pk.apiKey&&pk.authDomain&&pk.projectId||(console.error(" Firebase configuration is incomplete. Please check your .env.local file."),console.error("Required variables: NEXT_PUBLIC_FIREBASE_API_KEY, NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN, NEXT_PUBLIC_FIREBASE_PROJECT_ID"),console.error("Current config:",{apiKey:pk.apiKey?" Set":" Missing",authDomain:pk.authDomain?" Set":" Missing",projectId:pk.projectId?" Set":" Missing"})),0===tv().length)try{f=tg(pk),console.log(" Firebase initialized successfully for project:",pk.projectId)}catch(e){throw console.error("Firebase initialization error:",e),Error("Failed to initialize Firebase. Please check your configuration.")}else f=tv()[0];let pR=iR(f),pN=ug(f);!function(e=t_(),t){let n=ts(e=eO(e),cp).getImmediate({identifier:void 0}),r=X("storage");r&&function(e,t,n,r={}){!function(e,t,n,r={}){e.host=`${t}:${n}`;let i=et(t);i&&(en(`https://${e.host}/b`),eo("Storage",!0)),e._isUsingEmulator=!0,e._protocol=i?"https":"http";let{mockUserToken:s}=r;s&&(e._overrideAuthToken="string"==typeof s?s:er(s,e.app.options.projectId))}(e,t,n,r)}(n,...r)}(f),function(e=t_(),t){let n=ts(e,"database").getImmediate({identifier:void 0});if(!n._instanceStarted){let e=X("database");e&&function(e,t,n,r={}){var i;let s,o,a;(e=eO(e))._checkNotDeleted("useEmulator");let l=`${t}:${n}`,h=e._repoInternal;if(e._instanceStarted){if(l===e._repoInternal.repoInfo_.host&&eC(r,h.repoInfo_.emulatorOptions))return;cD("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}h.repoInfo_.nodeAdmin?(r.mockUserToken&&cD('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new cZ(cZ.OWNER)):r.mockUserToken&&(s=new cZ("string"==typeof r.mockUserToken?r.mockUserToken:er(r.mockUserToken,e.app.options.projectId))),et(t)&&(en(t),eo("Database",!0)),i=s,o=l.lastIndexOf(":"),a=et(l.substring(0,o)),h.repoInfo_=new c3(l,a,h.repoInfo_.namespace,h.repoInfo_.webSocketOnly,h.repoInfo_.nodeAdmin,h.repoInfo_.persistenceKey,h.repoInfo_.includeNamespaceInQueryParams,!0,r),i&&(h.authTokenProvider_=i)}(n,...e)}}(f),rE(pR,rR).catch(e=>{console.error("Failed to set auth persistence:",e)}),pR.onAuthStateChanged(e=>{e?console.log(" User authenticated:",e.email,"UID:",e.uid):console.log(" No user signed in")},e=>{console.error(" Auth state error:",e.code,e.message)});let pA=new ri;pA.setCustomParameters({prompt:"select_account"}),e.s(["auth",0,pR,"db",0,pN,"googleProvider",0,pA],76009)},63178,e=>{"use strict";var t=e.i(71645),n=(e,t,n,r,i,s,o,a)=>{let l=document.documentElement,h=["light","dark"];function u(t){var n;(Array.isArray(e)?e:[e]).forEach(e=>{let n="class"===e,r=n&&s?i.map(e=>s[e]||e):i;n?(l.classList.remove(...r),l.classList.add(s&&s[t]?s[t]:t)):l.setAttribute(e,t)}),n=t,a&&h.includes(n)&&(l.style.colorScheme=n)}if(r)u(r);else try{let e=localStorage.getItem(t)||n,r=o&&"system"===e?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e;u(r)}catch(e){}},r=["light","dark"],i="(prefers-color-scheme: dark)",s="undefined"==typeof window,o=t.createContext(void 0),a={setTheme:e=>{},themes:[]},l=()=>{var e;return null!=(e=t.useContext(o))?e:a},h=e=>t.useContext(o)?t.createElement(t.Fragment,null,e.children):t.createElement(c,{...e}),u=["light","dark"],c=({forcedTheme:e,disableTransitionOnChange:n=!1,enableSystem:s=!0,enableColorScheme:a=!0,storageKey:l="theme",themes:h=u,defaultTheme:c=s?"system":"light",attribute:g="data-theme",value:y,children:_,nonce:v,scriptProps:w})=>{let[b,E]=t.useState(()=>f(l,c)),[T,C]=t.useState(()=>"system"===b?m():b),I=y?Object.values(y):h,S=t.useCallback(e=>{let t=e;if(!t)return;"system"===e&&s&&(t=m());let i=y?y[t]:t,o=n?p(v):null,l=document.documentElement,h=e=>{"class"===e?(l.classList.remove(...I),i&&l.classList.add(i)):e.startsWith("data-")&&(i?l.setAttribute(e,i):l.removeAttribute(e))};if(Array.isArray(g)?g.forEach(h):h(g),a){let e=r.includes(c)?c:null,n=r.includes(t)?t:e;l.style.colorScheme=n}null==o||o()},[v]),k=t.useCallback(e=>{let t="function"==typeof e?e(b):e;E(t);try{localStorage.setItem(l,t)}catch(e){}},[b]),R=t.useCallback(t=>{C(m(t)),"system"===b&&s&&!e&&S("system")},[b,e]);t.useEffect(()=>{let e=window.matchMedia(i);return e.addListener(R),R(e),()=>e.removeListener(R)},[R]),t.useEffect(()=>{let e=e=>{e.key===l&&(e.newValue?E(e.newValue):k(c))};return window.addEventListener("storage",e),()=>window.removeEventListener("storage",e)},[k]),t.useEffect(()=>{S(null!=e?e:b)},[e,b]);let N=t.useMemo(()=>({theme:b,setTheme:k,forcedTheme:e,resolvedTheme:"system"===b?T:b,themes:s?[...h,"system"]:h,systemTheme:s?T:void 0}),[b,k,e,T,s,h]);return t.createElement(o.Provider,{value:N},t.createElement(d,{forcedTheme:e,storageKey:l,attribute:g,enableSystem:s,enableColorScheme:a,defaultTheme:c,value:y,themes:h,nonce:v,scriptProps:w}),_)},d=t.memo(({forcedTheme:e,storageKey:r,attribute:i,enableSystem:s,enableColorScheme:o,defaultTheme:a,value:l,themes:h,nonce:u,scriptProps:c})=>{let d=JSON.stringify([i,r,a,e,h,l,s,o]).slice(1,-1);return t.createElement("script",{...c,suppressHydrationWarning:!0,nonce:"undefined"==typeof window?u:"",dangerouslySetInnerHTML:{__html:`(${n.toString()})(${d})`}})}),f=(e,t)=>{let n;if(!s){try{n=localStorage.getItem(e)||void 0}catch(e){}return n||t}},p=e=>{let t=document.createElement("style");return e&&t.setAttribute("nonce",e),t.appendChild(document.createTextNode("*,*::before,*::after{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),document.head.appendChild(t),()=>{window.getComputedStyle(document.body),setTimeout(()=>{document.head.removeChild(t)},1)}},m=e=>(e||(e=window.matchMedia(i)),e.matches?"dark":"light");e.s(["ThemeProvider",()=>h,"useTheme",()=>l])},75254,e=>{"use strict";var t=e.i(71645);let n=(...e)=>e.filter((e,t,n)=>!!e&&""!==e.trim()&&n.indexOf(e)===t).join(" ").trim();var r={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let i=(0,t.forwardRef)(({color:e="currentColor",size:i=24,strokeWidth:s=2,absoluteStrokeWidth:o,className:a="",children:l,iconNode:h,...u},c)=>(0,t.createElement)("svg",{ref:c,...r,width:i,height:i,stroke:e,strokeWidth:o?24*Number(s)/Number(i):s,className:n("lucide",a),...u},[...h.map(([e,n])=>(0,t.createElement)(e,n)),...Array.isArray(l)?l:[l]])),s=(e,r)=>{let s=(0,t.forwardRef)(({className:s,...o},a)=>(0,t.createElement)(i,{ref:a,iconNode:r,className:n(`lucide-${e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,s),...o}));return s.displayName=`${e}`,s};e.s(["default",()=>s],75254)},18566,(e,t,n)=>{t.exports=e.r(76562)},81140,e=>{"use strict";function t(e,n,{checkForDefaultPrevented:r=!0}={}){return function(t){if(e?.(t),!1===r||!t.defaultPrevented)return n?.(t)}}e.s(["composeEventHandlers",()=>t])},30030,e=>{"use strict";var t=e.i(71645),n=e.i(43476);function r(e,r){let i=t.createContext(r),s=e=>{let{children:r,...s}=e,o=t.useMemo(()=>s,Object.values(s));return(0,n.jsx)(i.Provider,{value:o,children:r})};return s.displayName=e+"Provider",[s,function(n){let s=t.useContext(i);if(s)return s;if(void 0!==r)return r;throw Error(`\`${n}\` must be used within \`${e}\``)}]}function i(e,r=[]){let s=[],o=()=>{let n=s.map(e=>t.createContext(e));return function(r){let i=r?.[e]||n;return t.useMemo(()=>({[`__scope${e}`]:{...r,[e]:i}}),[r,i])}};return o.scopeName=e,[function(r,i){let o=t.createContext(i),a=s.length;s=[...s,i];let l=r=>{let{scope:i,children:s,...l}=r,h=i?.[e]?.[a]||o,u=t.useMemo(()=>l,Object.values(l));return(0,n.jsx)(h.Provider,{value:u,children:s})};return l.displayName=r+"Provider",[l,function(n,s){let l=s?.[e]?.[a]||o,h=t.useContext(l);if(h)return h;if(void 0!==i)return i;throw Error(`\`${n}\` must be used within \`${r}\``)}]},function(...e){let n=e[0];if(1===e.length)return n;let r=()=>{let r=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){let i=r.reduce((t,{useScope:n,scopeName:r})=>{let i=n(e)[`__scope${r}`];return{...t,...i}},{});return t.useMemo(()=>({[`__scope${n.scopeName}`]:i}),[i])}};return r.scopeName=n.scopeName,r}(o,...r)]}e.s(["createContext",()=>r,"createContextScope",()=>i])},75830,e=>{"use strict";var t=e.i(71645),n=e.i(30030),r=e.i(20783),i=e.i(91918),s=e.i(43476);function o(e){let o=e+"CollectionProvider",[a,l]=(0,n.createContextScope)(o),[h,u]=a(o,{collectionRef:{current:null},itemMap:new Map}),c=e=>{let{scope:n,children:r}=e,i=t.default.useRef(null),o=t.default.useRef(new Map).current;return(0,s.jsx)(h,{scope:n,itemMap:o,collectionRef:i,children:r})};c.displayName=o;let d=e+"CollectionSlot",f=t.default.forwardRef((e,t)=>{let{scope:n,children:o}=e,a=u(d,n),l=(0,r.useComposedRefs)(t,a.collectionRef);return(0,s.jsx)(i.Slot,{ref:l,children:o})});f.displayName=d;let p=e+"CollectionItemSlot",m="data-radix-collection-item",g=t.default.forwardRef((e,n)=>{let{scope:o,children:a,...l}=e,h=t.default.useRef(null),c=(0,r.useComposedRefs)(n,h),d=u(p,o);return t.default.useEffect(()=>(d.itemMap.set(h,{ref:h,...l}),()=>void d.itemMap.delete(h))),(0,s.jsx)(i.Slot,{...{[m]:""},ref:c,children:a})});return g.displayName=p,[{Provider:c,Slot:f,ItemSlot:g},function(n){let r=u(e+"CollectionConsumer",n);return t.default.useCallback(()=>{let e=r.collectionRef.current;if(!e)return[];let t=Array.from(e.querySelectorAll(`[${m}]`));return Array.from(r.itemMap.values()).sort((e,n)=>t.indexOf(e.ref.current)-t.indexOf(n.ref.current))},[r.collectionRef,r.itemMap])},l]}e.s(["createCollection",()=>o])},48425,e=>{"use strict";var t=e.i(71645),n=e.i(74080),r=e.i(91918),i=e.i(43476),s=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"].reduce((e,n)=>{let s=t.forwardRef((e,t)=>{let{asChild:s,...o}=e,a=s?r.Slot:n;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,i.jsx)(a,{...o,ref:t})});return s.displayName=`Primitive.${n}`,{...e,[n]:s}},{});function o(e,t){e&&n.flushSync(()=>e.dispatchEvent(t))}e.s(["Primitive",()=>s,"dispatchDiscreteCustomEvent",()=>o])},30207,e=>{"use strict";var t=e.i(71645);function n(e){let n=t.useRef(e);return t.useEffect(()=>{n.current=e}),t.useMemo(()=>(...e)=>n.current?.(...e),[])}e.s(["useCallbackRef",()=>n])},26330,e=>{"use strict";var t,n=e.i(71645),r=e.i(81140),i=e.i(48425),s=e.i(20783),o=e.i(30207),a=e.i(43476),l="dismissableLayer.update",h=n.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),u=n.forwardRef((e,u)=>{let{disableOutsidePointerEvents:c=!1,onEscapeKeyDown:p,onPointerDownOutside:m,onFocusOutside:g,onInteractOutside:y,onDismiss:_,...v}=e,w=n.useContext(h),[b,E]=n.useState(null),T=b?.ownerDocument??globalThis?.document,[,C]=n.useState({}),I=(0,s.useComposedRefs)(u,e=>E(e)),S=Array.from(w.layers),[k]=[...w.layersWithOutsidePointerEventsDisabled].slice(-1),R=S.indexOf(k),N=b?S.indexOf(b):-1,A=w.layersWithOutsidePointerEventsDisabled.size>0,x=N>=R,P=function(e,t=globalThis?.document){let r=(0,o.useCallbackRef)(e),i=n.useRef(!1),s=n.useRef(()=>{});return n.useEffect(()=>{let e=e=>{if(e.target&&!i.current){let n=function(){f("dismissableLayer.pointerDownOutside",r,i,{discrete:!0})},i={originalEvent:e};"touch"===e.pointerType?(t.removeEventListener("click",s.current),s.current=n,t.addEventListener("click",s.current,{once:!0})):n()}else t.removeEventListener("click",s.current);i.current=!1},n=window.setTimeout(()=>{t.addEventListener("pointerdown",e)},0);return()=>{window.clearTimeout(n),t.removeEventListener("pointerdown",e),t.removeEventListener("click",s.current)}},[t,r]),{onPointerDownCapture:()=>i.current=!0}}(e=>{let t=e.target,n=[...w.branches].some(e=>e.contains(t));x&&!n&&(m?.(e),y?.(e),e.defaultPrevented||_?.())},T),D=function(e,t=globalThis?.document){let r=(0,o.useCallbackRef)(e),i=n.useRef(!1);return n.useEffect(()=>{let e=e=>{e.target&&!i.current&&f("dismissableLayer.focusOutside",r,{originalEvent:e},{discrete:!1})};return t.addEventListener("focusin",e),()=>t.removeEventListener("focusin",e)},[t,r]),{onFocusCapture:()=>i.current=!0,onBlurCapture:()=>i.current=!1}}(e=>{let t=e.target;![...w.branches].some(e=>e.contains(t))&&(g?.(e),y?.(e),e.defaultPrevented||_?.())},T);return!function(e,t=globalThis?.document){let r=(0,o.useCallbackRef)(e);n.useEffect(()=>{let e=e=>{"Escape"===e.key&&r(e)};return t.addEventListener("keydown",e,{capture:!0}),()=>t.removeEventListener("keydown",e,{capture:!0})},[r,t])}(e=>{N===w.layers.size-1&&(p?.(e),!e.defaultPrevented&&_&&(e.preventDefault(),_()))},T),n.useEffect(()=>{if(b)return c&&(0===w.layersWithOutsidePointerEventsDisabled.size&&(t=T.body.style.pointerEvents,T.body.style.pointerEvents="none"),w.layersWithOutsidePointerEventsDisabled.add(b)),w.layers.add(b),d(),()=>{c&&1===w.layersWithOutsidePointerEventsDisabled.size&&(T.body.style.pointerEvents=t)}},[b,T,c,w]),n.useEffect(()=>()=>{b&&(w.layers.delete(b),w.layersWithOutsidePointerEventsDisabled.delete(b),d())},[b,w]),n.useEffect(()=>{let e=()=>C({});return document.addEventListener(l,e),()=>document.removeEventListener(l,e)},[]),(0,a.jsx)(i.Primitive.div,{...v,ref:I,style:{pointerEvents:A?x?"auto":"none":void 0,...e.style},onFocusCapture:(0,r.composeEventHandlers)(e.onFocusCapture,D.onFocusCapture),onBlurCapture:(0,r.composeEventHandlers)(e.onBlurCapture,D.onBlurCapture),onPointerDownCapture:(0,r.composeEventHandlers)(e.onPointerDownCapture,P.onPointerDownCapture)})});u.displayName="DismissableLayer";var c=n.forwardRef((e,t)=>{let r=n.useContext(h),o=n.useRef(null),l=(0,s.useComposedRefs)(t,o);return n.useEffect(()=>{let e=o.current;if(e)return r.branches.add(e),()=>{r.branches.delete(e)}},[r.branches]),(0,a.jsx)(i.Primitive.div,{...e,ref:l})});function d(){let e=new CustomEvent(l);document.dispatchEvent(e)}function f(e,t,n,{discrete:r}){let s=n.originalEvent.target,o=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&s.addEventListener(e,t,{once:!0}),r?(0,i.dispatchDiscreteCustomEvent)(s,o):s.dispatchEvent(o)}c.displayName="DismissableLayerBranch",e.s(["Branch",()=>c,"DismissableLayer",()=>u,"Root",()=>u],26330)},34620,e=>{"use strict";var t=e.i(71645),n=globalThis?.document?t.useLayoutEffect:()=>{};e.s(["useLayoutEffect",()=>n])},74606,96626,e=>{"use strict";var t=e.i(71645),n=e.i(74080),r=e.i(48425),i=e.i(34620),s=e.i(43476),o=t.forwardRef((e,o)=>{let{container:a,...l}=e,[h,u]=t.useState(!1);(0,i.useLayoutEffect)(()=>u(!0),[]);let c=a||h&&globalThis?.document?.body;return c?n.default.createPortal((0,s.jsx)(r.Primitive.div,{...l,ref:o}),c):null});o.displayName="Portal",e.s(["Portal",()=>o],74606);var a=e.i(20783),l=e=>{var n;let r,s,{present:o,children:l}=e,u=function(e){var n,r;let[s,o]=t.useState(),a=t.useRef({}),l=t.useRef(e),u=t.useRef("none"),[c,d]=(n=e?"mounted":"unmounted",r={mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}},t.useReducer((e,t)=>r[e][t]??e,n));return t.useEffect(()=>{let e=h(a.current);u.current="mounted"===c?e:"none"},[c]),(0,i.useLayoutEffect)(()=>{let t=a.current,n=l.current;if(n!==e){let r=u.current,i=h(t);e?d("MOUNT"):"none"===i||t?.display==="none"?d("UNMOUNT"):n&&r!==i?d("ANIMATION_OUT"):d("UNMOUNT"),l.current=e}},[e,d]),(0,i.useLayoutEffect)(()=>{if(s){let e,t=s.ownerDocument.defaultView??window,n=n=>{let r=h(a.current).includes(n.animationName);if(n.target===s&&r&&(d("ANIMATION_END"),!l.current)){let n=s.style.animationFillMode;s.style.animationFillMode="forwards",e=t.setTimeout(()=>{"forwards"===s.style.animationFillMode&&(s.style.animationFillMode=n)})}},r=e=>{e.target===s&&(u.current=h(a.current))};return s.addEventListener("animationstart",r),s.addEventListener("animationcancel",n),s.addEventListener("animationend",n),()=>{t.clearTimeout(e),s.removeEventListener("animationstart",r),s.removeEventListener("animationcancel",n),s.removeEventListener("animationend",n)}}d("ANIMATION_END")},[s,d]),{isPresent:["mounted","unmountSuspended"].includes(c),ref:t.useCallback(e=>{e&&(a.current=getComputedStyle(e)),o(e)},[])}}(o),c="function"==typeof l?l({present:u.isPresent}):t.Children.only(l),d=(0,a.useComposedRefs)(u.ref,(n=c,(s=(r=Object.getOwnPropertyDescriptor(n.props,"ref")?.get)&&"isReactWarning"in r&&r.isReactWarning)?n.ref:(s=(r=Object.getOwnPropertyDescriptor(n,"ref")?.get)&&"isReactWarning"in r&&r.isReactWarning)?n.props.ref:n.props.ref||n.ref));return"function"==typeof l||u.isPresent?t.cloneElement(c,{ref:d}):null};function h(e){return e?.animationName||"none"}l.displayName="Presence",e.s(["Presence",()=>l],96626)},69340,e=>{"use strict";var t=e.i(71645),n=e.i(30207);function r({prop:e,defaultProp:r,onChange:i=()=>{}}){let[s,o]=function({defaultProp:e,onChange:r}){let i=t.useState(e),[s]=i,o=t.useRef(s),a=(0,n.useCallbackRef)(r);return t.useEffect(()=>{o.current!==s&&(a(s),o.current=s)},[s,o,a]),i}({defaultProp:r,onChange:i}),a=void 0!==e,l=a?e:s,h=(0,n.useCallbackRef)(i);return[l,t.useCallback(t=>{if(a){let n="function"==typeof t?t(e):t;n!==e&&h(n)}else o(t)},[a,e,o,h])]}e.s(["useControllableState",()=>r])}]);