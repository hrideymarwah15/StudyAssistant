(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,18504,(e,t,r)=>{},81405,(e,t,r)=>{var i;e.e,(i=function(){function e(e){return n.appendChild(e.dom),e}function t(e){for(var t=0;t<n.children.length;t++)n.children[t].style.display=t===e?"block":"none";r=e}var r=0,n=document.createElement("div");n.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",n.addEventListener("click",function(e){e.preventDefault(),t(++r%n.children.length)},!1);var a=(performance||Date).now(),o=a,s=0,l=e(new i.Panel("FPS","#0ff","#002")),c=e(new i.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var h=e(new i.Panel("MB","#f08","#201"));return t(0),{REVISION:16,dom:n,addPanel:e,showPanel:t,begin:function(){a=(performance||Date).now()},end:function(){s++;var e=(performance||Date).now();if(c.update(e-a,200),e>o+1e3&&(l.update(1e3*s/(e-o),100),o=e,s=0,h)){var t=performance.memory;h.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){a=this.end()},domElement:n,setMode:t}}).Panel=function(e,t,r){var i=1/0,n=0,a=Math.round,o=a(window.devicePixelRatio||1),s=80*o,l=48*o,c=3*o,h=2*o,u=3*o,A=15*o,d=74*o,f=30*o,m=document.createElement("canvas");m.width=s,m.height=l,m.style.cssText="width:80px;height:48px";var p=m.getContext("2d");return p.font="bold "+9*o+"px Helvetica,Arial,sans-serif",p.textBaseline="top",p.fillStyle=r,p.fillRect(0,0,s,l),p.fillStyle=t,p.fillText(e,c,h),p.fillRect(u,A,d,f),p.fillStyle=r,p.globalAlpha=.9,p.fillRect(u,A,d,f),{dom:m,update:function(l,g){i=Math.min(i,l),n=Math.max(n,l),p.fillStyle=r,p.globalAlpha=1,p.fillRect(0,0,s,A),p.fillStyle=t,p.fillText(a(l)+" "+e+" ("+a(i)+"-"+a(n)+")",c,h),p.drawImage(m,u+o,A,d-o,f,u,A,d-o,f),p.fillRect(u+d-o,A,o,f),p.fillStyle=r,p.globalAlpha=.9,p.fillRect(u+d-o,A,o,a((1-l/g)*f))}}},t.exports=i},98749,e=>{"use strict";let t,r,i,n,a,o,s,l,c,h,u,A,d,f,m,p,g,v,y,x,E,C,B,w,I,b,_,M,S,T,D,F,R,P,Q,U,z,k,L,O,G,N,H,V,j,J,Y,W,K,X,q,Z,$,ee,et,er,ei,en,ea,eo,es,el,ec,eh,eu,eA,ed,ef,em,ep,eg,ev,ey,ex,eE,eC,eB,ew,eI,eb,e_,eM,eS,eT,eD,eF,eR,eP,eQ,eU=Object.freeze({NONE:0,ROTATE:1,TRUCK:2,SCREEN_PAN:4,OFFSET:8,DOLLY:16,ZOOM:32,TOUCH_ROTATE:64,TOUCH_TRUCK:128,TOUCH_SCREEN_PAN:256,TOUCH_OFFSET:512,TOUCH_DOLLY:1024,TOUCH_ZOOM:2048,TOUCH_DOLLY_TRUCK:4096,TOUCH_DOLLY_SCREEN_PAN:8192,TOUCH_DOLLY_OFFSET:16384,TOUCH_DOLLY_ROTATE:32768,TOUCH_ZOOM_TRUCK:65536,TOUCH_ZOOM_OFFSET:131072,TOUCH_ZOOM_SCREEN_PAN:262144,TOUCH_ZOOM_ROTATE:524288});function ez(e){return e.isPerspectiveCamera}function ek(e){return e.isOrthographicCamera}let eL=2*Math.PI,eO=Math.PI/2,eG=Math.PI/180;function eN(e,t,r){return Math.max(t,Math.min(r,e))}function eH(e,t=1e-5){return Math.abs(e)<t}function eV(e,t,r=1e-5){return eH(e-t,r)}function ej(e,t){return Math.round(e/t)*t}function eJ(e){return isFinite(e)?e:e<0?-Number.MAX_VALUE:Number.MAX_VALUE}function eY(e){return Math.abs(e)<Number.MAX_VALUE?e:1/0*e}function eW(e,t,r,i,n=1/0,a){let o=2/(i=Math.max(1e-4,i)),s=o*a,l=1/(1+s+.48*s*s+.235*s*s*s),c=e-t,h=t,u=n*i;t=e-(c=eN(c,-u,u));let A=(r.value+o*c)*a;r.value=(r.value-o*A)*l;let d=t+(c+A)*l;return h-e>0==d>h&&(r.value=((d=h)-h)/a),d}function eK(e,t,r,i,n=1/0,a,o){let s=2/(i=Math.max(1e-4,i)),l=s*a,c=1/(1+l+.48*l*l+.235*l*l*l),h=t.x,u=t.y,A=t.z,d=e.x-h,f=e.y-u,m=e.z-A,p=h,g=u,v=A,y=n*i,x=d*d+f*f+m*m;if(x>y*y){let e=Math.sqrt(x);d=d/e*y,f=f/e*y,m=m/e*y}h=e.x-d,u=e.y-f,A=e.z-m;let E=(r.x+s*d)*a,C=(r.y+s*f)*a,B=(r.z+s*m)*a;r.x=(r.x-s*E)*c,r.y=(r.y-s*C)*c,r.z=(r.z-s*B)*c,o.x=h+(d+E)*c,o.y=u+(f+C)*c,o.z=A+(m+B)*c;let w=p-e.x,I=g-e.y,b=v-e.z;return w*(o.x-p)+I*(o.y-g)+b*(o.z-v)>0&&(o.x=p,o.y=g,o.z=v,r.x=(o.x-p)/a,r.y=(o.y-g)/a,r.z=(o.z-v)/a),o}function eX(e,t){t.set(0,0),e.forEach(e=>{t.x+=e.clientX,t.y+=e.clientY}),t.x/=e.length,t.y/=e.length}function eq(e,t){return!!ek(e)&&(console.warn(`${t} is not supported in OrthographicCamera`),!0)}class eZ{_listeners={};addEventListener(e,t){let r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)}hasEventListener(e,t){let r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)}removeEventListener(e,t){let r=this._listeners[e];if(void 0!==r){let e=r.indexOf(t);-1!==e&&r.splice(e,1)}}removeAllEventListeners(e){if(!e){this._listeners={};return}Array.isArray(this._listeners[e])&&(this._listeners[e].length=0)}dispatchEvent(e){let t=this._listeners[e.type];if(void 0!==t){e.target=this;let r=t.slice(0);for(let t=0,i=r.length;t<i;t++)r[t].call(this,e)}}}let e$=1/8,e1=/Mac/.test(globalThis?.navigator?.platform);class e0 extends eZ{static install(e){r=Object.freeze(new(t=e.THREE).Vector3(0,0,0)),i=Object.freeze(new t.Vector3(0,1,0)),n=Object.freeze(new t.Vector3(0,0,1)),a=new t.Vector2,o=new t.Vector3,s=new t.Vector3,l=new t.Vector3,c=new t.Vector3,h=new t.Vector3,u=new t.Vector3,A=new t.Vector3,d=new t.Vector3,f=new t.Vector3,m=new t.Spherical,p=new t.Spherical,g=new t.Box3,v=new t.Box3,y=new t.Sphere,x=new t.Quaternion,E=new t.Quaternion,C=new t.Matrix4,B=new t.Raycaster}static get ACTION(){return eU}minPolarAngle=0;maxPolarAngle=Math.PI;minAzimuthAngle=-1/0;maxAzimuthAngle=1/0;minDistance=Number.EPSILON;maxDistance=1/0;infinityDolly=!1;minZoom=.01;maxZoom=1/0;smoothTime=.25;draggingSmoothTime=.125;maxSpeed=1/0;azimuthRotateSpeed=1;polarRotateSpeed=1;dollySpeed=1;dollyDragInverted=!1;truckSpeed=2;dollyToCursor=!1;dragToOffset=!1;boundaryFriction=0;restThreshold=.01;colliderMeshes=[];mouseButtons;touches;cancel=()=>{};lockPointer;unlockPointer;_enabled=!0;_camera;_yAxisUpSpace;_yAxisUpSpaceInverse;_state=eU.NONE;_domElement;_viewport=null;_target;_targetEnd;_focalOffset;_focalOffsetEnd;_spherical;_sphericalEnd;_lastDistance;_zoom;_zoomEnd;_lastZoom;_cameraUp0;_target0;_position0;_zoom0;_focalOffset0;_dollyControlCoord;_changedDolly=0;_changedZoom=0;_nearPlaneCorners;_hasRested=!0;_boundary;_boundaryEnclosesCamera=!1;_needsUpdate=!0;_updatedLastTime=!1;_elementRect=new DOMRect;_isDragging=!1;_dragNeedsUpdate=!0;_activePointers=[];_lockedPointer=null;_interactiveArea=new DOMRect(0,0,1,1);_isUserControllingRotate=!1;_isUserControllingDolly=!1;_isUserControllingTruck=!1;_isUserControllingOffset=!1;_isUserControllingZoom=!1;_lastDollyDirection=0;_thetaVelocity={value:0};_phiVelocity={value:0};_radiusVelocity={value:0};_targetVelocity=new t.Vector3;_focalOffsetVelocity=new t.Vector3;_zoomVelocity={value:0};set verticalDragToForward(e){console.warn("camera-controls: `verticalDragToForward` was removed. Use `mouseButtons.left = CameraControls.ACTION.SCREEN_PAN` instead.")}constructor(e,r){super(),void 0===t&&console.error("camera-controls: `THREE` is undefined. You must first run `CameraControls.install( { THREE: THREE } )`. Check the docs for further information."),this._camera=e,this._yAxisUpSpace=new t.Quaternion().setFromUnitVectors(this._camera.up,i),this._yAxisUpSpaceInverse=this._yAxisUpSpace.clone().invert(),this._state=eU.NONE,this._target=new t.Vector3,this._targetEnd=this._target.clone(),this._focalOffset=new t.Vector3,this._focalOffsetEnd=this._focalOffset.clone(),this._spherical=new t.Spherical().setFromVector3(o.copy(this._camera.position).applyQuaternion(this._yAxisUpSpace)),this._sphericalEnd=this._spherical.clone(),this._lastDistance=this._spherical.radius,this._zoom=this._camera.zoom,this._zoomEnd=this._zoom,this._lastZoom=this._zoom,this._nearPlaneCorners=[new t.Vector3,new t.Vector3,new t.Vector3,new t.Vector3],this._updateNearPlaneCorners(),this._boundary=new t.Box3(new t.Vector3(-1/0,-1/0,-1/0),new t.Vector3(1/0,1/0,1/0)),this._cameraUp0=this._camera.up.clone(),this._target0=this._target.clone(),this._position0=this._camera.position.clone(),this._zoom0=this._zoom,this._focalOffset0=this._focalOffset.clone(),this._dollyControlCoord=new t.Vector2,this.mouseButtons={left:eU.ROTATE,middle:eU.DOLLY,right:eU.TRUCK,wheel:ez(this._camera)?eU.DOLLY:ek(this._camera)?eU.ZOOM:eU.NONE},this.touches={one:eU.TOUCH_ROTATE,two:ez(this._camera)?eU.TOUCH_DOLLY_TRUCK:ek(this._camera)?eU.TOUCH_ZOOM_TRUCK:eU.NONE,three:eU.TOUCH_TRUCK};const n=new t.Vector2,s=new t.Vector2,l=new t.Vector2,c=e=>{if(!this._enabled||!this._domElement)return;if(0!==this._interactiveArea.left||0!==this._interactiveArea.top||1!==this._interactiveArea.width||1!==this._interactiveArea.height){let t=this._domElement.getBoundingClientRect(),r=e.clientX/t.width,i=e.clientY/t.height;if(r<this._interactiveArea.left||r>this._interactiveArea.right||i<this._interactiveArea.top||i>this._interactiveArea.bottom)return}let t="mouse"!==e.pointerType?null:(1&e.buttons)==1?1:(4&e.buttons)==4?4:(2&e.buttons)==2?2:null;if(null!==t){let e=this._findPointerByMouseButton(t);e&&this._disposePointer(e)}if((1&e.buttons)==1&&this._lockedPointer)return;let r={pointerId:e.pointerId,clientX:e.clientX,clientY:e.clientY,deltaX:0,deltaY:0,mouseButton:t};this._activePointers.push(r),this._domElement.ownerDocument.removeEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",u),this._domElement.ownerDocument.addEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",u),this._isDragging=!0,m(e)},h=e=>{e.cancelable&&e.preventDefault();let t=e.pointerId,r=this._lockedPointer||this._findPointerById(t);if(r){if(r.clientX=e.clientX,r.clientY=e.clientY,r.deltaX=e.movementX,r.deltaY=e.movementY,this._state=0,"touch"===e.pointerType)switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else(!this._isDragging&&this._lockedPointer||this._isDragging&&(1&e.buttons)==1)&&(this._state=this._state|this.mouseButtons.left),this._isDragging&&(4&e.buttons)==4&&(this._state=this._state|this.mouseButtons.middle),this._isDragging&&(2&e.buttons)==2&&(this._state=this._state|this.mouseButtons.right);p()}},u=e=>{let t=this._findPointerById(e.pointerId);if(!t||t!==this._lockedPointer){if(t&&this._disposePointer(t),"touch"===e.pointerType)switch(this._activePointers.length){case 0:this._state=eU.NONE;break;case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else this._state=eU.NONE;g()}};let A=-1;const d=e=>{if(!this._domElement||!this._enabled||this.mouseButtons.wheel===eU.NONE)return;if(0!==this._interactiveArea.left||0!==this._interactiveArea.top||1!==this._interactiveArea.width||1!==this._interactiveArea.height){let t=this._domElement.getBoundingClientRect(),r=e.clientX/t.width,i=e.clientY/t.height;if(r<this._interactiveArea.left||r>this._interactiveArea.right||i<this._interactiveArea.top||i>this._interactiveArea.bottom)return}if(e.preventDefault(),this.dollyToCursor||this.mouseButtons.wheel===eU.ROTATE||this.mouseButtons.wheel===eU.TRUCK){let e=performance.now();A-e<1e3&&this._getClientRect(this._elementRect),A=e}let t=e1?-1:-3,r=1!==e.deltaMode||e.ctrlKey?e.deltaY/(10*t):e.deltaY/t,i=this.dollyToCursor?(e.clientX-this._elementRect.x)/this._elementRect.width*2-1:0,n=this.dollyToCursor?-((e.clientY-this._elementRect.y)/this._elementRect.height*2)+1:0;switch(e.ctrlKey?eU.ZOOM:this.mouseButtons.wheel){case eU.ROTATE:this._rotateInternal(e.deltaX,e.deltaY),this._isUserControllingRotate=!0;break;case eU.TRUCK:this._truckInternal(e.deltaX,e.deltaY,!1,!1),this._isUserControllingTruck=!0;break;case eU.SCREEN_PAN:this._truckInternal(e.deltaX,e.deltaY,!1,!0),this._isUserControllingTruck=!0;break;case eU.OFFSET:this._truckInternal(e.deltaX,e.deltaY,!0,!1),this._isUserControllingOffset=!0;break;case eU.DOLLY:this._dollyInternal(-r,i,n),this._isUserControllingDolly=!0;break;case eU.ZOOM:this._zoomInternal(-r,i,n),this._isUserControllingZoom=!0}this.dispatchEvent({type:"control"})},f=e=>{if(this._domElement&&this._enabled){if(this.mouseButtons.right===e0.ACTION.NONE){let t=e instanceof PointerEvent?e.pointerId:0,r=this._findPointerById(t);r&&this._disposePointer(r),this._domElement.ownerDocument.removeEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",u);return}e.preventDefault()}},m=e=>{if(this._enabled){if(eX(this._activePointers,a),this._getClientRect(this._elementRect),n.copy(a),s.copy(a),this._activePointers.length>=2){let e=a.x-this._activePointers[1].clientX,t=a.y-this._activePointers[1].clientY,r=Math.sqrt(e*e+t*t);l.set(0,r);let i=(this._activePointers[0].clientX+this._activePointers[1].clientX)*.5,n=(this._activePointers[0].clientY+this._activePointers[1].clientY)*.5;s.set(i,n)}if(this._state=0,e)if("pointerType"in e&&"touch"===e.pointerType)switch(this._activePointers.length){case 1:this._state=this.touches.one;break;case 2:this._state=this.touches.two;break;case 3:this._state=this.touches.three}else this._lockedPointer||(1&e.buttons)!=1||(this._state=this._state|this.mouseButtons.left),(4&e.buttons)==4&&(this._state=this._state|this.mouseButtons.middle),(2&e.buttons)==2&&(this._state=this._state|this.mouseButtons.right);else this._lockedPointer&&(this._state=this._state|this.mouseButtons.left);((this._state&eU.ROTATE)===eU.ROTATE||(this._state&eU.TOUCH_ROTATE)===eU.TOUCH_ROTATE||(this._state&eU.TOUCH_DOLLY_ROTATE)===eU.TOUCH_DOLLY_ROTATE||(this._state&eU.TOUCH_ZOOM_ROTATE)===eU.TOUCH_ZOOM_ROTATE)&&(this._sphericalEnd.theta=this._spherical.theta,this._sphericalEnd.phi=this._spherical.phi,this._thetaVelocity.value=0,this._phiVelocity.value=0),((this._state&eU.TRUCK)===eU.TRUCK||(this._state&eU.SCREEN_PAN)===eU.SCREEN_PAN||(this._state&eU.TOUCH_TRUCK)===eU.TOUCH_TRUCK||(this._state&eU.TOUCH_SCREEN_PAN)===eU.TOUCH_SCREEN_PAN||(this._state&eU.TOUCH_DOLLY_TRUCK)===eU.TOUCH_DOLLY_TRUCK||(this._state&eU.TOUCH_DOLLY_SCREEN_PAN)===eU.TOUCH_DOLLY_SCREEN_PAN||(this._state&eU.TOUCH_ZOOM_TRUCK)===eU.TOUCH_ZOOM_TRUCK||(this._state&eU.TOUCH_ZOOM_SCREEN_PAN)===eU.TOUCH_DOLLY_SCREEN_PAN)&&(this._targetEnd.copy(this._target),this._targetVelocity.set(0,0,0)),((this._state&eU.DOLLY)===eU.DOLLY||(this._state&eU.TOUCH_DOLLY)===eU.TOUCH_DOLLY||(this._state&eU.TOUCH_DOLLY_TRUCK)===eU.TOUCH_DOLLY_TRUCK||(this._state&eU.TOUCH_DOLLY_SCREEN_PAN)===eU.TOUCH_DOLLY_SCREEN_PAN||(this._state&eU.TOUCH_DOLLY_OFFSET)===eU.TOUCH_DOLLY_OFFSET||(this._state&eU.TOUCH_DOLLY_ROTATE)===eU.TOUCH_DOLLY_ROTATE)&&(this._sphericalEnd.radius=this._spherical.radius,this._radiusVelocity.value=0),((this._state&eU.ZOOM)===eU.ZOOM||(this._state&eU.TOUCH_ZOOM)===eU.TOUCH_ZOOM||(this._state&eU.TOUCH_ZOOM_TRUCK)===eU.TOUCH_ZOOM_TRUCK||(this._state&eU.TOUCH_ZOOM_SCREEN_PAN)===eU.TOUCH_ZOOM_SCREEN_PAN||(this._state&eU.TOUCH_ZOOM_OFFSET)===eU.TOUCH_ZOOM_OFFSET||(this._state&eU.TOUCH_ZOOM_ROTATE)===eU.TOUCH_ZOOM_ROTATE)&&(this._zoomEnd=this._zoom,this._zoomVelocity.value=0),((this._state&eU.OFFSET)===eU.OFFSET||(this._state&eU.TOUCH_OFFSET)===eU.TOUCH_OFFSET||(this._state&eU.TOUCH_DOLLY_OFFSET)===eU.TOUCH_DOLLY_OFFSET||(this._state&eU.TOUCH_ZOOM_OFFSET)===eU.TOUCH_ZOOM_OFFSET)&&(this._focalOffsetEnd.copy(this._focalOffset),this._focalOffsetVelocity.set(0,0,0)),this.dispatchEvent({type:"controlstart"})}},p=()=>{if(!this._enabled||!this._dragNeedsUpdate)return;this._dragNeedsUpdate=!1,eX(this._activePointers,a);let e=this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement?this._lockedPointer||this._activePointers[0]:null,t=e?-e.deltaX:s.x-a.x,r=e?-e.deltaY:s.y-a.y;if(s.copy(a),((this._state&eU.ROTATE)===eU.ROTATE||(this._state&eU.TOUCH_ROTATE)===eU.TOUCH_ROTATE||(this._state&eU.TOUCH_DOLLY_ROTATE)===eU.TOUCH_DOLLY_ROTATE||(this._state&eU.TOUCH_ZOOM_ROTATE)===eU.TOUCH_ZOOM_ROTATE)&&(this._rotateInternal(t,r),this._isUserControllingRotate=!0),(this._state&eU.DOLLY)===eU.DOLLY||(this._state&eU.ZOOM)===eU.ZOOM){let e=this.dollyToCursor?(n.x-this._elementRect.x)/this._elementRect.width*2-1:0,t=this.dollyToCursor?-((n.y-this._elementRect.y)/this._elementRect.height*2)+1:0,i=this.dollyDragInverted?-1:1;(this._state&eU.DOLLY)===eU.DOLLY?(this._dollyInternal(i*r*e$,e,t),this._isUserControllingDolly=!0):(this._zoomInternal(i*r*e$,e,t),this._isUserControllingZoom=!0)}if((this._state&eU.TOUCH_DOLLY)===eU.TOUCH_DOLLY||(this._state&eU.TOUCH_ZOOM)===eU.TOUCH_ZOOM||(this._state&eU.TOUCH_DOLLY_TRUCK)===eU.TOUCH_DOLLY_TRUCK||(this._state&eU.TOUCH_ZOOM_TRUCK)===eU.TOUCH_ZOOM_TRUCK||(this._state&eU.TOUCH_DOLLY_SCREEN_PAN)===eU.TOUCH_DOLLY_SCREEN_PAN||(this._state&eU.TOUCH_ZOOM_SCREEN_PAN)===eU.TOUCH_ZOOM_SCREEN_PAN||(this._state&eU.TOUCH_DOLLY_OFFSET)===eU.TOUCH_DOLLY_OFFSET||(this._state&eU.TOUCH_ZOOM_OFFSET)===eU.TOUCH_ZOOM_OFFSET||(this._state&eU.TOUCH_DOLLY_ROTATE)===eU.TOUCH_DOLLY_ROTATE||(this._state&eU.TOUCH_ZOOM_ROTATE)===eU.TOUCH_ZOOM_ROTATE){let e=a.x-this._activePointers[1].clientX,t=a.y-this._activePointers[1].clientY,r=Math.sqrt(e*e+t*t),i=l.y-r;l.set(0,r);let n=this.dollyToCursor?(s.x-this._elementRect.x)/this._elementRect.width*2-1:0,o=this.dollyToCursor?-((s.y-this._elementRect.y)/this._elementRect.height*2)+1:0;(this._state&eU.TOUCH_DOLLY)===eU.TOUCH_DOLLY||(this._state&eU.TOUCH_DOLLY_ROTATE)===eU.TOUCH_DOLLY_ROTATE||(this._state&eU.TOUCH_DOLLY_TRUCK)===eU.TOUCH_DOLLY_TRUCK||(this._state&eU.TOUCH_DOLLY_SCREEN_PAN)===eU.TOUCH_DOLLY_SCREEN_PAN||(this._state&eU.TOUCH_DOLLY_OFFSET)===eU.TOUCH_DOLLY_OFFSET?(this._dollyInternal(i*e$,n,o),this._isUserControllingDolly=!0):(this._zoomInternal(i*e$,n,o),this._isUserControllingZoom=!0)}((this._state&eU.TRUCK)===eU.TRUCK||(this._state&eU.TOUCH_TRUCK)===eU.TOUCH_TRUCK||(this._state&eU.TOUCH_DOLLY_TRUCK)===eU.TOUCH_DOLLY_TRUCK||(this._state&eU.TOUCH_ZOOM_TRUCK)===eU.TOUCH_ZOOM_TRUCK)&&(this._truckInternal(t,r,!1,!1),this._isUserControllingTruck=!0),((this._state&eU.SCREEN_PAN)===eU.SCREEN_PAN||(this._state&eU.TOUCH_SCREEN_PAN)===eU.TOUCH_SCREEN_PAN||(this._state&eU.TOUCH_DOLLY_SCREEN_PAN)===eU.TOUCH_DOLLY_SCREEN_PAN||(this._state&eU.TOUCH_ZOOM_SCREEN_PAN)===eU.TOUCH_ZOOM_SCREEN_PAN)&&(this._truckInternal(t,r,!1,!0),this._isUserControllingTruck=!0),((this._state&eU.OFFSET)===eU.OFFSET||(this._state&eU.TOUCH_OFFSET)===eU.TOUCH_OFFSET||(this._state&eU.TOUCH_DOLLY_OFFSET)===eU.TOUCH_DOLLY_OFFSET||(this._state&eU.TOUCH_ZOOM_OFFSET)===eU.TOUCH_ZOOM_OFFSET)&&(this._truckInternal(t,r,!0,!1),this._isUserControllingOffset=!0),this.dispatchEvent({type:"control"})},g=()=>{eX(this._activePointers,a),s.copy(a),this._dragNeedsUpdate=!1,(0===this._activePointers.length||1===this._activePointers.length&&this._activePointers[0]===this._lockedPointer)&&(this._isDragging=!1),0===this._activePointers.length&&this._domElement&&(this._domElement.ownerDocument.removeEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",u),this.dispatchEvent({type:"controlend"}))};this.lockPointer=()=>{this._enabled&&this._domElement&&(this.cancel(),this._lockedPointer={pointerId:-1,clientX:0,clientY:0,deltaX:0,deltaY:0,mouseButton:null},this._activePointers.push(this._lockedPointer),this._domElement.ownerDocument.removeEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",u),this._domElement.requestPointerLock(),this._domElement.ownerDocument.addEventListener("pointerlockchange",v),this._domElement.ownerDocument.addEventListener("pointerlockerror",y),this._domElement.ownerDocument.addEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.addEventListener("pointerup",u),m())},this.unlockPointer=()=>{null!==this._lockedPointer&&(this._disposePointer(this._lockedPointer),this._lockedPointer=null),this._domElement?.ownerDocument.exitPointerLock(),this._domElement?.ownerDocument.removeEventListener("pointerlockchange",v),this._domElement?.ownerDocument.removeEventListener("pointerlockerror",y),this.cancel()};const v=()=>{this._domElement&&this._domElement.ownerDocument.pointerLockElement===this._domElement||this.unlockPointer()},y=()=>{this.unlockPointer()};this._addAllEventListeners=e=>{this._domElement=e,this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none",this._domElement.addEventListener("pointerdown",c),this._domElement.addEventListener("pointercancel",u),this._domElement.addEventListener("wheel",d,{passive:!1}),this._domElement.addEventListener("contextmenu",f)},this._removeAllEventListeners=()=>{this._domElement&&(this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect="",this._domElement.removeEventListener("pointerdown",c),this._domElement.removeEventListener("pointercancel",u),this._domElement.removeEventListener("wheel",d,{passive:!1}),this._domElement.removeEventListener("contextmenu",f),this._domElement.ownerDocument.removeEventListener("pointermove",h,{passive:!1}),this._domElement.ownerDocument.removeEventListener("pointerup",u),this._domElement.ownerDocument.removeEventListener("pointerlockchange",v),this._domElement.ownerDocument.removeEventListener("pointerlockerror",y))},this.cancel=()=>{this._state!==eU.NONE&&(this._state=eU.NONE,this._activePointers.length=0,g())},r&&this.connect(r),this.update(0)}get camera(){return this._camera}set camera(e){this._camera=e,this.updateCameraUp(),this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0}get enabled(){return this._enabled}set enabled(e){this._enabled=e,this._domElement&&(e?(this._domElement.style.touchAction="none",this._domElement.style.userSelect="none",this._domElement.style.webkitUserSelect="none"):(this.cancel(),this._domElement.style.touchAction="",this._domElement.style.userSelect="",this._domElement.style.webkitUserSelect=""))}get active(){return!this._hasRested}get currentAction(){return this._state}get distance(){return this._spherical.radius}set distance(e){(this._spherical.radius!==e||this._sphericalEnd.radius!==e)&&(this._spherical.radius=e,this._sphericalEnd.radius=e,this._needsUpdate=!0)}get azimuthAngle(){return this._spherical.theta}set azimuthAngle(e){(this._spherical.theta!==e||this._sphericalEnd.theta!==e)&&(this._spherical.theta=e,this._sphericalEnd.theta=e,this._needsUpdate=!0)}get polarAngle(){return this._spherical.phi}set polarAngle(e){(this._spherical.phi!==e||this._sphericalEnd.phi!==e)&&(this._spherical.phi=e,this._sphericalEnd.phi=e,this._needsUpdate=!0)}get boundaryEnclosesCamera(){return this._boundaryEnclosesCamera}set boundaryEnclosesCamera(e){this._boundaryEnclosesCamera=e,this._needsUpdate=!0}set interactiveArea(e){this._interactiveArea.width=eN(e.width,0,1),this._interactiveArea.height=eN(e.height,0,1),this._interactiveArea.x=eN(e.x,0,1-this._interactiveArea.width),this._interactiveArea.y=eN(e.y,0,1-this._interactiveArea.height)}addEventListener(e,t){super.addEventListener(e,t)}removeEventListener(e,t){super.removeEventListener(e,t)}rotate(e,t,r=!1){return this.rotateTo(this._sphericalEnd.theta+e,this._sphericalEnd.phi+t,r)}rotateAzimuthTo(e,t=!1){return this.rotateTo(e,this._sphericalEnd.phi,t)}rotatePolarTo(e,t=!1){return this.rotateTo(this._sphericalEnd.theta,e,t)}rotateTo(e,t,r=!1){this._isUserControllingRotate=!1;let i=eN(e,this.minAzimuthAngle,this.maxAzimuthAngle),n=eN(t,this.minPolarAngle,this.maxPolarAngle);this._sphericalEnd.theta=i,this._sphericalEnd.phi=n,this._sphericalEnd.makeSafe(),this._needsUpdate=!0,r||(this._spherical.theta=this._sphericalEnd.theta,this._spherical.phi=this._sphericalEnd.phi);let a=!r||eV(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&eV(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold);return this._createOnRestPromise(a)}dolly(e,t=!1){return this.dollyTo(this._sphericalEnd.radius-e,t)}dollyTo(e,t=!1){return this._isUserControllingDolly=!1,this._lastDollyDirection=0,this._changedDolly=0,this._dollyToNoClamp(eN(e,this.minDistance,this.maxDistance),t)}_dollyToNoClamp(e,t=!1){let r=this._sphericalEnd.radius;if(this.colliderMeshes.length>=1){let t=this._collisionTest(),i=eV(t,this._spherical.radius);if(!(r>e)&&i)return Promise.resolve();this._sphericalEnd.radius=Math.min(e,t)}else this._sphericalEnd.radius=e;this._needsUpdate=!0,t||(this._spherical.radius=this._sphericalEnd.radius);let i=!t||eV(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(i)}dollyInFixed(e,t=!1){this._targetEnd.add(this._getCameraDirection(c).multiplyScalar(e)),t||this._target.copy(this._targetEnd);let r=!t||eV(this._target.x,this._targetEnd.x,this.restThreshold)&&eV(this._target.y,this._targetEnd.y,this.restThreshold)&&eV(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(r)}zoom(e,t=!1){return this.zoomTo(this._zoomEnd+e,t)}zoomTo(e,t=!1){this._isUserControllingZoom=!1,this._zoomEnd=eN(e,this.minZoom,this.maxZoom),this._needsUpdate=!0,t||(this._zoom=this._zoomEnd);let r=!t||eV(this._zoom,this._zoomEnd,this.restThreshold);return this._changedZoom=0,this._createOnRestPromise(r)}pan(e,t,r=!1){return console.warn("`pan` has been renamed to `truck`"),this.truck(e,t,r)}truck(e,t,r=!1){this._camera.updateMatrix(),h.setFromMatrixColumn(this._camera.matrix,0),u.setFromMatrixColumn(this._camera.matrix,1),h.multiplyScalar(e),u.multiplyScalar(-t);let i=o.copy(h).add(u),n=s.copy(this._targetEnd).add(i);return this.moveTo(n.x,n.y,n.z,r)}forward(e,t=!1){o.setFromMatrixColumn(this._camera.matrix,0),o.crossVectors(this._camera.up,o),o.multiplyScalar(e);let r=s.copy(this._targetEnd).add(o);return this.moveTo(r.x,r.y,r.z,t)}elevate(e,t=!1){return o.copy(this._camera.up).multiplyScalar(e),this.moveTo(this._targetEnd.x+o.x,this._targetEnd.y+o.y,this._targetEnd.z+o.z,t)}moveTo(e,t,r,i=!1){this._isUserControllingTruck=!1;let n=o.set(e,t,r).sub(this._targetEnd);this._encloseToBoundary(this._targetEnd,n,this.boundaryFriction),this._needsUpdate=!0,i||this._target.copy(this._targetEnd);let a=!i||eV(this._target.x,this._targetEnd.x,this.restThreshold)&&eV(this._target.y,this._targetEnd.y,this.restThreshold)&&eV(this._target.z,this._targetEnd.z,this.restThreshold);return this._createOnRestPromise(a)}lookInDirectionOf(e,t,r,i=!1){let n=o.set(e,t,r).sub(this._targetEnd).normalize().multiplyScalar(-this._sphericalEnd.radius).add(this._targetEnd);return this.setPosition(n.x,n.y,n.z,i)}fitToBox(e,t,{cover:r=!1,paddingLeft:a=0,paddingRight:l=0,paddingBottom:c=0,paddingTop:h=0}={}){let u=[],A=e.isBox3?g.copy(e):g.setFromObject(e);A.isEmpty()&&(console.warn("camera-controls: fitTo() cannot be used with an empty box. Aborting"),Promise.resolve());let d=ej(this._sphericalEnd.theta,eO),f=ej(this._sphericalEnd.phi,eO);u.push(this.rotateTo(d,f,t));let m=o.setFromSpherical(this._sphericalEnd).normalize(),p=x.setFromUnitVectors(m,n),y=eV(Math.abs(m.y),1);y&&p.multiply(E.setFromAxisAngle(i,d)),p.multiply(this._yAxisUpSpaceInverse);let C=v.makeEmpty();s.copy(A.min).applyQuaternion(p),C.expandByPoint(s),s.copy(A.min).setX(A.max.x).applyQuaternion(p),C.expandByPoint(s),s.copy(A.min).setY(A.max.y).applyQuaternion(p),C.expandByPoint(s),s.copy(A.max).setZ(A.min.z).applyQuaternion(p),C.expandByPoint(s),s.copy(A.min).setZ(A.max.z).applyQuaternion(p),C.expandByPoint(s),s.copy(A.max).setY(A.min.y).applyQuaternion(p),C.expandByPoint(s),s.copy(A.max).setX(A.min.x).applyQuaternion(p),C.expandByPoint(s),s.copy(A.max).applyQuaternion(p),C.expandByPoint(s),C.min.x-=a,C.min.y-=c,C.max.x+=l,C.max.y+=h,p.setFromUnitVectors(n,m),y&&p.premultiply(E.invert()),p.premultiply(this._yAxisUpSpace);let B=C.getSize(o),w=C.getCenter(s).applyQuaternion(p);if(ez(this._camera)){let e=this.getDistanceToFitBox(B.x,B.y,B.z,r);u.push(this.moveTo(w.x,w.y,w.z,t)),u.push(this.dollyTo(e,t)),u.push(this.setFocalOffset(0,0,0,t))}else if(ek(this._camera)){let e=this._camera,i=e.right-e.left,n=e.top-e.bottom,a=r?Math.max(i/B.x,n/B.y):Math.min(i/B.x,n/B.y);u.push(this.moveTo(w.x,w.y,w.z,t)),u.push(this.zoomTo(a,t)),u.push(this.setFocalOffset(0,0,0,t))}return Promise.all(u)}fitToSphere(e,t){let r=[],i="isObject3D"in e?e0.createBoundingSphere(e,y):y.copy(e);if(r.push(this.moveTo(i.center.x,i.center.y,i.center.z,t)),ez(this._camera)){let e=this.getDistanceToFitSphere(i.radius);r.push(this.dollyTo(e,t))}else if(ek(this._camera)){let e=this._camera.right-this._camera.left,n=this._camera.top-this._camera.bottom,a=2*i.radius,o=Math.min(e/a,n/a);r.push(this.zoomTo(o,t))}return r.push(this.setFocalOffset(0,0,0,t)),Promise.all(r)}setLookAt(e,t,r,i,n,a,l=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=0,this._changedDolly=0;let c=s.set(i,n,a),h=o.set(e,t,r);this._targetEnd.copy(c),this._sphericalEnd.setFromVector3(h.sub(c).applyQuaternion(this._yAxisUpSpace)),this._needsUpdate=!0,l||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));let u=!l||eV(this._target.x,this._targetEnd.x,this.restThreshold)&&eV(this._target.y,this._targetEnd.y,this.restThreshold)&&eV(this._target.z,this._targetEnd.z,this.restThreshold)&&eV(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&eV(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&eV(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(u)}lerp(e,t,r,i=!1){this._isUserControllingRotate=!1,this._isUserControllingDolly=!1,this._isUserControllingTruck=!1,this._lastDollyDirection=0,this._changedDolly=0;let n=o.set(...e.target);if("spherical"in e)m.set(...e.spherical);else{let t=s.set(...e.position);m.setFromVector3(t.sub(n).applyQuaternion(this._yAxisUpSpace))}let a=l.set(...t.target);if("spherical"in t)p.set(...t.spherical);else{let e=s.set(...t.position);p.setFromVector3(e.sub(a).applyQuaternion(this._yAxisUpSpace))}this._targetEnd.copy(n.lerp(a,r));let c=p.theta-m.theta,h=p.phi-m.phi,u=p.radius-m.radius;this._sphericalEnd.set(m.radius+u*r,m.phi+h*r,m.theta+c*r),this._needsUpdate=!0,i||(this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd));let A=!i||eV(this._target.x,this._targetEnd.x,this.restThreshold)&&eV(this._target.y,this._targetEnd.y,this.restThreshold)&&eV(this._target.z,this._targetEnd.z,this.restThreshold)&&eV(this._spherical.theta,this._sphericalEnd.theta,this.restThreshold)&&eV(this._spherical.phi,this._sphericalEnd.phi,this.restThreshold)&&eV(this._spherical.radius,this._sphericalEnd.radius,this.restThreshold);return this._createOnRestPromise(A)}lerpLookAt(e,t,r,i,n,a,o,s,l,c,h,u,A,d=!1){return this.lerp({position:[e,t,r],target:[i,n,a]},{position:[o,s,l],target:[c,h,u]},A,d)}setPosition(e,t,r,i=!1){return this.setLookAt(e,t,r,this._targetEnd.x,this._targetEnd.y,this._targetEnd.z,i)}setTarget(e,t,r,i=!1){let n=this.getPosition(o),a=this.setLookAt(n.x,n.y,n.z,e,t,r,i);return this._sphericalEnd.phi=eN(this._sphericalEnd.phi,this.minPolarAngle,this.maxPolarAngle),a}setFocalOffset(e,t,r,i=!1){this._isUserControllingOffset=!1,this._focalOffsetEnd.set(e,t,r),this._needsUpdate=!0,i||this._focalOffset.copy(this._focalOffsetEnd);let n=!i||eV(this._focalOffset.x,this._focalOffsetEnd.x,this.restThreshold)&&eV(this._focalOffset.y,this._focalOffsetEnd.y,this.restThreshold)&&eV(this._focalOffset.z,this._focalOffsetEnd.z,this.restThreshold);return this._createOnRestPromise(n)}setOrbitPoint(e,t,r){this._camera.updateMatrixWorld(),h.setFromMatrixColumn(this._camera.matrixWorldInverse,0),u.setFromMatrixColumn(this._camera.matrixWorldInverse,1),A.setFromMatrixColumn(this._camera.matrixWorldInverse,2);let i=o.set(e,t,r),n=i.distanceTo(this._camera.position),a=i.sub(this._camera.position);h.multiplyScalar(a.x),u.multiplyScalar(a.y),A.multiplyScalar(a.z),o.copy(h).add(u).add(A),o.z=o.z+n,this.dollyTo(n,!1),this.setFocalOffset(-o.x,o.y,-o.z,!1),this.moveTo(e,t,r,!1)}setBoundary(e){if(!e){this._boundary.min.set(-1/0,-1/0,-1/0),this._boundary.max.set(1/0,1/0,1/0),this._needsUpdate=!0;return}this._boundary.copy(e),this._boundary.clampPoint(this._targetEnd,this._targetEnd),this._needsUpdate=!0}setViewport(e,r,i,n){if(null===e){this._viewport=null;return}this._viewport=this._viewport||new t.Vector4,"number"==typeof e?this._viewport.set(e,r,i,n):this._viewport.copy(e)}getDistanceToFitBox(e,t,r,i=!1){if(eq(this._camera,"getDistanceToFitBox"))return this._spherical.radius;let n=e/t,a=this._camera.getEffectiveFOV()*eG,o=this._camera.aspect;return .5*((i?n>o:n<o)?t:e/o)/Math.tan(.5*a)+.5*r}getDistanceToFitSphere(e){if(eq(this._camera,"getDistanceToFitSphere"))return this._spherical.radius;let t=this._camera.getEffectiveFOV()*eG,r=2*Math.atan(Math.tan(.5*t)*this._camera.aspect);return e/Math.sin(.5*(1<this._camera.aspect?t:r))}getTarget(e,r=!0){return(e&&e.isVector3?e:new t.Vector3).copy(r?this._targetEnd:this._target)}getPosition(e,r=!0){return(e&&e.isVector3?e:new t.Vector3).setFromSpherical(r?this._sphericalEnd:this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(r?this._targetEnd:this._target)}getSpherical(e,r=!0){return(e||new t.Spherical).copy(r?this._sphericalEnd:this._spherical)}getFocalOffset(e,r=!0){return(e&&e.isVector3?e:new t.Vector3).copy(r?this._focalOffsetEnd:this._focalOffset)}normalizeRotations(){return this._sphericalEnd.theta=(this._sphericalEnd.theta%eL+eL)%eL,this._sphericalEnd.theta>Math.PI&&(this._sphericalEnd.theta-=eL),this._spherical.theta+=eL*Math.round((this._sphericalEnd.theta-this._spherical.theta)/eL),this}stop(){this._focalOffset.copy(this._focalOffsetEnd),this._target.copy(this._targetEnd),this._spherical.copy(this._sphericalEnd),this._zoom=this._zoomEnd}reset(e=!1){if(!eV(this._camera.up.x,this._cameraUp0.x)||!eV(this._camera.up.y,this._cameraUp0.y)||!eV(this._camera.up.z,this._cameraUp0.z)){this._camera.up.copy(this._cameraUp0);let e=this.getPosition(o);this.updateCameraUp(),this.setPosition(e.x,e.y,e.z)}return Promise.all([this.setLookAt(this._position0.x,this._position0.y,this._position0.z,this._target0.x,this._target0.y,this._target0.z,e),this.setFocalOffset(this._focalOffset0.x,this._focalOffset0.y,this._focalOffset0.z,e),this.zoomTo(this._zoom0,e)])}saveState(){this._cameraUp0.copy(this._camera.up),this.getTarget(this._target0),this.getPosition(this._position0),this._zoom0=this._zoom,this._focalOffset0.copy(this._focalOffset)}updateCameraUp(){this._yAxisUpSpace.setFromUnitVectors(this._camera.up,i),this._yAxisUpSpaceInverse.copy(this._yAxisUpSpace).invert()}applyCameraUp(){let e=o.subVectors(this._target,this._camera.position).normalize(),t=s.crossVectors(e,this._camera.up);this._camera.up.crossVectors(t,e).normalize(),this._camera.updateMatrixWorld();let r=this.getPosition(o);this.updateCameraUp(),this.setPosition(r.x,r.y,r.z)}update(e){let t=this._sphericalEnd.theta-this._spherical.theta,r=this._sphericalEnd.phi-this._spherical.phi,i=this._sphericalEnd.radius-this._spherical.radius,n=d.subVectors(this._targetEnd,this._target),a=f.subVectors(this._focalOffsetEnd,this._focalOffset),m=this._zoomEnd-this._zoom;if(eH(t))this._thetaVelocity.value=0,this._spherical.theta=this._sphericalEnd.theta;else{let t=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.theta=eW(this._spherical.theta,this._sphericalEnd.theta,this._thetaVelocity,t,1/0,e),this._needsUpdate=!0}if(eH(r))this._phiVelocity.value=0,this._spherical.phi=this._sphericalEnd.phi;else{let t=this._isUserControllingRotate?this.draggingSmoothTime:this.smoothTime;this._spherical.phi=eW(this._spherical.phi,this._sphericalEnd.phi,this._phiVelocity,t,1/0,e),this._needsUpdate=!0}if(eH(i))this._radiusVelocity.value=0,this._spherical.radius=this._sphericalEnd.radius;else{let t=this._isUserControllingDolly?this.draggingSmoothTime:this.smoothTime;this._spherical.radius=eW(this._spherical.radius,this._sphericalEnd.radius,this._radiusVelocity,t,this.maxSpeed,e),this._needsUpdate=!0}if(eH(n.x)&&eH(n.y)&&eH(n.z))this._targetVelocity.set(0,0,0),this._target.copy(this._targetEnd);else{let t=this._isUserControllingTruck?this.draggingSmoothTime:this.smoothTime;eK(this._target,this._targetEnd,this._targetVelocity,t,this.maxSpeed,e,this._target),this._needsUpdate=!0}if(eH(a.x)&&eH(a.y)&&eH(a.z))this._focalOffsetVelocity.set(0,0,0),this._focalOffset.copy(this._focalOffsetEnd);else{let t=this._isUserControllingOffset?this.draggingSmoothTime:this.smoothTime;eK(this._focalOffset,this._focalOffsetEnd,this._focalOffsetVelocity,t,this.maxSpeed,e,this._focalOffset),this._needsUpdate=!0}if(eH(m))this._zoomVelocity.value=0,this._zoom=this._zoomEnd;else{let t=this._isUserControllingZoom?this.draggingSmoothTime:this.smoothTime;this._zoom=eW(this._zoom,this._zoomEnd,this._zoomVelocity,t,1/0,e)}if(this.dollyToCursor){if(ez(this._camera)&&0!==this._changedDolly){let e=this._spherical.radius-this._lastDistance,t=this._camera,r=this._getCameraDirection(c),i=o.copy(r).cross(t.up).normalize();0===i.lengthSq()&&(i.x=1);let n=s.crossVectors(i,r),a=this._sphericalEnd.radius*Math.tan(t.getEffectiveFOV()*eG*.5),h=(this._sphericalEnd.radius-e-this._sphericalEnd.radius)/this._sphericalEnd.radius,u=l.copy(this._targetEnd).add(i.multiplyScalar(this._dollyControlCoord.x*a*t.aspect)).add(n.multiplyScalar(this._dollyControlCoord.y*a)),A=o.copy(this._targetEnd).lerp(u,h),d=1===this._lastDollyDirection&&this._spherical.radius<=this.minDistance,f=-1===this._lastDollyDirection&&this.maxDistance<=this._spherical.radius;if(this.infinityDolly&&(d||f)){this._sphericalEnd.radius-=e,this._spherical.radius-=e;let t=s.copy(r).multiplyScalar(-e);A.add(t)}this._boundary.clampPoint(A,A);let m=s.subVectors(A,this._targetEnd);this._targetEnd.copy(A),this._target.add(m),this._changedDolly-=e,eH(this._changedDolly)&&(this._changedDolly=0)}else if(ek(this._camera)&&0!==this._changedZoom){let e=this._zoom-this._lastZoom,t=this._camera,r=o.set(this._dollyControlCoord.x,this._dollyControlCoord.y,(t.near+t.far)/(t.near-t.far)).unproject(t),i=s.set(0,0,-1).applyQuaternion(t.quaternion),n=l.copy(r).add(i.multiplyScalar(-r.dot(t.up))),a=-(this._zoom-e-this._zoom)/this._zoom,h=this._getCameraDirection(c),u=this._targetEnd.dot(h),A=o.copy(this._targetEnd).lerp(n,a),d=A.dot(h),f=h.multiplyScalar(d-u);A.sub(f),this._boundary.clampPoint(A,A);let m=s.subVectors(A,this._targetEnd);this._targetEnd.copy(A),this._target.add(m),this._changedZoom-=e,eH(this._changedZoom)&&(this._changedZoom=0)}}this._camera.zoom!==this._zoom&&(this._camera.zoom=this._zoom,this._camera.updateProjectionMatrix(),this._updateNearPlaneCorners(),this._needsUpdate=!0),this._dragNeedsUpdate=!0;let p=this._collisionTest();this._spherical.radius=Math.min(this._spherical.radius,p),this._spherical.makeSafe(),this._camera.position.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse).add(this._target),this._camera.lookAt(this._target),eH(this._focalOffset.x)&&eH(this._focalOffset.y)&&eH(this._focalOffset.z)||(this._camera.matrix.compose(this._camera.position,this._camera.quaternion,this._camera.scale),h.setFromMatrixColumn(this._camera.matrix,0),u.setFromMatrixColumn(this._camera.matrix,1),A.setFromMatrixColumn(this._camera.matrix,2),h.multiplyScalar(this._focalOffset.x),u.multiplyScalar(-this._focalOffset.y),A.multiplyScalar(this._focalOffset.z),o.copy(h).add(u).add(A),this._camera.position.add(o),this._camera.updateMatrixWorld()),this._boundaryEnclosesCamera&&this._encloseToBoundary(this._camera.position.copy(this._target),o.setFromSpherical(this._spherical).applyQuaternion(this._yAxisUpSpaceInverse),1);let g=this._needsUpdate;return g&&!this._updatedLastTime?(this._hasRested=!1,this.dispatchEvent({type:"wake"}),this.dispatchEvent({type:"update"})):g?(this.dispatchEvent({type:"update"}),eH(t,this.restThreshold)&&eH(r,this.restThreshold)&&eH(i,this.restThreshold)&&eH(n.x,this.restThreshold)&&eH(n.y,this.restThreshold)&&eH(n.z,this.restThreshold)&&eH(a.x,this.restThreshold)&&eH(a.y,this.restThreshold)&&eH(a.z,this.restThreshold)&&eH(m,this.restThreshold)&&!this._hasRested&&(this._hasRested=!0,this.dispatchEvent({type:"rest"}))):!g&&this._updatedLastTime&&this.dispatchEvent({type:"sleep"}),this._lastDistance=this._spherical.radius,this._lastZoom=this._zoom,this._updatedLastTime=g,this._needsUpdate=!1,g}toJSON(){return JSON.stringify({enabled:this._enabled,minDistance:this.minDistance,maxDistance:eJ(this.maxDistance),minZoom:this.minZoom,maxZoom:eJ(this.maxZoom),minPolarAngle:this.minPolarAngle,maxPolarAngle:eJ(this.maxPolarAngle),minAzimuthAngle:eJ(this.minAzimuthAngle),maxAzimuthAngle:eJ(this.maxAzimuthAngle),smoothTime:this.smoothTime,draggingSmoothTime:this.draggingSmoothTime,dollySpeed:this.dollySpeed,truckSpeed:this.truckSpeed,dollyToCursor:this.dollyToCursor,target:this._targetEnd.toArray(),position:o.setFromSpherical(this._sphericalEnd).add(this._targetEnd).toArray(),zoom:this._zoomEnd,focalOffset:this._focalOffsetEnd.toArray(),target0:this._target0.toArray(),position0:this._position0.toArray(),zoom0:this._zoom0,focalOffset0:this._focalOffset0.toArray()})}fromJSON(e,t=!1){let r=JSON.parse(e);this.enabled=r.enabled,this.minDistance=r.minDistance,this.maxDistance=eY(r.maxDistance),this.minZoom=r.minZoom,this.maxZoom=eY(r.maxZoom),this.minPolarAngle=r.minPolarAngle,this.maxPolarAngle=eY(r.maxPolarAngle),this.minAzimuthAngle=eY(r.minAzimuthAngle),this.maxAzimuthAngle=eY(r.maxAzimuthAngle),this.smoothTime=r.smoothTime,this.draggingSmoothTime=r.draggingSmoothTime,this.dollySpeed=r.dollySpeed,this.truckSpeed=r.truckSpeed,this.dollyToCursor=r.dollyToCursor,this._target0.fromArray(r.target0),this._position0.fromArray(r.position0),this._zoom0=r.zoom0,this._focalOffset0.fromArray(r.focalOffset0),this.moveTo(r.target[0],r.target[1],r.target[2],t),m.setFromVector3(o.fromArray(r.position).sub(this._targetEnd).applyQuaternion(this._yAxisUpSpace)),this.rotateTo(m.theta,m.phi,t),this.dollyTo(m.radius,t),this.zoomTo(r.zoom,t),this.setFocalOffset(r.focalOffset[0],r.focalOffset[1],r.focalOffset[2],t),this._needsUpdate=!0}connect(e){this._domElement?console.warn("camera-controls is already connected."):(e.setAttribute("data-camera-controls-version","3.1.2"),this._addAllEventListeners(e),this._getClientRect(this._elementRect))}disconnect(){this.cancel(),this._removeAllEventListeners(),this._domElement&&(this._domElement.removeAttribute("data-camera-controls-version"),this._domElement=void 0)}dispose(){this.removeAllEventListeners(),this.disconnect()}_getTargetDirection(e){return e.setFromSpherical(this._spherical).divideScalar(this._spherical.radius).applyQuaternion(this._yAxisUpSpaceInverse)}_getCameraDirection(e){return this._getTargetDirection(e).negate()}_findPointerById(e){return this._activePointers.find(t=>t.pointerId===e)}_findPointerByMouseButton(e){return this._activePointers.find(t=>t.mouseButton===e)}_disposePointer(e){this._activePointers.splice(this._activePointers.indexOf(e),1)}_encloseToBoundary(e,t,r){let i=t.lengthSq();if(0===i)return e;let n=s.copy(t).add(e),a=this._boundary.clampPoint(n,l).sub(n),o=a.lengthSq();if(0===o)return e.add(t);{if(o===i)return e;if(0===r)return e.add(t).add(a);let n=1+r*o/t.dot(a);return e.add(s.copy(t).multiplyScalar(n)).add(a.multiplyScalar(1-r))}}_updateNearPlaneCorners(){if(ez(this._camera)){let e=this._camera,t=e.near,r=Math.tan(.5*(e.getEffectiveFOV()*eG))*t,i=r*e.aspect;this._nearPlaneCorners[0].set(-i,-r,0),this._nearPlaneCorners[1].set(i,-r,0),this._nearPlaneCorners[2].set(i,r,0),this._nearPlaneCorners[3].set(-i,r,0)}else if(ek(this._camera)){let e=this._camera,t=1/e.zoom,r=e.left*t,i=e.right*t,n=e.top*t,a=e.bottom*t;this._nearPlaneCorners[0].set(r,n,0),this._nearPlaneCorners[1].set(i,n,0),this._nearPlaneCorners[2].set(i,a,0),this._nearPlaneCorners[3].set(r,a,0)}}_truckInternal=(e,t,r,i)=>{let n,a;if(ez(this._camera)){let r=o.copy(this._camera.position).sub(this._target),i=this._camera.getEffectiveFOV()*eG,s=r.length()*Math.tan(.5*i);n=this.truckSpeed*e*s/this._elementRect.height,a=this.truckSpeed*t*s/this._elementRect.height}else{if(!ek(this._camera))return;let r=this._camera;n=this.truckSpeed*e*(r.right-r.left)/r.zoom/this._elementRect.width,a=this.truckSpeed*t*(r.top-r.bottom)/r.zoom/this._elementRect.height}i?(r?this.setFocalOffset(this._focalOffsetEnd.x+n,this._focalOffsetEnd.y,this._focalOffsetEnd.z,!0):this.truck(n,0,!0),this.forward(-a,!0)):r?this.setFocalOffset(this._focalOffsetEnd.x+n,this._focalOffsetEnd.y+a,this._focalOffsetEnd.z,!0):this.truck(n,a,!0)};_rotateInternal=(e,t)=>{let r=eL*this.azimuthRotateSpeed*e/this._elementRect.height,i=eL*this.polarRotateSpeed*t/this._elementRect.height;this.rotate(r,i,!0)};_dollyInternal=(e,t,r)=>{let i=Math.pow(.95,-e*this.dollySpeed),n=this._sphericalEnd.radius,a=this._sphericalEnd.radius*i,o=eN(a,this.minDistance,this.maxDistance),s=o-a;this.infinityDolly&&this.dollyToCursor?this._dollyToNoClamp(a,!0):(this.infinityDolly&&!this.dollyToCursor&&this.dollyInFixed(s,!0),this._dollyToNoClamp(o,!0)),this.dollyToCursor&&(this._changedDolly+=(this.infinityDolly?a:o)-n,this._dollyControlCoord.set(t,r)),this._lastDollyDirection=Math.sign(-e)};_zoomInternal=(e,t,r)=>{let i=Math.pow(.95,e*this.dollySpeed),n=this._zoom,a=this._zoom*i;this.zoomTo(a,!0),this.dollyToCursor&&(this._changedZoom+=a-n,this._dollyControlCoord.set(t,r))};_collisionTest(){let e=1/0;if(!(this.colliderMeshes.length>=1)||eq(this._camera,"_collisionTest"))return e;let t=this._getTargetDirection(c);C.lookAt(r,t,this._camera.up);for(let r=0;r<4;r++){let i=s.copy(this._nearPlaneCorners[r]);i.applyMatrix4(C);let n=l.addVectors(this._target,i);B.set(n,t),B.far=this._spherical.radius+1;let a=B.intersectObjects(this.colliderMeshes);0!==a.length&&a[0].distance<e&&(e=a[0].distance)}return e}_getClientRect(e){if(!this._domElement)return;let t=this._domElement.getBoundingClientRect();return e.x=t.left,e.y=t.top,this._viewport?(e.x+=this._viewport.x,e.y+=t.height-this._viewport.w-this._viewport.y,e.width=this._viewport.z,e.height=this._viewport.w):(e.width=t.width,e.height=t.height),e}_createOnRestPromise(e){return e?Promise.resolve():(this._hasRested=!1,this.dispatchEvent({type:"transitionstart"}),new Promise(e=>{let t=()=>{this.removeEventListener("rest",t),e()};this.addEventListener("rest",t)}))}_addAllEventListeners(e){}_removeAllEventListeners(){}get dampingFactor(){return console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead."),0}set dampingFactor(e){console.warn(".dampingFactor has been deprecated. use smoothTime (in seconds) instead.")}get draggingDampingFactor(){return console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead."),0}set draggingDampingFactor(e){console.warn(".draggingDampingFactor has been deprecated. use draggingSmoothTime (in seconds) instead.")}static createBoundingSphere(e,r=new t.Sphere){let i=r.center;g.makeEmpty(),e.traverseVisible(e=>{e.isMesh&&g.expandByObject(e)}),g.getCenter(i);let n=0;return e.traverseVisible(e=>{if(!e.isMesh||!e.geometry)return;let t=e.geometry.clone();t.applyMatrix4(e.matrixWorld);let r=t.attributes.position;for(let e=0,t=r.count;e<t;e++)o.fromBufferAttribute(r,e),n=Math.max(n,i.distanceToSquared(o))}),r.radius=Math.sqrt(n),r}}function e2(){return(e2=Object.assign.bind()).apply(null,arguments)}e.s([],4156),e.i(4156);var e3,e4,e5,e6,e8,e9,e7,te,tt,tr,ti,tn,ta,to,ts,tl,tc,th,tu,tA,td,tf,tm,tp,tg,tv,ty,tx,tE,tC=e.i(71645),tB=e.i(88014),tw=e.i(90072),tI=e.i(94848),tI=tI,tb=e.i(1899);let t_=new tw.Vector3,tM=new tw.Vector3,tS=new tw.Vector3,tT=new tw.Vector2;function tD(e,t,r){let i=t_.setFromMatrixPosition(e.matrixWorld);i.project(t);let n=r.width/2,a=r.height/2;return[i.x*n+n,-(i.y*a)+a]}let tF=e=>1e-10>Math.abs(e)?0:e;function tR(e,t,r=""){let i="matrix3d(";for(let r=0;16!==r;r++)i+=tF(t[r]*e.elements[r])+(15!==r?",":")");return r+i}let tP=(j=[1,-1,1,1,1,-1,1,1,1,-1,1,1,1,-1,1,1],e=>tR(e,j)),tQ=(J=e=>[1/e,1/e,1/e,1,-1/e,-1/e,-1/e,-1,1/e,1/e,1/e,1,1,1,1,1],(e,t)=>tR(e,J(t),"translate(-50%,-50%)")),tU=tC.forwardRef(({children:e,eps:t=.001,style:r,className:i,prepend:n,center:a,fullscreen:o,portal:s,distanceFactor:l,sprite:c=!1,transform:h=!1,occlude:u,onOcclude:A,castShadow:d,receiveShadow:f,material:m,geometry:p,zIndexRange:g=[0x1000037,0],calculatePosition:v=tD,as:y="div",wrapperClass:x,pointerEvents:E="auto",...C},B)=>{let{gl:w,camera:I,scene:b,size:_,raycaster:M,events:S,viewport:T}=(0,tI.C)(),[D]=tC.useState(()=>document.createElement(y)),F=tC.useRef(null),R=tC.useRef(null),P=tC.useRef(0),Q=tC.useRef([0,0]),U=tC.useRef(null),z=tC.useRef(null),k=(null==s?void 0:s.current)||S.connected||w.domElement.parentNode,L=tC.useRef(null),O=tC.useRef(!1),G=tC.useMemo(()=>{var e;return u&&"blending"!==u||Array.isArray(u)&&u.length&&(e=u[0])&&"object"==typeof e&&"current"in e},[u]);tC.useLayoutEffect(()=>{let e=w.domElement;u&&"blending"===u?(e.style.zIndex=`${Math.floor(g[0]/2)}`,e.style.position="absolute",e.style.pointerEvents="none"):(e.style.zIndex=null,e.style.position=null,e.style.pointerEvents=null)},[u]),tC.useLayoutEffect(()=>{if(R.current){let e=F.current=tB.createRoot(D);if(b.updateMatrixWorld(),h)D.style.cssText="position:absolute;top:0;left:0;pointer-events:none;overflow:hidden;";else{let e=v(R.current,I,_);D.style.cssText=`position:absolute;top:0;left:0;transform:translate3d(${e[0]}px,${e[1]}px,0);transform-origin:0 0;`}return k&&(n?k.prepend(D):k.appendChild(D)),()=>{k&&k.removeChild(D),e.unmount()}}},[k,h]),tC.useLayoutEffect(()=>{x&&(D.className=x)},[x]);let N=tC.useMemo(()=>h?{position:"absolute",top:0,left:0,width:_.width,height:_.height,transformStyle:"preserve-3d",pointerEvents:"none"}:{position:"absolute",transform:a?"translate3d(-50%,-50%,0)":"none",...o&&{top:-_.height/2,left:-_.width/2,width:_.width,height:_.height},...r},[r,a,o,_,h]),H=tC.useMemo(()=>({position:"absolute",pointerEvents:E}),[E]);tC.useLayoutEffect(()=>{var t,n;O.current=!1,h?null==(t=F.current)||t.render(tC.createElement("div",{ref:U,style:N},tC.createElement("div",{ref:z,style:H},tC.createElement("div",{ref:B,className:i,style:r,children:e})))):null==(n=F.current)||n.render(tC.createElement("div",{ref:B,style:N,className:i,children:e}))});let V=tC.useRef(!0);(0,tb.useFrame)(e=>{if(R.current){I.updateMatrixWorld(),R.current.updateWorldMatrix(!0,!1);let e=h?Q.current:v(R.current,I,_);if(h||Math.abs(P.current-I.zoom)>t||Math.abs(Q.current[0]-e[0])>t||Math.abs(Q.current[1]-e[1])>t){var r;let t,i,n,a,o=(r=R.current,t=t_.setFromMatrixPosition(r.matrixWorld),i=tM.setFromMatrixPosition(I.matrixWorld),n=t.sub(i),a=I.getWorldDirection(tS),n.angleTo(a)>Math.PI/2),s=!1;G&&(Array.isArray(u)?s=u.map(e=>e.current):"blending"!==u&&(s=[b]));let d=V.current;s?V.current=function(e,t,r,i){let n=t_.setFromMatrixPosition(e.matrixWorld),a=n.clone();a.project(t),tT.set(a.x,a.y),r.setFromCamera(tT,t);let o=r.intersectObjects(i,!0);if(o.length){let e=o[0].distance;return n.distanceTo(r.ray.origin)<e}return!0}(R.current,I,M,s)&&!o:V.current=!o,d!==V.current&&(A?A(!V.current):D.style.display=V.current?"block":"none");let f=Math.floor(g[0]/2),m=u?G?[g[0],f]:[f-1,0]:g;if(D.style.zIndex=`${function(e,t,r){if(t instanceof tw.PerspectiveCamera||t instanceof tw.OrthographicCamera){let i=t_.setFromMatrixPosition(e.matrixWorld),n=tM.setFromMatrixPosition(t.matrixWorld),a=i.distanceTo(n),o=(r[1]-r[0])/(t.far-t.near),s=r[1]-o*t.far;return Math.round(o*a+s)}}(R.current,I,m)}`,h){let[e,t]=[_.width/2,_.height/2],r=I.projectionMatrix.elements[5]*t,{isOrthographicCamera:i,top:n,left:a,bottom:o,right:s}=I,h=tP(I.matrixWorldInverse),u=i?`scale(${r})translate(${tF(-(s+a)/2)}px,${tF((n+o)/2)}px)`:`translateZ(${r}px)`,A=R.current.matrixWorld;c&&((A=I.matrixWorldInverse.clone().transpose().copyPosition(A).scale(R.current.scale)).elements[3]=A.elements[7]=A.elements[11]=0,A.elements[15]=1),D.style.width=_.width+"px",D.style.height=_.height+"px",D.style.perspective=i?"":`${r}px`,U.current&&z.current&&(U.current.style.transform=`${u}${h}translate(${e}px,${t}px)`,z.current.style.transform=tQ(A,1/((l||10)/400)))}else{let t=void 0===l?1:function(e,t){if(t instanceof tw.OrthographicCamera)return t.zoom;if(!(t instanceof tw.PerspectiveCamera))return 1;{let r=t_.setFromMatrixPosition(e.matrixWorld),i=tM.setFromMatrixPosition(t.matrixWorld);return 1/(2*Math.tan(t.fov*Math.PI/180/2)*r.distanceTo(i))}}(R.current,I)*l;D.style.transform=`translate3d(${e[0]}px,${e[1]}px,0) scale(${t})`}Q.current=e,P.current=I.zoom}}if(!G&&L.current&&!O.current)if(h){if(U.current){let e=U.current.children[0];if(null!=e&&e.clientWidth&&null!=e&&e.clientHeight){let{isOrthographicCamera:t}=I;if(t||p)C.scale&&(Array.isArray(C.scale)?C.scale instanceof tw.Vector3?L.current.scale.copy(C.scale.clone().divideScalar(1)):L.current.scale.set(1/C.scale[0],1/C.scale[1],1/C.scale[2]):L.current.scale.setScalar(1/C.scale));else{let t=(l||10)/400,r=e.clientWidth*t,i=e.clientHeight*t;L.current.scale.set(r,i,1)}O.current=!0}}}else{let t=D.children[0];if(null!=t&&t.clientWidth&&null!=t&&t.clientHeight){let e=1/T.factor,r=t.clientWidth*e,i=t.clientHeight*e;L.current.scale.set(r,i,1),O.current=!0}L.current.lookAt(e.camera.position)}});let j=tC.useMemo(()=>({vertexShader:h?void 0:`
          /*
            This shader is from the THREE's SpriteMaterial.
            We need to turn the backing plane into a Sprite
            (make it always face the camera) if "transfrom"
            is false.
          */
          #include <common>

          void main() {
            vec2 center = vec2(0., 1.);
            float rotation = 0.0;

            // This is somewhat arbitrary, but it seems to work well
            // Need to figure out how to derive this dynamically if it even matters
            float size = 0.03;

            vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
            vec2 scale;
            scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
            scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );

            bool isPerspective = isPerspectiveMatrix( projectionMatrix );
            if ( isPerspective ) scale *= - mvPosition.z;

            vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale * size;
            vec2 rotatedPosition;
            rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
            rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
            mvPosition.xy += rotatedPosition;

            gl_Position = projectionMatrix * mvPosition;
          }
      `,fragmentShader:`
        void main() {
          gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0);
        }
      `}),[h]);return tC.createElement("group",e2({},C,{ref:R}),u&&!G&&tC.createElement("mesh",{castShadow:d,receiveShadow:f,ref:L},p||tC.createElement("planeGeometry",null),m||tC.createElement("shaderMaterial",{side:tw.DoubleSide,vertexShader:j.vertexShader,fragmentShader:j.fragmentShader})))});var tI=tI;function tz({onChanged:e,portal:t,preventDefault:r=!0,scroll:i=!0,keyCode:n=9}){let a=tC.useRef(0),o=(0,tI.C)(e=>e.setEvents),s=(0,tI.C)(e=>e.get),l=(0,tI.C)(e=>e.gl);return tC.useEffect(()=>{var c;let h,u=[],A=s().events.filter,d=null!=(c=null==t?void 0:t.current)?c:l.domElement.parentNode,f=()=>d&&e&&e(u,Math.round(a.current)%u.length);o({filter:(e,t)=>{let r=[...e];r.length===u.length&&u.every(e=>r.map(e=>e.object.uuid).includes(e.object.uuid))||(a.current=0,u=r,f()),A&&(r=A(r,t));for(let e=0;e<Math.round(a.current)%r.length;e++){let e=r.shift();r=[...r,e]}return r}});let m=e=>{var t,r;a.current=e(a.current),null==(t=s().events.handlers)||t.onPointerCancel(void 0),null==(r=s().events.handlers)||r.onPointerMove(h),f()},p=e=>{(e.keyCode||e.which)===n&&(r&&e.preventDefault(),u.length>1&&m(e=>e+1))},g=e=>{r&&e.preventDefault();let t=0;e||(e=window.event),e.wheelDelta?t=e.wheelDelta/120:e.detail&&(t=-e.detail/3),u.length>1&&m(e=>Math.abs(e-t))},v=e=>h=e;return document.addEventListener("pointermove",v,{passive:!0}),i&&document.addEventListener("wheel",g),void 0!==n&&document.addEventListener("keydown",p),()=>{o({filter:A}),void 0!==n&&document.removeEventListener("keydown",p),i&&document.removeEventListener("wheel",g),document.removeEventListener("pointermove",v)}},[l,s,o,r,i,n]),null}function tk(e,t="pointer",r="auto",i=document.body){tC.useEffect(()=>{if(e)return i.style.cursor=t,()=>void(i.style.cursor=r)},[e])}var tL=e.i(8155);let tO=e=>{let t=(0,tL.createStore)(e),r=e=>(function(e,t=e=>e){let r=tC.default.useSyncExternalStore(e.subscribe,tC.default.useCallback(()=>t(e.getState()),[e,t]),tC.default.useCallback(()=>t(e.getInitialState()),[e,t]));return tC.default.useDebugValue(r),r})(t,e);return Object.assign(r,t),r},tG=e=>e?tO(e):tO,tN=0,tH=tG(e=>(tw.DefaultLoadingManager.onStart=(t,r,i)=>{e({active:!0,item:t,loaded:r,total:i,progress:(r-tN)/(i-tN)*100})},tw.DefaultLoadingManager.onLoad=()=>{e({active:!1})},tw.DefaultLoadingManager.onError=t=>e(e=>({errors:[...e.errors,t]})),tw.DefaultLoadingManager.onProgress=(t,r,i)=>{r===i&&(tN=i),e({active:!0,item:t,loaded:r,total:i,progress:(r-tN)/(i-tN)*100||100})},{errors:[],active:!1,progress:0,item:"",loaded:0,total:0}));function tV({children:e}){let t=tH();return tC.createElement(tC.Fragment,null,null==e?void 0:e(t))}let tj=e=>`Loading ${e.toFixed(2)}%`;function tJ({containerStyles:e,innerStyles:t,barStyles:r,dataStyles:i,dataInterpolation:n=tj,initialState:a=e=>e}){let{active:o,progress:s}=tH(),l=tC.useRef(0),c=tC.useRef(0),h=tC.useRef(null),[u,A]=tC.useState(a(o));tC.useEffect(()=>{let e;return o!==u&&(e=setTimeout(()=>A(o),300)),()=>clearTimeout(e)},[u,o]);let d=tC.useCallback(()=>{h.current&&(l.current+=(s-l.current)/2,(l.current>.95*s||100===s)&&(l.current=s),h.current.innerText=n(l.current),l.current<s&&(c.current=requestAnimationFrame(d)))},[n,s]);return tC.useEffect(()=>(d(),()=>cancelAnimationFrame(c.current)),[d]),u?tC.createElement("div",{style:{...tY.container,opacity:+!!o,...e}},tC.createElement("div",null,tC.createElement("div",{style:{...tY.inner,...t}},tC.createElement("div",{style:{...tY.bar,transform:`scaleX(${s/100})`,...r}}),tC.createElement("span",{ref:h,style:{...tY.data,...i}})))):null}let tY={container:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"#171717",display:"flex",alignItems:"center",justifyContent:"center",transition:"opacity 300ms ease",zIndex:1e3},inner:{width:100,height:3,background:"#272727",textAlign:"center"},bar:{height:3,width:"100%",background:"white",transition:"transform 200ms",transformOrigin:"left center"},data:{display:"inline-block",position:"relative",fontVariantNumeric:"tabular-nums",marginTop:"0.8em",color:"#f0f0f0",fontSize:"0.6em",fontFamily:'-apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", "Helvetica Neue", Helvetica, Arial, Roboto, Ubuntu, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol"',whiteSpace:"nowrap"}};var tI=tI;e.i(47167);let tW={toVector:(e,t)=>(void 0===e&&(e=t),Array.isArray(e)?e:[e,e]),add:(e,t)=>[e[0]+t[0],e[1]+t[1]],sub:(e,t)=>[e[0]-t[0],e[1]-t[1]],addTo(e,t){e[0]+=t[0],e[1]+=t[1]},subTo(e,t){e[0]-=t[0],e[1]-=t[1]}};function tK(e,t,r){return 0===t||Math.abs(t)===1/0?Math.pow(e,5*r):e*t*r/(t+r*e)}function tX(e,t,r,i=.15){return 0===i?Math.max(t,Math.min(e,r)):e<t?-tK(t-e,r-t,i)+t:e>r?+tK(e-r,r-t,i)+r:e}function tq(e,t,r){var i;return(t="symbol"==typeof(i=function(e,t){if("object"!=typeof e||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(t,"string"))?i:String(i))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function tZ(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,i)}return r}function t$(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?tZ(Object(r),!0).forEach(function(t){tq(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tZ(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}let t1={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function t0(e){return e?e[0].toUpperCase()+e.slice(1):""}let t2=["enter","leave"],t3=["gotpointercapture","lostpointercapture"];function t4(e){return"touches"in e}function t5(e){return t4(e)?"touch":"pointerType"in e?e.pointerType:"mouse"}function t6(e){return t4(e)?("touchend"===e.type||"touchcancel"===e.type?e.changedTouches:e.targetTouches)[0]:e}function t8(e,t){try{let r=t.clientX-e.clientX,i=t.clientY-e.clientY,n=(t.clientX+e.clientX)/2,a=(t.clientY+e.clientY)/2,o=Math.hypot(r,i);return{angle:-(180*Math.atan2(r,i))/Math.PI,distance:o,origin:[n,a]}}catch(e){}return null}function t9(e,t){let[r,i]=Array.from(e.touches).filter(e=>t.includes(e.identifier));return t8(r,i)}function t7(e){let t=t6(e);return t4(e)?t.identifier:t.pointerId}function re(e){let t=t6(e);return[t.clientX,t.clientY]}function rt(e){let{deltaX:t,deltaY:r,deltaMode:i}=e;return 1===i?(t*=40,r*=40):2===i&&(t*=800,r*=800),[t,r]}function rr(e,...t){return"function"==typeof e?e(...t):e}function ri(){}function rn(e,t){return Object.assign({},t,e||{})}class ra{constructor(e,t,r){this.ctrl=e,this.args=t,this.key=r,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){let{state:e,shared:t,ingKey:r,args:i}=this;t[r]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=i,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){let t=this.state,r=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=r.from?rr(r.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){let t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){let e=this.state;e._initial=e._values,e.initial=e.values}compute(e){let{state:t,config:r,shared:i}=this;t.args=this.args;let n=0;if(e&&(t.event=e,r.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,i.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,i.locked=!!document.pointerLockElement,Object.assign(i,function(e){let t={};if("buttons"in e&&(t.buttons=e.buttons),"shiftKey"in e){let{shiftKey:r,altKey:i,metaKey:n,ctrlKey:a}=e;Object.assign(t,{shiftKey:r,altKey:i,metaKey:n,ctrlKey:a})}return t}(e)),i.down=i.pressed=i.buttons%2==1||i.touches>0,n=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){let e=t._delta.map(Math.abs);tW.addTo(t._distance,e)}this.axisIntent&&this.axisIntent(e);let[a,o]=t._movement,[s,l]=r.threshold,{_step:c,values:h}=t;if(r.hasCustomTransform?(!1===c[0]&&(c[0]=Math.abs(a)>=s&&h[0]),!1===c[1]&&(c[1]=Math.abs(o)>=l&&h[1])):(!1===c[0]&&(c[0]=Math.abs(a)>=s&&Math.sign(a)*s),!1===c[1]&&(c[1]=Math.abs(o)>=l&&Math.sign(o)*l)),t.intentional=!1!==c[0]||!1!==c[1],!t.intentional)return;let u=[0,0];if(r.hasCustomTransform){let[e,t]=h;u[0]=!1!==c[0]?e-c[0]:0,u[1]=!1!==c[1]?t-c[1]:0}else u[0]=!1!==c[0]?a-c[0]:0,u[1]=!1!==c[1]?o-c[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(u);let A=t.offset,d=t._active&&!t._blocked||t.active;d&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=i[this.ingKey]=t._active,e&&(t.first&&("bounds"in r&&(t._bounds=rr(r.bounds,t)),this.setup&&this.setup()),t.movement=u,this.computeOffset()));let[f,m]=t.offset,[[p,g],[v,y]]=t._bounds;t.overflow=[f<p?-1:+(f>g),m<v?-1:+(m>y)],t._movementBound[0]=!!t.overflow[0]&&(!1===t._movementBound[0]?t._movement[0]:t._movementBound[0]),t._movementBound[1]=!!t.overflow[1]&&(!1===t._movementBound[1]?t._movement[1]:t._movementBound[1]);let x=t._active&&r.rubberband||[0,0];if(t.offset=function(e,[t,r],[i,n]){let[[a,o],[s,l]]=e;return[tX(t,a,o,i),tX(r,s,l,n)]}(t._bounds,t.offset,x),t.delta=tW.sub(t.offset,A),this.computeMovement(),d&&(!t.last||n>32)){t.delta=tW.sub(t.offset,A);let e=t.delta.map(Math.abs);tW.addTo(t.distance,e),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&n>0&&(t.velocity=[e[0]/n,e[1]/n],t.timeDelta=n)}}emit(){let e=this.state,t=this.shared,r=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!r.triggerAllEvents)return;let i=this.handler(t$(t$(t$({},t),e),{},{[this.aliasKey]:e.values}));void 0!==i&&(e.memo=i)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}class ro extends ra{constructor(...e){super(...e),tq(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=tW.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=tW.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){let t=this.state,r=this.config;if(!t.axis&&e){let i="object"==typeof r.axisThreshold?r.axisThreshold[t5(e)]:r.axisThreshold;t.axis=function([e,t],r){let i=Math.abs(e),n=Math.abs(t);return i>n&&i>r?"x":n>i&&n>r?"y":void 0}(t._movement,i)}t._blocked=(r.lockDirection||!!r.axis)&&!t.axis||!!r.axis&&r.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0}}}let rs=e=>e,rl={enabled:(e=!0)=>e,eventOptions:(e,t,r)=>t$(t$({},r.shared.eventOptions),e),preventDefault:(e=!1)=>e,triggerAllEvents:(e=!1)=>e,rubberband(e=0){switch(e){case!0:return[.15,.15];case!1:return[0,0];default:return tW.toVector(e)}},from:e=>"function"==typeof e?e:null!=e?tW.toVector(e):void 0,transform(e,t,r){let i=e||r.shared.transform;return this.hasCustomTransform=!!i,i||rs},threshold:e=>tW.toVector(e,0)},rc=0,rh=t$(t$({},rl),{},{axis(e,t,{axis:r}){if(this.lockDirection="lock"===r,!this.lockDirection)return r},axisThreshold:(e=rc)=>e,bounds(e={}){if("function"==typeof e)return t=>rh.bounds(e(t));if("current"in e)return()=>e.current;if("function"==typeof HTMLElement&&e instanceof HTMLElement)return e;let{left:t=-1/0,right:r=1/0,top:i=-1/0,bottom:n=1/0}=e;return[[t,r],[i,n]]}}),ru={ArrowRight:(e,t=1)=>[e*t,0],ArrowLeft:(e,t=1)=>[-1*e*t,0],ArrowUp:(e,t=1)=>[0,-1*e*t],ArrowDown:(e,t=1)=>[0,e*t]},rA="undefined"!=typeof window&&window.document&&window.document.createElement;function rd(){return rA&&"ontouchstart"in window}let rf={isBrowser:rA,gesture:function(){try{return"constructor"in GestureEvent}catch(e){return!1}}(),touch:rd(),touchscreen:rd()||rA&&window.navigator.maxTouchPoints>1,pointer:rA&&"onpointerdown"in window,pointerLock:rA&&"exitPointerLock"in window.document},rm=10,rp={mouse:0,touch:0,pen:8},rg=t$(t$({},rh),{},{device(e,t,{pointer:{touch:r=!1,lock:i=!1,mouse:n=!1}={}}){return(this.pointerLock=i&&rf.pointerLock,rf.touch&&r)?"touch":this.pointerLock?"mouse":rf.pointer&&!n?"pointer":rf.touch?"touch":"mouse"},preventScrollAxis(e,t,{preventScroll:r}){if(this.preventScrollDelay="number"==typeof r?r:r||void 0===r&&e?250:void 0,rf.touchscreen&&!1!==r)return e||(void 0!==r?"y":void 0)},pointerCapture(e,t,{pointer:{capture:r=!0,buttons:i=1,keys:n=!0}={}}){return this.pointerButtons=i,this.keys=n,!this.pointerLock&&"pointer"===this.device&&r},threshold(e,t,{filterTaps:r=!1,tapsThreshold:i=3,axis:n}){let a=tW.toVector(e,r?i:+!!n);return this.filterTaps=r,this.tapsThreshold=i,a},swipe({velocity:e=.5,distance:t=50,duration:r=250}={}){return{velocity:this.transform(tW.toVector(e)),distance:this.transform(tW.toVector(t)),duration:r}},delay(e=0){switch(e){case!0:return 180;case!1:return 0;default:return e}},axisThreshold:e=>e?t$(t$({},rp),e):rp,keyboardDisplacement:(e=rm)=>e});function rv(e){let[t,r]=e.overflow,[i,n]=e._delta,[a,o]=e._direction;(t<0&&i>0&&a<0||t>0&&i<0&&a>0)&&(e._movement[0]=e._movementBound[0]),(r<0&&n>0&&o<0||r>0&&n<0&&o>0)&&(e._movement[1]=e._movementBound[1])}let ry=t$(t$({},rl),{},{device(e,t,{shared:r,pointer:{touch:i=!1}={}}){if(r.target&&!rf.touch&&rf.gesture)return"gesture";if(rf.touch&&i)return"touch";if(rf.touchscreen){if(rf.pointer)return"pointer";if(rf.touch)return"touch"}},bounds(e,t,{scaleBounds:r={},angleBounds:i={}}){let n=e=>{let t=rn(rr(r,e),{min:-1/0,max:1/0});return[t.min,t.max]},a=e=>{let t=rn(rr(i,e),{min:-1/0,max:1/0});return[t.min,t.max]};return"function"!=typeof r&&"function"!=typeof i?[n(),a()]:e=>[n(e),a(e)]},threshold(e,t,r){return this.lockDirection="lock"===r.axis,tW.toVector(e,this.lockDirection?[.1,3]:0)},modifierKey:e=>void 0===e?"ctrlKey":e,pinchOnWheel:(e=!0)=>e}),rx=t$(t$({},rh),{},{mouseOnly:(e=!0)=>e}),rE=t$(t$({},rh),{},{mouseOnly:(e=!0)=>e}),rC=new Map,rB=new Map;function rw(e){rC.set(e.key,e.engine),rB.set(e.key,e.resolver)}let rI={key:"drag",engine:class extends ro{constructor(...e){super(...e),tq(this,"ingKey","dragging")}reset(){super.reset();let e=this.state;e._pointerId=void 0,e._pointerActive=!1,e._keyboardActive=!1,e._preventScroll=!1,e._delayed=!1,e.swipe=[0,0],e.tap=!1,e.canceled=!1,e.cancel=this.cancel.bind(this)}setup(){let e=this.state;if(e._bounds instanceof HTMLElement){let t=e._bounds.getBoundingClientRect(),r=e.currentTarget.getBoundingClientRect(),i={left:t.left-r.left+e.offset[0],right:t.right-r.right+e.offset[0],top:t.top-r.top+e.offset[1],bottom:t.bottom-r.bottom+e.offset[1]};e._bounds=rh.bounds(i)}}cancel(){let e=this.state;e.canceled||(e.canceled=!0,e._active=!1,setTimeout(()=>{this.compute(),this.emit()},0))}setActive(){this.state._active=this.state._pointerActive||this.state._keyboardActive}clean(){this.pointerClean(),this.state._pointerActive=!1,this.state._keyboardActive=!1,super.clean()}pointerDown(e){let t=this.config,r=this.state;if(null!=e.buttons&&(Array.isArray(t.pointerButtons)?!t.pointerButtons.includes(e.buttons):-1!==t.pointerButtons&&t.pointerButtons!==e.buttons))return;let i=this.ctrl.setEventIds(e);t.pointerCapture&&e.target.setPointerCapture(e.pointerId),i&&i.size>1&&r._pointerActive||(this.start(e),this.setupPointer(e),r._pointerId=t7(e),r._pointerActive=!0,this.computeValues(re(e)),this.computeInitial(),t.preventScrollAxis&&"mouse"!==t5(e)?(r._active=!1,this.setupScrollPrevention(e)):t.delay>0?(this.setupDelayTrigger(e),t.triggerAllEvents&&(this.compute(e),this.emit())):this.startPointerDrag(e))}startPointerDrag(e){let t=this.state;t._active=!0,t._preventScroll=!0,t._delayed=!1,this.compute(e),this.emit()}pointerMove(e){let t=this.state,r=this.config;if(!t._pointerActive)return;let i=t7(e);if(void 0!==t._pointerId&&i!==t._pointerId)return;let n=re(e);if(document.pointerLockElement===e.target?t._delta=[e.movementX,e.movementY]:(t._delta=tW.sub(n,t._values),this.computeValues(n)),tW.addTo(t._movement,t._delta),this.compute(e),t._delayed&&t.intentional){this.timeoutStore.remove("dragDelay"),t.active=!1,this.startPointerDrag(e);return}if(r.preventScrollAxis&&!t._preventScroll)if(!t.axis)return;else if(t.axis===r.preventScrollAxis||"xy"===r.preventScrollAxis){t._active=!1,this.clean();return}else{this.timeoutStore.remove("startPointerDrag"),this.startPointerDrag(e);return}this.emit()}pointerUp(e){this.ctrl.setEventIds(e);try{this.config.pointerCapture&&e.target.hasPointerCapture(e.pointerId)&&e.target.releasePointerCapture(e.pointerId)}catch(e){}let t=this.state,r=this.config;if(!t._active||!t._pointerActive)return;let i=t7(e);if(void 0!==t._pointerId&&i!==t._pointerId)return;this.state._pointerActive=!1,this.setActive(),this.compute(e);let[n,a]=t._distance;if(t.tap=n<=r.tapsThreshold&&a<=r.tapsThreshold,t.tap&&r.filterTaps)t._force=!0;else{let[e,i]=t._delta,[n,a]=t._movement,[o,s]=r.swipe.velocity,[l,c]=r.swipe.distance,h=r.swipe.duration;if(t.elapsedTime<h){let r=Math.abs(e/t.timeDelta),h=Math.abs(i/t.timeDelta);r>o&&Math.abs(n)>l&&(t.swipe[0]=Math.sign(e)),h>s&&Math.abs(a)>c&&(t.swipe[1]=Math.sign(i))}}this.emit()}pointerClick(e){!this.state.tap&&e.detail>0&&(e.preventDefault(),e.stopPropagation())}setupPointer(e){let t=this.config,r=t.device;t.pointerLock&&e.currentTarget.requestPointerLock(),t.pointerCapture||(this.eventStore.add(this.sharedConfig.window,r,"change",this.pointerMove.bind(this)),this.eventStore.add(this.sharedConfig.window,r,"end",this.pointerUp.bind(this)),this.eventStore.add(this.sharedConfig.window,r,"cancel",this.pointerUp.bind(this)))}pointerClean(){this.config.pointerLock&&document.pointerLockElement===this.state.currentTarget&&document.exitPointerLock()}preventScroll(e){this.state._preventScroll&&e.cancelable&&e.preventDefault()}setupScrollPrevention(e){var t;this.state._preventScroll=!1,"persist"in(t=e)&&"function"==typeof t.persist&&t.persist();let r=this.eventStore.add(this.sharedConfig.window,"touch","change",this.preventScroll.bind(this),{passive:!1});this.eventStore.add(this.sharedConfig.window,"touch","end",r),this.eventStore.add(this.sharedConfig.window,"touch","cancel",r),this.timeoutStore.add("startPointerDrag",this.startPointerDrag.bind(this),this.config.preventScrollDelay,e)}setupDelayTrigger(e){this.state._delayed=!0,this.timeoutStore.add("dragDelay",()=>{this.state._step=[0,0],this.startPointerDrag(e)},this.config.delay)}keyDown(e){let t=ru[e.key];if(t){let r=this.state,i=e.shiftKey?10:e.altKey?.1:1;this.start(e),r._delta=t(this.config.keyboardDisplacement,i),r._keyboardActive=!0,tW.addTo(r._movement,r._delta),this.compute(e),this.emit()}}keyUp(e){e.key in ru&&(this.state._keyboardActive=!1,this.setActive(),this.compute(e),this.emit())}bind(e){let t=this.config.device;e(t,"start",this.pointerDown.bind(this)),this.config.pointerCapture&&(e(t,"change",this.pointerMove.bind(this)),e(t,"end",this.pointerUp.bind(this)),e(t,"cancel",this.pointerUp.bind(this)),e("lostPointerCapture","",this.pointerUp.bind(this))),this.config.keys&&(e("key","down",this.keyDown.bind(this)),e("key","up",this.keyUp.bind(this))),this.config.filterTaps&&e("click","",this.pointerClick.bind(this),{capture:!0,passive:!1})}},resolver:rg},rb={key:"hover",engine:class extends ro{constructor(...e){super(...e),tq(this,"ingKey","hovering")}enter(e){this.config.mouseOnly&&"mouse"!==e.pointerType||(this.start(e),this.computeValues(re(e)),this.compute(e),this.emit())}leave(e){if(this.config.mouseOnly&&"mouse"!==e.pointerType)return;let t=this.state;if(!t._active)return;t._active=!1;let r=re(e);t._movement=t._delta=tW.sub(r,t._values),this.computeValues(r),this.compute(e),t.delta=t.movement,this.emit()}bind(e){e("pointer","enter",this.enter.bind(this)),e("pointer","leave",this.leave.bind(this))}},resolver:rE},r_={key:"move",engine:class extends ro{constructor(...e){super(...e),tq(this,"ingKey","moving")}move(e){this.config.mouseOnly&&"mouse"!==e.pointerType||(this.state._active?this.moveChange(e):this.moveStart(e),this.timeoutStore.add("moveEnd",this.moveEnd.bind(this)))}moveStart(e){this.start(e),this.computeValues(re(e)),this.compute(e),this.computeInitial(),this.emit()}moveChange(e){if(!this.state._active)return;let t=re(e),r=this.state;r._delta=tW.sub(t,r._values),tW.addTo(r._movement,r._delta),this.computeValues(t),this.compute(e),this.emit()}moveEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}bind(e){e("pointer","change",this.move.bind(this)),e("pointer","leave",this.moveEnd.bind(this))}},resolver:rx},rM={key:"pinch",engine:class extends ra{constructor(...e){super(...e),tq(this,"ingKey","pinching"),tq(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();let e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){let{type:e,movement:t,lastOffset:r}=this.state;"wheel"===e?this.state.offset=tW.add(t,r):this.state.offset=[(1+t[0])*r[0],t[1]+r[1]]}computeMovement(){let{offset:e,lastOffset:t}=this.state;this.state.movement=[e[0]/t[0],e[1]-t[1]]}axisIntent(){let e=this.state,[t,r]=e._movement;if(!e.axis){let i=30*Math.abs(t)-Math.abs(r);i<0?e.axis="angle":i>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&("scale"===this.state.axis?e[1]=0:"angle"===this.state.axis&&(e[0]=0))}cancel(){let e=this.state;e.canceled||setTimeout(()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()},0)}touchStart(e){this.ctrl.setEventIds(e);let t=this.state,r=this.ctrl.touchIds;if(t._active&&t._touchIds.every(e=>r.has(e))||r.size<2)return;this.start(e),t._touchIds=Array.from(r).slice(0,2);let i=t9(e,t._touchIds);i&&this.pinchStart(e,i)}pointerStart(e){if(null!=e.buttons&&e.buttons%2!=1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);let t=this.state,r=t._pointerEvents,i=this.ctrl.pointerIds;if(t._active&&Array.from(r.keys()).every(e=>i.has(e))||(r.size<2&&r.set(e.pointerId,e),t._pointerEvents.size<2))return;this.start(e);let n=t8(...Array.from(r.values()));n&&this.pinchStart(e,n)}pinchStart(e,t){this.state.origin=t.origin,this.computeValues([t.distance,t.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;let t=t9(e,this.state._touchIds);t&&this.pinchMove(e,t)}pointerMove(e){let t=this.state._pointerEvents;if(t.has(e.pointerId)&&t.set(e.pointerId,e),!this.state._active)return;let r=t8(...Array.from(t.values()));r&&this.pinchMove(e,r)}pinchMove(e,t){let r=this.state,i=r._values[1],n=t.angle-i,a=0;Math.abs(n)>270&&(a+=Math.sign(n)),this.computeValues([t.distance,t.angle-360*a]),r.origin=t.origin,r.turns=a,r._movement=[r._values[0]/r._initial[0]-1,r._values[1]-r._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some(e=>!this.ctrl.touchIds.has(e))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){let t=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch(e){}t._pointerEvents.has(e.pointerId)&&t._pointerEvents.delete(e.pointerId),t._active&&t._pointerEvents.size<2&&(t._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();let t=this.state;t._active||(this.start(e),this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;let t=this.state;this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY];let r=t._movement;t._movement=[e.scale-1,e.rotation],t._delta=tW.sub(t._movement,r),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){let t=this.config.modifierKey;(!t||(Array.isArray(t)?t.find(t=>e[t]):e[t]))&&(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||e.cancelable&&e.preventDefault();let t=this.state;t._delta=[-rt(e)[1]/100*t.offset[0],0],tW.addTo(t._movement,t._delta),rv(t),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){let t=this.config.device;t&&(e(t,"start",this[t+"Start"].bind(this)),e(t,"change",this[t+"Move"].bind(this)),e(t,"end",this[t+"End"].bind(this)),e(t,"cancel",this[t+"End"].bind(this)),e("lostPointerCapture","",this[t+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}},resolver:ry},rS={key:"scroll",engine:class extends ro{constructor(...e){super(...e),tq(this,"ingKey","scrolling")}scroll(e){this.state._active||this.start(e),this.scrollChange(e),this.timeoutStore.add("scrollEnd",this.scrollEnd.bind(this))}scrollChange(e){e.cancelable&&e.preventDefault();let t=this.state,r=function(e){var t,r;let{scrollX:i,scrollY:n,scrollLeft:a,scrollTop:o}=e.currentTarget;return[null!=(t=null!=i?i:a)?t:0,null!=(r=null!=n?n:o)?r:0]}(e);t._delta=tW.sub(r,t._values),tW.addTo(t._movement,t._delta),this.computeValues(r),this.compute(e),this.emit()}scrollEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("scroll","",this.scroll.bind(this))}},resolver:rh},rT={key:"wheel",engine:class extends ro{constructor(...e){super(...e),tq(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){let t=this.state;t._delta=rt(e),tW.addTo(t._movement,t._delta),rv(t),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}},resolver:rh},rD={target(e){if(e)return()=>"current"in e?e.current:e},enabled:(e=!0)=>e,window:(e=rf.isBrowser?window:void 0)=>e,eventOptions:({passive:e=!0,capture:t=!1}={})=>({passive:e,capture:t}),transform:e=>e},rF=["target","eventOptions","window","enabled","transform"];function rR(e={},t){let r={};for(let[i,n]of Object.entries(t))switch(typeof n){case"function":r[i]=n.call(r,e[i],i,e);break;case"object":r[i]=rR(e[i],n);break;case"boolean":n&&(r[i]=e[i])}return r}class rP{constructor(e,t){tq(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,r,i,n){let a=this._listeners,o=function(e,t=""){let r=t1[e];return e+(r&&r[t]||t)}(t,r),s=t$(t$({},this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{}),n);e.addEventListener(o,i,s);let l=()=>{e.removeEventListener(o,i,s),a.delete(l)};return a.add(l),l}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class rQ{constructor(){tq(this,"_timeouts",new Map)}add(e,t,r=140,...i){this.remove(e),this._timeouts.set(e,window.setTimeout(t,r,...i))}remove(e){let t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}class rU{constructor(e){tq(this,"gestures",new Set),tq(this,"_targetEventStore",new rP(this)),tq(this,"gestureEventStores",{}),tq(this,"gestureTimeoutStores",{}),tq(this,"handlers",{}),tq(this,"config",{}),tq(this,"pointerIds",new Set),tq(this,"touchIds",new Set),tq(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),function(e,t){t.drag&&rz(e,"drag"),t.wheel&&rz(e,"wheel"),t.scroll&&rz(e,"scroll"),t.move&&rz(e,"move"),t.pinch&&rz(e,"pinch"),t.hover&&rz(e,"hover")}(this,e)}setEventIds(e){if(t4(e))return this.touchIds=new Set(Array.from(e.touches).filter(t=>{var r,i;return t.target===e.currentTarget||(null==(r=e.currentTarget)||null==(i=r.contains)?void 0:i.call(r,t.target))}).map(e=>e.identifier)),this.touchIds;if("pointerId"in e)return"pointerup"===e.type||"pointercancel"===e.type?this.pointerIds.delete(e.pointerId):"pointerdown"===e.type&&this.pointerIds.add(e.pointerId),this.pointerIds}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=function(e,t,r={}){let{target:i,eventOptions:n,window:a,enabled:o,transform:s}=e,l=function(e,t){if(null==e)return{};var r,i,n=function(e,t){if(null==e)return{};var r,i,n={},a=Object.keys(e);for(i=0;i<a.length;i++)r=a[i],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)r=a[i],!(t.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}(e,rF);if(r.shared=rR({target:i,eventOptions:n,window:a,enabled:o,transform:s},rD),t){let e=rB.get(t);r[t]=rR(t$({shared:r.shared},l),e)}else for(let e in l){let t=rB.get(e);t&&(r[e]=rR(t$({shared:r.shared},l[e]),t))}return r}(e,t,this.config)}clean(){for(let e of(this._targetEventStore.clean(),this.gestures))this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){let t,r=this.config.shared,i={};if(!r.target||(t=r.target())){if(r.enabled){for(let r of this.gestures){let n=this.config[r],a=rk(i,n.eventOptions,!!t);n.enabled&&new(rC.get(r))(this,e,r).bind(a)}let n=rk(i,r.eventOptions,!!t);for(let t in this.nativeHandlers)n(t,"",r=>this.nativeHandlers[t](t$(t$({},this.state.shared),{},{event:r,args:e})),void 0,!0)}for(let e in i)i[e]=function(...e){return 0===e.length?ri:1===e.length?e[0]:function(){let t;for(let r of e)t=r.apply(this,arguments)||t;return t}}(...i[e]);if(!t)return i;for(let e in i){let{device:r,capture:n,passive:a}=function(e){let t=e.substring(2).toLowerCase(),r=!!~t.indexOf("passive");r&&(t=t.replace("passive",""));let i=t3.includes(t)?"capturecapture":"capture",n=!!~t.indexOf(i);return n&&(t=t.replace("capture","")),{device:t,capture:n,passive:r}}(e);this._targetEventStore.add(t,r,"",i[e],{capture:n,passive:a})}}}}function rz(e,t){e.gestures.add(t),e.gestureEventStores[t]=new rP(e,t),e.gestureTimeoutStores[t]=new rQ}let rk=(e,t,r)=>(i,n,a,o={},s=!1)=>{var l,c;let h=null!=(l=o.capture)?l:t.capture,u=null!=(c=o.passive)?c:t.passive,A=s?i:function(e,t="",r=!1){let i=t1[e],n=i&&i[t]||t;return"on"+t0(e)+t0(n)+(!function(e=!1,t){return e&&!t2.includes(t)}(r,n)?"":"Capture")}(i,n,h);r&&u&&(A+="Passive"),e[A]=e[A]||[],e[A].push(a)},rL=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function rO(e,t,r,i,n,a){if(!e.has(r)||!rC.has(i))return;let o=r+"Start",s=r+"End";n[i]=e=>{let i;return e.first&&o in t&&t[o](e),r in t&&(i=t[r](e)),e.last&&s in t&&t[s](e),i},a[i]=a[i]||{}}function rG(e,t){return([rI,rM,rS,rT,r_,rb].forEach(rw),function(e,t){let{handlers:r,nativeHandlers:i,config:n}=function(e,t){let[r,i,n]=function(e){let t={},r={},i=new Set;for(let n in e)rL.test(n)?(i.add(RegExp.lastMatch),r[n]=e[n]):t[n]=e[n];return[r,t,i]}(e),a={};return rO(n,r,"onDrag","drag",a,t),rO(n,r,"onWheel","wheel",a,t),rO(n,r,"onScroll","scroll",a,t),rO(n,r,"onPinch","pinch",a,t),rO(n,r,"onMove","move",a,t),rO(n,r,"onHover","hover",a,t),{handlers:a,config:t,nativeHandlers:i}}(e,t||{});return function(e,t={},r,i){let n=tC.default.useMemo(()=>new rU(e),[]);if(n.applyHandlers(e,i),n.applyConfig(t,r),tC.default.useEffect(n.effect.bind(n)),tC.default.useEffect(()=>n.clean.bind(n),[]),void 0===t.target)return n.bind.bind(n)}(r,n,void 0,i)})(e,t||{})}e.i(18504);let rN=new tw.Vector3,rH=new tw.Vector2,rV=new tw.Vector3,rj=new tw.Vector3,rJ=new tw.Vector3,rY=new tw.Plane,rW=tC.forwardRef(({autoTransform:e=!0,matrix:t,axisLock:r,dragLimits:i,onHover:n,onDragStart:a,onDrag:o,onDragEnd:s,children:l,dragConfig:c,...h},u)=>{let A=(0,tI.C)(e=>e.controls),{camera:d,size:f,raycaster:m,invalidate:p}=(0,tI.C)(),g=tC.useRef(null),v=rG({onHover:({hovering:e})=>n&&n(null!=e&&e),onDragStart:({event:e})=>{A&&(A.enabled=!1);let{point:t}=e;g.current.matrix.decompose(rN,new tw.Quaternion,new tw.Vector3),rV.copy(t),rj.copy(rV).sub(rN),a&&a(rN),p()},onDrag:({xy:[t,n],intentional:a})=>{if(!a)return;let s=(t-f.left)/f.width*2-1,l=-(2*((n-f.top)/f.height))+1;if(rH.set(s,l),m.setFromCamera(rH,d),r)switch(r){case"x":rJ.set(1,0,0);break;case"y":rJ.set(0,1,0);break;case"z":rJ.set(0,0,1)}else d.getWorldDirection(rJ).negate();rY.setFromNormalAndCoplanarPoint(rJ,rV),m.ray.intersectPlane(rY,rV);let c=g.current.matrix.clone(),h=g.current.matrixWorld.clone(),u=new tw.Vector3(rV.x-rj.x,rV.y-rj.y,rV.z-rj.z);if(i&&(u.x=i[0]?Math.max(Math.min(u.x,i[0][1]),i[0][0]):u.x,u.y=i[1]?Math.max(Math.min(u.y,i[1][1]),i[1][0]):u.y,u.z=i[2]?Math.max(Math.min(u.z,i[2][1]),i[2][0]):u.z),e){g.current.matrix.setPosition(u);let e=g.current.matrix.clone().multiply(c.invert()),t=g.current.matrix.clone().multiply(h.invert());o&&o(g.current.matrix,e,g.current.matrixWorld,t)}else{let e=new tw.Matrix4().copy(g.current.matrix);e.setPosition(u);let t=e.clone().multiply(c.invert()),r=e.clone().multiply(h.invert());o&&o(e,t,g.current.matrixWorld,r)}p()},onDragEnd:()=>{A&&(A.enabled=!0),s&&s(),p()}},{drag:{filterTaps:!0,threshold:1,..."object"==typeof c?c:{}}});return tC.useImperativeHandle(u,()=>g.current,[]),tC.useLayoutEffect(()=>{t&&(g.current.matrix=t)},[t]),tC.createElement("group",e2({ref:g},v(),{matrix:t,matrixAutoUpdate:!1},h),l)});var tI=tI,rK=tI;function rX(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function rq(e,t){return(rq=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function rZ(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],l=t[5],c=t[6],h=t[7],u=t[8];return i*s*u+n*l*c+a*o*h-a*s*c-n*o*u-i*l*h}function r$(e,t){for(var r=[],i=e.toArray(),n=t.toArray(),a=0;a<i.length;a++)r[a]=i[a]+n[a];return new tw.Matrix3().fromArray(r)}function r1(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,i=Array(t);r<t;r++)i[r]=e[r];return i}function r0(e,t){if(e){if("string"==typeof e)return r1(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if("Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return r1(e,t)}}function r2(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r,i,n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);o=!0);}catch(e){s=!0,i=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw i}}return a}}(e,t)||r0(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r3(e){return function(e){if(Array.isArray(e))return r1(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||r0(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r4(e,t,r){return(r4=!function(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}()?function(e,t,r){var i=[null];i.push.apply(i,t);var n=new(Function.bind.apply(e,i));return r&&rq(n,r.prototype),n}:Reflect.construct).apply(null,arguments)}function r5(e){var t=r2(e[0],2),r=t[0],i=t[1],n=r2(e[1],2),a=n[0],o=n[1],s=r2(e[2],2);return rZ(r,i,1,a,o,1,s[0],s[1],1)}var r6=new tw.Vector2,r8=new tw.Vector2;function r9(e){var t=r2(e.map(function(e){return Array.isArray(e)?r4(tw.Vector2,r3(e)):e}),3),r=t[0],i=t[1],n=t[2];if(0===r5(e))return!1;var a=r6.subVectors(i,r);return r8.subVectors(n,r).cross(a)>0}function r7(e,t,r){return Math.max(t,Math.min(r,e))}function ie(e,t){return r7(e-Math.floor(e/t)*t,0,t)}function it(e,t){var r=ie(t-e,2*Math.PI);return r>Math.PI&&(r-=2*Math.PI),r}function ir(e,t){return e.x===t.x?void 0!==e.z&&e.y===t.y?e.z-t.z:e.y-t.y:e.x-t.x}function ii(e,t,r){return(r-e)/(t-e)}function ia(e,t){var r=new tw.Vector3().crossVectors(e,t),i=e.dot(t),n=new tw.Matrix3().identity(),a=new tw.Matrix3().set(0,-r.z,r.y,r.z,0,-r.x,-r.y,r.x,0),o=new tw.Matrix3().multiplyMatrices(a,a).multiplyScalar(1/(1+i));return r$(r$(n,a),o)}var io=Object.freeze({__proto__:null,clamp:r7,repeat:ie,deltaAngle:it,degToRad:function(e){return e/180*Math.PI},radToDeg:function(e){return 180*e/Math.PI},fibonacciOnSphere:function(e,t){for(var r=t.radius,i=void 0===r?1:r,n=e.length/3,a=2/n,o=Math.PI*(3-2.2360679775),s=0;s<e.length;s+=3){var l=s*a-1+a/2,c=Math.sqrt(1-Math.pow(l,2)),h=s%n*o,u=Math.cos(h)*c,A=Math.sin(h)*c;e[s]=u*i,e[s+1]=l*i,e[s+2]=A*i}},vectorEquals:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Number.EPSILON;return Math.abs(e.x-t.x)<r&&Math.abs(e.y-t.y)<r&&Math.abs(e.z-t.z)<r},lexicographic:ir,convexHull:function(e){for(var t=e.sort(ir),r=[t[0],t[1]],i=2;i<t.length;i++)for(r.push(t[i]);r.length>2&&r9(r3(r.slice(-3)));)r.splice(r.length-2,1);for(var n=[t[t.length-1],t[t.length-2]],a=t.length-3;a>=0;a--)for(n.push(t[a]);n.length>2&&r9(r3(n.slice(-3)));)n.splice(n.length-2,1);return n.splice(0,1),n.splice(n.length-1,1),[].concat(r,n)},remap:function(e,t,r){var i=r2(t,2),n=i[0],a=i[1],o=r2(r,2),s=o[0];return s+(e-n)*(o[1]-s)/(a-n)},fade:function(e){return e*e*e*(e*(6*e-15)+10)},lerp:function(e,t,r){return e*(1-r)+t*r},inverseLerp:ii,normalize:function(e,t,r){var i=Math.sqrt(e*e+t*t+r*r);return[e/i,t/i,r/i]},pointOnCubeToPointOnSphere:function(e,t,r){var i=e*e,n=t*t,a=r*r;return[e*Math.sqrt(1-(n+a)/2+n*a/3),t*Math.sqrt(1-(a+i)/2+a*i/3),r*Math.sqrt(1-(i+n)/2+i*n/3)]},rotateVectorOnVector:ia,pointToCoordinate:function(e,t,r){return[Math.asin(t),Math.atan2(e,-r)]},coordinateToPoint:function(e,t){var r=Math.sin(e),i=Math.cos(e);return[Math.sin(t)*i,r,-Math.cos(t)*i]},planeSegmentIntersection:function(e,t){var r=r2(t,2),i=r[0],n=r[1],a=ia(e.normal,new tw.Vector3(0,1,0)),o=ii(i.clone().applyMatrix3(a).y,n.clone().applyMatrix3(a).y,0);return new tw.Vector3().lerpVectors(i,n,o)},pointToPlaneDistance:function(e,t){return t.normal.dot(e)},getIndexFrom3D:function(e,t){var r=r2(e,3),i=r[0],n=r[1],a=r[2],o=r2(t,2),s=o[0];return a*s*o[1]+n*s+i},get3DFromIndex:function(e,t){var r=r2(t,2),i=r[0],n=i*r[1],a=e/n,o=e-n*a;return[o%i,o/i,a]},getIndexFrom2D:function(e,t){return e[0]+t[0]*e[1]},get2DFromIndex:function(e,t){var r=Math.floor(e/t);return[e%t,r]}});function is(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}var il=function e(t,r,i){var n=this;is(this,e),rX(this,"dot2",function(e,t){return n.x*e+n.y*t}),rX(this,"dot3",function(e,t,r){return n.x*e+n.y*t+n.z*r}),this.x=t,this.y=r,this.z=i},ic=[new il(1,1,0),new il(-1,1,0),new il(1,-1,0),new il(-1,-1,0),new il(1,0,1),new il(-1,0,1),new il(1,0,-1),new il(-1,0,-1),new il(0,1,1),new il(0,-1,1),new il(0,1,-1),new il(0,-1,-1)],ih=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],iu=Array(512),iA=Array(512),id=0;(id=Math.floor(id))<256&&(id|=id<<8);for(var im,ip=0;ip<256;ip++)im=1&ip?ih[ip]^255&id:ih[ip]^id>>8&255,iu[ip]=iu[ip+256]=im,iA[ip]=iA[ip+256]=ic[im%12];function ig(e){var t=function(e){if("number"==typeof e)e=Math.abs(e);else if("string"==typeof e){var t=e;e=0;for(var r=0;r<t.length;r++)e=(e+(r+1)*(t.charCodeAt(r)%96))%0x7fffffff}return 0===e&&(e=311),e}(e);return function(){var e=48271*t%0x7fffffff;return t=e,e/0x7fffffff}}new function e(t){var r=this;is(this,e),rX(this,"seed",0),rX(this,"init",function(e){r.seed=e,r.value=ig(e)}),rX(this,"value",ig(this.seed)),this.init(t)}(Math.random());var iv=function(e){return 1/(1+e+.48*e*e+.235*e*e*e)};function iy(e,t,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.25,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.01,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:iv,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:.001,l="velocity_"+t;if(void 0===e.__damp&&(e.__damp={}),void 0===e.__damp[l]&&(e.__damp[l]=0),Math.abs(e[t]-r)<=s)return e[t]=r,!1;var c=2/(i=Math.max(1e-4,i)),h=o(c*n),u=e[t]-r,A=r,d=a*i;u=Math.min(Math.max(u,-d),d),r=e[t]-u;var f=(e.__damp[l]+c*u)*n;e.__damp[l]=(e.__damp[l]-c*f)*h;var m=r+(u+f)*h;return A-e[t]>0==m>A&&(m=A,e.__damp[l]=(m-A)/n),e[t]=m,!0}var ix=new tw.Vector3,iE=new tw.Quaternion,iC=new tw.Quaternion,iB=new tw.Matrix4,iw=new tw.Vector3;function iI(e,t,r,i,n,a,o,s){return iy(e,t,e[t]+it(e[t],r),i,n,a,o,s)}var ib=new tw.Vector2,i_=new tw.Vector3;function iM(e,t,r,i,n,a,o){return"number"==typeof t?i_.setScalar(t):Array.isArray(t)?i_.set(t[0],t[1],t[2]):i_.copy(t),e8=iy(e,"x",i_.x,r,i,n,a,o),e9=iy(e,"y",i_.y,r,i,n,a,o),e7=iy(e,"z",i_.z,r,i,n,a,o),e8||e9||e7}var iS=new tw.Vector4,iT=new tw.Euler,iD=new tw.Color,iF=new tw.Quaternion,iR=new tw.Vector4,iP=new tw.Vector4,iQ=new tw.Vector4;function iU(e,t,r,i,n,a,o){Array.isArray(t)?iF.set(t[0],t[1],t[2],t[3]):iF.copy(t);var s=e.dot(iF)>0?1:-1;return iF.x*=s,iF.y*=s,iF.z*=s,iF.w*=s,th=iy(e,"x",iF.x,r,i,n,a,o),tu=iy(e,"y",iF.y,r,i,n,a,o),tA=iy(e,"z",iF.z,r,i,n,a,o),td=iy(e,"w",iF.w,r,i,n,a,o),iR.set(e.x,e.y,e.z,e.w).normalize(),iP.set(e.__damp.velocity_x,e.__damp.velocity_y,e.__damp.velocity_z,e.__damp.velocity_w),iQ.copy(iR).multiplyScalar(iP.dot(iR)/iR.dot(iR)),e.__damp.velocity_x-=iQ.x,e.__damp.velocity_y-=iQ.y,e.__damp.velocity_z-=iQ.z,e.__damp.velocity_w-=iQ.w,e.set(iR.x,iR.y,iR.z,iR.w),th||tu||tA||td}var iz=new tw.Spherical,ik=new tw.Matrix4,iL=new tw.Vector3,iO=new tw.Quaternion,iG=new tw.Vector3,iN=Object.freeze({__proto__:null,rsqw:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.01,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/(2*Math.PI);return r/Math.atan(1/t)*Math.atan(Math.sin(2*Math.PI*e*i)/t)},exp:iv,linear:function(e){return e},sine:{in:function(e){return 1-Math.cos(e*Math.PI/2)},out:function(e){return Math.sin(e*Math.PI/2)},inOut:function(e){return-(Math.cos(Math.PI*e)-1)/2}},cubic:{in:function(e){return e*e*e},out:function(e){return 1-Math.pow(1-e,3)},inOut:function(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2}},quint:{in:function(e){return e*e*e*e*e},out:function(e){return 1-Math.pow(1-e,5)},inOut:function(e){return e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2}},circ:{in:function(e){return 1-Math.sqrt(1-Math.pow(e,2))},out:function(e){return Math.sqrt(1-Math.pow(e-1,2))},inOut:function(e){return e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2}},quart:{in:function(e){return e*e*e*e},out:function(e){return 1- --e*e*e*e},inOut:function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e}},expo:{in:function(e){return 0===e?0:Math.pow(2,10*e-10)},out:function(e){return 1===e?1:1-Math.pow(2,-10*e)},inOut:function(e){return 0===e?0:1===e?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2}},damp:iy,dampLookAt:function(e,t,r,i,n,a,o){"number"==typeof t?ix.setScalar(t):Array.isArray(t)?ix.set(t[0],t[1],t[2]):ix.copy(t);var s=e.parent;(e.updateWorldMatrix(!0,!1),iw.setFromMatrixPosition(e.matrixWorld),e&&e.isCamera||e&&e.isLight)?iB.lookAt(iw,ix,e.up):iB.lookAt(ix,iw,e.up),iU(e.quaternion,iC.setFromRotationMatrix(iB),r,i,n,a,o),s&&(iB.extractRotation(s.matrixWorld),iE.setFromRotationMatrix(iB),iU(e.quaternion,iC.copy(e.quaternion).premultiply(iE.invert()),r,i,n,a,o))},dampAngle:iI,damp2:function(e,t,r,i,n,a,o){return"number"==typeof t?ib.setScalar(t):Array.isArray(t)?ib.set(t[0],t[1]):ib.copy(t),e5=iy(e,"x",ib.x,r,i,n,a,o),e6=iy(e,"y",ib.y,r,i,n,a,o),e5||e6},damp3:iM,damp4:function(e,t,r,i,n,a,o){return"number"==typeof t?iS.setScalar(t):Array.isArray(t)?iS.set(t[0],t[1],t[2],t[3]):iS.copy(t),te=iy(e,"x",iS.x,r,i,n,a,o),tt=iy(e,"y",iS.y,r,i,n,a,o),tr=iy(e,"z",iS.z,r,i,n,a,o),ti=iy(e,"w",iS.w,r,i,n,a,o),te||tt||tr||ti},dampE:function(e,t,r,i,n,a,o){return Array.isArray(t)?iT.set(t[0],t[1],t[2],t[3]):iT.copy(t),tn=iI(e,"x",iT.x,r,i,n,a,o),ta=iI(e,"y",iT.y,r,i,n,a,o),to=iI(e,"z",iT.z,r,i,n,a,o),tn||ta||to},dampC:function(e,t,r,i,n,a,o){return t instanceof tw.Color?iD.copy(t):Array.isArray(t)?iD.setRGB(t[0],t[1],t[2]):iD.set(t),ts=iy(e,"r",iD.r,r,i,n,a,o),tl=iy(e,"g",iD.g,r,i,n,a,o),tc=iy(e,"b",iD.b,r,i,n,a,o),ts||tl||tc},dampQ:iU,dampS:function(e,t,r,i,n,a,o){return Array.isArray(t)?iz.set(t[0],t[1],t[2]):iz.copy(t),tf=iy(e,"radius",iz.radius,r,i,n,a,o),tm=iI(e,"phi",iz.phi,r,i,n,a,o),tp=iI(e,"theta",iz.theta,r,i,n,a,o),tf||tm||tp},dampM:function(e,t,r,i,n,a,o){return void 0===e.__damp&&(e.__damp={position:new tw.Vector3,rotation:new tw.Quaternion,scale:new tw.Vector3},e.decompose(e.__damp.position,e.__damp.rotation,e.__damp.scale)),Array.isArray(t)?ik.set.apply(ik,r3(t)):ik.copy(t),ik.decompose(iL,iO,iG),tg=iM(e.__damp.position,iL,r,i,n,a,o),tv=iU(e.__damp.rotation,iO,r,i,n,a,o),ty=iM(e.__damp.scale,iG,r,i,n,a,o),e.compose(e.__damp.position,e.__damp.rotation,e.__damp.scale),tg||tv||ty}});tw.BufferGeometry;let iH=tC.createContext(null);function iV(){return tC.useContext(iH)}function ij({eps:e=1e-5,enabled:t=!0,infinite:r,horizontal:i,pages:n=1,distance:a=1,damping:o=.25,maxSpeed:s=1/0,prepend:l=!1,style:c={},children:h}){let{get:u,setEvents:A,gl:d,size:f,invalidate:m,events:p}=(0,tI.C)(),[g]=tC.useState(()=>document.createElement("div")),[v]=tC.useState(()=>document.createElement("div")),[y]=tC.useState(()=>document.createElement("div")),x=d.domElement.parentNode,E=tC.useRef(0),C=tC.useMemo(()=>({el:g,eps:e,fill:v,fixed:y,horizontal:i,damping:o,offset:0,delta:0,scroll:E,pages:n,range(e,t,r=0){let i=e-r,n=i+t+2*r;return this.offset<i?0:this.offset>n?1:(this.offset-i)/(n-i)},curve(e,t,r=0){return Math.sin(this.range(e,t,r)*Math.PI)},visible(e,t,r=0){let i=e-r;return this.offset>=i&&this.offset<=i+t+2*r}}),[e,o,i,n]);tC.useEffect(()=>{for(let e in g.style.position="absolute",g.style.width="100%",g.style.height="100%",g.style[i?"overflowX":"overflowY"]="auto",g.style[i?"overflowY":"overflowX"]="hidden",g.style.top="0px",g.style.left="0px",c)g.style[e]=c[e];y.style.position="sticky",y.style.top="0px",y.style.left="0px",y.style.width="100%",y.style.height="100%",y.style.overflow="hidden",g.appendChild(y),v.style.height=i?"100%":`${n*a*100}%`,v.style.width=i?`${n*a*100}%`:"100%",v.style.pointerEvents="none",g.appendChild(v),l?x.prepend(g):x.appendChild(g),g[i?"scrollLeft":"scrollTop"]=1;let e=p.connected||d.domElement;requestAnimationFrame(()=>null==p.connect?void 0:p.connect(g));let t=u().events.compute;return A({compute(e,t){let{left:r,top:i}=x.getBoundingClientRect(),n=e.clientX-r,a=e.clientY-i;t.pointer.set(n/t.size.width*2-1,-(2*(a/t.size.height))+1),t.raycaster.setFromCamera(t.pointer,t.camera)}}),()=>{x.removeChild(g),A({compute:t}),null==p.connect||p.connect(e)}},[n,a,i,g,v,y,x]),tC.useEffect(()=>{if(p.connected===g){let e=f[i?"width":"height"],n=g[i?"scrollWidth":"scrollHeight"],a=n-e,o=0,s=!0,l=!0,c=()=>{if(t&&!l&&(m(),E.current=(o=g[i?"scrollLeft":"scrollTop"])/a,r)){if(!s){if(o>=a){let e=1-C.offset;g[i?"scrollLeft":"scrollTop"]=1,E.current=C.offset=-e,s=!0}else if(o<=0){let e=1+C.offset;g[i?"scrollLeft":"scrollTop"]=n,E.current=C.offset=e,s=!0}}s&&setTimeout(()=>s=!1,40)}};g.addEventListener("scroll",c,{passive:!0}),requestAnimationFrame(()=>l=!1);let h=e=>g.scrollLeft+=e.deltaY/2;return i&&g.addEventListener("wheel",h,{passive:!0}),()=>{g.removeEventListener("scroll",c),i&&g.removeEventListener("wheel",h)}}},[g,p,f,r,C,m,i,t]);let B=0;return(0,tb.useFrame)((t,r)=>{B=C.offset,iN.damp(C,"offset",E.current,o,r,s,void 0,e),iN.damp(C,"delta",Math.abs(B-C.offset),o,r,s,void 0,e),C.delta>e&&m()}),tC.createElement(iH.Provider,{value:C},h)}let iJ=tC.forwardRef(({children:e},t)=>{let r=tC.useRef(null);tC.useImperativeHandle(t,()=>r.current,[]);let i=iV(),{width:n,height:a}=(0,tI.C)(e=>e.viewport);return(0,tb.useFrame)(()=>{r.current.position.x=i.horizontal?-n*(i.pages-1)*i.offset:0,r.current.position.y=i.horizontal?0:a*(i.pages-1)*i.offset}),tC.createElement("group",{ref:r},e)}),iY=tC.forwardRef(({children:e,style:t,...r},i)=>{let n=iV(),a=tC.useRef(null);tC.useImperativeHandle(i,()=>a.current,[]);let{width:o,height:s}=(0,tI.C)(e=>e.size),l=tC.useContext(rK.q),c=tC.useMemo(()=>tB.createRoot(n.fixed),[n.fixed]);return(0,tb.useFrame)(()=>{n.delta>n.eps&&(a.current.style.transform=`translate3d(${n.horizontal?-o*(n.pages-1)*n.offset:0}px,${n.horizontal?0:-(s*(n.pages-1)*n.offset)}px,0)`)}),c.render(tC.createElement("div",e2({ref:a,style:{...t,position:"absolute",top:0,left:0,willChange:"transform"}},r),tC.createElement(iH.Provider,{value:n},tC.createElement(rK.q.Provider,{value:l},e)))),null}),iW=tC.forwardRef(({html:e,...t},r)=>tC.createElement(e?iY:iJ,e2({ref:r},t)));var tI=tI;function iK({enabled:e=!0,snap:t,global:r,domElement:i,cursor:n=!0,children:a,speed:o=1,rotation:s=[0,0,0],zoom:l=1,polar:c=[0,Math.PI/2],azimuth:h=[-1/0,1/0],damping:u=.25}){let A=(0,tI.C)(e=>e.events),d=(0,tI.C)(e=>e.gl),f=i||A.connected||d.domElement,{size:m}=(0,tI.C)(),p=tC.useMemo(()=>[s[0]+c[0],s[0]+c[1]],[s[0],c[0],c[1]]),g=tC.useMemo(()=>[s[1]+h[0],s[1]+h[1]],[s[1],h[0],h[1]]),v=tC.useMemo(()=>[tw.MathUtils.clamp(s[0],...p),tw.MathUtils.clamp(s[1],...g),s[2]],[s[0],s[1],s[2],p,g]);tC.useEffect(()=>{if(r&&n&&e)return f.style.cursor="grab",d.domElement.style.cursor="",()=>{f.style.cursor="default",d.domElement.style.cursor="default"}},[r,n,f,e]);let[y]=tC.useState({scale:1,rotation:v,damping:u}),x=tC.useRef(null);(0,tb.useFrame)((e,t)=>{iN.damp3(x.current.scale,y.scale,y.damping,t),iN.dampE(x.current.rotation,y.rotation,y.damping,t)});let E=rG({onHover:({last:t})=>{n&&!r&&e&&(f.style.cursor=t?"auto":"grab")},onDrag:({down:r,delta:[i,a],memo:[s,c]=y.rotation||v})=>(e&&(n&&(f.style.cursor=r?"grabbing":"grab"),i=tw.MathUtils.clamp(c+i/m.width*Math.PI*o,...g),a=tw.MathUtils.clamp(s+a/m.height*Math.PI*o,...p),y.scale=r&&a>p[1]/2?l:1,y.rotation=t&&!r?v:[a,i,0],y.damping=t&&!r&&"boolean"!=typeof t?t:u),[a,i])},{target:r?f:void 0});return tC.createElement("group",e2({ref:x},null==E?void 0:E()),a)}let iX=tC.createContext(null);function iq({map:e,children:t,onChange:r,domElement:i}){let n=e.map(e=>e.name+e.keys).join("-"),a=tC.useMemo(()=>{let t;return tG((t=()=>e.reduce((e,t)=>({...e,[t.name]:!1}),{}),(e,r,i)=>{let n=i.subscribe;return i.subscribe=(e,t,r)=>{let a=e;if(t){let n=(null==r?void 0:r.equalityFn)||Object.is,o=e(i.getState());a=r=>{let i=e(r);if(!n(o,i)){let e=o;t(o=i,e)}},(null==r?void 0:r.fireImmediately)&&t(o,o)}return n(a)},t(e,r,i)}))},[n]),o=tC.useMemo(()=>[a.subscribe,a.getState,a],[n]),s=a.setState;return tC.useEffect(()=>{let t=e.map(({name:e,keys:t,up:i})=>({keys:t,up:i,fn:t=>{s({[e]:t}),r&&r(e,t,o[1]())}})).reduce((e,{keys:t,fn:r,up:i=!0})=>(t.forEach(t=>e[t]={fn:r,pressed:!1,up:i}),e),{}),n=({key:e,code:r})=>{let i=t[e]||t[r];if(!i)return;let{fn:n,pressed:a,up:o}=i;i.pressed=!0,(o||!a)&&n(!0)},a=({key:e,code:r})=>{let i=t[e]||t[r];if(!i)return;let{fn:n,up:a}=i;i.pressed=!1,a&&n(!1)},l=i||window;return l.addEventListener("keydown",n,{passive:!0}),l.addEventListener("keyup",a,{passive:!0}),()=>{l.removeEventListener("keydown",n),l.removeEventListener("keyup",a)}},[i,n]),tC.createElement(iX.Provider,{value:o,children:t})}function iZ(e){let[t,r,i]=tC.useContext(iX);return e?i(e):[t,r]}let i$=new tw.Frustum,i1=new tw.Vector3,i0=new tw.Vector3,i2=new tw.Vector3,i3=new tw.Vector3,i4=new tw.Vector3,i5=new tw.Vector3,i6=new tw.Vector3,i8=new tw.Vector3,i9=new tw.Vector3,i7=new tw.Vector3,ne=new tw.Vector3,nt=new tw.Vector3,nr=new tw.Vector3,ni=new tw.Vector3;class nn{constructor(e,t,r){this.camera=e,this.scene=t,this.startPoint=new tw.Vector3,this.endPoint=new tw.Vector3,this.collection=[],this.deep=r||Number.MAX_VALUE}select(e,t){return this.startPoint=e||this.startPoint,this.endPoint=t||this.endPoint,this.collection=[],this.updateFrustum(this.startPoint,this.endPoint),this.searchChildInFrustum(i$,this.scene),this.collection}updateFrustum(e,t){if(e=e||this.startPoint,t=t||this.endPoint,e.x===t.x&&(t.x+=Number.EPSILON),e.y===t.y&&(t.y+=Number.EPSILON),this.camera.updateProjectionMatrix(),this.camera.updateMatrixWorld(),this.camera.isPerspectiveCamera){i0.copy(e),i0.x=Math.min(e.x,t.x),i0.y=Math.max(e.y,t.y),t.x=Math.max(e.x,t.x),t.y=Math.min(e.y,t.y),i2.setFromMatrixPosition(this.camera.matrixWorld),i3.copy(i0),i4.set(t.x,i0.y,0),i5.copy(t),i6.set(i0.x,t.y,0),i3.unproject(this.camera),i4.unproject(this.camera),i5.unproject(this.camera),i6.unproject(this.camera),nt.copy(i3).sub(i2),nr.copy(i4).sub(i2),ni.copy(i5).sub(i2),nt.normalize(),nr.normalize(),ni.normalize(),nt.multiplyScalar(this.deep),nr.multiplyScalar(this.deep),ni.multiplyScalar(this.deep),nt.add(i2),nr.add(i2),ni.add(i2);var r=i$.planes;r[0].setFromCoplanarPoints(i2,i3,i4),r[1].setFromCoplanarPoints(i2,i4,i5),r[2].setFromCoplanarPoints(i5,i6,i2),r[3].setFromCoplanarPoints(i6,i3,i2),r[4].setFromCoplanarPoints(i4,i5,i6),r[5].setFromCoplanarPoints(ni,nr,nt),r[5].normal.multiplyScalar(-1)}else if(this.camera.isOrthographicCamera){let i=Math.min(e.x,t.x),n=Math.max(e.y,t.y),a=Math.max(e.x,t.x),o=Math.min(e.y,t.y);i3.set(i,n,-1),i4.set(a,n,-1),i5.set(a,o,-1),i6.set(i,o,-1),i8.set(i,n,1),i9.set(a,n,1),i7.set(a,o,1),ne.set(i,o,1),i3.unproject(this.camera),i4.unproject(this.camera),i5.unproject(this.camera),i6.unproject(this.camera),i8.unproject(this.camera),i9.unproject(this.camera),i7.unproject(this.camera),ne.unproject(this.camera);var r=i$.planes;r[0].setFromCoplanarPoints(i3,i8,i9),r[1].setFromCoplanarPoints(i4,i9,i7),r[2].setFromCoplanarPoints(i7,ne,i6),r[3].setFromCoplanarPoints(ne,i8,i3),r[4].setFromCoplanarPoints(i4,i5,i6),r[5].setFromCoplanarPoints(i7,i9,i8),r[5].normal.multiplyScalar(-1)}else console.error("THREE.SelectionBox: Unsupported camera type.")}searchChildInFrustum(e,t){if((t.isMesh||t.isLine||t.isPoints)&&void 0!==t.material&&(null===t.geometry.boundingSphere&&t.geometry.computeBoundingSphere(),i1.copy(t.geometry.boundingSphere.center),i1.applyMatrix4(t.matrixWorld),e.containsPoint(i1)&&this.collection.push(t)),t.children.length>0)for(let r=0;r<t.children.length;r++)this.searchChildInFrustum(e,t.children[r])}}var tI=tI;let na=(e,t)=>{let r=e instanceof Map?e:new Map(e.entries()),i=t instanceof Map?t:new Map(t.entries());if(r.size!==i.size)return!1;for(let[e,t]of r)if(!i.has(e)||!Object.is(t,i.get(e)))return!1;return!0},no=tC.createContext([]);function ns({box:e,multiple:t,children:r,onChange:i,onChangePointerUp:n,border:a="1px solid #55aaff",backgroundColor:o="rgba(75, 160, 255, 0.1)",filter:s=e=>e,...l}){let[c,h]=tC.useState(!1),{setEvents:u,camera:A,raycaster:d,gl:f,controls:m,size:p,get:g}=(0,tI.C)(),[v,y]=tC.useState(!1),[x,E]=tC.useReducer((e,{object:t,shift:r})=>void 0===t?[]:Array.isArray(t)?t:r?e.includes(t)?e.filter(e=>e!==t):[t,...e]:e[0]===t?[]:[t],[]);tC.useEffect(()=>{c?null==i||i(x):null==n||n(x)},[x,c]);let C=tC.useCallback(e=>{e.stopPropagation(),E({object:s([e.object])[0],shift:t&&e.shiftKey})},[]),B=tC.useCallback(e=>!v&&E({}),[v]),w=tC.useRef(null);return tC.useEffect(()=>{if(!e||!t)return;let r=new nn(A,w.current),i=document.createElement("div");i.style.pointerEvents="none",i.style.border=a,i.style.backgroundColor=o,i.style.position="fixed";let n=new tw.Vector2,l=new tw.Vector2,c=new tw.Vector2,d=g().events.enabled,v=null==m?void 0:m.enabled,y=!1;function x(e,t){let{offsetX:r,offsetY:i}=e,{width:n,height:a}=p;t.set(r/n*2-1,-(i/a*2)+1)}function C(e){if(e.shiftKey){var t;m&&(m.enabled=!1),u({enabled:!1}),h(y=!0),null==(t=f.domElement.parentElement)||t.appendChild(i),i.style.left=`${e.clientX}px`,i.style.top=`${e.clientY}px`,i.style.width="0px",i.style.height="0px",n.x=e.clientX,n.y=e.clientY,x(e,r.startPoint)}}let B=[];function I(e){if(y){c.x=Math.max(n.x,e.clientX),c.y=Math.max(n.y,e.clientY),l.x=Math.min(n.x,e.clientX),l.y=Math.min(n.y,e.clientY),i.style.left=`${l.x}px`,i.style.top=`${l.y}px`,i.style.width=`${c.x-l.x}px`,i.style.height=`${c.y-l.y}px`,x(e,r.endPoint);let t=r.select().sort(e=>e.uuid).filter(e=>e.isMesh);!function(e,t){if(Object.is(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t||Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;if(Symbol.iterator in e&&Symbol.iterator in t){if("entries"in e&&"entries"in t)return na(e,t);let r=e[Symbol.iterator](),i=t[Symbol.iterator](),n=r.next(),a=i.next();for(;!n.done&&!a.done;){if(!Object.is(n.value,a.value))return!1;n=r.next(),a=i.next()}return!!n.done&&!!a.done}return na({entries:()=>Object.entries(e)},{entries:()=>Object.entries(t)})}(t,B)&&(B=t,E({object:s(t)}))}}function b(e){y&&function(){if(y){var e;m&&(m.enabled=v),u({enabled:d}),h(y=!1),null==(e=i.parentElement)||e.removeChild(i)}}()}return document.addEventListener("pointerdown",C,{passive:!0}),document.addEventListener("pointermove",I,{passive:!0,capture:!0}),document.addEventListener("pointerup",b,{passive:!0}),()=>{document.removeEventListener("pointerdown",C),document.removeEventListener("pointermove",I,!0),document.removeEventListener("pointerup",b)}},[p.width,p.height,d,A,m,f]),tC.createElement("group",e2({ref:w,onClick:C,onPointerOver:()=>y(!0),onPointerOut:()=>y(!1),onPointerMissed:B},l),tC.createElement(no.Provider,{value:x},r))}function nl(){return tC.useContext(no)}let nc=tC.forwardRef(function({children:e,follow:t=!0,lockX:r=!1,lockY:i=!1,lockZ:n=!1,...a},o){let s=tC.useRef(null),l=tC.useRef(null),c=new tw.Quaternion;return(0,tb.useFrame)(({camera:e})=>{if(!t||!l.current)return;let a=s.current.rotation.clone();l.current.updateMatrix(),l.current.updateWorldMatrix(!1,!1),l.current.getWorldQuaternion(c),e.getWorldQuaternion(s.current.quaternion).premultiply(c.invert()),r&&(s.current.rotation.x=a.x),i&&(s.current.rotation.y=a.y),n&&(s.current.rotation.z=a.z)}),tC.useImperativeHandle(o,()=>l.current,[]),tC.createElement("group",e2({ref:l},a),tC.createElement("group",{ref:s},e))}),nh=tC.forwardRef(({children:e,depth:t=-1,...r},i)=>{let n=tC.useRef(null);return tC.useImperativeHandle(i,()=>n.current,[]),(0,tb.useFrame)(({camera:e})=>{n.current.quaternion.copy(e.quaternion),n.current.position.copy(e.position)}),tC.createElement("group",e2({ref:n},r),tC.createElement("group",{"position-z":-t},e))}),nu=new tw.Vector3,nA=new tw.Vector3,nd=new tw.Vector3,nf=(e,t,r,i=1)=>{let n=nu.set(e.x/r.width*2-1,-(2*(e.y/r.height))+1,i);return n.unproject(t),n},nm=(e,t,r,i)=>{var n;let a,o,s,l=(n=nd.copy(e),a=i.width/2,o=i.height/2,r.updateMatrixWorld(!1),(s=n.project(r)).x=s.x*a+a,s.y=-(s.y*o)+o,s),c=0;for(let n=0;n<2;++n){let a=nA.copy(l).setComponent(n,l.getComponent(n)+t),o=nf(a,r,i,a.z);c=Math.max(c,e.distanceTo(o))}return c},np=new tw.Vector3,ng=(0,tC.forwardRef)(({scale:e=1,...t},r)=>{let i=(0,tC.useRef)(null);return tC.useImperativeHandle(r,()=>i.current,[]),(0,tb.useFrame)(t=>{let r=i.current;if(!r)return;let n=nm(r.getWorldPosition(np),e,t.camera,t.size);r.scale.setScalar(n*e)}),tC.createElement("object3D",e2({ref:i},t))});var tI=tI,nv=tw,ny=tw;let nx=new ny.Box3,nE=new ny.Vector3;class nC extends ny.InstancedBufferGeometry{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry",this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new ny.Float32BufferAttribute([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new ny.Float32BufferAttribute([-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],2))}applyMatrix4(e){let t=this.attributes.instanceStart,r=this.attributes.instanceEnd;return void 0!==t&&(t.applyMatrix4(e),r.applyMatrix4(e),t.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));let r=new ny.InstancedInterleavedBuffer(t,6,1);return this.setAttribute("instanceStart",new ny.InterleavedBufferAttribute(r,3,0)),this.setAttribute("instanceEnd",new ny.InterleavedBufferAttribute(r,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e,t=3){let r;e instanceof Float32Array?r=e:Array.isArray(e)&&(r=new Float32Array(e));let i=new ny.InstancedInterleavedBuffer(r,2*t,1);return this.setAttribute("instanceColorStart",new ny.InterleavedBufferAttribute(i,t,0)),this.setAttribute("instanceColorEnd",new ny.InterleavedBufferAttribute(i,t,t)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new ny.WireframeGeometry(e.geometry)),this}fromLineSegments(e){let t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new ny.Box3);let e=this.attributes.instanceStart,t=this.attributes.instanceEnd;void 0!==e&&void 0!==t&&(this.boundingBox.setFromBufferAttribute(e),nx.setFromBufferAttribute(t),this.boundingBox.union(nx))}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new ny.Sphere),null===this.boundingBox&&this.computeBoundingBox();let e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(void 0!==e&&void 0!==t){let r=this.boundingSphere.center;this.boundingBox.getCenter(r);let i=0;for(let n=0,a=e.count;n<a;n++)nE.fromBufferAttribute(e,n),i=Math.max(i,r.distanceToSquared(nE)),nE.fromBufferAttribute(t,n),i=Math.max(i,r.distanceToSquared(nE));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}var nB=tw,nw=e.i(8560);let nI=parseInt(tw.REVISION.replace(/\D+/g,""));class nb extends nB.ShaderMaterial{constructor(e){super({type:"LineMaterial",uniforms:nB.UniformsUtils.clone(nB.UniformsUtils.merge([nw.UniformsLib.common,nw.UniformsLib.fog,{worldUnits:{value:1},linewidth:{value:1},resolution:{value:new nB.Vector2(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}}])),vertexShader:`
				#include <common>
				#include <fog_pars_vertex>
				#include <logdepthbuf_pars_vertex>
				#include <clipping_planes_pars_vertex>

				uniform float linewidth;
				uniform vec2 resolution;

				attribute vec3 instanceStart;
				attribute vec3 instanceEnd;

				#ifdef USE_COLOR
					#ifdef USE_LINE_COLOR_ALPHA
						varying vec4 vLineColor;
						attribute vec4 instanceColorStart;
						attribute vec4 instanceColorEnd;
					#else
						varying vec3 vLineColor;
						attribute vec3 instanceColorStart;
						attribute vec3 instanceColorEnd;
					#endif
				#endif

				#ifdef WORLD_UNITS

					varying vec4 worldPos;
					varying vec3 worldStart;
					varying vec3 worldEnd;

					#ifdef USE_DASH

						varying vec2 vUv;

					#endif

				#else

					varying vec2 vUv;

				#endif

				#ifdef USE_DASH

					uniform float dashScale;
					attribute float instanceDistanceStart;
					attribute float instanceDistanceEnd;
					varying float vLineDistance;

				#endif

				void trimSegment( const in vec4 start, inout vec4 end ) {

					// trim end segment so it terminates between the camera plane and the near plane

					// conservative estimate of the near plane
					float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
					float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
					float nearEstimate = - 0.5 * b / a;

					float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

					end.xyz = mix( start.xyz, end.xyz, alpha );

				}

				void main() {

					#ifdef USE_COLOR

						vLineColor = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

					#endif

					#ifdef USE_DASH

						vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
						vUv = uv;

					#endif

					float aspect = resolution.x / resolution.y;

					// camera space
					vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
					vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

					#ifdef WORLD_UNITS

						worldStart = start.xyz;
						worldEnd = end.xyz;

					#else

						vUv = uv;

					#endif

					// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
					// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
					// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
					// perhaps there is a more elegant solution -- WestLangley

					bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

					if ( perspective ) {

						if ( start.z < 0.0 && end.z >= 0.0 ) {

							trimSegment( start, end );

						} else if ( end.z < 0.0 && start.z >= 0.0 ) {

							trimSegment( end, start );

						}

					}

					// clip space
					vec4 clipStart = projectionMatrix * start;
					vec4 clipEnd = projectionMatrix * end;

					// ndc space
					vec3 ndcStart = clipStart.xyz / clipStart.w;
					vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

					// direction
					vec2 dir = ndcEnd.xy - ndcStart.xy;

					// account for clip-space aspect ratio
					dir.x *= aspect;
					dir = normalize( dir );

					#ifdef WORLD_UNITS

						// get the offset direction as perpendicular to the view vector
						vec3 worldDir = normalize( end.xyz - start.xyz );
						vec3 offset;
						if ( position.y < 0.5 ) {

							offset = normalize( cross( start.xyz, worldDir ) );

						} else {

							offset = normalize( cross( end.xyz, worldDir ) );

						}

						// sign flip
						if ( position.x < 0.0 ) offset *= - 1.0;

						float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

						// don't extend the line if we're rendering dashes because we
						// won't be rendering the endcaps
						#ifndef USE_DASH

							// extend the line bounds to encompass  endcaps
							start.xyz += - worldDir * linewidth * 0.5;
							end.xyz += worldDir * linewidth * 0.5;

							// shift the position of the quad so it hugs the forward edge of the line
							offset.xy -= dir * forwardOffset;
							offset.z += 0.5;

						#endif

						// endcaps
						if ( position.y > 1.0 || position.y < 0.0 ) {

							offset.xy += dir * 2.0 * forwardOffset;

						}

						// adjust for linewidth
						offset *= linewidth * 0.5;

						// set the world position
						worldPos = ( position.y < 0.5 ) ? start : end;
						worldPos.xyz += offset;

						// project the worldpos
						vec4 clip = projectionMatrix * worldPos;

						// shift the depth of the projected points so the line
						// segments overlap neatly
						vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
						clip.z = clipPose.z * clip.w;

					#else

						vec2 offset = vec2( dir.y, - dir.x );
						// undo aspect ratio adjustment
						dir.x /= aspect;
						offset.x /= aspect;

						// sign flip
						if ( position.x < 0.0 ) offset *= - 1.0;

						// endcaps
						if ( position.y < 0.0 ) {

							offset += - dir;

						} else if ( position.y > 1.0 ) {

							offset += dir;

						}

						// adjust for linewidth
						offset *= linewidth;

						// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
						offset /= resolution.y;

						// select end
						vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

						// back to clip space
						offset *= clip.w;

						clip.xy += offset;

					#endif

					gl_Position = clip;

					vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

					#include <logdepthbuf_vertex>
					#include <clipping_planes_vertex>
					#include <fog_vertex>

				}
			`,fragmentShader:`
				uniform vec3 diffuse;
				uniform float opacity;
				uniform float linewidth;

				#ifdef USE_DASH

					uniform float dashOffset;
					uniform float dashSize;
					uniform float gapSize;

				#endif

				varying float vLineDistance;

				#ifdef WORLD_UNITS

					varying vec4 worldPos;
					varying vec3 worldStart;
					varying vec3 worldEnd;

					#ifdef USE_DASH

						varying vec2 vUv;

					#endif

				#else

					varying vec2 vUv;

				#endif

				#include <common>
				#include <fog_pars_fragment>
				#include <logdepthbuf_pars_fragment>
				#include <clipping_planes_pars_fragment>

				#ifdef USE_COLOR
					#ifdef USE_LINE_COLOR_ALPHA
						varying vec4 vLineColor;
					#else
						varying vec3 vLineColor;
					#endif
				#endif

				vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

					float mua;
					float mub;

					vec3 p13 = p1 - p3;
					vec3 p43 = p4 - p3;

					vec3 p21 = p2 - p1;

					float d1343 = dot( p13, p43 );
					float d4321 = dot( p43, p21 );
					float d1321 = dot( p13, p21 );
					float d4343 = dot( p43, p43 );
					float d2121 = dot( p21, p21 );

					float denom = d2121 * d4343 - d4321 * d4321;

					float numer = d1343 * d4321 - d1321 * d4343;

					mua = numer / denom;
					mua = clamp( mua, 0.0, 1.0 );
					mub = ( d1343 + d4321 * ( mua ) ) / d4343;
					mub = clamp( mub, 0.0, 1.0 );

					return vec2( mua, mub );

				}

				void main() {

					#include <clipping_planes_fragment>

					#ifdef USE_DASH

						if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

						if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

					#endif

					float alpha = opacity;

					#ifdef WORLD_UNITS

						// Find the closest points on the view ray and the line segment
						vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
						vec3 lineDir = worldEnd - worldStart;
						vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

						vec3 p1 = worldStart + lineDir * params.x;
						vec3 p2 = rayEnd * params.y;
						vec3 delta = p1 - p2;
						float len = length( delta );
						float norm = len / linewidth;

						#ifndef USE_DASH

							#ifdef USE_ALPHA_TO_COVERAGE

								float dnorm = fwidth( norm );
								alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

							#else

								if ( norm > 0.5 ) {

									discard;

								}

							#endif

						#endif

					#else

						#ifdef USE_ALPHA_TO_COVERAGE

							// artifacts appear on some hardware if a derivative is taken within a conditional
							float a = vUv.x;
							float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
							float len2 = a * a + b * b;
							float dlen = fwidth( len2 );

							if ( abs( vUv.y ) > 1.0 ) {

								alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

							}

						#else

							if ( abs( vUv.y ) > 1.0 ) {

								float a = vUv.x;
								float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
								float len2 = a * a + b * b;

								if ( len2 > 1.0 ) discard;

							}

						#endif

					#endif

					vec4 diffuseColor = vec4( diffuse, alpha );
					#ifdef USE_COLOR
						#ifdef USE_LINE_COLOR_ALPHA
							diffuseColor *= vLineColor;
						#else
							diffuseColor.rgb *= vLineColor;
						#endif
					#endif

					#include <logdepthbuf_fragment>

					gl_FragColor = diffuseColor;

					#include <tonemapping_fragment>
					#include <${nI>=154?"colorspace_fragment":"encodings_fragment"}>
					#include <fog_fragment>
					#include <premultiplied_alpha_fragment>

				}
			`,clipping:!0}),this.isLineMaterial=!0,this.onBeforeCompile=function(){this.transparent?this.defines.USE_LINE_COLOR_ALPHA="1":delete this.defines.USE_LINE_COLOR_ALPHA},Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(e){this.uniforms.diffuse.value=e}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(e){!0===e?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(e){this.uniforms.linewidth.value=e}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(e){!!e!="USE_DASH"in this.defines&&(this.needsUpdate=!0),!0===e?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(e){this.uniforms.dashScale.value=e}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(e){this.uniforms.dashSize.value=e}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(e){this.uniforms.dashOffset.value=e}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(e){this.uniforms.gapSize.value=e}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(e){this.uniforms.resolution.value.copy(e)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(e){!!e!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),!0===e?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}let n_=nI>=125?"uv1":"uv2",nM=new nv.Vector4,nS=new nv.Vector3,nT=new nv.Vector3,nD=new nv.Vector4,nF=new nv.Vector4,nR=new nv.Vector4,nP=new nv.Vector3,nQ=new nv.Matrix4,nU=new nv.Line3,nz=new nv.Vector3,nk=new nv.Box3,nL=new nv.Sphere,nO=new nv.Vector4;function nG(e,t,r){return nO.set(0,0,-t,1).applyMatrix4(e.projectionMatrix),nO.multiplyScalar(1/nO.w),nO.x=I/r.width,nO.y=I/r.height,nO.applyMatrix4(e.projectionMatrixInverse),nO.multiplyScalar(1/nO.w),Math.abs(Math.max(nO.x,nO.y))}class nN extends nv.Mesh{constructor(e=new nC,t=new nb({color:0xffffff*Math.random()})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){let e=this.geometry,t=e.attributes.instanceStart,r=e.attributes.instanceEnd,i=new Float32Array(2*t.count);for(let e=0,n=0,a=t.count;e<a;e++,n+=2)nS.fromBufferAttribute(t,e),nT.fromBufferAttribute(r,e),i[n]=0===n?0:i[n-1],i[n+1]=i[n]+nS.distanceTo(nT);let n=new nv.InstancedInterleavedBuffer(i,2,1);return e.setAttribute("instanceDistanceStart",new nv.InterleavedBufferAttribute(n,1,0)),e.setAttribute("instanceDistanceEnd",new nv.InterleavedBufferAttribute(n,1,1)),this}raycast(e,t){let r,i,n=this.material.worldUnits,a=e.camera;null!==a||n||console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');let o=void 0!==e.params.Line2&&e.params.Line2.threshold||0;w=e.ray;let s=this.matrixWorld,l=this.geometry,c=this.material;if(I=c.linewidth+o,null===l.boundingSphere&&l.computeBoundingSphere(),nL.copy(l.boundingSphere).applyMatrix4(s),n)r=.5*I;else{let e=Math.max(a.near,nL.distanceToPoint(w.origin));r=nG(a,e,c.resolution)}if(nL.radius+=r,!1!==w.intersectsSphere(nL)){if(null===l.boundingBox&&l.computeBoundingBox(),nk.copy(l.boundingBox).applyMatrix4(s),n)i=.5*I;else{let e=Math.max(a.near,nk.distanceToPoint(w.origin));i=nG(a,e,c.resolution)}nk.expandByScalar(i),!1!==w.intersectsBox(nk)&&(n?function(e,t){let r=e.matrixWorld,i=e.geometry,n=i.attributes.instanceStart,a=i.attributes.instanceEnd,o=Math.min(i.instanceCount,n.count);for(let i=0;i<o;i++){nU.start.fromBufferAttribute(n,i),nU.end.fromBufferAttribute(a,i),nU.applyMatrix4(r);let o=new nv.Vector3,s=new nv.Vector3;w.distanceSqToSegment(nU.start,nU.end,s,o),s.distanceTo(o)<.5*I&&t.push({point:s,pointOnLine:o,distance:w.origin.distanceTo(s),object:e,face:null,faceIndex:i,uv:null,[n_]:null})}}(this,t):function(e,t,r){let i=t.projectionMatrix,n=e.material.resolution,a=e.matrixWorld,o=e.geometry,s=o.attributes.instanceStart,l=o.attributes.instanceEnd,c=Math.min(o.instanceCount,s.count),h=-t.near;w.at(1,nR),nR.w=1,nR.applyMatrix4(t.matrixWorldInverse),nR.applyMatrix4(i),nR.multiplyScalar(1/nR.w),nR.x*=n.x/2,nR.y*=n.y/2,nR.z=0,nP.copy(nR),nQ.multiplyMatrices(t.matrixWorldInverse,a);for(let t=0;t<c;t++){if(nD.fromBufferAttribute(s,t),nF.fromBufferAttribute(l,t),nD.w=1,nF.w=1,nD.applyMatrix4(nQ),nF.applyMatrix4(nQ),nD.z>h&&nF.z>h)continue;if(nD.z>h){let e=nD.z-nF.z,t=(nD.z-h)/e;nD.lerp(nF,t)}else if(nF.z>h){let e=nF.z-nD.z,t=(nF.z-h)/e;nF.lerp(nD,t)}nD.applyMatrix4(i),nF.applyMatrix4(i),nD.multiplyScalar(1/nD.w),nF.multiplyScalar(1/nF.w),nD.x*=n.x/2,nD.y*=n.y/2,nF.x*=n.x/2,nF.y*=n.y/2,nU.start.copy(nD),nU.start.z=0,nU.end.copy(nF),nU.end.z=0;let o=nU.closestPointToPointParameter(nP,!0);nU.at(o,nz);let c=nv.MathUtils.lerp(nD.z,nF.z,o),u=c>=-1&&c<=1,A=nP.distanceTo(nz)<.5*I;if(u&&A){nU.start.fromBufferAttribute(s,t),nU.end.fromBufferAttribute(l,t),nU.start.applyMatrix4(a),nU.end.applyMatrix4(a);let i=new nv.Vector3,n=new nv.Vector3;w.distanceSqToSegment(nU.start,nU.end,n,i),r.push({point:n,pointOnLine:i,distance:w.origin.distanceTo(n),object:e,face:null,faceIndex:t,uv:null,[n_]:null})}}}(this,a,t))}}onBeforeRender(e){let t=this.material.uniforms;t&&t.resolution&&(e.getViewport(nM),this.material.uniforms.resolution.value.set(nM.z,nM.w))}}class nH extends nC{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){let t=e.length-3,r=new Float32Array(2*t);for(let i=0;i<t;i+=3)r[2*i]=e[i],r[2*i+1]=e[i+1],r[2*i+2]=e[i+2],r[2*i+3]=e[i+3],r[2*i+4]=e[i+4],r[2*i+5]=e[i+5];return super.setPositions(r),this}setColors(e,t=3){let r=e.length-t,i=new Float32Array(2*r);if(3===t)for(let n=0;n<r;n+=t)i[2*n]=e[n],i[2*n+1]=e[n+1],i[2*n+2]=e[n+2],i[2*n+3]=e[n+3],i[2*n+4]=e[n+4],i[2*n+5]=e[n+5];else for(let n=0;n<r;n+=t)i[2*n]=e[n],i[2*n+1]=e[n+1],i[2*n+2]=e[n+2],i[2*n+3]=e[n+3],i[2*n+4]=e[n+4],i[2*n+5]=e[n+5],i[2*n+6]=e[n+6],i[2*n+7]=e[n+7];return super.setColors(i,t),this}fromLine(e){let t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class nV extends nN{constructor(e=new nH,t=new nb({color:0xffffff*Math.random()})){super(e,t),this.isLine2=!0,this.type="Line2"}}let nj=tC.forwardRef(function({points:e,color:t=0xffffff,vertexColors:r,linewidth:i,lineWidth:n,segments:a,dashed:o,...s},l){var c,h;let u=(0,tI.C)(e=>e.size),A=tC.useMemo(()=>a?new nN:new nV,[a]),[d]=tC.useState(()=>new nb),f=(null==r||null==(c=r[0])?void 0:c.length)===4?4:3,m=tC.useMemo(()=>{let i=a?new nC:new nH,n=e.map(e=>{let t=Array.isArray(e);return e instanceof tw.Vector3||e instanceof tw.Vector4?[e.x,e.y,e.z]:e instanceof tw.Vector2?[e.x,e.y,0]:t&&3===e.length?[e[0],e[1],e[2]]:t&&2===e.length?[e[0],e[1],0]:e});if(i.setPositions(n.flat()),r){t=0xffffff;let e=r.map(e=>e instanceof tw.Color?e.toArray():e);i.setColors(e.flat(),f)}return i},[e,a,r,f]);return tC.useLayoutEffect(()=>{A.computeLineDistances()},[e,A]),tC.useLayoutEffect(()=>{o?d.defines.USE_DASH="":delete d.defines.USE_DASH,d.needsUpdate=!0},[o,d]),tC.useEffect(()=>()=>{m.dispose(),d.dispose()},[m]),tC.createElement("primitive",e2({object:A,ref:l},s),tC.createElement("primitive",{object:m,attach:"geometry"}),tC.createElement("primitive",e2({object:d,attach:"material",color:t,vertexColors:!!r,resolution:[u.width,u.height],linewidth:null!=(h=null!=i?i:n)?h:1,dashed:o,transparent:4===f},s)))}),nJ=new tw.Vector3,nY=tC.forwardRef(function({start:e=[0,0,0],end:t=[0,0,0],mid:r,segments:i=20,...n},a){let o=tC.useRef(null);tC.useImperativeHandle(a,()=>o.current);let[s]=tC.useState(()=>new tw.QuadraticBezierCurve3(void 0,void 0,void 0)),l=tC.useCallback((e,t,r,i=20)=>(e instanceof tw.Vector3?s.v0.copy(e):s.v0.set(...e),t instanceof tw.Vector3?s.v2.copy(t):s.v2.set(...t),r instanceof tw.Vector3?s.v1.copy(r):Array.isArray(r)?s.v1.set(...r):s.v1.copy(s.v0.clone().add(s.v2.clone().sub(s.v0)).add(nJ.set(0,s.v0.y-s.v2.y,0))),s.getPoints(i)),[]);tC.useLayoutEffect(()=>{o.current.setPoints=(e,t,r)=>{let i=l(e,t,r);o.current.geometry&&o.current.geometry.setPositions(i.map(e=>e.toArray()).flat())}},[]);let c=tC.useMemo(()=>l(e,t,r,i),[e,t,r,i]);return tC.createElement(nj,e2({ref:o,points:c},n))}),nW=tC.forwardRef(function({start:e,end:t,midA:r,midB:i,segments:n=20,...a},o){let s=tC.useMemo(()=>{let a=e instanceof tw.Vector3?e:new tw.Vector3(...e),o=t instanceof tw.Vector3?t:new tw.Vector3(...t),s=r instanceof tw.Vector3?r:new tw.Vector3(...r),l=i instanceof tw.Vector3?i:new tw.Vector3(...i);return new tw.CubicBezierCurve3(a,s,l,o).getPoints(n)},[e,t,r,i,n]);return tC.createElement(nj,e2({ref:o,points:s},a))}),nK=tC.forwardRef(function({points:e,closed:t=!1,curveType:r="centripetal",tension:i=.5,segments:n=20,vertexColors:a,...o},s){let l=tC.useMemo(()=>{let n=e.map(e=>e instanceof tw.Vector3?e:new tw.Vector3(...e));return new tw.CatmullRomCurve3(n,t,r,i)},[e,t,r,i]),c=tC.useMemo(()=>l.getPoints(n),[l,n]),h=tC.useMemo(()=>{if(!a||a.length<2)return;if(a.length===n+1)return a;let e=a.map(e=>e instanceof tw.Color?e:new tw.Color(...e));t&&e.push(e[0].clone());let r=[e[0]],i=n/(e.length-1);for(let t=1;t<n;t++){let n=t%i/i,a=Math.floor(t/i);r.push(e[a].clone().lerp(e[a+1],n))}return r.push(e[e.length-1]),r},[a,n]);return tC.createElement(nj,e2({ref:s,points:c,vertexColors:h},o))});var tI=tI,nX=tI;let nq=tC.forwardRef(({url:e,distance:t=1,loop:r=!0,autoplay:i,...n},a)=>{let o=tC.useRef(null);tC.useImperativeHandle(a,()=>o.current,[]);let s=(0,tI.C)(({camera:e})=>e),[l]=tC.useState(()=>new tw.AudioListener),c=(0,nX.G)(tw.AudioLoader,e);return tC.useEffect(()=>{let e=o.current;e&&(e.setBuffer(c),e.setRefDistance(t),e.setLoop(r),i&&!e.isPlaying&&e.play())},[c,s,t,r]),tC.useEffect(()=>{let e=o.current;return s.add(l),()=>{s.remove(l),e&&(e.isPlaying&&e.stop(),e.source&&e.source._connected&&e.disconnect())}},[]),tC.createElement("positionalAudio",e2({ref:o,args:[l]},n))});var nZ=tw;function n$(){var e=Object.create(null);function t(e,t){var r=void 0;self.troikaDefine=function(e){return r=e};var i=URL.createObjectURL(new Blob(["/** "+e.replace(/\*/g,"")+" **/\n\ntroikaDefine(\n"+t+"\n)"],{type:"application/javascript"}));try{importScripts(i)}catch(e){console.error(e)}return URL.revokeObjectURL(i),delete self.troikaDefine,r}self.addEventListener("message",function(r){var i=r.data,n=i.messageId,a=i.action,o=i.data;try{"registerModule"===a&&function r(i,n){var a=i.id,o=i.name,s=i.dependencies;void 0===s&&(s=[]);var l=i.init;void 0===l&&(l=function(){});var c=i.getTransferables;if(void 0===c&&(c=null),!e[a])try{s=s.map(function(t){return t&&t.isWorkerModule&&(r(t,function(e){if(e instanceof Error)throw e}),t=e[t.id].value),t}),l=t("<"+o+">.init",l),c&&(c=t("<"+o+">.getTransferables",c));var h=null;"function"==typeof l?h=l.apply(void 0,s):console.error("worker module init function failed to rehydrate"),e[a]={id:a,value:h,getTransferables:c},n(h)}catch(e){e&&e.noLog||console.error(e),n(e)}}(o,function(e){e instanceof Error?postMessage({messageId:n,success:!1,error:e.message}):postMessage({messageId:n,success:!0,result:{isCallable:"function"==typeof e}})}),"callModule"===a&&function(t,r){var i,n=t.id,a=t.args;e[n]&&"function"==typeof e[n].value||r(Error("Worker module "+n+": not found or its 'init' did not return a function"));try{var o=(i=e[n]).value.apply(i,a);o&&"function"==typeof o.then?o.then(s,function(e){return r(e instanceof Error?e:Error(""+e))}):s(o)}catch(e){r(e)}function s(t){try{var i=e[n].getTransferables&&e[n].getTransferables(t);i&&Array.isArray(i)&&i.length||(i=void 0),r(t,i)}catch(e){console.error(e),r(e)}}}(o,function(e,t){e instanceof Error?postMessage({messageId:n,success:!1,error:e.message}):postMessage({messageId:n,success:!0,result:e},t||void 0)})}catch(e){postMessage({messageId:n,success:!1,error:e.stack})}})}var n1=function(){var e=!1;if("undefined"!=typeof window&&void 0!==window.document)try{new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"}))).terminate(),e=!0}catch(e){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+e.message+"]")}return n1=function(){return e},e},n0=0,n2=0,n3=!1,n4=Object.create(null),n5=Object.create(null),n6=Object.create(null);function n8(e){if((!e||"function"!=typeof e.init)&&!n3)throw Error("requires `options.init` function");var t,r=e.dependencies,i=e.init,n=e.getTransferables,a=e.workerId,o=((t=function(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r];return t._getInitResult().then(function(t){if("function"==typeof t)return t.apply(void 0,e);throw Error("Worker module function was called but `init` did not return a callable function")})})._getInitResult=function(){var r=e.dependencies,i=e.init,n=Promise.all(r=Array.isArray(r)?r.map(function(e){return e&&(e=e.onMainThread||e)._getInitResult&&(e=e._getInitResult()),e}):[]).then(function(e){return i.apply(null,e)});return t._getInitResult=function(){return n},n},t);null==a&&(a="#default");var s="workerModule"+ ++n0,l=e.name||s,c=null;function h(){for(var e=[],t=arguments.length;t--;)e[t]=arguments[t];if(!n1())return o.apply(void 0,e);if(!c){c=n7(a,"registerModule",h.workerModuleData);var r=function(){c=null,n5[a].delete(r)};(n5[a]||(n5[a]=new Set)).add(r)}return c.then(function(t){if(t.isCallable)return n7(a,"callModule",{id:s,args:e});throw Error("Worker module function was called but `init` did not return a callable function")})}return r=r&&r.map(function(e){return"function"!=typeof e||e.workerModuleData||(n3=!0,e=n8({workerId:a,name:"<"+l+"> function dependency: "+e.name,init:"function(){return (\n"+n9(e)+"\n)}"}),n3=!1),e&&e.workerModuleData&&(e=e.workerModuleData),e}),h.workerModuleData={isWorkerModule:!0,id:s,name:l,dependencies:r,init:n9(i),getTransferables:n&&n9(n)},h.onMainThread=o,h}function n9(e){var t=e.toString();return!/^function/.test(t)&&/^\w+\s*\(/.test(t)&&(t="function "+t),t}function n7(e,t,r){return new Promise(function(i,n){var a=++n2;n6[a]=function(e){e.success?i(e.result):n(Error("Error in worker "+t+" call: "+e.error))},(function(e){var t=n4[e];if(!t){var r=n9(n$);(t=n4[e]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+e.replace(/\*/g,"")+" **/\n\n;("+r+")()"],{type:"application/javascript"})))).onmessage=function(e){var t=e.data,r=t.messageId,i=n6[r];if(!i)throw Error("WorkerModule response with empty or unknown messageId");delete n6[r],i(t)}}return t})(e).postMessage({messageId:a,action:t,data:r})})}function ae(){return function(e){function t(e,t){for(var r,i,n,a,o,s=/([MLQCZ])([^MLQCZ]*)/g;r=s.exec(e);){var l=r[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(e){return parseFloat(e)});switch(r[1]){case"M":a=i=l[0],o=n=l[1];break;case"L":(l[0]!==a||l[1]!==o)&&t("L",a,o,a=l[0],o=l[1]);break;case"Q":t("Q",a,o,a=l[2],o=l[3],l[0],l[1]);break;case"C":t("C",a,o,a=l[4],o=l[5],l[0],l[1],l[2],l[3]);break;case"Z":(a!==i||o!==n)&&t("L",a,o,i,n)}}}function r(e,r,i){void 0===i&&(i=16);var n={x:0,y:0};t(e,function(e,t,a,o,s,l,c,h,u){switch(e){case"L":r(t,a,o,s);break;case"Q":for(var A=t,d=a,f=1;f<i;f++)!function(e,t,r,i,n,a,o,s){var l=1-o;s.x=l*l*e+2*l*o*r+o*o*n,s.y=l*l*t+2*l*o*i+o*o*a}(t,a,l,c,o,s,f/(i-1),n),r(A,d,n.x,n.y),A=n.x,d=n.y;break;case"C":for(var m=t,p=a,g=1;g<i;g++)!function(e,t,r,i,n,a,o,s,l,c){var h=1-l;c.x=h*h*h*e+3*h*h*l*r+3*h*l*l*n+l*l*l*o,c.y=h*h*h*t+3*h*h*l*i+3*h*l*l*a+l*l*l*s}(t,a,l,c,h,u,o,s,g/(i-1),n),r(m,p,n.x,n.y),m=n.x,p=n.y}})}var i="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",n=new WeakMap,a={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function o(e,t){var r=e.getContext?e.getContext("webgl",a):e,i=n.get(r);if(!i){var o="undefined"!=typeof WebGL2RenderingContext&&r instanceof WebGL2RenderingContext,s={},l={},c={},h=-1,u=[];function A(e){var t=s[e];if(!t&&!(t=s[e]=r.getExtension(e)))throw Error(e+" not supported");return t}function d(e,t){var i=r.createShader(t);return r.shaderSource(i,e),r.compileShader(i),i}function f(){s={},l={},c={},h=-1,u.length=0}r.canvas.addEventListener("webglcontextlost",function(e){f(),e.preventDefault()},!1),n.set(r,i={gl:r,isWebGL2:o,getExtension:A,withProgram:function(e,t,i,n){if(!l[e]){var a={},s={},c=r.createProgram();r.attachShader(c,d(t,r.VERTEX_SHADER)),r.attachShader(c,d(i,r.FRAGMENT_SHADER)),r.linkProgram(c),l[e]={program:c,transaction:function(e){r.useProgram(c),e({setUniform:function(e,t){for(var i=[],n=arguments.length-2;n-- >0;)i[n]=arguments[n+2];var a=s[t]||(s[t]=r.getUniformLocation(c,t));r["uniform"+e].apply(r,[a].concat(i))},setAttribute:function(e,t,i,n,s){var l=a[e];l||(l=a[e]={buf:r.createBuffer(),loc:r.getAttribLocation(c,e),data:null}),r.bindBuffer(r.ARRAY_BUFFER,l.buf),r.vertexAttribPointer(l.loc,t,r.FLOAT,!1,0,0),r.enableVertexAttribArray(l.loc),o?r.vertexAttribDivisor(l.loc,n):A("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(l.loc,n),s!==l.data&&(r.bufferData(r.ARRAY_BUFFER,s,i),l.data=s)}})}}}l[e].transaction(n)},withTexture:function(e,t){h++;try{r.activeTexture(r.TEXTURE0+h);var i=c[e];i||(i=c[e]=r.createTexture(),r.bindTexture(r.TEXTURE_2D,i),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST)),r.bindTexture(r.TEXTURE_2D,i),t(i,h)}finally{h--}},withTextureFramebuffer:function(e,t,i){var n=r.createFramebuffer();u.push(n),r.bindFramebuffer(r.FRAMEBUFFER,n),r.activeTexture(r.TEXTURE0+t),r.bindTexture(r.TEXTURE_2D,e),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0);try{i(n)}finally{r.deleteFramebuffer(n),r.bindFramebuffer(r.FRAMEBUFFER,u[--u.length-1]||null)}},handleContextLoss:f})}t(i)}function s(e,t,r,n,a,s,l,c){void 0===l&&(l=15),void 0===c&&(c=null),o(e,function(e){var o=e.gl,h=e.withProgram;(0,e.withTexture)("copy",function(e,u){o.texImage2D(o.TEXTURE_2D,0,o.RGBA,a,s,0,o.RGBA,o.UNSIGNED_BYTE,t),h("copy",i,"precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",function(e){var t=e.setUniform;(0,e.setAttribute)("aUV",2,o.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),t("1i","image",u),o.bindFramebuffer(o.FRAMEBUFFER,c||null),o.disable(o.BLEND),o.colorMask(8&l,4&l,2&l,1&l),o.viewport(r,n,a,s),o.scissor(r,n,a,s),o.drawArrays(o.TRIANGLES,0,3)})})})}var l=Object.freeze({__proto__:null,withWebGLContext:o,renderImageData:s,resizeWebGLCanvasWithoutClearing:function(e,t,r){var i=e.width,n=e.height;o(e,function(a){var o=a.gl,l=new Uint8Array(i*n*4);o.readPixels(0,0,i,n,o.RGBA,o.UNSIGNED_BYTE,l),e.width=t,e.height=r,s(o,l,0,0,i,n)})}});function c(e,t,i,n,a,o){void 0===o&&(o=1);var s=new Uint8Array(e*t),l=n[2]-n[0],c=n[3]-n[1],h=[];r(i,function(e,t,r,i){h.push({x1:e,y1:t,x2:r,y2:i,minX:Math.min(e,r),minY:Math.min(t,i),maxX:Math.max(e,r),maxY:Math.max(t,i)})}),h.sort(function(e,t){return e.maxX-t.maxX});for(var u=0;u<e;u++)for(var A=0;A<t;A++){var d=function(e,t){for(var r=1/0,i=1/0,n=h.length;n--;){var a=h[n];if(a.maxX+i<=e)break;if(e+i>a.minX&&t-i<a.maxY&&t+i>a.minY){var o=function(e,t,r,i,n,a){var o=n-r,s=a-i,l=o*o+s*s,c=l?Math.max(0,Math.min(1,((e-r)*o+(t-i)*s)/l)):0,h=e-(r+c*o),u=t-(i+c*s);return h*h+u*u}(e,t,a.x1,a.y1,a.x2,a.y2);o<r&&(i=Math.sqrt(r=o))}}return function(e,t){for(var r=0,i=h.length;i--;){var n=h[i];if(n.maxX<=e)break;n.y1>t!=n.y2>t&&e<(n.x2-n.x1)*(t-n.y1)/(n.y2-n.y1)+n.x1&&(r+=n.y1<n.y2?1:-1)}return 0!==r}(e,t)&&(i=-i),i}(n[0]+l*(u+.5)/e,n[1]+c*(A+.5)/t),f=Math.pow(1-Math.abs(d)/a,o)/2;d<0&&(f=1-f),f=Math.max(0,Math.min(255,Math.round(255*f))),s[A*e+u]=f}return s}function h(e,t,r,i,n,a,o,s,l,c){void 0===a&&(a=1),void 0===s&&(s=0),void 0===l&&(l=0),void 0===c&&(c=0),u(e,t,r,i,n,a,o,null,s,l,c)}function u(e,t,r,i,n,a,o,l,h,u,A){void 0===a&&(a=1),void 0===h&&(h=0),void 0===u&&(u=0),void 0===A&&(A=0);for(var d=c(e,t,r,i,n,a),f=new Uint8Array(4*d.length),m=0;m<d.length;m++)f[4*m+A]=d[m];s(o,f,h,u,e,t,1<<3-A,l)}var A=Object.freeze({__proto__:null,generate:c,generateIntoCanvas:h,generateIntoFramebuffer:u}),d=new Float32Array([0,0,2,0,0,2]),f=null,m=!1,p={},g=new WeakMap;function v(e){if(!m&&!C(e))throw Error("WebGL generation not supported")}function y(e,t,r,i,n,a,s){if(void 0===a&&(a=1),void 0===s&&(s=null),!s&&!(s=f)){var l="function"==typeof OffscreenCanvas?new OffscreenCanvas(1,1):"undefined"!=typeof document?document.createElement("canvas"):null;if(!l)throw Error("OffscreenCanvas or DOM canvas not supported");s=f=l.getContext("webgl",{depth:!1})}v(s);var c=new Uint8Array(e*t*4);o(s,function(o){var s=o.gl,l=o.withTexture,h=o.withTextureFramebuffer;l("readable",function(o,l){s.texImage2D(s.TEXTURE_2D,0,s.RGBA,e,t,0,s.RGBA,s.UNSIGNED_BYTE,null),h(o,l,function(o){E(e,t,r,i,n,a,s,o,0,0,0),s.readPixels(0,0,e,t,s.RGBA,s.UNSIGNED_BYTE,c)})})});for(var h=new Uint8Array(e*t),u=0,A=0;u<c.length;u+=4)h[A++]=c[u];return h}function x(e,t,r,i,n,a,o,s,l,c){void 0===a&&(a=1),void 0===s&&(s=0),void 0===l&&(l=0),void 0===c&&(c=0),E(e,t,r,i,n,a,o,null,s,l,c)}function E(e,t,n,a,s,l,c,h,u,A,f){void 0===l&&(l=1),void 0===u&&(u=0),void 0===A&&(A=0),void 0===f&&(f=0),v(c);var m=[];r(n,function(e,t,r,i){m.push(e,t,r,i)}),m=new Float32Array(m),o(c,function(r){var n=r.gl,o=r.isWebGL2,c=r.getExtension,p=r.withProgram,g=r.withTexture,v=r.withTextureFramebuffer,y=r.handleContextLoss;if(g("rawDistances",function(r,g){(e!==r._lastWidth||t!==r._lastHeight)&&n.texImage2D(n.TEXTURE_2D,0,n.RGBA,r._lastWidth=e,r._lastHeight=t,0,n.RGBA,n.UNSIGNED_BYTE,null),p("main","precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}","precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",function(i){var h=i.setAttribute,u=i.setUniform,A=!o&&c("ANGLE_instanced_arrays"),f=!o&&c("EXT_blend_minmax");h("aUV",2,n.STATIC_DRAW,0,d),h("aLineSegment",4,n.DYNAMIC_DRAW,1,m),u.apply(void 0,["4f","uGlyphBounds"].concat(a)),u("1f","uMaxDistance",s),u("1f","uExponent",l),v(r,g,function(r){n.enable(n.BLEND),n.colorMask(!0,!0,!0,!0),n.viewport(0,0,e,t),n.scissor(0,0,e,t),n.blendFunc(n.ONE,n.ONE),n.blendEquationSeparate(n.FUNC_ADD,o?n.MAX:f.MAX_EXT),n.clear(n.COLOR_BUFFER_BIT),o?n.drawArraysInstanced(n.TRIANGLES,0,3,m.length/4):A.drawArraysInstancedANGLE(n.TRIANGLES,0,3,m.length/4)})}),p("post",i,"precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",function(r){r.setAttribute("aUV",2,n.STATIC_DRAW,0,d),r.setUniform("1i","tex",g),n.bindFramebuffer(n.FRAMEBUFFER,h),n.disable(n.BLEND),n.colorMask(0===f,1===f,2===f,3===f),n.viewport(u,A,e,t),n.scissor(u,A,e,t),n.drawArrays(n.TRIANGLES,0,3)})}),n.isContextLost())throw y(),Error("webgl context lost")})}function C(e){var t=e&&e!==f?e.canvas||e:p,r=g.get(t);if(void 0===r){m=!0;var i=null;try{var n=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],a=y(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,e);(r=a&&n.length===a.length&&a.every(function(e,t){return e===n[t]}))||(i="bad trial run results",console.info(n,a))}catch(e){r=!1,i=e.message}i&&console.warn("WebGL SDF generation not supported:",i),m=!1,g.set(t,r)}return r}var B=Object.freeze({__proto__:null,generate:y,generateIntoCanvas:x,generateIntoFramebuffer:E,isSupported:C});return e.forEachPathCommand=t,e.generate=function(e,t,r,i,n,a){void 0===n&&(n=Math.max(i[2]-i[0],i[3]-i[1])/2),void 0===a&&(a=1);try{return y.apply(B,arguments)}catch(e){return console.info("WebGL SDF generation failed, falling back to JS",e),c.apply(A,arguments)}},e.generateIntoCanvas=function(e,t,r,i,n,a,o,s,l,c){void 0===n&&(n=Math.max(i[2]-i[0],i[3]-i[1])/2),void 0===a&&(a=1),void 0===s&&(s=0),void 0===l&&(l=0),void 0===c&&(c=0);try{return x.apply(B,arguments)}catch(e){return console.info("WebGL SDF generation failed, falling back to JS",e),h.apply(A,arguments)}},e.javascript=A,e.pathToLineSegments=r,e.webgl=B,e.webglUtils=l,Object.defineProperty(e,"__esModule",{value:!0}),e}({})}var at=tw;let ar=/\bvoid\s+main\s*\(\s*\)\s*{/g;function ai(e){return e.replace(/^[ \t]*#include +<([\w\d./]+)>/gm,function(e,t){let r=nw.ShaderChunk[t];return r?ai(r):e})}let an=[];for(let e=0;e<256;e++)an[e]=(e<16?"0":"")+e.toString(16);let aa=Object.assign||function(){let e=arguments[0];for(let t=1,r=arguments.length;t<r;t++){let r=arguments[t];if(r)for(let t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])}return e},ao=Date.now(),as=new WeakMap,al=new Map,ac=1e10;function ah(e,t){let r,i,n=(r=JSON.stringify(t,aA),null==(i=af.get(r))&&af.set(r,i=++ad),i),a=as.get(e);if(a||as.set(e,a=Object.create(null)),a[n])return new a[n];let o=`_onBeforeCompile${n}`,s=function(r,i){e.onBeforeCompile.call(this,r,i);let a=this.customProgramCacheKey()+"|"+r.vertexShader+"|"+r.fragmentShader,s=al[a];if(!s){let e=function(e,{vertexShader:t,fragmentShader:r},i,n){let{vertexDefs:a,vertexMainIntro:o,vertexMainOutro:s,vertexTransform:l,fragmentDefs:c,fragmentMainIntro:h,fragmentMainOutro:u,fragmentColorTransform:A,customRewriter:d,timeUniform:f}=i;if(a=a||"",o=o||"",s=s||"",c=c||"",h=h||"",u=u||"",(l||d)&&(t=ai(t)),(A||d)&&(r=ai(r=r.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,"\n//!BEGIN_POST_CHUNK $1\n$&\n//!END_POST_CHUNK\n"))),d){let e=d({vertexShader:t,fragmentShader:r});t=e.vertexShader,r=e.fragmentShader}if(A){let e=[];r=r.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,t=>(e.push(t),"")),u=`${A}
${e.join("\n")}
${u}`}if(f){let e=`
uniform float ${f};
`;a=e+a,c=e+c}return l&&(t=`vec3 troika_position_${n};
vec3 troika_normal_${n};
vec2 troika_uv_${n};
${t}
`,a=`${a}
void troikaVertexTransform${n}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${l}
}
`,o=`
troika_position_${n} = vec3(position);
troika_normal_${n} = vec3(normal);
troika_uv_${n} = vec2(uv);
troikaVertexTransform${n}(troika_position_${n}, troika_normal_${n}, troika_uv_${n});
${o}
`,t=t.replace(/\b(position|normal|uv)\b/g,(e,t,r,i)=>/\battribute\s+vec[23]\s+$/.test(i.substr(0,r))?t:`troika_${t}_${n}`),e.map&&e.map.channel>0||(t=t.replace(/\bMAP_UV\b/g,`troika_uv_${n}`))),{vertexShader:t=au(t,n,a,o,s),fragmentShader:r=au(r,n,c,h,u)}}(this,r,t,n);s=al[a]=e}r.vertexShader=s.vertexShader,r.fragmentShader=s.fragmentShader,aa(r.uniforms,this.uniforms),t.timeUniform&&(r.uniforms[t.timeUniform]={get value(){return Date.now()-ao}}),this[o]&&this[o](r)},l=function(){return c(t.chained?e:e.clone())},c=function(r){let i,a,o,s,l=Object.create(r,h);return Object.defineProperty(l,"baseMaterial",{value:e}),Object.defineProperty(l,"id",{value:ac++}),i=0xffffffff*Math.random()|0,a=0xffffffff*Math.random()|0,o=0xffffffff*Math.random()|0,s=0xffffffff*Math.random()|0,l.uuid=(an[255&i]+an[i>>8&255]+an[i>>16&255]+an[i>>24&255]+"-"+an[255&a]+an[a>>8&255]+"-"+an[a>>16&15|64]+an[a>>24&255]+"-"+an[63&o|128]+an[o>>8&255]+"-"+an[o>>16&255]+an[o>>24&255]+an[255&s]+an[s>>8&255]+an[s>>16&255]+an[s>>24&255]).toUpperCase(),l.uniforms=aa({},r.uniforms,t.uniforms),l.defines=aa({},r.defines,t.defines),l.defines[`TROIKA_DERIVED_MATERIAL_${n}`]="",l.extensions=aa({},r.extensions,t.extensions),l._listeners=void 0,l},h={constructor:{value:l},isDerivedMaterial:{value:!0},type:{get:()=>e.type,set:t=>{e.type=t}},isDerivedFrom:{writable:!0,configurable:!0,value:function(e){let t=this.baseMaterial;return e===t||t.isDerivedMaterial&&t.isDerivedFrom(e)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return e.customProgramCacheKey()+"|"+n}},onBeforeCompile:{get:()=>s,set(e){this[o]=e}},copy:{writable:!0,configurable:!0,value:function(t){return e.copy.call(this,t),e.isShaderMaterial||e.isDerivedMaterial||(aa(this.extensions,t.extensions),aa(this.defines,t.defines),aa(this.uniforms,at.UniformsUtils.clone(t.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){return c(new e.constructor).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let r=this._depthMaterial;return r||((r=this._depthMaterial=ah(e.isDerivedMaterial?e.getDepthMaterial():new at.MeshDepthMaterial({depthPacking:at.RGBADepthPacking}),t)).defines.IS_DEPTH_MATERIAL="",r.uniforms=this.uniforms),r}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let r=this._distanceMaterial;return r||((r=this._distanceMaterial=ah(e.isDerivedMaterial?e.getDistanceMaterial():new at.MeshDistanceMaterial,t)).defines.IS_DISTANCE_MATERIAL="",r.uniforms=this.uniforms),r}},dispose:{writable:!0,configurable:!0,value(){let{_depthMaterial:t,_distanceMaterial:r}=this;t&&t.dispose(),r&&r.dispose(),e.dispose.call(this)}}};return a[n]=l,new l}function au(e,t,r,i,n){return(i||n||r)&&(e=e.replace(ar,`
${r}
void troikaOrigMain${t}() {`)+`
void main() {
  ${i}
  troikaOrigMain${t}();
  ${n}
}`),e}function aA(e,t){return"uniforms"===e?void 0:"function"==typeof t?t.toString():t}let ad=0,af=new Map,am=`
uniform vec3 pointA;
uniform vec3 controlA;
uniform vec3 controlB;
uniform vec3 pointB;
uniform float radius;
varying float bezierT;

vec3 cubicBezier(vec3 p1, vec3 c1, vec3 c2, vec3 p2, float t) {
  float t2 = 1.0 - t;
  float b0 = t2 * t2 * t2;
  float b1 = 3.0 * t * t2 * t2;
  float b2 = 3.0 * t * t * t2;
  float b3 = t * t * t;
  return b0 * p1 + b1 * c1 + b2 * c2 + b3 * p2;
}

vec3 cubicBezierDerivative(vec3 p1, vec3 c1, vec3 c2, vec3 p2, float t) {
  float t2 = 1.0 - t;
  return -3.0 * p1 * t2 * t2 +
    c1 * (3.0 * t2 * t2 - 6.0 * t2 * t) +
    c2 * (6.0 * t2 * t - 3.0 * t * t) +
    3.0 * p2 * t * t;
}
`,ap=`
float t = position.y;
bezierT = t;
vec3 bezierCenterPos = cubicBezier(pointA, controlA, controlB, pointB, t);
vec3 bezierDir = normalize(cubicBezierDerivative(pointA, controlA, controlB, pointB, t));

// Make "sideways" always perpendicular to the camera ray; this ensures that any twists
// in the cylinder occur where you won't see them: 
vec3 viewDirection = normalMatrix * vec3(0.0, 0.0, 1.0);
if (bezierDir == viewDirection) {
  bezierDir = normalize(cubicBezierDerivative(pointA, controlA, controlB, pointB, t == 1.0 ? t - 0.0001 : t + 0.0001));
}
vec3 sideways = normalize(cross(bezierDir, viewDirection));
vec3 upish = normalize(cross(sideways, bezierDir));

// Build a matrix for transforming this disc in the cylinder:
mat4 discTx;
discTx[0].xyz = sideways * radius;
discTx[1].xyz = bezierDir * radius;
discTx[2].xyz = upish * radius;
discTx[3].xyz = bezierCenterPos;
discTx[3][3] = 1.0;

// Apply transform, ignoring original y
position = (discTx * vec4(position.x, 0.0, position.z, 1.0)).xyz;
normal = normalize(mat3(discTx) * normal);
`,ag=`
uniform vec3 dashing;
varying float bezierT;
`,av=`
if (dashing.x + dashing.y > 0.0) {
  float dashFrac = mod(bezierT - dashing.z, dashing.x + dashing.y);
  if (dashFrac > dashing.x) {
    discard;
  }
}
`,ay=null,ax=new at.MeshStandardMaterial({color:0xffffff,side:at.DoubleSide});class aE extends at.Mesh{static getGeometry(){return ay||(ay=new at.CylinderGeometry(1,1,1,6,64).translate(0,.5,0))}constructor(){super(aE.getGeometry(),ax),this.pointA=new at.Vector3,this.controlA=new at.Vector3,this.controlB=new at.Vector3,this.pointB=new at.Vector3,this.radius=.01,this.dashArray=new at.Vector2,this.dashOffset=0,this.frustumCulled=!1}get material(){let e=this._derivedMaterial,t=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=ax.clone());return e&&e.baseMaterial===t||(e=this._derivedMaterial=ah(t,{chained:!0,uniforms:{pointA:{value:new at.Vector3},controlA:{value:new at.Vector3},controlB:{value:new at.Vector3},pointB:{value:new at.Vector3},radius:{value:.01},dashing:{value:new at.Vector3}},vertexDefs:am,vertexTransform:ap,fragmentDefs:ag,fragmentMainIntro:av}),t.addEventListener("dispose",function r(){t.removeEventListener("dispose",r),e.dispose()})),e}set material(e){this._baseMaterial=e}get customDepthMaterial(){return this.material.getDepthMaterial()}set customDepthMaterial(e){}get customDistanceMaterial(){return this.material.getDistanceMaterial()}set customDistanceMaterial(e){}onBeforeRender(){let{uniforms:e}=this.material,{pointA:t,controlA:r,controlB:i,pointB:n,radius:a,dashArray:o,dashOffset:s}=this;e.pointA.value.copy(t),e.controlA.value.copy(r),e.controlB.value.copy(i),e.pointB.value.copy(n),e.radius.value=a,e.dashing.value.set(o.x,o.y,s||0)}raycast(){}}let aC=n8({name:"Typr Font Parser",dependencies:[function(){var e,t,r;return"undefined"==typeof window&&(self.window=self),(e={},(t={parse:function(e){var r=t._bin,i=new Uint8Array(e);if("ttcf"==r.readASCII(i,0,4)){var n=4;r.readUshort(i,n),n+=2,r.readUshort(i,n),n+=2;var a=r.readUint(i,n);n+=4;for(var o=[],s=0;s<a;s++){var l=r.readUint(i,n);n+=4,o.push(t._readFont(i,l))}return o}return[t._readFont(i,0)]},_readFont:function(e,r){var i=t._bin,n=r;i.readFixed(e,r),r+=4;var a=i.readUshort(e,r);r+=2,i.readUshort(e,r),r+=2,i.readUshort(e,r),r+=2,i.readUshort(e,r),r+=2;for(var o=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],s={_data:e,_offset:n},l={},c=0;c<a;c++){var h=i.readASCII(e,r,4);r+=4,i.readUint(e,r),r+=4;var u=i.readUint(e,r);r+=4;var A=i.readUint(e,r);r+=4,l[h]={offset:u,length:A}}for(c=0;c<o.length;c++){var d=o[c];l[d]&&(s[d.trim()]=t[d.trim()].parse(e,l[d].offset,l[d].length,s))}return s},_tabOffset:function(e,r,i){for(var n=t._bin,a=n.readUshort(e,i+4),o=i+12,s=0;s<a;s++){var l=n.readASCII(e,o,4);o+=4,n.readUint(e,o),o+=4;var c=n.readUint(e,o);if(o+=4,n.readUint(e,o),o+=4,l==r)return c}return 0}})._bin={readFixed:function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<8|e[t+3])/65540},readF2dot14:function(e,r){return t._bin.readShort(e,r)/16384},readInt:function(e,r){return t._bin._view(e).getInt32(r)},readInt8:function(e,r){return t._bin._view(e).getInt8(r)},readShort:function(e,r){return t._bin._view(e).getInt16(r)},readUshort:function(e,r){return t._bin._view(e).getUint16(r)},readUshorts:function(e,r,i){for(var n=[],a=0;a<i;a++)n.push(t._bin.readUshort(e,r+2*a));return n},readUint:function(e,r){return t._bin._view(e).getUint32(r)},readUint64:function(e,r){return 0x100000000*t._bin.readUint(e,r)+t._bin.readUint(e,r+4)},readASCII:function(e,t,r){for(var i="",n=0;n<r;n++)i+=String.fromCharCode(e[t+n]);return i},readUnicode:function(e,t,r){for(var i="",n=0;n<r;n++)i+=String.fromCharCode(e[t++]<<8|e[t++]);return i},_tdec:"undefined"!=typeof window&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(e,r,i){var n=t._bin._tdec;return n&&0==r&&i==e.length?n.decode(e):t._bin.readASCII(e,r,i)},readBytes:function(e,t,r){for(var i=[],n=0;n<r;n++)i.push(e[t+n]);return i},readASCIIArray:function(e,t,r){for(var i=[],n=0;n<r;n++)i.push(String.fromCharCode(e[t+n]));return i},_view:function(e){return e._dataView||(e._dataView=e.buffer?new DataView(e.buffer,e.byteOffset,e.byteLength):new DataView(new Uint8Array(e).buffer))}},t._lctf={},t._lctf.parse=function(e,r,i,n,a){var o=t._bin,s={},l=r;o.readFixed(e,r),r+=4;var c=o.readUshort(e,r);r+=2;var h=o.readUshort(e,r);r+=2;var u=o.readUshort(e,r);return r+=2,s.scriptList=t._lctf.readScriptList(e,l+c),s.featureList=t._lctf.readFeatureList(e,l+h),s.lookupList=t._lctf.readLookupList(e,l+u,a),s},t._lctf.readLookupList=function(e,r,i){var n=t._bin,a=r,o=[],s=n.readUshort(e,r);r+=2;for(var l=0;l<s;l++){var c=n.readUshort(e,r);r+=2;var h=t._lctf.readLookupTable(e,a+c,i);o.push(h)}return o},t._lctf.readLookupTable=function(e,r,i){var n=t._bin,a=r,o={tabs:[]};o.ltype=n.readUshort(e,r),r+=2,o.flag=n.readUshort(e,r),r+=2;var s=n.readUshort(e,r);r+=2;for(var l=o.ltype,c=0;c<s;c++){var h=n.readUshort(e,r);r+=2;var u=i(e,l,a+h,o);o.tabs.push(u)}return o},t._lctf.numOfOnes=function(e){for(var t=0,r=0;r<32;r++)0!=(e>>>r&1)&&t++;return t},t._lctf.readClassDef=function(e,r){var i=t._bin,n=[],a=i.readUshort(e,r);if(r+=2,1==a){var o=i.readUshort(e,r);r+=2;var s=i.readUshort(e,r);r+=2;for(var l=0;l<s;l++)n.push(o+l),n.push(o+l),n.push(i.readUshort(e,r)),r+=2}if(2==a){var c=i.readUshort(e,r);for(r+=2,l=0;l<c;l++)n.push(i.readUshort(e,r)),r+=2,n.push(i.readUshort(e,r)),r+=2,n.push(i.readUshort(e,r)),r+=2}return n},t._lctf.getInterval=function(e,t){for(var r=0;r<e.length;r+=3){var i=e[r],n=e[r+1];if(e[r+2],i<=t&&t<=n)return r}return -1},t._lctf.readCoverage=function(e,r){var i=t._bin,n={};n.fmt=i.readUshort(e,r),r+=2;var a=i.readUshort(e,r);return r+=2,1==n.fmt&&(n.tab=i.readUshorts(e,r,a)),2==n.fmt&&(n.tab=i.readUshorts(e,r,3*a)),n},t._lctf.coverageIndex=function(e,r){var i=e.tab;if(1==e.fmt)return i.indexOf(r);if(2==e.fmt){var n=t._lctf.getInterval(i,r);if(-1!=n)return i[n+2]+(r-i[n])}return -1},t._lctf.readFeatureList=function(e,r){var i=t._bin,n=r,a=[],o=i.readUshort(e,r);r+=2;for(var s=0;s<o;s++){var l=i.readASCII(e,r,4);r+=4;var c=i.readUshort(e,r);r+=2;var h=t._lctf.readFeatureTable(e,n+c);h.tag=l.trim(),a.push(h)}return a},t._lctf.readFeatureTable=function(e,r){var i=t._bin,n=r,a={},o=i.readUshort(e,r);r+=2,o>0&&(a.featureParams=n+o);var s=i.readUshort(e,r);r+=2,a.tab=[];for(var l=0;l<s;l++)a.tab.push(i.readUshort(e,r+2*l));return a},t._lctf.readScriptList=function(e,r){var i=t._bin,n=r,a={},o=i.readUshort(e,r);r+=2;for(var s=0;s<o;s++){var l=i.readASCII(e,r,4);r+=4;var c=i.readUshort(e,r);r+=2,a[l.trim()]=t._lctf.readScriptTable(e,n+c)}return a},t._lctf.readScriptTable=function(e,r){var i=t._bin,n=r,a={},o=i.readUshort(e,r);r+=2,o>0&&(a.default=t._lctf.readLangSysTable(e,n+o));var s=i.readUshort(e,r);r+=2;for(var l=0;l<s;l++){var c=i.readASCII(e,r,4);r+=4;var h=i.readUshort(e,r);r+=2,a[c.trim()]=t._lctf.readLangSysTable(e,n+h)}return a},t._lctf.readLangSysTable=function(e,r){var i=t._bin,n={};i.readUshort(e,r),r+=2,n.reqFeature=i.readUshort(e,r),r+=2;var a=i.readUshort(e,r);return r+=2,n.features=i.readUshorts(e,r,a),n},t.CFF={},t.CFF.parse=function(e,r,i){var n=t._bin;(e=new Uint8Array(e.buffer,r,i))[r=0],e[++r],e[++r],e[++r],r++;var a=[];r=t.CFF.readIndex(e,r,a);for(var o=[],s=0;s<a.length-1;s++)o.push(n.readASCII(e,r+a[s],a[s+1]-a[s]));r+=a[a.length-1];var l=[];r=t.CFF.readIndex(e,r,l);var c=[];for(s=0;s<l.length-1;s++)c.push(t.CFF.readDict(e,r+l[s],r+l[s+1]));r+=l[l.length-1];var h=c[0],u=[];r=t.CFF.readIndex(e,r,u);var A=[];for(s=0;s<u.length-1;s++)A.push(n.readASCII(e,r+u[s],u[s+1]-u[s]));if(r+=u[u.length-1],t.CFF.readSubrs(e,r,h),h.CharStrings){r=h.CharStrings,u=[],r=t.CFF.readIndex(e,r,u);var d=[];for(s=0;s<u.length-1;s++)d.push(n.readBytes(e,r+u[s],u[s+1]-u[s]));h.CharStrings=d}if(h.ROS){r=h.FDArray;var f=[];for(r=t.CFF.readIndex(e,r,f),h.FDArray=[],s=0;s<f.length-1;s++){var m=t.CFF.readDict(e,r+f[s],r+f[s+1]);t.CFF._readFDict(e,m,A),h.FDArray.push(m)}r+=f[f.length-1],r=h.FDSelect,h.FDSelect=[];var p=e[r];if(r++,3!=p)throw p;var g=n.readUshort(e,r);for(r+=2,s=0;s<g+1;s++)h.FDSelect.push(n.readUshort(e,r),e[r+2]),r+=3}return h.Encoding&&(h.Encoding=t.CFF.readEncoding(e,h.Encoding,h.CharStrings.length)),h.charset&&(h.charset=t.CFF.readCharset(e,h.charset,h.CharStrings.length)),t.CFF._readFDict(e,h,A),h},t.CFF._readFDict=function(e,r,i){var n;for(var a in r.Private&&(n=r.Private[1],r.Private=t.CFF.readDict(e,n,n+r.Private[0]),r.Private.Subrs&&t.CFF.readSubrs(e,n+r.Private.Subrs,r.Private)),r)-1!=["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(a)&&(r[a]=i[r[a]-426+35])},t.CFF.readSubrs=function(e,r,i){var n=t._bin,a=[];r=t.CFF.readIndex(e,r,a);var o=a.length;i.Bias=o<1240?107:o<33900?1131:32768,i.Subrs=[];for(var s=0;s<a.length-1;s++)i.Subrs.push(n.readBytes(e,r+a[s],a[s+1]-a[s]))},t.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],t.CFF.glyphByUnicode=function(e,t){for(var r=0;r<e.charset.length;r++)if(e.charset[r]==t)return r;return -1},t.CFF.glyphBySE=function(e,r){return r<0||r>255?-1:t.CFF.glyphByUnicode(e,t.CFF.tableSE[r])},t.CFF.readEncoding=function(e,r,i){t._bin;var n=[".notdef"],a=e[r];if(r++,0!=a)throw"error: unknown encoding format: "+a;var o=e[r];r++;for(var s=0;s<o;s++)n.push(e[r+s]);return n},t.CFF.readCharset=function(e,r,i){var n=t._bin,a=[".notdef"],o=e[r];if(r++,0==o)for(var s=0;s<i;s++){var l=n.readUshort(e,r);r+=2,a.push(l)}else{if(1!=o&&2!=o)throw"error: format: "+o;for(;a.length<i;){l=n.readUshort(e,r),r+=2;var c=0;for(1==o?(c=e[r],r++):(c=n.readUshort(e,r),r+=2),s=0;s<=c;s++)a.push(l),l++}}return a},t.CFF.readIndex=function(e,r,i){var n=t._bin,a=n.readUshort(e,r)+1,o=e[r+=2];if(r++,1==o)for(var s=0;s<a;s++)i.push(e[r+s]);else if(2==o)for(s=0;s<a;s++)i.push(n.readUshort(e,r+2*s));else if(3==o)for(s=0;s<a;s++)i.push(0xffffff&n.readUint(e,r+3*s-1));else if(1!=a)throw"unsupported offset size: "+o+", count: "+a;return(r+=a*o)-1},t.CFF.getCharString=function(e,r,i){var n=t._bin,a=e[r],o=e[r+1];e[r+2],e[r+3],e[r+4];var s=1,l=null,c=null;a<=20&&(l=a,s=1),12==a&&(l=100*a+o,s=2),21<=a&&a<=27&&(l=a,s=1),28==a&&(c=n.readShort(e,r+1),s=3),29<=a&&a<=31&&(l=a,s=1),32<=a&&a<=246&&(c=a-139,s=1),247<=a&&a<=250&&(c=256*(a-247)+o+108,s=2),251<=a&&a<=254&&(c=-(256*(a-251))-o-108,s=2),255==a&&(c=n.readInt(e,r+1)/65535,s=5),i.val=null!=c?c:"o"+l,i.size=s},t.CFF.readCharString=function(e,r,i){for(var n=r+i,a=t._bin,o=[];r<n;){var s=e[r],l=e[r+1];e[r+2],e[r+3],e[r+4];var c=1,h=null,u=null;s<=20&&(h=s,c=1),12==s&&(h=100*s+l,c=2),19!=s&&20!=s||(h=s,c=2),21<=s&&s<=27&&(h=s,c=1),28==s&&(u=a.readShort(e,r+1),c=3),29<=s&&s<=31&&(h=s,c=1),32<=s&&s<=246&&(u=s-139,c=1),247<=s&&s<=250&&(u=256*(s-247)+l+108,c=2),251<=s&&s<=254&&(u=-(256*(s-251))-l-108,c=2),255==s&&(u=a.readInt(e,r+1)/65535,c=5),o.push(null!=u?u:"o"+h),r+=c}return o},t.CFF.readDict=function(e,r,i){for(var n=t._bin,a={},o=[];r<i;){var s=e[r],l=e[r+1];e[r+2],e[r+3],e[r+4];var c=1,h=null,u=null;if(28==s&&(u=n.readShort(e,r+1),c=3),29==s&&(u=n.readInt(e,r+1),c=5),32<=s&&s<=246&&(u=s-139,c=1),247<=s&&s<=250&&(u=256*(s-247)+l+108,c=2),251<=s&&s<=254&&(u=-(256*(s-251))-l-108,c=2),255==s)throw u=n.readInt(e,r+1)/65535,c=5,"unknown number";if(30==s){var A=[];for(c=1;;){var d=e[r+c];c++;var f=d>>4,m=15&d;if(15!=f&&A.push(f),15!=m&&A.push(m),15==m)break}for(var p="",g=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],v=0;v<A.length;v++)p+=g[A[v]];u=parseFloat(p)}s<=21&&(h=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][s],c=1,12==s)&&(h=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][l],c=2),null!=h?(a[h]=1==o.length?o[0]:o,o=[]):o.push(u),r+=c}return a},t.cmap={},t.cmap.parse=function(e,r,i){e=new Uint8Array(e.buffer,r,i),r=0;var n=t._bin,a={};n.readUshort(e,r),r+=2;var o=n.readUshort(e,r);r+=2;var s=[];a.tables=[];for(var l=0;l<o;l++){var c=n.readUshort(e,r);r+=2;var h=n.readUshort(e,r);r+=2;var u=n.readUint(e,r);r+=4;var A="p"+c+"e"+h,d=s.indexOf(u);if(-1==d){d=a.tables.length,s.push(u);var f,m=n.readUshort(e,u);0==m?f=t.cmap.parse0(e,u):4==m?f=t.cmap.parse4(e,u):6==m?f=t.cmap.parse6(e,u):12==m?f=t.cmap.parse12(e,u):console.debug("unknown format: "+m,c,h,u),a.tables.push(f)}if(null!=a[A])throw"multiple tables for one platform+encoding";a[A]=d}return a},t.cmap.parse0=function(e,r){var i=t._bin,n={};n.format=i.readUshort(e,r),r+=2;var a=i.readUshort(e,r);r+=2,i.readUshort(e,r),r+=2,n.map=[];for(var o=0;o<a-6;o++)n.map.push(e[r+o]);return n},t.cmap.parse4=function(e,r){var i=t._bin,n=r,a={};a.format=i.readUshort(e,r),r+=2;var o=i.readUshort(e,r);r+=2,i.readUshort(e,r),r+=2;var s=i.readUshort(e,r);r+=2;var l=s/2;a.searchRange=i.readUshort(e,r),r+=2,a.entrySelector=i.readUshort(e,r),r+=2,a.rangeShift=i.readUshort(e,r),r+=2,a.endCount=i.readUshorts(e,r,l),r+=2*l,r+=2,a.startCount=i.readUshorts(e,r,l),r+=2*l,a.idDelta=[];for(var c=0;c<l;c++)a.idDelta.push(i.readShort(e,r)),r+=2;for(a.idRangeOffset=i.readUshorts(e,r,l),r+=2*l,a.glyphIdArray=[];r<n+o;)a.glyphIdArray.push(i.readUshort(e,r)),r+=2;return a},t.cmap.parse6=function(e,r){var i=t._bin,n={};n.format=i.readUshort(e,r),r+=2,i.readUshort(e,r),r+=2,i.readUshort(e,r),r+=2,n.firstCode=i.readUshort(e,r),r+=2;var a=i.readUshort(e,r);r+=2,n.glyphIdArray=[];for(var o=0;o<a;o++)n.glyphIdArray.push(i.readUshort(e,r)),r+=2;return n},t.cmap.parse12=function(e,r){var i=t._bin,n={};n.format=i.readUshort(e,r),r+=2,r+=2,i.readUint(e,r),r+=4,i.readUint(e,r),r+=4;var a=i.readUint(e,r);r+=4,n.groups=[];for(var o=0;o<a;o++){var s=r+12*o,l=i.readUint(e,s+0),c=i.readUint(e,s+4),h=i.readUint(e,s+8);n.groups.push([l,c,h])}return n},t.glyf={},t.glyf.parse=function(e,t,r,i){for(var n=[],a=0;a<i.maxp.numGlyphs;a++)n.push(null);return n},t.glyf._parseGlyf=function(e,r){var i,n=t._bin,a=e._data,o=t._tabOffset(a,"glyf",e._offset)+e.loca[r];if(e.loca[r]==e.loca[r+1])return null;var s={};if(s.noc=n.readShort(a,o),o+=2,s.xMin=n.readShort(a,o),o+=2,s.yMin=n.readShort(a,o),o+=2,s.xMax=n.readShort(a,o),o+=2,s.yMax=n.readShort(a,o),o+=2,s.xMin>=s.xMax||s.yMin>=s.yMax)return null;if(s.noc>0){s.endPts=[];for(var l=0;l<s.noc;l++)s.endPts.push(n.readUshort(a,o)),o+=2;var c=n.readUshort(a,o);if(o+=2,a.length-o<c)return null;s.instructions=n.readBytes(a,o,c),o+=c;var h=s.endPts[s.noc-1]+1;for(l=0,s.flags=[];l<h;l++){var u=a[o];if(o++,s.flags.push(u),0!=(8&u)){var A=a[o];o++;for(var d=0;d<A;d++)s.flags.push(u),l++}}for(l=0,s.xs=[];l<h;l++){var f=0!=(2&s.flags[l]),m=0!=(16&s.flags[l]);f?(s.xs.push(m?a[o]:-a[o]),o++):m?s.xs.push(0):(s.xs.push(n.readShort(a,o)),o+=2)}for(l=0,s.ys=[];l<h;l++)f=0!=(4&s.flags[l]),m=0!=(32&s.flags[l]),f?(s.ys.push(m?a[o]:-a[o]),o++):m?s.ys.push(0):(s.ys.push(n.readShort(a,o)),o+=2);var p=0,g=0;for(l=0;l<h;l++)p+=s.xs[l],g+=s.ys[l],s.xs[l]=p,s.ys[l]=g}else{s.parts=[];do{i=n.readUshort(a,o),o+=2;var v={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(s.parts.push(v),v.glyphIndex=n.readUshort(a,o),o+=2,1&i){var y=n.readShort(a,o);o+=2;var x=n.readShort(a,o);o+=2}else y=n.readInt8(a,o),o++,x=n.readInt8(a,o),o++;2&i?(v.m.tx=y,v.m.ty=x):(v.p1=y,v.p2=x),8&i?(v.m.a=v.m.d=n.readF2dot14(a,o),o+=2):64&i?(v.m.a=n.readF2dot14(a,o),o+=2,v.m.d=n.readF2dot14(a,o),o+=2):128&i&&(v.m.a=n.readF2dot14(a,o),o+=2,v.m.b=n.readF2dot14(a,o),o+=2,v.m.c=n.readF2dot14(a,o),o+=2,v.m.d=n.readF2dot14(a,o),o+=2)}while(32&i)if(256&i){var E=n.readUshort(a,o);for(o+=2,s.instr=[],l=0;l<E;l++)s.instr.push(a[o]),o++}}return s},t.GDEF={},t.GDEF.parse=function(e,r,i,n){var a=r;r+=4;var o=t._bin.readUshort(e,r);return{glyphClassDef:0===o?null:t._lctf.readClassDef(e,a+o)}},t.GPOS={},t.GPOS.parse=function(e,r,i,n){return t._lctf.parse(e,r,i,n,t.GPOS.subt)},t.GPOS.subt=function(e,r,i,n){var a=t._bin,o=i,s={};if(s.fmt=a.readUshort(e,i),i+=2,1==r||2==r||3==r||7==r||8==r&&s.fmt<=2){var l=a.readUshort(e,i);i+=2,s.coverage=t._lctf.readCoverage(e,l+o)}if(1==r&&1==s.fmt){var c=a.readUshort(e,i);i+=2,0!=c&&(s.pos=t.GPOS.readValueRecord(e,i,c))}else if(2==r&&s.fmt>=1&&s.fmt<=2){c=a.readUshort(e,i),i+=2;var h=a.readUshort(e,i);i+=2;var u=t._lctf.numOfOnes(c),A=t._lctf.numOfOnes(h);if(1==s.fmt){s.pairsets=[];var d=a.readUshort(e,i);i+=2;for(var f=0;f<d;f++){var m=o+a.readUshort(e,i);i+=2;var p=a.readUshort(e,m);m+=2;for(var g=[],v=0;v<p;v++){var y=a.readUshort(e,m);m+=2,0!=c&&(I=t.GPOS.readValueRecord(e,m,c),m+=2*u),0!=h&&(b=t.GPOS.readValueRecord(e,m,h),m+=2*A),g.push({gid2:y,val1:I,val2:b})}s.pairsets.push(g)}}if(2==s.fmt){var x=a.readUshort(e,i);i+=2;var E=a.readUshort(e,i);i+=2;var C=a.readUshort(e,i);i+=2;var B=a.readUshort(e,i);for(i+=2,s.classDef1=t._lctf.readClassDef(e,o+x),s.classDef2=t._lctf.readClassDef(e,o+E),s.matrix=[],f=0;f<C;f++){var w=[];for(v=0;v<B;v++){var I=null,b=null;0!=c&&(I=t.GPOS.readValueRecord(e,i,c),i+=2*u),0!=h&&(b=t.GPOS.readValueRecord(e,i,h),i+=2*A),w.push({val1:I,val2:b})}s.matrix.push(w)}}}else if(4==r&&1==s.fmt)s.markCoverage=t._lctf.readCoverage(e,a.readUshort(e,i)+o),s.baseCoverage=t._lctf.readCoverage(e,a.readUshort(e,i+2)+o),s.markClassCount=a.readUshort(e,i+4),s.markArray=t.GPOS.readMarkArray(e,a.readUshort(e,i+6)+o),s.baseArray=t.GPOS.readBaseArray(e,a.readUshort(e,i+8)+o,s.markClassCount);else if(6==r&&1==s.fmt)s.mark1Coverage=t._lctf.readCoverage(e,a.readUshort(e,i)+o),s.mark2Coverage=t._lctf.readCoverage(e,a.readUshort(e,i+2)+o),s.markClassCount=a.readUshort(e,i+4),s.mark1Array=t.GPOS.readMarkArray(e,a.readUshort(e,i+6)+o),s.mark2Array=t.GPOS.readBaseArray(e,a.readUshort(e,i+8)+o,s.markClassCount);else{if(9==r&&1==s.fmt){var _=a.readUshort(e,i);i+=2;var M=a.readUint(e,i);if(i+=4,9==n.ltype)n.ltype=_;else if(n.ltype!=_)throw"invalid extension substitution";return t.GPOS.subt(e,n.ltype,o+M)}console.debug("unsupported GPOS table LookupType",r,"format",s.fmt)}return s},t.GPOS.readValueRecord=function(e,r,i){var n=t._bin,a=[];return a.push(1&i?n.readShort(e,r):0),r+=1&i?2:0,a.push(2&i?n.readShort(e,r):0),r+=2&i?2:0,a.push(4&i?n.readShort(e,r):0),r+=4&i?2:0,a.push(8&i?n.readShort(e,r):0),r+=8&i?2:0,a},t.GPOS.readBaseArray=function(e,r,i){var n=t._bin,a=[],o=r,s=n.readUshort(e,r);r+=2;for(var l=0;l<s;l++){for(var c=[],h=0;h<i;h++)c.push(t.GPOS.readAnchorRecord(e,o+n.readUshort(e,r))),r+=2;a.push(c)}return a},t.GPOS.readMarkArray=function(e,r){var i=t._bin,n=[],a=r,o=i.readUshort(e,r);r+=2;for(var s=0;s<o;s++){var l=t.GPOS.readAnchorRecord(e,i.readUshort(e,r+2)+a);l.markClass=i.readUshort(e,r),n.push(l),r+=4}return n},t.GPOS.readAnchorRecord=function(e,r){var i=t._bin,n={};return n.fmt=i.readUshort(e,r),n.x=i.readShort(e,r+2),n.y=i.readShort(e,r+4),n},t.GSUB={},t.GSUB.parse=function(e,r,i,n){return t._lctf.parse(e,r,i,n,t.GSUB.subt)},t.GSUB.subt=function(e,r,i,n){var a=t._bin,o=i,s={};if(s.fmt=a.readUshort(e,i),i+=2,1!=r&&2!=r&&4!=r&&5!=r&&6!=r)return null;if(1==r||2==r||4==r||5==r&&s.fmt<=2||6==r&&s.fmt<=2){var l=a.readUshort(e,i);i+=2,s.coverage=t._lctf.readCoverage(e,o+l)}if(1==r&&s.fmt>=1&&s.fmt<=2){if(1==s.fmt)s.delta=a.readShort(e,i),i+=2;else if(2==s.fmt){var c=a.readUshort(e,i);i+=2,s.newg=a.readUshorts(e,i,c),i+=2*s.newg.length}}else if(2==r&&1==s.fmt){c=a.readUshort(e,i),i+=2,s.seqs=[];for(var h=0;h<c;h++){var u=a.readUshort(e,i)+o;i+=2;var A=a.readUshort(e,u);s.seqs.push(a.readUshorts(e,u+2,A))}}else if(4==r)for(s.vals=[],c=a.readUshort(e,i),i+=2,h=0;h<c;h++){var d=a.readUshort(e,i);i+=2,s.vals.push(t.GSUB.readLigatureSet(e,o+d))}else if(5==r&&2==s.fmt){if(2==s.fmt){var f=a.readUshort(e,i);i+=2,s.cDef=t._lctf.readClassDef(e,o+f),s.scset=[];var m=a.readUshort(e,i);for(i+=2,h=0;h<m;h++){var p=a.readUshort(e,i);i+=2,s.scset.push(0==p?null:t.GSUB.readSubClassSet(e,o+p))}}}else if(6==r&&3==s.fmt){if(3==s.fmt){for(h=0;h<3;h++){c=a.readUshort(e,i),i+=2;for(var g=[],v=0;v<c;v++)g.push(t._lctf.readCoverage(e,o+a.readUshort(e,i+2*v)));i+=2*c,0==h&&(s.backCvg=g),1==h&&(s.inptCvg=g),2==h&&(s.ahedCvg=g)}c=a.readUshort(e,i),i+=2,s.lookupRec=t.GSUB.readSubstLookupRecords(e,i,c)}}else{if(7==r&&1==s.fmt){var y=a.readUshort(e,i);i+=2;var x=a.readUint(e,i);if(i+=4,9==n.ltype)n.ltype=y;else if(n.ltype!=y)throw"invalid extension substitution";return t.GSUB.subt(e,n.ltype,o+x)}console.debug("unsupported GSUB table LookupType",r,"format",s.fmt)}return s},t.GSUB.readSubClassSet=function(e,r){var i=t._bin.readUshort,n=r,a=[],o=i(e,r);r+=2;for(var s=0;s<o;s++){var l=i(e,r);r+=2,a.push(t.GSUB.readSubClassRule(e,n+l))}return a},t.GSUB.readSubClassRule=function(e,r){var i=t._bin.readUshort,n={},a=i(e,r),o=i(e,r+=2);r+=2,n.input=[];for(var s=0;s<a-1;s++)n.input.push(i(e,r)),r+=2;return n.substLookupRecords=t.GSUB.readSubstLookupRecords(e,r,o),n},t.GSUB.readSubstLookupRecords=function(e,r,i){for(var n=t._bin.readUshort,a=[],o=0;o<i;o++)a.push(n(e,r),n(e,r+2)),r+=4;return a},t.GSUB.readChainSubClassSet=function(e,r){var i=t._bin,n=r,a=[],o=i.readUshort(e,r);r+=2;for(var s=0;s<o;s++){var l=i.readUshort(e,r);r+=2,a.push(t.GSUB.readChainSubClassRule(e,n+l))}return a},t.GSUB.readChainSubClassRule=function(e,r){for(var i=t._bin,n={},a=["backtrack","input","lookahead"],o=0;o<a.length;o++){var s=i.readUshort(e,r);r+=2,1==o&&s--,n[a[o]]=i.readUshorts(e,r,s),r+=2*n[a[o]].length}return s=i.readUshort(e,r),r+=2,n.subst=i.readUshorts(e,r,2*s),r+=2*n.subst.length,n},t.GSUB.readLigatureSet=function(e,r){var i=t._bin,n=r,a=[],o=i.readUshort(e,r);r+=2;for(var s=0;s<o;s++){var l=i.readUshort(e,r);r+=2,a.push(t.GSUB.readLigature(e,n+l))}return a},t.GSUB.readLigature=function(e,r){var i=t._bin,n={chain:[]};n.nglyph=i.readUshort(e,r),r+=2;var a=i.readUshort(e,r);r+=2;for(var o=0;o<a-1;o++)n.chain.push(i.readUshort(e,r)),r+=2;return n},t.head={},t.head.parse=function(e,r,i){var n=t._bin,a={};return n.readFixed(e,r),r+=4,a.fontRevision=n.readFixed(e,r),r+=4,n.readUint(e,r),r+=4,n.readUint(e,r),r+=4,a.flags=n.readUshort(e,r),r+=2,a.unitsPerEm=n.readUshort(e,r),r+=2,a.created=n.readUint64(e,r),r+=8,a.modified=n.readUint64(e,r),r+=8,a.xMin=n.readShort(e,r),r+=2,a.yMin=n.readShort(e,r),r+=2,a.xMax=n.readShort(e,r),r+=2,a.yMax=n.readShort(e,r),r+=2,a.macStyle=n.readUshort(e,r),r+=2,a.lowestRecPPEM=n.readUshort(e,r),r+=2,a.fontDirectionHint=n.readShort(e,r),r+=2,a.indexToLocFormat=n.readShort(e,r),r+=2,a.glyphDataFormat=n.readShort(e,r),r+=2,a},t.hhea={},t.hhea.parse=function(e,r,i){var n=t._bin,a={};return n.readFixed(e,r),r+=4,a.ascender=n.readShort(e,r),r+=2,a.descender=n.readShort(e,r),r+=2,a.lineGap=n.readShort(e,r),r+=2,a.advanceWidthMax=n.readUshort(e,r),r+=2,a.minLeftSideBearing=n.readShort(e,r),r+=2,a.minRightSideBearing=n.readShort(e,r),r+=2,a.xMaxExtent=n.readShort(e,r),r+=2,a.caretSlopeRise=n.readShort(e,r),r+=2,a.caretSlopeRun=n.readShort(e,r),r+=2,a.caretOffset=n.readShort(e,r),r+=2,r+=8,a.metricDataFormat=n.readShort(e,r),r+=2,a.numberOfHMetrics=n.readUshort(e,r),r+=2,a},t.hmtx={},t.hmtx.parse=function(e,r,i,n){for(var a=t._bin,o={aWidth:[],lsBearing:[]},s=0,l=0,c=0;c<n.maxp.numGlyphs;c++)c<n.hhea.numberOfHMetrics&&(s=a.readUshort(e,r),r+=2,l=a.readShort(e,r),r+=2),o.aWidth.push(s),o.lsBearing.push(l);return o},t.kern={},t.kern.parse=function(e,r,i,n){var a=t._bin,o=a.readUshort(e,r);if(r+=2,1==o)return t.kern.parseV1(e,r-2,i,n);var s=a.readUshort(e,r);r+=2;for(var l={glyph1:[],rval:[]},c=0;c<s;c++){r+=2,i=a.readUshort(e,r),r+=2;var h=a.readUshort(e,r);r+=2;var u=h>>>8;if(0!=(u&=15))throw"unknown kern table format: "+u;r=t.kern.readFormat0(e,r,l)}return l},t.kern.parseV1=function(e,r,i,n){var a=t._bin;a.readFixed(e,r),r+=4;var o=a.readUint(e,r);r+=4;for(var s={glyph1:[],rval:[]},l=0;l<o;l++){a.readUint(e,r),r+=4;var c=a.readUshort(e,r);r+=2,a.readUshort(e,r),r+=2;var h=c>>>8;if(0!=(h&=15))throw"unknown kern table format: "+h;r=t.kern.readFormat0(e,r,s)}return s},t.kern.readFormat0=function(e,r,i){var n=t._bin,a=-1,o=n.readUshort(e,r);r+=2,n.readUshort(e,r),r+=2,n.readUshort(e,r),r+=2,n.readUshort(e,r),r+=2;for(var s=0;s<o;s++){var l=n.readUshort(e,r);r+=2;var c=n.readUshort(e,r);r+=2;var h=n.readShort(e,r);r+=2,l!=a&&(i.glyph1.push(l),i.rval.push({glyph2:[],vals:[]}));var u=i.rval[i.rval.length-1];u.glyph2.push(c),u.vals.push(h),a=l}return r},t.loca={},t.loca.parse=function(e,r,i,n){var a=t._bin,o=[],s=n.head.indexToLocFormat,l=n.maxp.numGlyphs+1;if(0==s)for(var c=0;c<l;c++)o.push(a.readUshort(e,r+(c<<1))<<1);if(1==s)for(c=0;c<l;c++)o.push(a.readUint(e,r+(c<<2)));return o},t.maxp={},t.maxp.parse=function(e,r,i){var n=t._bin,a={},o=n.readUint(e,r);return r+=4,a.numGlyphs=n.readUshort(e,r),r+=2,65536==o&&(a.maxPoints=n.readUshort(e,r),r+=2,a.maxContours=n.readUshort(e,r),r+=2,a.maxCompositePoints=n.readUshort(e,r),r+=2,a.maxCompositeContours=n.readUshort(e,r),r+=2,a.maxZones=n.readUshort(e,r),r+=2,a.maxTwilightPoints=n.readUshort(e,r),r+=2,a.maxStorage=n.readUshort(e,r),r+=2,a.maxFunctionDefs=n.readUshort(e,r),r+=2,a.maxInstructionDefs=n.readUshort(e,r),r+=2,a.maxStackElements=n.readUshort(e,r),r+=2,a.maxSizeOfInstructions=n.readUshort(e,r),r+=2,a.maxComponentElements=n.readUshort(e,r),r+=2,a.maxComponentDepth=n.readUshort(e,r),r+=2),a},t.name={},t.name.parse=function(e,r,i){var n=t._bin,a={};n.readUshort(e,r),r+=2;var o=n.readUshort(e,r);r+=2,n.readUshort(e,r);for(var s,l=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],c=r+=2,h=0;h<o;h++){var u=n.readUshort(e,r);r+=2;var A=n.readUshort(e,r);r+=2;var d=n.readUshort(e,r);r+=2;var f=n.readUshort(e,r);r+=2;var m=n.readUshort(e,r);r+=2;var p=n.readUshort(e,r);r+=2;var g,v=l[f],y=c+12*o+p;if(0==u)g=n.readUnicode(e,y,m/2);else if(3==u&&0==A)g=n.readUnicode(e,y,m/2);else if(0==A)g=n.readASCII(e,y,m);else if(1==A)g=n.readUnicode(e,y,m/2);else if(3==A)g=n.readUnicode(e,y,m/2);else{if(1!=u)throw"unknown encoding "+A+", platformID: "+u;g=n.readASCII(e,y,m),console.debug("reading unknown MAC encoding "+A+" as ASCII")}var x="p"+u+","+d.toString(16);null==a[x]&&(a[x]={}),a[x][void 0!==v?v:f]=g,a[x]._lang=d}for(var E in a)if(null!=a[E].postScriptName&&1033==a[E]._lang)return a[E];for(var E in a)if(null!=a[E].postScriptName&&0==a[E]._lang)return a[E];for(var E in a)if(null!=a[E].postScriptName&&3084==a[E]._lang)return a[E];for(var E in a)if(null!=a[E].postScriptName)return a[E];for(var E in a){s=E;break}return console.debug("returning name table with languageID "+a[s]._lang),a[s]},t["OS/2"]={},t["OS/2"].parse=function(e,r,i){var n=t._bin.readUshort(e,r);r+=2;var a={};if(0==n)t["OS/2"].version0(e,r,a);else if(1==n)t["OS/2"].version1(e,r,a);else if(2==n||3==n||4==n)t["OS/2"].version2(e,r,a);else{if(5!=n)throw"unknown OS/2 table version: "+n;t["OS/2"].version5(e,r,a)}return a},t["OS/2"].version0=function(e,r,i){var n=t._bin;return i.xAvgCharWidth=n.readShort(e,r),r+=2,i.usWeightClass=n.readUshort(e,r),r+=2,i.usWidthClass=n.readUshort(e,r),r+=2,i.fsType=n.readUshort(e,r),r+=2,i.ySubscriptXSize=n.readShort(e,r),r+=2,i.ySubscriptYSize=n.readShort(e,r),r+=2,i.ySubscriptXOffset=n.readShort(e,r),r+=2,i.ySubscriptYOffset=n.readShort(e,r),r+=2,i.ySuperscriptXSize=n.readShort(e,r),r+=2,i.ySuperscriptYSize=n.readShort(e,r),r+=2,i.ySuperscriptXOffset=n.readShort(e,r),r+=2,i.ySuperscriptYOffset=n.readShort(e,r),r+=2,i.yStrikeoutSize=n.readShort(e,r),r+=2,i.yStrikeoutPosition=n.readShort(e,r),r+=2,i.sFamilyClass=n.readShort(e,r),r+=2,i.panose=n.readBytes(e,r,10),r+=10,i.ulUnicodeRange1=n.readUint(e,r),r+=4,i.ulUnicodeRange2=n.readUint(e,r),r+=4,i.ulUnicodeRange3=n.readUint(e,r),r+=4,i.ulUnicodeRange4=n.readUint(e,r),r+=4,i.achVendID=[n.readInt8(e,r),n.readInt8(e,r+1),n.readInt8(e,r+2),n.readInt8(e,r+3)],r+=4,i.fsSelection=n.readUshort(e,r),r+=2,i.usFirstCharIndex=n.readUshort(e,r),r+=2,i.usLastCharIndex=n.readUshort(e,r),r+=2,i.sTypoAscender=n.readShort(e,r),r+=2,i.sTypoDescender=n.readShort(e,r),r+=2,i.sTypoLineGap=n.readShort(e,r),r+=2,i.usWinAscent=n.readUshort(e,r),r+=2,i.usWinDescent=n.readUshort(e,r),r+=2},t["OS/2"].version1=function(e,r,i){var n=t._bin;return r=t["OS/2"].version0(e,r,i),i.ulCodePageRange1=n.readUint(e,r),r+=4,i.ulCodePageRange2=n.readUint(e,r),r+=4},t["OS/2"].version2=function(e,r,i){var n=t._bin;return r=t["OS/2"].version1(e,r,i),i.sxHeight=n.readShort(e,r),r+=2,i.sCapHeight=n.readShort(e,r),r+=2,i.usDefault=n.readUshort(e,r),r+=2,i.usBreak=n.readUshort(e,r),r+=2,i.usMaxContext=n.readUshort(e,r),r+=2},t["OS/2"].version5=function(e,r,i){var n=t._bin;return r=t["OS/2"].version2(e,r,i),i.usLowerOpticalPointSize=n.readUshort(e,r),r+=2,i.usUpperOpticalPointSize=n.readUshort(e,r),r+=2},t.post={},t.post.parse=function(e,r,i){var n=t._bin,a={};return a.version=n.readFixed(e,r),r+=4,a.italicAngle=n.readFixed(e,r),r+=4,a.underlinePosition=n.readShort(e,r),r+=2,a.underlineThickness=n.readShort(e,r),r+=2,a},null==t&&(t={}),null==t.U&&(t.U={}),t.U.codeToGlyph=function(e,t){var r=e.cmap,i=-1;if(null!=r.p0e4?i=r.p0e4:null!=r.p3e1?i=r.p3e1:null!=r.p1e0?i=r.p1e0:null!=r.p0e3&&(i=r.p0e3),-1==i)throw"no familiar platform and encoding!";var n=r.tables[i];if(0==n.format)return t>=n.map.length?0:n.map[t];if(4==n.format){for(var a=-1,o=0;o<n.endCount.length;o++)if(t<=n.endCount[o]){a=o;break}return -1==a||n.startCount[a]>t?0:65535&(0!=n.idRangeOffset[a]?n.glyphIdArray[t-n.startCount[a]+(n.idRangeOffset[a]>>1)-(n.idRangeOffset.length-a)]:t+n.idDelta[a])}if(12==n.format){if(t>n.groups[n.groups.length-1][1])return 0;for(o=0;o<n.groups.length;o++){var s=n.groups[o];if(s[0]<=t&&t<=s[1])return s[2]+(t-s[0])}return 0}throw"unknown cmap table format "+n.format},t.U.glyphToPath=function(e,r){var i={cmds:[],crds:[]};if(e.SVG&&e.SVG.entries[r]){var n=e.SVG.entries[r];return null==n?i:("string"==typeof n&&(n=t.SVG.toPath(n),e.SVG.entries[r]=n),n)}if(e.CFF){var a={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:e.CFF.Private?e.CFF.Private.defaultWidthX:0,open:!1},o=e.CFF,s=e.CFF.Private;if(o.ROS){for(var l=0;o.FDSelect[l+2]<=r;)l+=2;s=o.FDArray[o.FDSelect[l+1]].Private}t.U._drawCFF(e.CFF.CharStrings[r],a,o,s,i)}else e.glyf&&t.U._drawGlyf(r,e,i);return i},t.U._drawGlyf=function(e,r,i){var n=r.glyf[e];null==n&&(n=r.glyf[e]=t.glyf._parseGlyf(r,e)),null!=n&&(n.noc>-1?t.U._simpleGlyph(n,i):t.U._compoGlyph(n,r,i))},t.U._simpleGlyph=function(e,r){for(var i=0;i<e.noc;i++){for(var n=0==i?0:e.endPts[i-1]+1,a=e.endPts[i],o=n;o<=a;o++){var s=o==n?a:o-1,l=o==a?n:o+1,c=1&e.flags[o],h=1&e.flags[s],u=1&e.flags[l],A=e.xs[o],d=e.ys[o];if(o==n)if(c){if(!h){t.U.P.moveTo(r,A,d);continue}t.U.P.moveTo(r,e.xs[s],e.ys[s])}else h?t.U.P.moveTo(r,e.xs[s],e.ys[s]):t.U.P.moveTo(r,(e.xs[s]+A)/2,(e.ys[s]+d)/2);c?h&&t.U.P.lineTo(r,A,d):u?t.U.P.qcurveTo(r,A,d,e.xs[l],e.ys[l]):t.U.P.qcurveTo(r,A,d,(A+e.xs[l])/2,(d+e.ys[l])/2)}t.U.P.closePath(r)}},t.U._compoGlyph=function(e,r,i){for(var n=0;n<e.parts.length;n++){var a={cmds:[],crds:[]},o=e.parts[n];t.U._drawGlyf(o.glyphIndex,r,a);for(var s=o.m,l=0;l<a.crds.length;l+=2){var c=a.crds[l],h=a.crds[l+1];i.crds.push(c*s.a+h*s.b+s.tx),i.crds.push(c*s.c+h*s.d+s.ty)}for(l=0;l<a.cmds.length;l++)i.cmds.push(a.cmds[l])}},t.U._getGlyphClass=function(e,r){var i=t._lctf.getInterval(r,e);return -1==i?0:r[i+2]},t.U._applySubs=function(e,r,i,n){for(var a=e.length-r-1,o=0;o<i.tabs.length;o++)if(null!=i.tabs[o]){var s,l=i.tabs[o];if(!l.coverage||-1!=(s=t._lctf.coverageIndex(l.coverage,e[r]))){if(1==i.ltype)e[r],1==l.fmt?e[r]=e[r]+l.delta:e[r]=l.newg[s];else if(4==i.ltype)for(var c=l.vals[s],h=0;h<c.length;h++){var u=c[h],A=u.chain.length;if(!(A>a)){for(var d=!0,f=0,m=0;m<A;m++){for(;-1==e[r+f+(1+m)];)f++;u.chain[m]!=e[r+f+(1+m)]&&(d=!1)}if(d){for(m=0,e[r]=u.nglyph;m<A+f;m++)e[r+m+1]=-1;break}}}else if(5==i.ltype&&2==l.fmt)for(var p=t._lctf.getInterval(l.cDef,e[r]),g=l.cDef[p+2],v=l.scset[g],y=0;y<v.length;y++){var x=v[y],E=x.input;if(!(E.length>a)){for(d=!0,m=0;m<E.length;m++){var C=t._lctf.getInterval(l.cDef,e[r+1+m]);if(-1==p&&l.cDef[C+2]!=E[m]){d=!1;break}}if(d){var B=x.substLookupRecords;for(h=0;h<B.length;h+=2)B[h],B[h+1]}}}else if(6==i.ltype&&3==l.fmt){if(!t.U._glsCovered(e,l.backCvg,r-l.backCvg.length)||!t.U._glsCovered(e,l.inptCvg,r)||!t.U._glsCovered(e,l.ahedCvg,r+l.inptCvg.length))continue;var w=l.lookupRec;for(y=0;y<w.length;y+=2){p=w[y];var I=n[w[y+1]];t.U._applySubs(e,r+p,I,n)}}}}},t.U._glsCovered=function(e,r,i){for(var n=0;n<r.length;n++)if(-1==t._lctf.coverageIndex(r[n],e[i+n]))return!1;return!0},t.U.glyphsToPath=function(e,r,i){for(var n={cmds:[],crds:[]},a=0,o=0;o<r.length;o++){var s=r[o];if(-1!=s){for(var l=o<r.length-1&&-1!=r[o+1]?r[o+1]:0,c=t.U.glyphToPath(e,s),h=0;h<c.crds.length;h+=2)n.crds.push(c.crds[h]+a),n.crds.push(c.crds[h+1]);for(i&&n.cmds.push(i),h=0;h<c.cmds.length;h++)n.cmds.push(c.cmds[h]);i&&n.cmds.push("X"),a+=e.hmtx.aWidth[s],o<r.length-1&&(a+=t.U.getPairAdjustment(e,s,l))}}return n},t.U.P={},t.U.P.moveTo=function(e,t,r){e.cmds.push("M"),e.crds.push(t,r)},t.U.P.lineTo=function(e,t,r){e.cmds.push("L"),e.crds.push(t,r)},t.U.P.curveTo=function(e,t,r,i,n,a,o){e.cmds.push("C"),e.crds.push(t,r,i,n,a,o)},t.U.P.qcurveTo=function(e,t,r,i,n){e.cmds.push("Q"),e.crds.push(t,r,i,n)},t.U.P.closePath=function(e){e.cmds.push("Z")},t.U._drawCFF=function(e,r,i,n,a){for(var o=r.stack,s=r.nStems,l=r.haveWidth,c=r.width,h=r.open,u=0,A=r.x,d=r.y,f=0,m=0,p=0,g=0,v=0,y=0,x=0,E=0,C=0,B=0,w={val:0,size:0};u<e.length;){t.CFF.getCharString(e,u,w);var I=w.val;if(u+=w.size,"o1"==I||"o18"==I)o.length%2==0||l||(c=o.shift()+n.nominalWidthX),s+=o.length>>1,o.length=0,l=!0;else if("o3"==I||"o23"==I)o.length%2==0||l||(c=o.shift()+n.nominalWidthX),s+=o.length>>1,o.length=0,l=!0;else if("o4"==I)o.length>1&&!l&&(c=o.shift()+n.nominalWidthX,l=!0),h&&t.U.P.closePath(a),d+=o.pop(),t.U.P.moveTo(a,A,d),h=!0;else if("o5"==I)for(;o.length>0;)A+=o.shift(),d+=o.shift(),t.U.P.lineTo(a,A,d);else if("o6"==I||"o7"==I)for(var b=o.length,_="o6"==I,M=0;M<b;M++){var S=o.shift();_?A+=S:d+=S,_=!_,t.U.P.lineTo(a,A,d)}else if("o8"==I||"o24"==I){b=o.length;for(var T=0;T+6<=b;)f=A+o.shift(),m=d+o.shift(),p=f+o.shift(),g=m+o.shift(),A=p+o.shift(),d=g+o.shift(),t.U.P.curveTo(a,f,m,p,g,A,d),T+=6;"o24"==I&&(A+=o.shift(),d+=o.shift(),t.U.P.lineTo(a,A,d))}else{if("o11"==I)break;if("o1234"==I||"o1235"==I||"o1236"==I||"o1237"==I)"o1234"==I&&(m=d,p=(f=A+o.shift())+o.shift(),B=g=m+o.shift(),y=g,E=d,A=(x=(v=(C=p+o.shift())+o.shift())+o.shift())+o.shift(),t.U.P.curveTo(a,f,m,p,g,C,B),t.U.P.curveTo(a,v,y,x,E,A,d)),"o1235"==I&&(f=A+o.shift(),m=d+o.shift(),p=f+o.shift(),g=m+o.shift(),C=p+o.shift(),B=g+o.shift(),v=C+o.shift(),y=B+o.shift(),x=v+o.shift(),E=y+o.shift(),A=x+o.shift(),d=E+o.shift(),o.shift(),t.U.P.curveTo(a,f,m,p,g,C,B),t.U.P.curveTo(a,v,y,x,E,A,d)),"o1236"==I&&(f=A+o.shift(),m=d+o.shift(),p=f+o.shift(),B=g=m+o.shift(),y=g,x=(v=(C=p+o.shift())+o.shift())+o.shift(),E=y+o.shift(),A=x+o.shift(),t.U.P.curveTo(a,f,m,p,g,C,B),t.U.P.curveTo(a,v,y,x,E,A,d)),"o1237"==I&&(f=A+o.shift(),m=d+o.shift(),p=f+o.shift(),g=m+o.shift(),C=p+o.shift(),B=g+o.shift(),v=C+o.shift(),y=B+o.shift(),Math.abs((x=v+o.shift())-A)>Math.abs((E=y+o.shift())-d)?A=x+o.shift():d=E+o.shift(),t.U.P.curveTo(a,f,m,p,g,C,B),t.U.P.curveTo(a,v,y,x,E,A,d));else if("o14"==I){if(o.length>0&&!l&&(c=o.shift()+i.nominalWidthX,l=!0),4==o.length){var D=o.shift(),F=o.shift(),R=o.shift(),P=o.shift(),Q=t.CFF.glyphBySE(i,R),U=t.CFF.glyphBySE(i,P);t.U._drawCFF(i.CharStrings[Q],r,i,n,a),r.x=D,r.y=F,t.U._drawCFF(i.CharStrings[U],r,i,n,a)}h&&(t.U.P.closePath(a),h=!1)}else if("o19"==I||"o20"==I)o.length%2==0||l||(c=o.shift()+n.nominalWidthX),s+=o.length>>1,o.length=0,l=!0,u+=s+7>>3;else if("o21"==I)o.length>2&&!l&&(c=o.shift()+n.nominalWidthX,l=!0),d+=o.pop(),A+=o.pop(),h&&t.U.P.closePath(a),t.U.P.moveTo(a,A,d),h=!0;else if("o22"==I)o.length>1&&!l&&(c=o.shift()+n.nominalWidthX,l=!0),A+=o.pop(),h&&t.U.P.closePath(a),t.U.P.moveTo(a,A,d),h=!0;else if("o25"==I){for(;o.length>6;)A+=o.shift(),d+=o.shift(),t.U.P.lineTo(a,A,d);f=A+o.shift(),m=d+o.shift(),p=f+o.shift(),g=m+o.shift(),A=p+o.shift(),d=g+o.shift(),t.U.P.curveTo(a,f,m,p,g,A,d)}else if("o26"==I)for(o.length%2&&(A+=o.shift());o.length>0;)f=A,m=d+o.shift(),A=p=f+o.shift(),d=(g=m+o.shift())+o.shift(),t.U.P.curveTo(a,f,m,p,g,A,d);else if("o27"==I)for(o.length%2&&(d+=o.shift());o.length>0;)m=d,p=(f=A+o.shift())+o.shift(),g=m+o.shift(),A=p+o.shift(),d=g,t.U.P.curveTo(a,f,m,p,g,A,d);else if("o10"==I||"o29"==I){var z="o10"==I?n:i;if(0==o.length)console.debug("error: empty stack");else{var k=o.pop(),L=z.Subrs[k+z.Bias];r.x=A,r.y=d,r.nStems=s,r.haveWidth=l,r.width=c,r.open=h,t.U._drawCFF(L,r,i,n,a),A=r.x,d=r.y,s=r.nStems,l=r.haveWidth,c=r.width,h=r.open}}else if("o30"==I||"o31"==I){var O=o.length,G=(T=0,"o31"==I);for(T+=O-(b=-3&O);T<b;)G?(m=d,p=(f=A+o.shift())+o.shift(),d=(g=m+o.shift())+o.shift(),b-T==5?(A=p+o.shift(),T++):A=p,G=!1):(f=A,m=d+o.shift(),p=f+o.shift(),g=m+o.shift(),A=p+o.shift(),b-T==5?(d=g+o.shift(),T++):d=g,G=!0),t.U.P.curveTo(a,f,m,p,g,A,d),T+=4}else{if("o"==(I+"").charAt(0))throw console.debug("Unknown operation: "+I,e),I;o.push(I)}}}r.x=A,r.y=d,r.nStems=s,r.haveWidth=l,r.width=c,r.open=h},e.Typr=r=t,e.default={Typr:r},Object.defineProperty(e,"__esModule",{value:!0}),e).Typr},function(){return function(e){var t=Uint8Array,r=Uint16Array,i=Uint32Array,n=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),a=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),o=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),s=function(e,t){for(var n=new r(31),a=0;a<31;++a)n[a]=t+=1<<e[a-1];var o=new i(n[30]);for(a=1;a<30;++a)for(var s=n[a];s<n[a+1];++s)o[s]=s-n[a]<<5|a;return[n,o]},l=s(n,2),c=l[0],h=l[1];c[28]=258,h[258]=28;for(var u=s(a,0)[0],A=new r(32768),d=0;d<32768;++d){var f=(43690&d)>>>1|(21845&d)<<1;f=(61680&(f=(52428&f)>>>2|(13107&f)<<2))>>>4|(3855&f)<<4,A[d]=((65280&f)>>>8|(255&f)<<8)>>>1}var m=function(e,t,i){for(var n=e.length,a=0,o=new r(t);a<n;++a)++o[e[a]-1];var s,l=new r(t);for(a=0;a<t;++a)l[a]=l[a-1]+o[a-1]<<1;if(i){s=new r(1<<t);var c=15-t;for(a=0;a<n;++a)if(e[a])for(var h=a<<4|e[a],u=t-e[a],d=l[e[a]-1]++<<u,f=d|(1<<u)-1;d<=f;++d)s[A[d]>>>c]=h}else for(s=new r(n),a=0;a<n;++a)e[a]&&(s[a]=A[l[e[a]-1]++]>>>15-e[a]);return s},p=new t(288);for(d=0;d<144;++d)p[d]=8;for(d=144;d<256;++d)p[d]=9;for(d=256;d<280;++d)p[d]=7;for(d=280;d<288;++d)p[d]=8;var g=new t(32);for(d=0;d<32;++d)g[d]=5;var v=m(p,9,1),y=m(g,5,1),x=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},E=function(e,t,r){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(7&t)&r},C=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},B=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],w=function(e,t,r){var i=Error(t||B[e]);if(i.code=e,Error.captureStackTrace&&Error.captureStackTrace(i,w),!r)throw i;return i},I=function(e,s,l){var h,A,d,f,p=e.length;if(!p||l&&!l.l&&p<5)return s||new t(0);var g=!s||l,B=!l||l.i;l||(l={}),s||(s=new t(3*p));var I,b=function(e){var r=s.length;if(e>r){var i=new t(Math.max(2*r,e));i.set(s),s=i}},_=l.f||0,M=l.p||0,S=l.b||0,T=l.l,D=l.d,F=l.m,R=l.n,P=8*p;do{if(!T){l.f=_=E(e,M,1);var Q=E(e,M+1,3);if(M+=3,!Q){var U=e[(Y=((I=M)/8|0)+(7&I&&1)+4)-4]|e[Y-3]<<8,z=Y+U;if(z>p){B&&w(0);break}g&&b(S+U),s.set(e.subarray(Y,z),S),l.b=S+=U,l.p=M=8*z;continue}if(1==Q)T=v,D=y,F=9,R=5;else if(2==Q){var k=E(e,M,31)+257,L=E(e,M+10,15)+4,O=k+E(e,M+5,31)+1;M+=14;for(var G=new t(O),N=new t(19),H=0;H<L;++H)N[o[H]]=E(e,M+3*H,7);M+=3*L;var V=x(N),j=(1<<V)-1,J=m(N,V,1);for(H=0;H<O;){var Y,W=J[E(e,M,j)];if(M+=15&W,(Y=W>>>4)<16)G[H++]=Y;else{var K=0,X=0;for(16==Y?(X=3+E(e,M,3),M+=2,K=G[H-1]):17==Y?(X=3+E(e,M,7),M+=3):18==Y&&(X=11+E(e,M,127),M+=7);X--;)G[H++]=K}}var q=G.subarray(0,k),Z=G.subarray(k);F=x(q),R=x(Z),T=m(q,F,1),D=m(Z,R,1)}else w(1);if(M>P){B&&w(0);break}}g&&b(S+131072);for(var $=(1<<F)-1,ee=(1<<R)-1,et=M;;et=M){var er=(K=T[C(e,M)&$])>>>4;if((M+=15&K)>P){B&&w(0);break}if(K||w(2),er<256)s[S++]=er;else{if(256==er){et=M,T=null;break}var ei=er-254;if(er>264){var en=n[H=er-257];ei=E(e,M,(1<<en)-1)+c[H],M+=en}var ea=D[C(e,M)&ee],eo=ea>>>4;if(ea||w(3),M+=15&ea,Z=u[eo],eo>3&&(en=a[eo],Z+=C(e,M)&(1<<en)-1,M+=en),M>P){B&&w(0);break}g&&b(S+131072);for(var es=S+ei;S<es;S+=4)s[S]=s[S-Z],s[S+1]=s[S+1-Z],s[S+2]=s[S+2-Z],s[S+3]=s[S+3-Z];S=es}}l.l=T,l.p=et,l.b=S,T&&(_=1,l.m=F,l.d=D,l.n=R)}while(!_)return S==s.length?s:(h=s,(A=0)<0&&(A=0),(null==(d=S)||d>h.length)&&(d=h.length),(f=new(h instanceof r?r:h instanceof i?i:t)(d-A)).set(h.subarray(A,d)),f)},b=new t(0),_="undefined"!=typeof TextDecoder&&new TextDecoder;try{_.decode(b,{stream:!0})}catch(e){}return e.convert_streams=function(e){var t=new DataView(e),r=0;function i(){var e=t.getUint16(r);return r+=2,e}function n(){var e=t.getUint32(r);return r+=4,e}function a(e){g.setUint16(v,e),v+=2}function o(e){g.setUint32(v,e),v+=4}for(var s={signature:n(),flavor:n(),length:n(),numTables:i(),reserved:i(),totalSfntSize:n(),majorVersion:i(),minorVersion:i(),metaOffset:n(),metaLength:n(),metaOrigLength:n(),privOffset:n(),privLength:n()},l=0;Math.pow(2,l)<=s.numTables;)l++;l--;for(var c=16*Math.pow(2,l),h=16*s.numTables-c,u=12,A=[],d=0;d<s.numTables;d++)A.push({tag:n(),offset:n(),compLength:n(),origLength:n(),origChecksum:n()}),u+=16;var f,m=new Uint8Array(12+16*A.length+A.reduce(function(e,t){return e+t.origLength+4},0)),p=m.buffer,g=new DataView(p),v=0;return o(s.flavor),a(s.numTables),a(c),a(l),a(h),A.forEach(function(e){o(e.tag),o(e.origChecksum),o(u),o(e.origLength),e.outOffset=u,(u+=e.origLength)%4!=0&&(u+=4-u%4)}),A.forEach(function(t){var r=e.slice(t.offset,t.offset+t.compLength);if(t.compLength!=t.origLength){var i=new Uint8Array(t.origLength);I(new Uint8Array(r,2),i)}else i=new Uint8Array(r);m.set(i,t.outOffset);var n=0;(u=t.outOffset+t.origLength)%4!=0&&(n=4-u%4),m.set(new Uint8Array(n).buffer,t.outOffset+t.origLength),f=u+n}),p.slice(0,f)},Object.defineProperty(e,"__esModule",{value:!0}),e}({}).convert_streams},function(e,t){let r,i={M:2,L:2,Q:4,C:6,Z:0},n={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},a=[null,"isol","init","fina","medi"];function o(t,r){let i=t.GDEF&&t.GDEF.glyphClassDef;return i?e.U._getGlyphClass(r,i):0}function s(...e){for(let t=0;t<e.length;t++)if("number"==typeof e[t])return e[t]}return function(l){var c;let h,u,A,d,f,m,p=new Uint8Array(l,0,4),g=e._bin.readASCII(p,0,4);if("wOFF"===g)l=t(l);else if("wOF2"===g)throw Error("woff2 fonts not supported");return c=e.parse(l)[0],h=Object.create(null),u=c["OS/2"],A=c.hhea,d=c.head.unitsPerEm,f=s(u&&u.sTypoAscender,A&&A.ascender,d),m={unitsPerEm:d,ascender:f,descender:s(u&&u.sTypoDescender,A&&A.descender,0),capHeight:s(u&&u.sCapHeight,f),xHeight:s(u&&u.sxHeight,f),lineGap:s(u&&u.sTypoLineGap,A&&A.lineGap),supportsCodePoint:t=>e.U.codeToGlyph(c,t)>0,forEachGlyph(t,s,l,u){let A=0,d=1/m.unitsPerEm*s,f=function(t,i){let o=[];for(let r=0;r<i.length;r++){let n=i.codePointAt(r);n>65535&&r++,o.push(e.U.codeToGlyph(t,n))}let s=t.GSUB;if(s){let t,{lookupList:l,featureList:c}=s,h=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,u=[];c.forEach(s=>{if(h.test(s.tag))for(let c=0;c<s.tab.length;c++){if(u[s.tab[c]])continue;u[s.tab[c]]=!0;let h=l[s.tab[c]],A=/^(isol|init|fina|medi)$/.test(s.tag);A&&!t&&(t=function(e){let t=new Uint8Array(e.length),i=32,a=1,o=-1;for(let s=0;s<e.length;s++){let l=e.codePointAt(s),c=0|function(e){if(!r){let e={R:2,L:1,D:4,C:16,U:32,T:8};for(let t in r=new Map,n){let i=0;n[t].split(",").forEach(n=>{let[a,o]=n.split("+");a=parseInt(a,36),o=o?parseInt(o,36):0,r.set(i+=a,e[t]);for(let n=o;n--;)r.set(++i,e[t])})}}return r.get(e)||32}(l),h=1;!(8&c)&&(21&i?22&c?(h=3,(1===a||3===a)&&t[o]++):33&c&&(2===a||4===a)&&t[o]--:34&i&&(2===a||4===a)&&t[o]--,a=t[s]=h,i=c,o=s,l>65535&&s++)}return t}(i));for(let r=0;r<o.length;r++)t&&A&&a[t[r]]!==s.tag||e.U._applySubs(o,r,h,l)}})}return o}(c,t),p=0,g=function(t,r){let i=new Int16Array(3*r.length),n=0;for(;n<r.length;n++){let c=r[n];if(-1===c)continue;i[3*n+2]=t.hmtx.aWidth[c];let h=t.GPOS;if(h){let u=h.lookupList;for(let h=0;h<u.length;h++){let A=u[h];for(let h=0;h<A.tabs.length;h++){let u=A.tabs[h];if(1===A.ltype){if(-1!==e._lctf.coverageIndex(u.coverage,c)&&u.pos){l(u.pos,n);break}}else if(2===A.ltype){let t=null,i=a();if(-1!==i){let a=e._lctf.coverageIndex(u.coverage,r[i]);if(-1!==a){if(1===u.fmt){let e=u.pairsets[a];for(let r=0;r<e.length;r++)e[r].gid2===c&&(t=e[r])}else if(2===u.fmt){let n=e.U._getGlyphClass(r[i],u.classDef1),a=e.U._getGlyphClass(c,u.classDef2);t=u.matrix[n][a]}if(t){t.val1&&l(t.val1,i),t.val2&&l(t.val2,n);break}}}}else if(4===A.ltype){let t=e._lctf.coverageIndex(u.markCoverage,c);if(-1!==t){let o=a(s),l=-1===o?-1:e._lctf.coverageIndex(u.baseCoverage,r[o]);if(-1!==l){let e=u.markArray[t],r=u.baseArray[l][e.markClass];i[3*n]=r.x-e.x+i[3*o]-i[3*o+2],i[3*n+1]=r.y-e.y+i[3*o+1];break}}}else if(6===A.ltype){let s=e._lctf.coverageIndex(u.mark1Coverage,c);if(-1!==s){let l=a();if(-1!==l){let a=r[l];if(3===o(t,a)){let t=e._lctf.coverageIndex(u.mark2Coverage,a);if(-1!==t){let e=u.mark1Array[s],r=u.mark2Array[t][e.markClass];i[3*n]=r.x-e.x+i[3*l]-i[3*l+2],i[3*n+1]=r.y-e.y+i[3*l+1];break}}}}}}}}else if(t.kern&&!t.cff){let e=a();if(-1!==e){let n=t.kern.glyph1.indexOf(r[e]);if(-1!==n){let r=t.kern.rval[n].glyph2.indexOf(c);-1!==r&&(i[3*e+2]+=t.kern.rval[n].vals[r])}}}}return i;function a(e){for(let t=n-1;t>=0;t--)if(-1!==r[t]&&(!e||e(r[t])))return t;return -1}function s(e){return 1===o(t,e)}function l(e,t){for(let r=0;r<3;r++)i[3*t+r]+=e[r]||0}}(c,f);return f.forEach((r,n)=>{if(-1!==r){let t=h[r];if(!t){let n,a,o,s,{cmds:l,crds:u}=e.U.glyphToPath(c,r),A="",d=0;for(let e=0,t=l.length;e<t;e++){let t=i[l[e]];A+=l[e];for(let e=1;e<=t;e++)A+=(e>1?",":"")+u[d++]}if(u.length){n=a=1/0,o=s=-1/0;for(let e=0,t=u.length;e<t;e+=2){let t=u[e],r=u[e+1];t<n&&(n=t),r<a&&(a=r),t>o&&(o=t),r>s&&(s=r)}}else n=o=a=s=0;t=h[r]={index:r,advanceWidth:c.hmtx.aWidth[r],xMin:n,yMin:a,xMax:o,yMax:s,path:A}}u.call(null,t,A+g[3*n]*d,g[3*n+1]*d,p),A+=g[3*n+2]*d,l&&(A+=l*s)}p+=t.codePointAt(p)>65535?2:1}),A}}}}],init:(e,t,r)=>r(e(),t())}),aB=n8({name:"FontResolver",dependencies:[function(e,t){let r=Object.create(null),i=Object.create(null);function n(t,n){let a=r[t];if(a)n(a);else if(i[t])i[t].push(n);else{i[t]=[n];let a=e=>{console.error(`Failure loading font ${t}`,e)};try{let n=new XMLHttpRequest;n.open("get",t,!0),n.responseType="arraybuffer",n.onload=function(){if(n.status>=400)a(Error(n.statusText));else if(n.status>0)try{var o;let a=e(n.response);a.src=t,(o=a).src=t,r[t]=o,i[t].forEach(e=>e(o)),delete i[t]}catch(e){a(e)}},n.onerror=a,n.send()}catch(e){a(e)}}}return function(e,i,{lang:a,fonts:o=[],style:s="normal",weight:l="normal",unicodeFontsURL:c}={}){let h=new Uint8Array(e.length),u=[];e.length||m();let A=new Map,d=[];if("italic"!==s&&(s="normal"),"number"!=typeof l&&(l="bold"===l?700:400),o&&!Array.isArray(o)&&(o=[o]),(o=o.slice().filter(e=>!e.lang||e.lang.test(a)).reverse()).length){let t=0;!function i(a=0){for(let s=a,l=e.length;s<l;s++){let a=e.codePointAt(s);if(1===t&&u[h[s-1]].supportsCodePoint(a)||s>0&&/\s/.test(e[s]))h[s]=h[s-1],2===t&&(d[d.length-1][1]=s);else for(let e=h[s],l=o.length;e<=l;e++)if(e===l)(2===t?d[d.length-1]:d[d.length]=[s,s])[1]=s,t=2;else{h[s]=e;let{src:l,unicodeRange:c}=o[e];if(!c||function(e,t){for(let r=0;r<t.length;r++){let[i,n=i]=t[r];if(i<=e&&e<=n)return!0}return!1}(a,c)){let e=r[l];if(!e)return void n(l,()=>{i(s)});if(e.supportsCodePoint(a)){let r=A.get(e);"number"!=typeof r&&(r=u.length,u.push(e),A.set(e,r)),h[s]=r,t=1;break}}}a>65535&&s+1<l&&(h[s+1]=h[s],s++,2===t&&(d[d.length-1][1]=s))}f()}()}else d.push([0,e.length-1]),f();function f(){if(d.length){let r=d.map(t=>e.substring(t[0],t[1]+1)).join("\n");t.getFontsForString(r,{lang:a||void 0,style:s,weight:l,dataUrl:c}).then(({fontUrls:e,chars:t})=>{let r=u.length,i=0;d.forEach(e=>{for(let n=0,a=e[1]-e[0];n<=a;n++)h[e[0]+n]=t[i++]+r;i++});let a=0;e.forEach((t,i)=>{n(t,t=>{u[i+r]=t,++a===e.length&&m()})})})}else m()}function m(){i({chars:h,fonts:u})}}},aC,function(){return function(e){var t=function(){this.buckets=new Map};t.prototype.add=function(e){var t=e>>5;this.buckets.set(t,(this.buckets.get(t)||0)|1<<(31&e))},t.prototype.has=function(e){var t=this.buckets.get(e>>5);return void 0!==t&&0!=(t&1<<(31&e))},t.prototype.serialize=function(){var e=[];return this.buckets.forEach(function(t,r){e.push((+r).toString(36)+":"+t.toString(36))}),e.join(",")},t.prototype.deserialize=function(e){var t=this;this.buckets.clear(),e.split(",").forEach(function(e){var r=e.split(":");t.buckets.set(parseInt(r[0],36),parseInt(r[1],36))})};function r(e,t){var r=255&e,i=t.codePointAt(r/6|0);return 0!=((i=(i||48)-48)&1<<r%6)}function i(e,t){var r=function(e,r){for(var i=e;i<=r;i++)t(i)};e.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map(function(e){return e.split("-").map(function(e){return parseInt(e.trim(),16)})}).forEach(function(e){var t=e[0],i=e[1];void 0===i&&(i=t),r(t,i)})}var n,a={},o={},s=new WeakMap,l="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data",c=new Map;function h(e,t,r){return e[t]?t:e[r]?r:function(e){for(var t in e)return t}(e)}return e.CodePointSet=t,e.clearCache=function(){a={},o={}},e.getFontsForString=function(e,u){void 0===u&&(u={});var A=u.lang;void 0===A&&(A=/\p{Script=Hangul}/u.test(e)?"ko":/\p{Script=Hiragana}|\p{Script=Katakana}/u.test(e)?"ja":"en");var d=u.category;void 0===d&&(d="sans-serif");var f=u.style;void 0===f&&(f="normal");var m=u.weight;void 0===m&&(m=400);var p=(u.dataUrl||l).replace(/\/$/g,""),g=new Map,v=new Uint8Array(e.length),y={},x={},E=Array(e.length),C=new Map,B=!1;function w(e){var t=c.get(e);return t||(t=fetch(p+"/"+e).then(function(e){if(!e.ok)throw Error(e.statusText);return e.json().then(function(e){if(!Array.isArray(e)||1!==e[0])throw Error("Incorrect schema version; need 1, got "+e[0]);return e[1]})}).catch(function(t){if(p!==l)return B||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+p+'", trying default CDN. '+t.message),B=!0),p=l,c.delete(e),w(e);throw t}),c.set(e,t)),t}for(var I=0;I<e.length;I++)!function(t){var r=e.codePointAt(t),i=function(e){var t=(-256&e).toString(16),r=((-256&e)+256-1).toString(16);return"codepoint-index/plane"+(e>>16)+"/"+t+"-"+r+".json"}(r);E[t]=i,a[i]||C.has(i)||C.set(i,w(i).then(function(e){a[i]=e})),r>65535&&(I=++t)}(I);return Promise.all(C.values()).then(function(){C.clear();for(var t=0;t<e.length;t++)!function(i){var n=e.codePointAt(i),s=null,l=a[E[i]],c=void 0;for(var h in l){var u=x[h];if(void 0===u&&(u=x[h]=new RegExp(h).test(A||"en")),u){for(var d in c=h,l[h])if(r(n,l[h][d])){s=d;break}break}}if(!s){e:for(var f in l)if(f!==c){for(var m in l[f])if(r(n,l[f][m])){s=m;break e}}}s||(console.debug("No font coverage for U+"+n.toString(16)),s="latin"),E[i]=s,o[s]||C.has(s)||C.set(s,w("font-meta/"+s+".json").then(function(e){o[s]=e})),n>65535&&(t=++i)}(t);return Promise.all(C.values())}).then(function(){for(var r,a=null,l=0;l<e.length;l++){var c=e.codePointAt(l);if(a&&(n||(n=new Set,i("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",function(e){n.add(e)})),n.has(c)||(function(e){var r=s.get(e);return r||(r=new t,i(e.ranges,function(e){return r.add(e)}),s.set(e,r)),r})(a).has(c)))v[l]=v[l-1];else{var u=y[(a=o[E[l]]).id];if(!u){var A=a.typeforms,x=h(A,d,"sans-serif"),C=h(A[x],f,"normal"),B=function(e,t){var r=t;if(!e.includes(r)){r=1/0;for(var i=0;i<e.length;i++)Math.abs(e[i]-t)<Math.abs(r-t)&&(r=e[i])}return r}(null==(r=A[x])?void 0:r[C],m);u=y[a.id]=p+"/font-files/"+a.id+"/"+x+"."+C+"."+B+".woff"}var w=g.get(u);null==w&&(w=g.size,g.set(u,w)),v[l]=w}c>65535&&(v[++l]=v[l-1])}return{fontUrls:Array.from(g.keys()),chars:v}})},Object.defineProperty(e,"__esModule",{value:!0}),e}({})}],init:(e,t,r)=>e(t,r())}),aw=()=>(self.performance||Date).now(),aI=ae(),ab=[],a_=0;function aM(){let e=aw();for(;ab.length&&aw()-e<5;)ab.shift()();a_=ab.length?setTimeout(aM,0):0}let aS={},aT=0;function aD(e,t,r,i,n,a,o,s,l,c){let h="TroikaTextSDFGenerator_JS_"+aT++%4,u=aS[h];return u||(u=aS[h]={workerModule:n8({name:h,workerId:h,dependencies:[ae,aw],init(e,t){let r=e().javascript.generate;return function(...e){let i=t();return{textureData:r(...e),timing:t()-i}}},getTransferables:e=>[e.textureData.buffer]}),requests:0,idleTimer:null}),u.requests++,clearTimeout(u.idleTimer),u.workerModule(e,t,r,i,n,a).then(({textureData:r,timing:i})=>{let n=aw(),a=new Uint8Array(4*r.length);for(let e=0;e<r.length;e++)a[4*e+c]=r[e];return aI.webglUtils.renderImageData(o,a,s,l,e,t,1<<3-c),i+=aw()-n,0==--u.requests&&(u.idleTimer=setTimeout(()=>{n5[h]&&n5[h].forEach(function(e){e()}),n4[h]&&(n4[h].terminate(),delete n4[h])},2e3)),{timing:i}})}let aF=aI.webglUtils.resizeWebGLCanvasWithoutClearing,aR={defaultFontURL:null,unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048,useWorker:!0},aP=new nZ.Color;function aQ(){return(self.performance||Date).now()}let aU=Object.create(null);function az(e,t){e=function(e,t){for(let r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e}({},e);let r=aQ(),{defaultFontURL:i}=aR,n=[];if(i&&n.push({label:"default",src:aL(i)}),e.font&&n.push({label:"user",src:aL(e.font)}),e.font=n,e.text=""+e.text,e.sdfGlyphSize=e.sdfGlyphSize||aR.sdfGlyphSize,e.unicodeFontsURL=e.unicodeFontsURL||aR.unicodeFontsURL,null!=e.colorRanges){let t={};for(let r in e.colorRanges)if(e.colorRanges.hasOwnProperty(r)){let i=e.colorRanges[r];"number"!=typeof i&&(i=aP.set(i).getHex()),t[r]=i}e.colorRanges=t}Object.freeze(e);let{textureWidth:a,sdfExponent:o}=aR,{sdfGlyphSize:s}=e,l=a/s*4,c=aU[s];if(!c){var h;let e,t=document.createElement("canvas");t.width=a,t.height=256*s/l,(c=aU[s]={glyphCount:0,sdfGlyphSize:s,sdfCanvas:t,sdfTexture:new nZ.Texture(t,void 0,void 0,void 0,nZ.LinearFilter,nZ.LinearFilter),contextLost:!1,glyphsByFont:new Map}).sdfTexture.generateMipmaps=!1,(e=(h=c).sdfCanvas).addEventListener("webglcontextlost",e=>{console.log("Context Lost",e),e.preventDefault(),h.contextLost=!0}),e.addEventListener("webglcontextrestored",e=>{console.log("Context Restored",e),h.contextLost=!1;let t=[];h.glyphsByFont.forEach(e=>{e.forEach(e=>{t.push(ak(e,h,!0))})}),Promise.all(t).then(()=>{aO(h),h.sdfTexture.needsUpdate=!0})})}let{sdfTexture:u,sdfCanvas:A}=c;(aR.useWorker?aN:aH)(e).then(i=>{let{glyphIds:n,glyphFontIndices:h,fontData:d,glyphPositions:f,fontSize:m,timings:p}=i,g=[],v=new Float32Array(4*n.length),y=0,x=0,E=aQ(),C=d.map(e=>{let t=c.glyphsByFont.get(e.src);return t||c.glyphsByFont.set(e.src,t=new Map),t});n.forEach((e,t)=>{let r=h[t],{src:a,unitsPerEm:o}=d[r],l=C[r].get(e);if(!l){let{path:t,pathBounds:n}=i.glyphData[a][e],o=Math.max(n[2]-n[0],n[3]-n[1])/s*(aR.sdfMargin*s+.5),h=c.glyphCount++,u=[n[0]-o,n[1]-o,n[2]+o,n[3]+o];C[r].set(e,l={path:t,atlasIndex:h,sdfViewBox:u}),g.push(l)}let{sdfViewBox:u}=l,A=f[x++],p=f[x++],E=m/o;v[y++]=A+u[0]*E,v[y++]=p+u[1]*E,v[y++]=A+u[2]*E,v[y++]=p+u[3]*E,n[t]=l.atlasIndex}),p.quads=(p.quads||0)+(aQ()-E);let B=aQ();p.sdf={};let w=A.height,I=Math.pow(2,Math.ceil(Math.log2(Math.ceil(c.glyphCount/l)*s)));I>w&&(console.info(`Increasing SDF texture size ${w}->${I}`),aF(A,a,I),u.dispose()),Promise.all(g.map(t=>ak(t,c,e.gpuAccelerateSDF).then(({timing:e})=>{p.sdf[t.atlasIndex]=e}))).then(()=>{g.length&&!c.contextLost&&(aO(c),u.needsUpdate=!0),p.sdfTotal=aQ()-B,p.total=aQ()-r,t(Object.freeze({parameters:e,sdfTexture:u,sdfGlyphSize:s,sdfExponent:o,glyphBounds:v,glyphAtlasIndices:n,glyphColors:i.glyphColors,caretPositions:i.caretPositions,chunkedBounds:i.chunkedBounds,ascender:i.ascender,descender:i.descender,lineHeight:i.lineHeight,capHeight:i.capHeight,xHeight:i.xHeight,topBaseline:i.topBaseline,blockBounds:i.blockBounds,visibleBounds:i.visibleBounds,timings:i.timings}))})}),Promise.resolve().then(()=>{!c.contextLost&&(A._warm||(aI.webgl.isSupported(A),A._warm=!0))})}function ak({path:e,atlasIndex:t,sdfViewBox:r},{sdfGlyphSize:i,sdfCanvas:n,contextLost:a},o){if(a)return Promise.resolve({timing:-1});let{textureWidth:s,sdfExponent:l}=aR,c=Math.max(r[2]-r[0],r[3]-r[1]),h=Math.floor(t/4),u=h%(s/i)*i,A=Math.floor(h/(s/i))*i;return function(e,t,r,i,n,a,o,s,l,c,h=!0){return h?((...e)=>new Promise((t,r)=>{ab.push(()=>{let i=aw();try{aI.webgl.generateIntoCanvas(...e),t({timing:aw()-i})}catch(e){r(e)}}),a_||(a_=setTimeout(aM,0))}))(e,t,r,i,n,a,o,s,l,c).then(null,h=>(b||(console.warn("WebGL SDF generation failed, falling back to JS",h),b=!0),aD(e,t,r,i,n,a,o,s,l,c))):aD(e,t,r,i,n,a,o,s,l,c)}(i,i,e,r,c,l,n,u,A,t%4,o)}function aL(e){return _||(_="undefined"==typeof document?{}:document.createElement("a")),_.href=e,_.href}function aO(e){if("function"!=typeof createImageBitmap){console.info("Safari<15: applying SDF canvas workaround");let{sdfCanvas:t,sdfTexture:r}=e,{width:i,height:n}=t,a=e.sdfCanvas.getContext("webgl"),o=r.image.data;o&&o.length===i*n*4||(o=new Uint8Array(i*n*4),r.image={width:i,height:n,data:o},r.flipY=!1,r.isDataTexture=!0),a.readPixels(0,0,i,n,a.RGBA,a.UNSIGNED_BYTE,o)}}let aG=n8({name:"Typesetter",dependencies:[function(e,t){let r=1/0,i=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,n=`[^\\S\\u00A0]`,a=RegExp(`${n}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function o({text:o="",font:u,lang:A,sdfGlyphSize:d=64,fontSize:f=400,fontWeight:m=1,fontStyle:p="normal",letterSpacing:g=0,lineHeight:v="normal",maxWidth:y=r,direction:x,textAlign:E="left",textIndent:C=0,whiteSpace:B="normal",overflowWrap:w="normal",anchorX:I=0,anchorY:b=0,metricsOnly:_=!1,unicodeFontsURL:M,preResolvedFonts:S=null,includeCaretPositions:T=!1,chunkedBoundsSize:D=8192,colorRanges:F=null},R){let P=c(),Q={fontLoad:0,typesetting:0};o.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),o=o.replace(/\r\n/g,"\n").replace(/\r/g,"\n")),f*=1,g*=1,y*=1,v=v||"normal",C*=1,function({text:t,lang:r,fonts:i,style:n,weight:a,preResolvedFonts:o,unicodeFontsURL:s},l){let c=({chars:e,fonts:t})=>{let r,i,n=[];for(let a=0;a<e.length;a++)e[a]!==i?(i=e[a],n.push(r={start:a,end:a,fontObj:t[e[a]]})):r.end=a;l(n)};o?c(o):e(t,c,{lang:r,fonts:i,style:n,weight:a,unicodeFontsURL:s})}({text:o,lang:A,style:p,weight:m,fonts:"string"==typeof u?[{src:u}]:u,unicodeFontsURL:M,preResolvedFonts:S},e=>{Q.fontLoad=c()-P;let u=isFinite(y),A=null,d=null,m=null,p=null,M=null,S=null,U=null,z=null,k=0,L=0,O="nowrap"!==B,G=new Map,N=c(),H=C,V=0,j=new h,J=[j];e.forEach(e=>{let t,r,{fontObj:s}=e,{ascender:l,descender:c,unitsPerEm:A,lineGap:d,capHeight:m,xHeight:p}=s,x=G.get(s);if(!x){let e=f/A,t="normal"===v?(l-c+d)*e:v*f,r=(t-(l-c)*e)/2,i=Math.min(t,(l-c)*e),n=(l+c)/2*e+i/2;x={index:G.size,src:s.src,fontObj:s,fontSizeMult:e,unitsPerEm:A,ascender:l*e,descender:c*e,capHeight:m*e,xHeight:p*e,lineHeight:t,baseline:-r-l*e,caretTop:n,caretBottom:n-i},G.set(s,x)}let{fontSizeMult:E}=x,B=o.slice(e.start,e.end+1);s.forEachGlyph(B,f,g,(s,l,c,A)=>{let d;l+=V,A+=e.start,t=l,r=s;let m=o.charAt(A),p=s.advanceWidth*E,v=j.count;if("isEmpty"in s||(s.isWhitespace=!!m&&new RegExp(n).test(m),s.canBreakAfter=!!m&&a.test(m),s.isEmpty=s.xMin===s.xMax||s.yMin===s.yMax||i.test(m)),!s.isWhitespace&&!s.isEmpty&&L++,O&&u&&!s.isWhitespace&&l+p+H>y&&v){if(j.glyphAt(v-1).glyphObj.canBreakAfter)d=new h,H=-l;else for(let e=v;e--;)if(0===e&&"break-word"===w){d=new h,H=-l;break}else if(j.glyphAt(e).glyphObj.canBreakAfter){let t=(d=j.splitAt(e+1)).glyphAt(0).x;H-=t;for(let e=d.count;e--;)d.glyphAt(e).x-=t;break}d&&(j.isSoftWrapped=!0,j=d,J.push(j),k=y)}let B=j.glyphAt(j.count);B.glyphObj=s,B.x=l+H,B.y=c,B.width=p,B.charIndex=A,B.fontData=x,"\n"===m&&(j=new h,J.push(j),H=-(l+p+g*f)+C)}),V=t+r.advanceWidth*E+g*f});let Y=0;J.forEach(e=>{let t=!0;for(let r=e.count;r--;){let i=e.glyphAt(r);t&&!i.glyphObj.isWhitespace&&(e.width=i.x+i.width,e.width>k&&(k=e.width),t=!1);let{lineHeight:n,capHeight:a,xHeight:o,baseline:s}=i.fontData;n>e.lineHeight&&(e.lineHeight=n);let l=s-e.baseline;l<0&&(e.baseline+=l,e.cap+=l,e.ex+=l),e.cap=Math.max(e.cap,e.baseline+a),e.ex=Math.max(e.ex,e.baseline+o)}e.baseline-=Y,e.cap-=Y,e.ex-=Y,Y+=e.lineHeight});let W=0,K=0;if(I&&("number"==typeof I?W=-I:"string"==typeof I&&(W=-k*("left"===I?0:"center"===I?.5:"right"===I?1:s(I)))),b&&("number"==typeof b?K=-b:"string"==typeof b&&(K="top"===b?0:"top-baseline"===b?-J[0].baseline:"top-cap"===b?-J[0].cap:"top-ex"===b?-J[0].ex:"middle"===b?Y/2:"bottom"===b?Y:"bottom-baseline"===b?-J[J.length-1].baseline:s(b)*Y)),!_){let e,i,n=t.getEmbeddingLevels(o,x);A=new Uint16Array(L),d=new Uint8Array(L),m=new Float32Array(2*L),p={},U=[r,r,-r,-r],z=[],T&&(S=new Float32Array(4*o.length)),F&&(M=new Uint8Array(3*L));let a=0,s=-1,c=-1;if(J.forEach((h,u)=>{let{count:f,width:g}=h;if(f>0){let u,v=0;for(let e=f;e--&&h.glyphAt(e).glyphObj.isWhitespace;)v++;let y=0,x=0;if("center"===E)y=(k-g)/2;else if("right"===E)y=k-g;else if("justify"===E&&h.isSoftWrapped){let e=0;for(let t=f-v;t--;)h.glyphAt(t).glyphObj.isWhitespace&&e++;x=(k-g)/e}if(x||y){let e=0;for(let t=0;t<f;t++){let r=h.glyphAt(t),i=r.glyphObj;r.x+=y+e,0!==x&&i.isWhitespace&&t<f-v&&(e+=x,r.width+=x)}}let C=t.getReorderSegments(o,n,h.glyphAt(0).charIndex,h.glyphAt(h.count-1).charIndex);for(let e=0;e<C.length;e++){let[t,r]=C[e],i=1/0,n=-1/0;for(let e=0;e<f;e++)if(h.glyphAt(e).charIndex>=t){let t=e,a=e;for(;a<f;a++){let e=h.glyphAt(a);if(e.charIndex>r)break;a<f-v&&(i=Math.min(i,e.x),n=Math.max(n,e.x+e.width))}for(let e=t;e<a;e++){let t=h.glyphAt(e);t.x=n-(t.x+t.width-i)}break}}let B=e=>u=e;for(let g=0;g<f;g++){let f=h.glyphAt(g),v=(u=f.glyphObj).index,y=1&n.levels[f.charIndex];if(y){let e=t.getMirroredCharacter(o[f.charIndex]);e&&f.fontData.fontObj.forEachGlyph(e,0,0,B)}if(T){let{charIndex:e,fontData:t}=f,r=f.x+W,i=f.x+f.width+W;S[4*e]=y?i:r,S[4*e+1]=y?r:i,S[4*e+2]=h.baseline+t.caretBottom+K,S[4*e+3]=h.baseline+t.caretTop+K;let n=e-s;n>1&&l(S,s,n),s=e}if(F){let{charIndex:e}=f;for(;e>c;)c++,F.hasOwnProperty(c)&&(i=F[c])}if(!u.isWhitespace&&!u.isEmpty){let t=a++,{fontSizeMult:n,src:o,index:s}=f.fontData,l=p[o]||(p[o]={});l[v]||(l[v]={path:u.path,pathBounds:[u.xMin,u.yMin,u.xMax,u.yMax]});let c=f.x+W,g=f.y+h.baseline+K;m[2*t]=c,m[2*t+1]=g;let y=c+u.xMin*n,x=g+u.yMin*n,E=c+u.xMax*n,C=g+u.yMax*n;y<U[0]&&(U[0]=y),x<U[1]&&(U[1]=x),E>U[2]&&(U[2]=E),C>U[3]&&(U[3]=C),t%D==0&&(e={start:t,end:t,rect:[r,r,-r,-r]},z.push(e)),e.end++;let B=e.rect;if(y<B[0]&&(B[0]=y),x<B[1]&&(B[1]=x),E>B[2]&&(B[2]=E),C>B[3]&&(B[3]=C),A[t]=v,d[t]=s,F){let e=3*t;M[e]=i>>16&255,M[e+1]=i>>8&255,M[e+2]=255&i}}}}}),S){let e=o.length-s;e>1&&l(S,s,e)}}let X=[];G.forEach(({index:e,src:t,unitsPerEm:r,ascender:i,descender:n,lineHeight:a,capHeight:o,xHeight:s})=>{X[e]={src:t,unitsPerEm:r,ascender:i,descender:n,lineHeight:a,capHeight:o,xHeight:s}}),Q.typesetting=c()-N,R({glyphIds:A,glyphFontIndices:d,glyphPositions:m,glyphData:p,fontData:X,caretPositions:S,glyphColors:M,chunkedBounds:z,fontSize:f,topBaseline:K+J[0].baseline,blockBounds:[W,K-Y,W+k,K],visibleBounds:U,timings:Q})})}function s(e){let t=e.match(/^([\d.]+)%$/),r=t?parseFloat(t[1]):NaN;return isNaN(r)?0:r/100}function l(e,t,r){let i=e[4*t],n=e[4*t+1],a=e[4*t+2],o=e[4*t+3],s=(n-i)/r;for(let n=0;n<r;n++){let r=(t+n)*4;e[r]=i+s*n,e[r+1]=i+s*(n+1),e[r+2]=a,e[r+3]=o}}function c(){return(self.performance||Date).now()}function h(){this.data=[]}let u=["glyphObj","x","y","width","charIndex","fontData"];return h.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/u.length)},glyphAt(e){let t=h.flyweight;return t.data=this.data,t.index=e,t},splitAt(e){let t=new h;return t.data=this.data.splice(e*u.length),t}},h.flyweight=u.reduce((e,t,r,i)=>(Object.defineProperty(e,t,{get(){return this.data[this.index*u.length+r]},set(e){this.data[this.index*u.length+r]=e}}),e),{data:null,index:0}),{typeset:o,measure:function(e,t){o({...e,metricsOnly:!0},e=>{let[r,i,n,a]=e.blockBounds;t({width:n-r,height:a-i})})}}},aB,function(){return function(e){var t,r,i,n,a={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},o={},s={};o.L=1,s[1]="L",Object.keys(a).forEach(function(e,t){o[e]=1<<t+1,s[o[e]]=e}),Object.freeze(o);var l=o.LRI|o.RLI|o.FSI,c=o.L|o.R|o.AL,h=o.B|o.S|o.WS|o.ON|o.FSI|o.LRI|o.RLI|o.PDI,u=o.BN|o.RLE|o.LRE|o.RLO|o.LRO|o.PDF,A=o.S|o.WS|o.B|l|o.PDI|u,d=null;function f(e){if(!d){d=new Map;var t=function(e){if(a.hasOwnProperty(e)){var t=0;a[e].split(",").forEach(function(r){var i=r.split("+"),n=i[0],a=i[1];n=parseInt(n,36),a=a?parseInt(a,36):0,d.set(t+=n,o[e]);for(var s=0;s<a;s++)d.set(++t,o[e])})}};for(var r in a)t(r)}return d.get(e.codePointAt(0))||o.L}function m(e,t){var r,i=0,n=new Map,a=t&&new Map;return e.split(",").forEach(function e(o){if(-1!==o.indexOf("+"))for(var s=+o;s--;)e(r);else{r=o;var l=o.split(">"),c=l[0],h=l[1];c=String.fromCodePoint(i+=parseInt(c,36)),h=String.fromCodePoint(i+=parseInt(h,36)),n.set(c,h),t&&a.set(h,c)}}),{map:n,reverseMap:a}}function p(){if(!t){var e=m("14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",!0),n=e.map,a=e.reverseMap;t=n,r=a,i=m("6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye",!1).map}}function g(e){return p(),t.get(e)||null}function v(e){return p(),r.get(e)||null}function y(e){return p(),i.get(e)||null}var x=o.L,E=o.R,C=o.EN,B=o.ES,w=o.ET,I=o.AN,b=o.CS,_=o.B,M=o.S,S=o.ON,T=o.BN,D=o.NSM,F=o.AL,R=o.LRO,P=o.RLO,Q=o.LRE,U=o.RLE,z=o.PDF,k=o.LRI,L=o.RLI,O=o.FSI,G=o.PDI;function N(e){if(!n){var t=m("14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",!0),r=t.map;t.reverseMap.forEach(function(e,t){r.set(t,e)}),n=r}return n.get(e)||null}function H(e,t,r,i){var n=e.length;r=Math.max(0,null==r?0:+r),i=Math.min(n-1,null==i?n-1:+i);var a=[];return t.paragraphs.forEach(function(n){var o=Math.max(r,n.start),s=Math.min(i,n.end);if(o<s){for(var l=t.levels.slice(o,s+1),c=s;c>=o&&f(e[c])&A;c--)l[c]=n.level;for(var h=n.level,u=1/0,d=0;d<l.length;d++){var m=l[d];m>h&&(h=m),m<u&&(u=1|m)}for(var p=h;p>=u;p--)for(var g=0;g<l.length;g++)if(l[g]>=p){for(var v=g;g+1<l.length&&l[g+1]>=p;)g++;g>v&&a.push([v+o,g+o])}}}),a}function V(e,t,r,i){for(var n=H(e,t,r,i),a=[],o=0;o<e.length;o++)a[o]=o;return n.forEach(function(e){for(var t=e[0],r=e[1],i=a.slice(t,r+1),n=i.length;n--;)a[r-n]=i[n]}),a}return e.closingToOpeningBracket=v,e.getBidiCharType=f,e.getBidiCharTypeName=function(e){return s[f(e)]},e.getCanonicalBracket=y,e.getEmbeddingLevels=function(e,t){for(var r=new Uint32Array(e.length),i=0;i<e.length;i++)r[i]=f(e[i]);var n=new Map;function a(e,t){var i=r[e];r[e]=t,n.set(i,n.get(i)-1),i&h&&n.set(h,n.get(h)-1),n.set(t,(n.get(t)||0)+1),t&h&&n.set(h,(n.get(h)||0)+1)}for(var o=new Uint8Array(e.length),s=new Map,d=[],m=null,p=0;p<e.length;p++)m||d.push(m={start:p,end:e.length-1,level:"rtl"===t?1:"ltr"===t?0:tT(p,!1)}),r[p]&_&&(m.end=p,m=null);for(var N=U|Q|P|R|l|G|z|_,H=function(e){return e+(1&e?1:2)},V=function(e){return e+(1&e?2:1)},j=0;j<d.length;j++){var J=[{_level:(m=d[j]).level,_override:0,_isolate:0}],Y=void 0,W=0,K=0,X=0;n.clear();for(var q=m.start;q<=m.end;q++){var Z=r[q];if(Y=J[J.length-1],n.set(Z,(n.get(Z)||0)+1),Z&h&&n.set(h,(n.get(h)||0)+1),Z&N)if(Z&(U|Q)){o[q]=Y._level;var $=(Z===U?V:H)(Y._level);!($<=125)||W||K?!W&&K++:J.push({_level:$,_override:0,_isolate:0})}else if(Z&(P|R)){o[q]=Y._level;var ee=(Z===P?V:H)(Y._level);!(ee<=125)||W||K?!W&&K++:J.push({_level:ee,_override:Z&P?E:x,_isolate:0})}else if(Z&l){Z&O&&(Z=1===tT(q+1,!0)?L:k),o[q]=Y._level,Y._override&&a(q,Y._override);var et=(Z===L?V:H)(Y._level);et<=125&&0===W&&0===K?(X++,J.push({_level:et,_override:0,_isolate:1,_isolInitIndex:q})):W++}else if(Z&G){if(W>0)W--;else if(X>0){for(K=0;!J[J.length-1]._isolate;)J.pop();var er=J[J.length-1]._isolInitIndex;null!=er&&(s.set(er,q),s.set(q,er)),J.pop(),X--}Y=J[J.length-1],o[q]=Y._level,Y._override&&a(q,Y._override)}else Z&z?(0===W&&(K>0?K--:!Y._isolate&&J.length>1&&(J.pop(),Y=J[J.length-1])),o[q]=Y._level):Z&_&&(o[q]=m.level);else o[q]=Y._level,Y._override&&Z!==T&&a(q,Y._override)}for(var ei=[],en=null,ea=m.start;ea<=m.end;ea++){var eo=r[ea];if(!(eo&u)){var es=o[ea],el=eo&l,ec=eo===G;en&&es===en._level?(en._end=ea,en._endsWithIsolInit=el):ei.push(en={_start:ea,_end:ea,_level:es,_startsWithPDI:ec,_endsWithIsolInit:el})}}for(var eh=[],eu=0;eu<ei.length;eu++){var eA=ei[eu];if(!eA._startsWithPDI||eA._startsWithPDI&&!s.has(eA._start)){for(var ed=[en=eA],ef=void 0;en&&en._endsWithIsolInit&&null!=(ef=s.get(en._end));)for(var em=eu+1;em<ei.length;em++)if(ei[em]._start===ef){ed.push(en=ei[em]);break}for(var ep=[],eg=0;eg<ed.length;eg++)for(var ev=ed[eg],ey=ev._start;ey<=ev._end;ey++)ep.push(ey);for(var ex=o[ep[0]],eE=m.level,eC=ep[0]-1;eC>=0;eC--)if(!(r[eC]&u)){eE=o[eC];break}var eB=ep[ep.length-1],ew=o[eB],eI=m.level;if(!(r[eB]&l)){for(var eb=eB+1;eb<=m.end;eb++)if(!(r[eb]&u)){eI=o[eb];break}}eh.push({_seqIndices:ep,_sosType:Math.max(eE,ex)%2?E:x,_eosType:Math.max(eI,ew)%2?E:x})}}for(var e_=0;e_<eh.length;e_++){var eM=eh[e_],eS=eM._seqIndices,eT=eM._sosType,eD=eM._eosType,eF=1&o[eS[0]]?E:x;if(n.get(D))for(var eR=0;eR<eS.length;eR++){var eP=eS[eR];if(r[eP]&D){for(var eQ=eT,eU=eR-1;eU>=0;eU--)if(!(r[eS[eU]]&u)){eQ=r[eS[eU]];break}a(eP,eQ&(l|G)?S:eQ)}}if(n.get(C))for(var ez=0;ez<eS.length;ez++){var ek=eS[ez];if(r[ek]&C)for(var eL=ez-1;eL>=-1;eL--){var eO=-1===eL?eT:r[eS[eL]];if(eO&c){eO===F&&a(ek,I);break}}}if(n.get(F))for(var eG=0;eG<eS.length;eG++){var eN=eS[eG];r[eN]&F&&a(eN,E)}if(n.get(B)||n.get(b))for(var eH=1;eH<eS.length-1;eH++){var eV=eS[eH];if(r[eV]&(B|b)){for(var ej=0,eJ=0,eY=eH-1;eY>=0&&(ej=r[eS[eY]])&u;eY--);for(var eW=eH+1;eW<eS.length&&(eJ=r[eS[eW]])&u;eW++);ej===eJ&&(r[eV]===B?ej===C:ej&(C|I))&&a(eV,ej)}}if(n.get(C)){for(var eK=0;eK<eS.length;eK++)if(r[eS[eK]]&C){for(var eX=eK-1;eX>=0&&r[eS[eX]]&(w|u);eX--)a(eS[eX],C);for(eK++;eK<eS.length&&r[eS[eK]]&(w|u|C);eK++)r[eS[eK]]!==C&&a(eS[eK],C)}}if(n.get(w)||n.get(B)||n.get(b))for(var eq=0;eq<eS.length;eq++){var eZ=eS[eq];if(r[eZ]&(w|B|b)){a(eZ,S);for(var e$=eq-1;e$>=0&&r[eS[e$]]&u;e$--)a(eS[e$],S);for(var e1=eq+1;e1<eS.length&&r[eS[e1]]&u;e1++)a(eS[e1],S)}}if(n.get(C))for(var e0=0,e2=eT;e0<eS.length;e0++){var e3=eS[e0],e4=r[e3];e4&C?e2===x&&a(e3,x):e4&c&&(e2=e4)}if(n.get(h)){for(var e5=E|C|I,e6=e5|x,e8=[],e9=[],e7=0;e7<eS.length;e7++)if(r[eS[e7]]&h){var te=e[eS[e7]],tt=void 0;if(null!==g(te))if(e9.length<63)e9.push({char:te,seqIndex:e7});else break;else if(null!==(tt=v(te)))for(var tr=e9.length-1;tr>=0;tr--){var ti=e9[tr].char;if(ti===tt||ti===v(y(te))||g(y(ti))===te){e8.push([e9[tr].seqIndex,e7]),e9.length=tr;break}}}e8.sort(function(e,t){return e[0]-t[0]});for(var tn=0;tn<e8.length;tn++){for(var ta=e8[tn],to=ta[0],ts=ta[1],tl=!1,tc=0,th=to+1;th<ts;th++){var tu=eS[th];if(r[tu]&e6){tl=!0;var tA=r[tu]&e5?E:x;if(tA===eF){tc=tA;break}}}if(tl&&!tc){tc=eT;for(var td=to-1;td>=0;td--){var tf=eS[td];if(r[tf]&e6){var tm=r[tf]&e5?E:x;tc=tm!==eF?tm:eF;break}}}if(tc){if(r[eS[to]]=r[eS[ts]]=tc,tc!==eF){for(var tp=to+1;tp<eS.length;tp++)if(!(r[eS[tp]]&u)){f(e[eS[tp]])&D&&(r[eS[tp]]=tc);break}}if(tc!==eF){for(var tg=ts+1;tg<eS.length;tg++)if(!(r[eS[tg]]&u)){f(e[eS[tg]])&D&&(r[eS[tg]]=tc);break}}}}for(var tv=0;tv<eS.length;tv++)if(r[eS[tv]]&h){for(var ty=tv,tx=tv,tE=eT,tC=tv-1;tC>=0;tC--)if(r[eS[tC]]&u)ty=tC;else{tE=r[eS[tC]]&e5?E:x;break}for(var tB=eD,tw=tv+1;tw<eS.length;tw++)if(r[eS[tw]]&(h|u))tx=tw;else{tB=r[eS[tw]]&e5?E:x;break}for(var tI=ty;tI<=tx;tI++)r[eS[tI]]=tE===tB?tE:eF;tv=tx}}}for(var tb=m.start;tb<=m.end;tb++){var t_=o[tb],tM=r[tb];if(1&t_?tM&(x|C|I)&&o[tb]++:tM&E?o[tb]++:tM&(I|C)&&(o[tb]+=2),tM&u&&(o[tb]=0===tb?m.level:o[tb-1]),tb===m.end||f(e[tb])&(M|_))for(var tS=tb;tS>=0&&f(e[tS])&A;tS--)o[tS]=m.level}}return{levels:o,paragraphs:d};function tT(t,i){for(var n=t;n<e.length;n++){var a=r[n];if(a&(E|F))return 1;if(a&(_|x)||i&&a===G)break;if(a&l){var o=function(t){for(var i=1,n=t+1;n<e.length;n++){var a=r[n];if(a&_)break;if(a&G){if(0==--i)return n}else a&l&&i++}return -1}(n);n=-1===o?e.length:o}}return 0}},e.getMirroredCharacter=N,e.getMirroredCharactersMap=function(e,t,r,i){var n=e.length;r=Math.max(0,null==r?0:+r),i=Math.min(n-1,null==i?n-1:+i);for(var a=new Map,o=r;o<=i;o++)if(1&t[o]){var s=N(e[o]);null!==s&&a.set(o,s)}return a},e.getReorderSegments=H,e.getReorderedIndices=V,e.getReorderedString=function(e,t,r,i){var n=V(e,t,r,i),a=[].concat(e);return n.forEach(function(r,i){a[i]=(1&t.levels[r]?N(e[r]):null)||e[r]}),a.join("")},e.openingToClosingBracket=g,Object.defineProperty(e,"__esModule",{value:!0}),e}({})}],init:(e,t,r)=>e(t,r())}),aN=n8({name:"Typesetter",dependencies:[aG],init:e=>function(t){return new Promise(r=>{e.typeset(t,r)})},getTransferables(e){let t=[];for(let r in e)e[r]&&e[r].buffer&&t.push(e[r].buffer);return t}}),aH=aN.onMainThread,aV={},aj="aTroikaGlyphIndex";class aJ extends nZ.InstancedBufferGeometry{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new nZ.Sphere,this.boundingBox=new nZ.Box3}computeBoundingSphere(){}computeBoundingBox(){}set detail(e){if(e!==this._detail){var t;let r;this._detail=e,("number"!=typeof e||e<1)&&(e=1);let i=((r=aV[t=e])||(r=aV[t]=new nZ.PlaneGeometry(1,1,t,t).translate(.5,.5,0)),r);["position","normal","uv"].forEach(e=>{this.attributes[e]=i.attributes[e].clone()}),this.setIndex(i.getIndex().clone())}}get detail(){return this._detail}set curveRadius(e){e!==this._curveRadius&&(this._curveRadius=e,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(e,t,r,i,n){this.updateAttributeData("aTroikaGlyphBounds",e,4),this.updateAttributeData(aj,t,1),this.updateAttributeData("aTroikaGlyphColor",n,3),this._blockBounds=r,this._chunkedBounds=i,this.instanceCount=t.length,this._updateBounds()}_updateBounds(){let e=this._blockBounds;if(e){let{curveRadius:t,boundingBox:r}=this;if(t){let{PI:i,floor:n,min:a,max:o,sin:s,cos:l}=Math,c=i/2,h=2*i,u=Math.abs(t),A=e[0]/u,d=e[2]/u,f=n((A+c)/h)!==n((d+c)/h)?-u:a(s(A)*u,s(d)*u),m=n((A-c)/h)!==n((d-c)/h)?u:o(s(A)*u,s(d)*u),p=n((A+i)/h)!==n((d+i)/h)?2*u:o(u-l(A)*u,u-l(d)*u);r.min.set(f,e[1],t<0?-p:0),r.max.set(m,e[3],t<0?0:p)}else r.min.set(e[0],e[1],0),r.max.set(e[2],e[3],0);r.getBoundingSphere(this.boundingSphere)}}applyClipRect(e){let t=this.getAttribute(aj).count,r=this._chunkedBounds;if(r)for(let i=r.length;i--;){t=r[i].end;let n=r[i].rect;if(n[1]<e.w&&n[3]>e.y&&n[0]<e.z&&n[2]>e.x)break}this.instanceCount=t}updateAttributeData(e,t,r){let i=this.getAttribute(e);t?i&&i.array.length===t.length?(i.array.set(t),i.needsUpdate=!0):(this.setAttribute(e,new nZ.InstancedBufferAttribute(t,r)),delete this._maxInstanceCount,this.dispose()):i&&this.deleteAttribute(e)}}let aY=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,aW=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,aK=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,aX=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`,aq=new nZ.MeshBasicMaterial({color:0xffffff,side:nZ.DoubleSide,transparent:!0}),aZ=new nZ.Matrix4,a$=new nZ.Vector3,a1=new nZ.Vector3,a0=[],a2=new nZ.Vector3,a3="+x+y";function a4(e){return Array.isArray(e)?e[0]:e}let a5=()=>{let e=new nZ.Mesh(new nZ.PlaneGeometry(1,1),aq);return a5=()=>e,e},a6=()=>{let e=new nZ.Mesh(new nZ.PlaneGeometry(1,1,32,1),aq);return a6=()=>e,e},a8={type:"syncstart"},a9={type:"synccomplete"},a7=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],oe=a7.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");class ot extends nZ.Mesh{constructor(){super(new aJ,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=8421504,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=a3,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(e){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(a8),az({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},t=>{this._isSyncing=!1,this._textRenderInfo=t,this.geometry.updateGlyphs(t.glyphBounds,t.glyphAtlasIndices,t.blockBounds,t.chunkedBounds,t.glyphColors);let r=this._queuedSyncs;r&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{r.forEach(e=>e&&e())})),this.dispatchEvent(a9),e&&e()})))}onBeforeRender(e,t,r,i,n,a){this.sync(),n.isTroikaTextMaterial&&this._prepareForRender(n)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(e){let t;return(t=ah(e,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new nZ.Vector2},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new nZ.Vector4(0,0,0,0)},uTroikaClipRect:{value:new nZ.Vector4(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new nZ.Vector2},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new nZ.Color},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new nZ.Matrix3},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:aY,vertexTransform:aW,fragmentDefs:aK,fragmentColorTransform:aX,customRewriter({vertexShader:e,fragmentShader:t}){let r=/\buniform\s+vec3\s+diffuse\b/;return r.test(t)&&(t=t.replace(r,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),r.test(e)||(e=e.replace(ar,"uniform vec3 diffuse;\n$&\nvTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;\n"))),{vertexShader:e,fragmentShader:t}}})).transparent=!0,t.forceSinglePass=!0,Object.defineProperties(t,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),t}get material(){let e=this._derivedMaterial,t=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=aq.clone());if(e&&e.isDerivedFrom(t)||(e=this._derivedMaterial=this.createDerivedMaterial(t),t.addEventListener("dispose",function r(){t.removeEventListener("dispose",r),e.dispose()})),!this.hasOutline())return e;{let t=e._outlineMtl;return t||((t=e._outlineMtl=Object.create(e,{id:{value:e.id+.1}})).isTextOutlineMaterial=!0,t.depthWrite=!1,t.map=null,e.addEventListener("dispose",function r(){e.removeEventListener("dispose",r),t.dispose()})),[t,e]}}set material(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(e){this.geometry.detail=e}get curveRadius(){return this.geometry.curveRadius}set curveRadius(e){this.geometry.curveRadius=e}get customDepthMaterial(){return a4(this.material).getDepthMaterial()}set customDepthMaterial(e){}get customDistanceMaterial(){return a4(this.material).getDistanceMaterial()}set customDistanceMaterial(e){}_prepareForRender(e){let t=e.isTextOutlineMaterial,r=e.uniforms,i=this.textRenderInfo;if(i){let e,n,a,{sdfTexture:o,blockBounds:s}=i;r.uTroikaSDFTexture.value=o,r.uTroikaSDFTextureSize.value.set(o.image.width,o.image.height),r.uTroikaSDFGlyphSize.value=i.sdfGlyphSize,r.uTroikaSDFExponent.value=i.sdfExponent,r.uTroikaTotalBounds.value.fromArray(s),r.uTroikaUseGlyphColors.value=!t&&!!i.glyphColors;let l=0,c=0,h=0,u=0,A=0;if(t){let{outlineWidth:t,outlineOffsetX:r,outlineOffsetY:i,outlineBlur:n,outlineOpacity:a}=this;l=this._parsePercent(t)||0,c=Math.max(0,this._parsePercent(n)||0),e=a,u=this._parsePercent(r)||0,A=this._parsePercent(i)||0}else(h=Math.max(0,this._parsePercent(this.strokeWidth)||0))&&(a=this.strokeColor,r.uTroikaStrokeColor.value.set(null==a?8421504:a),null==(n=this.strokeOpacity)&&(n=1)),e=this.fillOpacity;r.uTroikaEdgeOffset.value=l,r.uTroikaPositionOffset.value.set(u,A),r.uTroikaBlurRadius.value=c,r.uTroikaStrokeWidth.value=h,r.uTroikaStrokeOpacity.value=n,r.uTroikaFillOpacity.value=null==e?1:e,r.uTroikaCurveRadius.value=this.curveRadius||0;let d=this.clipRect;if(d&&Array.isArray(d)&&4===d.length)r.uTroikaClipRect.value.fromArray(d);else{let e=100*(this.fontSize||.1);r.uTroikaClipRect.value.set(s[0]-e,s[1]-e,s[2]+e,s[3]+e)}this.geometry.applyClipRect(r.uTroikaClipRect.value)}r.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;let n=t?this.outlineColor||0:this.color;if(null==n)delete e.color;else{let t=e.hasOwnProperty("color")?e.color:e.color=new nZ.Color;(n!==t._input||"object"==typeof n)&&t.set(t._input=n)}let a=this.orientation||a3;if(a!==e._orientation){let t=r.uTroikaOrient.value,i=(a=a.replace(/[^-+xyz]/g,""))!==a3&&a.match(/^([-+])([xyz])([-+])([xyz])$/);if(i){let[,e,r,n,a]=i;a$.set(0,0,0)[r]="-"===e?1:-1,a1.set(0,0,0)[a]="-"===n?-1:1,aZ.lookAt(a2,a$.cross(a1),a1),t.setFromMatrix4(aZ)}else t.identity();e._orientation=a}}_parsePercent(e){if("string"==typeof e){let t=e.match(/^(-?[\d.]+)%$/),r=t?parseFloat(t[1]):NaN;e=(isNaN(r)?0:r/100)*this.fontSize}return e}localPositionToTextCoords(e,t=new nZ.Vector2){t.copy(e);let r=this.curveRadius;return r&&(t.x=Math.atan2(e.x,Math.abs(r)-Math.abs(e.z))*Math.abs(r)),t}worldPositionToTextCoords(e,t=new nZ.Vector2){return a$.copy(e),this.localPositionToTextCoords(this.worldToLocal(a$),t)}raycast(e,t){let{textRenderInfo:r,curveRadius:i}=this;if(r){let n=r.blockBounds,a=i?a6():a5(),o=a.geometry,{position:s,uv:l}=o.attributes;for(let e=0;e<l.count;e++){let t=n[0]+l.getX(e)*(n[2]-n[0]),r=n[1]+l.getY(e)*(n[3]-n[1]),a=0;i&&(a=i-Math.cos(t/i)*i,t=Math.sin(t/i)*i),s.setXYZ(e,t,r,a)}o.boundingSphere=this.geometry.boundingSphere,o.boundingBox=this.geometry.boundingBox,a.matrixWorld=this.matrixWorld,a.material.side=this.material.side,a0.length=0,a.raycast(e,a0);for(let e=0;e<a0.length;e++)a0[e].object=this,t.push(a0[e])}}copy(e){let t=this.geometry;return super.copy(e),this.geometry=t,oe.forEach(t=>{this[t]=e[t]}),this}clone(){return new this.constructor().copy(this)}}a7.forEach(e=>{let t="_private_"+e;Object.defineProperty(ot.prototype,e,{get(){return this[t]},set(e){e!==this[t]&&(this[t]=e,this._needsSync=!0)}})}),new nZ.Box3,new nZ.Color,new WeakMap,new WeakMap;var tI=tI,or=e.i(20284);let oi=tC.forwardRef(({sdfGlyphSize:e=64,anchorX:t="center",anchorY:r="middle",font:i,fontSize:n=1,children:a,characters:o,onSync:s,...l},c)=>{let h=(0,tI.C)(({invalidate:e})=>e),[u]=tC.useState(()=>new ot),[A,d]=tC.useMemo(()=>{let e=[],t="";return tC.Children.forEach(a,r=>{"string"==typeof r||"number"==typeof r?t+=r:e.push(r)}),[e,t]},[a]);return(0,or.suspend)(()=>new Promise(e=>(function({font:e,characters:t,sdfGlyphSize:r},i){az({font:e,sdfGlyphSize:r,text:Array.isArray(t)?t.join("\n"):""+t},i)})({font:i,characters:o},e)),["troika-text",i,o]),tC.useLayoutEffect(()=>void u.sync(()=>{h(),s&&s(u)})),tC.useEffect(()=>()=>u.dispose(),[u]),tC.createElement("primitive",e2({object:u,ref:c,font:i,text:d,anchorX:t,anchorY:r,fontSize:n,sdfGlyphSize:e},l),A)});var on=tI,oa=tw;class oo extends oa.ExtrudeGeometry{constructor(e,t={}){const{bevelEnabled:r=!1,bevelSize:i=8,bevelThickness:n=10,font:a,height:o=50,size:s=100,lineHeight:l=1,letterSpacing:c=0,...h}=t;void 0===a?super():super(a.generateShapes(e,s,{lineHeight:l,letterSpacing:c}),{...h,bevelEnabled:r,bevelSize:i,bevelThickness:n,depth:o}),this.type="TextGeometry"}}function os(e,t){if(t===tw.TrianglesDrawMode)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),e;if(t!==tw.TriangleFanDrawMode&&t!==tw.TriangleStripDrawMode)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",t),e;{let r=e.getIndex();if(null===r){let t=[],i=e.getAttribute("position");if(void 0===i)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(let e=0;e<i.count;e++)t.push(e);e.setIndex(t),r=e.getIndex()}let i=r.count-2,n=[];if(r)if(t===tw.TriangleFanDrawMode)for(let e=1;e<=i;e++)n.push(r.getX(0)),n.push(r.getX(e)),n.push(r.getX(e+1));else for(let e=0;e<i;e++)e%2==0?(n.push(r.getX(e)),n.push(r.getX(e+1)),n.push(r.getX(e+2))):(n.push(r.getX(e+2)),n.push(r.getX(e+1)),n.push(r.getX(e)));n.length/3!==i&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");let a=e.clone();return a.setIndex(n),a.clearGroups(),a}}function ol(e,t=Math.PI/3){let r=Math.cos(t),i=(1+1e-10)*100,n=[new tw.Vector3,new tw.Vector3,new tw.Vector3],a=new tw.Vector3,o=new tw.Vector3,s=new tw.Vector3,l=new tw.Vector3;function c(e){let t=~~(e.x*i),r=~~(e.y*i),n=~~(e.z*i);return`${t},${r},${n}`}let h=e.index?e.toNonIndexed():e,u=h.attributes.position,A={};for(let e=0,t=u.count/3;e<t;e++){let t=3*e,r=n[0].fromBufferAttribute(u,t+0),i=n[1].fromBufferAttribute(u,t+1),s=n[2].fromBufferAttribute(u,t+2);a.subVectors(s,i),o.subVectors(r,i);let l=new tw.Vector3().crossVectors(a,o).normalize();for(let e=0;e<3;e++){let t=c(n[e]);t in A||(A[t]=[]),A[t].push(l)}}let d=new Float32Array(3*u.count),f=new tw.BufferAttribute(d,3,!1);for(let e=0,t=u.count/3;e<t;e++){let t=3*e,i=n[0].fromBufferAttribute(u,t+0),h=n[1].fromBufferAttribute(u,t+1),d=n[2].fromBufferAttribute(u,t+2);a.subVectors(d,h),o.subVectors(i,h),s.crossVectors(a,o).normalize();for(let e=0;e<3;e++){let i=A[c(n[e])];l.set(0,0,0);for(let e=0,t=i.length;e<t;e++){let t=i[e];s.dot(t)>r&&l.add(t)}l.normalize(),f.setXYZ(t+e,l.x,l.y,l.z)}}return h.setAttribute("normal",f),h}var oc=tw,oh=Object.defineProperty,ou=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?oh(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r,r};class oA extends oc.Loader{constructor(e){super(e)}load(e,t,r,i){let n=new oc.FileLoader(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,e=>{if("string"!=typeof e)throw Error("unsupported data type");let r=JSON.parse(e),i=this.parse(r);t&&t(i)},r,i)}loadAsync(e,t){return super.loadAsync(e,t)}parse(e){return new od(e)}}class od{constructor(e){ou(this,"data"),ou(this,"isFont",!0),ou(this,"type","Font"),this.data=e}generateShapes(e,t=100,r){let i=[],n={letterSpacing:0,lineHeight:1,...r},a=function(e,t,r,i){let n=Array.from(e),a=t/r.resolution,o=(r.boundingBox.yMax-r.boundingBox.yMin+r.underlineThickness)*a,s=[],l=0,c=0;for(let e=0;e<n.length;e++){let t=n[e];if("\n"===t)l=0,c-=o*i.lineHeight;else{let e=function(e,t,r,i,n){let a,o,s,l,c,h,u,A,d=n.glyphs[e]||n.glyphs["?"];if(!d)return void console.error('THREE.Font: character "'+e+'" does not exists in font family '+n.familyName+".");let f=new oc.ShapePath;if(d.o){let e=d._cachedOutline||(d._cachedOutline=d.o.split(" "));for(let n=0,d=e.length;n<d;)switch(e[n++]){case"m":a=parseInt(e[n++])*t+r,o=parseInt(e[n++])*t+i,f.moveTo(a,o);break;case"l":a=parseInt(e[n++])*t+r,o=parseInt(e[n++])*t+i,f.lineTo(a,o);break;case"q":s=parseInt(e[n++])*t+r,l=parseInt(e[n++])*t+i,c=parseInt(e[n++])*t+r,h=parseInt(e[n++])*t+i,f.quadraticCurveTo(c,h,s,l);break;case"b":s=parseInt(e[n++])*t+r,l=parseInt(e[n++])*t+i,c=parseInt(e[n++])*t+r,h=parseInt(e[n++])*t+i,u=parseInt(e[n++])*t+r,A=parseInt(e[n++])*t+i,f.bezierCurveTo(c,h,u,A,s,l)}}return{offsetX:d.ha*t,path:f}}(t,a,l,c,r);e&&(l+=e.offsetX+i.letterSpacing,s.push(e.path))}}return s}(e,t,this.data,n);for(let e=0,t=a.length;e<t;e++)Array.prototype.push.apply(i,a[e].toShapes(!1));return i}}let of=null;async function om(e){return"string"==typeof e?await (await fetch(e)).json():e}async function op(e){var t;return t=await om(e),of||(of=new oA),of.parse(t)}function og(e){return(0,or.suspend)(op,[e])}og.preload=e=>(0,or.preload)(op,[e]),og.clear=e=>(0,or.clear)([e]);let ov=["string","number"],oy=tC.forwardRef(({font:e,letterSpacing:t=0,lineHeight:r=1,size:i=1,height:n=.2,bevelThickness:a=.1,bevelSize:o=.01,bevelEnabled:s=!1,bevelOffset:l=0,bevelSegments:c=4,curveSegments:h=8,smooth:u,children:A,...d},f)=>{tC.useMemo(()=>(0,on.e)({RenamedTextGeometry:oo}),[]);let m=tC.useRef(null),p=og(e),g=(0,tC.useMemo)(()=>({font:p,size:i,height:n,bevelThickness:a,bevelSize:o,bevelEnabled:s,bevelSegments:c,bevelOffset:l,curveSegments:h,letterSpacing:t,lineHeight:r}),[p,i,n,a,o,s,c,l,h,t,r]),[v,...y]=(0,tC.useMemo)(()=>{let e,t;return e="",t=[],tC.Children.forEach(A,r=>{ov.includes(typeof r)?e+=r+"":t.push(r)}),[e,...t]},[A]),x=tC.useMemo(()=>[v,g],[v,g]);return tC.useLayoutEffect(()=>{u&&(m.current.geometry=function(e,t=1e-4){t=Math.max(t,Number.EPSILON);let r={},i=e.getIndex(),n=e.getAttribute("position"),a=i?i.count:n.count,o=0,s=Object.keys(e.attributes),l={},c={},h=[],u=["getX","getY","getZ","getW"];for(let t=0,r=s.length;t<r;t++){let r=s[t];l[r]=[];let i=e.morphAttributes[r];i&&(c[r]=Array(i.length).fill(0).map(()=>[]))}let A=Math.pow(10,Math.log10(1/t));for(let t=0;t<a;t++){let n=i?i.getX(t):t,a="";for(let t=0,r=s.length;t<r;t++){let r=s[t],i=e.getAttribute(r),o=i.itemSize;for(let e=0;e<o;e++)a+=`${~~(i[u[e]](n)*A)},`}if(a in r)h.push(r[a]);else{for(let t=0,r=s.length;t<r;t++){let r=s[t],i=e.getAttribute(r),a=e.morphAttributes[r],o=i.itemSize,h=l[r],A=c[r];for(let e=0;e<o;e++){let t=u[e];if(h.push(i[t](n)),a)for(let e=0,r=a.length;e<r;e++)A[e].push(a[e][t](n))}}r[a]=o,h.push(o),o++}}let d=e.clone();for(let t=0,r=s.length;t<r;t++){let r=s[t],i=e.getAttribute(r),n=new i.array.constructor(l[r]),a=new tw.BufferAttribute(n,i.itemSize,i.normalized);if(d.setAttribute(r,a),r in c)for(let t=0;t<c[r].length;t++){let i=e.morphAttributes[r][t],n=new i.array.constructor(c[r][t]),a=new tw.BufferAttribute(n,i.itemSize,i.normalized);d.morphAttributes[r][t]=a}}return d.setIndex(h),d}(m.current.geometry,u),m.current.geometry.computeVertexNormals())},[x,u]),tC.useImperativeHandle(f,()=>m.current,[]),tC.createElement("mesh",e2({},d,{ref:m}),tC.createElement("renamedTextGeometry",{args:x}),y)});var on=tI,tI=tI;let ox={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`
    varying vec2 vUv;

    void main() {

    	vUv = uv;
    	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`
    uniform float opacity;

    uniform sampler2D tDiffuse;

    varying vec2 vUv;

    void main() {

    	vec4 texel = texture2D( tDiffuse, vUv );
    	gl_FragColor = opacity * texel;

    }
  `};var oE=Object.defineProperty,oC=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?oE(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r,r};class oB{constructor(){oC(this,"enabled",!0),oC(this,"needsSwap",!0),oC(this,"clear",!1),oC(this,"renderToScreen",!1)}setSize(e,t){}render(e,t,r,i,n){console.error("THREE.Pass: .render() must be implemented in derived pass.")}dispose(){}}class ow{constructor(e){oC(this,"camera",new tw.OrthographicCamera(-1,1,1,-1,0,1)),oC(this,"geometry",new tw.PlaneGeometry(2,2)),oC(this,"mesh"),this.mesh=new tw.Mesh(this.geometry,e)}get material(){return this.mesh.material}set material(e){this.mesh.material=e}dispose(){this.mesh.geometry.dispose()}render(e){e.render(this.mesh,this.camera)}}var oI=Object.defineProperty,ob=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?oI(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r,r};class o_ extends oB{constructor(e,t="tDiffuse"){super(),ob(this,"textureID"),ob(this,"uniforms"),ob(this,"material"),ob(this,"fsQuad"),this.textureID=t,e instanceof tw.ShaderMaterial?(this.uniforms=e.uniforms,this.material=e):(this.uniforms=tw.UniformsUtils.clone(e.uniforms),this.material=new tw.ShaderMaterial({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new ow(this.material)}render(e,t,r){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=r.texture),this.fsQuad.material=this.material,this.renderToScreen?e.setRenderTarget(null):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil)),this.fsQuad.render(e)}dispose(){this.fsQuad.dispose(),this.material.dispose()}}var oM=Object.defineProperty,oS=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?oM(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r,r};class oT extends oB{constructor(e,t){super(),oS(this,"scene"),oS(this,"camera"),oS(this,"inverse"),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,r){let i,n,a=e.getContext(),o=e.state;o.buffers.color.setMask(!1),o.buffers.depth.setMask(!1),o.buffers.color.setLocked(!0),o.buffers.depth.setLocked(!0),this.inverse?(i=0,n=1):(i=1,n=0),o.buffers.stencil.setTest(!0),o.buffers.stencil.setOp(a.REPLACE,a.REPLACE,a.REPLACE),o.buffers.stencil.setFunc(a.ALWAYS,i,0xffffffff),o.buffers.stencil.setClear(n),o.buffers.stencil.setLocked(!0),e.setRenderTarget(r),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),o.buffers.color.setLocked(!1),o.buffers.depth.setLocked(!1),o.buffers.stencil.setLocked(!1),o.buffers.stencil.setFunc(a.EQUAL,1,0xffffffff),o.buffers.stencil.setOp(a.KEEP,a.KEEP,a.KEEP),o.buffers.stencil.setLocked(!0)}}class oD extends oB{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}var oF=Object.defineProperty,oR=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?oF(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r,r};class oP{constructor(e,t){if(oR(this,"renderer"),oR(this,"_pixelRatio"),oR(this,"_width"),oR(this,"_height"),oR(this,"renderTarget1"),oR(this,"renderTarget2"),oR(this,"writeBuffer"),oR(this,"readBuffer"),oR(this,"renderToScreen"),oR(this,"passes",[]),oR(this,"copyPass"),oR(this,"clock"),this.renderer=e,void 0===t){const r={minFilter:tw.LinearFilter,magFilter:tw.LinearFilter,format:tw.RGBAFormat},i=e.getSize(new tw.Vector2);this._pixelRatio=e.getPixelRatio(),this._width=i.width,this._height=i.height,(t=new tw.WebGLRenderTarget(this._width*this._pixelRatio,this._height*this._pixelRatio,r)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,void 0===ox&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===o_&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new o_(ox),this.copyPass.material.blending=tw.NoBlending,this.clock=new tw.Clock}swapBuffers(){let e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){let t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){void 0===e&&(e=this.clock.getDelta());let t=this.renderer.getRenderTarget(),r=!1,i=this.passes.length;for(let t=0;t<i;t++){let i=this.passes[t];if(!1!==i.enabled){if(i.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(t),i.render(this.renderer,this.writeBuffer,this.readBuffer,e,r),i.needsSwap){if(r){let t=this.renderer.getContext(),r=this.renderer.state.buffers.stencil;r.setFunc(t.NOTEQUAL,1,0xffffffff),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),r.setFunc(t.EQUAL,1,0xffffffff)}this.swapBuffers()}void 0!==oT&&(i instanceof oT?r=!0:i instanceof oD&&(r=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(void 0===e){let t=this.renderer.getSize(new tw.Vector2);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;let r=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget1.setSize(r,i),this.renderTarget2.setSize(r,i);for(let e=0;e<this.passes.length;e++)this.passes[e].setSize(r,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.copyPass.dispose()}}var oQ=Object.defineProperty,oU=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?oQ(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r,r};class oz extends oB{constructor(e,t,r,i,n=0){super(),oU(this,"scene"),oU(this,"camera"),oU(this,"overrideMaterial"),oU(this,"clearColor"),oU(this,"clearAlpha"),oU(this,"clearDepth",!1),oU(this,"_oldClearColor",new tw.Color),this.scene=e,this.camera=t,this.overrideMaterial=r,this.clearColor=i,this.clearAlpha=n,this.clear=!0,this.needsSwap=!1}render(e,t,r){let i,n=e.autoClear;e.autoClear=!1;let a=null;void 0!==this.overrideMaterial&&(a=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),i=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:r),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,i),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=a),e.autoClear=n}}let ok={uniforms:{tDiffuse:{value:null}},vertexShader:`
    varying vec2 vUv;

    void main() {

    	vUv = uv;
    	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;

    varying vec2 vUv;

    void main() {

    	vec4 tex = texture2D( tDiffuse, vUv );

    	#ifdef LinearTosRGB
    		gl_FragColor = LinearTosRGB( tex );
    	#else
    		gl_FragColor = sRGBTransferOETF( tex );
    	#endif

    }
  `},oL=()=>{try{var e=document.createElement("canvas");return!!(window.WebGL2RenderingContext&&e.getContext("webgl2"))}catch(e){return!1}},oO=tC.forwardRef(({children:e,multisamping:t=8,renderIndex:r=1,disableRender:i,disableGamma:n,disableRenderPass:a,depthBuffer:o=!0,stencilBuffer:s=!1,anisotropy:l=1,colorSpace:c,type:h,...u},A)=>{tC.useMemo(()=>(0,on.e)({EffectComposer:oP,RenderPass:oz,ShaderPass:o_}),[]);let d=tC.useRef(null);tC.useImperativeHandle(A,()=>d.current,[]);let{scene:f,camera:m,gl:p,size:g,viewport:v}=(0,tI.C)(),[y]=tC.useState(()=>{let e=new tw.WebGLRenderTarget(g.width,g.height,{type:h||tw.HalfFloatType,format:tw.RGBAFormat,depthBuffer:o,stencilBuffer:s,anisotropy:l});return h===tw.UnsignedByteType&&null!=c&&(e.texture.colorSpace=c),e.samples=t,e});tC.useEffect(()=>{var e,t;null==(e=d.current)||e.setSize(g.width,g.height),null==(t=d.current)||t.setPixelRatio(v.dpr)},[p,g,v.dpr]),(0,tb.useFrame)(()=>{var e;i||null==(e=d.current)||e.render()},r);let x=[];return a||x.push(tC.createElement("renderPass",{key:"renderpass",attach:`passes-${x.length}`,args:[f,m]})),n||x.push(tC.createElement("shaderPass",{attach:`passes-${x.length}`,key:"gammapass",args:[ok]})),tC.Children.forEach(e,e=>{e&&x.push(tC.cloneElement(e,{key:x.length,attach:`passes-${x.length}`}))}),tC.createElement("effectComposer",e2({ref:d,args:[p,y]},u),x)});var tI=tI;let oG=((e3={}).Linear="linear",e3.Radial="radial",e3);function oN({stops:e,colors:t,size:r=1024,width:i=16,type:n=oG.Linear,innerCircleRadius:a=0,outerCircleRadius:o="auto",...s}){let l=(0,tI.C)(e=>e.gl),c=tC.useMemo(()=>{let s,l=document.createElement("canvas"),c=l.getContext("2d");if(l.width=i,l.height=r,n===oG.Linear)s=c.createLinearGradient(0,0,0,r);else{let e=l.width/2,t=l.height/2,r="auto"!==o?Math.abs(Number(o)):Math.sqrt(e**2+t**2);s=c.createRadialGradient(e,t,Math.abs(a),e,t,r)}let h=new tw.Color,u=e.length;for(;u--;)s.addColorStop(e[u],h.set(t[u]).getStyle());return c.save(),c.fillStyle=s,c.fillRect(0,0,i,r),c.restore(),l},[e]);return tC.createElement("canvasTexture",e2({colorSpace:l.outputColorSpace,args:[c],attach:"map"},s))}var on=tI,tI=tI,oH=tw;function oV(e,t,r,i){var n;return(n=class extends oH.ShaderMaterial{constructor(n){for(const i in super({vertexShader:t,fragmentShader:r,...n}),e)this.uniforms[i]=new oH.Uniform(e[i]),Object.defineProperty(this,i,{get(){return this.uniforms[i].value},set(e){this.uniforms[i].value=e}});this.uniforms=oH.UniformsUtils.clone(this.uniforms),null==i||i(this)}}).key=oH.MathUtils.generateUUID(),n}var tI=tI,nX=tI;let oj=e=>e===Object(e)&&!Array.isArray(e)&&"function"!=typeof e;function oJ(e,t){let r=(0,tI.C)(e=>e.gl),i=(0,nX.G)(tw.TextureLoader,oj(e)?Object.values(e):e);return(0,tC.useLayoutEffect)(()=>{null==t||t(i)},[t]),(0,tC.useEffect)(()=>{if("initTexture"in r){let e=[];Array.isArray(i)?e=i:i instanceof tw.Texture?e=[i]:oj(i)&&(e=Object.values(i)),e.forEach(e=>{e instanceof tw.Texture&&r.initTexture(e)})}},[r,i]),(0,tC.useMemo)(()=>{if(!oj(e))return i;{let t={},r=0;for(let n in e)t[n]=i[r++];return t}},[e,i])}oJ.preload=e=>nX.G.preload(tw.TextureLoader,e),oJ.clear=e=>nX.G.clear(tw.TextureLoader,e);let oY=({children:e,input:t,onLoad:r})=>{let i=oJ(t,r);return tC.createElement(tC.Fragment,null,null==e?void 0:e(i))},oW=parseInt(tw.REVISION.replace(/\D+/g,"")),oK=oV({color:new tw.Color("white"),scale:new tw.Vector2(1,1),imageBounds:new tw.Vector2(1,1),resolution:1024,map:null,zoom:1,radius:0,grayscale:0,opacity:1},`
  varying vec2 vUv;
  varying vec2 vPos;
  void main() {
    gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
    vUv = uv;
    vPos = position.xy;
  }
`,`
  // mostly from https://gist.github.com/statico/df64c5d167362ecf7b34fca0b1459a44
  varying vec2 vUv;
  varying vec2 vPos;
  uniform vec2 scale;
  uniform vec2 imageBounds;
  uniform float resolution;
  uniform vec3 color;
  uniform sampler2D map;
  uniform float radius;
  uniform float zoom;
  uniform float grayscale;
  uniform float opacity;
  const vec3 luma = vec3(.299, 0.587, 0.114);
  vec4 toGrayscale(vec4 color, float intensity) {
    return vec4(mix(color.rgb, vec3(dot(color.rgb, luma)), intensity), color.a);
  }
  vec2 aspect(vec2 size) {
    return size / min(size.x, size.y);
  }
  
  const float PI = 3.14159265;
    
  // from https://iquilezles.org/articles/distfunctions
  float udRoundBox( vec2 p, vec2 b, float r ) {
    return length(max(abs(p)-b+r,0.0))-r;
  }

  void main() {
    vec2 s = aspect(scale);
    vec2 i = aspect(imageBounds);
    float rs = s.x / s.y;
    float ri = i.x / i.y;
    vec2 new = rs < ri ? vec2(i.x * s.y / i.y, s.y) : vec2(s.x, i.y * s.x / i.x);
    vec2 offset = (rs < ri ? vec2((new.x - s.x) / 2.0, 0.0) : vec2(0.0, (new.y - s.y) / 2.0)) / new;
    vec2 uv = vUv * s / new + offset;
    vec2 zUv = (uv - vec2(0.5, 0.5)) / zoom + vec2(0.5, 0.5);

    vec2 res = vec2(scale * resolution);
    vec2 halfRes = 0.5 * res;
    float b = udRoundBox(vUv.xy * res - halfRes, halfRes, resolution * radius);    
	  vec3 a = mix(vec3(1.0,0.0,0.0), vec3(0.0,0.0,0.0), smoothstep(0.0, 1.0, b));
    gl_FragColor = toGrayscale(texture2D(map, zUv) * vec4(color, opacity * a), grayscale);
    
    #include <tonemapping_fragment>
    #include <${oW>=154?"colorspace_fragment":"encodings_fragment"}>
  }
`),oX=tC.forwardRef(({children:e,color:t,segments:r=1,scale:i=1,zoom:n=1,grayscale:a=0,opacity:o=1,radius:s=0,texture:l,toneMapped:c,transparent:h,side:u,...A},d)=>{(0,on.e)({ImageMaterial:oK});let f=tC.useRef(null),m=(0,tI.C)(e=>e.size),p=Array.isArray(i)?[i[0],i[1]]:[i,i],g=[l.image.width,l.image.height],v=Math.max(m.width,m.height);return tC.useImperativeHandle(d,()=>f.current,[]),tC.useLayoutEffect(()=>{f.current.geometry.parameters&&f.current.material.scale.set(p[0]*f.current.geometry.parameters.width,p[1]*f.current.geometry.parameters.height)},[p[0],p[1]]),tC.createElement("mesh",e2({ref:f,scale:Array.isArray(i)?[...i,1]:i},A),tC.createElement("planeGeometry",{args:[1,1,r,r]}),tC.createElement("imageMaterial",{color:t,map:l,zoom:n,grayscale:a,opacity:o,scale:p,imageBounds:g,resolution:v,radius:s,toneMapped:c,transparent:h,side:u,key:oK.key}),e)}),oq=tC.forwardRef(({url:e,...t},r)=>{let i=oJ(e);return tC.createElement(oX,e2({},t,{texture:i,ref:r}))}),oZ=tC.forwardRef(({url:e,...t},r)=>tC.createElement(oX,e2({},t,{ref:r}))),o$=tC.forwardRef((e,t)=>{if(e.url)return tC.createElement(oq,e2({},e,{ref:t}));if(e.texture)return tC.createElement(oZ,e2({},e,{ref:t}));throw Error("<Image /> requires a url or texture")}),o1=tC.forwardRef(({threshold:e=15,geometry:t,...r},i)=>{let n=tC.useRef(null);tC.useImperativeHandle(i,()=>n.current,[]);let a=tC.useMemo(()=>[0,0,0,1,0,0],[]),o=tC.useRef(null),s=tC.useRef(null);return tC.useLayoutEffect(()=>{let r=n.current.parent,i=null!=t?t:null==r?void 0:r.geometry;if(!i||o.current===i&&s.current===e)return;o.current=i,s.current=e;let a=new tw.EdgesGeometry(i,e).attributes.position.array;n.current.geometry.setPositions(a),n.current.geometry.attributes.instanceStart.needsUpdate=!0,n.current.geometry.attributes.instanceEnd.needsUpdate=!0,n.current.computeLineDistances()}),tC.createElement(nj,e2({segments:!0,points:a,ref:n,raycast:()=>null},r))});var tI=tI,on=tI,o0=tI;let o2=oV({screenspace:!1,color:new tw.Color("black"),opacity:1,thickness:.05,size:new tw.Vector2},`#include <common>
   #include <morphtarget_pars_vertex>
   #include <skinning_pars_vertex>
   #include <clipping_planes_pars_vertex>
   uniform float thickness;
   uniform bool screenspace;
   uniform vec2 size;
   void main() {
     #if defined (USE_SKINNING)
	     #include <beginnormal_vertex>
       #include <morphnormal_vertex>
       #include <skinbase_vertex>
       #include <skinnormal_vertex>
       #include <defaultnormal_vertex>
     #endif
     #include <begin_vertex>
	   #include <morphtarget_vertex>
	   #include <skinning_vertex>
     #include <project_vertex>
     #include <clipping_planes_vertex>
     vec4 tNormal = vec4(normal, 0.0);
     vec4 tPosition = vec4(transformed, 1.0);
     #ifdef USE_INSTANCING
       tNormal = instanceMatrix * tNormal;
       tPosition = instanceMatrix * tPosition;
     #endif
     if (screenspace) {
       vec3 newPosition = tPosition.xyz + tNormal.xyz * thickness;
       gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0); 
     } else {
       vec4 clipPosition = projectionMatrix * modelViewMatrix * tPosition;
       vec4 clipNormal = projectionMatrix * modelViewMatrix * tNormal;
       vec2 offset = normalize(clipNormal.xy) * thickness / size * clipPosition.w * 2.0;
       clipPosition.xy += offset;
       gl_Position = clipPosition;
     }
   }`,`uniform vec3 color;
   uniform float opacity;
   #include <clipping_planes_pars_fragment>
   void main(){
     #include <clipping_planes_fragment>
     gl_FragColor = vec4(color, opacity);
     #include <tonemapping_fragment>
     #include <${oW>=154?"colorspace_fragment":"encodings_fragment"}>
   }`);function o3({color:e="black",opacity:t=1,transparent:r=!1,screenspace:i=!1,toneMapped:n=!0,polygonOffset:a=!1,polygonOffsetFactor:o=0,renderOrder:s=0,thickness:l=.05,angle:c=Math.PI,clippingPlanes:h,...u}){let A=tC.useRef(null),[d]=tC.useState(()=>new o2({side:tw.BackSide})),{gl:f}=(0,tI.C)(),m=f.getDrawingBufferSize(new tw.Vector2);tC.useMemo(()=>(0,on.e)({OutlinesMaterial:o2}),[]);let p=tC.useRef(0),g=tC.useRef(null);return tC.useLayoutEffect(()=>{let e=A.current;if(!e)return;let t=e.parent;if(t&&t.geometry&&(p.current!==c||g.current!==t.geometry)){var r;p.current=c,g.current=t.geometry;let i=null==(r=e.children)?void 0:r[0];i&&(c&&i.geometry.dispose(),e.remove(i)),t.skeleton?((i=new tw.SkinnedMesh).material=d,i.bind(t.skeleton,t.bindMatrix)):t.isInstancedMesh?(i=new tw.InstancedMesh(t.geometry,d,t.count)).instanceMatrix=t.instanceMatrix:(i=new tw.Mesh).material=d,e.add(i),i.geometry=c?ol(t.geometry,c):t.geometry,i.morphTargetInfluences=t.morphTargetInfluences,i.morphTargetDictionary=t.morphTargetDictionary}}),tC.useLayoutEffect(()=>{let c=A.current;if(!c)return;let u=c.children[0];if(u){u.renderOrder=s;let A=c.parent;(0,o0.s)(u,{morphTargetInfluences:A.morphTargetInfluences,morphTargetDictionary:A.morphTargetDictionary}),(0,o0.s)(u.material,{transparent:r,thickness:l,color:e,opacity:t,size:m,screenspace:i,toneMapped:n,polygonOffset:a,polygonOffsetFactor:o,clippingPlanes:h,clipping:h&&h.length>0})}}),tC.useEffect(()=>()=>{let e=A.current;if(!e)return;let t=e.children[0];t&&(c&&t.geometry.dispose(),e.remove(t))},[]),tC.createElement("group",e2({ref:A},u))}var tI=tI,o4=tI,o5=tw,o6=Object.defineProperty,o8=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?o6(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r,r};function o9(e,t,r,i,n){let a;if(e=e.subarray||e.slice?e:e.buffer,r=r.subarray||r.slice?r:r.buffer,e=t?e.subarray?e.subarray(t,n&&t+n):e.slice(t,n&&t+n):e,r.set)r.set(e,i);else for(a=0;a<e.length;a++)r[a+i]=e[a];return r}class o7 extends o5.BufferGeometry{constructor(){super(),o8(this,"type","MeshLine"),o8(this,"isMeshLine",!0),o8(this,"positions",[]),o8(this,"previous",[]),o8(this,"next",[]),o8(this,"side",[]),o8(this,"width",[]),o8(this,"indices_array",[]),o8(this,"uvs",[]),o8(this,"counters",[]),o8(this,"widthCallback",null),o8(this,"_attributes"),o8(this,"_points",[]),o8(this,"points"),o8(this,"matrixWorld",new o5.Matrix4),Object.defineProperties(this,{points:{enumerable:!0,get(){return this._points},set(e){this.setPoints(e,this.widthCallback)}}})}setMatrixWorld(e){this.matrixWorld=e}setPoints(e,t){var r;if(e=(r=e)instanceof Float32Array?r:r instanceof o5.BufferGeometry?r.getAttribute("position").array:r.map(e=>{let t=Array.isArray(e);return e instanceof o5.Vector3?[e.x,e.y,e.z]:e instanceof o5.Vector2?[e.x,e.y,0]:t&&3===e.length?[e[0],e[1],e[2]]:t&&2===e.length?[e[0],e[1],0]:e}).flat(),this._points=e,this.widthCallback=null!=t?t:null,this.positions=[],this.counters=[],e.length&&e[0]instanceof o5.Vector3)for(let t=0;t<e.length;t++){let r=e[t],i=t/(e.length-1);this.positions.push(r.x,r.y,r.z),this.positions.push(r.x,r.y,r.z),this.counters.push(i),this.counters.push(i)}else for(let t=0;t<e.length;t+=3){let r=t/(e.length-1);this.positions.push(e[t],e[t+1],e[t+2]),this.positions.push(e[t],e[t+1],e[t+2]),this.counters.push(r),this.counters.push(r)}this.process()}compareV3(e,t){let r=6*e,i=6*t;return this.positions[r]===this.positions[i]&&this.positions[r+1]===this.positions[i+1]&&this.positions[r+2]===this.positions[i+2]}copyV3(e){let t=6*e;return[this.positions[t],this.positions[t+1],this.positions[t+2]]}process(){let e,t,r=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],t=this.compareV3(0,r-1)?this.copyV3(r-2):this.copyV3(0),this.previous.push(t[0],t[1],t[2]),this.previous.push(t[0],t[1],t[2]);for(let i=0;i<r;i++){if(this.side.push(1),this.side.push(-1),e=this.widthCallback?this.widthCallback(i/(r-1)):1,this.width.push(e),this.width.push(e),this.uvs.push(i/(r-1),0),this.uvs.push(i/(r-1),1),i<r-1){t=this.copyV3(i),this.previous.push(t[0],t[1],t[2]),this.previous.push(t[0],t[1],t[2]);let e=2*i;this.indices_array.push(e,e+1,e+2),this.indices_array.push(e+2,e+1,e+3)}i>0&&(t=this.copyV3(i),this.next.push(t[0],t[1],t[2]),this.next.push(t[0],t[1],t[2]))}t=this.compareV3(r-1,0)?this.copyV3(1):this.copyV3(r-1),this.next.push(t[0],t[1],t[2]),this.next.push(t[0],t[1],t[2]),this._attributes&&this._attributes.position.count===this.counters.length?(this._attributes.position.copyArray(new Float32Array(this.positions)),this._attributes.position.needsUpdate=!0,this._attributes.previous.copyArray(new Float32Array(this.previous)),this._attributes.previous.needsUpdate=!0,this._attributes.next.copyArray(new Float32Array(this.next)),this._attributes.next.needsUpdate=!0,this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0):this._attributes={position:new o5.BufferAttribute(new Float32Array(this.positions),3),previous:new o5.BufferAttribute(new Float32Array(this.previous),3),next:new o5.BufferAttribute(new Float32Array(this.next),3),side:new o5.BufferAttribute(new Float32Array(this.side),1),width:new o5.BufferAttribute(new Float32Array(this.width),1),uv:new o5.BufferAttribute(new Float32Array(this.uvs),2),index:new o5.BufferAttribute(new Uint16Array(this.indices_array),1),counters:new o5.BufferAttribute(new Float32Array(this.counters),1)},this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox()}advance({x:e,y:t,z:r}){let i=this._attributes.position.array,n=this._attributes.previous.array,a=this._attributes.next.array,o=i.length;o9(i,0,n,0,o),o9(i,6,i,0,o-6),i[o-6]=e,i[o-5]=t,i[o-4]=r,i[o-3]=e,i[o-2]=t,i[o-1]=r,o9(i,6,a,0,o-6),a[o-6]=e,a[o-5]=t,a[o-4]=r,a[o-3]=e,a[o-2]=t,a[o-1]=r,this._attributes.position.needsUpdate=!0,this._attributes.previous.needsUpdate=!0,this._attributes.next.needsUpdate=!0}}let se=`
  #include <common>
  #include <logdepthbuf_pars_vertex>
  #include <fog_pars_vertex>
  #include <clipping_planes_pars_vertex>

  attribute vec3 previous;
  attribute vec3 next;
  attribute float side;
  attribute float width;
  attribute float counters;
  
  uniform vec2 resolution;
  uniform float lineWidth;
  uniform vec3 color;
  uniform float opacity;
  uniform float sizeAttenuation;
  
  varying vec2 vUV;
  varying vec4 vColor;
  varying float vCounters;
  
  vec2 fix(vec4 i, float aspect) {
    vec2 res = i.xy / i.w;
    res.x *= aspect;
    return res;
  }
  
  void main() {
    float aspect = resolution.x / resolution.y;
    vColor = vec4(color, opacity);
    vUV = uv;
    vCounters = counters;
  
    mat4 m = projectionMatrix * modelViewMatrix;
    vec4 finalPosition = m * vec4(position, 1.0) * aspect;
    vec4 prevPos = m * vec4(previous, 1.0);
    vec4 nextPos = m * vec4(next, 1.0);
  
    vec2 currentP = fix(finalPosition, aspect);
    vec2 prevP = fix(prevPos, aspect);
    vec2 nextP = fix(nextPos, aspect);
  
    float w = lineWidth * width;
  
    vec2 dir;
    if (nextP == currentP) dir = normalize(currentP - prevP);
    else if (prevP == currentP) dir = normalize(nextP - currentP);
    else {
      vec2 dir1 = normalize(currentP - prevP);
      vec2 dir2 = normalize(nextP - currentP);
      dir = normalize(dir1 + dir2);
  
      vec2 perp = vec2(-dir1.y, dir1.x);
      vec2 miter = vec2(-dir.y, dir.x);
      //w = clamp(w / dot(miter, perp), 0., 4. * lineWidth * width);
    }
  
    //vec2 normal = (cross(vec3(dir, 0.), vec3(0., 0., 1.))).xy;
    vec4 normal = vec4(-dir.y, dir.x, 0., 1.);
    normal.xy *= .5 * w;
    //normal *= projectionMatrix;
    if (sizeAttenuation == 0.) {
      normal.xy *= finalPosition.w;
      normal.xy /= (vec4(resolution, 0., 1.) * projectionMatrix).xy * aspect;
    }
  
    finalPosition.xy += normal.xy * side;
    gl_Position = finalPosition;
    #include <logdepthbuf_vertex>
    #include <fog_vertex>
    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);
    #include <clipping_planes_vertex>
    #include <fog_vertex>
  }
`,st=parseInt(o5.REVISION.replace(/\D+/g,"")),sr=`
  #include <fog_pars_fragment>
  #include <logdepthbuf_pars_fragment>
  #include <clipping_planes_pars_fragment>
  
  uniform sampler2D map;
  uniform sampler2D alphaMap;
  uniform float useGradient;
  uniform float useMap;
  uniform float useAlphaMap;
  uniform float useDash;
  uniform float dashArray;
  uniform float dashOffset;
  uniform float dashRatio;
  uniform float visibility;
  uniform float alphaTest;
  uniform vec2 repeat;
  uniform vec3 gradient[2];
  
  varying vec2 vUV;
  varying vec4 vColor;
  varying float vCounters;
  
  void main() {
    #include <logdepthbuf_fragment>
    vec4 diffuseColor = vColor;
    if (useGradient == 1.) diffuseColor = vec4(mix(gradient[0], gradient[1], vCounters), 1.0);
    if (useMap == 1.) diffuseColor *= texture2D(map, vUV * repeat);
    if (useAlphaMap == 1.) diffuseColor.a *= texture2D(alphaMap, vUV * repeat).a;
    if (diffuseColor.a < alphaTest) discard;
    if (useDash == 1.) diffuseColor.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));
    diffuseColor.a *= step(vCounters, visibility);
    #include <clipping_planes_fragment>
    gl_FragColor = diffuseColor;     
    #include <fog_fragment>
    #include <tonemapping_fragment>
    #include <${st>=154?"colorspace_fragment":"encodings_fragment"}>
  }
`;class si extends o5.ShaderMaterial{constructor(e){super({uniforms:{...nw.UniformsLib.fog,lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:new o5.Color(0xffffff)},gradient:{value:[new o5.Color(0xff0000),new o5.Color(65280)]},opacity:{value:1},resolution:{value:new o5.Vector2(1,1)},sizeAttenuation:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},useGradient:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new o5.Vector2(1,1)}},vertexShader:se,fragmentShader:sr}),o8(this,"lineWidth"),o8(this,"map"),o8(this,"useMap"),o8(this,"alphaMap"),o8(this,"useAlphaMap"),o8(this,"color"),o8(this,"gradient"),o8(this,"resolution"),o8(this,"sizeAttenuation"),o8(this,"dashArray"),o8(this,"dashOffset"),o8(this,"dashRatio"),o8(this,"useDash"),o8(this,"useGradient"),o8(this,"visibility"),o8(this,"repeat"),this.type="MeshLineMaterial",Object.defineProperties(this,{lineWidth:{enumerable:!0,get(){return this.uniforms.lineWidth.value},set(e){this.uniforms.lineWidth.value=e}},map:{enumerable:!0,get(){return this.uniforms.map.value},set(e){this.uniforms.map.value=e}},useMap:{enumerable:!0,get(){return this.uniforms.useMap.value},set(e){this.uniforms.useMap.value=e}},alphaMap:{enumerable:!0,get(){return this.uniforms.alphaMap.value},set(e){this.uniforms.alphaMap.value=e}},useAlphaMap:{enumerable:!0,get(){return this.uniforms.useAlphaMap.value},set(e){this.uniforms.useAlphaMap.value=e}},color:{enumerable:!0,get(){return this.uniforms.color.value},set(e){this.uniforms.color.value=e}},gradient:{enumerable:!0,get(){return this.uniforms.gradient.value},set(e){this.uniforms.gradient.value=e}},opacity:{enumerable:!0,get(){return this.uniforms.opacity.value},set(e){this.uniforms.opacity.value=e}},resolution:{enumerable:!0,get(){return this.uniforms.resolution.value},set(e){this.uniforms.resolution.value.copy(e)}},sizeAttenuation:{enumerable:!0,get(){return this.uniforms.sizeAttenuation.value},set(e){this.uniforms.sizeAttenuation.value=e}},dashArray:{enumerable:!0,get(){return this.uniforms.dashArray.value},set(e){this.uniforms.dashArray.value=e,this.useDash=+(0!==e)}},dashOffset:{enumerable:!0,get(){return this.uniforms.dashOffset.value},set(e){this.uniforms.dashOffset.value=e}},dashRatio:{enumerable:!0,get(){return this.uniforms.dashRatio.value},set(e){this.uniforms.dashRatio.value=e}},useDash:{enumerable:!0,get(){return this.uniforms.useDash.value},set(e){this.uniforms.useDash.value=e}},useGradient:{enumerable:!0,get(){return this.uniforms.useGradient.value},set(e){this.uniforms.useGradient.value=e}},visibility:{enumerable:!0,get(){return this.uniforms.visibility.value},set(e){this.uniforms.visibility.value=e}},alphaTest:{enumerable:!0,get(){return this.uniforms.alphaTest.value},set(e){this.uniforms.alphaTest.value=e}},repeat:{enumerable:!0,get(){return this.uniforms.repeat.value},set(e){this.uniforms.repeat.value.copy(e)}}}),this.setValues(e)}copy(e){return super.copy(e),this.lineWidth=e.lineWidth,this.map=e.map,this.useMap=e.useMap,this.alphaMap=e.alphaMap,this.useAlphaMap=e.useAlphaMap,this.color.copy(e.color),this.gradient=e.gradient,this.opacity=e.opacity,this.resolution.copy(e.resolution),this.sizeAttenuation=e.sizeAttenuation,this.dashArray=e.dashArray,this.dashOffset=e.dashOffset,this.dashRatio=e.dashRatio,this.useDash=e.useDash,this.useGradient=e.useGradient,this.visibility=e.visibility,this.alphaTest=e.alphaTest,this.repeat.copy(e.repeat),this}}let sn={width:.2,length:1,decay:1,local:!1,stride:0,interval:1},sa=(e,t=1)=>(e.set(e.subarray(t)),e.fill(-1/0,-t),e);function so(e,t){let{length:r,local:i,decay:n,interval:a,stride:o}={...sn,...t},s=tC.useRef(null),[l]=tC.useState(()=>new tw.Vector3);tC.useLayoutEffect(()=>{e&&(s.current=Float32Array.from({length:10*r*3},(t,r)=>e.position.getComponent(r%3)))},[r,e]);let c=tC.useRef(new tw.Vector3),h=tC.useRef(0);return(0,tb.useFrame)(()=>{if(e&&s.current){if(0===h.current){let t;i?t=e.position:(e.getWorldPosition(l),t=l);let r=+n;for(let e=0;e<r;e++)t.distanceTo(c.current)<o||(sa(s.current,3),s.current.set(t.toArray(),s.current.length-3));c.current.copy(t)}h.current++,h.current=h.current%a}}),s}let ss=tC.forwardRef((e,t)=>{let{children:r}=e,{width:i,length:n,decay:a,local:o,stride:s,interval:l}={...sn,...e},{color:c="hotpink",attenuation:h,target:u}=e,A=(0,tI.C)(e=>e.size),d=(0,tI.C)(e=>e.scene),f=tC.useRef(null),[m,p]=tC.useState(null),g=so(m,{length:n,decay:a,local:o,stride:s,interval:l});tC.useEffect(()=>{let e=(null==u?void 0:u.current)||f.current.children.find(e=>e instanceof tw.Object3D);e&&p(e)},[g,u]);let v=tC.useMemo(()=>new o7,[]),y=tC.useMemo(()=>{var e,t;let n,a=new si({lineWidth:.1*i,color:c,sizeAttenuation:1,resolution:new tw.Vector2(A.width,A.height)});return r&&(Array.isArray(r)?n=r.find(e=>"string"==typeof e.type&&"meshLineMaterial"===e.type):"string"==typeof r.type&&"meshLineMaterial"===r.type&&(n=r)),"object"==typeof(null==(e=n)?void 0:e.props)&&(null==(t=n)?void 0:t.props)!==null&&a.setValues(n.props),a},[i,c,A,r]);return tC.useEffect(()=>{y.uniforms.resolution.value.set(A.width,A.height)},[A]),(0,tb.useFrame)(()=>{g.current&&v.setPoints(g.current,h)}),tC.createElement("group",null,(0,o4.o)(tC.createElement("mesh",{ref:t,geometry:v,material:y}),d),tC.createElement("group",{ref:f},r))}),sl=new tw.Triangle,sc=new tw.Vector3;class sh{constructor(e){let t=e.geometry;t.index&&(console.warn("THREE.MeshSurfaceSampler: Converting geometry to non-indexed BufferGeometry."),t=t.toNonIndexed()),this.geometry=t,this.randomFunction=Math.random,this.positionAttribute=this.geometry.getAttribute("position"),this.colorAttribute=this.geometry.getAttribute("color"),this.weightAttribute=null,this.distribution=null}setWeightAttribute(e){return this.weightAttribute=e?this.geometry.getAttribute(e):null,this}build(){let e=this.positionAttribute,t=this.weightAttribute,r=new Float32Array(e.count/3);for(let i=0;i<e.count;i+=3){let n=1;t&&(n=t.getX(i)+t.getX(i+1)+t.getX(i+2)),sl.a.fromBufferAttribute(e,i),sl.b.fromBufferAttribute(e,i+1),sl.c.fromBufferAttribute(e,i+2),n*=sl.getArea(),r[i/3]=n}this.distribution=new Float32Array(e.count/3);let i=0;for(let e=0;e<r.length;e++)i+=r[e],this.distribution[e]=i;return this}setRandomGenerator(e){return this.randomFunction=e,this}sample(e,t,r){let i=this.sampleFaceIndex();return this.sampleFace(i,e,t,r)}sampleFaceIndex(){let e=this.distribution[this.distribution.length-1];return this.binarySearch(this.randomFunction()*e)}binarySearch(e){let t=this.distribution,r=0,i=t.length-1,n=-1;for(;r<=i;){let a=Math.ceil((r+i)/2);if(0===a||t[a-1]<=e&&t[a]>e){n=a;break}e<t[a]?i=a-1:r=a+1}return n}sampleFace(e,t,r,i){let n=this.randomFunction(),a=this.randomFunction();return n+a>1&&(n=1-n,a=1-a),sl.a.fromBufferAttribute(this.positionAttribute,3*e),sl.b.fromBufferAttribute(this.positionAttribute,3*e+1),sl.c.fromBufferAttribute(this.positionAttribute,3*e+2),t.set(0,0,0).addScaledVector(sl.a,n).addScaledVector(sl.b,a).addScaledVector(sl.c,1-(n+a)),void 0!==r&&sl.getNormal(r),void 0!==i&&void 0!==this.colorAttribute&&(sl.a.fromBufferAttribute(this.colorAttribute,3*e),sl.b.fromBufferAttribute(this.colorAttribute,3*e+1),sl.c.fromBufferAttribute(this.colorAttribute,3*e+2),sc.set(0,0,0).addScaledVector(sl.a,n).addScaledVector(sl.b,a).addScaledVector(sl.c,1-(n+a)),i.r=sc.x,i.g=sc.y,i.b=sc.z),this}}function su(e,t=16,r,i,n){let[a,o]=tC.useState(()=>{let e=Array.from({length:t},()=>[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]).flat();return new tw.InstancedBufferAttribute(Float32Array.from(e),16)});return tC.useLayoutEffect(()=>{if(void 0===e.current)return;let s=new sh(e.current);i&&s.setWeightAttribute(i),s.build();let l=new tw.Vector3,c=new tw.Vector3,h=new tw.Color,u=new tw.Object3D;e.current.updateMatrixWorld(!0);for(let i=0;i<t;i++)s.sample(l,c,h),"function"==typeof r?r({dummy:u,sampledMesh:e.current,position:l,normal:c,color:h},i):u.position.copy(l),u.updateMatrix(),null!=n&&n.current&&n.current.setMatrixAt(i,u.matrix),u.matrix.toArray(a.array,16*i);null!=n&&n.current&&(n.current.instanceMatrix.needsUpdate=!0),a.needsUpdate=!0,o(new tw.InstancedBufferAttribute(a.array,a.itemSize).copy(a))},[e,n,i,t,r]),a}function sA({children:e,weight:t,transform:r,instances:i,mesh:n,count:a=16,...o}){let s=tC.useRef(null),l=tC.useRef(null),c=tC.useRef(null);return tC.useLayoutEffect(()=>{var e,t;l.current=null!=(e=null==i?void 0:i.current)?e:s.current.children.find(e=>e.hasOwnProperty("instanceMatrix")),c.current=null!=(t=null==n?void 0:n.current)?t:s.current.children.find(e=>"Mesh"===e.type)},[e,null==n?void 0:n.current,null==i?void 0:i.current]),su(c,a,r,t,l),tC.createElement("group",e2({ref:s},o),e)}let sd=({compute:e,name:t,...r})=>{let[i]=tC.useState(()=>new tw.BufferAttribute(new Float32Array(0),1)),n=tC.useRef(null);return tC.useLayoutEffect(()=>{if(n.current){var t;let r=e(null!=(t=n.current.parent)?t:n.current.__r3f.parent.object);n.current.copy(r)}},[e]),tC.createElement("primitive",e2({ref:n,object:i,attach:`attributes-${t}`},r))},sf=function(e){let t=new Map,r=new Map,i=e.clone();return function e(t,r,i){i(t,r);for(let n=0;n<t.children.length;n++)e(t.children[n],r.children[n],i)}(e,i,function(e,i){t.set(i,e),r.set(e,i)}),i.traverse(function(e){if(!e.isSkinnedMesh)return;let i=t.get(e),n=i.skeleton.bones;e.skeleton=i.skeleton.clone(),e.bindMatrix.copy(i.bindMatrix),e.skeleton.bones=n.map(function(e){return r.get(e)}),e.bind(e.skeleton,e.bindMatrix)}),i},sm=tC.forwardRef(({isChild:e=!1,object:t,children:r,deep:i,castShadow:n,receiveShadow:a,inject:o,keys:s,...l},c)=>{let h={keys:s,deep:i,inject:o,castShadow:n,receiveShadow:a};if(Array.isArray(t=tC.useMemo(()=>{if(!1===e&&!Array.isArray(t)){let e=!1;if(t.traverse(t=>{t.isSkinnedMesh&&(e=!0)}),e)return sf(t)}return t},[t,e])))return tC.createElement("group",e2({},l,{ref:c}),t.map(e=>tC.createElement(sm,e2({key:e.uuid,object:e},h))),r);let{children:u,...A}=function(e,{keys:t=["near","far","color","distance","decay","penumbra","angle","intensity","skeleton","visible","castShadow","receiveShadow","morphTargetDictionary","morphTargetInfluences","name","geometry","material","position","rotation","scale","up","userData","bindMode","bindMatrix","bindMatrixInverse","skeleton"],deep:r,inject:i,castShadow:n,receiveShadow:a}){let o={};for(let r of t)o[r]=e[r];return r&&(o.geometry&&"materialsOnly"!==r&&(o.geometry=o.geometry.clone()),o.material&&"geometriesOnly"!==r&&(o.material=o.material.clone())),i&&(o="function"==typeof i?{...o,children:i(e)}:tC.isValidElement(i)?{...o,children:i}:{...o,...i}),e instanceof tw.Mesh&&(n&&(o.castShadow=!0),a&&(o.receiveShadow=!0)),o}(t,h),d=t.type[0].toLowerCase()+t.type.slice(1);return tC.createElement(d,e2({},A,l,{ref:c}),t.children.map(e=>"Bone"===e.type?tC.createElement("primitive",e2({key:e.uuid,object:e},h)):tC.createElement(sm,e2({key:e.uuid,object:e},h,{isChild:!0}))),r,u)});var sp=tw;class sg extends sp.Mesh{constructor(e,t,r=!1,i=!1,n=1e4){const a=new sp.BufferGeometry;super(a,t),this.isMarchingCubes=!0;const o=this,s=new Float32Array(36),l=new Float32Array(36),c=new Float32Array(36);function h(e,t,r,i,n,a,h,u,A,d){var f,m,p,g,v,y;let x=(r-h)/(u-h),E=o.normal_cache;s[t+0]=i+x*o.delta,s[t+1]=n,s[t+2]=a,l[t+0]=(f=E[e+0],f+(E[e+3]-f)*x),l[t+1]=(m=E[e+1],m+(E[e+4]-m)*x),l[t+2]=(p=E[e+2],p+(E[e+5]-p)*x),c[t+0]=(g=o.palette[3*A+0],g+(o.palette[3*d+0]-g)*x),c[t+1]=(v=o.palette[3*A+1],v+(o.palette[3*d+1]-v)*x),c[t+2]=(y=o.palette[3*A+2],y+(o.palette[3*d+2]-y)*x)}function u(e,t,r,i,n,a,h,u,A,d){var f,m,p,g,v,y;let x=(r-h)/(u-h),E=o.normal_cache;s[t+0]=i,s[t+1]=n+x*o.delta,s[t+2]=a;let C=e+3*o.yd;l[t+0]=(f=E[e+0],f+(E[C+0]-f)*x),l[t+1]=(m=E[e+1],m+(E[C+1]-m)*x),l[t+2]=(p=E[e+2],p+(E[C+2]-p)*x),c[t+0]=(g=o.palette[3*A+0],g+(o.palette[3*d+0]-g)*x),c[t+1]=(v=o.palette[3*A+1],v+(o.palette[3*d+1]-v)*x),c[t+2]=(y=o.palette[3*A+2],y+(o.palette[3*d+2]-y)*x)}function A(e,t,r,i,n,a,h,u,A,d){var f,m,p,g,v,y;let x=(r-h)/(u-h),E=o.normal_cache;s[t+0]=i,s[t+1]=n,s[t+2]=a+x*o.delta;let C=e+3*o.zd;l[t+0]=(f=E[e+0],f+(E[C+0]-f)*x),l[t+1]=(m=E[e+1],m+(E[C+1]-m)*x),l[t+2]=(p=E[e+2],p+(E[C+2]-p)*x),c[t+0]=(g=o.palette[3*A+0],g+(o.palette[3*d+0]-g)*x),c[t+1]=(v=o.palette[3*A+1],v+(o.palette[3*d+1]-v)*x),c[t+2]=(y=o.palette[3*A+2],y+(o.palette[3*d+2]-y)*x)}function d(e){let t=3*e;0===o.normal_cache[t]&&(o.normal_cache[t+0]=o.field[e-1]-o.field[e+1],o.normal_cache[t+1]=o.field[e-o.yd]-o.field[e+o.yd],o.normal_cache[t+2]=o.field[e-o.zd]-o.field[e+o.zd])}this.enableUvs=r,this.enableColors=i,this.init=function(e){this.resolution=e,this.isolation=80,this.size=e,this.size2=this.size*this.size,this.size3=this.size2*this.size,this.halfsize=this.size/2,this.delta=2/this.size,this.yd=this.size,this.zd=this.size2,this.field=new Float32Array(this.size3),this.normal_cache=new Float32Array(3*this.size3),this.palette=new Float32Array(3*this.size3),this.count=0;let t=3*n;this.positionArray=new Float32Array(3*t);let r=new sp.BufferAttribute(this.positionArray,3);r.setUsage(sp.DynamicDrawUsage),a.setAttribute("position",r),this.normalArray=new Float32Array(3*t);let i=new sp.BufferAttribute(this.normalArray,3);if(i.setUsage(sp.DynamicDrawUsage),a.setAttribute("normal",i),this.enableUvs){this.uvArray=new Float32Array(2*t);let e=new sp.BufferAttribute(this.uvArray,2);e.setUsage(sp.DynamicDrawUsage),a.setAttribute("uv",e)}if(this.enableColors){this.colorArray=new Float32Array(3*t);let e=new sp.BufferAttribute(this.colorArray,3);e.setUsage(sp.DynamicDrawUsage),a.setAttribute("color",e)}a.boundingSphere=new sp.Sphere(new sp.Vector3,1)},this.addBall=function(e,t,r,i,n,a){let o,s,l,c,h,u,A,d,f,m,p,g=Math.sign(i);i=Math.abs(i);let v=null!=a,y=new sp.Color(e,t,r);if(v)try{y=a instanceof sp.Color?a:Array.isArray(a)?new sp.Color(Math.min(Math.abs(a[0]),1),Math.min(Math.abs(a[1]),1),Math.min(Math.abs(a[2]),1)):new sp.Color(a)}catch(i){y=new sp.Color(e,t,r)}let x=this.size*Math.sqrt(i/n),E=r*this.size,C=t*this.size,B=e*this.size,w=Math.floor(E-x);w<1&&(w=1);let I=Math.floor(E+x);I>this.size-1&&(I=this.size-1);let b=Math.floor(C-x);b<1&&(b=1);let _=Math.floor(C+x);_>this.size-1&&(_=this.size-1);let M=Math.floor(B-x);M<1&&(M=1);let S=Math.floor(B+x);for(S>this.size-1&&(S=this.size-1),l=w;l<I;l++)for(h=this.size2*l,f=(d=l/this.size-r)*d,s=b;s<_;s++)for(c=h+this.size*s,m=(A=s/this.size-t)*A,o=M;o<S;o++)if((p=i/(1e-6+(u=o/this.size-e)*u+m+f)-n)>0){this.field[c+o]+=p*g;let e=Math.sqrt((o-B)*(o-B)+(s-C)*(s-C)+(l-E)*(l-E))/x,t=1-e*e*e*(e*(6*e-15)+10);this.palette[(c+o)*3+0]+=y.r*t,this.palette[(c+o)*3+1]+=y.g*t,this.palette[(c+o)*3+2]+=y.b*t}},this.addPlaneX=function(e,t){let r=this.size,i=this.yd,n=this.zd,a=this.field,o,s,l,c,h,u,A=r*Math.sqrt(e/t);for(A>r&&(A=r),o=0;o<A;o++)if((c=e/(1e-4+(h=o/r)*h)-t)>0)for(s=0;s<r;s++)for(l=0,u=o+s*i;l<r;l++)a[n*l+u]+=c},this.addPlaneY=function(e,t){let r=this.size,i=this.yd,n=this.zd,a=this.field,o,s,l,c,h,u,A,d=r*Math.sqrt(e/t);for(d>r&&(d=r),s=0;s<d;s++)if((c=e/(1e-4+(h=s/r)*h)-t)>0)for(o=0,u=s*i;o<r;o++)for(l=0,A=u+o;l<r;l++)a[n*l+A]+=c},this.addPlaneZ=function(e,t){let r=this.size,i=this.yd,n=this.zd,a=this.field,o,s,l,c,h,u,A,d=r*Math.sqrt(e/t);for(d>r&&(d=r),l=0;l<d;l++)if((c=e/(1e-4+(h=l/r)*h)-t)>0)for(s=0,u=n*l;s<r;s++)for(o=0,A=u+s*i;o<r;o++)a[A+o]+=c},this.setCell=function(e,t,r,i){let n=this.size2*r+this.size*t+e;this.field[n]=i},this.getCell=function(e,t,r){let i=this.size2*r+this.size*t+e;return this.field[i]},this.blur=function(e=1){let t=this.field,r=t.slice(),i=this.size,n=this.size2;for(let a=0;a<i;a++)for(let o=0;o<i;o++)for(let s=0;s<i;s++){let l=n*s+i*o+a,c=r[l],h=1;for(let t=-1;t<=1;t+=2){let l=t+a;if(!(l<0)&&!(l>=i))for(let t=-1;t<=1;t+=2){let a=t+o;if(!(a<0)&&!(a>=i))for(let t=-1;t<=1;t+=2){let o=t+s;if(o<0||o>=i)continue;let u=r[n*o+i*a+l];h++,c+=e*(u-c)/h}}}t[l]=c}},this.reset=function(){for(let e=0;e<this.size3;e++)this.normal_cache[3*e]=0,this.field[e]=0,this.palette[3*e]=this.palette[3*e+1]=this.palette[3*e+2]=0},this.update=function(){this.count=0;let e=this.size-2;for(let t=1;t<e;t++){let r=this.size2*t,i=(t-this.halfsize)/this.halfsize;for(let t=1;t<e;t++){let n=r+this.size*t,a=(t-this.halfsize)/this.halfsize;for(let t=1;t<e;t++)!function(e,t,r,i,n){let a=i+1,f=i+o.yd,m=i+o.zd,p=a+o.yd,g=a+o.zd,v=i+o.yd+o.zd,y=a+o.yd+o.zd,x=0,E=o.field[i],C=o.field[a],B=o.field[f],w=o.field[p],I=o.field[m],b=o.field[g],_=o.field[v],M=o.field[y];E<n&&(x|=1),C<n&&(x|=2),B<n&&(x|=8),w<n&&(x|=4),I<n&&(x|=16),b<n&&(x|=32),_<n&&(x|=128),M<n&&(x|=64);let S=sv[x];if(0===S)return;let T=o.delta,D=e+T,F=t+T,R=r+T;1&S&&(d(i),d(a),h(3*i,0,n,e,t,r,E,C,i,a)),2&S&&(d(a),d(p),u(3*a,3,n,D,t,r,C,w,a,p)),4&S&&(d(f),d(p),h(3*f,6,n,e,F,r,B,w,f,p)),8&S&&(d(i),d(f),u(3*i,9,n,e,t,r,E,B,i,f)),16&S&&(d(m),d(g),h(3*m,12,n,e,t,R,I,b,m,g)),32&S&&(d(g),d(y),u(3*g,15,n,D,t,R,b,M,g,y)),64&S&&(d(v),d(y),h(3*v,18,n,e,F,R,_,M,v,y)),128&S&&(d(m),d(v),u(3*m,21,n,e,t,R,I,_,m,v)),256&S&&(d(i),d(m),A(3*i,24,n,e,t,r,E,I,i,m)),512&S&&(d(a),d(g),A(3*a,27,n,D,t,r,C,b,a,g)),1024&S&&(d(p),d(y),A(3*p,30,n,D,F,r,w,M,p,y)),2048&S&&(d(f),d(v),A(3*f,33,n,e,F,r,B,_,f,v)),x<<=4;let P,Q,U,z=0;for(;-1!=sy[x+z];)Q=(P=x+z)+1,U=P+2,function(e,t,r,i,n,a){let s=3*o.count;if(o.positionArray[s+0]=e[i],o.positionArray[s+1]=e[i+1],o.positionArray[s+2]=e[i+2],o.positionArray[s+3]=e[n],o.positionArray[s+4]=e[n+1],o.positionArray[s+5]=e[n+2],o.positionArray[s+6]=e[a],o.positionArray[s+7]=e[a+1],o.positionArray[s+8]=e[a+2],!0===o.material.flatShading){let e=(t[i+0]+t[n+0]+t[a+0])/3,r=(t[i+1]+t[n+1]+t[a+1])/3,l=(t[i+2]+t[n+2]+t[a+2])/3;o.normalArray[s+0]=e,o.normalArray[s+1]=r,o.normalArray[s+2]=l,o.normalArray[s+3]=e,o.normalArray[s+4]=r,o.normalArray[s+5]=l,o.normalArray[s+6]=e,o.normalArray[s+7]=r,o.normalArray[s+8]=l}else o.normalArray[s+0]=t[i+0],o.normalArray[s+1]=t[i+1],o.normalArray[s+2]=t[i+2],o.normalArray[s+3]=t[n+0],o.normalArray[s+4]=t[n+1],o.normalArray[s+5]=t[n+2],o.normalArray[s+6]=t[a+0],o.normalArray[s+7]=t[a+1],o.normalArray[s+8]=t[a+2];if(o.enableUvs){let t=2*o.count;o.uvArray[t+0]=e[i+0],o.uvArray[t+1]=e[i+2],o.uvArray[t+2]=e[n+0],o.uvArray[t+3]=e[n+2],o.uvArray[t+4]=e[a+0],o.uvArray[t+5]=e[a+2]}o.enableColors&&(o.colorArray[s+0]=r[i+0],o.colorArray[s+1]=r[i+1],o.colorArray[s+2]=r[i+2],o.colorArray[s+3]=r[n+0],o.colorArray[s+4]=r[n+1],o.colorArray[s+5]=r[n+2],o.colorArray[s+6]=r[a+0],o.colorArray[s+7]=r[a+1],o.colorArray[s+8]=r[a+2]),o.count+=3}(s,l,c,3*sy[P],3*sy[Q],3*sy[U]),z+=3}((t-this.halfsize)/this.halfsize,a,i,n+t,this.isolation)}}this.geometry.setDrawRange(0,this.count),a.getAttribute("position").needsUpdate=!0,a.getAttribute("normal").needsUpdate=!0,this.enableUvs&&(a.getAttribute("uv").needsUpdate=!0),this.enableColors&&(a.getAttribute("color").needsUpdate=!0),this.count/3>n&&console.warn("THREE.MarchingCubes: Geometry buffers too small for rendering. Please create an instance with a higher poly count.")},this.init(e)}}let sv=new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),sy=new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1]),sx=tC.createContext(null),sE=tC.forwardRef(({resolution:e=28,maxPolyCount:t=1e4,enableUvs:r=!1,enableColors:i=!1,children:n,...a},o)=>{let s=tC.useRef(null);tC.useImperativeHandle(o,()=>s.current,[]);let l=tC.useMemo(()=>new sg(e,null,r,i,t),[e,t,r,i]),c=tC.useMemo(()=>({getParent:()=>s}),[]);return(0,tb.useFrame)(()=>{l.update(),l.reset()},-1),tC.createElement(tC.Fragment,null,tC.createElement("primitive",e2({object:l,ref:s},a),tC.createElement(sx.Provider,{value:c},n)))}),sC=tC.forwardRef(({strength:e=.5,subtract:t=12,color:r,...i},n)=>{let{getParent:a}=tC.useContext(sx),o=tC.useMemo(()=>a(),[a]),s=tC.useRef(null);tC.useImperativeHandle(n,()=>s.current,[]);let l=new tw.Vector3;return(0,tb.useFrame)(i=>{o.current&&s.current&&(s.current.getWorldPosition(l),o.current.addBall(.5+.5*l.x,.5+.5*l.y,.5+.5*l.z,e,t,r))}),tC.createElement("group",e2({ref:s},i))}),sB=tC.forwardRef(({planeType:e="x",strength:t=.5,subtract:r=12,...i},n)=>{let{getParent:a}=tC.useContext(sx),o=tC.useMemo(()=>a(),[a]),s=tC.useRef(null);tC.useImperativeHandle(n,()=>s.current,[]);let l=tC.useMemo(()=>"x"===e?"addPlaneX":"y"===e?"addPlaneY":"addPlaneZ",[e]);return(0,tb.useFrame)(()=>{o.current&&s.current&&o.current[l](t,r)}),tC.createElement("group",e2({ref:s},i))});var o0=tI,sw=tw;class sI extends sw.BufferGeometry{constructor(e,t,r,i){super();const n=[],a=[],o=[],s=new sw.Vector3,l=new sw.Matrix4;l.makeRotationFromEuler(r),l.setPosition(t);const c=new sw.Matrix4;function h(t,r,i){r.applyMatrix4(e.matrixWorld),r.applyMatrix4(c),i.transformDirection(e.matrixWorld),t.push(new sb(r.clone(),i.clone()))}function u(e,t){let r=[],n=.5*Math.abs(i.dot(t));for(let i=0;i<e.length;i+=3){let a,o,s,l,c,h,u,d=e[i+0].position.dot(t)-n,f=e[i+1].position.dot(t)-n,m=e[i+2].position.dot(t)-n;switch(+!!(c=d>0)+ +!!(h=f>0)+ +!!(u=m>0)){case 0:r.push(e[i]),r.push(e[i+1]),r.push(e[i+2]);break;case 1:if(c&&(a=e[i+1],o=e[i+2],s=A(e[i],a,t,n),l=A(e[i],o,t,n)),h){a=e[i],o=e[i+2],s=A(e[i+1],a,t,n),l=A(e[i+1],o,t,n),r.push(s),r.push(o.clone()),r.push(a.clone()),r.push(o.clone()),r.push(s.clone()),r.push(l);break}u&&(a=e[i],o=e[i+1],s=A(e[i+2],a,t,n),l=A(e[i+2],o,t,n)),r.push(a.clone()),r.push(o.clone()),r.push(s),r.push(l),r.push(s.clone()),r.push(o.clone());break;case 2:c||(o=A(a=e[i].clone(),e[i+1],t,n),s=A(a,e[i+2],t,n),r.push(a),r.push(o),r.push(s)),h||(o=A(a=e[i+1].clone(),e[i+2],t,n),s=A(a,e[i],t,n),r.push(a),r.push(o),r.push(s)),u||(o=A(a=e[i+2].clone(),e[i],t,n),s=A(a,e[i+1],t,n),r.push(a),r.push(o),r.push(s))}}return r}function A(e,t,r,i){let n=e.position.dot(r)-i,a=n/(n-(t.position.dot(r)-i));return new sb(new sw.Vector3(e.position.x+a*(t.position.x-e.position.x),e.position.y+a*(t.position.y-e.position.y),e.position.z+a*(t.position.z-e.position.z)),new sw.Vector3(e.normal.x+a*(t.normal.x-e.normal.x),e.normal.y+a*(t.normal.y-e.normal.y),e.normal.z+a*(t.normal.z-e.normal.z)))}c.copy(l).invert(),function(){let t,r=[],c=new sw.Vector3,A=new sw.Vector3;if(!0===e.geometry.isGeometry)return console.error("THREE.DecalGeometry no longer supports THREE.Geometry. Use BufferGeometry instead.");let d=e.geometry,f=d.attributes.position,m=d.attributes.normal;if(null!==d.index){let e=d.index;for(t=0;t<e.count;t++)c.fromBufferAttribute(f,e.getX(t)),A.fromBufferAttribute(m,e.getX(t)),h(r,c,A)}else for(t=0;t<f.count;t++)c.fromBufferAttribute(f,t),A.fromBufferAttribute(m,t),h(r,c,A);for(t=0,r=u(r,s.set(1,0,0)),r=u(r,s.set(-1,0,0)),r=u(r,s.set(0,1,0)),r=u(r,s.set(0,-1,0)),r=u(r,s.set(0,0,1)),r=u(r,s.set(0,0,-1));t<r.length;t++){let e=r[t];o.push(.5+e.position.x/i.x,.5+e.position.y/i.y),e.position.applyMatrix4(l),n.push(e.position.x,e.position.y,e.position.z),a.push(e.normal.x,e.normal.y,e.normal.z)}}(),this.setAttribute("position",new sw.Float32BufferAttribute(n,3)),this.setAttribute("normal",new sw.Float32BufferAttribute(a,3)),this.setAttribute("uv",new sw.Float32BufferAttribute(o,2))}}class sb{constructor(e,t){this.position=e,this.normal=t}clone(){return new this.constructor(this.position.clone(),this.normal.clone())}}function s_(e=[0,0,0]){return Array.isArray(e)?e:e instanceof tw.Vector3||e instanceof tw.Euler?[e.x,e.y,e.z]:[e,e,e]}let sM=tC.forwardRef(function({debug:e,depthTest:t=!1,polygonOffsetFactor:r=-10,map:i,mesh:n,children:a,position:o,rotation:s,scale:l,...c},h){let u=tC.useRef(null);tC.useImperativeHandle(h,()=>u.current);let A=tC.useRef(null),d=tC.useRef({position:new tw.Vector3,rotation:new tw.Euler,scale:new tw.Vector3(1,1,1)});return tC.useLayoutEffect(()=>{let e=(null==n?void 0:n.current)||u.current.parent,t=u.current;if(!(e instanceof tw.Mesh))throw Error('Decal must have a Mesh as parent or specify its "mesh" prop');if(e){(0,o0.s)(d.current,{position:o,scale:l});let r=e.matrixWorld.clone();if(e.matrixWorld.identity(),s&&"number"!=typeof s)(0,o0.s)(d.current,{rotation:s});else{let t=new tw.Object3D;t.position.copy(d.current.position);let r=e.geometry.attributes.position.array;void 0===e.geometry.attributes.normal&&e.geometry.computeVertexNormals();let i=e.geometry.attributes.normal.array,n=1/0,a=new tw.Vector3,o=t.position.x,l=t.position.y,c=t.position.z,h=r.length,u=-1;for(let e=0;e<h;e+=3){let t=r[e],i=r[e+1],a=r[e+2],s=t-o,h=i-l,A=a-c,d=s*s+h*h+A*A;d<n&&(n=d,u=e)}a.fromArray(i,u),t.lookAt(t.position.clone().add(a)),t.rotateZ(Math.PI),t.rotateY(Math.PI),"number"==typeof s&&t.rotateZ(s),(0,o0.s)(d.current,{rotation:t.rotation})}return A.current&&(0,o0.s)(A.current,d.current),t.geometry=new sI(e,d.current.position,d.current.rotation,d.current.scale),e.matrixWorld=r,()=>{t.geometry.dispose()}}},[n,...s_(o),...s_(l),...s_(s)]),tC.useLayoutEffect(()=>{A.current&&A.current.traverse(e=>e.raycast=()=>null)},[e]),tC.createElement("mesh",e2({ref:u,"material-transparent":!0,"material-polygonOffset":!0,"material-polygonOffsetFactor":r,"material-depthTest":t,"material-map":i},c),a,e&&tC.createElement("mesh",{ref:A},tC.createElement("boxGeometry",null),tC.createElement("meshNormalMaterial",{wireframe:!0}),tC.createElement("axesHelper",null)))});var nX=tI,sS=tw;let sT=(()=>{class e extends sS.Loader{constructor(e){super(e),this.defaultDPI=90,this.defaultUnit="px"}load(e,t,r,i){let n=this,a=new sS.FileLoader(n.manager);a.setPath(n.path),a.setRequestHeader(n.requestHeader),a.setWithCredentials(n.withCredentials),a.load(e,function(r){try{t(n.parse(r))}catch(t){i?i(t):console.error(t),n.manager.itemError(e)}},r,i)}parse(e){let t=this;function r(e,t,r,n,a,o,s,l){if(0==t||0==r)return void e.lineTo(l.x,l.y);n=n*Math.PI/180,t=Math.abs(t),r=Math.abs(r);let c=(s.x-l.x)/2,h=(s.y-l.y)/2,u=Math.cos(n)*c+Math.sin(n)*h,A=-Math.sin(n)*c+Math.cos(n)*h,d=t*t,f=r*r,m=u*u,p=A*A,g=m/d+p/f;if(g>1){let e=Math.sqrt(g);t*=e,r*=e,d=t*t,f=r*r}let v=d*p+f*m,y=Math.sqrt(Math.max(0,(d*f-v)/v));a===o&&(y=-y);let x=y*t*A/r,E=-y*r*u/t,C=Math.cos(n)*x-Math.sin(n)*E+(s.x+l.x)/2,B=Math.sin(n)*x+Math.cos(n)*E+(s.y+l.y)/2,w=i(1,0,(u-x)/t,(A-E)/r),I=i((u-x)/t,(A-E)/r,(-u-x)/t,(-A-E)/r)%(2*Math.PI);e.currentPath.absellipse(C,B,t,r,w,w+I,0===o,n)}function i(e,t,r,i){let n=Math.sqrt(e*e+t*t)*Math.sqrt(r*r+i*i),a=Math.acos(Math.max(-1,Math.min(1,(e*r+t*i)/n)));return e*i-t*r<0&&(a=-a),a}function n(e,t){t=Object.assign({},t);let r={};if(e.hasAttribute("class")){let t=e.getAttribute("class").split(/\s/).filter(Boolean).map(e=>e.trim());for(let e=0;e<t.length;e++)r=Object.assign(r,d["."+t[e]])}function i(i,n,a){void 0===a&&(a=function(e){return e.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),e}),e.hasAttribute(i)&&(t[n]=a(e.getAttribute(i))),r[i]&&(t[n]=a(r[i])),e.style&&""!==e.style[i]&&(t[n]=a(e.style[i]))}function n(e){return Math.max(0,Math.min(1,l(e)))}function a(e){return Math.max(0,l(e))}return e.hasAttribute("id")&&(r=Object.assign(r,d["#"+e.getAttribute("id")])),i("fill","fill"),i("fill-opacity","fillOpacity",n),i("fill-rule","fillRule"),i("opacity","opacity",n),i("stroke","stroke"),i("stroke-opacity","strokeOpacity",n),i("stroke-width","strokeWidth",a),i("stroke-linejoin","strokeLineJoin"),i("stroke-linecap","strokeLineCap"),i("stroke-miterlimit","strokeMiterLimit",a),i("visibility","visibility"),t}function a(e,t,r){let i;if("string"!=typeof e)throw TypeError("Invalid input: "+typeof e);let n=/[ \t\r\n]/,a=/[\d]/,o=/[-+]/,s=/\./,l=/,/,c=/e/i,h=/[01]/,u=0,A=!0,d="",f="",m=[];function p(e,t,r){let i=SyntaxError('Unexpected character "'+e+'" at index '+t+".");throw i.partial=r,i}function g(){""!==d&&(""===f?m.push(Number(d)):m.push(Number(d)*Math.pow(10,Number(f)))),d="",f=""}let v=e.length;for(let y=0;y<v;y++){if(i=e[y],Array.isArray(t)&&t.includes(m.length%r)&&h.test(i)){u=1,d=i,g();continue}if(0===u){if(n.test(i))continue;if(a.test(i)||o.test(i)){u=1,d=i;continue}if(s.test(i)){u=2,d=i;continue}l.test(i)&&(A&&p(i,y,m),A=!0)}if(1===u){if(a.test(i)){d+=i;continue}if(s.test(i)){d+=i,u=2;continue}if(c.test(i)){u=3;continue}o.test(i)&&1===d.length&&o.test(d[0])&&p(i,y,m)}if(2===u){if(a.test(i)){d+=i;continue}if(c.test(i)){u=3;continue}s.test(i)&&"."===d[d.length-1]&&p(i,y,m)}if(3===u){if(a.test(i)){f+=i;continue}if(o.test(i)){if(""===f){f+=i;continue}1===f.length&&o.test(f)&&p(i,y,m)}}n.test(i)?(g(),u=0,A=!1):l.test(i)?(g(),u=0,A=!0):o.test(i)?(g(),u=1,d=i):s.test(i)?(g(),u=2,d=i):p(i,y,m)}return g(),m}let o=["mm","cm","in","pt","pc","px"],s={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function l(e){let r,i="px";if("string"==typeof e||e instanceof String)for(let t=0,r=o.length;t<r;t++){let r=o[t];if(e.endsWith(r)){i=r,e=e.substring(0,e.length-r.length);break}}return"px"===i&&"px"!==t.defaultUnit?r=s.in[t.defaultUnit]/t.defaultDPI:(r=s[i][t.defaultUnit])<0&&(r=s[i].in*t.defaultDPI),r*parseFloat(e)}function c(e){let t=e.elements;return t[0]*t[4]-t[1]*t[3]<0}function h(e){let t=e.elements;return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function u(e){let t=e.elements;return Math.sqrt(t[3]*t[3]+t[4]*t[4])}let A=[],d={},f=[],m=new sS.Matrix3,p=new sS.Matrix3,g=new sS.Matrix3,v=new sS.Matrix3,y=new sS.Vector2,x=new sS.Vector3,E=new sS.Matrix3,C=new DOMParser().parseFromString(e,"image/svg+xml");return!function e(t,i){var o,s,C,B,w,I;if(1!==t.nodeType)return;let b=function(e){if(!(e.hasAttribute("transform")||"use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))))return null;let t=function(e){let t=new sS.Matrix3;if("use"===e.nodeName&&(e.hasAttribute("x")||e.hasAttribute("y"))){let r=l(e.getAttribute("x")),i=l(e.getAttribute("y"));t.translate(r,i)}if(e.hasAttribute("transform")){let r=e.getAttribute("transform").split(")");for(let e=r.length-1;e>=0;e--){let i=r[e].trim();if(""===i)continue;let n=i.indexOf("("),o=i.length;if(n>0&&n<o){let e=i.slice(0,n),t=a(i.slice(n+1));switch(m.identity(),e){case"translate":if(t.length>=1){let e=t[0],r=0;t.length>=2&&(r=t[1]),m.translate(e,r)}break;case"rotate":if(t.length>=1){let e=0,r=0,i=0;e=t[0]*Math.PI/180,t.length>=3&&(r=t[1],i=t[2]),p.makeTranslation(-r,-i),g.makeRotation(e),v.multiplyMatrices(g,p),p.makeTranslation(r,i),m.multiplyMatrices(p,v)}break;case"scale":if(t.length>=1){let e=t[0],r=e;t.length>=2&&(r=t[1]),m.scale(e,r)}break;case"skewX":1===t.length&&m.set(1,Math.tan(t[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":1===t.length&&m.set(1,0,0,Math.tan(t[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":6===t.length&&m.set(t[0],t[2],t[4],t[1],t[3],t[5],0,0,1)}}t.premultiply(m)}}return t}(e);return f.length>0&&t.premultiply(f[f.length-1]),E.copy(t),f.push(t),t}(t),_=!1,M=null;switch(t.nodeName){case"svg":case"g":i=n(t,i);break;case"style":!function(e){if(e.sheet&&e.sheet.cssRules&&e.sheet.cssRules.length)for(let t=0;t<e.sheet.cssRules.length;t++){let r=e.sheet.cssRules[t];if(1!==r.type)continue;let i=r.selectorText.split(/,/gm).filter(Boolean).map(e=>e.trim());for(let e=0;e<i.length;e++){let t=Object.fromEntries(Object.entries(r.style).filter(([,e])=>""!==e));d[i[e]]=Object.assign(d[i[e]]||{},t)}}}(t);break;case"path":i=n(t,i),t.hasAttribute("d")&&(M=function(e){let t=new sS.ShapePath,i=new sS.Vector2,n=new sS.Vector2,o=new sS.Vector2,s=!0,l=!1,c=e.getAttribute("d");if(""===c||"none"===c)return null;let h=c.match(/[a-df-z][^a-df-z]*/gi);for(let e=0,c=h.length;e<c;e++){var u,A,d,f,m,p,g,v;let c,y=h[e],x=y.charAt(0),E=y.slice(1).trim();switch(!0===s&&(l=!0,s=!1),x){case"M":c=a(E);for(let e=0,r=c.length;e<r;e+=2)i.x=c[e+0],i.y=c[e+1],n.x=i.x,n.y=i.y,0===e?t.moveTo(i.x,i.y):t.lineTo(i.x,i.y),0===e&&o.copy(i);break;case"H":c=a(E);for(let e=0,r=c.length;e<r;e++)i.x=c[e],n.x=i.x,n.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===l&&o.copy(i);break;case"V":c=a(E);for(let e=0,r=c.length;e<r;e++)i.y=c[e],n.x=i.x,n.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===l&&o.copy(i);break;case"L":c=a(E);for(let e=0,r=c.length;e<r;e+=2)i.x=c[e+0],i.y=c[e+1],n.x=i.x,n.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===l&&o.copy(i);break;case"C":c=a(E);for(let e=0,r=c.length;e<r;e+=6)t.bezierCurveTo(c[e+0],c[e+1],c[e+2],c[e+3],c[e+4],c[e+5]),n.x=c[e+2],n.y=c[e+3],i.x=c[e+4],i.y=c[e+5],0===e&&!0===l&&o.copy(i);break;case"S":c=a(E);for(let e=0,r=c.length;e<r;e+=4){t.bezierCurveTo((u=i.x,u-(n.x-u)),(A=i.y,A-(n.y-A)),c[e+0],c[e+1],c[e+2],c[e+3]),n.x=c[e+0],n.y=c[e+1],i.x=c[e+2],i.y=c[e+3],0===e&&!0===l&&o.copy(i)}break;case"Q":c=a(E);for(let e=0,r=c.length;e<r;e+=4)t.quadraticCurveTo(c[e+0],c[e+1],c[e+2],c[e+3]),n.x=c[e+0],n.y=c[e+1],i.x=c[e+2],i.y=c[e+3],0===e&&!0===l&&o.copy(i);break;case"T":c=a(E);for(let e=0,r=c.length;e<r;e+=2){let r=(d=i.x,d-(n.x-d)),a=(f=i.y,f-(n.y-f));t.quadraticCurveTo(r,a,c[e+0],c[e+1]),n.x=r,n.y=a,i.x=c[e+0],i.y=c[e+1],0===e&&!0===l&&o.copy(i)}break;case"A":c=a(E,[3,4],7);for(let e=0,a=c.length;e<a;e+=7){if(c[e+5]==i.x&&c[e+6]==i.y)continue;let a=i.clone();i.x=c[e+5],i.y=c[e+6],n.x=i.x,n.y=i.y,r(t,c[e],c[e+1],c[e+2],c[e+3],c[e+4],a,i),0===e&&!0===l&&o.copy(i)}break;case"m":c=a(E);for(let e=0,r=c.length;e<r;e+=2)i.x+=c[e+0],i.y+=c[e+1],n.x=i.x,n.y=i.y,0===e?t.moveTo(i.x,i.y):t.lineTo(i.x,i.y),0===e&&o.copy(i);break;case"h":c=a(E);for(let e=0,r=c.length;e<r;e++)i.x+=c[e],n.x=i.x,n.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===l&&o.copy(i);break;case"v":c=a(E);for(let e=0,r=c.length;e<r;e++)i.y+=c[e],n.x=i.x,n.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===l&&o.copy(i);break;case"l":c=a(E);for(let e=0,r=c.length;e<r;e+=2)i.x+=c[e+0],i.y+=c[e+1],n.x=i.x,n.y=i.y,t.lineTo(i.x,i.y),0===e&&!0===l&&o.copy(i);break;case"c":c=a(E);for(let e=0,r=c.length;e<r;e+=6)t.bezierCurveTo(i.x+c[e+0],i.y+c[e+1],i.x+c[e+2],i.y+c[e+3],i.x+c[e+4],i.y+c[e+5]),n.x=i.x+c[e+2],n.y=i.y+c[e+3],i.x+=c[e+4],i.y+=c[e+5],0===e&&!0===l&&o.copy(i);break;case"s":c=a(E);for(let e=0,r=c.length;e<r;e+=4){t.bezierCurveTo((m=i.x,m-(n.x-m)),(p=i.y,p-(n.y-p)),i.x+c[e+0],i.y+c[e+1],i.x+c[e+2],i.y+c[e+3]),n.x=i.x+c[e+0],n.y=i.y+c[e+1],i.x+=c[e+2],i.y+=c[e+3],0===e&&!0===l&&o.copy(i)}break;case"q":c=a(E);for(let e=0,r=c.length;e<r;e+=4)t.quadraticCurveTo(i.x+c[e+0],i.y+c[e+1],i.x+c[e+2],i.y+c[e+3]),n.x=i.x+c[e+0],n.y=i.y+c[e+1],i.x+=c[e+2],i.y+=c[e+3],0===e&&!0===l&&o.copy(i);break;case"t":c=a(E);for(let e=0,r=c.length;e<r;e+=2){let r=(g=i.x,g-(n.x-g)),a=(v=i.y,v-(n.y-v));t.quadraticCurveTo(r,a,i.x+c[e+0],i.y+c[e+1]),n.x=r,n.y=a,i.x=i.x+c[e+0],i.y=i.y+c[e+1],0===e&&!0===l&&o.copy(i)}break;case"a":c=a(E,[3,4],7);for(let e=0,a=c.length;e<a;e+=7){if(0==c[e+5]&&0==c[e+6])continue;let a=i.clone();i.x+=c[e+5],i.y+=c[e+6],n.x=i.x,n.y=i.y,r(t,c[e],c[e+1],c[e+2],c[e+3],c[e+4],a,i),0===e&&!0===l&&o.copy(i)}break;case"Z":case"z":t.currentPath.autoClose=!0,t.currentPath.curves.length>0&&(i.copy(o),t.currentPath.currentPoint.copy(i),s=!0);break;default:console.warn(y)}l=!1}return t}(t));break;case"rect":let S,T,D,F,R,P,Q;i=n(t,i),S=l((o=t).getAttribute("x")||0),T=l(o.getAttribute("y")||0),D=l(o.getAttribute("rx")||o.getAttribute("ry")||0),F=l(o.getAttribute("ry")||o.getAttribute("rx")||0),R=l(o.getAttribute("width")),P=l(o.getAttribute("height")),(Q=new sS.ShapePath).moveTo(S+D,T),Q.lineTo(S+R-D,T),(0!==D||0!==F)&&Q.bezierCurveTo(S+R-.448084975506*D,T,S+R,T+.448084975506*F,S+R,T+F),Q.lineTo(S+R,T+P-F),(0!==D||0!==F)&&Q.bezierCurveTo(S+R,T+P-.448084975506*F,S+R-.448084975506*D,T+P,S+R-D,T+P),Q.lineTo(S+D,T+P),(0!==D||0!==F)&&Q.bezierCurveTo(S+.448084975506*D,T+P,S,T+P-.448084975506*F,S,T+P-F),Q.lineTo(S,T+F),(0!==D||0!==F)&&Q.bezierCurveTo(S,T+.448084975506*F,S+.448084975506*D,T,S+D,T),M=Q;break;case"polygon":let U,z;i=n(t,i),s=t,U=new sS.ShapePath,z=0,s.getAttribute("points").replace(/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,function(e,t,r){let i=l(t),n=l(r);0===z?U.moveTo(i,n):U.lineTo(i,n),z++}),U.currentPath.autoClose=!0,M=U;break;case"polyline":let k,L;i=n(t,i),C=t,k=new sS.ShapePath,L=0,C.getAttribute("points").replace(/([+-]?\d*\.?\d+(?:e[+-]?\d+)?)(?:,|\s)([+-]?\d*\.?\d+(?:e[+-]?\d+)?)/g,function(e,t,r){let i=l(t),n=l(r);0===L?k.moveTo(i,n):k.lineTo(i,n),L++}),k.currentPath.autoClose=!1,M=k;break;case"circle":let O,G,N,H,V;i=n(t,i),O=l((B=t).getAttribute("cx")||0),G=l(B.getAttribute("cy")||0),N=l(B.getAttribute("r")||0),(H=new sS.Path).absarc(O,G,N,0,2*Math.PI),(V=new sS.ShapePath).subPaths.push(H),M=V;break;case"ellipse":let j,J,Y,W,K,X;i=n(t,i),j=l((w=t).getAttribute("cx")||0),J=l(w.getAttribute("cy")||0),Y=l(w.getAttribute("rx")||0),W=l(w.getAttribute("ry")||0),(K=new sS.Path).absellipse(j,J,Y,W,0,2*Math.PI),(X=new sS.ShapePath).subPaths.push(K),M=X;break;case"line":let q,Z,$,ee,et;i=n(t,i),q=l((I=t).getAttribute("x1")||0),Z=l(I.getAttribute("y1")||0),$=l(I.getAttribute("x2")||0),ee=l(I.getAttribute("y2")||0),(et=new sS.ShapePath).moveTo(q,Z),et.lineTo($,ee),et.currentPath.autoClose=!1,M=et;break;case"defs":_=!0;break;case"use":i=n(t,i);let er=(t.getAttributeNS("http://www.w3.org/1999/xlink","href")||"").substring(1),ei=t.viewportElement.getElementById(er);ei?e(ei,i):console.warn("SVGLoader: 'use node' references non-existent node id: "+er)}M&&(void 0!==i.fill&&"none"!==i.fill&&M.color.setStyle(i.fill,"srgb"),function(e,t){function r(e){x.set(e.x,e.y,1).applyMatrix3(t),e.set(x.x,x.y)}let i=e.subPaths;for(let e=0,n=i.length;e<n;e++){let n=i[e].curves;for(let e=0;e<n.length;e++){let i=n[e];i.isLineCurve?(r(i.v1),r(i.v2)):i.isCubicBezierCurve?(r(i.v0),r(i.v1),r(i.v2),r(i.v3)):i.isQuadraticBezierCurve?(r(i.v0),r(i.v1),r(i.v2)):i.isEllipseCurve&&(y.set(i.aX,i.aY),r(y),i.aX=y.x,i.aY=y.y,function(e){let t=e.elements,r=t[0]*t[3]+t[1]*t[4];return 0!==r&&Math.abs(r/(h(e)*u(e)))>Number.EPSILON}(t)?function(e){let r=e.xRadius,i=e.yRadius,n=Math.cos(e.aRotation),a=Math.sin(e.aRotation),o=new sS.Vector3(r*n,r*a,0),s=new sS.Vector3(-i*a,i*n,0),l=o.applyMatrix3(t),h=s.applyMatrix3(t),u=m.set(l.x,h.x,0,l.y,h.y,0,0,0,1),A=p.copy(u).invert(),d=g.copy(A).transpose().multiply(A).elements,f=function(e,t,r){let i,n,a,o,s,l=e+r,c=e-r,h=Math.sqrt(c*c+4*t*t);return l>0?n=e*(s=1/(i=.5*(l+h)))*r-t*s*t:l<0?n=.5*(l-h):(i=.5*h,n=-.5*h),Math.abs(a=c>0?c+h:c-h)>2*Math.abs(t)?(o=1/Math.sqrt(1+(s=-2*t/a)*s),a=s*o):0===Math.abs(t)?(a=1,o=0):(a=1/Math.sqrt(1+(s=-.5*a/t)*s),o=s*a),c>0&&(s=a,a=-o,o=s),{rt1:i,rt2:n,cs:a,sn:o}}(d[0],d[1],d[4]),v=Math.sqrt(f.rt1),y=Math.sqrt(f.rt2);if(e.xRadius=1/v,e.yRadius=1/y,e.aRotation=Math.atan2(f.sn,f.cs),!((e.aEndAngle-e.aStartAngle)%(2*Math.PI)<Number.EPSILON)){let r=p.set(v,0,0,0,y,0,0,0,1),i=g.set(f.cs,f.sn,0,-f.sn,f.cs,0,0,0,1),n=r.multiply(i).multiply(u),a=e=>{let{x:t,y:r}=new sS.Vector3(Math.cos(e),Math.sin(e),0).applyMatrix3(n);return Math.atan2(r,t)};e.aStartAngle=a(e.aStartAngle),e.aEndAngle=a(e.aEndAngle),c(t)&&(e.aClockwise=!e.aClockwise)}}(i):function(e){let r=h(t),i=u(t);e.xRadius*=r,e.yRadius*=i;let n=r>Number.EPSILON?Math.atan2(t.elements[1],t.elements[0]):Math.atan2(-t.elements[3],t.elements[4]);e.aRotation+=n,c(t)&&(e.aStartAngle*=-1,e.aEndAngle*=-1,e.aClockwise=!e.aClockwise)}(i))}}}(M,E),A.push(M),M.userData={node:t,style:i});let en=t.childNodes;for(let t=0;t<en.length;t++){let r=en[t];_&&"style"!==r.nodeName&&"defs"!==r.nodeName||e(r,i)}b&&(f.pop(),f.length>0?E.copy(f[f.length-1]):E.identity())}(C.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:A,xml:C.documentElement}}static createShapes(e){let t={loc:0,t:0};function r(e,r,i){let n=i.x-r.x,a=i.y-r.y,o=e.x-r.x,s=e.y-r.y,l=n*s-o*a;if(e.x===r.x&&e.y===r.y){t.loc=0,t.t=0;return}if(e.x===i.x&&e.y===i.y){t.loc=1,t.t=1;return}if(l<-Number.EPSILON){t.loc=3;return}if(l>Number.EPSILON){t.loc=4;return}if(n*o<0||a*s<0){t.loc=5;return}if(Math.sqrt(n*n+a*a)<Math.sqrt(o*o+s*s)){t.loc=6;return}t.loc=2,t.t=0!==n?o/n:s/a}let i=0x3b9ac9ff,n=-0x3b9ac9ff,a=e.subPaths.map(e=>{let t=e.getPoints(),r=-0x3b9ac9ff,a=0x3b9ac9ff,o=-0x3b9ac9ff,s=0x3b9ac9ff;for(let e=0;e<t.length;e++){let i=t[e];i.y>r&&(r=i.y),i.y<a&&(a=i.y),i.x>o&&(o=i.x),i.x<s&&(s=i.x)}return n<=o&&(n=o+1),i>=s&&(i=s-1),{curves:e.curves,points:t,isCW:sS.ShapeUtils.isClockWise(t),identifier:-1,boundingBox:new sS.Box2(new sS.Vector2(s,a),new sS.Vector2(o,r))}});a=a.filter(e=>e.points.length>1);for(let e=0;e<a.length;e++)a[e].identifier=e;let o=a.map(o=>(function(e,i,n,a,o){var s,l;let c,h;(null==o||""===o)&&(o="nonzero");let u=new sS.Vector2;e.boundingBox.getCenter(u);let A=(s=[new sS.Vector2(n,u.y),new sS.Vector2(a,u.y)],l=e.boundingBox,c=new sS.Vector2,l.getCenter(c),h=[],i.forEach(e=>{e.boundingBox.containsPoint(c)&&(function(e,i){let n=[],a=[];for(let o=1;o<e.length;o++){let s=e[o-1],l=e[o];for(let e=1;e<i.length;e++){let o=function(e,i,n,a){let o=e.x,s=i.x,l=n.x,c=a.x,h=e.y,u=i.y,A=n.y,d=a.y,f=(c-l)*(h-A)-(d-A)*(o-l),m=(d-A)*(s-o)-(c-l)*(u-h),p=f/m,g=((s-o)*(h-A)-(u-h)*(o-l))/m;if(0===m&&0!==f||p<=0||p>=1||g<0||g>1)return null;if(0===f&&0===m){for(let l=0;l<2;l++){if(r(0===l?n:a,e,i),0==t.loc){let e=0===l?n:a;return{x:e.x,y:e.y,t:t.t}}if(2==t.loc)return{x:+(o+t.t*(s-o)).toPrecision(10),y:+(h+t.t*(u-h)).toPrecision(10),t:t.t}}return null}for(let o=0;o<2;o++)if(r(0===o?n:a,e,i),0==t.loc){let e=0===o?n:a;return{x:e.x,y:e.y,t:t.t}}return{x:+(o+p*(s-o)).toPrecision(10),y:+(h+p*(u-h)).toPrecision(10),t:p}}(s,l,i[e-1],i[e]);null!==o&&void 0===n.find(e=>e.t<=o.t+Number.EPSILON&&e.t>=o.t-Number.EPSILON)&&(n.push(o),a.push(new sS.Vector2(o.x,o.y)))}}return a})(s,e.points).forEach(t=>{h.push({identifier:e.identifier,isCW:e.isCW,point:t})})}),h.sort((e,t)=>e.point.x-t.point.x),h);A.sort((e,t)=>e.point.x-t.point.x);let d=[],f=[];A.forEach(t=>{t.identifier===e.identifier?d.push(t):f.push(t)});let m=d[0].point.x,p=[],g=0;for(;g<f.length&&f[g].point.x<m;)p.length>0&&p[p.length-1]===f[g].identifier?p.pop():p.push(f[g].identifier),g++;if(p.push(e.identifier),"evenodd"===o){let t=p.length%2==0,r=p[p.length-2];return{identifier:e.identifier,isHole:t,for:r}}if("nonzero"===o){let t=!0,r=null,n=null;for(let e=0;e<p.length;e++){let a=p[e];t?(n=i[a].isCW,t=!1,r=a):n!==i[a].isCW&&(n=i[a].isCW,t=!0)}return{identifier:e.identifier,isHole:t,for:r}}console.warn('fill-rule: "'+o+'" is currently not implemented.')})(o,a,i,n,e.userData?e.userData.style.fillRule:void 0)),s=[];return a.forEach(e=>{if(!o[e.identifier].isHole){let t=new sS.Shape;t.curves=e.curves,o.filter(t=>t.isHole&&t.for===e.identifier).forEach(e=>{let r=a[e.identifier],i=new sS.Path;i.curves=r.curves,t.holes.push(i)}),s.push(t)}}),s}static getStrokeStyle(e,t,r,i,n){return{strokeColor:t=void 0!==t?t:"#000",strokeWidth:e=void 0!==e?e:1,strokeLineJoin:r=void 0!==r?r:"miter",strokeLineCap:i=void 0!==i?i:"butt",strokeMiterLimit:n=void 0!==n?n:4}}static pointsToStroke(t,r,i,n){let a=[],o=[],s=[];if(0===e.pointsToStrokeWithBuffers(t,r,i,n,a,o,s))return null;let l=new sS.BufferGeometry;return l.setAttribute("position",new sS.Float32BufferAttribute(a,3)),l.setAttribute("normal",new sS.Float32BufferAttribute(o,3)),l.setAttribute("uv",new sS.Float32BufferAttribute(s,2)),l}static pointsToStrokeWithBuffers(e,t,r,i,n,a,o,s){let l,c,h,u,A,d=new sS.Vector2,f=new sS.Vector2,m=new sS.Vector2,p=new sS.Vector2,g=new sS.Vector2,v=new sS.Vector2,y=new sS.Vector2,x=new sS.Vector2,E=new sS.Vector2,C=new sS.Vector2,B=new sS.Vector2,w=new sS.Vector2,I=new sS.Vector2,b=new sS.Vector2,_=new sS.Vector2,M=new sS.Vector2,S=new sS.Vector2;r=void 0!==r?r:12,i=void 0!==i?i:.001,s=void 0!==s?s:0;let T=(e=function(e){let t=!1;for(let r=1,n=e.length-1;r<n;r++)if(e[r].distanceTo(e[r+1])<i){t=!0;break}if(!t)return e;let r=[];r.push(e[0]);for(let t=1,n=e.length-1;t<n;t++)e[t].distanceTo(e[t+1])>=i&&r.push(e[t]);return r.push(e[e.length-1]),r}(e)).length;if(T<2)return 0;let D=e[0].equals(e[T-1]),F=e[0],R=t.strokeWidth/2,P=1/(T-1),Q=0,U,z=!1,k=0,L=3*s,O=2*s;G(e[0],e[1],d).multiplyScalar(R),x.copy(e[0]).sub(d),E.copy(e[0]).add(d),C.copy(x),B.copy(E);for(let r=1;r<T;r++){if(l=e[r],c=r===T-1?D?e[1]:void 0:e[r+1],G(F,l,d),m.copy(d).multiplyScalar(R),w.copy(l).sub(m),I.copy(l).add(m),U=Q+P,h=!1,void 0!==c){G(l,c,f),m.copy(f).multiplyScalar(R),b.copy(l).sub(m),_.copy(l).add(m),u=!0,m.subVectors(c,F),0>d.dot(m)&&(u=!1),1===r&&(z=u),m.subVectors(c,l),m.normalize();let e=Math.abs(d.dot(m));if(e>Number.EPSILON){let r=R/e;m.multiplyScalar(-r),p.subVectors(l,F),g.copy(p).setLength(r).add(m),M.copy(g).negate();let i=g.length(),n=p.length();p.divideScalar(n),v.subVectors(c,l);let a=v.length();switch(v.divideScalar(a),p.dot(M)<n&&v.dot(M)<a&&(h=!0),S.copy(g).add(l),M.add(l),A=!1,h?u?(_.copy(M),I.copy(M)):(b.copy(M),w.copy(M)):V(),t.strokeLineJoin){case"bevel":j(u,h,U);break;case"round":J(u,h),u?H(l,w,b,U,0):H(l,_,I,U,1);break;default:let o=R*t.strokeMiterLimit/i;o<1?"miter-clip"!==t.strokeLineJoin?j(u,h,U):(J(u,h),u?(v.subVectors(S,w).multiplyScalar(o).add(w),y.subVectors(S,b).multiplyScalar(o).add(b),N(w,U,0),N(v,U,0),N(l,U,.5),N(l,U,.5),N(v,U,0),N(y,U,0),N(l,U,.5),N(y,U,0),N(b,U,0)):(v.subVectors(S,I).multiplyScalar(o).add(I),y.subVectors(S,_).multiplyScalar(o).add(_),N(I,U,1),N(v,U,1),N(l,U,.5),N(l,U,.5),N(v,U,1),N(y,U,1),N(l,U,.5),N(y,U,1),N(_,U,1))):(h?(u?(N(E,Q,1),N(x,Q,0),N(S,U,0),N(E,Q,1),N(S,U,0),N(M,U,1)):(N(E,Q,1),N(x,Q,0),N(S,U,1),N(x,Q,0),N(M,U,0),N(S,U,1)),u?b.copy(S):_.copy(S)):u?(N(w,U,0),N(S,U,0),N(l,U,.5),N(l,U,.5),N(S,U,0),N(b,U,0)):(N(I,U,1),N(S,U,1),N(l,U,.5),N(l,U,.5),N(S,U,1),N(_,U,1)),A=!0)}}else V()}else V();D||r!==T-1||Y(e[0],C,B,u,!0,Q),Q=U,F=l,x.copy(b),E.copy(_)}if(D){if(h&&n){let e=S,t=M;z!==u&&(e=M,t=S),u?(A||z)&&(t.toArray(n,0),t.toArray(n,9),A&&e.toArray(n,3)):(A||!z)&&(t.toArray(n,3),t.toArray(n,9),A&&e.toArray(n,0))}}else Y(l,w,I,u,!1,U);return k;function G(e,t,r){return r.subVectors(t,e),r.set(-r.y,r.x).normalize()}function N(e,t,r){n&&(n[L]=e.x,n[L+1]=e.y,n[L+2]=0,a&&(a[L]=0,a[L+1]=0,a[L+2]=1),L+=3,o&&(o[O]=t,o[O+1]=r,O+=2)),k+=3}function H(e,t,i,n,a){d.copy(t).sub(e).normalize(),f.copy(i).sub(e).normalize();let o=Math.PI,s=d.dot(f);1>Math.abs(s)&&(o=Math.abs(Math.acos(s))),o/=r,m.copy(t);for(let t=0,i=r-1;t<i;t++)p.copy(m).rotateAround(e,o),N(m,n,a),N(p,n,a),N(e,n,.5),m.copy(p);N(p,n,a),N(i,n,a),N(e,n,.5)}function V(){N(E,Q,1),N(x,Q,0),N(w,U,0),N(E,Q,1),N(w,U,0),N(I,U,1)}function j(e,t,r){t?e?(N(E,Q,1),N(x,Q,0),N(w,U,0),N(E,Q,1),N(w,U,0),N(M,U,1),N(w,r,0),N(b,r,0),N(M,r,.5)):(N(E,Q,1),N(x,Q,0),N(I,U,1),N(x,Q,0),N(M,U,0),N(I,U,1),N(I,r,1),N(M,r,0),N(_,r,1)):(e?(N(w,r,0),N(b,r,0)):(N(I,r,1),N(_,r,0)),N(l,r,.5))}function J(e,t){t&&(e?(N(E,Q,1),N(x,Q,0),N(w,U,0),N(E,Q,1),N(w,U,0),N(M,U,1),N(w,Q,0),N(l,U,.5),N(M,U,1),N(l,U,.5),N(b,Q,0),N(M,U,1)):(N(E,Q,1),N(x,Q,0),N(I,U,1),N(x,Q,0),N(M,U,0),N(I,U,1),N(I,Q,1),N(M,U,0),N(l,U,.5),N(l,U,.5),N(M,U,0),N(_,Q,1)))}function Y(e,r,i,a,s,l){switch(t.strokeLineCap){case"round":s?H(e,i,r,l,.5):H(e,r,i,l,.5);break;case"square":if(s)d.subVectors(r,e),f.set(d.y,-d.x),m.addVectors(d,f).add(e),p.subVectors(f,d).add(e),a?(m.toArray(n,3),p.toArray(n,0),p.toArray(n,9)):(m.toArray(n,3),1===o[7]?p.toArray(n,9):m.toArray(n,9),p.toArray(n,0));else{d.subVectors(i,e),f.set(d.y,-d.x),m.addVectors(d,f).add(e),p.subVectors(f,d).add(e);let t=n.length;a?(m.toArray(n,t-3),p.toArray(n,t-6)):(p.toArray(n,t-6),m.toArray(n,t-3)),p.toArray(n,t-12)}}}}}return e})(),sD=(0,tC.forwardRef)(function({src:e,skipFill:t,skipStrokes:r,fillMaterial:i,strokeMaterial:n,fillMeshProps:a,strokeMeshProps:o,...s},l){let c=(0,nX.G)(sT,e.startsWith("<svg")?`data:image/svg+xml;utf8,${e}`:e),h=(0,tC.useMemo)(()=>r?[]:c.paths.map(e=>{var t;return(null==(t=e.userData)?void 0:t.style.stroke)===void 0||"none"===e.userData.style.stroke?null:e.subPaths.map(t=>sT.pointsToStroke(t.getPoints(),e.userData.style))}),[c,r]);(0,tC.useEffect)(()=>()=>h.forEach(e=>e&&e.map(e=>e.dispose())),[h]);let u=0;return tC.createElement("object3D",e2({ref:l},s),tC.createElement("object3D",{scale:[1,-1,1]},c.paths.map((e,s)=>{var l,c;return tC.createElement(tC.Fragment,{key:s},!t&&(null==(l=e.userData)?void 0:l.style.fill)!==void 0&&"none"!==e.userData.style.fill&&sT.createShapes(e).map((t,r)=>tC.createElement("mesh",e2({key:r},a,{renderOrder:u++}),tC.createElement("shapeGeometry",{args:[t]}),tC.createElement("meshBasicMaterial",e2({color:e.userData.style.fill,opacity:e.userData.style.fillOpacity,transparent:!0,side:tw.DoubleSide,depthWrite:!1},i)))),!r&&(null==(c=e.userData)?void 0:c.style.stroke)!==void 0&&"none"!==e.userData.style.stroke&&e.subPaths.map((t,r)=>tC.createElement("mesh",e2({key:r,geometry:h[s][r]},o,{renderOrder:u++}),tC.createElement("meshBasicMaterial",e2({color:e.userData.style.stroke,opacity:e.userData.style.strokeOpacity,transparent:!0,side:tw.DoubleSide,depthWrite:!1},n)))))})))});var sF=tw;function sR(e){if("undefined"!=typeof TextDecoder)return new TextDecoder().decode(e);let t="";for(let r=0,i=e.length;r<i;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch(e){return t}}let sP="srgb",sQ="srgb-linear";class sU extends sF.Loader{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(e){return new sN(e)}),this.register(function(e){return new sH(e)}),this.register(function(e){return new sZ(e)}),this.register(function(e){return new s$(e)}),this.register(function(e){return new s1(e)}),this.register(function(e){return new sj(e)}),this.register(function(e){return new sJ(e)}),this.register(function(e){return new sY(e)}),this.register(function(e){return new sW(e)}),this.register(function(e){return new sG(e)}),this.register(function(e){return new sK(e)}),this.register(function(e){return new sV(e)}),this.register(function(e){return new sq(e)}),this.register(function(e){return new sX(e)}),this.register(function(e){return new sL(e)}),this.register(function(e){return new s0(e)}),this.register(function(e){return new s2(e)})}load(e,t,r,i){let n,a=this;if(""!==this.resourcePath)n=this.resourcePath;else if(""!==this.path){let t=sF.LoaderUtils.extractUrlBase(e);n=sF.LoaderUtils.resolveURL(t,this.path)}else n=sF.LoaderUtils.extractUrlBase(e);this.manager.itemStart(e);let o=function(t){i?i(t):console.error(t),a.manager.itemError(e),a.manager.itemEnd(e)},s=new sF.FileLoader(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,function(r){try{a.parse(r,n,function(r){t(r),a.manager.itemEnd(e)},o)}catch(e){o(e)}},r,o)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return -1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this}unregister(e){return -1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,r,i){let n,a={},o={};if("string"==typeof e)n=JSON.parse(e);else if(e instanceof ArrayBuffer)if(sR(new Uint8Array(e.slice(0,4)))===s3){try{a[sk.KHR_BINARY_GLTF]=new s4(e)}catch(e){i&&i(e);return}n=JSON.parse(a[sk.KHR_BINARY_GLTF].content)}else n=JSON.parse(sR(new Uint8Array(e)));else n=e;if(void 0===n.asset||n.asset.version[0]<2){i&&i(Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}let s=new lf(n,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});s.fileLoader.setRequestHeader(this.requestHeader);for(let e=0;e<this.pluginCallbacks.length;e++){let t=this.pluginCallbacks[e](s);t.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[t.name]=t,a[t.name]=!0}if(n.extensionsUsed)for(let e=0;e<n.extensionsUsed.length;++e){let t=n.extensionsUsed[e],r=n.extensionsRequired||[];switch(t){case sk.KHR_MATERIALS_UNLIT:a[t]=new sO;break;case sk.KHR_DRACO_MESH_COMPRESSION:a[t]=new s5(n,this.dracoLoader);break;case sk.KHR_TEXTURE_TRANSFORM:a[t]=new s6;break;case sk.KHR_MESH_QUANTIZATION:a[t]=new s8;break;default:r.indexOf(t)>=0&&void 0===o[t]&&console.warn('THREE.GLTFLoader: Unknown extension "'+t+'".')}}s.setExtensions(a),s.setPlugins(o),s.parse(r,i)}parseAsync(e,t){let r=this;return new Promise(function(i,n){r.parse(e,t,i,n)})}}function sz(){let e={};return{get:function(t){return e[t]},add:function(t,r){e[t]=r},remove:function(t){delete e[t]},removeAll:function(){e={}}}}let sk={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class sL{constructor(e){this.parser=e,this.name=sk.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){let e=this.parser,t=this.parser.json.nodes||[];for(let r=0,i=t.length;r<i;r++){let i=t[r];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){let t,r=this.parser,i="light:"+e,n=r.cache.get(i);if(n)return n;let a=r.json,o=((a.extensions&&a.extensions[this.name]||{}).lights||[])[e],s=new sF.Color(0xffffff);void 0!==o.color&&s.setRGB(o.color[0],o.color[1],o.color[2],sQ);let l=void 0!==o.range?o.range:0;switch(o.type){case"directional":(t=new sF.DirectionalLight(s)).target.position.set(0,0,-1),t.add(t.target);break;case"point":(t=new sF.PointLight(s)).distance=l;break;case"spot":(t=new sF.SpotLight(s)).distance=l,o.spot=o.spot||{},o.spot.innerConeAngle=void 0!==o.spot.innerConeAngle?o.spot.innerConeAngle:0,o.spot.outerConeAngle=void 0!==o.spot.outerConeAngle?o.spot.outerConeAngle:Math.PI/4,t.angle=o.spot.outerConeAngle,t.penumbra=1-o.spot.innerConeAngle/o.spot.outerConeAngle,t.target.position.set(0,0,-1),t.add(t.target);break;default:throw Error("THREE.GLTFLoader: Unexpected light type: "+o.type)}return t.position.set(0,0,0),t.decay=2,lh(t,o),void 0!==o.intensity&&(t.intensity=o.intensity),t.name=r.createUniqueName(o.name||"light_"+e),n=Promise.resolve(t),r.cache.add(i,n),n}getDependency(e,t){if("light"===e)return this._loadLight(t)}createNodeAttachment(e){let t=this,r=this.parser,i=r.json.nodes[e],n=(i.extensions&&i.extensions[this.name]||{}).light;return void 0===n?null:this._loadLight(n).then(function(e){return r._getNodeRef(t.cache,n,e)})}}class sO{constructor(){this.name=sk.KHR_MATERIALS_UNLIT}getMaterialType(){return sF.MeshBasicMaterial}extendParams(e,t,r){let i=[];e.color=new sF.Color(1,1,1),e.opacity=1;let n=t.pbrMetallicRoughness;if(n){if(Array.isArray(n.baseColorFactor)){let t=n.baseColorFactor;e.color.setRGB(t[0],t[1],t[2],sQ),e.opacity=t[3]}void 0!==n.baseColorTexture&&i.push(r.assignTexture(e,"map",n.baseColorTexture,sP))}return Promise.all(i)}}class sG{constructor(e){this.parser=e,this.name=sk.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){let r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=r.extensions[this.name].emissiveStrength;return void 0!==i&&(t.emissiveIntensity=i),Promise.resolve()}}class sN{constructor(e){this.parser=e,this.name=sk.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?sF.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],a=i.extensions[this.name];if(void 0!==a.clearcoatFactor&&(t.clearcoat=a.clearcoatFactor),void 0!==a.clearcoatTexture&&n.push(r.assignTexture(t,"clearcoatMap",a.clearcoatTexture)),void 0!==a.clearcoatRoughnessFactor&&(t.clearcoatRoughness=a.clearcoatRoughnessFactor),void 0!==a.clearcoatRoughnessTexture&&n.push(r.assignTexture(t,"clearcoatRoughnessMap",a.clearcoatRoughnessTexture)),void 0!==a.clearcoatNormalTexture&&(n.push(r.assignTexture(t,"clearcoatNormalMap",a.clearcoatNormalTexture)),void 0!==a.clearcoatNormalTexture.scale)){let e=a.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new sF.Vector2(e,e)}return Promise.all(n)}}class sH{constructor(e){this.parser=e,this.name=sk.KHR_MATERIALS_DISPERSION}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?sF.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=r.extensions[this.name];return t.dispersion=void 0!==i.dispersion?i.dispersion:0,Promise.resolve()}}class sV{constructor(e){this.parser=e,this.name=sk.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?sF.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],a=i.extensions[this.name];return void 0!==a.iridescenceFactor&&(t.iridescence=a.iridescenceFactor),void 0!==a.iridescenceTexture&&n.push(r.assignTexture(t,"iridescenceMap",a.iridescenceTexture)),void 0!==a.iridescenceIor&&(t.iridescenceIOR=a.iridescenceIor),void 0===t.iridescenceThicknessRange&&(t.iridescenceThicknessRange=[100,400]),void 0!==a.iridescenceThicknessMinimum&&(t.iridescenceThicknessRange[0]=a.iridescenceThicknessMinimum),void 0!==a.iridescenceThicknessMaximum&&(t.iridescenceThicknessRange[1]=a.iridescenceThicknessMaximum),void 0!==a.iridescenceThicknessTexture&&n.push(r.assignTexture(t,"iridescenceThicknessMap",a.iridescenceThicknessTexture)),Promise.all(n)}}class sj{constructor(e){this.parser=e,this.name=sk.KHR_MATERIALS_SHEEN}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?sF.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[];t.sheenColor=new sF.Color(0,0,0),t.sheenRoughness=0,t.sheen=1;let a=i.extensions[this.name];if(void 0!==a.sheenColorFactor){let e=a.sheenColorFactor;t.sheenColor.setRGB(e[0],e[1],e[2],sQ)}return void 0!==a.sheenRoughnessFactor&&(t.sheenRoughness=a.sheenRoughnessFactor),void 0!==a.sheenColorTexture&&n.push(r.assignTexture(t,"sheenColorMap",a.sheenColorTexture,sP)),void 0!==a.sheenRoughnessTexture&&n.push(r.assignTexture(t,"sheenRoughnessMap",a.sheenRoughnessTexture)),Promise.all(n)}}class sJ{constructor(e){this.parser=e,this.name=sk.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?sF.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],a=i.extensions[this.name];return void 0!==a.transmissionFactor&&(t.transmission=a.transmissionFactor),void 0!==a.transmissionTexture&&n.push(r.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(n)}}class sY{constructor(e){this.parser=e,this.name=sk.KHR_MATERIALS_VOLUME}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?sF.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],a=i.extensions[this.name];t.thickness=void 0!==a.thicknessFactor?a.thicknessFactor:0,void 0!==a.thicknessTexture&&n.push(r.assignTexture(t,"thicknessMap",a.thicknessTexture)),t.attenuationDistance=a.attenuationDistance||1/0;let o=a.attenuationColor||[1,1,1];return t.attenuationColor=new sF.Color().setRGB(o[0],o[1],o[2],sQ),Promise.all(n)}}class sW{constructor(e){this.parser=e,this.name=sk.KHR_MATERIALS_IOR}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?sF.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();let i=r.extensions[this.name];return t.ior=void 0!==i.ior?i.ior:1.5,Promise.resolve()}}class sK{constructor(e){this.parser=e,this.name=sk.KHR_MATERIALS_SPECULAR}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?sF.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],a=i.extensions[this.name];t.specularIntensity=void 0!==a.specularFactor?a.specularFactor:1,void 0!==a.specularTexture&&n.push(r.assignTexture(t,"specularIntensityMap",a.specularTexture));let o=a.specularColorFactor||[1,1,1];return t.specularColor=new sF.Color().setRGB(o[0],o[1],o[2],sQ),void 0!==a.specularColorTexture&&n.push(r.assignTexture(t,"specularColorMap",a.specularColorTexture,sP)),Promise.all(n)}}class sX{constructor(e){this.parser=e,this.name=sk.EXT_MATERIALS_BUMP}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?sF.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],a=i.extensions[this.name];return t.bumpScale=void 0!==a.bumpFactor?a.bumpFactor:1,void 0!==a.bumpTexture&&n.push(r.assignTexture(t,"bumpMap",a.bumpTexture)),Promise.all(n)}}class sq{constructor(e){this.parser=e,this.name=sk.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){let t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?sF.MeshPhysicalMaterial:null}extendMaterialParams(e,t){let r=this.parser,i=r.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();let n=[],a=i.extensions[this.name];return void 0!==a.anisotropyStrength&&(t.anisotropy=a.anisotropyStrength),void 0!==a.anisotropyRotation&&(t.anisotropyRotation=a.anisotropyRotation),void 0!==a.anisotropyTexture&&n.push(r.assignTexture(t,"anisotropyMap",a.anisotropyTexture)),Promise.all(n)}}class sZ{constructor(e){this.parser=e,this.name=sk.KHR_TEXTURE_BASISU}loadTexture(e){let t=this.parser,r=t.json,i=r.textures[e];if(!i.extensions||!i.extensions[this.name])return null;let n=i.extensions[this.name],a=t.options.ktx2Loader;if(!a)if(!(r.extensionsRequired&&r.extensionsRequired.indexOf(this.name)>=0))return null;else throw Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return t.loadTextureImage(e,n.source,a)}}class s${constructor(e){this.parser=e,this.name=sk.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){let t=this.name,r=this.parser,i=r.json,n=i.textures[e];if(!n.extensions||!n.extensions[t])return null;let a=n.extensions[t],o=i.images[a.source],s=r.textureLoader;if(o.uri){let e=r.options.manager.getHandler(o.uri);null!==e&&(s=e)}return this.detectSupport().then(function(n){if(n)return r.loadTextureImage(e,a.source,s);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class s1{constructor(e){this.parser=e,this.name=sk.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(e){let t=this.name,r=this.parser,i=r.json,n=i.textures[e];if(!n.extensions||!n.extensions[t])return null;let a=n.extensions[t],o=i.images[a.source],s=r.textureLoader;if(o.uri){let e=r.options.manager.getHandler(o.uri);null!==e&&(s=e)}return this.detectSupport().then(function(n){if(n)return r.loadTextureImage(e,a.source,s);if(i.extensionsRequired&&i.extensionsRequired.indexOf(t)>=0)throw Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return r.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){let t=new Image;t.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",t.onload=t.onerror=function(){e(1===t.height)}})),this.isSupported}}class s0{constructor(e){this.name=sk.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){let t=this.parser.json,r=t.bufferViews[e];if(!r.extensions||!r.extensions[this.name])return null;{let e=r.extensions[this.name],i=this.parser.getDependency("buffer",e.buffer),n=this.parser.options.meshoptDecoder;if(!n||!n.supported)if(!(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0))return null;else throw Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return i.then(function(t){let r=e.byteOffset||0,i=e.byteLength||0,a=e.count,o=e.byteStride,s=new Uint8Array(t,r,i);return n.decodeGltfBufferAsync?n.decodeGltfBufferAsync(a,o,s,e.mode,e.filter).then(function(e){return e.buffer}):n.ready.then(function(){let t=new ArrayBuffer(a*o);return n.decodeGltfBuffer(new Uint8Array(t),a,o,s,e.mode,e.filter),t})})}}}class s2{constructor(e){this.name=sk.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){let t=this.parser.json,r=t.nodes[e];if(!r.extensions||!r.extensions[this.name]||void 0===r.mesh)return null;for(let e of t.meshes[r.mesh].primitives)if(e.mode!==lt.TRIANGLES&&e.mode!==lt.TRIANGLE_STRIP&&e.mode!==lt.TRIANGLE_FAN&&void 0!==e.mode)return null;let i=r.extensions[this.name].attributes,n=[],a={};for(let e in i)n.push(this.parser.getDependency("accessor",i[e]).then(t=>(a[e]=t,a[e])));return n.length<1?null:(n.push(this.parser.createNodeMesh(e)),Promise.all(n).then(e=>{let t=e.pop(),r=t.isGroup?t.children:[t],i=e[0].count,n=[];for(let e of r){let t=new sF.Matrix4,r=new sF.Vector3,o=new sF.Quaternion,s=new sF.Vector3(1,1,1),l=new sF.InstancedMesh(e.geometry,e.material,i);for(let e=0;e<i;e++)a.TRANSLATION&&r.fromBufferAttribute(a.TRANSLATION,e),a.ROTATION&&o.fromBufferAttribute(a.ROTATION,e),a.SCALE&&s.fromBufferAttribute(a.SCALE,e),l.setMatrixAt(e,t.compose(r,o,s));for(let t in a)if("_COLOR_0"===t){let e=a[t];l.instanceColor=new sF.InstancedBufferAttribute(e.array,e.itemSize,e.normalized)}else"TRANSLATION"!==t&&"ROTATION"!==t&&"SCALE"!==t&&e.geometry.setAttribute(t,a[t]);sF.Object3D.prototype.copy.call(l,e),this.parser.assignFinalMaterial(l),n.push(l)}return t.isGroup?(t.clear(),t.add(...n),t):n[0]}))}}let s3="glTF";class s4{constructor(e){this.name=sk.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,12);if(this.header={magic:sR(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==s3)throw Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw Error("THREE.GLTFLoader: Legacy binary file detected.");const r=this.header.length-12,i=new DataView(e,12);let n=0;for(;n<r;){const t=i.getUint32(n,!0);n+=4;const r=i.getUint32(n,!0);if(n+=4,0x4e4f534a===r){const r=new Uint8Array(e,12+n,t);this.content=sR(r)}else if(5130562===r){const r=12+n;this.body=e.slice(r,r+t)}n+=t}if(null===this.content)throw Error("THREE.GLTFLoader: JSON content not found.")}}class s5{constructor(e,t){if(!t)throw Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=sk.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){let r=this.json,i=this.dracoLoader,n=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},s={},l={};for(let e in a)o[lo[e]||e.toLowerCase()]=a[e];for(let t in e.attributes){let i=lo[t]||t.toLowerCase();if(void 0!==a[t]){let n=r.accessors[e.attributes[t]],a=lr[n.componentType];l[i]=a.name,s[i]=!0===n.normalized}}return t.getDependency("bufferView",n).then(function(e){return new Promise(function(t,r){i.decodeDracoFile(e,function(e){for(let t in e.attributes){let r=e.attributes[t],i=s[t];void 0!==i&&(r.normalized=i)}t(e)},o,l,sQ,r)})})}}class s6{constructor(){this.name=sk.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(void 0===t.texCoord||t.texCoord===e.channel)&&void 0===t.offset&&void 0===t.rotation&&void 0===t.scale||(e=e.clone(),void 0!==t.texCoord&&(e.channel=t.texCoord),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class s8{constructor(){this.name=sk.KHR_MESH_QUANTIZATION}}class s9 extends sF.Interpolant{constructor(e,t,r,i){super(e,t,r,i)}copySampleValue_(e){let t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,n=e*i*3+i;for(let e=0;e!==i;e++)t[e]=r[n+e];return t}interpolate_(e,t,r,i){let n=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=2*o,l=3*o,c=i-t,h=(r-t)/c,u=h*h,A=u*h,d=e*l,f=d-l,m=-2*A+3*u,p=A-u,g=1-m,v=p-u+h;for(let e=0;e!==o;e++){let t=a[f+e+o],r=a[f+e+s]*c,i=a[d+e+o],l=a[d+e]*c;n[e]=g*t+v*r+m*i+p*l}return n}}let s7=new sF.Quaternion;class le extends s9{interpolate_(e,t,r,i){let n=super.interpolate_(e,t,r,i);return s7.fromArray(n).normalize().toArray(n),n}}let lt={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},lr={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},li={9728:sF.NearestFilter,9729:sF.LinearFilter,9984:sF.NearestMipmapNearestFilter,9985:sF.LinearMipmapNearestFilter,9986:sF.NearestMipmapLinearFilter,9987:sF.LinearMipmapLinearFilter},ln={33071:sF.ClampToEdgeWrapping,33648:sF.MirroredRepeatWrapping,10497:sF.RepeatWrapping},la={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},lo={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",...nI>=152?{TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3"}:{TEXCOORD_0:"uv",TEXCOORD_1:"uv2"},COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},ls={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},ll={CUBICSPLINE:void 0,LINEAR:sF.InterpolateLinear,STEP:sF.InterpolateDiscrete};function lc(e,t,r){for(let i in r.extensions)void 0===e[i]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[i]=r.extensions[i])}function lh(e,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function lu(e){let t="",r=Object.keys(e).sort();for(let i=0,n=r.length;i<n;i++)t+=r[i]+":"+e[r[i]]+";";return t}function lA(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}let ld=new sF.Matrix4;class lf{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new sz,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let r=!1,i=!1,n=-1;"undefined"!=typeof navigator&&void 0!==navigator.userAgent&&(r=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),n=(i=navigator.userAgent.indexOf("Firefox")>-1)?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||r||i&&n<98?this.textureLoader=new sF.TextureLoader(this.options.manager):this.textureLoader=new sF.ImageBitmapLoader(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new sF.FileLoader(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){let r=this,i=this.json,n=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(e){return e._markDefs&&e._markDefs()}),Promise.all(this._invokeAll(function(e){return e.beforeRoot&&e.beforeRoot()})).then(function(){return Promise.all([r.getDependencies("scene"),r.getDependencies("animation"),r.getDependencies("camera")])}).then(function(t){let a={scene:t[0][i.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:i.asset,parser:r,userData:{}};return lc(n,a,i),lh(a,i),Promise.all(r._invokeAll(function(e){return e.afterRoot&&e.afterRoot(a)})).then(function(){for(let e of a.scenes)e.updateMatrixWorld();e(a)})}).catch(t)}_markDefs(){let e=this.json.nodes||[],t=this.json.skins||[],r=this.json.meshes||[];for(let r=0,i=t.length;r<i;r++){let i=t[r].joints;for(let t=0,r=i.length;t<r;t++)e[i[t]].isBone=!0}for(let t=0,i=e.length;t<i;t++){let i=e[t];void 0!==i.mesh&&(this._addNodeRef(this.meshCache,i.mesh),void 0!==i.skin&&(r[i.mesh].isSkinnedMesh=!0)),void 0!==i.camera&&this._addNodeRef(this.cameraCache,i.camera)}}_addNodeRef(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,r){if(e.refs[t]<=1)return r;let i=r.clone(),n=(e,t)=>{let r=this.associations.get(e);for(let[i,a]of(null!=r&&this.associations.set(t,r),e.children.entries()))n(a,t.children[i])};return n(r,i),i.name+="_instance_"+e.uses[t]++,i}_invokeOne(e){let t=Object.values(this.plugins);t.push(this);for(let r=0;r<t.length;r++){let i=e(t[r]);if(i)return i}return null}_invokeAll(e){let t=Object.values(this.plugins);t.unshift(this);let r=[];for(let i=0;i<t.length;i++){let n=e(t[i]);n&&r.push(n)}return r}getDependency(e,t){let r=e+":"+t,i=this.cache.get(r);if(!i){switch(e){case"scene":i=this.loadScene(t);break;case"node":i=this._invokeOne(function(e){return e.loadNode&&e.loadNode(t)});break;case"mesh":i=this._invokeOne(function(e){return e.loadMesh&&e.loadMesh(t)});break;case"accessor":i=this.loadAccessor(t);break;case"bufferView":i=this._invokeOne(function(e){return e.loadBufferView&&e.loadBufferView(t)});break;case"buffer":i=this.loadBuffer(t);break;case"material":i=this._invokeOne(function(e){return e.loadMaterial&&e.loadMaterial(t)});break;case"texture":i=this._invokeOne(function(e){return e.loadTexture&&e.loadTexture(t)});break;case"skin":i=this.loadSkin(t);break;case"animation":i=this._invokeOne(function(e){return e.loadAnimation&&e.loadAnimation(t)});break;case"camera":i=this.loadCamera(t);break;default:if(!(i=this._invokeOne(function(r){return r!=this&&r.getDependency&&r.getDependency(e,t)})))throw Error("Unknown type: "+e)}this.cache.add(r,i)}return i}getDependencies(e){let t=this.cache.get(e);if(!t){let r=this;t=Promise.all((this.json[e+("mesh"===e?"es":"s")]||[]).map(function(t,i){return r.getDependency(e,i)})),this.cache.add(e,t)}return t}loadBuffer(e){let t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[sk.KHR_BINARY_GLTF].body);let i=this.options;return new Promise(function(e,n){r.load(sF.LoaderUtils.resolveURL(t.uri,i.path),e,void 0,function(){n(Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){let t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(e){let r=t.byteLength||0,i=t.byteOffset||0;return e.slice(i,i+r)})}loadAccessor(e){let t=this,r=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse){let e=la[i.type],t=lr[i.componentType],r=!0===i.normalized,n=new t(i.count*e);return Promise.resolve(new sF.BufferAttribute(n,e,r))}let n=[];return void 0!==i.bufferView?n.push(this.getDependency("bufferView",i.bufferView)):n.push(null),void 0!==i.sparse&&(n.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),n.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(n).then(function(e){let n,a,o=e[0],s=la[i.type],l=lr[i.componentType],c=l.BYTES_PER_ELEMENT,h=c*s,u=i.byteOffset||0,A=void 0!==i.bufferView?r.bufferViews[i.bufferView].byteStride:void 0,d=!0===i.normalized;if(A&&A!==h){let e=Math.floor(u/A),r="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+e+":"+i.count,h=t.cache.get(r);h||(n=new l(o,e*A,i.count*A/c),h=new sF.InterleavedBuffer(n,A/c),t.cache.add(r,h)),a=new sF.InterleavedBufferAttribute(h,s,u%A/c,d)}else n=null===o?new l(i.count*s):new l(o,u,i.count*s),a=new sF.BufferAttribute(n,s,d);if(void 0!==i.sparse){let t=la.SCALAR,r=lr[i.sparse.indices.componentType],n=i.sparse.indices.byteOffset||0,c=i.sparse.values.byteOffset||0,h=new r(e[1],n,i.sparse.count*t),u=new l(e[2],c,i.sparse.count*s);null!==o&&(a=new sF.BufferAttribute(a.array.slice(),a.itemSize,a.normalized));for(let e=0,t=h.length;e<t;e++){let t=h[e];if(a.setX(t,u[e*s]),s>=2&&a.setY(t,u[e*s+1]),s>=3&&a.setZ(t,u[e*s+2]),s>=4&&a.setW(t,u[e*s+3]),s>=5)throw Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return a})}loadTexture(e){let t=this.json,r=this.options,i=t.textures[e].source,n=t.images[i],a=this.textureLoader;if(n.uri){let e=r.manager.getHandler(n.uri);null!==e&&(a=e)}return this.loadTextureImage(e,i,a)}loadTextureImage(e,t,r){let i=this,n=this.json,a=n.textures[e],o=n.images[t],s=(o.uri||o.bufferView)+":"+a.sampler;if(this.textureCache[s])return this.textureCache[s];let l=this.loadImageSource(t,r).then(function(t){t.flipY=!1,t.name=a.name||o.name||"",""===t.name&&"string"==typeof o.uri&&!1===o.uri.startsWith("data:image/")&&(t.name=o.uri);let r=(n.samplers||{})[a.sampler]||{};return t.magFilter=li[r.magFilter]||sF.LinearFilter,t.minFilter=li[r.minFilter]||sF.LinearMipmapLinearFilter,t.wrapS=ln[r.wrapS]||sF.RepeatWrapping,t.wrapT=ln[r.wrapT]||sF.RepeatWrapping,i.associations.set(t,{textures:e}),t}).catch(function(){return null});return this.textureCache[s]=l,l}loadImageSource(e,t){let r=this.json,i=this.options;if(void 0!==this.sourceCache[e])return this.sourceCache[e].then(e=>e.clone());let n=r.images[e],a=self.URL||self.webkitURL,o=n.uri||"",s=!1;if(void 0!==n.bufferView)o=this.getDependency("bufferView",n.bufferView).then(function(e){s=!0;let t=new Blob([e],{type:n.mimeType});return o=a.createObjectURL(t)});else if(void 0===n.uri)throw Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");let l=Promise.resolve(o).then(function(e){return new Promise(function(r,n){let a=r;!0===t.isImageBitmapLoader&&(a=function(e){let t=new sF.Texture(e);t.needsUpdate=!0,r(t)}),t.load(sF.LoaderUtils.resolveURL(e,i.path),a,void 0,n)})}).then(function(e){var t;return!0===s&&a.revokeObjectURL(o),lh(e,n),e.userData.mimeType=n.mimeType||((t=n.uri).search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/)?"image/jpeg":t.search(/\.webp($|\?)/i)>0||0===t.search(/^data\:image\/webp/)?"image/webp":"image/png"),e}).catch(function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",o),e});return this.sourceCache[e]=l,l}assignTexture(e,t,r,i){let n=this;return this.getDependency("texture",r.index).then(function(a){if(!a)return null;if(void 0!==r.texCoord&&r.texCoord>0&&((a=a.clone()).channel=r.texCoord),n.extensions[sk.KHR_TEXTURE_TRANSFORM]){let e=void 0!==r.extensions?r.extensions[sk.KHR_TEXTURE_TRANSFORM]:void 0;if(e){let t=n.associations.get(a);a=n.extensions[sk.KHR_TEXTURE_TRANSFORM].extendTexture(a,e),n.associations.set(a,t)}}return void 0!==i&&("number"==typeof i&&(i=3001===i?sP:sQ),"colorSpace"in a?a.colorSpace=i:a.encoding=i===sP?3001:3e3),e[t]=a,a})}assignFinalMaterial(e){let t=e.geometry,r=e.material,i=void 0===t.attributes.tangent,n=void 0!==t.attributes.color,a=void 0===t.attributes.normal;if(e.isPoints){let e="PointsMaterial:"+r.uuid,t=this.cache.get(e);t||(t=new sF.PointsMaterial,sF.Material.prototype.copy.call(t,r),t.color.copy(r.color),t.map=r.map,t.sizeAttenuation=!1,this.cache.add(e,t)),r=t}else if(e.isLine){let e="LineBasicMaterial:"+r.uuid,t=this.cache.get(e);t||(t=new sF.LineBasicMaterial,sF.Material.prototype.copy.call(t,r),t.color.copy(r.color),t.map=r.map,this.cache.add(e,t)),r=t}if(i||n||a){let e="ClonedMaterial:"+r.uuid+":";i&&(e+="derivative-tangents:"),n&&(e+="vertex-colors:"),a&&(e+="flat-shading:");let t=this.cache.get(e);t||(t=r.clone(),n&&(t.vertexColors=!0),a&&(t.flatShading=!0),i&&(t.normalScale&&(t.normalScale.y*=-1),t.clearcoatNormalScale&&(t.clearcoatNormalScale.y*=-1)),this.cache.add(e,t),this.associations.set(t,this.associations.get(r))),r=t}e.material=r}getMaterialType(){return sF.MeshStandardMaterial}loadMaterial(e){let t,r=this,i=this.json,n=this.extensions,a=i.materials[e],o={},s=a.extensions||{},l=[];if(s[sk.KHR_MATERIALS_UNLIT]){let e=n[sk.KHR_MATERIALS_UNLIT];t=e.getMaterialType(),l.push(e.extendParams(o,a,r))}else{let i=a.pbrMetallicRoughness||{};if(o.color=new sF.Color(1,1,1),o.opacity=1,Array.isArray(i.baseColorFactor)){let e=i.baseColorFactor;o.color.setRGB(e[0],e[1],e[2],sQ),o.opacity=e[3]}void 0!==i.baseColorTexture&&l.push(r.assignTexture(o,"map",i.baseColorTexture,sP)),o.metalness=void 0!==i.metallicFactor?i.metallicFactor:1,o.roughness=void 0!==i.roughnessFactor?i.roughnessFactor:1,void 0!==i.metallicRoughnessTexture&&(l.push(r.assignTexture(o,"metalnessMap",i.metallicRoughnessTexture)),l.push(r.assignTexture(o,"roughnessMap",i.metallicRoughnessTexture))),t=this._invokeOne(function(t){return t.getMaterialType&&t.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,o)})))}!0===a.doubleSided&&(o.side=sF.DoubleSide);let c=a.alphaMode||"OPAQUE";if("BLEND"===c?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,"MASK"===c&&(o.alphaTest=void 0!==a.alphaCutoff?a.alphaCutoff:.5)),void 0!==a.normalTexture&&t!==sF.MeshBasicMaterial&&(l.push(r.assignTexture(o,"normalMap",a.normalTexture)),o.normalScale=new sF.Vector2(1,1),void 0!==a.normalTexture.scale)){let e=a.normalTexture.scale;o.normalScale.set(e,e)}if(void 0!==a.occlusionTexture&&t!==sF.MeshBasicMaterial&&(l.push(r.assignTexture(o,"aoMap",a.occlusionTexture)),void 0!==a.occlusionTexture.strength&&(o.aoMapIntensity=a.occlusionTexture.strength)),void 0!==a.emissiveFactor&&t!==sF.MeshBasicMaterial){let e=a.emissiveFactor;o.emissive=new sF.Color().setRGB(e[0],e[1],e[2],sQ)}return void 0!==a.emissiveTexture&&t!==sF.MeshBasicMaterial&&l.push(r.assignTexture(o,"emissiveMap",a.emissiveTexture,sP)),Promise.all(l).then(function(){let i=new t(o);return a.name&&(i.name=a.name),lh(i,a),r.associations.set(i,{materials:e}),a.extensions&&lc(n,i,a),i})}createUniqueName(e){let t=sF.PropertyBinding.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){let t=this,r=this.extensions,i=this.primitiveCache,n=[];for(let a=0,o=e.length;a<o;a++){let o=e[a],s=function(e){let t,r=e.extensions&&e.extensions[sk.KHR_DRACO_MESH_COMPRESSION];if(t=r?"draco:"+r.bufferView+":"+r.indices+":"+lu(r.attributes):e.indices+":"+lu(e.attributes)+":"+e.mode,void 0!==e.targets)for(let r=0,i=e.targets.length;r<i;r++)t+=":"+lu(e.targets[r]);return t}(o),l=i[s];if(l)n.push(l.promise);else{let e;e=o.extensions&&o.extensions[sk.KHR_DRACO_MESH_COMPRESSION]?function(e){return r[sk.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then(function(r){return lm(r,e,t)})}(o):lm(new sF.BufferGeometry,o,t),i[s]={primitive:o,promise:e},n.push(e)}}return Promise.all(n)}loadMesh(e){let t=this,r=this.json,i=this.extensions,n=r.meshes[e],a=n.primitives,o=[];for(let e=0,t=a.length;e<t;e++){var s;let t=void 0===a[e].material?(void 0===(s=this.cache).DefaultMaterial&&(s.DefaultMaterial=new sF.MeshStandardMaterial({color:0xffffff,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:sF.FrontSide})),s.DefaultMaterial):this.getDependency("material",a[e].material);o.push(t)}return o.push(t.loadGeometries(a)),Promise.all(o).then(function(r){let o=r.slice(0,r.length-1),s=r[r.length-1],l=[];for(let r=0,c=s.length;r<c;r++){let c,h=s[r],u=a[r],A=o[r];if(u.mode===lt.TRIANGLES||u.mode===lt.TRIANGLE_STRIP||u.mode===lt.TRIANGLE_FAN||void 0===u.mode)!0===(c=!0===n.isSkinnedMesh?new sF.SkinnedMesh(h,A):new sF.Mesh(h,A)).isSkinnedMesh&&c.normalizeSkinWeights(),u.mode===lt.TRIANGLE_STRIP?c.geometry=os(c.geometry,sF.TriangleStripDrawMode):u.mode===lt.TRIANGLE_FAN&&(c.geometry=os(c.geometry,sF.TriangleFanDrawMode));else if(u.mode===lt.LINES)c=new sF.LineSegments(h,A);else if(u.mode===lt.LINE_STRIP)c=new sF.Line(h,A);else if(u.mode===lt.LINE_LOOP)c=new sF.LineLoop(h,A);else if(u.mode===lt.POINTS)c=new sF.Points(h,A);else throw Error("THREE.GLTFLoader: Primitive mode unsupported: "+u.mode);Object.keys(c.geometry.morphAttributes).length>0&&function(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(let r=0,i=t.weights.length;r<i;r++)e.morphTargetInfluences[r]=t.weights[r];if(t.extras&&Array.isArray(t.extras.targetNames)){let r=t.extras.targetNames;if(e.morphTargetInfluences.length===r.length){e.morphTargetDictionary={};for(let t=0,i=r.length;t<i;t++)e.morphTargetDictionary[r[t]]=t}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}(c,n),c.name=t.createUniqueName(n.name||"mesh_"+e),lh(c,n),u.extensions&&lc(i,c,u),t.assignFinalMaterial(c),l.push(c)}for(let r=0,i=l.length;r<i;r++)t.associations.set(l[r],{meshes:e,primitives:r});if(1===l.length)return n.extensions&&lc(i,l[0],n),l[0];let c=new sF.Group;n.extensions&&lc(i,c,n),t.associations.set(c,{meshes:e});for(let e=0,t=l.length;e<t;e++)c.add(l[e]);return c})}loadCamera(e){let t,r=this.json.cameras[e],i=r[r.type];return i?("perspective"===r.type?t=new sF.PerspectiveCamera(sF.MathUtils.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===r.type&&(t=new sF.OrthographicCamera(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),r.name&&(t.name=this.createUniqueName(r.name)),lh(t,r),Promise.resolve(t)):void console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(e){let t=this.json.skins[e],r=[];for(let e=0,i=t.joints.length;e<i;e++)r.push(this._loadNodeShallow(t.joints[e]));return void 0!==t.inverseBindMatrices?r.push(this.getDependency("accessor",t.inverseBindMatrices)):r.push(null),Promise.all(r).then(function(e){let r=e.pop(),i=[],n=[];for(let a=0,o=e.length;a<o;a++){let o=e[a];if(o){i.push(o);let e=new sF.Matrix4;null!==r&&e.fromArray(r.array,16*a),n.push(e)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[a])}return new sF.Skeleton(i,n)})}loadAnimation(e){let t=this.json,r=this,i=t.animations[e],n=i.name?i.name:"animation_"+e,a=[],o=[],s=[],l=[],c=[];for(let e=0,t=i.channels.length;e<t;e++){let t=i.channels[e],r=i.samplers[t.sampler],n=t.target,h=n.node,u=void 0!==i.parameters?i.parameters[r.input]:r.input,A=void 0!==i.parameters?i.parameters[r.output]:r.output;void 0!==n.node&&(a.push(this.getDependency("node",h)),o.push(this.getDependency("accessor",u)),s.push(this.getDependency("accessor",A)),l.push(r),c.push(n))}return Promise.all([Promise.all(a),Promise.all(o),Promise.all(s),Promise.all(l),Promise.all(c)]).then(function(e){let t=e[0],i=e[1],a=e[2],o=e[3],s=e[4],l=[];for(let e=0,n=t.length;e<n;e++){let n=t[e],c=i[e],h=a[e],u=o[e],A=s[e];if(void 0===n)continue;n.updateMatrix&&n.updateMatrix();let d=r._createAnimationTracks(n,c,h,u,A);if(d)for(let e=0;e<d.length;e++)l.push(d[e])}return new sF.AnimationClip(n,void 0,l)})}createNodeMesh(e){let t=this.json,r=this,i=t.nodes[e];return void 0===i.mesh?null:r.getDependency("mesh",i.mesh).then(function(e){let t=r._getNodeRef(r.meshCache,i.mesh,e);return void 0!==i.weights&&t.traverse(function(e){if(e.isMesh)for(let t=0,r=i.weights.length;t<r;t++)e.morphTargetInfluences[t]=i.weights[t]}),t})}loadNode(e){let t=this.json.nodes[e],r=this._loadNodeShallow(e),i=[],n=t.children||[];for(let e=0,t=n.length;e<t;e++)i.push(this.getDependency("node",n[e]));let a=void 0===t.skin?Promise.resolve(null):this.getDependency("skin",t.skin);return Promise.all([r,Promise.all(i),a]).then(function(e){let t=e[0],r=e[1],i=e[2];null!==i&&t.traverse(function(e){e.isSkinnedMesh&&e.bind(i,ld)});for(let e=0,i=r.length;e<i;e++)t.add(r[e]);return t})}_loadNodeShallow(e){let t=this.json,r=this.extensions,i=this;if(void 0!==this.nodeCache[e])return this.nodeCache[e];let n=t.nodes[e],a=n.name?i.createUniqueName(n.name):"",o=[],s=i._invokeOne(function(t){return t.createNodeMesh&&t.createNodeMesh(e)});return s&&o.push(s),void 0!==n.camera&&o.push(i.getDependency("camera",n.camera).then(function(e){return i._getNodeRef(i.cameraCache,n.camera,e)})),i._invokeAll(function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)}).forEach(function(e){o.push(e)}),this.nodeCache[e]=Promise.all(o).then(function(t){let o;if((o=!0===n.isBone?new sF.Bone:t.length>1?new sF.Group:1===t.length?t[0]:new sF.Object3D)!==t[0])for(let e=0,r=t.length;e<r;e++)o.add(t[e]);if(n.name&&(o.userData.name=n.name,o.name=a),lh(o,n),n.extensions&&lc(r,o,n),void 0!==n.matrix){let e=new sF.Matrix4;e.fromArray(n.matrix),o.applyMatrix4(e)}else void 0!==n.translation&&o.position.fromArray(n.translation),void 0!==n.rotation&&o.quaternion.fromArray(n.rotation),void 0!==n.scale&&o.scale.fromArray(n.scale);return i.associations.has(o)||i.associations.set(o,{}),i.associations.get(o).nodes=e,o}),this.nodeCache[e]}loadScene(e){let t=this.extensions,r=this.json.scenes[e],i=this,n=new sF.Group;r.name&&(n.name=i.createUniqueName(r.name)),lh(n,r),r.extensions&&lc(t,n,r);let a=r.nodes||[],o=[];for(let e=0,t=a.length;e<t;e++)o.push(i.getDependency("node",a[e]));return Promise.all(o).then(function(e){for(let t=0,r=e.length;t<r;t++)n.add(e[t]);return i.associations=(e=>{let t=new Map;for(let[e,r]of i.associations)(e instanceof sF.Material||e instanceof sF.Texture)&&t.set(e,r);return e.traverse(e=>{let r=i.associations.get(e);null!=r&&t.set(e,r)}),t})(n),n})}_createAnimationTracks(e,t,r,i,n){let a,o=[],s=e.name?e.name:e.uuid,l=[];switch(ls[n.path]===ls.weights?e.traverse(function(e){e.morphTargetInfluences&&l.push(e.name?e.name:e.uuid)}):l.push(s),ls[n.path]){case ls.weights:a=sF.NumberKeyframeTrack;break;case ls.rotation:a=sF.QuaternionKeyframeTrack;break;case ls.position:case ls.scale:a=sF.VectorKeyframeTrack;break;default:a=1===r.itemSize?sF.NumberKeyframeTrack:sF.VectorKeyframeTrack}let c=void 0!==i.interpolation?ll[i.interpolation]:sF.InterpolateLinear,h=this._getArrayFromAccessor(r);for(let e=0,r=l.length;e<r;e++){let r=new a(l[e]+"."+ls[n.path],t.array,h,c);"CUBICSPLINE"===i.interpolation&&this._createCubicSplineTrackInterpolant(r),o.push(r)}return o}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){let e=lA(t.constructor),r=new Float32Array(t.length);for(let i=0,n=t.length;i<n;i++)r[i]=t[i]*e;t=r}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(e){return new(this instanceof sF.QuaternionKeyframeTrack?le:s9)(this.times,this.values,this.getValueSize()/3,e)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function lm(e,t,r){let i=t.attributes,n=[];for(let t in i){let a=lo[t]||t.toLowerCase();a in e.attributes||n.push(function(t,i){return r.getDependency("accessor",t).then(function(t){e.setAttribute(i,t)})}(i[t],a))}if(void 0!==t.indices&&!e.index){let i=r.getDependency("accessor",t.indices).then(function(t){e.setIndex(t)});n.push(i)}return lh(e,t),!function(e,t,r){let i=t.attributes,n=new sF.Box3;if(void 0===i.POSITION)return;{let e=r.json.accessors[i.POSITION],t=e.min,a=e.max;if(void 0===t||void 0===a)return console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(n.set(new sF.Vector3(t[0],t[1],t[2]),new sF.Vector3(a[0],a[1],a[2])),e.normalized){let t=lA(lr[e.componentType]);n.min.multiplyScalar(t),n.max.multiplyScalar(t)}}let a=t.targets;if(void 0!==a){let e=new sF.Vector3,t=new sF.Vector3;for(let i=0,n=a.length;i<n;i++){let n=a[i];if(void 0!==n.POSITION){let i=r.json.accessors[n.POSITION],a=i.min,o=i.max;if(void 0!==a&&void 0!==o){if(t.setX(Math.max(Math.abs(a[0]),Math.abs(o[0]))),t.setY(Math.max(Math.abs(a[1]),Math.abs(o[1]))),t.setZ(Math.max(Math.abs(a[2]),Math.abs(o[2]))),i.normalized){let e=lA(lr[i.componentType]);t.multiplyScalar(e)}e.max(t)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(e)}e.boundingBox=n;let o=new sF.Sphere;n.getCenter(o.center),o.radius=n.min.distanceTo(n.max)/2,e.boundingSphere=o}(e,t,r),Promise.all(n).then(function(){return void 0!==t.targets?function(e,t,r){let i=!1,n=!1,a=!1;for(let e=0,r=t.length;e<r;e++){let r=t[e];if(void 0!==r.POSITION&&(i=!0),void 0!==r.NORMAL&&(n=!0),void 0!==r.COLOR_0&&(a=!0),i&&n&&a)break}if(!i&&!n&&!a)return Promise.resolve(e);let o=[],s=[],l=[];for(let c=0,h=t.length;c<h;c++){let h=t[c];if(i){let t=void 0!==h.POSITION?r.getDependency("accessor",h.POSITION):e.attributes.position;o.push(t)}if(n){let t=void 0!==h.NORMAL?r.getDependency("accessor",h.NORMAL):e.attributes.normal;s.push(t)}if(a){let t=void 0!==h.COLOR_0?r.getDependency("accessor",h.COLOR_0):e.attributes.color;l.push(t)}}return Promise.all([Promise.all(o),Promise.all(s),Promise.all(l)]).then(function(t){let r=t[0],o=t[1],s=t[2];return i&&(e.morphAttributes.position=r),n&&(e.morphAttributes.normal=o),a&&(e.morphAttributes.color=s),e.morphTargetsRelative=!0,e})}(e,t.targets,r):e})}var lp=tw;let lg=new WeakMap;class lv extends lp.Loader{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,r,i){let n=new lp.FileLoader(this.manager);n.setPath(this.path),n.setResponseType("arraybuffer"),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials),n.load(e,e=>{let r={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(e,r).then(t).catch(i)},r,i)}decodeDracoFile(e,t,r,i){let n={attributeIDs:r||this.defaultAttributeIDs,attributeTypes:i||this.defaultAttributeTypes,useUniqueIDs:!!r};this.decodeGeometry(e,n).then(t)}decodeGeometry(e,t){let r;for(let e in t.attributeTypes){let r=t.attributeTypes[e];void 0!==r.BYTES_PER_ELEMENT&&(t.attributeTypes[e]=r.name)}let i=JSON.stringify(t);if(lg.has(e)){let t=lg.get(e);if(t.key===i)return t.promise;if(0===e.byteLength)throw Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n=this.workerNextTaskID++,a=e.byteLength,o=this._getWorker(n,a).then(i=>(r=i,new Promise((i,a)=>{r._callbacks[n]={resolve:i,reject:a},r.postMessage({type:"decode",id:n,taskConfig:t,buffer:e},[e])}))).then(e=>this._createGeometry(e.geometry));return o.catch(()=>!0).then(()=>{r&&n&&this._releaseTask(r,n)}),lg.set(e,{key:i,promise:o}),o}_createGeometry(e){let t=new lp.BufferGeometry;e.index&&t.setIndex(new lp.BufferAttribute(e.index.array,1));for(let r=0;r<e.attributes.length;r++){let i=e.attributes[r],n=i.name,a=i.array,o=i.itemSize;t.setAttribute(n,new lp.BufferAttribute(a,o))}return t}_loadLibrary(e,t){let r=new lp.FileLoader(this.manager);return r.setPath(this.decoderPath),r.setResponseType(t),r.setWithCredentials(this.withCredentials),new Promise((t,i)=>{r.load(e,t,void 0,i)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;let e="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(t=>{let r=t[0];e||(this.decoderConfig.wasmBinary=t[1]);let i=ly.toString(),n=["/* draco decoder */",r,"\n/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([n]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){let e=new Worker(this.workerSourceURL);e._callbacks={},e._taskCosts={},e._taskLoad=0,e.postMessage({type:"init",decoderConfig:this.decoderConfig}),e.onmessage=function(t){let r=t.data;switch(r.type){case"decode":e._callbacks[r.id].resolve(r);break;case"error":e._callbacks[r.id].reject(r);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(e)}else this.workerPool.sort(function(e,t){return e._taskLoad>t._taskLoad?-1:1});let r=this.workerPool[this.workerPool.length-1];return r._taskCosts[e]=t,r._taskLoad+=t,r})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}}function ly(){let e,t;onmessage=function(r){let i=r.data;switch(i.type){case"init":e=i.decoderConfig,t=new Promise(function(t){e.onModuleLoaded=function(e){t({draco:e})},DracoDecoderModule(e)});break;case"decode":let n=i.buffer,a=i.taskConfig;t.then(e=>{let t=e.draco,r=new t.Decoder,o=new t.DecoderBuffer;o.Init(new Int8Array(n),n.byteLength);try{let e=function(e,t,r,i){var n,a,o;let s,l,c,h,u,A,d=i.attributeIDs,f=i.attributeTypes,m=t.GetEncodedGeometryType(r);if(m===e.TRIANGULAR_MESH)u=new e.Mesh,A=t.DecodeBufferToMesh(r,u);else if(m===e.POINT_CLOUD)u=new e.PointCloud,A=t.DecodeBufferToPointCloud(r,u);else throw Error("THREE.DRACOLoader: Unexpected geometry type.");if(!A.ok()||0===u.ptr)throw Error("THREE.DRACOLoader: Decoding failed: "+A.error_msg());let p={index:null,attributes:[]};for(let r in d){let n,a,o=self[f[r]];if(i.useUniqueIDs)a=d[r],n=t.GetAttributeByUniqueId(u,a);else{if(-1===(a=t.GetAttributeId(u,e[d[r]])))continue;n=t.GetAttribute(u,a)}p.attributes.push(function(e,t,r,i,n,a){let o=a.num_components(),s=r.num_points()*o,l=s*n.BYTES_PER_ELEMENT,c=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32}}(e,n),h=e._malloc(l);t.GetAttributeDataArrayForAllPoints(r,a,c,l,h);let u=new n(e.HEAPF32.buffer,h,s).slice();return e._free(h),{name:i,array:u,itemSize:o}}(e,t,u,r,o,n))}return m===e.TRIANGULAR_MESH&&(n=e,a=t,o=u,s=3*o.num_faces(),l=4*s,c=n._malloc(l),a.GetTrianglesUInt32Array(o,l,c),h=new Uint32Array(n.HEAPF32.buffer,c,s).slice(),n._free(c),p.index={array:h,itemSize:1}),e.destroy(u),p}(t,r,o,a),n=e.attributes.map(e=>e.array.buffer);e.index&&n.push(e.index.array.buffer),self.postMessage({type:"decode",id:i.id,geometry:e},n)}catch(e){console.error(e),self.postMessage({type:"error",id:i.id,error:e.message})}finally{t.destroy(o),t.destroy(r)}})}}}var nX=tI;let lx=null,lE="https://www.gstatic.com/draco/versioned/decoders/1.5.5/";function lC(e=!0,t=!0,r){return i=>{r&&r(i),e&&(lx||(lx=new lv),lx.setDecoderPath("string"==typeof e?e:lE),i.setDRACOLoader(lx)),t&&i.setMeshoptDecoder((()=>{let e;if(M)return M;let t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),r=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]);if("object"!=typeof WebAssembly)return{supported:!1};let i="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";WebAssembly.validate(t)&&(i="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");let n=WebAssembly.instantiate(function(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;++r){let i=e.charCodeAt(r);t[r]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let i=0;for(let n=0;n<e.length;++n)t[i++]=t[n]<60?r[t[n]]:(t[n]-60)*64+t[++n];return t.buffer.slice(0,i)}(i),{}).then(t=>{(e=t.instance).exports.__wasm_call_ctors()});function a(t,r,i,n,a,o){let s=e.exports.sbrk,l=i+3&-4,c=s(l*n),h=s(a.length),u=new Uint8Array(e.exports.memory.buffer);u.set(a,h);let A=t(c,i,n,h,a.length);if(0===A&&o&&o(c,l,n),r.set(u.subarray(c,c+i*n)),s(c-s(0)),0!==A)throw Error(`Malformed buffer data: ${A}`)}let o={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},s={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return M={ready:n,supported:!0,decodeVertexBuffer(t,r,i,n,s){a(e.exports.meshopt_decodeVertexBuffer,t,r,i,n,e.exports[o[s]])},decodeIndexBuffer(t,r,i,n){a(e.exports.meshopt_decodeIndexBuffer,t,r,i,n)},decodeIndexSequence(t,r,i,n){a(e.exports.meshopt_decodeIndexSequence,t,r,i,n)},decodeGltfBuffer(t,r,i,n,l,c){a(e.exports[s[l]],t,r,i,n,e.exports[o[c]])}}})())}}let lB=(e,t,r,i)=>(0,nX.G)(sU,e,lC(t,r,i));lB.preload=(e,t,r,i)=>nX.G.preload(sU,e,lC(t,r,i)),lB.clear=e=>nX.G.clear(sU,e),lB.setDecoderPath=e=>{lE=e};let lw=tC.forwardRef(({src:e,useDraco:t,useMeshOpt:r,extendLoader:i,...n},a)=>{let{scene:o}=lB(e,t,r,i);return tC.createElement(sm,e2({ref:a},n,{object:o}))});var tI=tI;class lI{constructor(e,t=" .:-=+*#%@",r={}){let i,n,a,o,s;const l=r.resolution||.15,c=r.scale||1,h=r.color||!1,u=r.alpha||!1,A=r.block||!1,d=r.invert||!1,f=r.strResolution||"low",m=document.createElement("div");m.style.cursor="default";const p=document.createElement("table");m.appendChild(p),this.setSize=function(t,r){let c;i=t,n=r,e.setSize(t,r),a=Math.floor(i*l),o=Math.floor(n*l),y.width=a,y.height=o,(s=e.domElement).style.backgroundColor&&(p.rows[0].cells[0].style.backgroundColor=s.style.backgroundColor,p.rows[0].cells[0].style.color=s.style.color),p.cellSpacing=0,p.cellPadding=0,(c=p.style).whiteSpace="pre",c.margin="0px",c.padding="0px",c.letterSpacing=w+"px",c.fontFamily=g,c.fontSize=C+"px",c.lineHeight=B+"px",c.textAlign="left",c.textDecoration="none"},this.render=function(t,r){e.render(t,r),function(e){x.clearRect(0,0,a,o),x.drawImage(v,0,0,a,o);let t=x.getImageData(0,0,a,o).data,r="";for(let e=0;e<o;e+=2){for(let i=0;i<a;i++){let n,o,s=(e*a+i)*4,l=t[s],c=t[s+1],f=t[s+2],m=t[s+3];o=(.3*l+.59*c+.11*f)/255,0==m&&(o=1),n=Math.floor((1-o)*(E.length-1)),d&&(n=E.length-n-1);let p=E[n];(void 0===p||" "==p)&&(p="&nbsp;"),h?r+="<span style='color:rgb("+l+","+c+","+f+");"+(A?"background-color:rgb("+l+","+c+","+f+");":"")+(u?"opacity:"+m/255+";":"")+"'>"+p+"</span>":r+=p}r+="<br/>"}e.innerHTML=`<tr><td style="display:block;width:${i}px;height:${n}px;overflow:hidden">${r}</td></tr>`}(p)},this.domElement=m;const g="courier new, monospace",v=e.domElement,y=document.createElement("canvas");if(!y.getContext)return;const x=y.getContext("2d");if(!x.getImageData)return;let E=h?" CGO08@".split(""):" .,:;i1tfLCG08@".split("");t&&(E=t);const C=2/l*c,B=2/l*c;let w=0;if("low"==f)switch(c){case 1:w=-1;break;case 2:case 3:w=-2.1;break;case 4:w=-3.1;break;case 5:w=-4.15}if("medium"==f)switch(c){case 1:w=0;break;case 2:w=-1;break;case 3:w=-1.04;break;case 4:case 5:w=-2.1}if("high"==f)switch(c){case 1:case 2:w=0;break;case 3:case 4:case 5:w=-1}}}function lb({renderIndex:e=1,bgColor:t="black",fgColor:r="white",characters:i=" .:-+*=%@#",invert:n=!0,color:a=!1,resolution:o=.15}){let{size:s,gl:l,scene:c,camera:h}=(0,tI.C)(),u=tC.useMemo(()=>{let e=new lI(l,i,{invert:n,color:a,resolution:o});return e.domElement.style.position="absolute",e.domElement.style.top="0px",e.domElement.style.left="0px",e.domElement.style.pointerEvents="none",e},[i,n,a,o]);return tC.useLayoutEffect(()=>{u.domElement.style.color=r,u.domElement.style.backgroundColor=t},[r,t]),tC.useEffect(()=>(l.domElement.style.opacity="0",l.domElement.parentNode.appendChild(u.domElement),()=>{l.domElement.style.opacity="1",l.domElement.parentNode.removeChild(u.domElement)}),[u]),tC.useEffect(()=>{u.setSize(s.width,s.height)},[u,s]),(0,tb.useFrame)(e=>{u.render(c,h)},e),tC.createElement(tC.Fragment,null)}var l_=tw,on=tI,tI=tI,nX=tI;let lM=oV({alphaTest:0,viewport:new l_.Vector2(1980,1080),focal:1e3,centerAndScaleTexture:null,covAndColorTexture:null},`
    precision highp sampler2D;
    precision highp usampler2D;
    out vec4 vColor;
    out vec3 vPosition;
    uniform vec2 resolution;
    uniform vec2 viewport;
    uniform float focal;
    attribute uint splatIndex;
    uniform sampler2D centerAndScaleTexture;
    uniform usampler2D covAndColorTexture;    

    vec2 unpackInt16(in uint value) {
      int v = int(value);
      int v0 = v >> 16;
      int v1 = (v & 0xFFFF);
      if((v & 0x8000) != 0)
        v1 |= 0xFFFF0000;
      return vec2(float(v1), float(v0));
    }

    void main () {
      ivec2 texSize = textureSize(centerAndScaleTexture, 0);
      ivec2 texPos = ivec2(splatIndex%uint(texSize.x), splatIndex/uint(texSize.x));
      vec4 centerAndScaleData = texelFetch(centerAndScaleTexture, texPos, 0);
      vec4 center = vec4(centerAndScaleData.xyz, 1);
      vec4 camspace = modelViewMatrix * center;
      vec4 pos2d = projectionMatrix * camspace;

      float bounds = 1.2 * pos2d.w;
      if (pos2d.z < -pos2d.w || pos2d.x < -bounds || pos2d.x > bounds
        || pos2d.y < -bounds || pos2d.y > bounds) {
        gl_Position = vec4(0.0, 0.0, 2.0, 1.0);
        return;
      }

      uvec4 covAndColorData = texelFetch(covAndColorTexture, texPos, 0);
      vec2 cov3D_M11_M12 = unpackInt16(covAndColorData.x) * centerAndScaleData.w;
      vec2 cov3D_M13_M22 = unpackInt16(covAndColorData.y) * centerAndScaleData.w;
      vec2 cov3D_M23_M33 = unpackInt16(covAndColorData.z) * centerAndScaleData.w;
      mat3 Vrk = mat3(
        cov3D_M11_M12.x, cov3D_M11_M12.y, cov3D_M13_M22.x,
        cov3D_M11_M12.y, cov3D_M13_M22.y, cov3D_M23_M33.x,
        cov3D_M13_M22.x, cov3D_M23_M33.x, cov3D_M23_M33.y
      );

      mat3 J = mat3(
        focal / camspace.z, 0., -(focal * camspace.x) / (camspace.z * camspace.z),
        0., focal / camspace.z, -(focal * camspace.y) / (camspace.z * camspace.z),
        0., 0., 0.
      );

      mat3 W = transpose(mat3(modelViewMatrix));
      mat3 T = W * J;
      mat3 cov = transpose(T) * Vrk * T;
      vec2 vCenter = vec2(pos2d) / pos2d.w;
      float diagonal1 = cov[0][0] + 0.3;
      float offDiagonal = cov[0][1];
      float diagonal2 = cov[1][1] + 0.3;
      float mid = 0.5 * (diagonal1 + diagonal2);
      float radius = length(vec2((diagonal1 - diagonal2) / 2.0, offDiagonal));
      float lambda1 = mid + radius;
      float lambda2 = max(mid - radius, 0.1);
      vec2 diagonalVector = normalize(vec2(offDiagonal, lambda1 - diagonal1));
      vec2 v1 = min(sqrt(2.0 * lambda1), 1024.0) * diagonalVector;
      vec2 v2 = min(sqrt(2.0 * lambda2), 1024.0) * vec2(diagonalVector.y, -diagonalVector.x);
      uint colorUint = covAndColorData.w;
      vColor = vec4(
        float(colorUint & uint(0xFF)) / 255.0,
        float((colorUint >> uint(8)) & uint(0xFF)) / 255.0,
        float((colorUint >> uint(16)) & uint(0xFF)) / 255.0,
        float(colorUint >> uint(24)) / 255.0
      );
      vPosition = position;

      gl_Position = vec4(
        vCenter 
          + position.x * v2 / viewport * 2.0 
          + position.y * v1 / viewport * 2.0, pos2d.z / pos2d.w, 1.0);
    }
    `,`
    #include <alphatest_pars_fragment>
    #include <alphahash_pars_fragment>
    in vec4 vColor;
    in vec3 vPosition;
    void main () {
      float A = -dot(vPosition.xy, vPosition.xy);
      if (A < -4.0) discard;
      float B = exp(A) * vColor.a;
      vec4 diffuseColor = vec4(vColor.rgb, B);
      #include <alphatest_fragment>
      #include <alphahash_fragment>
      gl_FragColor = diffuseColor;
      #include <tonemapping_fragment>
      #include <${oW>=154?"colorspace_fragment":"encodings_fragment"}>
    }
  `);function lS(e){let t=null,r=0;e.onmessage=i=>{if("push"==i.data.method){0===r&&(t=new Float32Array(i.data.length));let e=new Float32Array(i.data.matrices);t.set(e,r),r+=e.length}else if("sort"==i.data.method&&null!==t){let r=function(e,r=!1){let i=t.length/16,n=-1/0,a=1/0,o=new Float32Array(i),s=new Int32Array(o.buffer),l=new Int32Array(i),c=0;for(let s=0;s<i;s++){let i=e[0]*t[16*s+12]+e[1]*t[16*s+13]+e[2]*t[16*s+14]+e[3];(r||i<0&&t[16*s+15]>-1e-4*i)&&(o[c]=i,l[c]=s,c++,i>n&&(n=i),i<a&&(a=i))}let h=65535/(n-a),u=new Uint32Array(65536);for(let e=0;e<c;e++)s[e]=(o[e]-a)*h|0,u[s[e]]++;let A=new Uint32Array(65536);for(let e=1;e<65536;e++)A[e]=A[e-1]+u[e-1];let d=new Uint32Array(c);for(let e=0;e<c;e++)d[A[s[e]]++]=l[e];return d}(new Float32Array(i.data.view),i.data.hashed);e.postMessage({indices:r,key:i.data.key},[r.buffer])}}}class lT extends l_.Loader{constructor(...e){super(...e),this.gl=null,this.chunkSize=25e3}load(e,t,r,i){let n={gl:this.gl,url:this.manager.resolveURL(e),worker:new Worker(URL.createObjectURL(new Blob(["(",lS.toString(),")(self)"],{type:"application/javascript"}))),manager:this.manager,update:(e,t,r)=>(function(e,t,r,i){if(e.updateMatrixWorld(),t.gl.getCurrentViewport(r.viewport),r.material.viewport.x=r.viewport.z,r.material.viewport.y=r.viewport.w,r.material.focal=r.viewport.w/2*Math.abs(e.projectionMatrix.elements[5]),r.ready){if(i&&r.sorted)return;r.ready=!1;let e=new Float32Array([r.modelViewMatrix.elements[2],-r.modelViewMatrix.elements[6],r.modelViewMatrix.elements[10],r.modelViewMatrix.elements[14]]);t.worker.postMessage({method:"sort",src:t.url,key:r.uuid,view:e.buffer,hashed:i},[e.buffer]),i&&t.loaded&&(r.sorted=!0)}})(t,n,e,r),connect:e=>(function(e,t){e.loading||lF(e),t.ready=!1,t.pm=new l_.Matrix4,t.vm1=new l_.Matrix4,t.vm2=new l_.Matrix4,t.viewport=new l_.Vector4;let r=new Uint32Array(e.bufferTextureWidth*e.bufferTextureHeight),i=new l_.InstancedBufferAttribute(r,1,!1);i.setUsage(l_.DynamicDrawUsage);let n=t.geometry=new l_.InstancedBufferGeometry,a=new Float32Array(18),o=new l_.BufferAttribute(a,3);function s(e){if(t&&e.data.key===t.uuid){let r=new Uint32Array(e.data.indices);n.attributes.splatIndex.set(r),n.attributes.splatIndex.needsUpdate=!0,n.instanceCount=r.length,t.ready=!0}}return n.setAttribute("position",o),o.setXYZ(2,-2,2,0),o.setXYZ(1,2,2,0),o.setXYZ(0,-2,-2,0),o.setXYZ(5,-2,-2,0),o.setXYZ(4,2,2,0),o.setXYZ(3,2,-2,0),o.needsUpdate=!0,n.setAttribute("splatIndex",i),n.instanceCount=1,e.worker.addEventListener("message",s),async function(){for(;;){let t=e.gl.properties.get(e.centerAndScaleTexture),r=e.gl.properties.get(e.covAndColorTexture);if(null!=t&&t.__webglTexture&&null!=r&&r.__webglTexture&&e.loadedVertexCount>0)break;await new Promise(e=>setTimeout(e,10))}t.ready=!0}(),()=>e.worker.removeEventListener("message",s)})(n,e),loading:!1,loaded:!1,loadedVertexCount:0,chunkSize:this.chunkSize,totalDownloadBytes:0,numVertices:0,rowLength:32,maxVertexes:0,bufferTextureWidth:0,bufferTextureHeight:0,stream:null,centerAndScaleData:null,covAndColorData:null,covAndColorTexture:null,centerAndScaleTexture:null,onProgress:r};lD(n).then(t).catch(e=>{null==i||i(e),n.manager.itemError(n.url)})}}async function lD(e){e.manager.itemStart(e.url);let t=await fetch(e.url);if(null===t.body)throw"Failed to fetch file";let r=t.headers.get("Content-Length"),i=r?parseInt(r):void 0;if(void 0==i)throw"Failed to get content length";e.stream=t.body.getReader(),e.totalDownloadBytes=i,e.numVertices=Math.floor(e.totalDownloadBytes/e.rowLength);let n=e.gl.getContext(),a=n.getParameter(n.MAX_TEXTURE_SIZE);return e.maxVertexes=a*a,e.numVertices>e.maxVertexes&&(e.numVertices=e.maxVertexes),e.bufferTextureWidth=a,e.bufferTextureHeight=Math.floor((e.numVertices-1)/a)+1,e.centerAndScaleData=new Float32Array(e.bufferTextureWidth*e.bufferTextureHeight*4),e.covAndColorData=new Uint32Array(e.bufferTextureWidth*e.bufferTextureHeight*4),e.centerAndScaleTexture=new l_.DataTexture(e.centerAndScaleData,e.bufferTextureWidth,e.bufferTextureHeight,l_.RGBAFormat,l_.FloatType),e.centerAndScaleTexture.needsUpdate=!0,e.covAndColorTexture=new l_.DataTexture(e.covAndColorData,e.bufferTextureWidth,e.bufferTextureHeight,l_.RGBAIntegerFormat,l_.UnsignedIntType),e.covAndColorTexture.internalFormat="RGBA32UI",e.covAndColorTexture.needsUpdate=!0,e}async function lF(e){e.loading=!0;let t=0,r=0,i=[],n=0,a=0!==e.totalDownloadBytes;for(;;)try{let{value:o,done:s}=await e.stream.read();if(s)break;if(t+=o.length,void 0!=e.totalDownloadBytes){let r=t/e.totalDownloadBytes*100;if(e.onProgress&&r-n>1){let i=new ProgressEvent("progress",{lengthComputable:a,loaded:t,total:e.totalDownloadBytes});e.onProgress(i),n=r}}i.push(o);let l=t-r;if(void 0!=e.totalDownloadBytes&&l>e.rowLength*e.chunkSize){let t=Math.floor(l/e.rowLength),n=new Uint8Array(l),o=0;for(let e of i)n.set(e,o),o+=e.length;if(i.length=0,l>t*e.rowLength){let r=new Uint8Array(l-t*e.rowLength);r.set(n.subarray(l-r.length,l),0),i.push(r)}let s=new Uint8Array(t*e.rowLength);s.set(n.subarray(0,s.byteLength),0);let c=lR(e,s.buffer,t);if(e.worker.postMessage({method:"push",src:e.url,length:16*e.numVertices,matrices:c.buffer},[c.buffer]),r+=t*e.rowLength,e.onProgress){let t=new ProgressEvent("progress",{lengthComputable:a,loaded:e.totalDownloadBytes,total:e.totalDownloadBytes});e.onProgress(t)}}}catch(e){console.error(e);break}if(t-r>0){let t=new Uint8Array(i.reduce((e,t)=>e+t.length,0)),r=0;for(let e of i)t.set(e,r),r+=e.length;let n=Math.floor(t.byteLength/e.rowLength),a=lR(e,t.buffer,n);e.worker.postMessage({method:"push",src:e.url,length:16*n,matrices:a.buffer},[a.buffer])}e.loaded=!0,e.manager.itemEnd(e.url)}function lR(e,t,r){let i=e.gl.getContext();if(e.loadedVertexCount+r>e.maxVertexes&&(r=e.maxVertexes-e.loadedVertexCount),r<=0)throw"Failed to parse file";let n=new Uint8Array(t),a=new Float32Array(t),o=new Float32Array(16*r),s=new Uint8Array(e.covAndColorData.buffer),l=new Int16Array(e.covAndColorData.buffer);for(let t=0;t<r;t++){let r=new l_.Quaternion(-(n[32*t+28+1]-128)/128,(n[32*t+28+2]-128)/128,(n[32*t+28+3]-128)/128,-(n[32*t+28+0]-128)/128);r.invert();let i=new l_.Vector3(a[8*t+0],a[8*t+1],-a[8*t+2]),c=new l_.Vector3(a[8*t+3+0],a[8*t+3+1],a[8*t+3+2]),h=new l_.Matrix4;h.makeRotationFromQuaternion(r),h.transpose(),h.scale(c);let u=h.clone();h.transpose(),h.premultiply(u),h.setPosition(i);let A=[0,1,2,5,6,10],d=0;for(let e=0;e<A.length;e++)Math.abs(h.elements[A[e]])>d&&(d=Math.abs(h.elements[A[e]]));let f=4*e.loadedVertexCount+4*t;e.centerAndScaleData[f+0]=i.x,e.centerAndScaleData[f+1]=-i.y,e.centerAndScaleData[f+2]=i.z,e.centerAndScaleData[f+3]=d/32767,f=8*e.loadedVertexCount+4*t*2;for(let e=0;e<A.length;e++)l[f+e]=32767*h.elements[A[e]]/d;f=16*e.loadedVertexCount+(4*t+3)*4;let m=new l_.Color(n[32*t+24+0]/255,n[32*t+24+1]/255,n[32*t+24+2]/255);m.convertSRGBToLinear(),s[f+0]=255*m.r,s[f+1]=255*m.g,s[f+2]=255*m.b,s[f+3]=n[32*t+24+3],h.elements[15]=Math.max(c.x,c.y,c.z)*n[32*t+24+3]/255;for(let e=0;e<16;e++)o[16*t+e]=h.elements[e]}for(;r>0;){let t=0,n=0,a=e.loadedVertexCount%e.bufferTextureWidth,o=Math.floor(e.loadedVertexCount/e.bufferTextureWidth);e.loadedVertexCount%e.bufferTextureWidth!=0?(t=Math.min(e.bufferTextureWidth,a+r)-a,n=1):Math.floor(r/e.bufferTextureWidth)>0?(t=e.bufferTextureWidth,n=Math.floor(r/e.bufferTextureWidth)):(t=r%e.bufferTextureWidth,n=1);let s=e.gl.properties.get(e.centerAndScaleTexture);i.bindTexture(i.TEXTURE_2D,s.__webglTexture),i.texSubImage2D(i.TEXTURE_2D,0,a,o,t,n,i.RGBA,i.FLOAT,e.centerAndScaleData,4*e.loadedVertexCount);let l=e.gl.properties.get(e.covAndColorTexture);i.bindTexture(i.TEXTURE_2D,l.__webglTexture),i.texSubImage2D(i.TEXTURE_2D,0,a,o,t,n,i.RGBA_INTEGER,i.UNSIGNED_INT,e.covAndColorData,4*e.loadedVertexCount),e.gl.resetState(),e.loadedVertexCount+=t*n,r-=t*n}return o}function lP({src:e,toneMapped:t=!1,alphaTest:r=0,alphaHash:i=!1,chunkSize:n=25e3,...a}){(0,on.e)({SplatMaterial:lM});let o=tC.useRef(null),s=(0,tI.C)(e=>e.gl),l=(0,tI.C)(e=>e.camera),c=(0,nX.G)(lT,e,e=>{e.gl=s,e.chunkSize=n});return tC.useLayoutEffect(()=>c.connect(o.current),[e]),(0,tb.useFrame)(()=>c.update(o.current,l,i)),tC.createElement("mesh",e2({ref:o,frustumCulled:!1},a),tC.createElement("splatMaterial",{key:`${e}/${r}/${i}${lM.key}`,transparent:!i,depthTest:!0,alphaTest:i?0:r,centerAndScaleTexture:c.centerAndScaleTexture,covAndColorTexture:c.covAndColorTexture,depthWrite:!!i||r>0,blending:i?l_.NormalBlending:l_.CustomBlending,blendSrcAlpha:l_.OneFactor,alphaHash:!!i,toneMapped:t}))}var tI=tI,tI=tI;function lQ(e,t,r){let i=(0,tI.C)(e=>e.size),n=(0,tI.C)(e=>e.viewport),a="number"==typeof e?e:i.width*n.dpr,o="number"==typeof t?t:i.height*n.dpr,s=("number"==typeof e?r:e)||{},{samples:l=0,depth:c,...h}=s,u=null!=c?c:s.depthBuffer,A=tC.useMemo(()=>{let e=new tw.WebGLRenderTarget(a,o,{minFilter:tw.LinearFilter,magFilter:tw.LinearFilter,type:tw.HalfFloatType,...h});return u&&(e.depthTexture=new tw.DepthTexture(a,o,tw.FloatType)),e.samples=l,e},[]);return tC.useLayoutEffect(()=>{A.setSize(a,o),l&&(A.samples=l)},[l,A,a,o]),tC.useEffect(()=>()=>A.dispose(),[]),A}let lU=(0,tC.forwardRef)(({children:e,width:t,height:r,...i},n)=>{let a=lQ(t,r,i);return(0,tC.useImperativeHandle)(n,()=>a,[a]),tC.createElement(tC.Fragment,null,null==e?void 0:e(a))}),lz=tC.forwardRef(({envMap:e,resolution:t=256,frames:r=1/0,children:i,makeDefault:n,...a},o)=>{let s=(0,tI.C)(({set:e})=>e),l=(0,tI.C)(({camera:e})=>e),c=(0,tI.C)(({size:e})=>e),h=tC.useRef(null);tC.useImperativeHandle(o,()=>h.current,[]);let u=tC.useRef(null),A=lQ(t);tC.useLayoutEffect(()=>{a.manual||h.current.updateProjectionMatrix()},[c,a]),tC.useLayoutEffect(()=>{h.current.updateProjectionMatrix()}),tC.useLayoutEffect(()=>{if(n)return s(()=>({camera:h.current})),()=>s(()=>({camera:l}))},[h,n,s]);let d=0,f=null,m="function"==typeof i;return(0,tb.useFrame)(t=>{m&&(r===1/0||d<r)&&(u.current.visible=!1,t.gl.setRenderTarget(A),f=t.scene.background,e&&(t.scene.background=e),t.gl.render(t.scene,h.current),t.scene.background=f,t.gl.setRenderTarget(null),u.current.visible=!0,d++)}),tC.createElement(tC.Fragment,null,tC.createElement("orthographicCamera",e2({left:-(c.width/2),right:c.width/2,top:c.height/2,bottom:-(c.height/2),ref:h},a),!m&&i),tC.createElement("group",{ref:u},m&&i(A.texture)))});var tI=tI;let lk=tC.forwardRef(({envMap:e,resolution:t=256,frames:r=1/0,makeDefault:i,children:n,...a},o)=>{let s=(0,tI.C)(({set:e})=>e),l=(0,tI.C)(({camera:e})=>e),c=(0,tI.C)(({size:e})=>e),h=tC.useRef(null);tC.useImperativeHandle(o,()=>h.current,[]);let u=tC.useRef(null),A=lQ(t);tC.useLayoutEffect(()=>{a.manual||(h.current.aspect=c.width/c.height)},[c,a]),tC.useLayoutEffect(()=>{h.current.updateProjectionMatrix()});let d=0,f=null,m="function"==typeof n;return(0,tb.useFrame)(t=>{m&&(r===1/0||d<r)&&(u.current.visible=!1,t.gl.setRenderTarget(A),f=t.scene.background,e&&(t.scene.background=e),t.gl.render(t.scene,h.current),t.scene.background=f,t.gl.setRenderTarget(null),u.current.visible=!0,d++)}),tC.useLayoutEffect(()=>{if(i)return s(()=>({camera:h.current})),()=>s(()=>({camera:l}))},[h,i,s]),tC.createElement(tC.Fragment,null,tC.createElement("perspectiveCamera",e2({ref:h},a),!m&&n),tC.createElement("group",{ref:u},m&&n(A.texture)))});var tI=tI;function lL({resolution:e=256,near:t=.1,far:r=1e3,envMap:i,fog:n}={}){let a,o,s=(0,tI.C)(({gl:e})=>e),l=(0,tI.C)(({scene:e})=>e),c=(0,tC.useMemo)(()=>{let t=new tw.WebGLCubeRenderTarget(e);return t.texture.type=tw.HalfFloatType,t},[e]);(0,tC.useEffect)(()=>()=>{c.dispose()},[c]);let h=(0,tC.useMemo)(()=>new tw.CubeCamera(t,r,c),[t,r,c]),u=tC.useCallback(()=>{a=l.fog,o=l.background,l.background=i||o,l.fog=n||a,h.update(s,l),l.fog=a,l.background=o},[s,l,h]);return{fbo:c,camera:h,update:u}}function lO({children:e,frames:t=1/0,resolution:r,near:i,far:n,envMap:a,fog:o,...s}){let l=tC.useRef(null),{fbo:c,camera:h,update:u}=lL({resolution:r,near:i,far:n,envMap:a,fog:o}),A=0;return(0,tb.useFrame)(()=>{l.current&&(t===1/0||A<t)&&(l.current.visible=!1,u(),l.current.visible=!0,A++)}),tC.createElement("group",s,tC.createElement("primitive",{object:h}),tC.createElement("group",{ref:l},null==e?void 0:e(c.texture)))}var tI=tI,lG=Object.defineProperty;class lN{constructor(){((e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?lG(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r})(this,"_listeners")}addEventListener(e,t){void 0===this._listeners&&(this._listeners={});let r=this._listeners;void 0===r[e]&&(r[e]=[]),-1===r[e].indexOf(t)&&r[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;let r=this._listeners;return void 0!==r[e]&&-1!==r[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;let r=this._listeners[e];if(void 0!==r){let e=r.indexOf(t);-1!==e&&r.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;let t=this._listeners[e.type];if(void 0!==t){e.target=this;let r=t.slice(0);for(let t=0,i=r.length;t<i;t++)r[t].call(this,e);e.target=null}}}var lH=Object.defineProperty,lV=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?lH(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r,r};class lj extends lN{constructor(e){super(),lV(this,"object"),lV(this,"changeEvent",{type:"change"}),lV(this,"EPS",1e-6),lV(this,"enabled",!0),lV(this,"deviceOrientation",{alpha:0,beta:0,gamma:0}),lV(this,"screenOrientation",0),lV(this,"alphaOffset",0),lV(this,"onDeviceOrientationChangeEvent",e=>{this.deviceOrientation=e}),lV(this,"onScreenOrientationChangeEvent",()=>{this.screenOrientation=window.orientation||0}),lV(this,"zee",new tw.Vector3(0,0,1)),lV(this,"euler",new tw.Euler),lV(this,"q0",new tw.Quaternion),lV(this,"q1",new tw.Quaternion(-Math.sqrt(.5),0,0,Math.sqrt(.5))),lV(this,"setObjectQuaternion",(e,t,r,i,n)=>{this.euler.set(r,t,-i,"YXZ"),e.setFromEuler(this.euler),e.multiply(this.q1),e.multiply(this.q0.setFromAxisAngle(this.zee,-n))}),lV(this,"connect",()=>{this.onScreenOrientationChangeEvent(),void 0!==window.DeviceOrientationEvent&&"function"==typeof window.DeviceOrientationEvent.requestPermission?window.DeviceOrientationEvent.requestPermission().then(e=>{"granted"==e&&(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent))}).catch(e=>{console.error("THREE.DeviceOrientationControls: Unable to use DeviceOrientation API:",e)}):(window.addEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.addEventListener("deviceorientation",this.onDeviceOrientationChangeEvent)),this.enabled=!0}),lV(this,"disconnect",()=>{window.removeEventListener("orientationchange",this.onScreenOrientationChangeEvent),window.removeEventListener("deviceorientation",this.onDeviceOrientationChangeEvent),this.enabled=!1}),lV(this,"lastQuaternion",new tw.Quaternion),lV(this,"update",()=>{if(!1===this.enabled)return;let e=this.deviceOrientation;if(e){let t=e.alpha?tw.MathUtils.degToRad(e.alpha)+this.alphaOffset:0,r=e.beta?tw.MathUtils.degToRad(e.beta):0,i=e.gamma?tw.MathUtils.degToRad(e.gamma):0,n=this.screenOrientation?tw.MathUtils.degToRad(this.screenOrientation):0;this.setObjectQuaternion(this.object.quaternion,t,r,i,n),8*(1-this.lastQuaternion.dot(this.object.quaternion))>this.EPS&&(this.lastQuaternion.copy(this.object.quaternion),this.dispatchEvent(this.changeEvent))}}),lV(this,"dispose",()=>this.disconnect()),this.object=e,this.object.rotation.reorder("YXZ"),this.connect()}}let lJ=tC.forwardRef((e,t)=>{let{camera:r,onChange:i,makeDefault:n,...a}=e,o=(0,tI.C)(e=>e.camera),s=(0,tI.C)(e=>e.invalidate),l=(0,tI.C)(e=>e.get),c=(0,tI.C)(e=>e.set),h=r||o,u=tC.useMemo(()=>new lj(h),[h]);return tC.useEffect(()=>{let e=e=>{s(),i&&i(e)};return null==u||null==u.addEventListener||u.addEventListener("change",e),()=>null==u||null==u.removeEventListener?void 0:u.removeEventListener("change",e)},[i,u,s]),(0,tb.useFrame)(()=>null==u?void 0:u.update(),-1),tC.useEffect(()=>(null==u||u.connect(),()=>null==u?void 0:u.dispose()),[u]),tC.useEffect(()=>{if(n){let e=l().controls;return c({controls:u}),()=>c({controls:e})}},[n,u]),u?tC.createElement("primitive",e2({ref:t,object:u},a)):null});var tI=tI,lY=Object.defineProperty,lW=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?lY(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r,r};function lK(e){e.preventDefault()}class lX extends lN{constructor(e,t){super(),lW(this,"object"),lW(this,"domElement",null),lW(this,"movementSpeed",1),lW(this,"rollSpeed",.005),lW(this,"dragToLook",!1),lW(this,"autoForward",!1),lW(this,"changeEvent",{type:"change"}),lW(this,"EPS",1e-6),lW(this,"tmpQuaternion",new tw.Quaternion),lW(this,"mouseStatus",0),lW(this,"movementSpeedMultiplier",1),lW(this,"moveState",{up:0,down:0,left:0,right:0,forward:0,back:0,pitchUp:0,pitchDown:0,yawLeft:0,yawRight:0,rollLeft:0,rollRight:0}),lW(this,"moveVector",new tw.Vector3(0,0,0)),lW(this,"rotationVector",new tw.Vector3(0,0,0)),lW(this,"keydown",e=>{if(!e.altKey){switch(e.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=.1;break;case"KeyW":this.moveState.forward=1;break;case"KeyS":this.moveState.back=1;break;case"KeyA":this.moveState.left=1;break;case"KeyD":this.moveState.right=1;break;case"KeyR":this.moveState.up=1;break;case"KeyF":this.moveState.down=1;break;case"ArrowUp":this.moveState.pitchUp=1;break;case"ArrowDown":this.moveState.pitchDown=1;break;case"ArrowLeft":this.moveState.yawLeft=1;break;case"ArrowRight":this.moveState.yawRight=1;break;case"KeyQ":this.moveState.rollLeft=1;break;case"KeyE":this.moveState.rollRight=1}this.updateMovementVector(),this.updateRotationVector()}}),lW(this,"keyup",e=>{switch(e.code){case"ShiftLeft":case"ShiftRight":this.movementSpeedMultiplier=1;break;case"KeyW":this.moveState.forward=0;break;case"KeyS":this.moveState.back=0;break;case"KeyA":this.moveState.left=0;break;case"KeyD":this.moveState.right=0;break;case"KeyR":this.moveState.up=0;break;case"KeyF":this.moveState.down=0;break;case"ArrowUp":this.moveState.pitchUp=0;break;case"ArrowDown":this.moveState.pitchDown=0;break;case"ArrowLeft":this.moveState.yawLeft=0;break;case"ArrowRight":this.moveState.yawRight=0;break;case"KeyQ":this.moveState.rollLeft=0;break;case"KeyE":this.moveState.rollRight=0}this.updateMovementVector(),this.updateRotationVector()}),lW(this,"pointerdown",e=>{if(this.dragToLook)this.mouseStatus++;else{switch(e.button){case 0:this.moveState.forward=1;break;case 2:this.moveState.back=1}this.updateMovementVector()}}),lW(this,"pointermove",e=>{if(!this.dragToLook||this.mouseStatus>0){let t=this.getContainerDimensions(),r=t.size[0]/2,i=t.size[1]/2;this.moveState.yawLeft=-(e.pageX-t.offset[0]-r)/r,this.moveState.pitchDown=(e.pageY-t.offset[1]-i)/i,this.updateRotationVector()}}),lW(this,"pointerup",e=>{if(this.dragToLook)this.mouseStatus--,this.moveState.yawLeft=this.moveState.pitchDown=0;else{switch(e.button){case 0:this.moveState.forward=0;break;case 2:this.moveState.back=0}this.updateMovementVector()}this.updateRotationVector()}),lW(this,"lastQuaternion",new tw.Quaternion),lW(this,"lastPosition",new tw.Vector3),lW(this,"update",e=>{let t=e*this.movementSpeed,r=e*this.rollSpeed;this.object.translateX(this.moveVector.x*t),this.object.translateY(this.moveVector.y*t),this.object.translateZ(this.moveVector.z*t),this.tmpQuaternion.set(this.rotationVector.x*r,this.rotationVector.y*r,this.rotationVector.z*r,1).normalize(),this.object.quaternion.multiply(this.tmpQuaternion),(this.lastPosition.distanceToSquared(this.object.position)>this.EPS||8*(1-this.lastQuaternion.dot(this.object.quaternion))>this.EPS)&&(this.dispatchEvent(this.changeEvent),this.lastQuaternion.copy(this.object.quaternion),this.lastPosition.copy(this.object.position))}),lW(this,"updateMovementVector",()=>{let e=this.moveState.forward||this.autoForward&&!this.moveState.back?1:0;this.moveVector.x=-this.moveState.left+this.moveState.right,this.moveVector.y=-this.moveState.down+this.moveState.up,this.moveVector.z=-e+this.moveState.back}),lW(this,"updateRotationVector",()=>{this.rotationVector.x=-this.moveState.pitchDown+this.moveState.pitchUp,this.rotationVector.y=-this.moveState.yawRight+this.moveState.yawLeft,this.rotationVector.z=-this.moveState.rollRight+this.moveState.rollLeft}),lW(this,"getContainerDimensions",()=>this.domElement==document||this.domElement instanceof Document?{size:[window.innerWidth,window.innerHeight],offset:[0,0]}:{size:[this.domElement.offsetWidth,this.domElement.offsetHeight],offset:[this.domElement.offsetLeft,this.domElement.offsetTop]}),lW(this,"connect",e=>{this.domElement=e,e instanceof Document||e.setAttribute("tabindex",-1),this.domElement.addEventListener("contextmenu",lK),this.domElement.addEventListener("pointermove",this.pointermove),this.domElement.addEventListener("pointerdown",this.pointerdown),this.domElement.addEventListener("pointerup",this.pointerup),window.addEventListener("keydown",this.keydown),window.addEventListener("keyup",this.keyup)}),lW(this,"dispose",()=>{this.domElement.removeEventListener("contextmenu",lK),this.domElement.removeEventListener("pointermove",this.pointermove),this.domElement.removeEventListener("pointerdown",this.pointerdown),this.domElement.removeEventListener("pointerup",this.pointerup),window.removeEventListener("keydown",this.keydown),window.removeEventListener("keyup",this.keyup)}),this.object=e,void 0!==t&&this.connect(t),this.updateMovementVector(),this.updateRotationVector()}}let lq=tC.forwardRef(({domElement:e,...t},r)=>{let{onChange:i,makeDefault:n,...a}=t,o=(0,tI.C)(e=>e.invalidate),s=(0,tI.C)(e=>e.camera),l=(0,tI.C)(e=>e.gl),c=(0,tI.C)(e=>e.events),h=(0,tI.C)(e=>e.get),u=(0,tI.C)(e=>e.set),A=e||c.connected||l.domElement,d=tC.useMemo(()=>new lX(s),[s]);return tC.useEffect(()=>(d.connect(A),()=>void d.dispose()),[A,d,o]),tC.useEffect(()=>{let e=e=>{o(),i&&i(e)};return null==d.addEventListener||d.addEventListener("change",e),()=>null==d.removeEventListener?void 0:d.removeEventListener("change",e)},[i,o]),tC.useEffect(()=>{if(n){let e=h().controls;return u({controls:d}),()=>u({controls:e})}},[n,d]),(0,tb.useFrame)((e,t)=>d.update(t)),tC.createElement("primitive",e2({ref:r,object:d,args:[s,A]},a))});var tI=tI,lZ=Object.defineProperty,l$=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?lZ(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r,r};let l1=new tw.Ray,l0=new tw.Plane,l2=Math.cos(Math.PI/180*70),l3=(e,t)=>(e%t+t)%t;class l4 extends lN{constructor(e,t){super(),l$(this,"object"),l$(this,"domElement"),l$(this,"enabled",!0),l$(this,"target",new tw.Vector3),l$(this,"minDistance",0),l$(this,"maxDistance",1/0),l$(this,"minZoom",0),l$(this,"maxZoom",1/0),l$(this,"minPolarAngle",0),l$(this,"maxPolarAngle",Math.PI),l$(this,"minAzimuthAngle",-1/0),l$(this,"maxAzimuthAngle",1/0),l$(this,"enableDamping",!1),l$(this,"dampingFactor",.05),l$(this,"enableZoom",!0),l$(this,"zoomSpeed",1),l$(this,"enableRotate",!0),l$(this,"rotateSpeed",1),l$(this,"enablePan",!0),l$(this,"panSpeed",1),l$(this,"screenSpacePanning",!0),l$(this,"keyPanSpeed",7),l$(this,"zoomToCursor",!1),l$(this,"autoRotate",!1),l$(this,"autoRotateSpeed",2),l$(this,"reverseOrbit",!1),l$(this,"reverseHorizontalOrbit",!1),l$(this,"reverseVerticalOrbit",!1),l$(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),l$(this,"mouseButtons",{LEFT:tw.MOUSE.ROTATE,MIDDLE:tw.MOUSE.DOLLY,RIGHT:tw.MOUSE.PAN}),l$(this,"touches",{ONE:tw.TOUCH.ROTATE,TWO:tw.TOUCH.DOLLY_PAN}),l$(this,"target0"),l$(this,"position0"),l$(this,"zoom0"),l$(this,"_domElementKeyEvents",null),l$(this,"getPolarAngle"),l$(this,"getAzimuthalAngle"),l$(this,"setPolarAngle"),l$(this,"setAzimuthalAngle"),l$(this,"getDistance"),l$(this,"getZoomScale"),l$(this,"listenToKeyEvents"),l$(this,"stopListenToKeyEvents"),l$(this,"saveState"),l$(this,"reset"),l$(this,"update"),l$(this,"connect"),l$(this,"dispose"),l$(this,"dollyIn"),l$(this,"dollyOut"),l$(this,"getScale"),l$(this,"setScale"),this.object=e,this.domElement=t,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>c.phi,this.getAzimuthalAngle=()=>c.theta,this.setPolarAngle=e=>{let t=l3(e,2*Math.PI),i=c.phi;i<0&&(i+=2*Math.PI),t<0&&(t+=2*Math.PI);let n=Math.abs(t-i);2*Math.PI-n<n&&(t<i?t+=2*Math.PI:i+=2*Math.PI),h.phi=t-i,r.update()},this.setAzimuthalAngle=e=>{let t=l3(e,2*Math.PI),i=c.theta;i<0&&(i+=2*Math.PI),t<0&&(t+=2*Math.PI);let n=Math.abs(t-i);2*Math.PI-n<n&&(t<i?t+=2*Math.PI:i+=2*Math.PI),h.theta=t-i,r.update()},this.getDistance=()=>r.object.position.distanceTo(r.target),this.listenToKeyEvents=e=>{e.addEventListener("keydown",W),this._domElementKeyEvents=e},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",W),this._domElementKeyEvents=null},this.saveState=()=>{r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=()=>{r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(i),r.update(),s=o.NONE},this.update=(()=>{let t=new tw.Vector3,n=new tw.Vector3(0,1,0),a=new tw.Quaternion().setFromUnitVectors(e.up,n),d=a.clone().invert(),f=new tw.Vector3,m=new tw.Quaternion,p=2*Math.PI;return function(){let g=r.object.position;a.setFromUnitVectors(e.up,n),d.copy(a).invert(),t.copy(g).sub(r.target),t.applyQuaternion(a),c.setFromVector3(t),r.autoRotate&&s===o.NONE&&M(2*Math.PI/60/60*r.autoRotateSpeed),r.enableDamping?(c.theta+=h.theta*r.dampingFactor,c.phi+=h.phi*r.dampingFactor):(c.theta+=h.theta,c.phi+=h.phi);let v=r.minAzimuthAngle,y=r.maxAzimuthAngle;isFinite(v)&&isFinite(y)&&(v<-Math.PI?v+=p:v>Math.PI&&(v-=p),y<-Math.PI?y+=p:y>Math.PI&&(y-=p),v<=y?c.theta=Math.max(v,Math.min(y,c.theta)):c.theta=c.theta>(v+y)/2?Math.max(v,c.theta):Math.min(y,c.theta)),c.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,c.phi)),c.makeSafe(),!0===r.enableDamping?r.target.addScaledVector(A,r.dampingFactor):r.target.add(A),r.zoomToCursor&&w||r.object.isOrthographicCamera?c.radius=Q(c.radius):c.radius=Q(c.radius*u),t.setFromSpherical(c),t.applyQuaternion(d),g.copy(r.target).add(t),r.object.matrixAutoUpdate||r.object.updateMatrix(),r.object.lookAt(r.target),!0===r.enableDamping?(h.theta*=1-r.dampingFactor,h.phi*=1-r.dampingFactor,A.multiplyScalar(1-r.dampingFactor)):(h.set(0,0,0),A.set(0,0,0));let x=!1;if(r.zoomToCursor&&w){let i=null;if(r.object instanceof tw.PerspectiveCamera&&r.object.isPerspectiveCamera){let e=t.length();i=Q(e*u);let n=e-i;r.object.position.addScaledVector(C,n),r.object.updateMatrixWorld()}else if(r.object.isOrthographicCamera){let e=new tw.Vector3(B.x,B.y,0);e.unproject(r.object),r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/u)),r.object.updateProjectionMatrix(),x=!0;let n=new tw.Vector3(B.x,B.y,0);n.unproject(r.object),r.object.position.sub(n).add(e),r.object.updateMatrixWorld(),i=t.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),r.zoomToCursor=!1;null!==i&&(r.screenSpacePanning?r.target.set(0,0,-1).transformDirection(r.object.matrix).multiplyScalar(i).add(r.object.position):(l1.origin.copy(r.object.position),l1.direction.set(0,0,-1).transformDirection(r.object.matrix),Math.abs(r.object.up.dot(l1.direction))<l2?e.lookAt(r.target):(l0.setFromNormalAndCoplanarPoint(r.object.up,r.target),l1.intersectPlane(l0,r.target))))}else r.object instanceof tw.OrthographicCamera&&r.object.isOrthographicCamera&&(x=1!==u)&&(r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/u)),r.object.updateProjectionMatrix());return u=1,w=!1,!!(x||f.distanceToSquared(r.object.position)>l||8*(1-m.dot(r.object.quaternion))>l)&&(r.dispatchEvent(i),f.copy(r.object.position),m.copy(r.object.quaternion),x=!1,!0)}})(),this.connect=e=>{r.domElement=e,r.domElement.style.touchAction="none",r.domElement.addEventListener("contextmenu",K),r.domElement.addEventListener("pointerdown",V),r.domElement.addEventListener("pointercancel",J),r.domElement.addEventListener("wheel",Y)},this.dispose=()=>{var e,t,i,n,a,o;r.domElement&&(r.domElement.style.touchAction="auto"),null==(e=r.domElement)||e.removeEventListener("contextmenu",K),null==(t=r.domElement)||t.removeEventListener("pointerdown",V),null==(i=r.domElement)||i.removeEventListener("pointercancel",J),null==(n=r.domElement)||n.removeEventListener("wheel",Y),null==(a=r.domElement)||a.ownerDocument.removeEventListener("pointermove",j),null==(o=r.domElement)||o.ownerDocument.removeEventListener("pointerup",J),null!==r._domElementKeyEvents&&r._domElementKeyEvents.removeEventListener("keydown",W)};const r=this,i={type:"change"},n={type:"start"},a={type:"end"},o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=o.NONE;const l=1e-6,c=new tw.Spherical,h=new tw.Spherical;let u=1;const A=new tw.Vector3,d=new tw.Vector2,f=new tw.Vector2,m=new tw.Vector2,p=new tw.Vector2,g=new tw.Vector2,v=new tw.Vector2,y=new tw.Vector2,x=new tw.Vector2,E=new tw.Vector2,C=new tw.Vector3,B=new tw.Vector2;let w=!1;const I=[],b={};function _(){return Math.pow(.95,r.zoomSpeed)}function M(e){r.reverseOrbit||r.reverseHorizontalOrbit?h.theta+=e:h.theta-=e}function S(e){r.reverseOrbit||r.reverseVerticalOrbit?h.phi+=e:h.phi-=e}const T=(()=>{let e=new tw.Vector3;return function(t,r){e.setFromMatrixColumn(r,0),e.multiplyScalar(-t),A.add(e)}})(),D=(()=>{let e=new tw.Vector3;return function(t,i){!0===r.screenSpacePanning?e.setFromMatrixColumn(i,1):(e.setFromMatrixColumn(i,0),e.crossVectors(r.object.up,e)),e.multiplyScalar(t),A.add(e)}})(),F=(()=>{let e=new tw.Vector3;return function(t,i){let n=r.domElement;if(n&&r.object instanceof tw.PerspectiveCamera&&r.object.isPerspectiveCamera){let a=r.object.position;e.copy(a).sub(r.target);let o=e.length();T(2*t*(o*=Math.tan(r.object.fov/2*Math.PI/180))/n.clientHeight,r.object.matrix),D(2*i*o/n.clientHeight,r.object.matrix)}else n&&r.object instanceof tw.OrthographicCamera&&r.object.isOrthographicCamera?(T(t*(r.object.right-r.object.left)/r.object.zoom/n.clientWidth,r.object.matrix),D(i*(r.object.top-r.object.bottom)/r.object.zoom/n.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}})();function R(e){r.object instanceof tw.PerspectiveCamera&&r.object.isPerspectiveCamera||r.object instanceof tw.OrthographicCamera&&r.object.isOrthographicCamera?u=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function P(e){if(!r.zoomToCursor||!r.domElement)return;w=!0;let t=r.domElement.getBoundingClientRect(),i=e.clientX-t.left,n=e.clientY-t.top,a=t.width,o=t.height;B.x=i/a*2-1,B.y=-(n/o*2)+1,C.set(B.x,B.y,1).unproject(r.object).sub(r.object.position).normalize()}function Q(e){return Math.max(r.minDistance,Math.min(r.maxDistance,e))}function U(e){d.set(e.clientX,e.clientY)}function z(e){p.set(e.clientX,e.clientY)}function k(){if(1==I.length)d.set(I[0].pageX,I[0].pageY);else{let e=.5*(I[0].pageX+I[1].pageX),t=.5*(I[0].pageY+I[1].pageY);d.set(e,t)}}function L(){if(1==I.length)p.set(I[0].pageX,I[0].pageY);else{let e=.5*(I[0].pageX+I[1].pageX),t=.5*(I[0].pageY+I[1].pageY);p.set(e,t)}}function O(){let e=I[0].pageX-I[1].pageX,t=I[0].pageY-I[1].pageY,r=Math.sqrt(e*e+t*t);y.set(0,r)}function G(e){if(1==I.length)f.set(e.pageX,e.pageY);else{let t=q(e),r=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);f.set(r,i)}m.subVectors(f,d).multiplyScalar(r.rotateSpeed);let t=r.domElement;t&&(M(2*Math.PI*m.x/t.clientHeight),S(2*Math.PI*m.y/t.clientHeight)),d.copy(f)}function N(e){if(1==I.length)g.set(e.pageX,e.pageY);else{let t=q(e),r=.5*(e.pageX+t.x),i=.5*(e.pageY+t.y);g.set(r,i)}v.subVectors(g,p).multiplyScalar(r.panSpeed),F(v.x,v.y),p.copy(g)}function H(e){var t;let i=q(e),n=e.pageX-i.x,a=e.pageY-i.y,o=Math.sqrt(n*n+a*a);x.set(0,o),E.set(0,Math.pow(x.y/y.y,r.zoomSpeed)),t=E.y,R(u/t),y.copy(x)}function V(e){var t,i,a;!1!==r.enabled&&(0===I.length&&(null==(t=r.domElement)||t.ownerDocument.addEventListener("pointermove",j),null==(i=r.domElement)||i.ownerDocument.addEventListener("pointerup",J)),a=e,I.push(a),"touch"===e.pointerType?function(e){switch(X(e),I.length){case 1:switch(r.touches.ONE){case tw.TOUCH.ROTATE:if(!1===r.enableRotate)return;k(),s=o.TOUCH_ROTATE;break;case tw.TOUCH.PAN:if(!1===r.enablePan)return;L(),s=o.TOUCH_PAN;break;default:s=o.NONE}break;case 2:switch(r.touches.TWO){case tw.TOUCH.DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;r.enableZoom&&O(),r.enablePan&&L(),s=o.TOUCH_DOLLY_PAN;break;case tw.TOUCH.DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;r.enableZoom&&O(),r.enableRotate&&k(),s=o.TOUCH_DOLLY_ROTATE;break;default:s=o.NONE}break;default:s=o.NONE}s!==o.NONE&&r.dispatchEvent(n)}(e):function(e){let t;switch(e.button){case 0:t=r.mouseButtons.LEFT;break;case 1:t=r.mouseButtons.MIDDLE;break;case 2:t=r.mouseButtons.RIGHT;break;default:t=-1}switch(t){case tw.MOUSE.DOLLY:if(!1===r.enableZoom)return;P(e),y.set(e.clientX,e.clientY),s=o.DOLLY;break;case tw.MOUSE.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enablePan)return;z(e),s=o.PAN}else{if(!1===r.enableRotate)return;U(e),s=o.ROTATE}break;case tw.MOUSE.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===r.enableRotate)return;U(e),s=o.ROTATE}else{if(!1===r.enablePan)return;z(e),s=o.PAN}break;default:s=o.NONE}s!==o.NONE&&r.dispatchEvent(n)}(e))}function j(e){!1!==r.enabled&&("touch"===e.pointerType?function(e){switch(X(e),s){case o.TOUCH_ROTATE:if(!1===r.enableRotate)return;G(e),r.update();break;case o.TOUCH_PAN:if(!1===r.enablePan)return;N(e),r.update();break;case o.TOUCH_DOLLY_PAN:if(!1===r.enableZoom&&!1===r.enablePan)return;r.enableZoom&&H(e),r.enablePan&&N(e),r.update();break;case o.TOUCH_DOLLY_ROTATE:if(!1===r.enableZoom&&!1===r.enableRotate)return;r.enableZoom&&H(e),r.enableRotate&&G(e),r.update();break;default:s=o.NONE}}(e):function(e){if(!1!==r.enabled)switch(s){case o.ROTATE:let t;if(!1===r.enableRotate)return;f.set(e.clientX,e.clientY),m.subVectors(f,d).multiplyScalar(r.rotateSpeed),(t=r.domElement)&&(M(2*Math.PI*m.x/t.clientHeight),S(2*Math.PI*m.y/t.clientHeight)),d.copy(f),r.update();break;case o.DOLLY:var i,n;if(!1===r.enableZoom)return;(x.set(e.clientX,e.clientY),E.subVectors(x,y),E.y>0)?(i=_(),R(u/i)):E.y<0&&(n=_(),R(u*n)),y.copy(x),r.update();break;case o.PAN:if(!1===r.enablePan)return;g.set(e.clientX,e.clientY),v.subVectors(g,p).multiplyScalar(r.panSpeed),F(v.x,v.y),p.copy(g),r.update()}}(e))}function J(e){var t,i,n;(function(e){delete b[e.pointerId];for(let t=0;t<I.length;t++)if(I[t].pointerId==e.pointerId)return void I.splice(t,1)})(e),0===I.length&&(null==(t=r.domElement)||t.releasePointerCapture(e.pointerId),null==(i=r.domElement)||i.ownerDocument.removeEventListener("pointermove",j),null==(n=r.domElement)||n.ownerDocument.removeEventListener("pointerup",J)),r.dispatchEvent(a),s=o.NONE}function Y(e){if(!1!==r.enabled&&!1!==r.enableZoom&&(s===o.NONE||s===o.ROTATE)){var t,i;e.preventDefault(),r.dispatchEvent(n),(P(e),e.deltaY<0)?(t=_(),R(u*t)):e.deltaY>0&&(i=_(),R(u/i)),r.update(),r.dispatchEvent(a)}}function W(e){if(!1!==r.enabled&&!1!==r.enablePan){let t=!1;switch(e.code){case r.keys.UP:F(0,r.keyPanSpeed),t=!0;break;case r.keys.BOTTOM:F(0,-r.keyPanSpeed),t=!0;break;case r.keys.LEFT:F(r.keyPanSpeed,0),t=!0;break;case r.keys.RIGHT:F(-r.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),r.update())}}function K(e){!1!==r.enabled&&e.preventDefault()}function X(e){let t=b[e.pointerId];void 0===t&&(t=new tw.Vector2,b[e.pointerId]=t),t.set(e.pageX,e.pageY)}function q(e){return b[(e.pointerId===I[0].pointerId?I[1]:I[0]).pointerId]}this.dollyIn=(e=_())=>{R(u*e),r.update()},this.dollyOut=(e=_())=>{R(u/e),r.update()},this.getScale=()=>u,this.setScale=e=>{R(e),r.update()},this.getZoomScale=()=>_(),void 0!==t&&this.connect(t),this.update()}}class l5 extends l4{constructor(e,t){super(e,t),this.screenSpacePanning=!1,this.mouseButtons.LEFT=tw.MOUSE.PAN,this.mouseButtons.RIGHT=tw.MOUSE.ROTATE,this.touches.ONE=tw.TOUCH.PAN,this.touches.TWO=tw.TOUCH.DOLLY_ROTATE}}let l6=tC.forwardRef((e={enableDamping:!0},t)=>{let{domElement:r,camera:i,makeDefault:n,onChange:a,onStart:o,onEnd:s,...l}=e,c=(0,tI.C)(e=>e.invalidate),h=(0,tI.C)(e=>e.camera),u=(0,tI.C)(e=>e.gl),A=(0,tI.C)(e=>e.events),d=(0,tI.C)(e=>e.set),f=(0,tI.C)(e=>e.get),m=r||A.connected||u.domElement,p=i||h,g=tC.useMemo(()=>new l5(p),[p]);return tC.useEffect(()=>{g.connect(m);let e=e=>{c(),a&&a(e)};return g.addEventListener("change",e),o&&g.addEventListener("start",o),s&&g.addEventListener("end",s),()=>{g.dispose(),g.removeEventListener("change",e),o&&g.removeEventListener("start",o),s&&g.removeEventListener("end",s)}},[a,o,s,g,c,m]),tC.useEffect(()=>{if(n){let e=f().controls;return d({controls:g}),()=>d({controls:e})}},[n,g]),(0,tb.useFrame)(()=>g.update(),-1),tC.createElement("primitive",e2({ref:t,object:g,enableDamping:!0},l))});var tI=tI;let l8=tC.forwardRef(({makeDefault:e,camera:t,regress:r,domElement:i,enableDamping:n=!0,keyEvents:a=!1,onChange:o,onStart:s,onEnd:l,...c},h)=>{let u=(0,tI.C)(e=>e.invalidate),A=(0,tI.C)(e=>e.camera),d=(0,tI.C)(e=>e.gl),f=(0,tI.C)(e=>e.events),m=(0,tI.C)(e=>e.setEvents),p=(0,tI.C)(e=>e.set),g=(0,tI.C)(e=>e.get),v=(0,tI.C)(e=>e.performance),y=t||A,x=i||f.connected||d.domElement,E=tC.useMemo(()=>new l4(y),[y]);return(0,tb.useFrame)(()=>{E.enabled&&E.update()},-1),tC.useEffect(()=>(a&&E.connect(!0===a?x:a),E.connect(x),()=>void E.dispose()),[a,x,r,E,u]),tC.useEffect(()=>{let e=e=>{u(),r&&v.regress(),o&&o(e)},t=e=>{s&&s(e)},i=e=>{l&&l(e)};return E.addEventListener("change",e),E.addEventListener("start",t),E.addEventListener("end",i),()=>{E.removeEventListener("start",t),E.removeEventListener("end",i),E.removeEventListener("change",e)}},[o,s,l,E,u,m]),tC.useEffect(()=>{if(e){let e=g().controls;return p({controls:E}),()=>p({controls:e})}},[e,E]),tC.createElement("primitive",e2({ref:h,object:E,enableDamping:n},c))});var tI=tI,l9=Object.defineProperty,l7=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?l9(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r,r};class ce extends lN{constructor(e,t){super(),l7(this,"enabled",!0),l7(this,"screen",{left:0,top:0,width:0,height:0}),l7(this,"rotateSpeed",1),l7(this,"zoomSpeed",1.2),l7(this,"panSpeed",.3),l7(this,"noRotate",!1),l7(this,"noZoom",!1),l7(this,"noPan",!1),l7(this,"staticMoving",!1),l7(this,"dynamicDampingFactor",.2),l7(this,"minDistance",0),l7(this,"maxDistance",1/0),l7(this,"keys",["KeyA","KeyS","KeyD"]),l7(this,"mouseButtons",{LEFT:tw.MOUSE.ROTATE,MIDDLE:tw.MOUSE.DOLLY,RIGHT:tw.MOUSE.PAN}),l7(this,"object"),l7(this,"domElement"),l7(this,"cursorZoom",!1),l7(this,"target",new tw.Vector3),l7(this,"mousePosition",new tw.Vector2),l7(this,"STATE",{NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM_PAN:4}),l7(this,"EPS",1e-6),l7(this,"lastZoom",1),l7(this,"lastPosition",new tw.Vector3),l7(this,"cursorVector",new tw.Vector3),l7(this,"targetVector",new tw.Vector3),l7(this,"_state",this.STATE.NONE),l7(this,"_keyState",this.STATE.NONE),l7(this,"_eye",new tw.Vector3),l7(this,"_movePrev",new tw.Vector2),l7(this,"_moveCurr",new tw.Vector2),l7(this,"_lastAxis",new tw.Vector3),l7(this,"_lastAngle",0),l7(this,"_zoomStart",new tw.Vector2),l7(this,"_zoomEnd",new tw.Vector2),l7(this,"_touchZoomDistanceStart",0),l7(this,"_touchZoomDistanceEnd",0),l7(this,"_panStart",new tw.Vector2),l7(this,"_panEnd",new tw.Vector2),l7(this,"target0"),l7(this,"position0"),l7(this,"up0"),l7(this,"zoom0"),l7(this,"changeEvent",{type:"change"}),l7(this,"startEvent",{type:"start"}),l7(this,"endEvent",{type:"end"}),l7(this,"onScreenVector",new tw.Vector2),l7(this,"getMouseOnScreen",(e,t)=>(this.onScreenVector.set((e-this.screen.left)/this.screen.width,(t-this.screen.top)/this.screen.height),this.onScreenVector)),l7(this,"onCircleVector",new tw.Vector2),l7(this,"getMouseOnCircle",(e,t)=>(this.onCircleVector.set((e-.5*this.screen.width-this.screen.left)/(.5*this.screen.width),(this.screen.height+2*(this.screen.top-t))/this.screen.width),this.onCircleVector)),l7(this,"axis",new tw.Vector3),l7(this,"quaternion",new tw.Quaternion),l7(this,"eyeDirection",new tw.Vector3),l7(this,"objectUpDirection",new tw.Vector3),l7(this,"objectSidewaysDirection",new tw.Vector3),l7(this,"moveDirection",new tw.Vector3),l7(this,"angle",0),l7(this,"rotateCamera",()=>{this.moveDirection.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0),this.angle=this.moveDirection.length(),this.angle?(this._eye.copy(this.object.position).sub(this.target),this.eyeDirection.copy(this._eye).normalize(),this.objectUpDirection.copy(this.object.up).normalize(),this.objectSidewaysDirection.crossVectors(this.objectUpDirection,this.eyeDirection).normalize(),this.objectUpDirection.setLength(this._moveCurr.y-this._movePrev.y),this.objectSidewaysDirection.setLength(this._moveCurr.x-this._movePrev.x),this.moveDirection.copy(this.objectUpDirection.add(this.objectSidewaysDirection)),this.axis.crossVectors(this.moveDirection,this._eye).normalize(),this.angle*=this.rotateSpeed,this.quaternion.setFromAxisAngle(this.axis,this.angle),this._eye.applyQuaternion(this.quaternion),this.object.up.applyQuaternion(this.quaternion),this._lastAxis.copy(this.axis),this._lastAngle=this.angle):!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.target),this.quaternion.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(this.quaternion),this.object.up.applyQuaternion(this.quaternion)),this._movePrev.copy(this._moveCurr)}),l7(this,"zoomCamera",()=>{let e;if(this._state===this.STATE.TOUCH_ZOOM_PAN)e=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.isPerspectiveCamera?this._eye.multiplyScalar(e):this.object.isOrthographicCamera?(this.object.zoom/=e,this.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type");else{if(Math.abs((e=1+(this._zoomEnd.y-this._zoomStart.y)*this.zoomSpeed)-1)>this.EPS&&e>0&&(this.object.isPerspectiveCamera?(e>1&&this._eye.length()>=this.maxDistance-this.EPS&&(e=1),this._eye.multiplyScalar(e)):this.object.isOrthographicCamera?(e>1&&this.object.zoom<this.maxDistance*this.maxDistance&&(e=1),this.object.zoom/=e):console.warn("THREE.TrackballControls: Unsupported camera type")),this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor,this.cursorZoom){this.targetVector.copy(this.target).project(this.object);let t=this.cursorVector.set(this.mousePosition.x,this.mousePosition.y,this.targetVector.z).unproject(this.object);this.target.lerpVectors(t,this.target,e)}this.object.isOrthographicCamera&&this.object.updateProjectionMatrix()}}),l7(this,"mouseChange",new tw.Vector2),l7(this,"objectUp",new tw.Vector3),l7(this,"pan",new tw.Vector3),l7(this,"panCamera",()=>{if(this.domElement&&(this.mouseChange.copy(this._panEnd).sub(this._panStart),this.mouseChange.lengthSq()>this.EPS)){if(this.object.isOrthographicCamera){let e=this.object,t=(e.right-e.left)/this.object.zoom,r=(e.top-e.bottom)/this.object.zoom;this.mouseChange.x*=t,this.mouseChange.y*=r}else this.mouseChange.multiplyScalar(this._eye.length()*this.panSpeed);this.pan.copy(this._eye).cross(this.object.up).setLength(this.mouseChange.x),this.pan.add(this.objectUp.copy(this.object.up).setLength(this.mouseChange.y)),this.object.position.add(this.pan),this.target.add(this.pan),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(this.mouseChange.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}),l7(this,"checkDistances",()=>{this.noZoom&&this.noPan||(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.target,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}),l7(this,"handleResize",()=>{if(!this.domElement)return;let e=this.domElement.getBoundingClientRect(),t=this.domElement.ownerDocument.documentElement;this.screen.left=e.left+window.pageXOffset-t.clientLeft,this.screen.top=e.top+window.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}),l7(this,"update",()=>{this._eye.subVectors(this.object.position,this.target),this.noRotate||this.rotateCamera(),this.noZoom||this.zoomCamera(),this.noPan||this.panCamera(),this.object.position.addVectors(this.target,this._eye),this.object.isPerspectiveCamera?(this.checkDistances(),this.object.lookAt(this.target),this.lastPosition.distanceToSquared(this.object.position)>this.EPS&&(this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position))):this.object.isOrthographicCamera?(this.object.lookAt(this.target),(this.lastPosition.distanceToSquared(this.object.position)>this.EPS||this.lastZoom!==this.object.zoom)&&(this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position),this.lastZoom=this.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")}),l7(this,"reset",()=>{this._state=this.STATE.NONE,this._keyState=this.STATE.NONE,this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.up.copy(this.up0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this._eye.subVectors(this.object.position,this.target),this.object.lookAt(this.target),this.dispatchEvent(this.changeEvent),this.lastPosition.copy(this.object.position),this.lastZoom=this.object.zoom}),l7(this,"keydown",e=>{!1!==this.enabled&&(window.removeEventListener("keydown",this.keydown),this._keyState===this.STATE.NONE&&(e.code!==this.keys[this.STATE.ROTATE]||this.noRotate?e.code!==this.keys[this.STATE.ZOOM]||this.noZoom?e.code!==this.keys[this.STATE.PAN]||this.noPan||(this._keyState=this.STATE.PAN):this._keyState=this.STATE.ZOOM:this._keyState=this.STATE.ROTATE))}),l7(this,"onPointerDown",e=>{if(!1!==this.enabled)switch(e.pointerType){case"mouse":case"pen":this.onMouseDown(e)}}),l7(this,"onPointerMove",e=>{if(!1!==this.enabled)switch(e.pointerType){case"mouse":case"pen":this.onMouseMove(e)}}),l7(this,"onPointerUp",e=>{if(!1!==this.enabled)switch(e.pointerType){case"mouse":case"pen":this.onMouseUp()}}),l7(this,"keyup",()=>{!1!==this.enabled&&(this._keyState=this.STATE.NONE,window.addEventListener("keydown",this.keydown))}),l7(this,"onMouseDown",e=>{if(!this.domElement)return;if(this._state===this.STATE.NONE)switch(e.button){case this.mouseButtons.LEFT:this._state=this.STATE.ROTATE;break;case this.mouseButtons.MIDDLE:this._state=this.STATE.ZOOM;break;case this.mouseButtons.RIGHT:this._state=this.STATE.PAN}let t=this._keyState!==this.STATE.NONE?this._keyState:this._state;t!==this.STATE.ROTATE||this.noRotate?t!==this.STATE.ZOOM||this.noZoom?t!==this.STATE.PAN||this.noPan||(this._panStart.copy(this.getMouseOnScreen(e.pageX,e.pageY)),this._panEnd.copy(this._panStart)):(this._zoomStart.copy(this.getMouseOnScreen(e.pageX,e.pageY)),this._zoomEnd.copy(this._zoomStart)):(this._moveCurr.copy(this.getMouseOnCircle(e.pageX,e.pageY)),this._movePrev.copy(this._moveCurr)),this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),this.dispatchEvent(this.startEvent)}),l7(this,"onMouseMove",e=>{if(!1===this.enabled)return;let t=this._keyState!==this.STATE.NONE?this._keyState:this._state;t!==this.STATE.ROTATE||this.noRotate?t!==this.STATE.ZOOM||this.noZoom?t!==this.STATE.PAN||this.noPan||this._panEnd.copy(this.getMouseOnScreen(e.pageX,e.pageY)):this._zoomEnd.copy(this.getMouseOnScreen(e.pageX,e.pageY)):(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this.getMouseOnCircle(e.pageX,e.pageY)))}),l7(this,"onMouseUp",()=>{this.domElement&&!1!==this.enabled&&(this._state=this.STATE.NONE,this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),this.dispatchEvent(this.endEvent))}),l7(this,"mousewheel",e=>{if(!1!==this.enabled&&!0!==this.noZoom){switch(e.preventDefault(),e.deltaMode){case 2:this._zoomStart.y-=.025*e.deltaY;break;case 1:this._zoomStart.y-=.01*e.deltaY;break;default:this._zoomStart.y-=25e-5*e.deltaY}this.mousePosition.x=e.offsetX/this.screen.width*2-1,this.mousePosition.y=-(2*(e.offsetY/this.screen.height))+1,this.dispatchEvent(this.startEvent),this.dispatchEvent(this.endEvent)}}),l7(this,"touchstart",e=>{if(!1!==this.enabled){if(e.preventDefault(),1===e.touches.length)this._state=this.STATE.TOUCH_ROTATE,this._moveCurr.copy(this.getMouseOnCircle(e.touches[0].pageX,e.touches[0].pageY)),this._movePrev.copy(this._moveCurr);else{this._state=this.STATE.TOUCH_ZOOM_PAN;let t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(t*t+r*r);let i=(e.touches[0].pageX+e.touches[1].pageX)/2,n=(e.touches[0].pageY+e.touches[1].pageY)/2;this._panStart.copy(this.getMouseOnScreen(i,n)),this._panEnd.copy(this._panStart)}this.dispatchEvent(this.startEvent)}}),l7(this,"touchmove",e=>{if(!1!==this.enabled)if(e.preventDefault(),1===e.touches.length)this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this.getMouseOnCircle(e.touches[0].pageX,e.touches[0].pageY));else{let t=e.touches[0].pageX-e.touches[1].pageX,r=e.touches[0].pageY-e.touches[1].pageY;this._touchZoomDistanceEnd=Math.sqrt(t*t+r*r);let i=(e.touches[0].pageX+e.touches[1].pageX)/2,n=(e.touches[0].pageY+e.touches[1].pageY)/2;this._panEnd.copy(this.getMouseOnScreen(i,n))}}),l7(this,"touchend",e=>{if(!1!==this.enabled){switch(e.touches.length){case 0:this._state=this.STATE.NONE;break;case 1:this._state=this.STATE.TOUCH_ROTATE,this._moveCurr.copy(this.getMouseOnCircle(e.touches[0].pageX,e.touches[0].pageY)),this._movePrev.copy(this._moveCurr)}this.dispatchEvent(this.endEvent)}}),l7(this,"contextmenu",e=>{!1!==this.enabled&&e.preventDefault()}),l7(this,"connect",e=>{e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=e,this.domElement.addEventListener("contextmenu",this.contextmenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("wheel",this.mousewheel),this.domElement.addEventListener("touchstart",this.touchstart),this.domElement.addEventListener("touchend",this.touchend),this.domElement.addEventListener("touchmove",this.touchmove),this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp),window.addEventListener("keydown",this.keydown),window.addEventListener("keyup",this.keyup),this.handleResize()}),l7(this,"dispose",()=>{this.domElement&&(this.domElement.removeEventListener("contextmenu",this.contextmenu),this.domElement.removeEventListener("pointerdown",this.onPointerDown),this.domElement.removeEventListener("wheel",this.mousewheel),this.domElement.removeEventListener("touchstart",this.touchstart),this.domElement.removeEventListener("touchend",this.touchend),this.domElement.removeEventListener("touchmove",this.touchmove),this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.domElement.ownerDocument.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("keydown",this.keydown),window.removeEventListener("keyup",this.keyup))}),this.object=e,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom,void 0!==t&&this.connect(t),this.update()}}let ct=tC.forwardRef(({makeDefault:e,camera:t,domElement:r,regress:i,onChange:n,onStart:a,onEnd:o,...s},l)=>{let{invalidate:c,camera:h,gl:u,events:A,set:d,get:f,performance:m,viewport:p}=(0,tI.C)(),g=t||h,v=r||A.connected||u.domElement,y=tC.useMemo(()=>new ce(g),[g]);return(0,tb.useFrame)(()=>{y.enabled&&y.update()},-1),tC.useEffect(()=>(y.connect(v),()=>void y.dispose()),[v,i,y,c]),tC.useEffect(()=>{let e=e=>{c(),i&&m.regress(),n&&n(e)};return y.addEventListener("change",e),a&&y.addEventListener("start",a),o&&y.addEventListener("end",o),()=>{a&&y.removeEventListener("start",a),o&&y.removeEventListener("end",o),y.removeEventListener("change",e)}},[n,a,o,y,c]),tC.useEffect(()=>{y.handleResize()},[p]),tC.useEffect(()=>{if(e){let e=f().controls;return d({controls:y}),()=>d({controls:e})}},[e,y]),tC.createElement("primitive",e2({ref:l,object:y},s))});var tI=tI,cr=Object.defineProperty,ci=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?cr(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r,r};let cn={IDLE:Symbol(),ROTATE:Symbol(),PAN:Symbol(),SCALE:Symbol(),FOV:Symbol(),FOCUS:Symbol(),ZROTATE:Symbol(),TOUCH_MULTI:Symbol(),ANIMATION_FOCUS:Symbol(),ANIMATION_ROTATE:Symbol()},ca={NONE:Symbol(),ONE_FINGER:Symbol(),ONE_FINGER_SWITCHED:Symbol(),TWO_FINGER:Symbol(),MULT_FINGER:Symbol(),CURSOR:Symbol()},co={x:0,y:0},cs={camera:new tw.Matrix4,gizmos:new tw.Matrix4},cl={type:"change"},cc={type:"start"},ch={type:"end"};class cu extends lN{constructor(e,t=null,r=null){super(),ci(this,"camera"),ci(this,"domElement"),ci(this,"scene"),ci(this,"mouseActions"),ci(this,"_mouseOp"),ci(this,"_v2_1"),ci(this,"_v3_1"),ci(this,"_v3_2"),ci(this,"_m4_1"),ci(this,"_m4_2"),ci(this,"_quat"),ci(this,"_translationMatrix"),ci(this,"_rotationMatrix"),ci(this,"_scaleMatrix"),ci(this,"_rotationAxis"),ci(this,"_cameraMatrixState"),ci(this,"_cameraProjectionState"),ci(this,"_fovState"),ci(this,"_upState"),ci(this,"_zoomState"),ci(this,"_nearPos"),ci(this,"_farPos"),ci(this,"_gizmoMatrixState"),ci(this,"_up0"),ci(this,"_zoom0"),ci(this,"_fov0"),ci(this,"_initialNear"),ci(this,"_nearPos0"),ci(this,"_initialFar"),ci(this,"_farPos0"),ci(this,"_cameraMatrixState0"),ci(this,"_gizmoMatrixState0"),ci(this,"_button"),ci(this,"_touchStart"),ci(this,"_touchCurrent"),ci(this,"_input"),ci(this,"_switchSensibility"),ci(this,"_startFingerDistance"),ci(this,"_currentFingerDistance"),ci(this,"_startFingerRotation"),ci(this,"_currentFingerRotation"),ci(this,"_devPxRatio"),ci(this,"_downValid"),ci(this,"_nclicks"),ci(this,"_downEvents"),ci(this,"_clickStart"),ci(this,"_maxDownTime"),ci(this,"_maxInterval"),ci(this,"_posThreshold"),ci(this,"_movementThreshold"),ci(this,"_currentCursorPosition"),ci(this,"_startCursorPosition"),ci(this,"_grid"),ci(this,"_gridPosition"),ci(this,"_gizmos"),ci(this,"_curvePts"),ci(this,"_timeStart"),ci(this,"_animationId"),ci(this,"focusAnimationTime"),ci(this,"_timePrev"),ci(this,"_timeCurrent"),ci(this,"_anglePrev"),ci(this,"_angleCurrent"),ci(this,"_cursorPosPrev"),ci(this,"_cursorPosCurr"),ci(this,"_wPrev"),ci(this,"_wCurr"),ci(this,"adjustNearFar"),ci(this,"scaleFactor"),ci(this,"dampingFactor"),ci(this,"wMax"),ci(this,"enableAnimations"),ci(this,"enableGrid"),ci(this,"cursorZoom"),ci(this,"minFov"),ci(this,"maxFov"),ci(this,"enabled"),ci(this,"enablePan"),ci(this,"enableRotate"),ci(this,"enableZoom"),ci(this,"minDistance"),ci(this,"maxDistance"),ci(this,"minZoom"),ci(this,"maxZoom"),ci(this,"target"),ci(this,"_currentTarget"),ci(this,"_tbRadius"),ci(this,"_state"),ci(this,"onWindowResize",()=>{let e=(this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3;if(this.camera){let e=this.calculateTbRadius(this.camera);void 0!==e&&(this._tbRadius=e)}let t=this._tbRadius/e,r=new tw.EllipseCurve(0,0,t,t).getPoints(this._curvePts),i=new tw.BufferGeometry().setFromPoints(r);for(let e in this._gizmos.children)this._gizmos.children[e].geometry=i;this.dispatchEvent(cl)}),ci(this,"onContextMenu",e=>{if(this.enabled){for(let t=0;t<this.mouseActions.length;t++)if(2==this.mouseActions[t].mouse){e.preventDefault();break}}}),ci(this,"onPointerCancel",()=>{this._touchStart.splice(0,this._touchStart.length),this._touchCurrent.splice(0,this._touchCurrent.length),this._input=ca.NONE}),ci(this,"onPointerDown",e=>{if(0==e.button&&e.isPrimary?(this._downValid=!0,this._downEvents.push(e)):this._downValid=!1,"touch"==e.pointerType&&this._input!=ca.CURSOR)switch(this._touchStart.push(e),this._touchCurrent.push(e),this._input){case ca.NONE:this._input=ca.ONE_FINGER,this.onSinglePanStart(e,"ROTATE"),window.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerup",this.onPointerUp);break;case ca.ONE_FINGER:case ca.ONE_FINGER_SWITCHED:this._input=ca.TWO_FINGER,this.onRotateStart(),this.onPinchStart(),this.onDoublePanStart();break;case ca.TWO_FINGER:this._input=ca.MULT_FINGER,this.onTriplePanStart()}else if("touch"!=e.pointerType&&this._input==ca.NONE){let t=null;e.ctrlKey||e.metaKey?t="CTRL":e.shiftKey&&(t="SHIFT"),this._mouseOp=this.getOpFromAction(e.button,t),this._mouseOp&&(window.addEventListener("pointermove",this.onPointerMove),window.addEventListener("pointerup",this.onPointerUp),this._input=ca.CURSOR,this._button=e.button,this.onSinglePanStart(e,this._mouseOp))}}),ci(this,"onPointerMove",e=>{if("touch"==e.pointerType&&this._input!=ca.CURSOR)switch(this._input){case ca.ONE_FINGER:this.updateTouchEvent(e),this.onSinglePanMove(e,cn.ROTATE);break;case ca.ONE_FINGER_SWITCHED:this.calculatePointersDistance(this._touchCurrent[0],e)*this._devPxRatio>=this._switchSensibility&&(this._input=ca.ONE_FINGER,this.updateTouchEvent(e),this.onSinglePanStart(e,"ROTATE"));break;case ca.TWO_FINGER:this.updateTouchEvent(e),this.onRotateMove(),this.onPinchMove(),this.onDoublePanMove();break;case ca.MULT_FINGER:this.updateTouchEvent(e),this.onTriplePanMove()}else if("touch"!=e.pointerType&&this._input==ca.CURSOR){let t=null;e.ctrlKey||e.metaKey?t="CTRL":e.shiftKey&&(t="SHIFT");let r=this.getOpStateFromAction(this._button,t);r&&this.onSinglePanMove(e,r)}this._downValid&&this.calculatePointersDistance(this._downEvents[this._downEvents.length-1],e)*this._devPxRatio>this._movementThreshold&&(this._downValid=!1)}),ci(this,"onPointerUp",e=>{if("touch"==e.pointerType&&this._input!=ca.CURSOR){let t=this._touchCurrent.length;for(let r=0;r<t;r++)if(this._touchCurrent[r].pointerId==e.pointerId){this._touchCurrent.splice(r,1),this._touchStart.splice(r,1);break}switch(this._input){case ca.ONE_FINGER:case ca.ONE_FINGER_SWITCHED:window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=ca.NONE,this.onSinglePanEnd();break;case ca.TWO_FINGER:this.onDoublePanEnd(),this.onPinchEnd(),this.onRotateEnd(),this._input=ca.ONE_FINGER_SWITCHED;break;case ca.MULT_FINGER:0==this._touchCurrent.length&&(window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=ca.NONE,this.onTriplePanEnd())}}else"touch"!=e.pointerType&&this._input==ca.CURSOR&&(window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),this._input=ca.NONE,this.onSinglePanEnd(),this._button=-1);if(e.isPrimary)if(this._downValid)if(e.timeStamp-this._downEvents[this._downEvents.length-1].timeStamp<=this._maxDownTime)if(0==this._nclicks)this._nclicks=1,this._clickStart=performance.now();else{let t=e.timeStamp-this._clickStart,r=this.calculatePointersDistance(this._downEvents[1],this._downEvents[0])*this._devPxRatio;t<=this._maxInterval&&r<=this._posThreshold?(this._nclicks=0,this._downEvents.splice(0,this._downEvents.length),this.onDoubleTap(e)):(this._nclicks=1,this._downEvents.shift(),this._clickStart=performance.now())}else this._downValid=!1,this._nclicks=0,this._downEvents.splice(0,this._downEvents.length);else this._nclicks=0,this._downEvents.splice(0,this._downEvents.length)}),ci(this,"onWheel",e=>{var t,r;if(this.enabled&&this.enableZoom&&this.domElement){let i=null;e.ctrlKey||e.metaKey?i="CTRL":e.shiftKey&&(i="SHIFT");let n=this.getOpFromAction("WHEEL",i);if(n){e.preventDefault(),this.dispatchEvent(cc);let i=e.deltaY/125,a=1;switch(i>0?a=1/this.scaleFactor:i<0&&(a=this.scaleFactor),n){case"ZOOM":if(this.updateTbState(cn.SCALE,!0),i>0?a=1/Math.pow(this.scaleFactor,i):i<0&&(a=Math.pow(this.scaleFactor,-i)),this.cursorZoom&&this.enablePan){let i;this.camera instanceof tw.OrthographicCamera&&(i=null==(t=this.unprojectOnTbPlane(this.camera,e.clientX,e.clientY,this.domElement))?void 0:t.applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._gizmos.position)),this.camera instanceof tw.PerspectiveCamera&&(i=null==(r=this.unprojectOnTbPlane(this.camera,e.clientX,e.clientY,this.domElement))?void 0:r.applyQuaternion(this.camera.quaternion).add(this._gizmos.position)),void 0!==i&&this.applyTransformMatrix(this.applyScale(a,i))}else this.applyTransformMatrix(this.applyScale(a,this._gizmos.position));this._grid&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(cn.IDLE,!1),this.dispatchEvent(cl),this.dispatchEvent(ch);break;case"FOV":if(this.camera instanceof tw.PerspectiveCamera){this.updateTbState(cn.FOV,!0),0!=e.deltaX&&(i=e.deltaX/125,a=1,i>0?a=1/Math.pow(this.scaleFactor,i):i<0&&(a=Math.pow(this.scaleFactor,-i))),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);let t=this._v3_1.distanceTo(this._gizmos.position),r=t/a;r=tw.MathUtils.clamp(r,this.minDistance,this.maxDistance);let n=t*Math.tan(tw.MathUtils.DEG2RAD*this.camera.fov*.5),o=tw.MathUtils.RAD2DEG*(2*Math.atan(n/r));o>this.maxFov?o=this.maxFov:o<this.minFov&&(o=this.minFov),a=t/(n/Math.tan(tw.MathUtils.DEG2RAD*(o/2))),this.setFov(o),this.applyTransformMatrix(this.applyScale(a,this._gizmos.position,!1))}this._grid&&(this.disposeGrid(),this.drawGrid()),this.updateTbState(cn.IDLE,!1),this.dispatchEvent(cl),this.dispatchEvent(ch)}}}}),ci(this,"onSinglePanStart",(e,t)=>{if(this.enabled&&this.domElement)switch(this.dispatchEvent(cc),this.setCenter(e.clientX,e.clientY),t){case"PAN":if(!this.enablePan)return;if(-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(cl)),this.camera){this.updateTbState(cn.PAN,!0);let e=this.unprojectOnTbPlane(this.camera,co.x,co.y,this.domElement);void 0!==e&&this._startCursorPosition.copy(e),this.enableGrid&&(this.drawGrid(),this.dispatchEvent(cl))}break;case"ROTATE":if(!this.enableRotate)return;if(-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1),this.camera){this.updateTbState(cn.ROTATE,!0);let e=this.unprojectOnTbSurface(this.camera,co.x,co.y,this.domElement,this._tbRadius);void 0!==e&&this._startCursorPosition.copy(e),this.activateGizmos(!0),this.enableAnimations&&(this._timePrev=this._timeCurrent=performance.now(),this._angleCurrent=this._anglePrev=0,this._cursorPosPrev.copy(this._startCursorPosition),this._cursorPosCurr.copy(this._cursorPosPrev),this._wCurr=0,this._wPrev=this._wCurr)}this.dispatchEvent(cl);break;case"FOV":if(!this.enableZoom)return;this.camera instanceof tw.PerspectiveCamera&&(-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(cl)),this.updateTbState(cn.FOV,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(co.x,co.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition));break;case"ZOOM":if(!this.enableZoom)return;-1!=this._animationId&&(cancelAnimationFrame(this._animationId),this._animationId=-1,this._timeStart=-1,this.activateGizmos(!1),this.dispatchEvent(cl)),this.updateTbState(cn.SCALE,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(co.x,co.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition)}}),ci(this,"onSinglePanMove",(e,t)=>{if(this.enabled&&this.domElement){let r=t!=this._state;switch(this.setCenter(e.clientX,e.clientY),t){case cn.PAN:if(this.enablePan&&this.camera)if(r){this.dispatchEvent(ch),this.dispatchEvent(cc),this.updateTbState(t,!0);let e=this.unprojectOnTbPlane(this.camera,co.x,co.y,this.domElement);void 0!==e&&this._startCursorPosition.copy(e),this.enableGrid&&this.drawGrid(),this.activateGizmos(!1)}else{let e=this.unprojectOnTbPlane(this.camera,co.x,co.y,this.domElement);void 0!==e&&this._currentCursorPosition.copy(e),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition))}break;case cn.ROTATE:if(this.enableRotate&&this.camera)if(r){this.dispatchEvent(ch),this.dispatchEvent(cc),this.updateTbState(t,!0);let e=this.unprojectOnTbSurface(this.camera,co.x,co.y,this.domElement,this._tbRadius);void 0!==e&&this._startCursorPosition.copy(e),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!0)}else{let e=this.unprojectOnTbSurface(this.camera,co.x,co.y,this.domElement,this._tbRadius);void 0!==e&&this._currentCursorPosition.copy(e);let t=this._startCursorPosition.distanceTo(this._currentCursorPosition),r=this._startCursorPosition.angleTo(this._currentCursorPosition),i=Math.max(t/this._tbRadius,r);this.applyTransformMatrix(this.rotate(this.calculateRotationAxis(this._startCursorPosition,this._currentCursorPosition),i)),this.enableAnimations&&(this._timePrev=this._timeCurrent,this._timeCurrent=performance.now(),this._anglePrev=this._angleCurrent,this._angleCurrent=i,this._cursorPosPrev.copy(this._cursorPosCurr),this._cursorPosCurr.copy(this._currentCursorPosition),this._wPrev=this._wCurr,this._wCurr=this.calculateAngularSpeed(this._anglePrev,this._angleCurrent,this._timePrev,this._timeCurrent))}break;case cn.SCALE:if(this.enableZoom)if(r)this.dispatchEvent(ch),this.dispatchEvent(cc),this.updateTbState(t,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(co.x,co.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{this._currentCursorPosition.setY(.5*this.getCursorNDC(co.x,co.y,this.domElement).y);let e=this._currentCursorPosition.y-this._startCursorPosition.y,t=1;e<0?t=1/Math.pow(this.scaleFactor,-(8*e)):e>0&&(t=Math.pow(this.scaleFactor,8*e)),this.applyTransformMatrix(this.applyScale(t,this._gizmos.position))}break;case cn.FOV:if(this.enableZoom&&this.camera instanceof tw.PerspectiveCamera)if(r)this.dispatchEvent(ch),this.dispatchEvent(cc),this.updateTbState(t,!0),this._startCursorPosition.setY(.5*this.getCursorNDC(co.x,co.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1);else{this._currentCursorPosition.setY(.5*this.getCursorNDC(co.x,co.y,this.domElement).y);let e=this._currentCursorPosition.y-this._startCursorPosition.y,t=1;e<0?t=1/Math.pow(this.scaleFactor,-(8*e)):e>0&&(t=Math.pow(this.scaleFactor,8*e)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);let r=this._v3_1.distanceTo(this._gizmos.position),i=r/t;i=tw.MathUtils.clamp(i,this.minDistance,this.maxDistance);let n=r*Math.tan(tw.MathUtils.DEG2RAD*this._fovState*.5),a=tw.MathUtils.RAD2DEG*(2*Math.atan(n/i));a=tw.MathUtils.clamp(a,this.minFov,this.maxFov);let o=n/Math.tan(tw.MathUtils.DEG2RAD*(a/2));t=r/o,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(a),this.applyTransformMatrix(this.applyScale(t,this._v3_2,!1));let s=this._gizmos.position.clone().sub(this.camera.position).normalize().multiplyScalar(o/r);this._m4_1.makeTranslation(s.x,s.y,s.z)}}this.dispatchEvent(cl)}}),ci(this,"onSinglePanEnd",()=>{if(this._state==cn.ROTATE){if(!this.enableRotate)return;if(this.enableAnimations)if(performance.now()-this._timeCurrent<120){let e=Math.abs((this._wPrev+this._wCurr)/2),t=this;this._animationId=window.requestAnimationFrame(function(r){t.updateTbState(cn.ANIMATION_ROTATE,!0);let i=t.calculateRotationAxis(t._cursorPosPrev,t._cursorPosCurr);t.onRotationAnim(r,i,Math.min(e,t.wMax))})}else this.updateTbState(cn.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(cl);else this.updateTbState(cn.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(cl)}else(this._state==cn.PAN||this._state==cn.IDLE)&&(this.updateTbState(cn.IDLE,!1),this.enableGrid&&this.disposeGrid(),this.activateGizmos(!1),this.dispatchEvent(cl));this.dispatchEvent(ch)}),ci(this,"onDoubleTap",e=>{if(this.enabled&&this.enablePan&&this.scene&&this.camera&&this.domElement){this.dispatchEvent(cc),this.setCenter(e.clientX,e.clientY);let t=this.unprojectOnObj(this.getCursorNDC(co.x,co.y,this.domElement),this.camera);if(t&&this.enableAnimations){let e=this;-1!=this._animationId&&window.cancelAnimationFrame(this._animationId),this._timeStart=-1,this._animationId=window.requestAnimationFrame(function(r){e.updateTbState(cn.ANIMATION_FOCUS,!0),e.onFocusAnim(r,t,e._cameraMatrixState,e._gizmoMatrixState)})}else t&&!this.enableAnimations&&(this.updateTbState(cn.FOCUS,!0),this.focus(t,this.scaleFactor),this.updateTbState(cn.IDLE,!1),this.dispatchEvent(cl))}this.dispatchEvent(ch)}),ci(this,"onDoublePanStart",()=>{if(this.enabled&&this.enablePan&&this.camera&&this.domElement){this.dispatchEvent(cc),this.updateTbState(cn.PAN,!0),this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2);let e=this.unprojectOnTbPlane(this.camera,co.x,co.y,this.domElement,!0);void 0!==e&&this._startCursorPosition.copy(e),this._currentCursorPosition.copy(this._startCursorPosition),this.activateGizmos(!1)}}),ci(this,"onDoublePanMove",()=>{if(this.enabled&&this.enablePan&&this.camera&&this.domElement){this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._state!=cn.PAN&&(this.updateTbState(cn.PAN,!0),this._startCursorPosition.copy(this._currentCursorPosition));let e=this.unprojectOnTbPlane(this.camera,co.x,co.y,this.domElement,!0);void 0!==e&&this._currentCursorPosition.copy(e),this.applyTransformMatrix(this.pan(this._startCursorPosition,this._currentCursorPosition,!0)),this.dispatchEvent(cl)}}),ci(this,"onDoublePanEnd",()=>{this.updateTbState(cn.IDLE,!1),this.dispatchEvent(ch)}),ci(this,"onRotateStart",()=>{var e;this.enabled&&this.enableRotate&&(this.dispatchEvent(cc),this.updateTbState(cn.ZROTATE,!0),this._startFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this._currentFingerRotation=this._startFingerRotation,null==(e=this.camera)||e.getWorldDirection(this._rotationAxis),this.enablePan||this.enableZoom||this.activateGizmos(!0))}),ci(this,"onRotateMove",()=>{var e;if(this.enabled&&this.enableRotate&&this.camera&&this.domElement){let t;this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._state!=cn.ZROTATE&&(this.updateTbState(cn.ZROTATE,!0),this._startFingerRotation=this._currentFingerRotation),this._currentFingerRotation=this.getAngle(this._touchCurrent[1],this._touchCurrent[0])+this.getAngle(this._touchStart[1],this._touchStart[0]),this.enablePan?this.camera&&(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),t=null==(e=this.unprojectOnTbPlane(this.camera,co.x,co.y,this.domElement))?void 0:e.applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._v3_2)):t=new tw.Vector3().setFromMatrixPosition(this._gizmoMatrixState);let r=tw.MathUtils.DEG2RAD*(this._startFingerRotation-this._currentFingerRotation);void 0!==t&&this.applyTransformMatrix(this.zRotate(t,r)),this.dispatchEvent(cl)}}),ci(this,"onRotateEnd",()=>{this.updateTbState(cn.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(ch)}),ci(this,"onPinchStart",()=>{this.enabled&&this.enableZoom&&(this.dispatchEvent(cc),this.updateTbState(cn.SCALE,!0),this._startFingerDistance=this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),this._currentFingerDistance=this._startFingerDistance,this.activateGizmos(!1))}),ci(this,"onPinchMove",()=>{var e,t;if(this.enabled&&this.enableZoom&&this.domElement){let r;this.setCenter((this._touchCurrent[0].clientX+this._touchCurrent[1].clientX)/2,(this._touchCurrent[0].clientY+this._touchCurrent[1].clientY)/2),this._state!=cn.SCALE&&(this._startFingerDistance=this._currentFingerDistance,this.updateTbState(cn.SCALE,!0)),this._currentFingerDistance=Math.max(this.calculatePointersDistance(this._touchCurrent[0],this._touchCurrent[1]),12*this._devPxRatio);let i=this._currentFingerDistance/this._startFingerDistance;this.enablePan?this.camera instanceof tw.OrthographicCamera?r=null==(e=this.unprojectOnTbPlane(this.camera,co.x,co.y,this.domElement))?void 0:e.applyQuaternion(this.camera.quaternion).multiplyScalar(1/this.camera.zoom).add(this._gizmos.position):this.camera instanceof tw.PerspectiveCamera&&(r=null==(t=this.unprojectOnTbPlane(this.camera,co.x,co.y,this.domElement))?void 0:t.applyQuaternion(this.camera.quaternion).add(this._gizmos.position)):r=this._gizmos.position,void 0!==r&&this.applyTransformMatrix(this.applyScale(i,r)),this.dispatchEvent(cl)}}),ci(this,"onPinchEnd",()=>{this.updateTbState(cn.IDLE,!1),this.dispatchEvent(ch)}),ci(this,"onTriplePanStart",()=>{if(this.enabled&&this.enableZoom&&this.domElement){this.dispatchEvent(cc),this.updateTbState(cn.SCALE,!0);let e=0,t=0,r=this._touchCurrent.length;for(let i=0;i<r;i++)e+=this._touchCurrent[i].clientX,t+=this._touchCurrent[i].clientY;this.setCenter(e/r,t/r),this._startCursorPosition.setY(.5*this.getCursorNDC(co.x,co.y,this.domElement).y),this._currentCursorPosition.copy(this._startCursorPosition)}}),ci(this,"onTriplePanMove",()=>{if(this.enabled&&this.enableZoom&&this.camera&&this.domElement){let e=0,t=0,r=this._touchCurrent.length;for(let i=0;i<r;i++)e+=this._touchCurrent[i].clientX,t+=this._touchCurrent[i].clientY;this.setCenter(e/r,t/r),this._currentCursorPosition.setY(.5*this.getCursorNDC(co.x,co.y,this.domElement).y);let i=this._currentCursorPosition.y-this._startCursorPosition.y,n=1;i<0?n=1/Math.pow(this.scaleFactor,-(8*i)):i>0&&(n=Math.pow(this.scaleFactor,8*i)),this._v3_1.setFromMatrixPosition(this._cameraMatrixState);let a=this._v3_1.distanceTo(this._gizmos.position),o=a/n;o=tw.MathUtils.clamp(o,this.minDistance,this.maxDistance);let s=a*Math.tan(tw.MathUtils.DEG2RAD*this._fovState*.5),l=tw.MathUtils.RAD2DEG*(2*Math.atan(s/o));l=tw.MathUtils.clamp(l,this.minFov,this.maxFov);let c=s/Math.tan(tw.MathUtils.DEG2RAD*(l/2));n=a/c,this._v3_2.setFromMatrixPosition(this._gizmoMatrixState),this.setFov(l),this.applyTransformMatrix(this.applyScale(n,this._v3_2,!1));let h=this._gizmos.position.clone().sub(this.camera.position).normalize().multiplyScalar(c/a);this._m4_1.makeTranslation(h.x,h.y,h.z),this.dispatchEvent(cl)}}),ci(this,"onTriplePanEnd",()=>{this.updateTbState(cn.IDLE,!1),this.dispatchEvent(ch)}),ci(this,"setCenter",(e,t)=>{co.x=e,co.y=t}),ci(this,"initializeMouseActions",()=>{this.setMouseAction("PAN",0,"CTRL"),this.setMouseAction("PAN",2),this.setMouseAction("ROTATE",0),this.setMouseAction("ZOOM","WHEEL"),this.setMouseAction("ZOOM",1),this.setMouseAction("FOV","WHEEL","SHIFT"),this.setMouseAction("FOV",1,"SHIFT")}),ci(this,"setMouseAction",(e,t,r=null)=>{let i;if(!["PAN","ROTATE","ZOOM","FOV"].includes(e)||![0,1,2,"WHEEL"].includes(t)||!["CTRL","SHIFT",null].includes(r)||"WHEEL"==t&&"ZOOM"!=e&&"FOV"!=e)return!1;switch(e){case"PAN":i=cn.PAN;break;case"ROTATE":i=cn.ROTATE;break;case"ZOOM":i=cn.SCALE;break;case"FOV":i=cn.FOV}let n={operation:e,mouse:t,key:r,state:i};for(let e=0;e<this.mouseActions.length;e++)if(this.mouseActions[e].mouse==n.mouse&&this.mouseActions[e].key==n.key)return this.mouseActions.splice(e,1,n),!0;return this.mouseActions.push(n),!0}),ci(this,"getOpFromAction",(e,t)=>{let r;for(let i=0;i<this.mouseActions.length;i++)if((r=this.mouseActions[i]).mouse==e&&r.key==t)return r.operation;if(t){for(let t=0;t<this.mouseActions.length;t++)if((r=this.mouseActions[t]).mouse==e&&null==r.key)return r.operation}return null}),ci(this,"getOpStateFromAction",(e,t)=>{let r;for(let i=0;i<this.mouseActions.length;i++)if((r=this.mouseActions[i]).mouse==e&&r.key==t)return r.state;if(t){for(let t=0;t<this.mouseActions.length;t++)if((r=this.mouseActions[t]).mouse==e&&null==r.key)return r.state}return null}),ci(this,"getAngle",(e,t)=>180*Math.atan2(t.clientY-e.clientY,t.clientX-e.clientX)/Math.PI),ci(this,"updateTouchEvent",e=>{for(let t=0;t<this._touchCurrent.length;t++)if(this._touchCurrent[t].pointerId==e.pointerId){this._touchCurrent.splice(t,1,e);break}}),ci(this,"calculateAngularSpeed",(e,t,r,i)=>{let n=(i-r)/1e3;return 0==n?0:(t-e)/n}),ci(this,"calculatePointersDistance",(e,t)=>Math.sqrt(Math.pow(t.clientX-e.clientX,2)+Math.pow(t.clientY-e.clientY,2))),ci(this,"calculateRotationAxis",(e,t)=>(this._rotationMatrix.extractRotation(this._cameraMatrixState),this._quat.setFromRotationMatrix(this._rotationMatrix),this._rotationAxis.crossVectors(e,t).applyQuaternion(this._quat),this._rotationAxis.normalize().clone())),ci(this,"calculateTbRadius",e=>{let t=e.position.distanceTo(this._gizmos.position);if(e instanceof tw.PerspectiveCamera){let r=tw.MathUtils.DEG2RAD*e.fov*.5,i=Math.atan(e.aspect*Math.tan(r));return Math.tan(Math.min(r,i))*t*.67}if(e instanceof tw.OrthographicCamera)return .67*Math.min(e.top,e.right)}),ci(this,"focus",(e,t,r=1)=>{if(this.camera){let i=e.clone();i.sub(this._gizmos.position).multiplyScalar(r),this._translationMatrix.makeTranslation(i.x,i.y,i.z);let n=this._gizmoMatrixState.clone();this._gizmoMatrixState.premultiply(this._translationMatrix),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale);let a=this._cameraMatrixState.clone();this._cameraMatrixState.premultiply(this._translationMatrix),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.enableZoom&&this.applyTransformMatrix(this.applyScale(t,this._gizmos.position)),this._gizmoMatrixState.copy(n),this._cameraMatrixState.copy(a)}}),ci(this,"drawGrid",()=>{if(this.scene){let e,t,r,i;if(this.camera instanceof tw.OrthographicCamera)i=(r=Math.max(this.camera.right-this.camera.left,this.camera.bottom-this.camera.top))/20,t=(e=r/this.camera.zoom*3)/i*this.camera.zoom;else if(this.camera instanceof tw.PerspectiveCamera){let n=this.camera.position.distanceTo(this._gizmos.position),a=tw.MathUtils.DEG2RAD*this.camera.fov*.5,o=Math.atan(this.camera.aspect*Math.tan(a));i=(r=Math.tan(Math.max(a,o))*n*2)/20,t=(e=3*r)/i}null==this._grid&&this.camera&&(this._grid=new tw.GridHelper(e,t,8947848,8947848),this._grid.position.copy(this._gizmos.position),this._gridPosition.copy(this._grid.position),this._grid.quaternion.copy(this.camera.quaternion),this._grid.rotateX(.5*Math.PI),this.scene.add(this._grid))}}),ci(this,"connect",e=>{e===document&&console.error('THREE.ArcballControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=e,this.domElement.style.touchAction="none",this.domElement.addEventListener("contextmenu",this.onContextMenu),this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointercancel",this.onPointerCancel),this.domElement.addEventListener("wheel",this.onWheel)}),ci(this,"dispose",()=>{var e,t,r,i,n;-1!=this._animationId&&window.cancelAnimationFrame(this._animationId),null==(e=this.domElement)||e.removeEventListener("pointerdown",this.onPointerDown),null==(t=this.domElement)||t.removeEventListener("pointercancel",this.onPointerCancel),null==(r=this.domElement)||r.removeEventListener("wheel",this.onWheel),null==(i=this.domElement)||i.removeEventListener("contextmenu",this.onContextMenu),window.removeEventListener("pointermove",this.onPointerMove),window.removeEventListener("pointerup",this.onPointerUp),window.removeEventListener("resize",this.onWindowResize),null==(n=this.scene)||n.remove(this._gizmos),this.disposeGrid()}),ci(this,"disposeGrid",()=>{this._grid&&this.scene&&(this.scene.remove(this._grid),this._grid=null)}),ci(this,"easeOutCubic",e=>1-Math.pow(1-e,3)),ci(this,"activateGizmos",e=>{for(let t of this._gizmos.children)t.material.setValues({opacity:e?1:.6})}),ci(this,"getCursorNDC",(e,t,r)=>{let i=r.getBoundingClientRect();return this._v2_1.setX((e-i.left)/i.width*2-1),this._v2_1.setY((i.bottom-t)/i.height*2-1),this._v2_1.clone()}),ci(this,"getCursorPosition",(e,t,r)=>(this._v2_1.copy(this.getCursorNDC(e,t,r)),this.camera instanceof tw.OrthographicCamera&&(this._v2_1.x*=(this.camera.right-this.camera.left)*.5,this._v2_1.y*=(this.camera.top-this.camera.bottom)*.5),this._v2_1.clone())),ci(this,"setCamera",e=>{if(e){e.lookAt(this.target),e.updateMatrix(),e instanceof tw.PerspectiveCamera&&(this._fov0=e.fov,this._fovState=e.fov),this._cameraMatrixState0.copy(e.matrix),this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraProjectionState.copy(e.projectionMatrix),this._zoom0=e.zoom,this._zoomState=this._zoom0,this._initialNear=e.near,this._nearPos0=e.position.distanceTo(this.target)-e.near,this._nearPos=this._initialNear,this._initialFar=e.far,this._farPos0=e.position.distanceTo(this.target)-e.far,this._farPos=this._initialFar,this._up0.copy(e.up),this._upState.copy(e.up),this.camera=e,this.camera.updateProjectionMatrix();let t=this.calculateTbRadius(e);void 0!==t&&(this._tbRadius=t),this.makeGizmos(this.target,this._tbRadius)}}),ci(this,"makeGizmos",(e,t)=>{let r=new tw.EllipseCurve(0,0,t,t).getPoints(this._curvePts),i=new tw.BufferGeometry().setFromPoints(r),n=new tw.LineBasicMaterial({color:0xff8080,fog:!1,transparent:!0,opacity:.6}),a=new tw.LineBasicMaterial({color:8454016,fog:!1,transparent:!0,opacity:.6}),o=new tw.LineBasicMaterial({color:8421631,fog:!1,transparent:!0,opacity:.6}),s=new tw.Line(i,n),l=new tw.Line(i,a),c=new tw.Line(i,o),h=.5*Math.PI;if(s.rotation.x=h,l.rotation.y=h,this._gizmoMatrixState0.identity().setPosition(e),this._gizmoMatrixState.copy(this._gizmoMatrixState0),this.camera&&1!=this.camera.zoom){let t=1/this.camera.zoom;this._scaleMatrix.makeScale(t,t,t),this._translationMatrix.makeTranslation(-e.x,-e.y,-e.z),this._gizmoMatrixState.premultiply(this._translationMatrix).premultiply(this._scaleMatrix),this._translationMatrix.makeTranslation(e.x,e.y,e.z),this._gizmoMatrixState.premultiply(this._translationMatrix)}this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.clear(),this._gizmos.add(s),this._gizmos.add(l),this._gizmos.add(c)}),ci(this,"onFocusAnim",(e,t,r,i)=>{if(-1==this._timeStart&&(this._timeStart=e),this._state==cn.ANIMATION_FOCUS){let n=(e-this._timeStart)/this.focusAnimationTime;if(this._gizmoMatrixState.copy(i),n>=1)this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(t,this.scaleFactor),this._timeStart=-1,this.updateTbState(cn.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(cl);else{let e=this.easeOutCubic(n),a=1-e+this.scaleFactor*e;this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.focus(t,a,e),this.dispatchEvent(cl);let o=this;this._animationId=window.requestAnimationFrame(function(e){o.onFocusAnim(e,t,r,i.clone())})}}else this._animationId=-1,this._timeStart=-1}),ci(this,"onRotationAnim",(e,t,r)=>{if(-1==this._timeStart&&(this._anglePrev=0,this._angleCurrent=0,this._timeStart=e),this._state==cn.ANIMATION_ROTATE){let i=(e-this._timeStart)/1e3;if(r+-this.dampingFactor*i>0){this._angleCurrent=-(.5*this.dampingFactor)*Math.pow(i,2)+r*i+0,this.applyTransformMatrix(this.rotate(t,this._angleCurrent)),this.dispatchEvent(cl);let e=this;this._animationId=window.requestAnimationFrame(function(i){e.onRotationAnim(i,t,r)})}else this._animationId=-1,this._timeStart=-1,this.updateTbState(cn.IDLE,!1),this.activateGizmos(!1),this.dispatchEvent(cl)}else this._animationId=-1,this._timeStart=-1,this._state!=cn.ROTATE&&(this.activateGizmos(!1),this.dispatchEvent(cl))}),ci(this,"pan",(e,t,r=!1)=>{if(this.camera){let i=e.clone().sub(t);if(this.camera instanceof tw.OrthographicCamera&&i.multiplyScalar(1/this.camera.zoom),this.camera instanceof tw.PerspectiveCamera&&r){this._v3_1.setFromMatrixPosition(this._cameraMatrixState0),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0);let e=this._v3_1.distanceTo(this._v3_2)/this.camera.position.distanceTo(this._gizmos.position);i.multiplyScalar(1/e)}this._v3_1.set(i.x,i.y,0).applyQuaternion(this.camera.quaternion),this._m4_1.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z),this.setTransformationMatrices(this._m4_1,this._m4_1)}return cs}),ci(this,"reset",()=>{if(this.camera){this.camera.zoom=this._zoom0,this.camera instanceof tw.PerspectiveCamera&&(this.camera.fov=this._fov0),this.camera.near=this._nearPos,this.camera.far=this._farPos,this._cameraMatrixState.copy(this._cameraMatrixState0),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.up.copy(this._up0),this.camera.updateMatrix(),this.camera.updateProjectionMatrix(),this._gizmoMatrixState.copy(this._gizmoMatrixState0),this._gizmoMatrixState0.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix();let e=this.calculateTbRadius(this.camera);void 0!==e&&(this._tbRadius=e),this.makeGizmos(this._gizmos.position,this._tbRadius),this.camera.lookAt(this._gizmos.position),this.updateTbState(cn.IDLE,!1),this.dispatchEvent(cl)}}),ci(this,"rotate",(e,t)=>{let r=this._gizmos.position;return this._translationMatrix.makeTranslation(-r.x,-r.y,-r.z),this._rotationMatrix.makeRotationAxis(e,-t),this._m4_1.makeTranslation(r.x,r.y,r.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1),cs}),ci(this,"copyState",()=>{if(this.camera){let e=JSON.stringify(this.camera instanceof tw.OrthographicCamera?{arcballState:{cameraFar:this.camera.far,cameraMatrix:this.camera.matrix,cameraNear:this.camera.near,cameraUp:this.camera.up,cameraZoom:this.camera.zoom,gizmoMatrix:this._gizmos.matrix}}:{arcballState:{cameraFar:this.camera.far,cameraFov:this.camera.fov,cameraMatrix:this.camera.matrix,cameraNear:this.camera.near,cameraUp:this.camera.up,cameraZoom:this.camera.zoom,gizmoMatrix:this._gizmos.matrix}});navigator.clipboard.writeText(e)}}),ci(this,"pasteState",()=>{let e=this;navigator.clipboard.readText().then(function(t){e.setStateFromJSON(t)})}),ci(this,"saveState",()=>{this.camera&&(this._cameraMatrixState0.copy(this.camera.matrix),this._gizmoMatrixState0.copy(this._gizmos.matrix),this._nearPos=this.camera.near,this._farPos=this.camera.far,this._zoom0=this.camera.zoom,this._up0.copy(this.camera.up),this.camera instanceof tw.PerspectiveCamera&&(this._fov0=this.camera.fov))}),ci(this,"applyScale",(e,t,r=!0)=>{if(!this.camera)return;let i=t.clone(),n=1/e;if(this.camera instanceof tw.OrthographicCamera){this.camera.zoom=this._zoomState,this.camera.zoom*=e,this.camera.zoom>this.maxZoom?(this.camera.zoom=this.maxZoom,n=this._zoomState/this.maxZoom):this.camera.zoom<this.minZoom&&(this.camera.zoom=this.minZoom,n=this._zoomState/this.minZoom),this.camera.updateProjectionMatrix(),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState),this._scaleMatrix.makeScale(n,n,n),this._translationMatrix.makeTranslation(-this._v3_1.x,-this._v3_1.y,-this._v3_1.z),this._m4_2.makeTranslation(this._v3_1.x,this._v3_1.y,this._v3_1.z).multiply(this._scaleMatrix),this._m4_2.multiply(this._translationMatrix),i.sub(this._v3_1);let t=i.clone().multiplyScalar(n);return i.sub(t),this._m4_1.makeTranslation(i.x,i.y,i.z),this._m4_2.premultiply(this._m4_1),this.setTransformationMatrices(this._m4_1,this._m4_2),cs}if(this.camera instanceof tw.PerspectiveCamera){this._v3_1.setFromMatrixPosition(this._cameraMatrixState),this._v3_2.setFromMatrixPosition(this._gizmoMatrixState);let e=this._v3_1.distanceTo(i),t=e-e*n,a=e-t;a<this.minDistance?(n=this.minDistance/e,t=e-e*n):a>this.maxDistance&&(n=this.maxDistance/e,t=e-e*n);let o=i.clone().sub(this._v3_1).normalize().multiplyScalar(t);if(this._m4_1.makeTranslation(o.x,o.y,o.z),r){let r=this._v3_2;t=(e=r.distanceTo(i))-e*n,o=i.clone().sub(this._v3_2).normalize().multiplyScalar(t),this._translationMatrix.makeTranslation(r.x,r.y,r.z),this._scaleMatrix.makeScale(n,n,n),this._m4_2.makeTranslation(o.x,o.y,o.z).multiply(this._translationMatrix),this._m4_2.multiply(this._scaleMatrix),this._translationMatrix.makeTranslation(-r.x,-r.y,-r.z),this._m4_2.multiply(this._translationMatrix),this.setTransformationMatrices(this._m4_1,this._m4_2)}else this.setTransformationMatrices(this._m4_1);return cs}}),ci(this,"setFov",e=>{this.camera instanceof tw.PerspectiveCamera&&(this.camera.fov=tw.MathUtils.clamp(e,this.minFov,this.maxFov),this.camera.updateProjectionMatrix())}),ci(this,"setTarget",(e,t,r)=>{if(this.camera){this.target.set(e,t,r),this._gizmos.position.set(e,t,r);let i=this.calculateTbRadius(this.camera);void 0!==i&&(this._tbRadius=i),this.makeGizmos(this.target,this._tbRadius),this.camera.lookAt(this.target)}}),ci(this,"zRotate",(e,t)=>(this._rotationMatrix.makeRotationAxis(this._rotationAxis,t),this._translationMatrix.makeTranslation(-e.x,-e.y,-e.z),this._m4_1.makeTranslation(e.x,e.y,e.z),this._m4_1.multiply(this._rotationMatrix),this._m4_1.multiply(this._translationMatrix),this._v3_1.setFromMatrixPosition(this._gizmoMatrixState).sub(e),this._v3_2.copy(this._v3_1).applyAxisAngle(this._rotationAxis,t),this._v3_2.sub(this._v3_1),this._m4_2.makeTranslation(this._v3_2.x,this._v3_2.y,this._v3_2.z),this.setTransformationMatrices(this._m4_1,this._m4_2),cs)),ci(this,"unprojectOnObj",(e,t)=>{if(!this.scene)return null;let r=new tw.Raycaster;r.near=t.near,r.far=t.far,r.setFromCamera(e,t);let i=r.intersectObjects(this.scene.children,!0);for(let e=0;e<i.length;e++)if(i[e].object.uuid!=this._gizmos.uuid&&i[e].face)return i[e].point.clone();return null}),ci(this,"unprojectOnTbSurface",(e,t,r,i,n)=>{if(e instanceof tw.OrthographicCamera){this._v2_1.copy(this.getCursorPosition(t,r,i)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0);let e=Math.pow(this._v2_1.x,2),n=Math.pow(this._v2_1.y,2),a=Math.pow(this._tbRadius,2);return e+n<=.5*a?this._v3_1.setZ(Math.sqrt(a-(e+n))):this._v3_1.setZ(.5*a/Math.sqrt(e+n)),this._v3_1}if(e instanceof tw.PerspectiveCamera){this._v2_1.copy(this.getCursorNDC(t,r,i)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(e.projectionMatrixInverse);let a=this._v3_1.clone().normalize(),o=e.position.distanceTo(this._gizmos.position),s=Math.pow(n,2),l=this._v3_1.z,c=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));if(0==c)return a.set(this._v3_1.x,this._v3_1.y,n),a;let h=l/c,u=Math.pow(h,2)+1,A=2*h*o,d=Math.pow(o,2)-s,f=Math.pow(A,2)-4*u*d;if(f>=0&&(this._v2_1.setX((-A-Math.sqrt(f))/(2*u)),this._v2_1.setY(h*this._v2_1.x+o),tw.MathUtils.RAD2DEG*this._v2_1.angle()>=45)){let e=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(o-this._v2_1.y,2));return a.multiplyScalar(e),a.z+=o,a}u=h,f=Math.pow(A=o,2)-4*u*(d=-(.5*s)),this._v2_1.setX((-A-Math.sqrt(f))/(2*u)),this._v2_1.setY(h*this._v2_1.x+o);let m=Math.sqrt(Math.pow(this._v2_1.x,2)+Math.pow(o-this._v2_1.y,2));return a.multiplyScalar(m),a.z+=o,a}}),ci(this,"unprojectOnTbPlane",(e,t,r,i,n=!1)=>{if(e instanceof tw.OrthographicCamera)return this._v2_1.copy(this.getCursorPosition(t,r,i)),this._v3_1.set(this._v2_1.x,this._v2_1.y,0),this._v3_1.clone();if(e instanceof tw.PerspectiveCamera){let a;this._v2_1.copy(this.getCursorNDC(t,r,i)),this._v3_1.set(this._v2_1.x,this._v2_1.y,-1),this._v3_1.applyMatrix4(e.projectionMatrixInverse);let o=this._v3_1.clone().normalize(),s=this._v3_1.z,l=Math.sqrt(Math.pow(this._v3_1.x,2)+Math.pow(this._v3_1.y,2));if(a=n?this._v3_1.setFromMatrixPosition(this._cameraMatrixState0).distanceTo(this._v3_2.setFromMatrixPosition(this._gizmoMatrixState0)):e.position.distanceTo(this._gizmos.position),0==l)return o.set(0,0,0),o;let c=Math.sqrt(Math.pow(a,2)+Math.pow(-a/(s/l),2));return o.multiplyScalar(c),o.z=0,o}}),ci(this,"updateMatrixState",()=>{this.camera&&(this._cameraMatrixState.copy(this.camera.matrix),this._gizmoMatrixState.copy(this._gizmos.matrix),this.camera instanceof tw.OrthographicCamera&&(this._cameraProjectionState.copy(this.camera.projectionMatrix),this.camera.updateProjectionMatrix(),this._zoomState=this.camera.zoom),this.camera instanceof tw.PerspectiveCamera&&(this._fovState=this.camera.fov))}),ci(this,"updateTbState",(e,t)=>{this._state=e,t&&this.updateMatrixState()}),ci(this,"update",()=>{if(!this.target.equals(this._currentTarget)&&this.camera){this._gizmos.position.set(this.target.x,this.target.y,this.target.z);let e=this.calculateTbRadius(this.camera);void 0!==e&&(this._tbRadius=e),this.makeGizmos(this.target,this._tbRadius),this._currentTarget.copy(this.target)}if(this.camera){if(this.camera instanceof tw.OrthographicCamera&&(this.camera.zoom>this.maxZoom||this.camera.zoom<this.minZoom)){let e=tw.MathUtils.clamp(this.camera.zoom,this.minZoom,this.maxZoom);this.applyTransformMatrix(this.applyScale(e/this.camera.zoom,this._gizmos.position,!0))}if(this.camera instanceof tw.PerspectiveCamera){let e=this.camera.position.distanceTo(this._gizmos.position);if(e>this.maxDistance+1e-6||e<this.minDistance-1e-6){let t=tw.MathUtils.clamp(e,this.minDistance,this.maxDistance);this.applyTransformMatrix(this.applyScale(t/e,this._gizmos.position)),this.updateMatrixState()}(this.camera.fov<this.minFov||this.camera.fov>this.maxFov)&&(this.camera.fov=tw.MathUtils.clamp(this.camera.fov,this.minFov,this.maxFov),this.camera.updateProjectionMatrix());let t=this._tbRadius,r=this.calculateTbRadius(this.camera);if(void 0!==r&&(this._tbRadius=r),t<this._tbRadius-1e-6||t>this._tbRadius+1e-6){let e=(this._gizmos.scale.x+this._gizmos.scale.y+this._gizmos.scale.z)/3,t=this._tbRadius/e,r=new tw.EllipseCurve(0,0,t,t).getPoints(this._curvePts),i=new tw.BufferGeometry().setFromPoints(r);for(let e in this._gizmos.children)this._gizmos.children[e].geometry=i}}this.camera.lookAt(this._gizmos.position)}}),ci(this,"setStateFromJSON",e=>{let t=JSON.parse(e);if(t.arcballState&&this.camera){this._cameraMatrixState.fromArray(t.arcballState.cameraMatrix.elements),this._cameraMatrixState.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.up.copy(t.arcballState.cameraUp),this.camera.near=t.arcballState.cameraNear,this.camera.far=t.arcballState.cameraFar,this.camera.zoom=t.arcballState.cameraZoom,this.camera instanceof tw.PerspectiveCamera&&(this.camera.fov=t.arcballState.cameraFov),this._gizmoMatrixState.fromArray(t.arcballState.gizmoMatrix.elements),this._gizmoMatrixState.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this.camera.updateMatrix(),this.camera.updateProjectionMatrix(),this._gizmos.updateMatrix();let e=this.calculateTbRadius(this.camera);void 0!==e&&(this._tbRadius=e);let r=new tw.Matrix4().copy(this._gizmoMatrixState0);this.makeGizmos(this._gizmos.position,this._tbRadius),this._gizmoMatrixState0.copy(r),this.camera.lookAt(this._gizmos.position),this.updateTbState(cn.IDLE,!1),this.dispatchEvent(cl)}}),this.camera=null,this.domElement=t,this.scene=r,this.mouseActions=[],this._mouseOp=null,this._v2_1=new tw.Vector2,this._v3_1=new tw.Vector3,this._v3_2=new tw.Vector3,this._m4_1=new tw.Matrix4,this._m4_2=new tw.Matrix4,this._quat=new tw.Quaternion,this._translationMatrix=new tw.Matrix4,this._rotationMatrix=new tw.Matrix4,this._scaleMatrix=new tw.Matrix4,this._rotationAxis=new tw.Vector3,this._cameraMatrixState=new tw.Matrix4,this._cameraProjectionState=new tw.Matrix4,this._fovState=1,this._upState=new tw.Vector3,this._zoomState=1,this._nearPos=0,this._farPos=0,this._gizmoMatrixState=new tw.Matrix4,this._up0=new tw.Vector3,this._zoom0=1,this._fov0=0,this._initialNear=0,this._nearPos0=0,this._initialFar=0,this._farPos0=0,this._cameraMatrixState0=new tw.Matrix4,this._gizmoMatrixState0=new tw.Matrix4,this._button=-1,this._touchStart=[],this._touchCurrent=[],this._input=ca.NONE,this._switchSensibility=32,this._startFingerDistance=0,this._currentFingerDistance=0,this._startFingerRotation=0,this._currentFingerRotation=0,this._devPxRatio=0,this._downValid=!0,this._nclicks=0,this._downEvents=[],this._clickStart=0,this._maxDownTime=250,this._maxInterval=300,this._posThreshold=24,this._movementThreshold=24,this._currentCursorPosition=new tw.Vector3,this._startCursorPosition=new tw.Vector3,this._grid=null,this._gridPosition=new tw.Vector3,this._gizmos=new tw.Group,this._curvePts=128,this._timeStart=-1,this._animationId=-1,this.focusAnimationTime=500,this._timePrev=0,this._timeCurrent=0,this._anglePrev=0,this._angleCurrent=0,this._cursorPosPrev=new tw.Vector3,this._cursorPosCurr=new tw.Vector3,this._wPrev=0,this._wCurr=0,this.adjustNearFar=!1,this.scaleFactor=1.1,this.dampingFactor=25,this.wMax=20,this.enableAnimations=!0,this.enableGrid=!1,this.cursorZoom=!1,this.minFov=5,this.maxFov=90,this.enabled=!0,this.enablePan=!0,this.enableRotate=!0,this.enableZoom=!0,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.target=new tw.Vector3(0,0,0),this._currentTarget=new tw.Vector3(0,0,0),this._tbRadius=1,this._state=cn.IDLE,this.setCamera(e),this.scene&&this.scene.add(this._gizmos),this._devPxRatio=window.devicePixelRatio,this.initializeMouseActions(),this.domElement&&this.connect(this.domElement),window.addEventListener("resize",this.onWindowResize)}applyTransformMatrix(e){if((null==e?void 0:e.camera)&&this.camera&&(this._m4_1.copy(this._cameraMatrixState).premultiply(e.camera),this._m4_1.decompose(this.camera.position,this.camera.quaternion,this.camera.scale),this.camera.updateMatrix(),(this._state==cn.ROTATE||this._state==cn.ZROTATE||this._state==cn.ANIMATION_ROTATE)&&this.camera.up.copy(this._upState).applyQuaternion(this.camera.quaternion)),(null==e?void 0:e.gizmos)&&(this._m4_1.copy(this._gizmoMatrixState).premultiply(e.gizmos),this._m4_1.decompose(this._gizmos.position,this._gizmos.quaternion,this._gizmos.scale),this._gizmos.updateMatrix()),(this._state==cn.SCALE||this._state==cn.FOCUS||this._state==cn.ANIMATION_FOCUS)&&this.camera){let e=this.calculateTbRadius(this.camera);if(void 0!==e&&(this._tbRadius=e),this.adjustNearFar){let e=this.camera.position.distanceTo(this._gizmos.position),t=new tw.Box3;t.setFromObject(this._gizmos);let r=new tw.Sphere;t.getBoundingSphere(r);let i=Math.min(Math.max(this._nearPos0,r.radius+r.center.length()),e-this._initialNear);this.camera.near=e-i;let n=Math.min(Math.min(this._farPos0,-r.radius+r.center.length()),e-this._initialFar);this.camera.far=e-n,this.camera.updateProjectionMatrix()}else{let e=!1;this.camera.near!=this._initialNear&&(this.camera.near=this._initialNear,e=!0),this.camera.far!=this._initialFar&&(this.camera.far=this._initialFar,e=!0),e&&this.camera.updateProjectionMatrix()}}}setGizmosVisible(e){this._gizmos.visible=e,this.dispatchEvent(cl)}setTransformationMatrices(e=null,t=null){e?cs.camera?cs.camera.copy(e):cs.camera=e.clone():cs.camera=null,t?cs.gizmos?cs.gizmos.copy(t):cs.gizmos=t.clone():cs.gizmos=null}}let cA=(0,tC.forwardRef)(({camera:e,makeDefault:t,regress:r,domElement:i,onChange:n,onStart:a,onEnd:o,...s},l)=>{let c=(0,tI.C)(e=>e.invalidate),h=(0,tI.C)(e=>e.camera),u=(0,tI.C)(e=>e.gl),A=(0,tI.C)(e=>e.events),d=(0,tI.C)(e=>e.set),f=(0,tI.C)(e=>e.get),m=(0,tI.C)(e=>e.performance),p=e||h,g=i||A.connected||u.domElement,v=(0,tC.useMemo)(()=>new cu(p),[p]);return(0,tb.useFrame)(()=>{v.enabled&&v.update()},-1),(0,tC.useEffect)(()=>(v.connect(g),()=>void v.dispose()),[g,r,v,c]),(0,tC.useEffect)(()=>{let e=e=>{c(),r&&m.regress(),n&&n(e)};return v.addEventListener("change",e),a&&v.addEventListener("start",a),o&&v.addEventListener("end",o),()=>{v.removeEventListener("change",e),a&&v.removeEventListener("start",a),o&&v.removeEventListener("end",o)}},[n,a,o]),(0,tC.useEffect)(()=>{if(t){let e=f().controls;return d({controls:v}),()=>d({controls:e})}},[t,v]),tC.createElement("primitive",e2({ref:l,object:v},s))});var tI=tI,cd=tw,cf=Object.defineProperty,cm=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?cf(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r,r};class cp extends cd.Object3D{constructor(e,t){super(),cm(this,"isTransformControls",!0),cm(this,"visible",!1),cm(this,"domElement"),cm(this,"raycaster",new cd.Raycaster),cm(this,"gizmo"),cm(this,"plane"),cm(this,"tempVector",new cd.Vector3),cm(this,"tempVector2",new cd.Vector3),cm(this,"tempQuaternion",new cd.Quaternion),cm(this,"unit",{X:new cd.Vector3(1,0,0),Y:new cd.Vector3(0,1,0),Z:new cd.Vector3(0,0,1)}),cm(this,"pointStart",new cd.Vector3),cm(this,"pointEnd",new cd.Vector3),cm(this,"offset",new cd.Vector3),cm(this,"rotationAxis",new cd.Vector3),cm(this,"startNorm",new cd.Vector3),cm(this,"endNorm",new cd.Vector3),cm(this,"rotationAngle",0),cm(this,"cameraPosition",new cd.Vector3),cm(this,"cameraQuaternion",new cd.Quaternion),cm(this,"cameraScale",new cd.Vector3),cm(this,"parentPosition",new cd.Vector3),cm(this,"parentQuaternion",new cd.Quaternion),cm(this,"parentQuaternionInv",new cd.Quaternion),cm(this,"parentScale",new cd.Vector3),cm(this,"worldPositionStart",new cd.Vector3),cm(this,"worldQuaternionStart",new cd.Quaternion),cm(this,"worldScaleStart",new cd.Vector3),cm(this,"worldPosition",new cd.Vector3),cm(this,"worldQuaternion",new cd.Quaternion),cm(this,"worldQuaternionInv",new cd.Quaternion),cm(this,"worldScale",new cd.Vector3),cm(this,"eye",new cd.Vector3),cm(this,"positionStart",new cd.Vector3),cm(this,"quaternionStart",new cd.Quaternion),cm(this,"scaleStart",new cd.Vector3),cm(this,"camera"),cm(this,"object"),cm(this,"enabled",!0),cm(this,"axis",null),cm(this,"mode","translate"),cm(this,"translationSnap",null),cm(this,"rotationSnap",null),cm(this,"scaleSnap",null),cm(this,"space","world"),cm(this,"size",1),cm(this,"dragging",!1),cm(this,"showX",!0),cm(this,"showY",!0),cm(this,"showZ",!0),cm(this,"changeEvent",{type:"change"}),cm(this,"mouseDownEvent",{type:"mouseDown",mode:this.mode}),cm(this,"mouseUpEvent",{type:"mouseUp",mode:this.mode}),cm(this,"objectChangeEvent",{type:"objectChange"}),cm(this,"intersectObjectWithRay",(e,t,r)=>{let i=t.intersectObject(e,!0);for(let e=0;e<i.length;e++)if(i[e].object.visible||r)return i[e];return!1}),cm(this,"attach",e=>(this.object=e,this.visible=!0,this)),cm(this,"detach",()=>(this.object=void 0,this.visible=!1,this.axis=null,this)),cm(this,"reset",()=>(this.enabled&&this.dragging&&void 0!==this.object&&(this.object.position.copy(this.positionStart),this.object.quaternion.copy(this.quaternionStart),this.object.scale.copy(this.scaleStart),this.dispatchEvent(this.changeEvent),this.dispatchEvent(this.objectChangeEvent),this.pointStart.copy(this.pointEnd)),this)),cm(this,"updateMatrixWorld",()=>{void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this.parentPosition,this.parentQuaternion,this.parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this.worldScale),this.parentQuaternionInv.copy(this.parentQuaternion).invert(),this.worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this.cameraScale),this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld()}),cm(this,"pointerHover",e=>{if(void 0===this.object||!0===this.dragging)return;this.raycaster.setFromCamera(e,this.camera);let t=this.intersectObjectWithRay(this.gizmo.picker[this.mode],this.raycaster);t?this.axis=t.object.name:this.axis=null}),cm(this,"pointerDown",e=>{if(void 0!==this.object&&!0!==this.dragging&&0===e.button&&null!==this.axis){this.raycaster.setFromCamera(e,this.camera);let t=this.intersectObjectWithRay(this.plane,this.raycaster,!0);if(t){let e=this.space;if("scale"===this.mode?e="local":("E"===this.axis||"XYZE"===this.axis||"XYZ"===this.axis)&&(e="world"),"local"===e&&"rotate"===this.mode){let e=this.rotationSnap;"X"===this.axis&&e&&(this.object.rotation.x=Math.round(this.object.rotation.x/e)*e),"Y"===this.axis&&e&&(this.object.rotation.y=Math.round(this.object.rotation.y/e)*e),"Z"===this.axis&&e&&(this.object.rotation.z=Math.round(this.object.rotation.z/e)*e)}this.object.updateMatrixWorld(),this.object.parent&&this.object.parent.updateMatrixWorld(),this.positionStart.copy(this.object.position),this.quaternionStart.copy(this.object.quaternion),this.scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this.worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)}this.dragging=!0,this.mouseDownEvent.mode=this.mode,this.dispatchEvent(this.mouseDownEvent)}}),cm(this,"pointerMove",e=>{let t=this.axis,r=this.mode,i=this.object,n=this.space;if("scale"===r?n="local":("E"===t||"XYZE"===t||"XYZ"===t)&&(n="world"),void 0===i||null===t||!1===this.dragging||-1!==e.button)return;this.raycaster.setFromCamera(e,this.camera);let a=this.intersectObjectWithRay(this.plane,this.raycaster,!0);if(a){if(this.pointEnd.copy(a.point).sub(this.worldPositionStart),"translate"===r)this.offset.copy(this.pointEnd).sub(this.pointStart),"local"===n&&"XYZ"!==t&&this.offset.applyQuaternion(this.worldQuaternionInv),-1===t.indexOf("X")&&(this.offset.x=0),-1===t.indexOf("Y")&&(this.offset.y=0),-1===t.indexOf("Z")&&(this.offset.z=0),"local"===n&&"XYZ"!==t?this.offset.applyQuaternion(this.quaternionStart).divide(this.parentScale):this.offset.applyQuaternion(this.parentQuaternionInv).divide(this.parentScale),i.position.copy(this.offset).add(this.positionStart),this.translationSnap&&("local"===n&&(i.position.applyQuaternion(this.tempQuaternion.copy(this.quaternionStart).invert()),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this.quaternionStart)),"world"===n&&(i.parent&&i.position.add(this.tempVector.setFromMatrixPosition(i.parent.matrixWorld)),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(this.tempVector.setFromMatrixPosition(i.parent.matrixWorld))));else if("scale"===r){if(-1!==t.search("XYZ")){let e=this.pointEnd.length()/this.pointStart.length();0>this.pointEnd.dot(this.pointStart)&&(e*=-1),this.tempVector2.set(e,e,e)}else this.tempVector.copy(this.pointStart),this.tempVector2.copy(this.pointEnd),this.tempVector.applyQuaternion(this.worldQuaternionInv),this.tempVector2.applyQuaternion(this.worldQuaternionInv),this.tempVector2.divide(this.tempVector),-1===t.search("X")&&(this.tempVector2.x=1),-1===t.search("Y")&&(this.tempVector2.y=1),-1===t.search("Z")&&(this.tempVector2.z=1);i.scale.copy(this.scaleStart).multiply(this.tempVector2),this.scaleSnap&&this.object&&(-1!==t.search("X")&&(this.object.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===r){this.offset.copy(this.pointEnd).sub(this.pointStart);let e=20/this.worldPosition.distanceTo(this.tempVector.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this.startNorm.copy(this.pointStart).normalize(),this.endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=0>this.endNorm.cross(this.startNorm).dot(this.eye)?1:-1):"XYZE"===t?(this.rotationAxis.copy(this.offset).cross(this.eye).normalize(),this.rotationAngle=this.offset.dot(this.tempVector.copy(this.rotationAxis).cross(this.eye))*e):("X"===t||"Y"===t||"Z"===t)&&(this.rotationAxis.copy(this.unit[t]),this.tempVector.copy(this.unit[t]),"local"===n&&this.tempVector.applyQuaternion(this.worldQuaternion),this.rotationAngle=this.offset.dot(this.tempVector.cross(this.eye).normalize())*e),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),"local"===n&&"E"!==t&&"XYZE"!==t?(i.quaternion.copy(this.quaternionStart),i.quaternion.multiply(this.tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this.parentQuaternionInv),i.quaternion.copy(this.tempQuaternion.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this.quaternionStart).normalize())}this.dispatchEvent(this.changeEvent),this.dispatchEvent(this.objectChangeEvent)}}),cm(this,"pointerUp",e=>{0===e.button&&(this.dragging&&null!==this.axis&&(this.mouseUpEvent.mode=this.mode,this.dispatchEvent(this.mouseUpEvent)),this.dragging=!1,this.axis=null)}),cm(this,"getPointer",e=>{var t;if(this.domElement&&(null==(t=this.domElement.ownerDocument)?void 0:t.pointerLockElement))return{x:0,y:0,button:e.button};{let t=e.changedTouches?e.changedTouches[0]:e,r=this.domElement.getBoundingClientRect();return{x:(t.clientX-r.left)/r.width*2-1,y:-(t.clientY-r.top)/r.height*2+1,button:e.button}}}),cm(this,"onPointerHover",e=>{if(this.enabled)switch(e.pointerType){case"mouse":case"pen":this.pointerHover(this.getPointer(e))}}),cm(this,"onPointerDown",e=>{this.enabled&&this.domElement&&(this.domElement.style.touchAction="none",this.domElement.ownerDocument.addEventListener("pointermove",this.onPointerMove),this.pointerHover(this.getPointer(e)),this.pointerDown(this.getPointer(e)))}),cm(this,"onPointerMove",e=>{this.enabled&&this.pointerMove(this.getPointer(e))}),cm(this,"onPointerUp",e=>{this.enabled&&this.domElement&&(this.domElement.style.touchAction="",this.domElement.ownerDocument.removeEventListener("pointermove",this.onPointerMove),this.pointerUp(this.getPointer(e)))}),cm(this,"getMode",()=>this.mode),cm(this,"setMode",e=>{this.mode=e}),cm(this,"setTranslationSnap",e=>{this.translationSnap=e}),cm(this,"setRotationSnap",e=>{this.rotationSnap=e}),cm(this,"setScaleSnap",e=>{this.scaleSnap=e}),cm(this,"setSize",e=>{this.size=e}),cm(this,"setSpace",e=>{this.space=e}),cm(this,"update",()=>{console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}),cm(this,"connect",e=>{e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.domElement=e,this.domElement.addEventListener("pointerdown",this.onPointerDown),this.domElement.addEventListener("pointermove",this.onPointerHover),this.domElement.ownerDocument.addEventListener("pointerup",this.onPointerUp)}),cm(this,"dispose",()=>{var e,t,r,i,n,a;null==(e=this.domElement)||e.removeEventListener("pointerdown",this.onPointerDown),null==(t=this.domElement)||t.removeEventListener("pointermove",this.onPointerHover),null==(i=null==(r=this.domElement)?void 0:r.ownerDocument)||i.removeEventListener("pointermove",this.onPointerMove),null==(a=null==(n=this.domElement)?void 0:n.ownerDocument)||a.removeEventListener("pointerup",this.onPointerUp),this.traverse(e=>{e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()})}),this.domElement=t,this.camera=e,this.gizmo=new cg,this.add(this.gizmo),this.plane=new cv,this.add(this.plane);const r=(e,t)=>{let r=t;Object.defineProperty(this,e,{get:function(){return void 0!==r?r:t},set:function(t){r!==t&&(r=t,this.plane[e]=t,this.gizmo[e]=t,this.dispatchEvent({type:e+"-changed",value:t}),this.dispatchEvent(this.changeEvent))}}),this[e]=t,this.plane[e]=t,this.gizmo[e]=t};r("camera",this.camera),r("object",this.object),r("enabled",this.enabled),r("axis",this.axis),r("mode",this.mode),r("translationSnap",this.translationSnap),r("rotationSnap",this.rotationSnap),r("scaleSnap",this.scaleSnap),r("space",this.space),r("size",this.size),r("dragging",this.dragging),r("showX",this.showX),r("showY",this.showY),r("showZ",this.showZ),r("worldPosition",this.worldPosition),r("worldPositionStart",this.worldPositionStart),r("worldQuaternion",this.worldQuaternion),r("worldQuaternionStart",this.worldQuaternionStart),r("cameraPosition",this.cameraPosition),r("cameraQuaternion",this.cameraQuaternion),r("pointStart",this.pointStart),r("pointEnd",this.pointEnd),r("rotationAxis",this.rotationAxis),r("rotationAngle",this.rotationAngle),r("eye",this.eye),void 0!==t&&this.connect(t)}}class cg extends cd.Object3D{constructor(){super(),cm(this,"isTransformControlsGizmo",!0),cm(this,"type","TransformControlsGizmo"),cm(this,"tempVector",new cd.Vector3(0,0,0)),cm(this,"tempEuler",new cd.Euler),cm(this,"alignVector",new cd.Vector3(0,1,0)),cm(this,"zeroVector",new cd.Vector3(0,0,0)),cm(this,"lookAtMatrix",new cd.Matrix4),cm(this,"tempQuaternion",new cd.Quaternion),cm(this,"tempQuaternion2",new cd.Quaternion),cm(this,"identityQuaternion",new cd.Quaternion),cm(this,"unitX",new cd.Vector3(1,0,0)),cm(this,"unitY",new cd.Vector3(0,1,0)),cm(this,"unitZ",new cd.Vector3(0,0,1)),cm(this,"gizmo"),cm(this,"picker"),cm(this,"helper"),cm(this,"rotationAxis",new cd.Vector3),cm(this,"cameraPosition",new cd.Vector3),cm(this,"worldPositionStart",new cd.Vector3),cm(this,"worldQuaternionStart",new cd.Quaternion),cm(this,"worldPosition",new cd.Vector3),cm(this,"worldQuaternion",new cd.Quaternion),cm(this,"eye",new cd.Vector3),cm(this,"camera",null),cm(this,"enabled",!0),cm(this,"axis",null),cm(this,"mode","translate"),cm(this,"space","world"),cm(this,"size",1),cm(this,"dragging",!1),cm(this,"showX",!0),cm(this,"showY",!0),cm(this,"showZ",!0),cm(this,"updateMatrixWorld",()=>{let e=this.space;"scale"===this.mode&&(e="local");let t="local"===e?this.worldQuaternion:this.identityQuaternion;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;let r=[];r=(r=(r=r.concat(this.picker[this.mode].children)).concat(this.gizmo[this.mode].children)).concat(this.helper[this.mode].children);for(let e=0;e<r.length;e++){let i,n=r[e];if(n.visible=!0,n.rotation.set(0,0,0),n.position.copy(this.worldPosition),i=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),n.scale.set(1,1,1).multiplyScalar(i*this.size/7),"helper"===n.tag){n.visible=!1,"AXIS"===n.name?(n.position.copy(this.worldPositionStart),n.visible=!!this.axis,"X"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,0,0)),n.quaternion.copy(t).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"Y"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,0,Math.PI/2)),n.quaternion.copy(t).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"Z"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,Math.PI/2,0)),n.quaternion.copy(t).multiply(this.tempQuaternion),Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"XYZE"===this.axis&&(this.tempQuaternion.setFromEuler(this.tempEuler.set(0,Math.PI/2,0)),this.alignVector.copy(this.rotationAxis),n.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.zeroVector,this.alignVector,this.unitY)),n.quaternion.multiply(this.tempQuaternion),n.visible=this.dragging),"E"===this.axis&&(n.visible=!1)):"START"===n.name?(n.position.copy(this.worldPositionStart),n.visible=this.dragging):"END"===n.name?(n.position.copy(this.worldPosition),n.visible=this.dragging):"DELTA"===n.name?(n.position.copy(this.worldPositionStart),n.quaternion.copy(this.worldQuaternionStart),this.tempVector.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),this.tempVector.applyQuaternion(this.worldQuaternionStart.clone().invert()),n.scale.copy(this.tempVector),n.visible=this.dragging):(n.quaternion.copy(t),this.dragging?n.position.copy(this.worldPositionStart):n.position.copy(this.worldPosition),this.axis&&(n.visible=-1!==this.axis.search(n.name)));continue}n.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode?(("X"===n.name||"XYZX"===n.name)&&Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),("Y"===n.name||"XYZY"===n.name)&&Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),("Z"===n.name||"XYZZ"===n.name)&&Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye))>.99&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XY"===n.name&&.2>Math.abs(this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye))&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"YZ"===n.name&&.2>Math.abs(this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye))&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XZ"===n.name&&.2>Math.abs(this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye))&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),-1!==n.name.search("X")&&(0>this.alignVector.copy(this.unitX).applyQuaternion(t).dot(this.eye)?"fwd"===n.tag?n.visible=!1:n.scale.x*=-1:"bwd"===n.tag&&(n.visible=!1)),-1!==n.name.search("Y")&&(0>this.alignVector.copy(this.unitY).applyQuaternion(t).dot(this.eye)?"fwd"===n.tag?n.visible=!1:n.scale.y*=-1:"bwd"===n.tag&&(n.visible=!1)),-1!==n.name.search("Z")&&(0>this.alignVector.copy(this.unitZ).applyQuaternion(t).dot(this.eye)?"fwd"===n.tag?n.visible=!1:n.scale.z*=-1:"bwd"===n.tag&&(n.visible=!1))):"rotate"===this.mode&&(this.tempQuaternion2.copy(t),this.alignVector.copy(this.eye).applyQuaternion(this.tempQuaternion.copy(t).invert()),-1!==n.name.search("E")&&n.quaternion.setFromRotationMatrix(this.lookAtMatrix.lookAt(this.eye,this.zeroVector,this.unitY)),"X"===n.name&&(this.tempQuaternion.setFromAxisAngle(this.unitX,Math.atan2(-this.alignVector.y,this.alignVector.z)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),n.quaternion.copy(this.tempQuaternion)),"Y"===n.name&&(this.tempQuaternion.setFromAxisAngle(this.unitY,Math.atan2(this.alignVector.x,this.alignVector.z)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),n.quaternion.copy(this.tempQuaternion)),"Z"===n.name&&(this.tempQuaternion.setFromAxisAngle(this.unitZ,Math.atan2(this.alignVector.y,this.alignVector.x)),this.tempQuaternion.multiplyQuaternions(this.tempQuaternion2,this.tempQuaternion),n.quaternion.copy(this.tempQuaternion))),n.visible=n.visible&&(-1===n.name.indexOf("X")||this.showX),n.visible=n.visible&&(-1===n.name.indexOf("Y")||this.showY),n.visible=n.visible&&(-1===n.name.indexOf("Z")||this.showZ),n.visible=n.visible&&(-1===n.name.indexOf("E")||this.showX&&this.showY&&this.showZ),n.material.tempOpacity=n.material.tempOpacity||n.material.opacity,n.material.tempColor=n.material.tempColor||n.material.color.clone(),n.material.color.copy(n.material.tempColor),n.material.opacity=n.material.tempOpacity,this.enabled?this.axis&&(n.name===this.axis||this.axis.split("").some(function(e){return n.name===e})?n.material.opacity=1:n.material.opacity*=.25,n.material.color.lerp(new cd.Color(1,1,1),.5)):(n.material.opacity*=.5,n.material.color.lerp(new cd.Color(1,1,1),.5))}super.updateMatrixWorld()});const e=new cd.MeshBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,side:cd.DoubleSide,fog:!1,toneMapped:!1}),t=new cd.LineBasicMaterial({depthTest:!1,depthWrite:!1,transparent:!0,linewidth:1,fog:!1,toneMapped:!1}),r=e.clone();r.opacity=.15;const i=e.clone();i.opacity=.33;const n=e.clone();n.color.set(0xff0000);const a=e.clone();a.color.set(65280);const o=e.clone();o.color.set(255);const s=e.clone();s.opacity=.25;const l=s.clone();l.color.set(0xffff00);const c=s.clone();c.color.set(65535);const h=s.clone();h.color.set(0xff00ff),e.clone().color.set(0xffff00);const u=t.clone();u.color.set(0xff0000);const A=t.clone();A.color.set(65280);const d=t.clone();d.color.set(255);const f=t.clone();f.color.set(65535);const m=t.clone();m.color.set(0xff00ff);const p=t.clone();p.color.set(0xffff00);const g=t.clone();g.color.set(7895160);const v=p.clone();v.opacity=.25;const y=new cd.CylinderGeometry(0,.05,.2,12,1,!1),x=new cd.BoxGeometry(.125,.125,.125),E=new cd.BufferGeometry;E.setAttribute("position",new cd.Float32BufferAttribute([0,0,0,1,0,0],3));const C=(e,t)=>{let r=new cd.BufferGeometry,i=[];for(let r=0;r<=64*t;++r)i.push(0,Math.cos(r/32*Math.PI)*e,Math.sin(r/32*Math.PI)*e);return r.setAttribute("position",new cd.Float32BufferAttribute(i,3)),r},B={X:[[new cd.Mesh(y,n),[1,0,0],[0,0,-Math.PI/2],null,"fwd"],[new cd.Mesh(y,n),[1,0,0],[0,0,Math.PI/2],null,"bwd"],[new cd.Line(E,u)]],Y:[[new cd.Mesh(y,a),[0,1,0],null,null,"fwd"],[new cd.Mesh(y,a),[0,1,0],[Math.PI,0,0],null,"bwd"],[new cd.Line(E,A),null,[0,0,Math.PI/2]]],Z:[[new cd.Mesh(y,o),[0,0,1],[Math.PI/2,0,0],null,"fwd"],[new cd.Mesh(y,o),[0,0,1],[-Math.PI/2,0,0],null,"bwd"],[new cd.Line(E,d),null,[0,-Math.PI/2,0]]],XYZ:[[new cd.Mesh(new cd.OctahedronGeometry(.1,0),s.clone()),[0,0,0],[0,0,0]]],XY:[[new cd.Mesh(new cd.PlaneGeometry(.295,.295),l.clone()),[.15,.15,0]],[new cd.Line(E,p),[.18,.3,0],null,[.125,1,1]],[new cd.Line(E,p),[.3,.18,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new cd.Mesh(new cd.PlaneGeometry(.295,.295),c.clone()),[0,.15,.15],[0,Math.PI/2,0]],[new cd.Line(E,f),[0,.18,.3],[0,0,Math.PI/2],[.125,1,1]],[new cd.Line(E,f),[0,.3,.18],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new cd.Mesh(new cd.PlaneGeometry(.295,.295),h.clone()),[.15,0,.15],[-Math.PI/2,0,0]],[new cd.Line(E,m),[.18,0,.3],null,[.125,1,1]],[new cd.Line(E,m),[.3,0,.18],[0,-Math.PI/2,0],[.125,1,1]]]},w={X:[[new cd.Mesh(new cd.CylinderGeometry(.2,0,1,4,1,!1),r),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new cd.Mesh(new cd.CylinderGeometry(.2,0,1,4,1,!1),r),[0,.6,0]]],Z:[[new cd.Mesh(new cd.CylinderGeometry(.2,0,1,4,1,!1),r),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new cd.Mesh(new cd.OctahedronGeometry(.2,0),r)]],XY:[[new cd.Mesh(new cd.PlaneGeometry(.4,.4),r),[.2,.2,0]]],YZ:[[new cd.Mesh(new cd.PlaneGeometry(.4,.4),r),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new cd.Mesh(new cd.PlaneGeometry(.4,.4),r),[.2,0,.2],[-Math.PI/2,0,0]]]},I={START:[[new cd.Mesh(new cd.OctahedronGeometry(.01,2),i),null,null,null,"helper"]],END:[[new cd.Mesh(new cd.OctahedronGeometry(.01,2),i),null,null,null,"helper"]],DELTA:[[new cd.Line((()=>{let e=new cd.BufferGeometry;return e.setAttribute("position",new cd.Float32BufferAttribute([0,0,0,1,1,1],3)),e})(),i),null,null,null,"helper"]],X:[[new cd.Line(E,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new cd.Line(E,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new cd.Line(E,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},b={X:[[new cd.Line(C(1,.5),u)],[new cd.Mesh(new cd.OctahedronGeometry(.04,0),n),[0,0,.99],null,[1,3,1]]],Y:[[new cd.Line(C(1,.5),A),null,[0,0,-Math.PI/2]],[new cd.Mesh(new cd.OctahedronGeometry(.04,0),a),[0,0,.99],null,[3,1,1]]],Z:[[new cd.Line(C(1,.5),d),null,[0,Math.PI/2,0]],[new cd.Mesh(new cd.OctahedronGeometry(.04,0),o),[.99,0,0],null,[1,3,1]]],E:[[new cd.Line(C(1.25,1),v),null,[0,Math.PI/2,0]],[new cd.Mesh(new cd.CylinderGeometry(.03,0,.15,4,1,!1),v),[1.17,0,0],[0,0,-Math.PI/2],[1,1,.001]],[new cd.Mesh(new cd.CylinderGeometry(.03,0,.15,4,1,!1),v),[-1.17,0,0],[0,0,Math.PI/2],[1,1,.001]],[new cd.Mesh(new cd.CylinderGeometry(.03,0,.15,4,1,!1),v),[0,-1.17,0],[Math.PI,0,0],[1,1,.001]],[new cd.Mesh(new cd.CylinderGeometry(.03,0,.15,4,1,!1),v),[0,1.17,0],[0,0,0],[1,1,.001]]],XYZE:[[new cd.Line(C(1,1),g),null,[0,Math.PI/2,0]]]},_={AXIS:[[new cd.Line(E,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},M={X:[[new cd.Mesh(new cd.TorusGeometry(1,.1,4,24),r),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new cd.Mesh(new cd.TorusGeometry(1,.1,4,24),r),[0,0,0],[Math.PI/2,0,0]]],Z:[[new cd.Mesh(new cd.TorusGeometry(1,.1,4,24),r),[0,0,0],[0,0,-Math.PI/2]]],E:[[new cd.Mesh(new cd.TorusGeometry(1.25,.1,2,24),r)]],XYZE:[[new cd.Mesh(new cd.SphereGeometry(.7,10,8),r)]]},S={X:[[new cd.Mesh(x,n),[.8,0,0],[0,0,-Math.PI/2]],[new cd.Line(E,u),null,null,[.8,1,1]]],Y:[[new cd.Mesh(x,a),[0,.8,0]],[new cd.Line(E,A),null,[0,0,Math.PI/2],[.8,1,1]]],Z:[[new cd.Mesh(x,o),[0,0,.8],[Math.PI/2,0,0]],[new cd.Line(E,d),null,[0,-Math.PI/2,0],[.8,1,1]]],XY:[[new cd.Mesh(x,l),[.85,.85,0],null,[2,2,.2]],[new cd.Line(E,p),[.855,.98,0],null,[.125,1,1]],[new cd.Line(E,p),[.98,.855,0],[0,0,Math.PI/2],[.125,1,1]]],YZ:[[new cd.Mesh(x,c),[0,.85,.85],null,[.2,2,2]],[new cd.Line(E,f),[0,.855,.98],[0,0,Math.PI/2],[.125,1,1]],[new cd.Line(E,f),[0,.98,.855],[0,-Math.PI/2,0],[.125,1,1]]],XZ:[[new cd.Mesh(x,h),[.85,0,.85],null,[2,.2,2]],[new cd.Line(E,m),[.855,0,.98],null,[.125,1,1]],[new cd.Line(E,m),[.98,0,.855],[0,-Math.PI/2,0],[.125,1,1]]],XYZX:[[new cd.Mesh(new cd.BoxGeometry(.125,.125,.125),s.clone()),[1.1,0,0]]],XYZY:[[new cd.Mesh(new cd.BoxGeometry(.125,.125,.125),s.clone()),[0,1.1,0]]],XYZZ:[[new cd.Mesh(new cd.BoxGeometry(.125,.125,.125),s.clone()),[0,0,1.1]]]},T={X:[[new cd.Mesh(new cd.CylinderGeometry(.2,0,.8,4,1,!1),r),[.5,0,0],[0,0,-Math.PI/2]]],Y:[[new cd.Mesh(new cd.CylinderGeometry(.2,0,.8,4,1,!1),r),[0,.5,0]]],Z:[[new cd.Mesh(new cd.CylinderGeometry(.2,0,.8,4,1,!1),r),[0,0,.5],[Math.PI/2,0,0]]],XY:[[new cd.Mesh(x,r),[.85,.85,0],null,[3,3,.2]]],YZ:[[new cd.Mesh(x,r),[0,.85,.85],null,[.2,3,3]]],XZ:[[new cd.Mesh(x,r),[.85,0,.85],null,[3,.2,3]]],XYZX:[[new cd.Mesh(new cd.BoxGeometry(.2,.2,.2),r),[1.1,0,0]]],XYZY:[[new cd.Mesh(new cd.BoxGeometry(.2,.2,.2),r),[0,1.1,0]]],XYZZ:[[new cd.Mesh(new cd.BoxGeometry(.2,.2,.2),r),[0,0,1.1]]]},D={X:[[new cd.Line(E,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new cd.Line(E,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new cd.Line(E,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},F=e=>{let t=new cd.Object3D;for(let r in e)for(let i=e[r].length;i--;){let n=e[r][i][0].clone(),a=e[r][i][1],o=e[r][i][2],s=e[r][i][3],l=e[r][i][4];n.name=r,n.tag=l,a&&n.position.set(a[0],a[1],a[2]),o&&n.rotation.set(o[0],o[1],o[2]),s&&n.scale.set(s[0],s[1],s[2]),n.updateMatrix();let c=n.geometry.clone();c.applyMatrix4(n.matrix),n.geometry=c,n.renderOrder=1/0,n.position.set(0,0,0),n.rotation.set(0,0,0),n.scale.set(1,1,1),t.add(n)}return t};this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=F(B)),this.add(this.gizmo.rotate=F(b)),this.add(this.gizmo.scale=F(S)),this.add(this.picker.translate=F(w)),this.add(this.picker.rotate=F(M)),this.add(this.picker.scale=F(T)),this.add(this.helper.translate=F(I)),this.add(this.helper.rotate=F(_)),this.add(this.helper.scale=F(D)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}}class cv extends cd.Mesh{constructor(){super(new cd.PlaneGeometry(1e5,1e5,2,2),new cd.MeshBasicMaterial({visible:!1,wireframe:!0,side:cd.DoubleSide,transparent:!0,opacity:.1,toneMapped:!1})),cm(this,"isTransformControlsPlane",!0),cm(this,"type","TransformControlsPlane"),cm(this,"unitX",new cd.Vector3(1,0,0)),cm(this,"unitY",new cd.Vector3(0,1,0)),cm(this,"unitZ",new cd.Vector3(0,0,1)),cm(this,"tempVector",new cd.Vector3),cm(this,"dirVector",new cd.Vector3),cm(this,"alignVector",new cd.Vector3),cm(this,"tempMatrix",new cd.Matrix4),cm(this,"identityQuaternion",new cd.Quaternion),cm(this,"cameraQuaternion",new cd.Quaternion),cm(this,"worldPosition",new cd.Vector3),cm(this,"worldQuaternion",new cd.Quaternion),cm(this,"eye",new cd.Vector3),cm(this,"axis",null),cm(this,"mode","translate"),cm(this,"space","world"),cm(this,"updateMatrixWorld",()=>{let e=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(e="local"),this.unitX.set(1,0,0).applyQuaternion("local"===e?this.worldQuaternion:this.identityQuaternion),this.unitY.set(0,1,0).applyQuaternion("local"===e?this.worldQuaternion:this.identityQuaternion),this.unitZ.set(0,0,1).applyQuaternion("local"===e?this.worldQuaternion:this.identityQuaternion),this.alignVector.copy(this.unitY),this.mode){case"translate":case"scale":switch(this.axis){case"X":this.alignVector.copy(this.eye).cross(this.unitX),this.dirVector.copy(this.unitX).cross(this.alignVector);break;case"Y":this.alignVector.copy(this.eye).cross(this.unitY),this.dirVector.copy(this.unitY).cross(this.alignVector);break;case"Z":this.alignVector.copy(this.eye).cross(this.unitZ),this.dirVector.copy(this.unitZ).cross(this.alignVector);break;case"XY":this.dirVector.copy(this.unitZ);break;case"YZ":this.dirVector.copy(this.unitX);break;case"XZ":this.alignVector.copy(this.unitZ),this.dirVector.copy(this.unitY);break;case"XYZ":case"E":this.dirVector.set(0,0,0)}break;default:this.dirVector.set(0,0,0)}0===this.dirVector.length()?this.quaternion.copy(this.cameraQuaternion):(this.tempMatrix.lookAt(this.tempVector.set(0,0,0),this.dirVector,this.alignVector),this.quaternion.setFromRotationMatrix(this.tempMatrix)),super.updateMatrixWorld()})}}let cy=tC.forwardRef(({children:e,domElement:t,onChange:r,onMouseDown:i,onMouseUp:n,onObjectChange:a,object:o,makeDefault:s,camera:l,enabled:c,axis:h,mode:u,translationSnap:A,rotationSnap:d,scaleSnap:f,space:m,size:p,showX:g,showY:v,showZ:y,...x},E)=>{let C=(0,tI.C)(e=>e.controls),B=(0,tI.C)(e=>e.gl),w=(0,tI.C)(e=>e.events),I=(0,tI.C)(e=>e.camera),b=(0,tI.C)(e=>e.invalidate),_=(0,tI.C)(e=>e.get),M=(0,tI.C)(e=>e.set),S=l||I,T=t||w.connected||B.domElement,D=tC.useMemo(()=>new cp(S,T),[S,T]),F=tC.useRef(null);tC.useLayoutEffect(()=>(o?D.attach(o instanceof tw.Object3D?o:o.current):F.current instanceof tw.Object3D&&D.attach(F.current),()=>void D.detach()),[o,e,D]),tC.useEffect(()=>{if(C){let e=e=>C.enabled=!e.value;return D.addEventListener("dragging-changed",e),()=>D.removeEventListener("dragging-changed",e)}},[D,C]);let R=tC.useRef(void 0),P=tC.useRef(void 0),Q=tC.useRef(void 0),U=tC.useRef(void 0);return tC.useLayoutEffect(()=>void(R.current=r),[r]),tC.useLayoutEffect(()=>void(P.current=i),[i]),tC.useLayoutEffect(()=>void(Q.current=n),[n]),tC.useLayoutEffect(()=>void(U.current=a),[a]),tC.useEffect(()=>{let e=e=>{b(),null==R.current||R.current(e)},t=e=>null==P.current?void 0:P.current(e),r=e=>null==Q.current?void 0:Q.current(e),i=e=>null==U.current?void 0:U.current(e);return D.addEventListener("change",e),D.addEventListener("mouseDown",t),D.addEventListener("mouseUp",r),D.addEventListener("objectChange",i),()=>{D.removeEventListener("change",e),D.removeEventListener("mouseDown",t),D.removeEventListener("mouseUp",r),D.removeEventListener("objectChange",i)}},[b,D]),tC.useEffect(()=>{if(s){let e=_().controls;return M({controls:D}),()=>M({controls:e})}},[s,D]),tC.createElement(tC.Fragment,null,tC.createElement("primitive",{ref:E,object:D,enabled:c,axis:h,mode:u,translationSnap:A,rotationSnap:d,scaleSnap:f,space:m,size:p,showX:g,showY:v,showZ:y}),tC.createElement("group",e2({ref:F},x),e))});var tI=tI,cx=Object.defineProperty,cE=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?cx(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r,r};let cC=new tw.Euler(0,0,0,"YXZ"),cB=new tw.Vector3,cw={type:"change"},cI={type:"lock"},cb={type:"unlock"},c_=Math.PI/2;class cM extends lN{constructor(e,t){super(),cE(this,"camera"),cE(this,"domElement"),cE(this,"isLocked"),cE(this,"minPolarAngle"),cE(this,"maxPolarAngle"),cE(this,"pointerSpeed"),cE(this,"onMouseMove",e=>{this.domElement&&!1!==this.isLocked&&(cC.setFromQuaternion(this.camera.quaternion),cC.y-=.002*e.movementX*this.pointerSpeed,cC.x-=.002*e.movementY*this.pointerSpeed,cC.x=Math.max(c_-this.maxPolarAngle,Math.min(c_-this.minPolarAngle,cC.x)),this.camera.quaternion.setFromEuler(cC),this.dispatchEvent(cw))}),cE(this,"onPointerlockChange",()=>{this.domElement&&(this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(cI),this.isLocked=!0):(this.dispatchEvent(cb),this.isLocked=!1))}),cE(this,"onPointerlockError",()=>{console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}),cE(this,"connect",e=>{this.domElement=e||this.domElement,this.domElement&&(this.domElement.ownerDocument.addEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this.onPointerlockError))}),cE(this,"disconnect",()=>{this.domElement&&(this.domElement.ownerDocument.removeEventListener("mousemove",this.onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this.onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this.onPointerlockError))}),cE(this,"dispose",()=>{this.disconnect()}),cE(this,"getObject",()=>this.camera),cE(this,"direction",new tw.Vector3(0,0,-1)),cE(this,"getDirection",e=>e.copy(this.direction).applyQuaternion(this.camera.quaternion)),cE(this,"moveForward",e=>{cB.setFromMatrixColumn(this.camera.matrix,0),cB.crossVectors(this.camera.up,cB),this.camera.position.addScaledVector(cB,e)}),cE(this,"moveRight",e=>{cB.setFromMatrixColumn(this.camera.matrix,0),this.camera.position.addScaledVector(cB,e)}),cE(this,"lock",()=>{this.domElement&&this.domElement.requestPointerLock()}),cE(this,"unlock",()=>{this.domElement&&this.domElement.ownerDocument.exitPointerLock()}),this.camera=e,this.domElement=t,this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,t&&this.connect(t)}}let cS=tC.forwardRef(({domElement:e,selector:t,onChange:r,onLock:i,onUnlock:n,enabled:a=!0,makeDefault:o,...s},l)=>{let{camera:c,...h}=s,u=(0,tI.C)(e=>e.setEvents),A=(0,tI.C)(e=>e.gl),d=(0,tI.C)(e=>e.camera),f=(0,tI.C)(e=>e.invalidate),m=(0,tI.C)(e=>e.events),p=(0,tI.C)(e=>e.get),g=(0,tI.C)(e=>e.set),v=c||d,y=e||m.connected||A.domElement,x=tC.useMemo(()=>new cM(v),[v]);return tC.useEffect(()=>{if(a){x.connect(y);let e=p().events.compute;return u({compute(e,t){let r=t.size.width/2,i=t.size.height/2;t.pointer.set(r/t.size.width*2-1,-(2*(i/t.size.height))+1),t.raycaster.setFromCamera(t.pointer,t.camera)}}),()=>{x.disconnect(),u({compute:e})}}},[a,x]),tC.useEffect(()=>{let e=e=>{f(),r&&r(e)};x.addEventListener("change",e),i&&x.addEventListener("lock",i),n&&x.addEventListener("unlock",n);let a=()=>x.lock(),o=t?Array.from(document.querySelectorAll(t)):[document];return o.forEach(e=>e&&e.addEventListener("click",a)),()=>{x.removeEventListener("change",e),i&&x.removeEventListener("lock",i),n&&x.removeEventListener("unlock",n),o.forEach(e=>e?e.removeEventListener("click",a):void 0)}},[r,i,n,t,x,f]),tC.useEffect(()=>{if(o){let e=p().controls;return g({controls:x}),()=>g({controls:e})}},[o,x]),tC.createElement("primitive",e2({ref:l,object:x},h))});var tI=tI,cT=Object.defineProperty,cD=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?cT(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r,r};let cF=new tw.Vector3;class cR extends lN{constructor(e,t){super(),cD(this,"object"),cD(this,"domElement"),cD(this,"enabled",!0),cD(this,"movementSpeed",1),cD(this,"lookSpeed",.005),cD(this,"lookVertical",!0),cD(this,"autoForward",!1),cD(this,"activeLook",!0),cD(this,"heightSpeed",!1),cD(this,"heightCoef",1),cD(this,"heightMin",0),cD(this,"heightMax",1),cD(this,"constrainVertical",!1),cD(this,"verticalMin",0),cD(this,"verticalMax",Math.PI),cD(this,"mouseDragOn",!1),cD(this,"autoSpeedFactor",0),cD(this,"mouseX",0),cD(this,"mouseY",0),cD(this,"moveForward",!1),cD(this,"moveBackward",!1),cD(this,"moveLeft",!1),cD(this,"moveRight",!1),cD(this,"moveUp",!1),cD(this,"moveDown",!1),cD(this,"viewHalfX",0),cD(this,"viewHalfY",0),cD(this,"lat",0),cD(this,"lon",0),cD(this,"lookDirection",new tw.Vector3),cD(this,"spherical",new tw.Spherical),cD(this,"target",new tw.Vector3),cD(this,"connect",e=>{e.setAttribute("tabindex","-1"),e.style.touchAction="none",e.addEventListener("contextmenu",this.contextmenu),e.addEventListener("mousemove",this.onMouseMove),e.addEventListener("mousedown",this.onMouseDown),e.addEventListener("mouseup",this.onMouseUp),this.domElement=e,window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),this.handleResize()}),cD(this,"dispose",()=>{var e,t,r,i;null==(e=this.domElement)||e.removeEventListener("contextmenu",this.contextmenu),null==(t=this.domElement)||t.removeEventListener("mousedown",this.onMouseDown),null==(r=this.domElement)||r.removeEventListener("mousemove",this.onMouseMove),null==(i=this.domElement)||i.removeEventListener("mouseup",this.onMouseUp),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp)}),cD(this,"handleResize",()=>{this.domElement&&(this.viewHalfX=this.domElement.offsetWidth/2,this.viewHalfY=this.domElement.offsetHeight/2)}),cD(this,"onMouseDown",e=>{var t;if(null==(t=this.domElement)||t.focus(),this.activeLook)switch(e.button){case 0:this.moveForward=!0;break;case 2:this.moveBackward=!0}this.mouseDragOn=!0}),cD(this,"onMouseUp",e=>{if(this.activeLook)switch(e.button){case 0:this.moveForward=!1;break;case 2:this.moveBackward=!1}this.mouseDragOn=!1}),cD(this,"onMouseMove",e=>{this.domElement&&(this.mouseX=e.pageX-this.domElement.offsetLeft-this.viewHalfX,this.mouseY=e.pageY-this.domElement.offsetTop-this.viewHalfY)}),cD(this,"onKeyDown",e=>{switch(e.code){case"ArrowUp":case"KeyW":this.moveForward=!0;break;case"ArrowLeft":case"KeyA":this.moveLeft=!0;break;case"ArrowDown":case"KeyS":this.moveBackward=!0;break;case"ArrowRight":case"KeyD":this.moveRight=!0;break;case"KeyR":this.moveUp=!0;break;case"KeyF":this.moveDown=!0}}),cD(this,"onKeyUp",e=>{switch(e.code){case"ArrowUp":case"KeyW":this.moveForward=!1;break;case"ArrowLeft":case"KeyA":this.moveLeft=!1;break;case"ArrowDown":case"KeyS":this.moveBackward=!1;break;case"ArrowRight":case"KeyD":this.moveRight=!1;break;case"KeyR":this.moveUp=!1;break;case"KeyF":this.moveDown=!1}}),cD(this,"lookAt",(e,t,r)=>(e instanceof tw.Vector3?this.target.copy(e):t&&r&&this.target.set(e,t,r),this.object.lookAt(this.target),this.setOrientation(),this)),cD(this,"update",e=>{if(!this.enabled)return;if(this.heightSpeed){let t=tw.MathUtils.clamp(this.object.position.y,this.heightMin,this.heightMax)-this.heightMin;this.autoSpeedFactor=e*(t*this.heightCoef)}else this.autoSpeedFactor=0;let t=e*this.movementSpeed;(this.moveForward||this.autoForward&&!this.moveBackward)&&this.object.translateZ(-(t+this.autoSpeedFactor)),this.moveBackward&&this.object.translateZ(t),this.moveLeft&&this.object.translateX(-t),this.moveRight&&this.object.translateX(t),this.moveUp&&this.object.translateY(t),this.moveDown&&this.object.translateY(-t);let r=e*this.lookSpeed;this.activeLook||(r=0);let i=1;this.constrainVertical&&(i=Math.PI/(this.verticalMax-this.verticalMin)),this.lon-=this.mouseX*r,this.lookVertical&&(this.lat-=this.mouseY*r*i),this.lat=Math.max(-85,Math.min(85,this.lat));let n=tw.MathUtils.degToRad(90-this.lat),a=tw.MathUtils.degToRad(this.lon);this.constrainVertical&&(n=tw.MathUtils.mapLinear(n,0,Math.PI,this.verticalMin,this.verticalMax));let o=this.object.position;cF.setFromSphericalCoords(1,n,a).add(o),this.object.lookAt(cF)}),cD(this,"contextmenu",e=>e.preventDefault()),cD(this,"setOrientation",()=>{this.lookDirection.set(0,0,-1).applyQuaternion(this.object.quaternion),this.spherical.setFromVector3(this.lookDirection),this.lat=90-tw.MathUtils.radToDeg(this.spherical.phi),this.lon=tw.MathUtils.radToDeg(this.spherical.theta)}),this.object=e,this.domElement=t,this.setOrientation(),t&&this.connect(t)}}let cP=tC.forwardRef(({domElement:e,makeDefault:t,...r},i)=>{let n=(0,tI.C)(e=>e.camera),a=(0,tI.C)(e=>e.gl),o=(0,tI.C)(e=>e.events),s=(0,tI.C)(e=>e.get),l=(0,tI.C)(e=>e.set),c=e||o.connected||a.domElement,[h]=tC.useState(()=>new cR(n,c));return tC.useEffect(()=>{if(t){let e=s().controls;return l({controls:h}),()=>l({controls:e})}},[t,h]),(0,tb.useFrame)((e,t)=>{h.update(t)},-1),h?tC.createElement("primitive",e2({ref:i,object:h},r)):null});var on=tI,tI=tI;let cQ=(0,tC.forwardRef)((e,t)=>{let{impl:r,camera:i,domElement:n,makeDefault:a,onControlStart:o,onControl:s,onControlEnd:l,onTransitionStart:c,onUpdate:h,onWake:u,onRest:A,onSleep:d,onStart:f,onEnd:m,onChange:p,regress:g,...v}=e,y=null!=r?r:e0;(0,tC.useMemo)(()=>{let e={Box3:tw.Box3,MathUtils:{clamp:tw.MathUtils.clamp},Matrix4:tw.Matrix4,Quaternion:tw.Quaternion,Raycaster:tw.Raycaster,Sphere:tw.Sphere,Spherical:tw.Spherical,Vector2:tw.Vector2,Vector3:tw.Vector3,Vector4:tw.Vector4};y.install({THREE:e}),(0,on.e)({CameraControlsImpl:y})},[y]);let x=(0,tI.C)(e=>e.camera),E=(0,tI.C)(e=>e.gl),C=(0,tI.C)(e=>e.invalidate),B=(0,tI.C)(e=>e.events),w=(0,tI.C)(e=>e.setEvents),I=(0,tI.C)(e=>e.set),b=(0,tI.C)(e=>e.get),_=(0,tI.C)(e=>e.performance),M=i||x,S=n||B.connected||E.domElement,T=(0,tC.useMemo)(()=>new y(M),[y,M]);return(0,tb.useFrame)((e,t)=>{T.update(t)},-1),(0,tC.useEffect)(()=>(T.connect(S),()=>void T.disconnect()),[S,T]),(0,tC.useEffect)(()=>{function e(){C(),g&&_.regress()}let t=t=>{e(),null==o||o(t),null==f||f(t)},r=t=>{e(),null==s||s(t),null==p||p(t)},i=e=>{null==l||l(e),null==m||m(e)},n=t=>{e(),null==c||c(t),null==p||p(t)},a=t=>{e(),null==h||h(t),null==p||p(t)},v=t=>{e(),null==u||u(t),null==p||p(t)},y=e=>{null==A||A(e)},x=e=>{null==d||d(e)};return T.addEventListener("controlstart",t),T.addEventListener("control",r),T.addEventListener("controlend",i),T.addEventListener("transitionstart",n),T.addEventListener("update",a),T.addEventListener("wake",v),T.addEventListener("rest",y),T.addEventListener("sleep",x),()=>{T.removeEventListener("controlstart",t),T.removeEventListener("control",r),T.removeEventListener("controlend",i),T.removeEventListener("transitionstart",n),T.removeEventListener("update",a),T.removeEventListener("wake",v),T.removeEventListener("rest",y),T.removeEventListener("sleep",x)}},[T,C,w,g,_,o,s,l,c,h,u,A,d,p,f,m]),(0,tC.useEffect)(()=>{if(a){let e=b().controls;return I({controls:T}),()=>I({controls:e})}},[a,T]),tC.createElement("primitive",e2({ref:t,object:T},v))});var tI=tI,cU=tI;let cz=tC.createContext(null);function ck(){let e=tC.useContext(cz);if(!e)throw Error("useMotion hook must be used in a MotionPathControls component.");return e}function cL({points:e=50,color:t="black"}){let{path:r}=ck(),[i,n]=tC.useState([]),a=tC.useMemo(()=>new tw.MeshBasicMaterial({color:t}),[t]),o=tC.useMemo(()=>new tw.SphereGeometry(.025,16,16),[]),s=tC.useRef([]);return tC.useEffect(()=>{r.curves!==s.current&&(n(r.getPoints(e)),s.current=r.curves)}),i.map((e,t)=>tC.createElement("mesh",{key:t,material:a,geometry:o,position:[e.x,e.y,e.z]}))}let cO=tC.forwardRef(({children:e,curves:t=[],debug:r=!1,debugColor:i="black",object:n,focus:a,loop:o=!0,offset:s,smooth:l=!1,eps:c=1e-5,damping:h=.1,focusDamping:u=.1,maxSpeed:A=1/0,...d},f)=>{let{camera:m}=(0,tI.C)(),p=tC.useRef(null),g=tC.useRef(null!=s?s:0),v=tC.useMemo(()=>new tw.CurvePath,[]),y=tC.useMemo(()=>({focus:a,object:(null==n?void 0:n.current)instanceof tw.Object3D?n:{current:m},path:v,current:g.current,offset:g.current,point:new tw.Vector3,tangent:new tw.Vector3,next:new tw.Vector3}),[a,n]),x=(0,cU.z)(p);tC.useLayoutEffect(()=>{let e=x.current;v.curves=[];let r=t.length>0?t:e.children.map(e=>e.object);for(let e=0;e<r.length;e++)v.add(r[e]);if(l){let e=v.getPoints("number"==typeof l?l:1);v.curves=[new tw.CatmullRomCurve3(e)]}v.updateArcLengths()}),tC.useImperativeHandle(f,()=>Object.assign(p.current,{motion:y}),[y]),tC.useLayoutEffect(()=>{g.current=io.repeat(g.current,1)},[s]);let E=tC.useMemo(()=>new tw.Vector3,[]);return(0,tb.useFrame)((e,t)=>{let r=y.offset;if(iN.damp(g,"current",void 0!==s?s:y.current,h,t,A,void 0,c),y.offset=o?io.repeat(g.current,1):io.clamp(g.current,0,1),v.getCurveLengths().length>0){v.getPointAt(y.offset,y.point),v.getTangentAt(y.offset,y.tangent).normalize(),v.getPointAt(io.repeat(g.current-(r-y.offset),1),y.next);let e=(null==n?void 0:n.current)instanceof tw.Object3D?n.current:m;e.position.copy(y.point),a&&iN.dampLookAt(e,(null==a?void 0:a.current)instanceof tw.Object3D?a.current.getWorldPosition(E):a,u,t,A,void 0,c)}}),tC.createElement("group",e2({ref:p},d),tC.createElement(cz.Provider,{value:y},e,r&&tC.createElement(cL,{color:i})))});var tI=tI,tI=tI,o4=tI;function cG({defaultScene:e,defaultCamera:t,renderPriority:r=1}){let i,{gl:n,scene:a,camera:o}=(0,tI.C)();return(0,tb.useFrame)(()=>{i=n.autoClear,1===r&&(n.autoClear=!0,n.render(e,t)),n.autoClear=!1,n.clearDepth(),n.render(a,o),n.autoClear=i},r),tC.createElement("group",{onPointerOver:()=>null})}function cN({children:e,renderPriority:t=1}){let{scene:r,camera:i}=(0,tI.C)(),[n]=tC.useState(()=>new tw.Scene);return tC.createElement(tC.Fragment,null,(0,o4.o)(tC.createElement(tC.Fragment,null,e,tC.createElement(cG,{defaultScene:r,defaultCamera:i,renderPriority:t})),n,{events:{priority:t+1}}))}let cH=tC.createContext({}),cV=()=>tC.useContext(cH),cj=2*Math.PI,cJ=new tw.Object3D,cY=new tw.Matrix4,[cW,cK]=[new tw.Quaternion,new tw.Quaternion],cX=new tw.Vector3,cq=new tw.Vector3,cZ=({alignment:e="bottom-right",margin:t=[80,80],renderPriority:r=1,onUpdate:i,onTarget:n,children:a})=>{let o=(0,tI.C)(e=>e.size),s=(0,tI.C)(e=>e.camera),l=(0,tI.C)(e=>e.controls),c=(0,tI.C)(e=>e.invalidate),h=tC.useRef(null),u=tC.useRef(null),A=tC.useRef(!1),d=tC.useRef(0),f=tC.useRef(new tw.Vector3(0,0,0)),m=tC.useRef(new tw.Vector3(0,0,0));tC.useEffect(()=>{m.current.copy(s.up),cJ.up.copy(s.up)},[s]);let p=tC.useCallback(e=>{A.current=!0,(l||n)&&(f.current=(null==n?void 0:n())||("getTarget"in l?l.getTarget(f.current):null==l?void 0:l.target)),d.current=s.position.distanceTo(cX),cW.copy(s.quaternion),cq.copy(e).multiplyScalar(d.current).add(cX),cJ.lookAt(cq),cK.copy(cJ.quaternion),c()},[l,s,n,c]);(0,tb.useFrame)((e,t)=>{if(u.current&&h.current){var r;A.current&&(.01>cW.angleTo(cK)?(A.current=!1,"minPolarAngle"in l&&s.up.copy(m.current)):(cW.rotateTowards(cK,t*cj),s.position.set(0,0,1).applyQuaternion(cW).multiplyScalar(d.current).add(f.current),s.up.set(0,1,0).applyQuaternion(cW).normalize(),s.quaternion.copy(cW),"getTarget"in l&&l.setPosition(s.position.x,s.position.y,s.position.z),i?i():l&&l.update(t),c())),cY.copy(s.matrix).invert(),null==(r=h.current)||r.quaternion.setFromRotationMatrix(cY)}});let g=tC.useMemo(()=>({tweenCamera:p}),[p]),[v,y]=t,x=e.endsWith("-center")?0:e.endsWith("-left")?-o.width/2+v:o.width/2-v,E=e.startsWith("center-")?0:e.startsWith("top-")?o.height/2-y:-o.height/2+y;return tC.createElement(cN,{renderPriority:r},tC.createElement(cH.Provider,{value:g},tC.createElement(lz,{makeDefault:!0,ref:u,position:[0,0,200]}),tC.createElement("group",{ref:h,position:[x,E,0]},a)))};var tI=tI;let c$="#f0f0f0",c1="#999",c0="black",c2="black",c3=["Right","Left","Top","Bottom","Front","Back"],c4=e=>new tw.Vector3(...e).multiplyScalar(.38),c5=[[1,1,1],[1,1,-1],[1,-1,1],[1,-1,-1],[-1,1,1],[-1,1,-1],[-1,-1,1],[-1,-1,-1]].map(c4),c6=[.25,.25,.25],c8=[[1,1,0],[1,0,1],[1,0,-1],[1,-1,0],[0,1,1],[0,1,-1],[0,-1,1],[0,-1,-1],[-1,1,0],[-1,0,1],[-1,0,-1],[-1,-1,0]].map(c4),c9=c8.map(e=>e.toArray().map(e=>0==e?.5:.25)),c7=({hover:e,index:t,font:r="20px Inter var, Arial, sans-serif",faces:i=c3,color:n=c$,hoverColor:a=c1,textColor:o=c0,strokeColor:s=c2,opacity:l=1})=>{let c=(0,tI.C)(e=>e.gl),h=tC.useMemo(()=>{let e=document.createElement("canvas");e.width=128,e.height=128;let a=e.getContext("2d");return a.fillStyle=n,a.fillRect(0,0,e.width,e.height),a.strokeStyle=s,a.strokeRect(0,0,e.width,e.height),a.font=r,a.textAlign="center",a.fillStyle=o,a.fillText(i[t].toUpperCase(),64,76),new tw.CanvasTexture(e)},[t,i,r,n,o,s]);return tC.createElement("meshBasicMaterial",{map:h,"map-anisotropy":c.capabilities.getMaxAnisotropy()||1,attach:`material-${t}`,color:e?a:"white",transparent:!0,opacity:l})},he=e=>{let{tweenCamera:t}=cV(),[r,i]=tC.useState(null);return tC.createElement("mesh",{onPointerOut:e=>{e.stopPropagation(),i(null)},onPointerMove:e=>{e.stopPropagation(),i(Math.floor(e.faceIndex/2))},onClick:e.onClick||(e=>{e.stopPropagation(),t(e.face.normal)})},[...Array(6)].map((t,i)=>tC.createElement(c7,e2({key:i,index:i,hover:r===i},e))),tC.createElement("boxGeometry",null))},ht=({onClick:e,dimensions:t,position:r,hoverColor:i=c1})=>{let{tweenCamera:n}=cV(),[a,o]=tC.useState(!1);return tC.createElement("mesh",{scale:1.01,position:r,onPointerOver:e=>{e.stopPropagation(),o(!0)},onPointerOut:e=>{e.stopPropagation(),o(!1)},onClick:e||(e=>{e.stopPropagation(),n(r)})},tC.createElement("meshBasicMaterial",{color:a?i:"white",transparent:!0,opacity:.6,visible:a}),tC.createElement("boxGeometry",{args:t}))},hr=e=>tC.createElement("group",{scale:[60,60,60]},tC.createElement(he,e),c8.map((t,r)=>tC.createElement(ht,e2({key:r,position:t,dimensions:c9[r]},e))),c5.map((t,r)=>tC.createElement(ht,e2({key:r,position:t,dimensions:c6},e))));var tI=tI;function hi({scale:e=[.8,.05,.05],color:t,rotation:r}){return tC.createElement("group",{rotation:r},tC.createElement("mesh",{position:[.4,0,0]},tC.createElement("boxGeometry",{args:e}),tC.createElement("meshBasicMaterial",{color:t,toneMapped:!1})))}function hn({onClick:e,font:t,disabled:r,arcStyle:i,label:n,labelColor:a,axisHeadScale:o=1,...s}){let l=(0,tI.C)(e=>e.gl),c=tC.useMemo(()=>{let e=document.createElement("canvas");e.width=64,e.height=64;let r=e.getContext("2d");return r.beginPath(),r.arc(32,32,16,0,2*Math.PI),r.closePath(),r.fillStyle=i,r.fill(),n&&(r.font=t,r.textAlign="center",r.fillStyle=a,r.fillText(n,32,41)),new tw.CanvasTexture(e)},[i,n,a,t]),[h,u]=tC.useState(!1),A=(n?1:.75)*(h?1.2:1)*o;return tC.createElement("sprite",e2({scale:A,onPointerOver:r?void 0:e=>{e.stopPropagation(),u(!0)},onPointerOut:r?void 0:e||(e=>{e.stopPropagation(),u(!1)})},s),tC.createElement("spriteMaterial",{map:c,"map-anisotropy":l.capabilities.getMaxAnisotropy()||1,alphaTest:.3,opacity:n?1:.75,toneMapped:!1}))}let ha=({hideNegativeAxes:e,hideAxisHeads:t,disabled:r,font:i="18px Inter var, Arial, sans-serif",axisColors:n=["#ff2060","#20df80","#2080ff"],axisHeadScale:a=1,axisScale:o,labels:s=["X","Y","Z"],labelColor:l="#000",onClick:c,...h})=>{let[u,A,d]=n,{tweenCamera:f}=cV(),m={font:i,disabled:r,labelColor:l,onClick:c,axisHeadScale:a,onPointerDown:r?void 0:e=>{f(e.object.position),e.stopPropagation()}};return tC.createElement("group",e2({scale:40},h),tC.createElement(hi,{color:u,rotation:[0,0,0],scale:o}),tC.createElement(hi,{color:A,rotation:[0,0,Math.PI/2],scale:o}),tC.createElement(hi,{color:d,rotation:[0,-Math.PI/2,0],scale:o}),!t&&tC.createElement(tC.Fragment,null,tC.createElement(hn,e2({arcStyle:u,position:[1,0,0],label:s[0]},m)),tC.createElement(hn,e2({arcStyle:A,position:[0,1,0],label:s[1]},m)),tC.createElement(hn,e2({arcStyle:d,position:[0,0,1],label:s[2]},m)),!e&&tC.createElement(tC.Fragment,null,tC.createElement(hn,e2({arcStyle:u,position:[-1,0,0]},m)),tC.createElement(hn,e2({arcStyle:A,position:[0,-1,0]},m)),tC.createElement(hn,e2({arcStyle:d,position:[0,0,-1]},m)))))};var ho=tw,on=tI;let hs=oV({cellSize:.5,sectionSize:1,fadeDistance:100,fadeStrength:1,fadeFrom:1,cellThickness:.5,sectionThickness:1,cellColor:new ho.Color,sectionColor:new ho.Color,infiniteGrid:!1,followCamera:!1,worldCamProjPosition:new ho.Vector3,worldPlanePosition:new ho.Vector3},`
    varying vec3 localPosition;
    varying vec4 worldPosition;

    uniform vec3 worldCamProjPosition;
    uniform vec3 worldPlanePosition;
    uniform float fadeDistance;
    uniform bool infiniteGrid;
    uniform bool followCamera;

    void main() {
      localPosition = position.xzy;
      if (infiniteGrid) localPosition *= 1.0 + fadeDistance;
      
      worldPosition = modelMatrix * vec4(localPosition, 1.0);
      if (followCamera) {
        worldPosition.xyz += (worldCamProjPosition - worldPlanePosition);
        localPosition = (inverse(modelMatrix) * worldPosition).xyz;
      }

      gl_Position = projectionMatrix * viewMatrix * worldPosition;
    }
  `,`
    varying vec3 localPosition;
    varying vec4 worldPosition;

    uniform vec3 worldCamProjPosition;
    uniform float cellSize;
    uniform float sectionSize;
    uniform vec3 cellColor;
    uniform vec3 sectionColor;
    uniform float fadeDistance;
    uniform float fadeStrength;
    uniform float fadeFrom;
    uniform float cellThickness;
    uniform float sectionThickness;

    float getGrid(float size, float thickness) {
      vec2 r = localPosition.xz / size;
      vec2 grid = abs(fract(r - 0.5) - 0.5) / fwidth(r);
      float line = min(grid.x, grid.y) + 1.0 - thickness;
      return 1.0 - min(line, 1.0);
    }

    void main() {
      float g1 = getGrid(cellSize, cellThickness);
      float g2 = getGrid(sectionSize, sectionThickness);

      vec3 from = worldCamProjPosition*vec3(fadeFrom);
      float dist = distance(from, worldPosition.xyz);
      float d = 1.0 - min(dist / fadeDistance, 1.0);
      vec3 color = mix(cellColor, sectionColor, min(1.0, sectionThickness * g2));

      gl_FragColor = vec4(color, (g1 + g2) * pow(d, fadeStrength));
      gl_FragColor.a = mix(0.75 * gl_FragColor.a, gl_FragColor.a, g2);
      if (gl_FragColor.a <= 0.0) discard;

      #include <tonemapping_fragment>
      #include <${oW>=154?"colorspace_fragment":"encodings_fragment"}>
    }
  `),hl=tC.forwardRef(({args:e,cellColor:t="#000000",sectionColor:r="#2080ff",cellSize:i=.5,sectionSize:n=1,followCamera:a=!1,infiniteGrid:o=!1,fadeDistance:s=100,fadeStrength:l=1,fadeFrom:c=1,cellThickness:h=.5,sectionThickness:u=1,side:A=ho.BackSide,...d},f)=>{(0,on.e)({GridMaterial:hs});let m=tC.useRef(null);tC.useImperativeHandle(f,()=>m.current,[]);let p=new ho.Plane,g=new ho.Vector3(0,1,0),v=new ho.Vector3(0,0,0);return(0,tb.useFrame)(e=>{p.setFromNormalAndCoplanarPoint(g,v).applyMatrix4(m.current.matrixWorld);let t=m.current.material,r=t.uniforms.worldCamProjPosition,i=t.uniforms.worldPlanePosition;p.projectPoint(e.camera.position,r.value),i.value.set(0,0,0).applyMatrix4(m.current.matrixWorld)}),tC.createElement("mesh",e2({ref:m,frustumCulled:!1},d),tC.createElement("gridMaterial",e2({transparent:!0,"extensions-derivatives":!0,side:A},{cellSize:i,sectionSize:n,cellColor:t,sectionColor:r,cellThickness:h,sectionThickness:u},{fadeDistance:s,fadeStrength:l,fadeFrom:c,infiniteGrid:o,followCamera:a})),tC.createElement("planeGeometry",{args:e}))});var nX=tI;function hc(e,{path:t}){let[r]=(0,nX.G)(tw.CubeTextureLoader,[e],e=>e.setPath(t));return r}function hh({children:e,files:t,...r}){let i=hc(t,{...r});return tC.createElement(tC.Fragment,null,null==e?void 0:e(i))}hc.preload=(e,{path:t})=>nX.G.preload(tw.CubeTextureLoader,[e],e=>e.setPath(t));var hu=tw,hA={},hd=function(e,t,r,i,n){var a=new Worker(hA[t]||(hA[t]=URL.createObjectURL(new Blob([e],{type:"text/javascript"}))));return a.onerror=function(e){return n(e.error,null)},a.onmessage=function(e){return n(null,e.data)},a.postMessage(r,i),a},hf=Uint8Array,hm=Uint16Array,hp=Uint32Array,hg=new hf([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),hv=new hf([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),hy=new hf([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),hx=function(e,t){for(var r=new hm(31),i=0;i<31;++i)r[i]=t+=1<<e[i-1];for(var n=new hp(r[30]),i=1;i<30;++i)for(var a=r[i];a<r[i+1];++a)n[a]=a-r[i]<<5|i;return[r,n]},hE=hx(hg,2),hC=hE[0],hB=hE[1];hC[28]=258,hB[258]=28;for(var hw=hx(hv,0),hI=hw[0],hb=hw[1],h_=new hm(32768),hM=0;hM<32768;++hM){var hS=(43690&hM)>>>1|(21845&hM)<<1;hS=(61680&(hS=(52428&hS)>>>2|(13107&hS)<<2))>>>4|(3855&hS)<<4,h_[hM]=((65280&hS)>>>8|(255&hS)<<8)>>>1}for(var hT=function(e,t,r){for(var i,n=e.length,a=0,o=new hm(t);a<n;++a)++o[e[a]-1];var s=new hm(t);for(a=0;a<t;++a)s[a]=s[a-1]+o[a-1]<<1;if(r){i=new hm(1<<t);var l=15-t;for(a=0;a<n;++a)if(e[a])for(var c=a<<4|e[a],h=t-e[a],u=s[e[a]-1]++<<h,A=u|(1<<h)-1;u<=A;++u)i[h_[u]>>>l]=c}else for(a=0,i=new hm(n);a<n;++a)e[a]&&(i[a]=h_[s[e[a]-1]++]>>>15-e[a]);return i},hD=new hf(288),hM=0;hM<144;++hM)hD[hM]=8;for(var hM=144;hM<256;++hM)hD[hM]=9;for(var hM=256;hM<280;++hM)hD[hM]=7;for(var hM=280;hM<288;++hM)hD[hM]=8;for(var hF=new hf(32),hM=0;hM<32;++hM)hF[hM]=5;var hR=hT(hD,9,0),hP=hT(hD,9,1),hQ=hT(hF,5,0),hU=hT(hF,5,1),hz=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},hk=function(e,t,r){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(7&t)&r},hL=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},hO=function(e){return(e/8|0)+(7&e&&1)},hG=function(e,t,r){(null==t||t<0)&&(t=0),(null==r||r>e.length)&&(r=e.length);var i=new(e instanceof hm?hm:e instanceof hp?hp:hf)(r-t);return i.set(e.subarray(t,r)),i},hN=function(e,t,r){var i=e.length;if(!i||r&&!r.l&&i<5)return t||new hf(0);var n=!t||r,a=!r||r.i;r||(r={}),t||(t=new hf(3*i));var o=function(e){var r=t.length;if(e>r){var i=new hf(Math.max(2*r,e));i.set(t),t=i}},s=r.f||0,l=r.p||0,c=r.b||0,h=r.l,u=r.d,A=r.m,d=r.n,f=8*i;do{if(!h){r.f=s=hk(e,l,1);var m=hk(e,l+1,3);if(l+=3,m)if(1==m)h=hP,u=hU,A=9,d=5;else if(2==m){var p=hk(e,l,31)+257,g=hk(e,l+10,15)+4,v=p+hk(e,l+5,31)+1;l+=14;for(var y=new hf(v),x=new hf(19),E=0;E<g;++E)x[hy[E]]=hk(e,l+3*E,7);l+=3*g;for(var C=hz(x),B=(1<<C)-1,w=hT(x,C,1),E=0;E<v;){var I=w[hk(e,l,B)];l+=15&I;var b=I>>>4;if(b<16)y[E++]=b;else{var _=0,M=0;for(16==b?(M=3+hk(e,l,3),l+=2,_=y[E-1]):17==b?(M=3+hk(e,l,7),l+=3):18==b&&(M=11+hk(e,l,127),l+=7);M--;)y[E++]=_}}var S=y.subarray(0,p),T=y.subarray(p);A=hz(S),d=hz(T),h=hT(S,A,1),u=hT(T,d,1)}else throw"invalid block type";else{var b=hO(l)+4,D=e[b-4]|e[b-3]<<8,F=b+D;if(F>i){if(a)throw"unexpected EOF";break}n&&o(c+D),t.set(e.subarray(b,F),c),r.b=c+=D,r.p=l=8*F;continue}if(l>f){if(a)throw"unexpected EOF";break}}n&&o(c+131072);for(var R=(1<<A)-1,P=(1<<d)-1,Q=l;;Q=l){var _=h[hL(e,l)&R],U=_>>>4;if((l+=15&_)>f){if(a)throw"unexpected EOF";break}if(!_)throw"invalid length/literal";if(U<256)t[c++]=U;else if(256==U){Q=l,h=null;break}else{var z=U-254;if(U>264){var E=U-257,k=hg[E];z=hk(e,l,(1<<k)-1)+hC[E],l+=k}var L=u[hL(e,l)&P],O=L>>>4;if(!L)throw"invalid distance";l+=15&L;var T=hI[O];if(O>3){var k=hv[O];T+=hL(e,l)&(1<<k)-1,l+=k}if(l>f){if(a)throw"unexpected EOF";break}n&&o(c+131072);for(var G=c+z;c<G;c+=4)t[c]=t[c-T],t[c+1]=t[c+1-T],t[c+2]=t[c+2-T],t[c+3]=t[c+3-T];c=G}}r.l=h,r.p=Q,r.b=c,h&&(s=1,r.m=A,r.d=u,r.n=d)}while(!s)return c==t.length?t:hG(t,0,c)},hH=function(e,t,r){r<<=7&t;var i=t/8|0;e[i]|=r,e[i+1]|=r>>>8},hV=function(e,t,r){r<<=7&t;var i=t/8|0;e[i]|=r,e[i+1]|=r>>>8,e[i+2]|=r>>>16},hj=function(e,t){for(var r=[],i=0;i<e.length;++i)e[i]&&r.push({s:i,f:e[i]});var n=r.length,a=r.slice();if(!n)return[hZ,0];if(1==n){var o=new hf(r[0].s+1);return o[r[0].s]=1,[o,1]}r.sort(function(e,t){return e.f-t.f}),r.push({s:-1,f:25001});var s=r[0],l=r[1],c=0,h=1,u=2;for(r[0]={s:-1,f:s.f+l.f,l:s,r:l};h!=n-1;)s=r[r[c].f<r[u].f?c++:u++],l=r[c!=h&&r[c].f<r[u].f?c++:u++],r[h++]={s:-1,f:s.f+l.f,l:s,r:l};for(var A=a[0].s,i=1;i<n;++i)a[i].s>A&&(A=a[i].s);var d=new hm(A+1),f=hJ(r[h-1],d,0);if(f>t){var i=0,m=0,p=f-t,g=1<<p;for(a.sort(function(e,t){return d[t.s]-d[e.s]||e.f-t.f});i<n;++i){var v=a[i].s;if(d[v]>t)m+=g-(1<<f-d[v]),d[v]=t;else break}for(m>>>=p;m>0;){var y=a[i].s;d[y]<t?m-=1<<t-d[y]++-1:++i}for(;i>=0&&m;--i){var x=a[i].s;d[x]==t&&(--d[x],++m)}f=t}return[new hf(d),f]},hJ=function(e,t,r){return -1==e.s?Math.max(hJ(e.l,t,r+1),hJ(e.r,t,r+1)):t[e.s]=r},hY=function(e){for(var t=e.length;t&&!e[--t];);for(var r=new hm(++t),i=0,n=e[0],a=1,o=function(e){r[i++]=e},s=1;s<=t;++s)if(e[s]==n&&s!=t)++a;else{if(!n&&a>2){for(;a>138;a-=138)o(32754);a>2&&(o(a>10?a-11<<5|28690:a-3<<5|12305),a=0)}else if(a>3){for(o(n),--a;a>6;a-=6)o(8304);a>2&&(o(a-3<<5|8208),a=0)}for(;a--;)o(n);a=1,n=e[s]}return[r.subarray(0,i),t]},hW=function(e,t){for(var r=0,i=0;i<t.length;++i)r+=e[i]*t[i];return r},hK=function(e,t,r){var i=r.length,n=hO(t+2);e[n]=255&i,e[n+1]=i>>>8,e[n+2]=255^e[n],e[n+3]=255^e[n+1];for(var a=0;a<i;++a)e[n+a+4]=r[a];return(n+4+i)*8},hX=function(e,t,r,i,n,a,o,s,l,c,h){hH(t,h++,r),++n[256];for(var u,A,d,f,m=hj(n,15),p=m[0],g=m[1],v=hj(a,15),y=v[0],x=v[1],E=hY(p),C=E[0],B=E[1],w=hY(y),I=w[0],b=w[1],_=new hm(19),M=0;M<C.length;++M)_[31&C[M]]++;for(var M=0;M<I.length;++M)_[31&I[M]]++;for(var S=hj(_,7),T=S[0],D=S[1],F=19;F>4&&!T[hy[F-1]];--F);var R=c+5<<3,P=hW(n,hD)+hW(a,hF)+o,Q=hW(n,p)+hW(a,y)+o+14+3*F+hW(_,T)+(2*_[16]+3*_[17]+7*_[18]);if(R<=P&&R<=Q)return hK(t,h,e.subarray(l,l+c));if(hH(t,h,1+(Q<P)),h+=2,Q<P){u=hT(p,g,0),A=p,d=hT(y,x,0),f=y;var U=hT(T,D,0);hH(t,h,B-257),hH(t,h+5,b-1),hH(t,h+10,F-4),h+=14;for(var M=0;M<F;++M)hH(t,h+3*M,T[hy[M]]);h+=3*F;for(var z=[C,I],k=0;k<2;++k)for(var L=z[k],M=0;M<L.length;++M){var O=31&L[M];hH(t,h,U[O]),h+=T[O],O>15&&(hH(t,h,L[M]>>>5&127),h+=L[M]>>>12)}}else u=hR,A=hD,d=hQ,f=hF;for(var M=0;M<s;++M)if(i[M]>255){var O=i[M]>>>18&31;hV(t,h,u[O+257]),h+=A[O+257],O>7&&(hH(t,h,i[M]>>>23&31),h+=hg[O]);var G=31&i[M];hV(t,h,d[G]),h+=f[G],G>3&&(hV(t,h,i[M]>>>5&8191),h+=hv[G])}else hV(t,h,u[i[M]]),h+=A[i[M]];return hV(t,h,u[256]),h+A[256]},hq=new hp([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),hZ=new hf(0),h$=function(e,t,r,i,n,a){var o=e.length,s=new hf(i+o+5*(1+Math.ceil(o/7e3))+n),l=s.subarray(i,s.length-n),c=0;if(!t||o<8)for(var h=0;h<=o;h+=65535){var u=h+65535;u<o?c=hK(l,c,e.subarray(h,u)):(l[h]=a,c=hK(l,c,e.subarray(h,o)))}else{for(var A=hq[t-1],d=A>>>13,f=8191&A,m=(1<<r)-1,p=new hm(32768),g=new hm(m+1),v=Math.ceil(r/3),y=2*v,x=function(t){return(e[t]^e[t+1]<<v^e[t+2]<<y)&m},E=new hp(25e3),C=new hm(288),B=new hm(32),w=0,I=0,h=0,b=0,_=0,M=0;h<o;++h){var S=x(h),T=32767&h,D=g[S];if(p[T]=D,g[S]=T,_<=h){var F=o-h;if((w>7e3||b>24576)&&F>423){c=hX(e,l,0,E,C,B,I,b,M,h-M,c),b=w=I=0,M=h;for(var R=0;R<286;++R)C[R]=0;for(var R=0;R<30;++R)B[R]=0}var P=2,Q=0,U=f,z=T-D&32767;if(F>2&&S==x(h-z))for(var k=Math.min(d,F)-1,L=Math.min(32767,h),O=Math.min(258,F);z<=L&&--U&&T!=D;){if(e[h+P]==e[h+P-z]){for(var G=0;G<O&&e[h+G]==e[h+G-z];++G);if(G>P){if(P=G,Q=z,G>k)break;for(var N=Math.min(z,G-2),H=0,R=0;R<N;++R){var V=h-z+R+32768&32767,j=p[V],J=V-j+32768&32767;J>H&&(H=J,D=V)}}}D=p[T=D],z+=T-D+32768&32767}if(Q){E[b++]=0x10000000|hB[P]<<18|hb[Q];var Y=31&hB[P],W=31&hb[Q];I+=hg[Y]+hv[W],++C[257+Y],++B[W],_=h+P,++w}else E[b++]=e[h],++C[e[h]]}}c=hX(e,l,a,E,C,B,I,b,M,h-M,c),!a&&7&c&&(c=hK(l,c+1,hZ))}return hG(s,0,i+hO(c)+n)},h1=function(){for(var e=new Int32Array(256),t=0;t<256;++t){for(var r=t,i=9;--i;)r=(1&r&&-0x12477ce0)^r>>>1;e[t]=r}return e}(),h0=function(){var e=-1;return{p:function(t){for(var r=e,i=0;i<t.length;++i)r=h1[255&r^t[i]]^r>>>8;e=r},d:function(){return~e}}},h2=function(){var e=1,t=0;return{p:function(r){for(var i=e,n=t,a=r.length,o=0;o!=a;){for(var s=Math.min(o+2655,a);o<s;++o)n+=i+=r[o];i=(65535&i)+15*(i>>16),n=(65535&n)+15*(n>>16)}e=i,t=n},d:function(){return e%=65521,t%=65521,(255&e)<<24|e>>>8<<16|(255&t)<<8|t>>>8}}},h3=function(e,t,r,i,n){return h$(e,null==t.level?6:t.level,null==t.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(e.length)))):12+t.mem,r,i,!n)},h4=function(e,t){var r={};for(var i in e)r[i]=e[i];for(var i in t)r[i]=t[i];return r},h5=function(e,t,r){for(var i=e(),n=e.toString(),a=n.slice(n.indexOf("[")+1,n.lastIndexOf("]")).replace(/ /g,"").split(","),o=0;o<i.length;++o){var s=i[o],l=a[o];if("function"==typeof s){t+=";"+l+"=";var c=s.toString();if(s.prototype)if(-1!=c.indexOf("[native code]")){var h=c.indexOf(" ",8)+1;t+=c.slice(h,c.indexOf("(",h))}else for(var u in t+=c,s.prototype)t+=";"+l+".prototype."+u+"="+s.prototype[u].toString();else t+=c}else r[l]=s}return[t,r]},h6=[],h8=function(e){var t=[];for(var r in e)(e[r]instanceof hf||e[r]instanceof hm||e[r]instanceof hp)&&t.push((e[r]=new e[r].constructor(e[r])).buffer);return t},h9=function(e,t,r,i){if(!h6[r]){for(var n,a="",o={},s=e.length-1,l=0;l<s;++l)a=(n=h5(e[l],a,o))[0],o=n[1];h6[r]=h5(e[s],a,o)}var c=h4({},h6[r][1]);return hd(h6[r][0]+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+t.toString()+"}",r,c,h8(c),i)},h7=function(){return[hf,hm,hp,hg,hv,hy,hC,hI,hP,hU,h_,hT,hz,hk,hL,hO,hG,hN,uB,ui,un]},ue=function(){return[hf,hm,hp,hg,hv,hy,hB,hb,hR,hD,hQ,hF,h_,hq,hZ,hT,hH,hV,hj,hJ,hY,hW,hK,hX,hO,hG,h$,h3,ux,ui]},ut=function(){return[uA,ud]},ur=function(){return[up]},ui=function(e){return postMessage(e,[e.buffer])},un=function(e){return e&&e.size&&new hf(e.size)},ua=function(e){return e.ondata=function(e,t){return postMessage([e,t],[e.buffer])},function(t){return e.push(t.data[0],t.data[1])}},uo=function(e,t,r,i,n){var a,o=h9(e,i,n,function(e,r){e?(o.terminate(),t.ondata.call(t,e)):(r[1]&&o.terminate(),t.ondata.call(t,e,r[0],r[1]))});o.postMessage(r),t.push=function(e,r){if(a)throw"stream finished";if(!t.ondata)throw"no stream handler";o.postMessage([e,a=r],[e.buffer])},t.terminate=function(){o.terminate()}},us=function(e,t){return e[t]|e[t+1]<<8},ul=function(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0},uc=function(e,t){return ul(e,t)+0x100000000*ul(e,t+4)},uh=function(e,t,r){for(;r;++t)e[t]=r,r>>>=8},uu=function(e,t){var r=t.filename;if(e[0]=31,e[1]=139,e[2]=8,e[8]=t.level<2?4:2*(9==t.level),e[9]=3,0!=t.mtime&&uh(e,4,Math.floor(new Date(t.mtime||Date.now())/1e3)),r){e[3]=8;for(var i=0;i<=r.length;++i)e[i+10]=r.charCodeAt(i)}},uA=function(e){if(31!=e[0]||139!=e[1]||8!=e[2])throw"invalid gzip data";var t=e[3],r=10;4&t&&(r+=e[10]|(e[11]<<8)+2);for(var i=(t>>3&1)+(t>>4&1);i>0;i-=!e[r++]);return r+(2&t)},ud=function(e){var t=e.length;return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0},uf=function(e){return 10+(e.filename&&e.filename.length+1||0)},um=function(e,t){var r=t.level,i=0==r?0:r<6?1:9==r?3:2;e[0]=120,e[1]=i<<6|(i?32-2*i:1)},up=function(e){if((15&e[0])!=8||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function ug(e,t){return t||"function"!=typeof e||(t=e,e={}),this.ondata=t,e}var uv=function(){function e(e,t){t||"function"!=typeof e||(t=e,e={}),this.ondata=t,this.o=e||{}}return e.prototype.p=function(e,t){this.ondata(h3(e,this.o,0,0,!t),t)},e.prototype.push=function(e,t){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";this.d=t,this.p(e,t||!1)},e}(),uy=function(e,t){uo([ue,function(){return[ua,uv]}],this,ug.call(this,e,t),function(e){onmessage=ua(new uv(e.data))},6)};function ux(e,t){return h3(e,t||{},0,0)}var uE=function(){function e(e){this.s={},this.p=new hf(0),this.ondata=e}return e.prototype.e=function(e){if(this.d)throw"stream finished";if(!this.ondata)throw"no stream handler";var t=this.p.length,r=new hf(t+e.length);r.set(this.p),r.set(e,t),this.p=r},e.prototype.c=function(e){this.d=this.s.i=e||!1;var t=this.s.b,r=hN(this.p,this.o,this.s);this.ondata(hG(r,t,this.s.b),this.d),this.o=hG(r,this.s.b-32768),this.s.b=this.o.length,this.p=hG(this.p,this.s.p/8|0),this.s.p&=7},e.prototype.push=function(e,t){this.e(e),this.c(t)},e}(),uC=function(e){this.ondata=e,uo([h7,function(){return[ua,uE]}],this,0,function(){onmessage=ua(new uE)},7)};function uB(e,t){return hN(e,t)}(function(){function e(e,t){this.c=h0(),this.l=0,this.v=1,uv.call(this,e,t)}e.prototype.push=function(e,t){uv.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e),this.l+=e.length;var r=h3(e,this.o,this.v&&uf(this.o),t&&8,!t);this.v&&(uu(r,this.o),this.v=0),t&&(uh(r,r.length-8,this.c.d()),uh(r,r.length-4,this.l)),this.ondata(r,t)}})();var uw=function(){function e(e){this.v=1,uE.call(this,e)}return e.prototype.push=function(e,t){if(uE.prototype.e.call(this,e),this.v){var r=this.p.length>3?uA(this.p):4;if(r>=this.p.length&&!t)return;this.p=this.p.subarray(r),this.v=0}if(t){if(this.p.length<8)throw"invalid gzip stream";this.p=this.p.subarray(0,-8)}uE.prototype.c.call(this,t)},e}(),uI=function(e){this.ondata=e,uo([h7,ut,function(){return[ua,uE,uw]}],this,0,function(){onmessage=ua(new uw)},9)},ub=(function(){function e(e,t){this.c=h2(),this.v=1,uv.call(this,e,t)}e.prototype.push=function(e,t){uv.prototype.push.call(this,e,t)},e.prototype.p=function(e,t){this.c.p(e);var r=h3(e,this.o,this.v&&2,t&&4,!t);this.v&&(um(r,this.o),this.v=0),t&&uh(r,r.length-4,this.c.d()),this.ondata(r,t)}}(),function(){function e(e){this.v=1,uE.call(this,e)}return e.prototype.push=function(e,t){if(uE.prototype.e.call(this,e),this.v){if(this.p.length<2&&!t)return;this.p=this.p.subarray(2),this.v=0}if(t){if(this.p.length<4)throw"invalid zlib stream";this.p=this.p.subarray(0,-4)}uE.prototype.c.call(this,t)},e}()),u_=function(e){this.ondata=e,uo([h7,ur,function(){return[ua,uE,ub]}],this,0,function(){onmessage=ua(new ub)},11)};function uM(e,t){return hN((up(e),e.subarray(2,-4)),t)}var uS=function(){function e(e){this.G=uw,this.I=uE,this.Z=ub,this.ondata=e}return e.prototype.push=function(e,t){if(!this.ondata)throw"no stream handler";if(this.s)this.s.push(e,t);else{if(this.p&&this.p.length){var r=new hf(this.p.length+e.length);r.set(this.p),r.set(e,this.p.length)}else this.p=e;if(this.p.length>2){var i=this,n=function(){i.ondata.apply(i,arguments)};this.s=31==this.p[0]&&139==this.p[1]&&8==this.p[2]?new this.G(n):(15&this.p[0])!=8||this.p[0]>>4>7||(this.p[0]<<8|this.p[1])%31?new this.I(n):new this.Z(n),this.s.push(this.p,t),this.p=null}}},e}();(function(e){this.G=uI,this.I=uC,this.Z=u_,this.ondata=e}).prototype.push=function(e,t){uS.prototype.push.call(this,e,t)};var uT="undefined"!=typeof TextEncoder&&new TextEncoder,uD="undefined"!=typeof TextDecoder&&new TextDecoder,uF=0;try{uD.decode(hZ,{stream:!0}),uF=1}catch(e){}var uR=function(e){for(var t="",r=0;;){var i=e[r++],n=(i>127)+(i>223)+(i>239);if(r+n>e.length)return[t,hG(e,r-1)];n?3==n?t+=String.fromCharCode(55296|(i=((15&i)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536)>>10,56320|1023&i):1&n?t+=String.fromCharCode((31&i)<<6|63&e[r++]):t+=String.fromCharCode((15&i)<<12|(63&e[r++])<<6|63&e[r++]):t+=String.fromCharCode(i)}};function uP(e,t){if(t){for(var r=new hf(e.length),i=0;i<e.length;++i)r[i]=e.charCodeAt(i);return r}if(uT)return uT.encode(e);for(var n=e.length,a=new hf(e.length+(e.length>>1)),o=0,s=function(e){a[o++]=e},i=0;i<n;++i){if(o+5>a.length){var l=new hf(o+8+(n-i<<1));l.set(a),a=l}var c=e.charCodeAt(i);c<128||t?s(c):(c<2048?s(192|c>>6):(c>55295&&c<57344?(s(240|(c=65536+(1047552&c)|1023&e.charCodeAt(++i))>>18),s(128|c>>12&63)):s(224|c>>12),s(128|c>>6&63)),s(128|63&c))}return hG(a,0,o)}(function(e){this.ondata=e,uF?this.t=new TextDecoder:this.p=hZ}).prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(t=!!t,this.t){if(this.ondata(this.t.decode(e,{stream:!0}),t),t){if(this.t.decode().length)throw"invalid utf-8 data";this.t=null}return}if(!this.p)throw"stream finished";var r=new hf(this.p.length+e.length);r.set(this.p),r.set(e,this.p.length);var i=uR(r),n=i[0],a=i[1];if(t){if(a.length)throw"invalid utf-8 data";this.p=null}else this.p=a;this.ondata(n,t)},(function(e){this.ondata=e}).prototype.push=function(e,t){if(!this.ondata)throw"no callback";if(this.d)throw"stream finished";this.ondata(uP(e),this.d=t||!1)};var uQ=function(e){return 1==e?3:e<6?2:+(9==e)},uU=function(e,t){for(;1!=us(e,t);t+=4+us(e,t+2));return[uc(e,t+12),uc(e,t+4),uc(e,t+20)]},uz=function(e){var t=0;if(e)for(var r in e){var i=e[r].length;if(i>65535)throw"extra field too long";t+=i+4}return t},uk=function(e,t,r,i,n,a,o,s){var l=i.length,c=r.extra,h=s&&s.length,u=uz(c);uh(e,t,null!=o?0x2014b50:0x4034b50),t+=4,null!=o&&(e[t++]=20,e[t++]=r.os),e[t]=20,t+=2,e[t++]=r.flag<<1|(null==a&&8),e[t++]=n&&8,e[t++]=255&r.compression,e[t++]=r.compression>>8;var A=new Date(null==r.mtime?Date.now():r.mtime),d=A.getFullYear()-1980;if(d<0||d>119)throw"date not in range 1980-2099";if(uh(e,t,d<<25|A.getMonth()+1<<21|A.getDate()<<16|A.getHours()<<11|A.getMinutes()<<5|A.getSeconds()>>>1),t+=4,null!=a&&(uh(e,t,r.crc),uh(e,t+4,a),uh(e,t+8,r.size)),uh(e,t+12,l),uh(e,t+14,u),t+=16,null!=o&&(uh(e,t,h),uh(e,t+6,r.attrs),uh(e,t+10,o),t+=14),e.set(i,t),t+=l,u)for(var f in c){var m=c[f],p=m.length;uh(e,t,+f),uh(e,t+2,p),e.set(m,t+4),t+=4+p}return h&&(e.set(s,t),t+=h),t},uL=function(e,t,r,i,n){uh(e,t,0x6054b50),uh(e,t+8,r),uh(e,t+10,r),uh(e,t+12,i),uh(e,t+16,n)},uO=function(){function e(e){this.filename=e,this.c=h0(),this.size=0,this.compression=0}return e.prototype.process=function(e,t){this.ondata(null,e,t)},e.prototype.push=function(e,t){if(!this.ondata)throw"no callback - add to ZIP archive before pushing";this.c.p(e),this.size+=e.length,t&&(this.crc=this.c.d()),this.process(e,t||!1)},e}();function uG(e,t){var r=this;t||(t={}),uO.call(this,e),this.d=new uv(t,function(e,t){r.ondata(null,e,t)}),this.compression=8,this.flag=uQ(t.level)}function uN(e,t){var r=this;t||(t={}),uO.call(this,e),this.d=new uy(t,function(e,t,i){r.ondata(e,t,i)}),this.compression=8,this.flag=uQ(t.level),this.terminate=this.d.terminate}function uH(e){this.ondata=e,this.u=[],this.d=1}uG.prototype.process=function(e,t){try{this.d.push(e,t)}catch(e){this.ondata(e,null,t)}},uG.prototype.push=function(e,t){uO.prototype.push.call(this,e,t)},uN.prototype.process=function(e,t){this.d.push(e,t)},uN.prototype.push=function(e,t){uO.prototype.push.call(this,e,t)},uH.prototype.add=function(e){var t=this;if(2&this.d)throw"stream finished";var r=uP(e.filename),i=r.length,n=e.comment,a=n&&uP(n),o=i!=e.filename.length||a&&n.length!=a.length,s=i+uz(e.extra)+30;if(i>65535)throw"filename too long";var l=new hf(s);uk(l,0,e,r,o);var c=[l],h=function(){for(var e=0,r=c;e<r.length;e++){var i=r[e];t.ondata(null,i,!1)}c=[]},u=this.d;this.d=0;var A=this.u.length,d=h4(e,{f:r,u:o,o:a,t:function(){e.terminate&&e.terminate()},r:function(){if(h(),u){var e=t.u[A+1];e?e.r():t.d=1}u=1}}),f=0;e.ondata=function(r,i,n){if(r)t.ondata(r,i,n),t.terminate();else if(f+=i.length,c.push(i),n){var a=new hf(16);uh(a,0,0x8074b50),uh(a,4,e.crc),uh(a,8,f),uh(a,12,e.size),c.push(a),d.c=f,d.b=s+f+16,d.crc=e.crc,d.size=e.size,u&&d.r(),u=1}else u&&h()},this.u.push(d)},uH.prototype.end=function(){var e=this;if(2&this.d){if(1&this.d)throw"stream finishing";throw"stream finished"}this.d?this.e():this.u.push({r:function(){1&e.d&&(e.u.splice(-1,1),e.e())},t:function(){}}),this.d=3},uH.prototype.e=function(){for(var e=0,t=0,r=0,i=0,n=this.u;i<n.length;i++){var a=n[i];r+=46+a.f.length+uz(a.extra)+(a.o?a.o.length:0)}for(var o=new hf(r+22),s=0,l=this.u;s<l.length;s++){var a=l[s];uk(o,e,a,a.f,a.u,a.c,t,a.o),e+=46+a.f.length+uz(a.extra)+(a.o?a.o.length:0),t+=a.b}uL(o,e,this.u.length,r,t),this.ondata(null,o,!0),this.d=2},uH.prototype.terminate=function(){for(var e=0,t=this.u;e<t.length;e++)t[e].t();this.d=2};var uV=function(){function e(){}return e.prototype.push=function(e,t){this.ondata(null,e,t)},e.compression=0,e}();function uj(){var e=this;this.i=new uE(function(t,r){e.ondata(null,t,r)})}function uJ(e,t){var r=this;t<32e4?this.i=new uE(function(e,t){r.ondata(null,e,t)}):(this.i=new uC(function(e,t,i){r.ondata(e,t,i)}),this.terminate=this.i.terminate)}function uY(e){this.onfile=e,this.k=[],this.o={0:uV},this.p=hZ}uj.prototype.push=function(e,t){try{this.i.push(e,t)}catch(r){this.ondata(r,e,t)}},uj.compression=8,uJ.prototype.push=function(e,t){this.i.terminate&&(e=hG(e,0)),this.i.push(e,t)},uJ.compression=8,uY.prototype.push=function(e,t){var r=this;if(!this.onfile)throw"no callback";if(!this.p)throw"stream finished";if(this.c>0){var i=Math.min(this.c,e.length),n=e.subarray(0,i);if(this.c-=i,this.d?this.d.push(n,!this.c):this.k[0].push(n),(e=e.subarray(i)).length)return this.push(e,t)}else{var a=0,o=0,s=void 0,l=void 0;this.p.length?e.length?((l=new hf(this.p.length+e.length)).set(this.p),l.set(e,this.p.length)):l=this.p:l=e;for(var c=l.length,h=this.c,u=h&&this.d,A=this;o<c-4&&"break"!==function(){var e=ul(l,o);if(0x4034b50==e){a=1,s=o,A.d=null,A.c=0;var t=us(l,o+6),i=us(l,o+8),n=8&t,u=us(l,o+26),d=us(l,o+28);if(c>o+30+u+d){var f,m,p=[];A.k.unshift(p),a=2;var g=ul(l,o+18),v=ul(l,o+22),y=function(e,t){if(t){for(var r="",i=0;i<e.length;i+=16384)r+=String.fromCharCode.apply(null,e.subarray(i,i+16384));return r}if(uD)return uD.decode(e);var n=uR(e),a=n[0];if(n[1].length)throw"invalid utf-8 data";return a}(l.subarray(o+30,o+=30+u),!(2048&t));0xffffffff==g?(g=(f=n?[-2]:uU(l,o))[0],v=f[1]):n&&(g=-1),o+=d,A.c=g;var x={name:y,compression:i,start:function(){if(!x.ondata)throw"no callback";if(g){var e=r.o[i];if(!e)throw"unknown compression type "+i;(m=g<0?new e(y):new e(y,g,v)).ondata=function(e,t,r){x.ondata(e,t,r)};for(var t=0;t<p.length;t++){var n=p[t];m.push(n,!1)}r.k[0]==p&&r.c?r.d=m:m.push(hZ,!0)}else x.ondata(null,hZ,!0)},terminate:function(){m&&m.terminate&&m.terminate()}};g>=0&&(x.size=g,x.originalSize=v),A.onfile(x)}return"break"}if(h){if(0x8074b50==e)return s=o+=12+(-2==h&&8),a=3,A.c=0,"break";else if(0x2014b50==e)return s=o-=4,a=3,A.c=0,"break"}}();++o);if(this.p=hZ,h<0){var d=a?l.subarray(0,s-12-(-2==h&&8)-(0x8074b50==ul(l,s-16)&&4)):l.subarray(0,o);u?u.push(d,!!a):this.k[+(2==a)].push(d)}if(2&a)return this.push(l.subarray(o),t);this.p=l.subarray(o)}if(t){if(this.c)throw"invalid zip file";this.p=null}},uY.prototype.register=function(e){this.o[e.compression]=e};var uW=tw;function uK(e,t,r){let i=r.length-e-1;if(t>=r[i])return i-1;if(t<=r[e])return e;let n=e,a=i,o=Math.floor((n+a)/2);for(;t<r[o]||t>=r[o+1];)t<r[o]?a=o:n=o,o=Math.floor((n+a)/2);return o}class uX extends uW.Curve{constructor(e,t,r,i,n){super(),this.degree=e,this.knots=t,this.controlPoints=[],this.startKnot=i||0,this.endKnot=n||this.knots.length-1;for(let e=0;e<r.length;++e){const t=r[e];this.controlPoints[e]=new uW.Vector4(t.x,t.y,t.z,t.w)}}getPoint(e,t){let r=t||new uW.Vector3,i=this.knots[this.startKnot]+e*(this.knots[this.endKnot]-this.knots[this.startKnot]),n=function(e,t,r,i){let n=uK(e,i,t),a=function(e,t,r,i){let n=[],a=[],o=[];n[0]=1;for(let s=1;s<=r;++s){a[s]=t-i[e+1-s],o[s]=i[e+s]-t;let r=0;for(let e=0;e<s;++e){let t=o[e+1],i=a[s-e],l=n[e]/(t+i);n[e]=r+t*l,r=i*l}n[s]=r}return n}(n,i,e,t),o=new tw.Vector4(0,0,0,0);for(let t=0;t<=e;++t){let i=r[n-e+t],s=a[t],l=i.w*s;o.x+=i.x*l,o.y+=i.y*l,o.z+=i.z*l,o.w+=i.w*s}return o}(this.degree,this.knots,this.controlPoints,i);return 1!=n.w&&n.divideScalar(n.w),r.set(n.x,n.y,n.z)}getTangent(e,t){var r,i,n;let a=t||new uW.Vector3,o=this.knots[0]+e*(this.knots[this.knots.length-1]-this.knots[0]),s=(r=this.degree,i=this.knots,n=this.controlPoints,function(e){let t=e.length,r=[],i=[];for(let n=0;n<t;++n){let t=e[n];r[n]=new tw.Vector3(t.x,t.y,t.z),i[n]=t.w}let n=[];for(let e=0;e<t;++e){let t=r[e].clone();for(let r=1;r<=e;++r)t.sub(n[e-r].clone().multiplyScalar(function(e,t){let r=1;for(let t=2;t<=e;++t)r*=t;let i=1;for(let e=2;e<=t;++e)i*=e;for(let r=2;r<=e-t;++r)i*=r;return r/i}(e,r)*i[r]));n[e]=t.divideScalar(i[0])}return n}(function(e,t,r,i,n){let a=1<e?1:e,o=[],s=uK(e,i,t),l=function(e,t,r,i,n){let a=[];for(let e=0;e<=r;++e)a[e]=0;let o=[];for(let e=0;e<=i;++e)o[e]=a.slice(0);let s=[];for(let e=0;e<=r;++e)s[e]=a.slice(0);s[0][0]=1;let l=a.slice(0),c=a.slice(0);for(let i=1;i<=r;++i){l[i]=t-n[e+1-i],c[i]=n[e+i]-t;let r=0;for(let e=0;e<i;++e){let t=c[e+1],n=l[i-e];s[i][e]=t+n;let a=s[e][i-1]/s[i][e];s[e][i]=r+t*a,r=n*a}s[i][i]=r}for(let e=0;e<=r;++e)o[0][e]=s[e][r];for(let e=0;e<=r;++e){let t=0,n=1,l=[];for(let e=0;e<=r;++e)l[e]=a.slice(0);l[0][0]=1;for(let a=1;a<=i;++a){let i=0,c=e-a,h=r-a;e>=a&&(l[n][0]=l[t][0]/s[h+1][c],i=l[n][0]*s[c][h]);let u=c>=-1?1:-c,A=e-1<=h?a-1:r-e;for(let e=u;e<=A;++e)l[n][e]=(l[t][e]-l[t][e-1])/s[h+1][c+e],i+=l[n][e]*s[c+e][h];e<=h&&(l[n][a]=-l[t][a-1]/s[h+1][e],i+=l[n][a]*s[e][h]),o[a][e]=i;let d=t;t=n,n=d}}let h=r;for(let e=1;e<=i;++e){for(let t=0;t<=r;++t)o[e][t]*=h;h*=r-e}return o}(s,i,e,a,t),c=[];for(let e=0;e<r.length;++e){let t=r[e].clone(),i=t.w;t.x*=i,t.y*=i,t.z*=i,c[e]=t}for(let t=0;t<=a;++t){let r=c[s-e].clone().multiplyScalar(l[t][0]);for(let i=1;i<=e;++i)r.add(c[s-e+i].clone().multiplyScalar(l[t][i]));o[t]=r}for(let e=a+1;e<=2;++e)o[e]=new tw.Vector4(0,0,0);return o}(r,i,n,o,1)));return a.copy(s[1]).normalize(),a}}class uq extends hu.Loader{constructor(e){super(e)}load(e,t,r,i){let n=this,a=""===n.path?hu.LoaderUtils.extractUrlBase(e):n.path,o=new hu.FileLoader(this.manager);o.setPath(n.path),o.setResponseType("arraybuffer"),o.setRequestHeader(n.requestHeader),o.setWithCredentials(n.withCredentials),o.load(e,function(r){try{t(n.parse(r,a))}catch(t){i?i(t):console.error(t),n.manager.itemError(e)}},r,i)}parse(e,t){var r;let i;if(i="Kaydara FBX Binary  \0",(r=e).byteLength>=i.length&&i===An(r,0,i.length))S=new u2().parse(e);else{let t=An(e);if(!function(e){let t=["K","a","y","d","a","r","a","\\","F","B","X","\\","B","i","n","a","r","y","\\","\\"],r=0;for(let i=0;i<t.length;++i)if(function(t){let i=e[0];return e=e.slice(r+1),r++,i}(0)===t[i])return!1;return!0}(t))throw Error("THREE.FBXLoader: Unknown format.");if(7e3>u5(t))throw Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+u5(t));S=new u0().parse(t)}return new uZ(new hu.TextureLoader(this.manager).setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin),this.manager).parse(S)}}class uZ{constructor(e,t){this.textureLoader=e,this.manager=t}parse(){T=this.parseConnections();let e=this.parseImages(),t=this.parseTextures(e),r=this.parseMaterials(t),i=this.parseDeformers(),n=new u$().parse(i);return this.parseScene(i,n,r),D}parseConnections(){let e=new Map;return"Connections"in S&&S.Connections.connections.forEach(function(t){let r=t[0],i=t[1],n=t[2];e.has(r)||e.set(r,{parents:[],children:[]}),e.get(r).parents.push({ID:i,relationship:n}),e.has(i)||e.set(i,{parents:[],children:[]}),e.get(i).children.push({ID:r,relationship:n})}),e}parseImages(){let e={},t={};if("Video"in S.Objects){let r=S.Objects.Video;for(let i in r){let n=r[i];if(e[parseInt(i)]=n.RelativeFilename||n.Filename,"Content"in n){let e=n.Content instanceof ArrayBuffer&&n.Content.byteLength>0,a="string"==typeof n.Content&&""!==n.Content;if(e||a){let e=this.parseImage(r[i]);t[n.RelativeFilename||n.Filename]=e}}}}for(let r in e){let i=e[r];void 0!==t[i]?e[r]=t[i]:e[r]=e[r].split("\\").pop()}return e}parseImage(e){let t,r=e.Content,i=e.RelativeFilename||e.Filename,n=i.slice(i.lastIndexOf(".")+1).toLowerCase();switch(n){case"bmp":t="image/bmp";break;case"jpg":case"jpeg":t="image/jpeg";break;case"png":t="image/png";break;case"tif":t="image/tiff";break;case"tga":null===this.manager.getHandler(".tga")&&console.warn("FBXLoader: TGA loader not found, skipping ",i),t="image/tga";break;default:console.warn('FBXLoader: Image type "'+n+'" is not supported.');return}if("string"==typeof r)return"data:"+t+";base64,"+r;{let e=new Uint8Array(r);return window.URL.createObjectURL(new Blob([e],{type:t}))}}parseTextures(e){let t=new Map;if("Texture"in S.Objects){let r=S.Objects.Texture;for(let i in r){let n=this.parseTexture(r[i],e);t.set(parseInt(i),n)}}return t}parseTexture(e,t){let r=this.loadTexture(e,t);r.ID=e.id,r.name=e.attrName;let i=e.WrapModeU,n=e.WrapModeV,a=void 0!==i?i.value:0,o=void 0!==n?n.value:0;if(r.wrapS=0===a?hu.RepeatWrapping:hu.ClampToEdgeWrapping,r.wrapT=0===o?hu.RepeatWrapping:hu.ClampToEdgeWrapping,"Scaling"in e){let t=e.Scaling.value;r.repeat.x=t[0],r.repeat.y=t[1]}return r}loadTexture(e,t){let r,i,n=this.textureLoader.path,a=T.get(e.id).children;void 0!==a&&a.length>0&&void 0!==t[a[0].ID]&&(0===(r=t[a[0].ID]).indexOf("blob:")||0===r.indexOf("data:"))&&this.textureLoader.setPath(void 0);let o=e.FileName.slice(-3).toLowerCase();if("tga"===o){let t=this.manager.getHandler(".tga");null===t?(console.warn("FBXLoader: TGA loader not found, creating placeholder texture for",e.RelativeFilename),i=new hu.Texture):(t.setPath(this.textureLoader.path),i=t.load(r))}else"psd"===o?(console.warn("FBXLoader: PSD textures are not supported, creating placeholder texture for",e.RelativeFilename),i=new hu.Texture):i=this.textureLoader.load(r);return this.textureLoader.setPath(n),i}parseMaterials(e){let t=new Map;if("Material"in S.Objects){let r=S.Objects.Material;for(let i in r){let n=this.parseMaterial(r[i],e);null!==n&&t.set(parseInt(i),n)}}return t}parseMaterial(e,t){let r,i=e.id,n=e.attrName,a=e.ShadingModel;if("object"==typeof a&&(a=a.value),!T.has(i))return null;let o=this.parseParameters(e,t,i);switch(a.toLowerCase()){case"phong":r=new hu.MeshPhongMaterial;break;case"lambert":r=new hu.MeshLambertMaterial;break;default:console.warn('THREE.FBXLoader: unknown material type "%s". Defaulting to MeshPhongMaterial.',a),r=new hu.MeshPhongMaterial}return r.setValues(o),r.name=n,r}parseParameters(e,t,r){let i={};e.BumpFactor&&(i.bumpScale=e.BumpFactor.value),e.Diffuse?i.color=new hu.Color().fromArray(e.Diffuse.value):e.DiffuseColor&&("Color"===e.DiffuseColor.type||"ColorRGB"===e.DiffuseColor.type)&&(i.color=new hu.Color().fromArray(e.DiffuseColor.value)),e.DisplacementFactor&&(i.displacementScale=e.DisplacementFactor.value),e.Emissive?i.emissive=new hu.Color().fromArray(e.Emissive.value):e.EmissiveColor&&("Color"===e.EmissiveColor.type||"ColorRGB"===e.EmissiveColor.type)&&(i.emissive=new hu.Color().fromArray(e.EmissiveColor.value)),e.EmissiveFactor&&(i.emissiveIntensity=parseFloat(e.EmissiveFactor.value)),e.Opacity&&(i.opacity=parseFloat(e.Opacity.value)),i.opacity<1&&(i.transparent=!0),e.ReflectionFactor&&(i.reflectivity=e.ReflectionFactor.value),e.Shininess&&(i.shininess=e.Shininess.value),e.Specular?i.specular=new hu.Color().fromArray(e.Specular.value):e.SpecularColor&&"Color"===e.SpecularColor.type&&(i.specular=new hu.Color().fromArray(e.SpecularColor.value));let n=this;return T.get(r).children.forEach(function(e){let r=e.relationship;switch(r){case"Bump":i.bumpMap=n.getTexture(t,e.ID);break;case"Maya|TEX_ao_map":i.aoMap=n.getTexture(t,e.ID);break;case"DiffuseColor":case"Maya|TEX_color_map":i.map=n.getTexture(t,e.ID),void 0!==i.map&&("colorSpace"in i.map?i.map.colorSpace="srgb":i.map.encoding=3001);break;case"DisplacementColor":i.displacementMap=n.getTexture(t,e.ID);break;case"EmissiveColor":i.emissiveMap=n.getTexture(t,e.ID),void 0!==i.emissiveMap&&("colorSpace"in i.emissiveMap?i.emissiveMap.colorSpace="srgb":i.emissiveMap.encoding=3001);break;case"NormalMap":case"Maya|TEX_normal_map":i.normalMap=n.getTexture(t,e.ID);break;case"ReflectionColor":i.envMap=n.getTexture(t,e.ID),void 0!==i.envMap&&(i.envMap.mapping=hu.EquirectangularReflectionMapping,"colorSpace"in i.envMap?i.envMap.colorSpace="srgb":i.envMap.encoding=3001);break;case"SpecularColor":i.specularMap=n.getTexture(t,e.ID),void 0!==i.specularMap&&("colorSpace"in i.specularMap?i.specularMap.colorSpace="srgb":i.specularMap.encoding=3001);break;case"TransparentColor":case"TransparencyFactor":i.alphaMap=n.getTexture(t,e.ID),i.transparent=!0;break;default:console.warn("THREE.FBXLoader: %s map is not supported in three.js, skipping texture.",r)}}),i}getTexture(e,t){return"LayeredTexture"in S.Objects&&t in S.Objects.LayeredTexture&&(console.warn("THREE.FBXLoader: layered textures are not supported in three.js. Discarding all but first layer."),t=T.get(t).children[0].ID),e.get(t)}parseDeformers(){let e={},t={};if("Deformer"in S.Objects){let r=S.Objects.Deformer;for(let i in r){let n=r[i],a=T.get(parseInt(i));if("Skin"===n.attrType){let t=this.parseSkeleton(a,r);t.ID=i,a.parents.length>1&&console.warn("THREE.FBXLoader: skeleton attached to more than one geometry is not supported."),t.geometryID=a.parents[0].ID,e[i]=t}else if("BlendShape"===n.attrType){let e={id:i};e.rawTargets=this.parseMorphTargets(a,r),e.id=i,a.parents.length>1&&console.warn("THREE.FBXLoader: morph target attached to more than one geometry is not supported."),t[i]=e}}}return{skeletons:e,morphTargets:t}}parseSkeleton(e,t){let r=[];return e.children.forEach(function(e){let i=t[e.ID];if("Cluster"!==i.attrType)return;let n={ID:e.ID,indices:[],weights:[],transformLink:new hu.Matrix4().fromArray(i.TransformLink.a)};"Indexes"in i&&(n.indices=i.Indexes.a,n.weights=i.Weights.a),r.push(n)}),{rawBones:r,bones:[]}}parseMorphTargets(e,t){let r=[];for(let i=0;i<e.children.length;i++){let n=e.children[i],a=t[n.ID],o={name:a.attrName,initialWeight:a.DeformPercent,id:a.id,fullWeights:a.FullWeights.a};if("BlendShapeChannel"!==a.attrType)return;o.geoID=T.get(parseInt(n.ID)).children.filter(function(e){return void 0===e.relationship})[0].ID,r.push(o)}return r}parseScene(e,t,r){D=new hu.Group;let i=this.parseModels(e.skeletons,t,r),n=S.Objects.Model,a=this;i.forEach(function(e){let t=n[e.ID];a.setLookAtProperties(e,t),T.get(e.ID).parents.forEach(function(t){let r=i.get(t.ID);void 0!==r&&r.add(e)}),null===e.parent&&D.add(e)}),this.bindSkeleton(e.skeletons,t,i),this.createAmbientLight(),D.traverse(function(e){if(e.userData.transformData){e.parent&&(e.userData.transformData.parentMatrix=e.parent.matrix,e.userData.transformData.parentMatrixWorld=e.parent.matrixWorld);let t=At(e.userData.transformData);e.applyMatrix4(t),e.updateWorldMatrix()}});let o=new u1().parse();1===D.children.length&&D.children[0].isGroup&&(D.children[0].animations=o,D=D.children[0]),D.animations=o}parseModels(e,t,r){let i=new Map,n=S.Objects.Model;for(let a in n){let o=parseInt(a),s=n[a],l=T.get(o),c=this.buildSkeleton(l,e,o,s.attrName);if(!c){switch(s.attrType){case"Camera":c=this.createCamera(l);break;case"Light":c=this.createLight(l);break;case"Mesh":c=this.createMesh(l,t,r);break;case"NurbsCurve":c=this.createCurve(l,t);break;case"LimbNode":case"Root":c=new hu.Bone;break;default:c=new hu.Group}c.name=s.attrName?hu.PropertyBinding.sanitizeNodeName(s.attrName):"",c.ID=o}this.getTransformData(c,s),i.set(o,c)}return i}buildSkeleton(e,t,r,i){let n=null;return e.parents.forEach(function(e){for(let a in t){let o=t[a];o.rawBones.forEach(function(t,a){if(t.ID===e.ID){let e=n;(n=new hu.Bone).matrixWorld.copy(t.transformLink),n.name=i?hu.PropertyBinding.sanitizeNodeName(i):"",n.ID=r,o.bones[a]=n,null!==e&&n.add(e)}})}}),n}createCamera(e){let t,r;if(e.children.forEach(function(e){let t=S.Objects.NodeAttribute[e.ID];void 0!==t&&(r=t)}),void 0===r)t=new hu.Object3D;else{let e=0;void 0!==r.CameraProjectionType&&1===r.CameraProjectionType.value&&(e=1);let i=1;void 0!==r.NearPlane&&(i=r.NearPlane.value/1e3);let n=1e3;void 0!==r.FarPlane&&(n=r.FarPlane.value/1e3);let a=window.innerWidth,o=window.innerHeight;void 0!==r.AspectWidth&&void 0!==r.AspectHeight&&(a=r.AspectWidth.value,o=r.AspectHeight.value);let s=a/o,l=45;void 0!==r.FieldOfView&&(l=r.FieldOfView.value);let c=r.FocalLength?r.FocalLength.value:null;switch(e){case 0:t=new hu.PerspectiveCamera(l,s,i,n),null!==c&&t.setFocalLength(c);break;case 1:t=new hu.OrthographicCamera(-a/2,a/2,o/2,-o/2,i,n);break;default:console.warn("THREE.FBXLoader: Unknown camera type "+e+"."),t=new hu.Object3D}}return t}createLight(e){let t,r;if(e.children.forEach(function(e){let t=S.Objects.NodeAttribute[e.ID];void 0!==t&&(r=t)}),void 0===r)t=new hu.Object3D;else{let e;e=void 0===r.LightType?0:r.LightType.value;let i=0xffffff;void 0!==r.Color&&(i=new hu.Color().fromArray(r.Color.value));let n=void 0===r.Intensity?1:r.Intensity.value/100;void 0!==r.CastLightOnObject&&0===r.CastLightOnObject.value&&(n=0);let a=0;switch(void 0!==r.FarAttenuationEnd&&(a=void 0!==r.EnableFarAttenuation&&0===r.EnableFarAttenuation.value?0:r.FarAttenuationEnd.value),e){case 0:t=new hu.PointLight(i,n,a,1);break;case 1:t=new hu.DirectionalLight(i,n);break;case 2:let o=Math.PI/3;void 0!==r.InnerAngle&&(o=hu.MathUtils.degToRad(r.InnerAngle.value));let s=0;void 0!==r.OuterAngle&&(s=Math.max(s=hu.MathUtils.degToRad(r.OuterAngle.value),1)),t=new hu.SpotLight(i,n,a,o,s,1);break;default:console.warn("THREE.FBXLoader: Unknown light type "+r.LightType.value+", defaulting to a PointLight."),t=new hu.PointLight(i,n)}void 0!==r.CastShadows&&1===r.CastShadows.value&&(t.castShadow=!0)}return t}createMesh(e,t,r){let i,n=null,a=null,o=[];return e.children.forEach(function(e){t.has(e.ID)&&(n=t.get(e.ID)),r.has(e.ID)&&o.push(r.get(e.ID))}),o.length>1?a=o:o.length>0?a=o[0]:(a=new hu.MeshPhongMaterial({color:0xcccccc}),o.push(a)),"color"in n.attributes&&o.forEach(function(e){e.vertexColors=!0}),n.FBX_Deformer?(i=new hu.SkinnedMesh(n,a)).normalizeSkinWeights():i=new hu.Mesh(n,a),i}createCurve(e,t){let r=e.children.reduce(function(e,r){return t.has(r.ID)&&(e=t.get(r.ID)),e},null),i=new hu.LineBasicMaterial({color:3342591,linewidth:1});return new hu.Line(r,i)}getTransformData(e,t){let r={};"InheritType"in t&&(r.inheritType=parseInt(t.InheritType.value)),"RotationOrder"in t?r.eulerOrder=Ar(t.RotationOrder.value):r.eulerOrder="ZYX","Lcl_Translation"in t&&(r.translation=t.Lcl_Translation.value),"PreRotation"in t&&(r.preRotation=t.PreRotation.value),"Lcl_Rotation"in t&&(r.rotation=t.Lcl_Rotation.value),"PostRotation"in t&&(r.postRotation=t.PostRotation.value),"Lcl_Scaling"in t&&(r.scale=t.Lcl_Scaling.value),"ScalingOffset"in t&&(r.scalingOffset=t.ScalingOffset.value),"ScalingPivot"in t&&(r.scalingPivot=t.ScalingPivot.value),"RotationOffset"in t&&(r.rotationOffset=t.RotationOffset.value),"RotationPivot"in t&&(r.rotationPivot=t.RotationPivot.value),e.userData.transformData=r}setLookAtProperties(e,t){"LookAtProperty"in t&&T.get(e.ID).children.forEach(function(t){if("LookAtProperty"===t.relationship){let r=S.Objects.Model[t.ID];if("Lcl_Translation"in r){let t=r.Lcl_Translation.value;void 0!==e.target?(e.target.position.fromArray(t),D.add(e.target)):e.lookAt(new hu.Vector3().fromArray(t))}}})}bindSkeleton(e,t,r){let i=this.parsePoseNodes();for(let n in e){let a=e[n];T.get(parseInt(a.ID)).parents.forEach(function(e){if(t.has(e.ID)){let t=e.ID;T.get(t).parents.forEach(function(e){r.has(e.ID)&&r.get(e.ID).bind(new hu.Skeleton(a.bones),i[e.ID])})}})}}parsePoseNodes(){let e={};if("Pose"in S.Objects){let t=S.Objects.Pose;for(let r in t)if("BindPose"===t[r].attrType&&t[r].NbPoseNodes>0){let i=t[r].PoseNode;Array.isArray(i)?i.forEach(function(t){e[t.Node]=new hu.Matrix4().fromArray(t.Matrix.a)}):e[i.Node]=new hu.Matrix4().fromArray(i.Matrix.a)}}return e}createAmbientLight(){if("GlobalSettings"in S&&"AmbientColor"in S.GlobalSettings){let e=S.GlobalSettings.AmbientColor.value,t=e[0],r=e[1],i=e[2];if(0!==t||0!==r||0!==i){let e=new hu.Color(t,r,i);D.add(new hu.AmbientLight(e,1))}}}}class u${parse(e){let t=new Map;if("Geometry"in S.Objects){let r=S.Objects.Geometry;for(let i in r){let n=T.get(parseInt(i)),a=this.parseGeometry(n,r[i],e);t.set(parseInt(i),a)}}return t}parseGeometry(e,t,r){switch(t.attrType){case"Mesh":return this.parseMeshGeometry(e,t,r);case"NurbsCurve":return this.parseNurbsGeometry(t)}}parseMeshGeometry(e,t,r){let i=r.skeletons,n=[],a=e.parents.map(function(e){return S.Objects.Model[e.ID]});if(0===a.length)return;let o=e.children.reduce(function(e,t){return void 0!==i[t.ID]&&(e=i[t.ID]),e},null);e.children.forEach(function(e){void 0!==r.morphTargets[e.ID]&&n.push(r.morphTargets[e.ID])});let s=a[0],l={};"RotationOrder"in s&&(l.eulerOrder=Ar(s.RotationOrder.value)),"InheritType"in s&&(l.inheritType=parseInt(s.InheritType.value)),"GeometricTranslation"in s&&(l.translation=s.GeometricTranslation.value),"GeometricRotation"in s&&(l.rotation=s.GeometricRotation.value),"GeometricScaling"in s&&(l.scale=s.GeometricScaling.value);let c=At(l);return this.genGeometry(t,o,n,c)}genGeometry(e,t,r,i){let n=new hu.BufferGeometry;e.attrName&&(n.name=e.attrName);let a=this.parseGeoNode(e,t),o=this.genBuffers(a),s=new hu.Float32BufferAttribute(o.vertex,3);if(s.applyMatrix4(i),n.setAttribute("position",s),o.colors.length>0&&n.setAttribute("color",new hu.Float32BufferAttribute(o.colors,3)),t&&(n.setAttribute("skinIndex",new hu.Uint16BufferAttribute(o.weightsIndices,4)),n.setAttribute("skinWeight",new hu.Float32BufferAttribute(o.vertexWeights,4)),n.FBX_Deformer=t),o.normal.length>0){let e=new hu.Matrix3().getNormalMatrix(i),t=new hu.Float32BufferAttribute(o.normal,3);t.applyNormalMatrix(e),n.setAttribute("normal",t)}if(o.uvs.forEach(function(e,t){"uv2"===n_&&t++;let r=0===t?"uv":`uv${t}`;n.setAttribute(r,new hu.Float32BufferAttribute(o.uvs[t],2))}),a.material&&"AllSame"!==a.material.mappingType){let e=o.materialIndex[0],t=0;if(o.materialIndex.forEach(function(r,i){r!==e&&(n.addGroup(t,i-t,e),e=r,t=i)}),n.groups.length>0){let t=n.groups[n.groups.length-1],r=t.start+t.count;r!==o.materialIndex.length&&n.addGroup(r,o.materialIndex.length-r,e)}0===n.groups.length&&n.addGroup(0,o.materialIndex.length,o.materialIndex[0])}return this.addMorphTargets(n,e,r,i),n}parseGeoNode(e,t){let r={};if(r.vertexPositions=void 0!==e.Vertices?e.Vertices.a:[],r.vertexIndices=void 0!==e.PolygonVertexIndex?e.PolygonVertexIndex.a:[],e.LayerElementColor&&(r.color=this.parseVertexColors(e.LayerElementColor[0])),e.LayerElementMaterial&&(r.material=this.parseMaterialIndices(e.LayerElementMaterial[0])),e.LayerElementNormal&&(r.normal=this.parseNormals(e.LayerElementNormal[0])),e.LayerElementUV){r.uv=[];let t=0;for(;e.LayerElementUV[t];)e.LayerElementUV[t].UV&&r.uv.push(this.parseUVs(e.LayerElementUV[t])),t++}return r.weightTable={},null!==t&&(r.skeleton=t,t.rawBones.forEach(function(e,t){e.indices.forEach(function(i,n){void 0===r.weightTable[i]&&(r.weightTable[i]=[]),r.weightTable[i].push({id:t,weight:e.weights[n]})})})),r}genBuffers(e){let t={vertex:[],normal:[],colors:[],uvs:[],materialIndex:[],vertexWeights:[],weightsIndices:[]},r=0,i=0,n=!1,a=[],o=[],s=[],l=[],c=[],h=[],u=this;return e.vertexIndices.forEach(function(A,d){let f,m=!1;A<0&&(A^=-1,m=!0);let p=[],g=[];if(a.push(3*A,3*A+1,3*A+2),e.color){let t=u9(d,r,A,e.color);s.push(t[0],t[1],t[2])}if(e.skeleton){if(void 0!==e.weightTable[A]&&e.weightTable[A].forEach(function(e){g.push(e.weight),p.push(e.id)}),g.length>4){n||(console.warn("THREE.FBXLoader: Vertex has more than 4 skinning weights assigned to vertex. Deleting additional weights."),n=!0);let e=[0,0,0,0],t=[0,0,0,0];g.forEach(function(r,i){let n=r,a=p[i];t.forEach(function(t,r,i){if(n>t){i[r]=n,n=t;let o=e[r];e[r]=a,a=o}})}),p=e,g=t}for(;g.length<4;)g.push(0),p.push(0);for(let e=0;e<4;++e)c.push(g[e]),h.push(p[e])}if(e.normal){let t=u9(d,r,A,e.normal);o.push(t[0],t[1],t[2])}e.material&&"AllSame"!==e.material.mappingType&&(f=u9(d,r,A,e.material)[0]),e.uv&&e.uv.forEach(function(e,t){let i=u9(d,r,A,e);void 0===l[t]&&(l[t]=[]),l[t].push(i[0]),l[t].push(i[1])}),i++,m&&(u.genFace(t,e,a,f,o,s,l,c,h,i),r++,i=0,a=[],o=[],s=[],l=[],c=[],h=[])}),t}genFace(e,t,r,i,n,a,o,s,l,c){for(let h=2;h<c;h++)e.vertex.push(t.vertexPositions[r[0]]),e.vertex.push(t.vertexPositions[r[1]]),e.vertex.push(t.vertexPositions[r[2]]),e.vertex.push(t.vertexPositions[r[(h-1)*3]]),e.vertex.push(t.vertexPositions[r[(h-1)*3+1]]),e.vertex.push(t.vertexPositions[r[(h-1)*3+2]]),e.vertex.push(t.vertexPositions[r[3*h]]),e.vertex.push(t.vertexPositions[r[3*h+1]]),e.vertex.push(t.vertexPositions[r[3*h+2]]),t.skeleton&&(e.vertexWeights.push(s[0]),e.vertexWeights.push(s[1]),e.vertexWeights.push(s[2]),e.vertexWeights.push(s[3]),e.vertexWeights.push(s[(h-1)*4]),e.vertexWeights.push(s[(h-1)*4+1]),e.vertexWeights.push(s[(h-1)*4+2]),e.vertexWeights.push(s[(h-1)*4+3]),e.vertexWeights.push(s[4*h]),e.vertexWeights.push(s[4*h+1]),e.vertexWeights.push(s[4*h+2]),e.vertexWeights.push(s[4*h+3]),e.weightsIndices.push(l[0]),e.weightsIndices.push(l[1]),e.weightsIndices.push(l[2]),e.weightsIndices.push(l[3]),e.weightsIndices.push(l[(h-1)*4]),e.weightsIndices.push(l[(h-1)*4+1]),e.weightsIndices.push(l[(h-1)*4+2]),e.weightsIndices.push(l[(h-1)*4+3]),e.weightsIndices.push(l[4*h]),e.weightsIndices.push(l[4*h+1]),e.weightsIndices.push(l[4*h+2]),e.weightsIndices.push(l[4*h+3])),t.color&&(e.colors.push(a[0]),e.colors.push(a[1]),e.colors.push(a[2]),e.colors.push(a[(h-1)*3]),e.colors.push(a[(h-1)*3+1]),e.colors.push(a[(h-1)*3+2]),e.colors.push(a[3*h]),e.colors.push(a[3*h+1]),e.colors.push(a[3*h+2])),t.material&&"AllSame"!==t.material.mappingType&&(e.materialIndex.push(i),e.materialIndex.push(i),e.materialIndex.push(i)),t.normal&&(e.normal.push(n[0]),e.normal.push(n[1]),e.normal.push(n[2]),e.normal.push(n[(h-1)*3]),e.normal.push(n[(h-1)*3+1]),e.normal.push(n[(h-1)*3+2]),e.normal.push(n[3*h]),e.normal.push(n[3*h+1]),e.normal.push(n[3*h+2])),t.uv&&t.uv.forEach(function(t,r){void 0===e.uvs[r]&&(e.uvs[r]=[]),e.uvs[r].push(o[r][0]),e.uvs[r].push(o[r][1]),e.uvs[r].push(o[r][(h-1)*2]),e.uvs[r].push(o[r][(h-1)*2+1]),e.uvs[r].push(o[r][2*h]),e.uvs[r].push(o[r][2*h+1])})}addMorphTargets(e,t,r,i){if(0===r.length)return;e.morphTargetsRelative=!0,e.morphAttributes.position=[];let n=this;r.forEach(function(r){r.rawTargets.forEach(function(r){let a=S.Objects.Geometry[r.geoID];void 0!==a&&n.genMorphGeometry(e,t,a,i,r.name)})})}genMorphGeometry(e,t,r,i,n){let a=void 0!==t.PolygonVertexIndex?t.PolygonVertexIndex.a:[],o=void 0!==r.Vertices?r.Vertices.a:[],s=void 0!==r.Indexes?r.Indexes.a:[],l=new Float32Array(3*e.attributes.position.count);for(let e=0;e<s.length;e++){let t=3*s[e];l[t]=o[3*e],l[t+1]=o[3*e+1],l[t+2]=o[3*e+2]}let c=this.genBuffers({vertexIndices:a,vertexPositions:l}),h=new hu.Float32BufferAttribute(c.vertex,3);h.name=n||r.attrName,h.applyMatrix4(i),e.morphAttributes.position.push(h)}parseNormals(e){let t=e.MappingInformationType,r=e.ReferenceInformationType,i=e.Normals.a,n=[];return"IndexToDirect"===r&&("NormalIndex"in e?n=e.NormalIndex.a:"NormalsIndex"in e&&(n=e.NormalsIndex.a)),{dataSize:3,buffer:i,indices:n,mappingType:t,referenceType:r}}parseUVs(e){let t=e.MappingInformationType,r=e.ReferenceInformationType,i=e.UV.a,n=[];return"IndexToDirect"===r&&(n=e.UVIndex.a),{dataSize:2,buffer:i,indices:n,mappingType:t,referenceType:r}}parseVertexColors(e){let t=e.MappingInformationType,r=e.ReferenceInformationType,i=e.Colors.a,n=[];return"IndexToDirect"===r&&(n=e.ColorIndex.a),{dataSize:4,buffer:i,indices:n,mappingType:t,referenceType:r}}parseMaterialIndices(e){let t=e.MappingInformationType,r=e.ReferenceInformationType;if("NoMappingInformation"===t)return{dataSize:1,buffer:[0],indices:[0],mappingType:"AllSame",referenceType:r};let i=e.Materials.a,n=[];for(let e=0;e<i.length;++e)n.push(e);return{dataSize:1,buffer:i,indices:n,mappingType:t,referenceType:r}}parseNurbsGeometry(e){let t,r;if(void 0===uX)return console.error("THREE.FBXLoader: The loader relies on NURBSCurve for any nurbs present in the model. Nurbs will show up as empty geometry."),new hu.BufferGeometry;let i=parseInt(e.Order);if(isNaN(i))return console.error("THREE.FBXLoader: Invalid Order %s given for geometry ID: %s",e.Order,e.id),new hu.BufferGeometry;let n=i-1,a=e.KnotVector.a,o=[],s=e.Points.a;for(let e=0,t=s.length;e<t;e+=4)o.push(new hu.Vector4().fromArray(s,e));if("Closed"===e.Form)o.push(o[0]);else if("Periodic"===e.Form){t=n,r=a.length-1-t;for(let e=0;e<n;++e)o.push(o[e])}let l=new uX(n,a,o,t,r).getPoints(12*o.length);return new hu.BufferGeometry().setFromPoints(l)}}class u1{parse(){let e=[],t=this.parseClips();if(void 0!==t)for(let r in t){let i=t[r],n=this.addClip(i);e.push(n)}return e}parseClips(){if(void 0===S.Objects.AnimationCurve)return;let e=this.parseAnimationCurveNodes();this.parseAnimationCurves(e);let t=this.parseAnimationLayers(e);return this.parseAnimStacks(t)}parseAnimationCurveNodes(){let e=S.Objects.AnimationCurveNode,t=new Map;for(let r in e){let i=e[r];if(null!==i.attrName.match(/S|R|T|DeformPercent/)){let e={id:i.id,attr:i.attrName,curves:{}};t.set(e.id,e)}}return t}parseAnimationCurves(e){let t=S.Objects.AnimationCurve;for(let r in t){let i={id:t[r].id,times:t[r].KeyTime.a.map(u6),values:t[r].KeyValueFloat.a},n=T.get(i.id);if(void 0!==n){let t=n.parents[0].ID,r=n.parents[0].relationship;r.match(/X/)?e.get(t).curves.x=i:r.match(/Y/)?e.get(t).curves.y=i:r.match(/Z/)?e.get(t).curves.z=i:r.match(/d|DeformPercent/)&&e.has(t)&&(e.get(t).curves.morph=i)}}}parseAnimationLayers(e){let t=S.Objects.AnimationLayer,r=new Map;for(let i in t){let t=[],n=T.get(parseInt(i));void 0!==n&&(n.children.forEach(function(r,i){if(e.has(r.ID)){let n=e.get(r.ID);if(void 0!==n.curves.x||void 0!==n.curves.y||void 0!==n.curves.z){if(void 0===t[i]){let e=T.get(r.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID;if(void 0!==e){let n=S.Objects.Model[e.toString()];if(void 0===n)return void console.warn("THREE.FBXLoader: Encountered a unused curve.",r);let a={modelName:n.attrName?hu.PropertyBinding.sanitizeNodeName(n.attrName):"",ID:n.id,initialPosition:[0,0,0],initialRotation:[0,0,0],initialScale:[1,1,1]};D.traverse(function(e){e.ID===n.id&&(a.transform=e.matrix,e.userData.transformData&&(a.eulerOrder=e.userData.transformData.eulerOrder))}),a.transform||(a.transform=new hu.Matrix4),"PreRotation"in n&&(a.preRotation=n.PreRotation.value),"PostRotation"in n&&(a.postRotation=n.PostRotation.value),t[i]=a}}t[i]&&(t[i][n.attr]=n)}else if(void 0!==n.curves.morph){if(void 0===t[i]){let e=T.get(r.ID).parents.filter(function(e){return void 0!==e.relationship})[0].ID,n=T.get(e).parents[0].ID,a=T.get(n).parents[0].ID,o=T.get(a).parents[0].ID,s=S.Objects.Model[o],l={modelName:s.attrName?hu.PropertyBinding.sanitizeNodeName(s.attrName):"",morphName:S.Objects.Deformer[e].attrName};t[i]=l}t[i][n.attr]=n}}}),r.set(parseInt(i),t))}return r}parseAnimStacks(e){let t=S.Objects.AnimationStack,r={};for(let i in t){let n=T.get(parseInt(i)).children;n.length>1&&console.warn("THREE.FBXLoader: Encountered an animation stack with multiple layers, this is currently not supported. Ignoring subsequent layers.");let a=e.get(n[0].ID);r[i]={name:t[i].attrName,layer:a}}return r}addClip(e){let t=[],r=this;return e.layer.forEach(function(e){t=t.concat(r.generateTracks(e))}),new hu.AnimationClip(e.name,-1,t)}generateTracks(e){let t=[],r=new hu.Vector3,i=new hu.Quaternion,n=new hu.Vector3;if(e.transform&&e.transform.decompose(r,i,n),r=r.toArray(),i=new hu.Euler().setFromQuaternion(i,e.eulerOrder).toArray(),n=n.toArray(),void 0!==e.T&&Object.keys(e.T.curves).length>0){let i=this.generateVectorTrack(e.modelName,e.T.curves,r,"position");void 0!==i&&t.push(i)}if(void 0!==e.R&&Object.keys(e.R.curves).length>0){let r=this.generateRotationTrack(e.modelName,e.R.curves,i,e.preRotation,e.postRotation,e.eulerOrder);void 0!==r&&t.push(r)}if(void 0!==e.S&&Object.keys(e.S.curves).length>0){let r=this.generateVectorTrack(e.modelName,e.S.curves,n,"scale");void 0!==r&&t.push(r)}if(void 0!==e.DeformPercent){let r=this.generateMorphTrack(e);void 0!==r&&t.push(r)}return t}generateVectorTrack(e,t,r,i){let n=this.getTimesForAllAxes(t),a=this.getKeyframeTrackValues(n,t,r);return new hu.VectorKeyframeTrack(e+"."+i,n,a)}generateRotationTrack(e,t,r,i,n,a){void 0!==t.x&&(this.interpolateRotations(t.x),t.x.values=t.x.values.map(hu.MathUtils.degToRad)),void 0!==t.y&&(this.interpolateRotations(t.y),t.y.values=t.y.values.map(hu.MathUtils.degToRad)),void 0!==t.z&&(this.interpolateRotations(t.z),t.z.values=t.z.values.map(hu.MathUtils.degToRad));let o=this.getTimesForAllAxes(t),s=this.getKeyframeTrackValues(o,t,r);void 0!==i&&((i=i.map(hu.MathUtils.degToRad)).push(a),i=new hu.Euler().fromArray(i),i=new hu.Quaternion().setFromEuler(i)),void 0!==n&&((n=n.map(hu.MathUtils.degToRad)).push(a),n=new hu.Euler().fromArray(n),n=new hu.Quaternion().setFromEuler(n).invert());let l=new hu.Quaternion,c=new hu.Euler,h=[];for(let e=0;e<s.length;e+=3)c.set(s[e],s[e+1],s[e+2],a),l.setFromEuler(c),void 0!==i&&l.premultiply(i),void 0!==n&&l.multiply(n),l.toArray(h,e/3*4);return new hu.QuaternionKeyframeTrack(e+".quaternion",o,h)}generateMorphTrack(e){let t=e.DeformPercent.curves.morph,r=t.values.map(function(e){return e/100}),i=D.getObjectByName(e.modelName).morphTargetDictionary[e.morphName];return new hu.NumberKeyframeTrack(e.modelName+".morphTargetInfluences["+i+"]",t.times,r)}getTimesForAllAxes(e){let t=[];if(void 0!==e.x&&(t=t.concat(e.x.times)),void 0!==e.y&&(t=t.concat(e.y.times)),void 0!==e.z&&(t=t.concat(e.z.times)),(t=t.sort(function(e,t){return e-t})).length>1){let e=1,r=t[0];for(let i=1;i<t.length;i++){let n=t[i];n!==r&&(t[e]=n,r=n,e++)}t=t.slice(0,e)}return t}getKeyframeTrackValues(e,t,r){let i=[],n=-1,a=-1,o=-1;return e.forEach(function(e){if(t.x&&(n=t.x.times.indexOf(e)),t.y&&(a=t.y.times.indexOf(e)),t.z&&(o=t.z.times.indexOf(e)),-1!==n){let e=t.x.values[n];i.push(e),r[0]=e}else i.push(r[0]);if(-1!==a){let e=t.y.values[a];i.push(e),r[1]=e}else i.push(r[1]);if(-1!==o){let e=t.z.values[o];i.push(e),r[2]=e}else i.push(r[2])}),i}interpolateRotations(e){for(let t=1;t<e.values.length;t++){let r=e.values[t-1],i=e.values[t]-r,n=Math.abs(i);if(n>=180){let a=n/180,o=i/a,s=r+o,l=e.times[t-1],c=(e.times[t]-l)/a,h=l+c,u=[],A=[];for(;h<e.times[t];)u.push(h),h+=c,A.push(s),s+=o;e.times=Aa(e.times,t,u),e.values=Aa(e.values,t,A)}}}}class u0{getPrevNode(){return this.nodeStack[this.currentIndent-2]}getCurrentNode(){return this.nodeStack[this.currentIndent-1]}getCurrentProp(){return this.currentProp}pushStack(e){this.nodeStack.push(e),this.currentIndent+=1}popStack(){this.nodeStack.pop(),this.currentIndent-=1}setCurrentProp(e,t){this.currentProp=e,this.currentPropName=t}parse(e){this.currentIndent=0,this.allNodes=new u4,this.nodeStack=[],this.currentProp=[],this.currentPropName="";let t=this,r=e.split(/[\r\n]+/);return r.forEach(function(e,i){let n=e.match(/^[\s\t]*;/),a=e.match(/^[\s\t]*$/);if(n||a)return;let o=e.match("^\\t{"+t.currentIndent+"}(\\w+):(.*){",""),s=e.match("^\\t{"+t.currentIndent+"}(\\w+):[\\s\\t\\r\\n](.*)"),l=e.match("^\\t{"+(t.currentIndent-1)+"}}");o?t.parseNodeBegin(e,o):s?t.parseNodeProperty(e,s,r[++i]):l?t.popStack():e.match(/^[^\s\t}]/)&&t.parseNodePropertyContinued(e)}),this.allNodes}parseNodeBegin(e,t){let r=t[1].trim().replace(/^"/,"").replace(/"$/,""),i=t[2].split(",").map(function(e){return e.trim().replace(/^"/,"").replace(/"$/,"")}),n={name:r},a=this.parseNodeAttr(i),o=this.getCurrentNode();0===this.currentIndent?this.allNodes.add(r,n):r in o?("PoseNode"===r?o.PoseNode.push(n):void 0!==o[r].id&&(o[r]={},o[r][o[r].id]=o[r]),""!==a.id&&(o[r][a.id]=n)):"number"==typeof a.id?(o[r]={},o[r][a.id]=n):"Properties70"!==r&&("PoseNode"===r?o[r]=[n]:o[r]=n),"number"==typeof a.id&&(n.id=a.id),""!==a.name&&(n.attrName=a.name),""!==a.type&&(n.attrType=a.type),this.pushStack(n)}parseNodeAttr(e){let t=e[0];""!==e[0]&&isNaN(t=parseInt(e[0]))&&(t=e[0]);let r="",i="";return e.length>1&&(r=e[1].replace(/^(\w+)::/,""),i=e[2]),{id:t,name:r,type:i}}parseNodeProperty(e,t,r){let i=t[1].replace(/^"/,"").replace(/"$/,"").trim(),n=t[2].replace(/^"/,"").replace(/"$/,"").trim();"Content"===i&&","===n&&(n=r.replace(/"/g,"").replace(/,$/,"").trim());let a=this.getCurrentNode();if("Properties70"===a.name)return void this.parseNodeSpecialProperty(e,i,n);if("C"===i){let e=n.split(",").slice(1),t=parseInt(e[0]),r=parseInt(e[1]),o=n.split(",").slice(3);o=o.map(function(e){return e.trim().replace(/^"/,"")}),i="connections",function(e,t){for(let r=0,i=e.length,n=t.length;r<n;r++,i++)e[i]=t[r]}(n=[t,r],o),void 0===a[i]&&(a[i]=[])}"Node"===i&&(a.id=n),i in a&&Array.isArray(a[i])?a[i].push(n):"a"!==i?a[i]=n:a.a=n,this.setCurrentProp(a,i),"a"===i&&","!==n.slice(-1)&&(a.a=Ai(n))}parseNodePropertyContinued(e){let t=this.getCurrentNode();t.a+=e,","!==e.slice(-1)&&(t.a=Ai(t.a))}parseNodeSpecialProperty(e,t,r){let i=r.split('",').map(function(e){return e.trim().replace(/^\"/,"").replace(/\s/,"_")}),n=i[0],a=i[1],o=i[2],s=i[3],l=i[4];switch(a){case"int":case"enum":case"bool":case"ULongLong":case"double":case"Number":case"FieldOfView":l=parseFloat(l);break;case"Color":case"ColorRGB":case"Vector3D":case"Lcl_Translation":case"Lcl_Rotation":case"Lcl_Scaling":l=Ai(l)}this.getPrevNode()[n]={type:a,type2:o,flag:s,value:l},this.setCurrentProp(this.getPrevNode(),n)}}class u2{parse(e){let t=new u3(e);t.skip(23);let r=t.getUint32();if(r<6400)throw Error("THREE.FBXLoader: FBX version not supported, FileVersion: "+r);let i=new u4;for(;!this.endOfContent(t);){let e=this.parseNode(t,r);null!==e&&i.add(e.name,e)}return i}endOfContent(e){return e.size()%16==0?(e.getOffset()+160+16&-16)>=e.size():e.getOffset()+160+16>=e.size()}parseNode(e,t){let r={},i=t>=7500?e.getUint64():e.getUint32(),n=t>=7500?e.getUint64():e.getUint32();t>=7500?e.getUint64():e.getUint32();let a=e.getUint8(),o=e.getString(a);if(0===i)return null;let s=[];for(let t=0;t<n;t++)s.push(this.parseProperty(e));let l=s.length>0?s[0]:"",c=s.length>1?s[1]:"",h=s.length>2?s[2]:"";for(r.singleProperty=1===n&&e.getOffset()===i;i>e.getOffset();){let i=this.parseNode(e,t);null!==i&&this.parseSubNode(o,r,i)}return r.propertyList=s,"number"==typeof l&&(r.id=l),""!==c&&(r.attrName=c),""!==h&&(r.attrType=h),""!==o&&(r.name=o),r}parseSubNode(e,t,r){if(!0===r.singleProperty){let e=r.propertyList[0];Array.isArray(e)?(t[r.name]=r,r.a=e):t[r.name]=e}else if("Connections"===e&&"C"===r.name){let e=[];r.propertyList.forEach(function(t,r){0!==r&&e.push(t)}),void 0===t.connections&&(t.connections=[]),t.connections.push(e)}else if("Properties70"===r.name)Object.keys(r).forEach(function(e){t[e]=r[e]});else if("Properties70"===e&&"P"===r.name){let e,i=r.propertyList[0],n=r.propertyList[1],a=r.propertyList[2],o=r.propertyList[3];0===i.indexOf("Lcl ")&&(i=i.replace("Lcl ","Lcl_")),0===n.indexOf("Lcl ")&&(n=n.replace("Lcl ","Lcl_")),e="Color"===n||"ColorRGB"===n||"Vector"===n||"Vector3D"===n||0===n.indexOf("Lcl_")?[r.propertyList[4],r.propertyList[5],r.propertyList[6]]:r.propertyList[4],t[i]={type:n,type2:a,flag:o,value:e}}else void 0===t[r.name]?"number"==typeof r.id?(t[r.name]={},t[r.name][r.id]=r):t[r.name]=r:"PoseNode"===r.name?(Array.isArray(t[r.name])||(t[r.name]=[t[r.name]]),t[r.name].push(r)):void 0===t[r.name][r.id]&&(t[r.name][r.id]=r)}parseProperty(e){let t,r=e.getString(1);switch(r){case"C":return e.getBoolean();case"D":return e.getFloat64();case"F":return e.getFloat32();case"I":return e.getInt32();case"L":return e.getInt64();case"R":return t=e.getUint32(),e.getArrayBuffer(t);case"S":return t=e.getUint32(),e.getString(t);case"Y":return e.getInt16();case"b":case"c":case"d":case"f":case"i":case"l":let i=e.getUint32(),n=e.getUint32(),a=e.getUint32();if(0===n)switch(r){case"b":case"c":return e.getBooleanArray(i);case"d":return e.getFloat64Array(i);case"f":return e.getFloat32Array(i);case"i":return e.getInt32Array(i);case"l":return e.getInt64Array(i)}let o=new u3(uM(new Uint8Array(e.getArrayBuffer(a))).buffer);switch(r){case"b":case"c":return o.getBooleanArray(i);case"d":return o.getFloat64Array(i);case"f":return o.getFloat32Array(i);case"i":return o.getInt32Array(i);case"l":return o.getInt64Array(i)}default:throw Error("THREE.FBXLoader: Unknown property type "+r)}}}class u3{constructor(e,t){this.dv=new DataView(e),this.offset=0,this.littleEndian=void 0===t||t}getOffset(){return this.offset}size(){return this.dv.buffer.byteLength}skip(e){this.offset+=e}getBoolean(){return(1&this.getUint8())==1}getBooleanArray(e){let t=[];for(let r=0;r<e;r++)t.push(this.getBoolean());return t}getUint8(){let e=this.dv.getUint8(this.offset);return this.offset+=1,e}getInt16(){let e=this.dv.getInt16(this.offset,this.littleEndian);return this.offset+=2,e}getInt32(){let e=this.dv.getInt32(this.offset,this.littleEndian);return this.offset+=4,e}getInt32Array(e){let t=[];for(let r=0;r<e;r++)t.push(this.getInt32());return t}getUint32(){let e=this.dv.getUint32(this.offset,this.littleEndian);return this.offset+=4,e}getInt64(){let e,t;return(this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),0x80000000&t)?(t=~t,0xffffffff==(e=~e)&&(t=t+1|0),-(0x100000000*t+(e=e+1|0))):0x100000000*t+e}getInt64Array(e){let t=[];for(let r=0;r<e;r++)t.push(this.getInt64());return t}getUint64(){let e,t;return this.littleEndian?(e=this.getUint32(),t=this.getUint32()):(t=this.getUint32(),e=this.getUint32()),0x100000000*t+e}getFloat32(){let e=this.dv.getFloat32(this.offset,this.littleEndian);return this.offset+=4,e}getFloat32Array(e){let t=[];for(let r=0;r<e;r++)t.push(this.getFloat32());return t}getFloat64(){let e=this.dv.getFloat64(this.offset,this.littleEndian);return this.offset+=8,e}getFloat64Array(e){let t=[];for(let r=0;r<e;r++)t.push(this.getFloat64());return t}getArrayBuffer(e){let t=this.dv.buffer.slice(this.offset,this.offset+e);return this.offset+=e,t}getString(e){let t=[];for(let r=0;r<e;r++)t[r]=this.getUint8();let r=t.indexOf(0);return r>=0&&(t=t.slice(0,r)),sR(new Uint8Array(t))}}class u4{add(e,t){this[e]=t}}function u5(e){let t=e.match(/FBXVersion: (\d+)/);if(t)return parseInt(t[1]);throw Error("THREE.FBXLoader: Cannot find the version number for the file given.")}function u6(e){return e/46186158e3}let u8=[];function u9(e,t,r,i){let n;switch(i.mappingType){case"ByPolygonVertex":n=e;break;case"ByPolygon":n=t;break;case"ByVertice":n=r;break;case"AllSame":n=i.indices[0];break;default:console.warn("THREE.FBXLoader: unknown attribute mapping type "+i.mappingType)}"IndexToDirect"===i.referenceType&&(n=i.indices[n]);let a=n*i.dataSize,o=a+i.dataSize;var s=u8,l=i.buffer,c=a,h=o;for(let e=c,t=0;e<h;e++,t++)s[t]=l[e];return s}let u7=new hu.Euler,Ae=new hu.Vector3;function At(e){let t=new hu.Matrix4,r=new hu.Matrix4,i=new hu.Matrix4,n=new hu.Matrix4,a=new hu.Matrix4,o=new hu.Matrix4,s=new hu.Matrix4,l=new hu.Matrix4,c=new hu.Matrix4,h=new hu.Matrix4,u=new hu.Matrix4,A=new hu.Matrix4,d=e.inheritType?e.inheritType:0;if(e.translation&&t.setPosition(Ae.fromArray(e.translation)),e.preRotation){let t=e.preRotation.map(hu.MathUtils.degToRad);t.push(e.eulerOrder),r.makeRotationFromEuler(u7.fromArray(t))}if(e.rotation){let t=e.rotation.map(hu.MathUtils.degToRad);t.push(e.eulerOrder),i.makeRotationFromEuler(u7.fromArray(t))}if(e.postRotation){let t=e.postRotation.map(hu.MathUtils.degToRad);t.push(e.eulerOrder),n.makeRotationFromEuler(u7.fromArray(t)),n.invert()}e.scale&&a.scale(Ae.fromArray(e.scale)),e.scalingOffset&&s.setPosition(Ae.fromArray(e.scalingOffset)),e.scalingPivot&&o.setPosition(Ae.fromArray(e.scalingPivot)),e.rotationOffset&&l.setPosition(Ae.fromArray(e.rotationOffset)),e.rotationPivot&&c.setPosition(Ae.fromArray(e.rotationPivot)),e.parentMatrixWorld&&(u.copy(e.parentMatrix),h.copy(e.parentMatrixWorld));let f=r.clone().multiply(i).multiply(n),m=new hu.Matrix4;m.extractRotation(h);let p=new hu.Matrix4;p.copyPosition(h);let g=p.clone().invert().multiply(h),v=m.clone().invert().multiply(g),y=new hu.Matrix4;if(0===d)y.copy(m).multiply(f).multiply(v).multiply(a);else if(1===d)y.copy(m).multiply(v).multiply(f).multiply(a);else{let e=new hu.Matrix4().scale(new hu.Vector3().setFromMatrixScale(u)).clone().invert(),t=v.clone().multiply(e);y.copy(m).multiply(f).multiply(t).multiply(a)}let x=c.clone().invert(),E=o.clone().invert(),C=t.clone().multiply(l).multiply(c).multiply(r).multiply(i).multiply(n).multiply(x).multiply(s).multiply(o).multiply(a).multiply(E),B=new hu.Matrix4().copyPosition(C),w=h.clone().multiply(B);return A.copyPosition(w),(C=A.clone().multiply(y)).premultiply(h.invert()),C}function Ar(e){let t=["ZYX","YZX","XZY","ZXY","YXZ","XYZ"];return 6===(e=e||0)?(console.warn("THREE.FBXLoader: unsupported Euler Order: Spherical XYZ. Animations and rotations may be incorrect."),t[0]):t[e]}function Ai(e){return e.split(",").map(function(e){return parseFloat(e)})}function An(e,t,r){return void 0===t&&(t=0),void 0===r&&(r=e.byteLength),sR(new Uint8Array(e,t,r))}function Aa(e,t,r){return e.slice(0,t).concat(r).concat(e.slice(t))}var nX=tI;function Ao(e){return(0,nX.G)(uq,e)}function As({path:e,...t}){let r=Ao(e).children[0];return tC.createElement(sm,e2({},t,{object:r}))}Ao.preload=e=>nX.G.preload(uq,e),Ao.clear=e=>nX.G.clear(uq,e);var tI=tI,nX=tI,Al=tw;class Ac{constructor(e=4){this.pool=e,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(e){if(!this.workers[e]){let t=this.workerCreator();t.addEventListener("message",this._onMessage.bind(this,e)),this.workers[e]=t}}_getIdleWorker(){for(let e=0;e<this.pool;e++)if(!(this.workerStatus&1<<e))return e;return -1}_onMessage(e,t){let r=this.workersResolve[e];if(r&&r(t),this.queue.length){let{resolve:t,msg:r,transfer:i}=this.queue.shift();this.workersResolve[e]=t,this.workers[e].postMessage(r,i)}else this.workerStatus^=1<<e}setWorkerCreator(e){this.workerCreator=e}setWorkerLimit(e){this.pool=e}postMessage(e,t){return new Promise(r=>{let i=this._getIdleWorker();-1!==i?(this._initWorker(i),this.workerStatus|=1<<i,this.workersResolve[i]=r,this.workers[i].postMessage(e,t)):this.queue.push({resolve:r,msg:e,transfer:t})})}dispose(){this.workers.forEach(e=>e.terminate()),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}var Ah=e.i(67034);class Au{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class AA{constructor(e,t,r,i){this._dataView=void 0,this._littleEndian=void 0,this._offset=void 0,this._dataView=new DataView(e.buffer,e.byteOffset+t,r),this._littleEndian=i,this._offset=0}_nextUint8(){let e=this._dataView.getUint8(this._offset);return this._offset+=1,e}_nextUint16(){let e=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,e}_nextUint32(){let e=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint64(){let e=this._dataView.getUint32(this._offset,this._littleEndian),t=this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,e+0x100000000*t}_nextInt32(){let e=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,e}_nextUint8Array(e){let t=new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+this._offset,e);return this._offset+=e,t}_skip(e){return this._offset+=e,this}_scan(e,t){void 0===t&&(t=0);let r=this._offset,i=0;for(;this._dataView.getUint8(this._offset)!==t&&i<e;)i++,this._offset++;return i<e&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+r,i)}}let Ad=[171,75,84,88,32,50,48,187,13,10,26,10];function Af(e){return"undefined"!=typeof TextDecoder?new TextDecoder().decode(e):Ah.Buffer.from(e).toString("utf8")}let Am={env:{emscripten_notify_memory_growth:function(e){P=new Uint8Array(R.exports.memory.buffer)}}};class Ap{init(){return F||(F="undefined"!=typeof fetch?fetch("data:application/wasm;base64,"+Ag).then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,Am)).then(this._init):WebAssembly.instantiate(Ah.Buffer.from(Ag,"base64"),Am).then(this._init))}_init(e){R=e.instance,Am.env.emscripten_notify_memory_growth(0)}decode(e,t=0){if(!R)throw Error("ZSTDDecoder: Await .init() before decoding.");let r=e.byteLength,i=R.exports.malloc(r);P.set(e,i),t=t||Number(R.exports.ZSTD_findDecompressedSize(i,r));let n=R.exports.malloc(t),a=R.exports.ZSTD_decompress(n,t,i,r),o=P.slice(n,n+a);return R.exports.free(i),R.exports.free(n),o}}let Ag="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IAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigC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C0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdB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IAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEE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";var Av=tw;class Ay extends Av.CompressedTexture{constructor(e,t,r){super(void 0,e[0].width,e[0].height,t,r,Av.CubeReflectionMapping),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}var Ax=tw;class AE extends Ax.CompressedTexture{constructor(e,t,r,i,n,a){super(e,t,r,n,a),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=Ax.ClampToEdgeWrapping}}var AC=tw;class AB extends AC.Texture{constructor(e=null,t=1,r=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=AC.NearestFilter,this.minFilter=AC.NearestFilter,this.wrapR=AC.ClampToEdgeWrapping,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}var Aw=Object.defineProperty,AI=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?Aw(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r,r};let Ab="srgb",A_=new WeakMap,AM=0,AS=(AI(Y=class extends Al.Loader{constructor(e){super(e),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new Ac,this.workerSourceURL="",this.workerConfig=null,"undefined"!=typeof MSC_TRANSCODER&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(e){return this.transcoderPath=e,this}setWorkerLimit(e){return this.workerPool.setWorkerLimit(e),this}detectSupport(e){return this.workerConfig={astcSupported:e.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:e.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:e.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:e.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:e.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:e.extensions.has("WEBGL_compressed_texture_pvrtc")||e.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},e.capabilities.isWebGL2&&(this.workerConfig.etc1Supported=!1),this}init(){if(!this.transcoderPending){let e=new Al.FileLoader(this.manager);e.setPath(this.transcoderPath),e.setWithCredentials(this.withCredentials);let t=e.loadAsync("basis_transcoder.js"),r=new Al.FileLoader(this.manager);r.setPath(this.transcoderPath),r.setResponseType("arraybuffer"),r.setWithCredentials(this.withCredentials);let i=r.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([t,i]).then(([e,t])=>{let r=Y.BasisWorker.toString(),i=["/* constants */","let _EngineFormat = "+JSON.stringify(Y.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(Y.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(Y.BasisFormat),"/* basis_transcoder.js */",e,"/* worker */",r.substring(r.indexOf("{")+1,r.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([i])),this.transcoderBinary=t,this.workerPool.setWorkerCreator(()=>{let e=new Worker(this.workerSourceURL),t=this.transcoderBinary.slice(0);return e.postMessage({type:"init",config:this.workerConfig,transcoderBinary:t},[t]),e})}),AM>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),AM++}return this.transcoderPending}load(e,t,r,i){if(null===this.workerConfig)throw Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");let n=new Al.FileLoader(this.manager);n.setResponseType("arraybuffer"),n.setWithCredentials(this.withCredentials),n.load(e,e=>{if(A_.has(e))return A_.get(e).promise.then(t).catch(i);this._createTexture(e).then(e=>t?t(e):null).catch(i)},r,i)}_createTextureFrom(e,t){let r,{faces:i,width:n,height:a,format:o,type:s,error:l,dfdFlags:c}=e;if("error"===s)return Promise.reject(l);if(6===t.faceCount)r=new Ay(i,o,Al.UnsignedByteType);else{let e=i[0].mipmaps;r=t.layerCount>1?new AE(e,n,a,t.layerCount,o,Al.UnsignedByteType):new Al.CompressedTexture(e,n,a,o,Al.UnsignedByteType)}r.minFilter=1===i[0].mipmaps.length?Al.LinearFilter:Al.LinearMipmapLinearFilter,r.magFilter=Al.LinearFilter,r.generateMipmaps=!1,r.needsUpdate=!0;let h=AP(t);return"colorSpace"in r?r.colorSpace=h:r.encoding=h===Ab?3001:3e3,r.premultiplyAlpha=!!(1&c),r}async _createTexture(e,t={}){let r=function(e){let t=new Uint8Array(e.buffer,e.byteOffset,Ad.length);if(t[0]!==Ad[0]||t[1]!==Ad[1]||t[2]!==Ad[2]||t[3]!==Ad[3]||t[4]!==Ad[4]||t[5]!==Ad[5]||t[6]!==Ad[6]||t[7]!==Ad[7]||t[8]!==Ad[8]||t[9]!==Ad[9]||t[10]!==Ad[10]||t[11]!==Ad[11])throw Error("Missing KTX 2.0 identifier.");let r=new Au,i=17*Uint32Array.BYTES_PER_ELEMENT,n=new AA(e,Ad.length,i,!0);r.vkFormat=n._nextUint32(),r.typeSize=n._nextUint32(),r.pixelWidth=n._nextUint32(),r.pixelHeight=n._nextUint32(),r.pixelDepth=n._nextUint32(),r.layerCount=n._nextUint32(),r.faceCount=n._nextUint32();let a=n._nextUint32();r.supercompressionScheme=n._nextUint32();let o=n._nextUint32(),s=n._nextUint32(),l=n._nextUint32(),c=n._nextUint32(),h=n._nextUint64(),u=n._nextUint64(),A=new AA(e,Ad.length+i,3*a*8,!0);for(let t=0;t<a;t++)r.levels.push({levelData:new Uint8Array(e.buffer,e.byteOffset+A._nextUint64(),A._nextUint64()),uncompressedByteLength:A._nextUint64()});let d=new AA(e,o,s,!0),f={vendorId:d._skip(4)._nextUint16(),descriptorType:d._nextUint16(),versionNumber:d._nextUint16(),descriptorBlockSize:d._nextUint16(),colorModel:d._nextUint8(),colorPrimaries:d._nextUint8(),transferFunction:d._nextUint8(),flags:d._nextUint8(),texelBlockDimension:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],bytesPlane:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],samples:[]},m=(f.descriptorBlockSize/4-6)/4;for(let e=0;e<m;e++){let t={bitOffset:d._nextUint16(),bitLength:d._nextUint8(),channelType:d._nextUint8(),samplePosition:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&t.channelType?(t.sampleLower=d._nextInt32(),t.sampleUpper=d._nextInt32()):(t.sampleLower=d._nextUint32(),t.sampleUpper=d._nextUint32()),f.samples[e]=t}r.dataFormatDescriptor.length=0,r.dataFormatDescriptor.push(f);let p=new AA(e,l,c,!0);for(;p._offset<c;){let e=p._nextUint32(),t=p._scan(e),i=Af(t);if(r.keyValue[i]=p._nextUint8Array(e-t.byteLength-1),i.match(/^ktx/i)){let e=Af(r.keyValue[i]);r.keyValue[i]=e.substring(0,e.lastIndexOf("\0"))}let n=e%4?4-e%4:0;p._skip(n)}if(u<=0)return r;let g=new AA(e,h,u,!0),v=g._nextUint16(),y=g._nextUint16(),x=g._nextUint32(),E=g._nextUint32(),C=g._nextUint32(),B=g._nextUint32(),w=[];for(let e=0;e<a;e++)w.push({imageFlags:g._nextUint32(),rgbSliceByteOffset:g._nextUint32(),rgbSliceByteLength:g._nextUint32(),alphaSliceByteOffset:g._nextUint32(),alphaSliceByteLength:g._nextUint32()});let I=h+g._offset,b=I+x,_=b+E,M=_+C,S=new Uint8Array(e.buffer,e.byteOffset+I,x),T=new Uint8Array(e.buffer,e.byteOffset+b,E);return r.globalData={endpointCount:v,selectorCount:y,imageDescs:w,endpointsData:S,selectorsData:T,tablesData:new Uint8Array(e.buffer,e.byteOffset+_,C),extendedData:new Uint8Array(e.buffer,e.byteOffset+M,B)},r}(new Uint8Array(e));if(0!==r.vkFormat)return AR(r);let i=this.init().then(()=>this.workerPool.postMessage({type:"transcode",buffer:e,taskConfig:t},[e])).then(e=>this._createTextureFrom(e.data,r));return A_.set(e,{promise:i}),i}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),AM--,this}},"BasisFormat",{ETC1S:0,UASTC_4x4:1}),AI(Y,"TranscoderFormat",{ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16}),AI(Y,"EngineFormat",{RGBAFormat:Al.RGBAFormat,RGBA_ASTC_4x4_Format:Al.RGBA_ASTC_4x4_Format,RGBA_BPTC_Format:Al.RGBA_BPTC_Format,RGBA_ETC2_EAC_Format:Al.RGBA_ETC2_EAC_Format,RGBA_PVRTC_4BPPV1_Format:Al.RGBA_PVRTC_4BPPV1_Format,RGBA_S3TC_DXT5_Format:Al.RGBA_S3TC_DXT5_Format,RGB_ETC1_Format:Al.RGB_ETC1_Format,RGB_ETC2_Format:Al.RGB_ETC2_Format,RGB_PVRTC_4BPPV1_Format:Al.RGB_PVRTC_4BPPV1_Format,RGB_S3TC_DXT1_Format:Al.RGB_S3TC_DXT1_Format}),AI(Y,"BasisWorker",function(){let e,t,r,i=_EngineFormat,n=_TranscoderFormat,a=_BasisFormat;self.addEventListener("message",function(o){let h=o.data;switch(h.type){case"init":var u;e=h.config,u=h.transcoderBinary,t=new Promise(e=>{BASIS(r={wasmBinary:u,onRuntimeInitialized:e})}).then(()=>{r.initializeBasis(),void 0===r.KTX2File&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")});break;case"transcode":t.then(()=>{try{let{faces:t,buffers:o,width:u,height:A,hasAlpha:d,format:f,dfdFlags:m}=function(t){let o=new r.KTX2File(new Uint8Array(t));function h(){o.close(),o.delete()}if(!o.isValid())throw h(),Error("THREE.KTX2Loader:	Invalid or unsupported .ktx2 file");let u=o.isUASTC()?a.UASTC_4x4:a.ETC1S,A=o.getWidth(),d=o.getHeight(),f=o.getLayers()||1,m=o.getLevels(),p=o.getFaces(),g=o.getHasAlpha(),v=o.getDFDFlags(),{transcoderFormat:y,engineFormat:x}=function(t,r,o,h){let u,A=t===a.ETC1S?s:l;for(let i=0;i<A.length;i++){let n=A[i];if(e[n.if]&&n.basisFormat.includes(t)&&(!h||!(n.transcoderFormat.length<2))&&(!n.needsPowerOfTwo||c(r)&&c(o)))return{transcoderFormat:u=n.transcoderFormat[+!!h],engineFormat:n.engineFormat[+!!h]}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),{transcoderFormat:u=n.RGBA32,engineFormat:i.RGBAFormat}}(u,A,d,g);if(!A||!d||!m)throw h(),Error("THREE.KTX2Loader:	Invalid texture");if(!o.startTranscoding())throw h(),Error("THREE.KTX2Loader: .startTranscoding failed");let E=[],C=[];for(let e=0;e<p;e++){let t=[];for(let r=0;r<m;r++){let i,n,a=[];for(let t=0;t<f;t++){let s=o.getImageLevelInfo(r,t,e);0===e&&0===r&&0===t&&(s.origWidth%4!=0||s.origHeight%4!=0)&&console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),m>1?(i=s.origWidth,n=s.origHeight):(i=s.width,n=s.height);let l=new Uint8Array(o.getImageTranscodedSizeInBytes(r,t,0,y));if(!o.transcodeImage(l,r,t,e,y,0,-1,-1))throw h(),Error("THREE.KTX2Loader: .transcodeImage failed.");a.push(l)}let s=function(e){if(1===e.length)return e[0];let t=0;for(let r=0;r<e.length;r++)t+=e[r].byteLength;let r=new Uint8Array(t),i=0;for(let t=0;t<e.length;t++){let n=e[t];r.set(n,i),i+=n.byteLength}return r}(a);t.push({data:s,width:i,height:n}),C.push(s.buffer)}E.push({mipmaps:t,width:A,height:d,format:x})}return h(),{faces:E,buffers:C,width:A,height:d,hasAlpha:g,format:x,dfdFlags:v}}(h.buffer);self.postMessage({type:"transcode",id:h.id,faces:t,width:u,height:A,hasAlpha:d,format:f,dfdFlags:m},o)}catch(e){console.error(e),self.postMessage({type:"error",id:h.id,error:e.message})}})}});let o=[{if:"astcSupported",basisFormat:[a.UASTC_4x4],transcoderFormat:[n.ASTC_4x4,n.ASTC_4x4],engineFormat:[i.RGBA_ASTC_4x4_Format,i.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[n.BC7_M5,n.BC7_M5],engineFormat:[i.RGBA_BPTC_Format,i.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[n.BC1,n.BC3],engineFormat:[i.RGB_S3TC_DXT1_Format,i.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[n.ETC1,n.ETC2],engineFormat:[i.RGB_ETC2_Format,i.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[n.ETC1],engineFormat:[i.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[a.ETC1S,a.UASTC_4x4],transcoderFormat:[n.PVRTC1_4_RGB,n.PVRTC1_4_RGBA],engineFormat:[i.RGB_PVRTC_4BPPV1_Format,i.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],s=o.sort(function(e,t){return e.priorityETC1S-t.priorityETC1S}),l=o.sort(function(e,t){return e.priorityUASTC-t.priorityUASTC});function c(e){return e<=2||(e&e-1)==0&&0!==e}}),Y),AT=new Set([Al.RGBAFormat,Al.RGFormat,Al.RedFormat]),AD={109:Al.RGBAFormat,97:Al.RGBAFormat,37:Al.RGBAFormat,43:Al.RGBAFormat,103:Al.RGFormat,83:Al.RGFormat,16:Al.RGFormat,22:Al.RGFormat,100:Al.RedFormat,76:Al.RedFormat,15:Al.RedFormat,9:Al.RedFormat,166:Al.RGBA_ASTC_6x6_Format,165:Al.RGBA_ASTC_6x6_Format},AF={109:Al.FloatType,97:Al.HalfFloatType,37:Al.UnsignedByteType,43:Al.UnsignedByteType,103:Al.FloatType,83:Al.HalfFloatType,16:Al.UnsignedByteType,22:Al.UnsignedByteType,100:Al.FloatType,76:Al.HalfFloatType,15:Al.UnsignedByteType,9:Al.UnsignedByteType,166:Al.UnsignedByteType,165:Al.UnsignedByteType};async function AR(e){let t,r,{vkFormat:i}=e;if(void 0===AD[i])throw Error("THREE.KTX2Loader: Unsupported vkFormat.");2===e.supercompressionScheme&&(Q||(Q=new Promise(async e=>{let t=new Ap;await t.init(),e(t)})),t=await Q);let n=[];for(let r=0;r<e.levels.length;r++){let a,o,s=Math.max(1,e.pixelWidth>>r),l=Math.max(1,e.pixelHeight>>r),c=e.pixelDepth?Math.max(1,e.pixelDepth>>r):0,h=e.levels[r];if(0===e.supercompressionScheme)a=h.levelData;else if(2===e.supercompressionScheme)a=t.decode(h.levelData,h.uncompressedByteLength);else throw Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");o=AF[i]===Al.FloatType?new Float32Array(a.buffer,a.byteOffset,a.byteLength/Float32Array.BYTES_PER_ELEMENT):AF[i]===Al.HalfFloatType?new Uint16Array(a.buffer,a.byteOffset,a.byteLength/Uint16Array.BYTES_PER_ELEMENT):a,n.push({data:o,width:s,height:l,depth:c})}if(AT.has(AD[i]))r=0===e.pixelDepth?new Al.DataTexture(n[0].data,e.pixelWidth,e.pixelHeight):new AB(n[0].data,e.pixelWidth,e.pixelHeight,e.pixelDepth);else{if(e.pixelDepth>0)throw Error("THREE.KTX2Loader: Unsupported pixelDepth.");r=new Al.CompressedTexture(n,e.pixelWidth,e.pixelHeight)}r.mipmaps=n,r.type=AF[i],r.format=AD[i],r.needsUpdate=!0;let a=AP(e);return"colorSpace"in r?r.colorSpace=a:r.encoding=a===Ab?3001:3e3,Promise.resolve(r)}function AP(e){let t=e.dataFormatDescriptor[0];return 1===t.colorPrimaries?2===t.transferFunction?Ab:"srgb-linear":10===t.colorPrimaries?2===t.transferFunction?"display-p3":"display-p3-linear":(0===t.colorPrimaries||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${t.colorPrimaries}"`),"")}let AQ="https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master";function AU(e,t=`${AQ}/basis/`){let r=(0,tI.C)(e=>e.gl),i=(0,nX.G)(AS,oj(e)?Object.values(e):e,e=>{e.detectSupport(r),e.setTranscoderPath(t)});if((0,tC.useEffect)(()=>{(Array.isArray(i)?i:[i]).forEach(r.initTexture)},[r,i]),!oj(e))return i;{let t=Object.keys(e),r={};return t.forEach(e=>Object.assign(r,{[e]:i[t.indexOf(e)]})),r}}AU.preload=(e,t=`${AQ}/basis/`)=>nX.G.preload(AS,e,e=>{e.setTranscoderPath(t)}),AU.clear=e=>nX.G.clear(AS,e);let Az=({children:e,input:t,basisPath:r})=>{let i=AU(t,r);return tC.createElement(tC.Fragment,null,null==e?void 0:e(i))};var tI=tI,Ak=e.i(50471);let AL="undefined"!=typeof window&&"function"==typeof(null==(W=window.document)?void 0:W.createElement)&&"string"==typeof(null==(K=window.navigator)?void 0:K.userAgent),AO=null;async function AG(...t){null!=AO||(AO=await e.A(70308));let r=AO.default;return r.isSupported()?new r(...t):null}function AN(e,{unsuspend:t="loadedmetadata",start:r=!0,hls:i={},crossOrigin:n="anonymous",muted:a=!0,loop:o=!0,playsInline:s=!0,onVideoFrame:l,...c}={}){let h=(0,tI.C)(e=>e.gl),u=(0,tC.useRef)(null),A=(0,or.suspend)(()=>new Promise(async r=>{let l,A;"string"==typeof e?l=e:A=e;let d=Object.assign(document.createElement("video"),{src:l,srcObject:A,crossOrigin:n,loop:o,muted:a,playsInline:s,...c});if(l&&AL&&l.endsWith(".m3u8")){let e=u.current=await AG(i);e&&(e.on(Ak.Events.MEDIA_ATTACHED,()=>void e.loadSource(l)),e.attachMedia(d))}let f=new tw.VideoTexture(d);f.colorSpace=h.outputColorSpace,d.addEventListener(t,()=>r(f))}),[e]);return AV(A.source.data,l),(0,tC.useEffect)(()=>(r&&A.image.play(),()=>{u.current&&(u.current.destroy(),u.current=null)}),[A,r]),A}let AH=(0,tC.forwardRef)(({children:e,src:t,...r},i)=>{let n=AN(t,r);return(0,tC.useEffect)(()=>()=>void n.dispose(),[n]),(0,tC.useImperativeHandle)(i,()=>n,[n]),tC.createElement(tC.Fragment,null,null==e?void 0:e(n))}),AV=(e,t)=>{(0,tC.useEffect)(()=>{let r;if(!t||!e.requestVideoFrameCallback)return;let i=(...n)=>{t(...n),r=e.requestVideoFrameCallback(i)};return e.requestVideoFrameCallback(i),()=>e.cancelVideoFrameCallback(r)},[e,t])};var tI=tI,nX=tI;let Aj=(e,t)=>{if(Array.isArray(e))return e[0];{let r=null!=t?t:Object.keys(e)[0];return e[r][0]}},AJ=e=>{for(let t=3;t<e.length;t+=4)if(0!==e[t])return!1;return!0};function AY(e,t,r,i,n,a){let o=tC.useRef((0,tI.C)(e=>e.viewport)),s=tC.useRef(null),l=tC.useRef(0),c=tC.useRef(e),h=tC.useRef(t),u=tC.useRef(r),[A,d]=(0,tC.useState)(null),[f,m]=tC.useState(new tw.Texture),p=tC.useMemo(()=>new tw.TextureLoader,[]),[g,v]=(0,tC.useState)(null),y=tC.useCallback((e,t,r)=>{let i=t*(o.current.aspect>e/t?o.current.width/e:o.current.height/t),n=e*(o.current.aspect>e/t?o.current.width/e:o.current.height/t)*r,a=i*r,s=Math.min(1,n),l=Math.min(1,a);return n>1&&(s=1,l=a/n*1),new tw.Vector3(s,l,1)},[]),x=tC.useCallback((e,t)=>{if(!e.image)return{rows:0,columns:0,frameWidth:0,frameHeight:0,emptyFrames:[]};{let r=document.createElement("canvas"),i=r.getContext("2d",a);if(!i)throw Error("Failed to get 2d context");r.width=e.image.width,r.height=e.image.height,i.drawImage(e.image,0,0);let n=e.image.width,o=e.image.height,s=Math.round(Math.sqrt(n/o*t)),l=Math.round(t/s),c=n/s,h=o/l,u=[];for(let e=0;e<l;e++)for(let r=0;r<s;r++){if(e*s+r>=t){u.push({row:e,col:r});continue}AJ(i.getImageData(r*c,e*h,c,h).data)&&u.push({row:e,col:r})}return{rows:l,columns:s,frameWidth:c,frameHeight:h,emptyFrames:u}}},[a]),E=tC.useCallback(e=>{let t=e=>{let t=null;for(let r of e){let{w:e,h:i}=r.frame,n=e*i;(!t||n>t.area)&&(t={w:e,h:i,area:n})}return e.map(e=>{let{w:r,h:i}=e.frame,n=r*i,a=t?n===t.area?1:Math.sqrt(n/t.area):1;return{...e,scaleRatio:a}})};if(Array.isArray(e))return t(e);{let r={};for(let i in e)r[i]=t(e[i]);return r}},[]),C=tC.useCallback(()=>{let e={},t=s.current,r=u.current;if(t)if(r&&Array.isArray(t.frames)){for(let i=0;i<r.length;i++)for(let n of(e[r[i]]=[],t.frames)){let t=n.frame,a=n.sourceSize.w,o=n.sourceSize.h;"string"==typeof n.filename&&-1!==n.filename.toLowerCase().indexOf(r[i].toLowerCase())&&e[r[i]].push({...n,frame:t,sourceSize:{w:a,h:o}})}for(let t in e){let r=E(e[t]);Array.isArray(r)&&(e[t]=r)}return e}else if(r&&"object"==typeof t.frames){for(let i=0;i<r.length;i++)for(let n in e[r[i]]=[],t.frames){let a=t.frames[n],o=a.frame,s=a.sourceSize.w,l=a.sourceSize.h;"string"==typeof n&&-1!==n.toLowerCase().indexOf(r[i].toLowerCase())&&e[r[i]].push({...a,frame:o,sourceSize:{w:s,h:l}})}for(let t in e){let r=E(e[t]);Array.isArray(r)&&(e[t]=r)}return e}else{let e=[];return null!=t&&t.frames&&(e=Array.isArray(t.frames)?t.frames.map(e=>({...e,x:e.frame.x,y:e.frame.y,w:e.frame.w,h:e.frame.h})):Object.values(t.frames).flat().map(e=>({...e,x:e.frame.x,y:e.frame.y,w:e.frame.w,h:e.frame.h}))),E(e)}return[]},[E,s]),B=tC.useCallback((e,t)=>{let r=new tw.Vector3(1,1,1);if(null===e){if(t&&i){let e=t.image.width,n=t.image.height;l.current=i;let{rows:a,columns:o,frameWidth:c,frameHeight:h,emptyFrames:u}=x(t,i),A={frames:[],meta:{version:"1.0",size:{w:e,h:n},rows:a,columns:o,frameWidth:c,frameHeight:h,scale:"1"}};for(let e=0;e<a;e++)for(let t=0;t<o;t++)!(null!=u?u:[]).some(r=>r.row===e&&r.col===t)&&Array.isArray(A.frames)&&A.frames.push({frame:{x:t*c,y:e*h,w:c,h:h},scaleRatio:1,rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:c,h:h},sourceSize:{w:c,h:h}});r=y(c,h,.1),s.current=A}s.current&&s.current.frames&&(s.current.frames=E(s.current.frames))}else if(t){s.current=e,s.current.frames=C(),l.current=Array.isArray(e.frames)?e.frames.length:Object.keys(e.frames).length;let{w:t,h:i}=Aj(e.frames).sourceSize;r=y(t,i,.1)}d(s.current),"encoding"in t?t.encoding=3001:"colorSpace"in t&&(t.colorSpace=tw.SRGBColorSpace),m(t),v({spriteTexture:t,spriteData:s.current,aspect:r})},[x,i,C,y,E]),w=tC.useCallback((e,t,r)=>{Promise.all([fetch(e).then(e=>e.json()),new Promise(e=>{p.load(t,e)})]).then(e=>{r(e[0],e[1])})},[p]),I=tC.useCallback(e=>{if(!e&&!c.current)throw Error("Either textureUrl or input must be provided");let t=null!=e?e:c.current;if(!t)throw Error("A valid texture URL must be provided");p.load(t,e=>B(null,e))},[p,B]),b=tC.useCallback((e,t)=>{t&&e?w(t,e,B):I(e)},[w,I,B]);return tC.useLayoutEffect(()=>{h.current&&c.current?w(h.current,c.current,B):c.current&&I();let e=c.current;return()=>{e&&nX.G.clear(tw.TextureLoader,e)}},[w,I,B]),tC.useLayoutEffect(()=>{null==n||n(f,null!=A?A:null)},[f,A,n]),{spriteObj:g,loadJsonAndTexture:b}}AY.preload=e=>nX.G.preload(tw.TextureLoader,e),AY.clear=e=>nX.G.clear(tw.TextureLoader,e);var tI=tI;function AW(e,t,...r){let i=tC.useRef(null),n=(0,tI.C)(e=>e.scene);return tC.useLayoutEffect(()=>{let a;if(e&&null!=e&&e.current&&t&&(i.current=a=new t(e.current,...r)),a)return a.traverse(e=>e.raycast=()=>null),n.add(a),()=>{i.current=void 0,n.remove(a),null==a.dispose||a.dispose()}},[n,t,e,...r]),(0,tb.useFrame)(()=>{var e;null==(e=i.current)||null==e.update||e.update()}),i}let AK=({type:e,args:t=[]})=>{let r=tC.useRef(null),i=tC.useRef(null);return tC.useLayoutEffect(()=>{i.current=r.current.parent}),AW(i,e,...t),tC.createElement("object3D",{ref:r})};var AX=tI,Aq=tI,AZ=e.i(81405);function A$(e,t){"function"==typeof e?e(t):null!=e&&(e.current=t)}function A1({showPanel:e=0,className:t,parent:r}){let i=function(e,t=[],r){let[i,n]=tC.useState();return tC.useLayoutEffect(()=>{let t=e();return n(t),A$(void 0,t),()=>A$(void 0,null)},t),i}(()=>new AZ.default,[]);return tC.useEffect(()=>{if(i){let n=r&&r.current||document.body;i.showPanel(e),null==n||n.appendChild(i.dom);let a=(null!=t?t:"").split(" ").filter(e=>e);a.length&&i.dom.classList.add(...a);let o=(0,AX.j)(()=>i.begin()),s=(0,Aq.k)(()=>i.end());return()=>{a.length&&i.dom.classList.remove(...a),null==n||n.removeChild(i.dom),o(),s()}}},[r,i,t,e]),null}var tI=tI,Aq=tI;let A0=class e{constructor({trackGPU:t=!1,logsPerSecond:r=30,samplesLog:i=60,samplesGraph:n=10,precision:a=2,minimal:o=!1,horizontal:s=!0,mode:l=0}={}){this.gl=null,this.ext=null,this.activeQuery=null,this.gpuQueries=[],this.threeRendererPatched=!1,this.frames=0,this.renderCount=0,this.isRunningCPUProfiling=!1,this.totalCpuDuration=0,this.totalGpuDuration=0,this.totalGpuDurationCompute=0,this.totalFps=0,this.gpuPanel=null,this.gpuPanelCompute=null,this.averageFps={logs:[],graph:[]},this.averageCpu={logs:[],graph:[]},this.averageGpu={logs:[],graph:[]},this.averageGpuCompute={logs:[],graph:[]},this.handleClick=e=>{e.preventDefault(),this.showPanel(++this.mode%this.dom.children.length)},this.handleResize=()=>{this.resizePanel(this.fpsPanel,0),this.resizePanel(this.msPanel,1),this.gpuPanel&&this.resizePanel(this.gpuPanel,2),this.gpuPanelCompute&&this.resizePanel(this.gpuPanelCompute,3)},this.mode=l,this.horizontal=s,this.minimal=o,this.trackGPU=t,this.samplesLog=i,this.samplesGraph=n,this.precision=a,this.logsPerSecond=r,this.dom=document.createElement("div"),this.initializeDOM(),this.beginTime=performance.now(),this.prevTime=this.beginTime,this.prevCpuTime=this.beginTime,this.fpsPanel=this.addPanel(new e.Panel("FPS","#0ff","#002"),0),this.msPanel=this.addPanel(new e.Panel("CPU","#0f0","#020"),1),this.setupEventListeners()}initializeDOM(){this.dom.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      opacity: 0.9;
      z-index: 10000;
      ${this.minimal?"cursor: pointer;":""}
    `}setupEventListeners(){this.minimal?(this.dom.addEventListener("click",this.handleClick),this.showPanel(this.mode)):window.addEventListener("resize",this.handleResize)}async init(e){if(!e)return void console.error('Stats: The "canvas" parameter is undefined.');if(!this.handleThreeRenderer(e)&&!await this.handleWebGPURenderer(e)&&!this.initializeWebGL(e))return}handleThreeRenderer(e){return!!e.isWebGLRenderer&&!this.threeRendererPatched&&(this.patchThreeRenderer(e),this.gl=e.getContext(),this.trackGPU&&this.initializeGPUTracking(),!0)}async handleWebGPURenderer(e){return!!e.isWebGPURenderer&&(this.trackGPU&&(e.backend.trackTimestamp=!0,await e.hasFeatureAsync("timestamp-query")&&this.initializeWebGPUPanels()),this.info=e.info,!0)}initializeWebGPUPanels(){this.gpuPanel=this.addPanel(new e.Panel("GPU","#ff0","#220"),2),this.gpuPanelCompute=this.addPanel(new e.Panel("CPT","#e1e1e1","#212121"),3)}initializeWebGL(e){if(e instanceof WebGL2RenderingContext)this.gl=e;else if(!(e instanceof HTMLCanvasElement||e instanceof OffscreenCanvas))return console.error("Stats: Invalid input type. Expected WebGL2RenderingContext, HTMLCanvasElement, or OffscreenCanvas."),!1;else if(this.gl=e.getContext("webgl2"),!this.gl)return console.error("Stats: Unable to obtain WebGL2 context."),!1;return!0}initializeGPUTracking(){this.gl&&(this.ext=this.gl.getExtension("EXT_disjoint_timer_query_webgl2"),this.ext&&(this.gpuPanel=this.addPanel(new e.Panel("GPU","#ff0","#220"),2)))}begin(){this.isRunningCPUProfiling||this.beginProfiling("cpu-started"),this.gl&&this.ext&&(this.activeQuery&&this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.activeQuery=this.gl.createQuery(),this.activeQuery&&this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,this.activeQuery))}end(){this.renderCount++,this.gl&&this.ext&&this.activeQuery&&(this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.gpuQueries.push({query:this.activeQuery}),this.activeQuery=null)}update(){this.info?this.processWebGPUTimestamps():this.processGpuQueries(),this.endProfiling("cpu-started","cpu-finished","cpu-duration"),this.updateAverages(),this.resetCounters()}processWebGPUTimestamps(){this.totalGpuDuration=this.info.render.timestamp,this.totalGpuDurationCompute=this.info.compute.timestamp,this.addToAverage(this.totalGpuDurationCompute,this.averageGpuCompute)}updateAverages(){this.addToAverage(this.totalCpuDuration,this.averageCpu),this.addToAverage(this.totalGpuDuration,this.averageGpu)}resetCounters(){this.renderCount=0,0===this.totalCpuDuration&&this.beginProfiling("cpu-started"),this.totalCpuDuration=0,this.totalFps=0,this.beginTime=this.endInternal()}resizePanel(e,t){e.canvas.style.position="absolute",this.minimal?e.canvas.style.display="none":(e.canvas.style.display="block",this.horizontal?(e.canvas.style.top="0px",e.canvas.style.left=t*e.WIDTH/e.PR+"px"):(e.canvas.style.left="0px",e.canvas.style.top=t*e.HEIGHT/e.PR+"px"))}addPanel(e,t){return e.canvas&&(this.dom.appendChild(e.canvas),this.resizePanel(e,t)),e}showPanel(e){for(let t=0;t<this.dom.children.length;t++)this.dom.children[t].style.display=t===e?"block":"none";this.mode=e}processGpuQueries(){this.gl&&this.ext&&(this.totalGpuDuration=0,this.gpuQueries.forEach((e,t)=>{if(this.gl){let r=this.gl.getQueryParameter(e.query,this.gl.QUERY_RESULT_AVAILABLE),i=this.gl.getParameter(this.ext.GPU_DISJOINT_EXT);if(r&&!i){let r=this.gl.getQueryParameter(e.query,this.gl.QUERY_RESULT);this.totalGpuDuration+=1e-6*r,this.gl.deleteQuery(e.query),this.gpuQueries.splice(t,1)}}}))}endInternal(){this.frames++;let e=(performance||Date).now(),t=e-this.prevTime;if(e>=this.prevCpuTime+1e3/this.logsPerSecond){let r=Math.round(1e3*this.frames/t);this.addToAverage(r,this.averageFps),this.updatePanel(this.fpsPanel,this.averageFps,0),this.updatePanel(this.msPanel,this.averageCpu,this.precision),this.updatePanel(this.gpuPanel,this.averageGpu,this.precision),this.gpuPanelCompute&&this.updatePanel(this.gpuPanelCompute,this.averageGpuCompute),this.frames=0,this.prevCpuTime=e,this.prevTime=e}return e}addToAverage(e,t){t.logs.push(e),t.logs.length>this.samplesLog&&t.logs.shift(),t.graph.push(e),t.graph.length>this.samplesGraph&&t.graph.shift()}beginProfiling(e){window.performance&&(window.performance.mark(e),this.isRunningCPUProfiling=!0)}endProfiling(e,t,r){if(window.performance&&t&&this.isRunningCPUProfiling){window.performance.mark(t);let i=performance.measure(r,e,t);this.totalCpuDuration+=i.duration,this.isRunningCPUProfiling=!1}}updatePanel(e,t,r=2){if(t.logs.length>0){let i=0,n=.01;for(let e=0;e<t.logs.length;e++)i+=t.logs[e],t.logs[e]>n&&(n=t.logs[e]);let a=0,o=.01;for(let e=0;e<t.graph.length;e++)a+=t.graph[e],t.graph[e]>o&&(o=t.graph[e]);e&&e.update(i/Math.min(t.logs.length,this.samplesLog),a/Math.min(t.graph.length,this.samplesGraph),n,o,r)}}get domElement(){return this.dom}patchThreeRenderer(e){let t=e.render,r=this;e.render=function(e,i){r.begin(),t.call(this,e,i),r.end()},this.threeRendererPatched=!0}};A0.Panel=class{constructor(e,t,r){this.name=e,this.fg=t,this.bg=r,this.gradient=null,this.PR=Math.round(window.devicePixelRatio||1),this.WIDTH=90*this.PR,this.HEIGHT=48*this.PR,this.TEXT_X=3*this.PR,this.TEXT_Y=2*this.PR,this.GRAPH_X=3*this.PR,this.GRAPH_Y=15*this.PR,this.GRAPH_WIDTH=84*this.PR,this.GRAPH_HEIGHT=30*this.PR,this.canvas=document.createElement("canvas"),this.canvas.width=this.WIDTH,this.canvas.height=this.HEIGHT,this.canvas.style.width="90px",this.canvas.style.height="48px",this.canvas.style.position="absolute",this.canvas.style.cssText="width:90px;height:48px",this.context=this.canvas.getContext("2d"),this.initializeCanvas()}createGradient(){let e;if(!this.context)throw Error("No context");let t=this.context.createLinearGradient(0,this.GRAPH_Y,0,this.GRAPH_Y+this.GRAPH_HEIGHT),r=this.fg;switch(this.fg.toLowerCase()){case"#0ff":e="#006666";break;case"#0f0":e="#006600";break;case"#ff0":e="#666600";break;case"#e1e1e1":e="#666666";break;default:e=this.bg}return t.addColorStop(0,e),t.addColorStop(1,r),t}initializeCanvas(){this.context&&(this.context.font="bold "+9*this.PR+"px Helvetica,Arial,sans-serif",this.context.textBaseline="top",this.gradient=this.createGradient(),this.context.fillStyle=this.bg,this.context.fillRect(0,0,this.WIDTH,this.HEIGHT),this.context.fillStyle=this.fg,this.context.fillText(this.name,this.TEXT_X,this.TEXT_Y),this.context.fillStyle=this.fg,this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT),this.context.fillStyle=this.bg,this.context.globalAlpha=.9,this.context.fillRect(this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH,this.GRAPH_HEIGHT))}update(e,t,r,i,n=0){if(!this.context||!this.gradient)return;let a=Math.min(1/0,e),o=Math.max(r,e);i=Math.max(i,t),this.context.globalAlpha=1,this.context.fillStyle=this.bg,this.context.fillRect(0,0,this.WIDTH,this.GRAPH_Y),this.context.fillStyle=this.fg,this.context.fillText(`${e.toFixed(n)} ${this.name} (${a.toFixed(n)}-${parseFloat(o.toFixed(n))})`,this.TEXT_X,this.TEXT_Y),this.context.drawImage(this.canvas,this.GRAPH_X+this.PR,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT,this.GRAPH_X,this.GRAPH_Y,this.GRAPH_WIDTH-this.PR,this.GRAPH_HEIGHT);let s=this.GRAPH_HEIGHT-(1-t/i)*this.GRAPH_HEIGHT;s>0&&(this.context.globalAlpha=1,this.context.fillStyle=this.gradient,this.context.fillRect(this.GRAPH_X+this.GRAPH_WIDTH-this.PR,this.GRAPH_Y+this.GRAPH_HEIGHT-s,this.PR,s))}};let A2=tC.forwardRef(function({className:e,parent:t,id:r,clearStatsGlStyle:i,...n},a){let o=(0,tI.C)(e=>e.gl),s=tC.useMemo(()=>{let e=new A0({...n});return e.init(o),e},[o]);return tC.useImperativeHandle(a,()=>s.domElement,[s]),tC.useEffect(()=>{if(s){let n=t&&t.current||document.body;null==n||n.appendChild(s.domElement),s.domElement.querySelectorAll("canvas").forEach(e=>{e.style.removeProperty("position")}),r&&(s.domElement.id=r),i&&s.domElement.removeAttribute("style"),s.domElement.removeAttribute("style");let a=(null!=e?e:"").split(" ").filter(e=>e);a.length&&s.domElement.classList.add(...a);let o=(0,Aq.k)(()=>s.update());return()=>{a.length&&s.domElement.classList.remove(...a),null==n||n.removeChild(s.domElement),o()}}},[t,s,e,r,i]),null});var tI=tI;function A3({size:e=256,frames:t=1/0}={}){let r=(0,tI.C)(e=>e.viewport.dpr),{width:i,height:n}=(0,tI.C)(e=>e.size),a=e||i*r,o=e||n*r,s=tC.useMemo(()=>{let e=new tw.DepthTexture(a,o);return e.format=tw.DepthFormat,e.type=tw.UnsignedShortType,{depthTexture:e}},[a,o]),l=0,c=lQ(a,o,s);return(0,tb.useFrame)(e=>{(t===1/0||l<t)&&(e.gl.setRenderTarget(c),e.gl.render(e.scene,e.camera),e.gl.setRenderTarget(null),l++)}),c.depthTexture}var tI=tI;function A4(e,t,r=1){let i=(0,tI.C)(e=>e.viewport),n=t*(i.aspect>e/t?i.width/e:i.height/t);return[e*(i.aspect>e/t?i.width/e:i.height/t)*r,n*r,1]}var tI=tI,o0=tI;function A5(e,t){let r=(0,tI.C)(e=>e.pointer),[i]=tC.useState(()=>{let i=new tw.Raycaster;return t&&(0,o0.s)(i,t),function(t,n){i.setFromCamera(r,e instanceof tw.Camera?e:e.current);let a=this.constructor.prototype.raycast.bind(this);a&&a(i,n)}});return i}function A6(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{l(i.next(e))}catch(e){a(e)}}function s(e){try{l(i.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,s)}l((i=i.apply(e,t||[])).next())})}"function"==typeof SuppressedError&&SuppressedError;let A8=["geforce 320m","geforce 8600","geforce 8600m gt","geforce 8800 gs","geforce 8800 gt","geforce 9400","geforce 9400m g","geforce 9400m","geforce 9600m gt","geforce 9600m","geforce fx go5200","geforce gt 120","geforce gt 130","geforce gt 330m","geforce gtx 285","google swiftshader","intel g41","intel g45","intel gma 4500mhd","intel gma x3100","intel hd 3000","intel q45","legacy","mali-2","mali-3","mali-4","quadro fx 1500","quadro fx 4","quadro fx 5","radeon hd 2400","radeon hd 2600","radeon hd 4670","radeon hd 4850","radeon hd 4870","radeon hd 5670","radeon hd 5750","radeon hd 6290","radeon hd 6300","radeon hd 6310","radeon hd 6320","radeon hd 6490m","radeon hd 6630m","radeon hd 6750m","radeon hd 6770m","radeon hd 6970m","sgx 543","sgx543"];function A9(e){return e.toLowerCase().replace(/.*angle ?\((.+)\)(?: on vulkan [0-9.]+)?$/i,"$1").replace(/\s(\d{1,2}gb|direct3d.+$)|\(r\)| \([^)]+\)$/g,"").replace(/(?:vulkan|opengl) \d+\.\d+(?:\.\d+)?(?: \((.*)\))?/,"$1")}let A7="undefined"==typeof window,de=(()=>{if(A7)return;let{userAgent:e,platform:t,maxTouchPoints:r}=window.navigator,i=/(iphone|ipod|ipad)/i.test(e),n="iPad"===t||"MacIntel"===t&&r>0&&!window.MSStream;return{isIpad:n,isMobile:/android/i.test(e)||i||n,isSafari12:/Version\/12.+Safari/.test(e),isFirefox:/Firefox/.test(e)}})();class dt extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}let dr=[],di=[];function dn(e){return null!=e}let da=e=>(0,or.suspend)(()=>(({mobileTiers:e=[0,15,30,60],desktopTiers:t=[0,15,30,60],override:r={},glContext:i,failIfMajorPerformanceCaveat:n=!1,benchmarksURL:a="https://unpkg.com/detect-gpu@5.0.70/dist/benchmarks"}={})=>A6(void 0,void 0,void 0,function*(){let o={};if(A7)return{tier:0,type:"SSR"};let{isIpad:s=!!(null==de?void 0:de.isIpad),isMobile:l=!!(null==de?void 0:de.isMobile),screenSize:c=window.screen,loadBenchmarks:h=e=>A6(void 0,void 0,void 0,function*(){let t=yield fetch(`${a}/${e}`).then(e=>e.json());if(4>parseInt(t.shift().split(".")[0],10))throw new dt("Detect GPU benchmark data is out of date. Please update to version 4x");return t})}=r,{renderer:u}=r,A=(e,t,r,i,n)=>({device:n,fps:i,gpu:r,isMobile:l,tier:e,type:t}),d,f="";if(u)d=[u=A9(u)];else{var m;let e=i||function(e,t=!1){let r={alpha:!1,antialias:!1,depth:!1,failIfMajorPerformanceCaveat:t,powerPreference:"high-performance",stencil:!1};e&&delete r.powerPreference;let i=window.document.createElement("canvas"),n=i.getContext("webgl",r)||i.getContext("experimental-webgl",r);return null!=n?n:void 0}(null==de?void 0:de.isSafari12,n);if(!e)return A(0,"WEBGL_UNSUPPORTED");let t=(null==de?void 0:de.isFirefox)?null:e.getExtension("WEBGL_debug_renderer_info");if(!(u=t?e.getParameter(t.UNMASKED_RENDERER_WEBGL):e.getParameter(e.RENDERER)))return A(1,"FALLBACK");f=u,u=A9(u),d="apple gpu"===(m=u)?function(e,t,r){let i;if(!r)return[t];let n=function(e){let t=e.createShader(35633),r=e.createShader(35632),i=e.createProgram();if(!(r&&t&&i))return;e.shaderSource(t,"\n    precision highp float;\n    attribute vec3 aPosition;\n    varying float vvv;\n    void main() {\n      vvv = 0.31622776601683794;\n      gl_Position = vec4(aPosition, 1.0);\n    }\n  "),e.shaderSource(r,"\n    precision highp float;\n    varying float vvv;\n    void main() {\n      vec4 enc = vec4(1.0, 255.0, 65025.0, 16581375.0) * vvv;\n      enc = fract(enc);\n      enc -= enc.yzww * vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0, 0.0);\n      gl_FragColor = enc;\n    }\n  "),e.compileShader(t),e.compileShader(r),e.attachShader(i,t),e.attachShader(i,r),e.linkProgram(i),e.detachShader(i,t),e.detachShader(i,r),e.deleteShader(t),e.deleteShader(r),e.useProgram(i);let n=e.createBuffer();e.bindBuffer(34962,n),e.bufferData(34962,new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),35044);let a=e.getAttribLocation(i,"aPosition");e.vertexAttribPointer(a,3,5126,!1,0,0),e.enableVertexAttribArray(a),e.clearColor(1,1,1,1),e.clear(16384),e.viewport(0,0,1,1),e.drawArrays(4,0,3);let o=new Uint8Array(4);return e.readPixels(0,0,1,1,6408,5121,o),e.deleteProgram(i),e.deleteBuffer(n),o.join("")}(e),a="801621810",o="8016218135",s="80162181161",l=(null==de?void 0:de.isIpad)?[["a7",s,12],["a8",o,15],["a8x",o,15],["a9",o,15],["a9x",o,15],["a10",o,15],["a10x",o,15],["a12",a,15],["a12x",a,15],["a12z",a,15],["a14",a,15],["a15",a,15],["m1",a,15],["m2",a,15]]:[["a7",s,12],["a8",o,12],["a9",o,15],["a10",o,15],["a11",a,15],["a12",a,15],["a13",a,15],["a14",a,15],["a15",a,15],["a16",a,15],["a17",a,15]];return"80162181255"===n?i=l.filter(([,,e])=>e>=14):(i=l.filter(([,e])=>e===n)).length||(i=l),i.map(([e])=>`apple ${e} gpu`)}(e,m,l):[m]}let p=(yield Promise.all(d.map(function(e){var t;return A6(this,void 0,void 0,function*(){var r,i;let n,a,u=(e=>{for(let t of l?["adreno","apple","mali-t","mali","nvidia","powervr","samsung"]:["intel","apple","amd","radeon","nvidia","geforce","adreno"])if(e.includes(t))return t})(e);if(!u)return;let A=`${l?"m":"d"}-${u}${s?"-ipad":""}.json`,d=o[A]=null!=(t=o[A])?t:h(A);try{n=yield d}catch(e){if(e instanceof dt)throw e;return}let f=null!=(i=null==(a=(r=(r=e).replace(/\([^)]+\)/,"")).match(/\d+/)||r.match(/(\W|^)([A-Za-z]{1,3})(\W|$)/g))?void 0:a.join("").replace(/\W|amd/g,""))?i:"",m=n.filter(([,e])=>e===f);m.length||(m=n.filter(([t])=>t.includes(e)));let p=m.length;if(0===p)return;let g=e.split(/[.,()\[\]/\s]/g).sort().filter((e,t,r)=>0===t||e!==r[t-1]).join(" "),v,[y,,,,x]=p>1?m.map(e=>[e,function(e,t){if(e===t)return 0;let r=e;e.length>t.length&&(e=t,t=r);let i=e.length,n=t.length;for(;i>0&&e.charCodeAt(~-i)===t.charCodeAt(~-n);)i--,n--;let a,o=0;for(;o<i&&e.charCodeAt(o)===t.charCodeAt(o);)o++;if(i-=o,n-=o,0===i)return n;let s,l,c=0,h=0,u=0;for(;h<i;)di[h]=e.charCodeAt(o+h),dr[h]=++h;for(;u<n;)for(a=t.charCodeAt(o+u),s=u++,c=u,h=0;h<i;h++)l=a===di[h]?s:s+1,s=dr[h],c=dr[h]=s>c?l>c?c+1:l:l>s?s+1:l;return c}(g,e[2])]).sort(([,e],[,t])=>e-t)[0][0]:m[0],E=Number.MAX_VALUE,{devicePixelRatio:C}=window,B=c.width*C*c.height*C;for(let e of x){let[t,r]=e,i=Math.abs(B-t*r);i<E&&(E=i,v=e)}if(!v)return;let[,,w,I]=v;return[E,w,y,I]})}))).filter(dn).sort(([e=Number.MAX_VALUE,t],[r=Number.MAX_VALUE,i])=>e===r?t-i:e-r);if(!p.length){let e=A8.find(e=>u.includes(e));return e?A(0,"BLOCKLISTED",e):A(1,"FALLBACK",`${u} (${f})`)}let[,g,v,y]=p[0];if(-1===g)return A(0,"BLOCKLISTED",v,g,y);let x=l?e:t,E=0;for(let e=0;e<x.length;e++)g>=x[e]&&(E=e);return A(E,"BENCHMARK",v,g,y)}))(e),["useDetectGPU"]);function ds({children:e,...t}){let r=da(t);return tC.createElement(tC.Fragment,null,null==e?void 0:e(r))}var tI=tI;let dl=2,dc=Symbol("SKIP_GENERATION");function dh(e,t,r){return null===e?null:(e.point.applyMatrix4(t.matrixWorld),e.distance=e.point.distanceTo(r.ray.origin),e.object=t,e)}function du(e){return e.index?e.index.count:e.attributes.position.count}function dA(e){return du(e)/3}function dd(e,t=ArrayBuffer){return e>65535?new Uint32Array(new t(4*e)):new Uint16Array(new t(2*e))}function df(e,t){let r=dA(e),i=t||e.drawRange,n=i.start/3,a=(i.start+i.count)/3,o=Math.max(0,n),s=Math.min(r,a)-o;return[{offset:Math.floor(o),count:Math.floor(s)}]}function dm(e,t){if(!e.groups||!e.groups.length)return df(e,t);let r=[],i=new Set,n=t||e.drawRange,a=n.start/3,o=(n.start+n.count)/3;for(let t of e.groups){let e=t.start/3,r=(t.start+t.count)/3;i.add(Math.max(a,e)),i.add(Math.min(o,r))}let s=Array.from(i.values()).sort((e,t)=>e-t);for(let e=0;e<s.length-1;e++){let t=s[e],i=s[e+1];r.push({offset:Math.floor(t),count:Math.floor(i-t)})}return r}function dp(e,t,r,i,n){let a=1/0,o=1/0,s=1/0,l=-1/0,c=-1/0,h=-1/0,u=1/0,A=1/0,d=1/0,f=-1/0,m=-1/0,p=-1/0;for(let i=6*t,n=(t+r)*6;i<n;i+=6){let t=e[i+0],r=e[i+1],n=t-r,g=t+r;n<a&&(a=n),g>l&&(l=g),t<u&&(u=t),t>f&&(f=t);let v=e[i+2],y=e[i+3],x=v-y,E=v+y;x<o&&(o=x),E>c&&(c=E),v<A&&(A=v),v>m&&(m=v);let C=e[i+4],B=e[i+5],w=C-B,I=C+B;w<s&&(s=w),I>h&&(h=I),C<d&&(d=C),C>p&&(p=C)}i[0]=a,i[1]=o,i[2]=s,i[3]=l,i[4]=c,i[5]=h,n[0]=u,n[1]=A,n[2]=d,n[3]=f,n[4]=m,n[5]=p}function dg(e,t,r){return r.min.x=t[e],r.min.y=t[e+1],r.min.z=t[e+2],r.max.x=t[e+3],r.max.y=t[e+4],r.max.z=t[e+5],r}function dv(e){let t=-1,r=-1/0;for(let i=0;i<3;i++){let n=e[i+3]-e[i];n>r&&(r=n,t=i)}return t}function dy(e,t,r){let i,n;for(let a=0;a<3;a++){let o=a+3;i=e[a],n=t[a],r[a]=i<n?i:n,i=e[o],n=t[o],r[o]=i>n?i:n}}function dx(e,t,r){for(let i=0;i<3;i++){let n=t[e+2*i],a=t[e+2*i+1],o=n-a,s=n+a;o<r[i]&&(r[i]=o),s>r[i+3]&&(r[i+3]=s)}}function dE(e){let t=e[3]-e[0],r=e[4]-e[1],i=e[5]-e[2];return 2*(t*r+r*i+i*t)}let dC=(e,t)=>e.candidate-t.candidate,dB=Array(32).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),dw=new Float32Array(6);class dI{constructor(){this.boundingData=new Float32Array(6)}}function db(e,t,r,i,n,a){let o=i,s=i+n-1,l=a.pos,c=2*a.axis;for(;;){for(;o<=s&&r[6*o+c]<l;)o++;for(;o<=s&&r[6*s+c]>=l;)s--;if(!(o<s))return o;for(let e=0;e<3;e++){let r=t[3*o+e];t[3*o+e]=t[3*s+e],t[3*s+e]=r}for(let e=0;e<6;e++){let t=r[6*o+e];r[6*o+e]=r[6*s+e],r[6*s+e]=t}o++,s--}}function d_(e,t,r,i,n,a){let o=i,s=i+n-1,l=a.pos,c=2*a.axis;for(;;){for(;o<=s&&r[6*o+c]<l;)o++;for(;o<=s&&r[6*s+c]>=l;)s--;if(!(o<s))return o;{let t=e[o];e[o]=e[s],e[s]=t;for(let e=0;e<6;e++){let t=r[6*o+e];r[6*o+e]=r[6*s+e],r[6*s+e]=t}o++,s--}}}function dM(e,t){return 65535===t[e+15]}function dS(e,t){return t[e+14]}class dT{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let r=1/0,i=-1/0;for(let n=0,a=e.length;n<a;n++){let a=e[n][t];r=a<r?a:r,i=a>i?a:i}this.min=r,this.max=i}setFromPoints(e,t){let r=1/0,i=-1/0;for(let n=0,a=t.length;n<a;n++){let a=t[n],o=e.dot(a);r=o<r?o:r,i=o>i?o:i}this.min=r,this.max=i}isSeparated(e){return this.min>e.max||e.min>this.max}}dT.prototype.setFromBox=(X=new tw.Vector3,function(e,t){let r=t.min,i=t.max,n=1/0,a=-1/0;for(let t=0;t<=1;t++)for(let o=0;o<=1;o++)for(let s=0;s<=1;s++){X.x=r.x*t+i.x*(1-t),X.y=r.y*o+i.y*(1-o),X.z=r.z*s+i.z*(1-s);let l=e.dot(X);n=Math.min(l,n),a=Math.max(l,a)}this.min=n,this.max=a}),new dT;var dD=tw;let dF=(q=new tw.Vector3,Z=new tw.Vector3,$=new tw.Vector3,function(e,t,r){let i,n,a=e.start,o=t.start;$.subVectors(a,o),q.subVectors(e.end,e.start),Z.subVectors(t.end,t.start);let s=$.dot(Z),l=Z.dot(q),c=Z.dot(Z),h=$.dot(q),u=q.dot(q)*c-l*l;i=0!==u?(s*l-h*c)/u:0,n=(s+i*l)/c,r.x=i,r.y=n}),dR=(ee=new tw.Vector2,et=new tw.Vector3,er=new tw.Vector3,function(e,t,r,i){dF(e,t,ee);let n=ee.x,a=ee.y;if(n>=0&&n<=1&&a>=0&&a<=1){e.at(n,r),t.at(a,i);return}if(n>=0&&n<=1){a<0?t.at(0,i):t.at(1,i),e.closestPointToPoint(i,!0,r);return}if(a>=0&&a<=1){n<0?e.at(0,r):e.at(1,r),t.closestPointToPoint(r,!0,i);return}{let o,s;if(o=n<0?e.start:e.end,s=a<0?t.start:t.end,e.closestPointToPoint(s,!0,et),t.closestPointToPoint(o,!0,er),et.distanceToSquared(s)<=er.distanceToSquared(o)){r.copy(et),i.copy(s);return}r.copy(o),i.copy(er);return}}),dP=(ei=new tw.Vector3,en=new tw.Vector3,ea=new tw.Plane,eo=new tw.Line3,function(e,t){let{radius:r,center:i}=e,{a:n,b:a,c:o}=t;if(eo.start=n,eo.end=a,eo.closestPointToPoint(i,!0,ei).distanceTo(i)<=r||(eo.start=n,eo.end=o,eo.closestPointToPoint(i,!0,ei).distanceTo(i)<=r)||(eo.start=a,eo.end=o,eo.closestPointToPoint(i,!0,ei).distanceTo(i)<=r))return!0;let s=t.getPlane(ea);if(Math.abs(s.distanceToPoint(i))<=r){let e=s.projectPoint(i,en);if(t.containsPoint(e))return!0}return!1});function dQ(e){return 1e-15>Math.abs(e)}class dU extends dD.Triangle{constructor(...e){super(...e),this.isExtendedTriangle=!0,this.satAxes=[,,,,].fill().map(()=>new dD.Vector3),this.satBounds=[,,,,].fill().map(()=>new dT),this.points=[this.a,this.b,this.c],this.sphere=new dD.Sphere,this.plane=new dD.Plane,this.needsUpdate=!0}intersectsSphere(e){return dP(e,this)}update(){let e=this.a,t=this.b,r=this.c,i=this.points,n=this.satAxes,a=this.satBounds,o=n[0],s=a[0];this.getNormal(o),s.setFromPoints(o,i);let l=n[1],c=a[1];l.subVectors(e,t),c.setFromPoints(l,i);let h=n[2],u=a[2];h.subVectors(t,r),u.setFromPoints(h,i);let A=n[3],d=a[3];A.subVectors(r,e),d.setFromPoints(A,i),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(o,e),this.needsUpdate=!1}}dU.prototype.closestPointToSegment=(es=new dD.Vector3,el=new dD.Vector3,ec=new dD.Line3,function(e,t=null,r=null){let i,{start:n,end:a}=e,o=this.points,s=1/0;for(let n=0;n<3;n++){let a=(n+1)%3;ec.start.copy(o[n]),ec.end.copy(o[a]),dR(ec,e,es,el),(i=es.distanceToSquared(el))<s&&(s=i,t&&t.copy(es),r&&r.copy(el))}return this.closestPointToPoint(n,es),(i=n.distanceToSquared(es))<s&&(s=i,t&&t.copy(es),r&&r.copy(n)),this.closestPointToPoint(a,es),(i=a.distanceToSquared(es))<s&&(s=i,t&&t.copy(es),r&&r.copy(a)),Math.sqrt(s)}),dU.prototype.intersectsTriangle=function(){let e=new dU,t=[,,,],r=[,,,],i=new dT,n=new dT,a=new dD.Vector3,o=new dD.Vector3,s=new dD.Vector3,l=new dD.Vector3,c=new dD.Vector3,h=new dD.Line3,u=new dD.Line3,A=new dD.Line3,d=new dD.Vector3;function f(e,t,r){let i=e.points,n=0,a=-1;for(let e=0;e<3;e++){let{start:s,end:l}=h;s.copy(i[e]),l.copy(i[(e+1)%3]),h.delta(o);let c=dQ(t.distanceToPoint(s));if(dQ(t.normal.dot(o))&&c){r.copy(h),n=2;break}let u=t.intersectLine(h,d);if(!u&&c&&d.copy(s),(u||c)&&!dQ(d.distanceTo(l))){if(n<=1)(1===n?r.start:r.end).copy(d),c&&(a=n);else if(n>=2){(1===a?r.start:r.end).copy(d),n=2;break}if(2==++n&&-1===a)break}}return n}return function(o,h=null,d=!1){this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(e.copy(o),e.update(),o=e);let m=this.plane,p=o.plane;if(Math.abs(m.normal.dot(p.normal))>1-1e-10){let e=this.satBounds,s=this.satAxes;r[0]=o.a,r[1]=o.b,r[2]=o.c;for(let t=0;t<4;t++){let n=e[t],a=s[t];if(i.setFromPoints(a,r),n.isSeparated(i))return!1}let l=o.satBounds,c=o.satAxes;t[0]=this.a,t[1]=this.b,t[2]=this.c;for(let e=0;e<4;e++){let r=l[e],n=c[e];if(i.setFromPoints(n,t),r.isSeparated(i))return!1}for(let e=0;e<4;e++){let o=s[e];for(let e=0;e<4;e++){let s=c[e];if(a.crossVectors(o,s),i.setFromPoints(a,t),n.setFromPoints(a,r),i.isSeparated(n))return!1}}return h&&(d||console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),h.start.set(0,0,0),h.end.set(0,0,0)),!0}{let e=f(this,p,u);if(1===e&&o.containsPoint(u.end))return h&&(h.start.copy(u.end),h.end.copy(u.end)),!0;if(2!==e)return!1;let t=f(o,m,A);if(1===t&&this.containsPoint(A.end))return h&&(h.start.copy(A.end),h.end.copy(A.end)),!0;if(2!==t)return!1;if(u.delta(s),A.delta(l),0>s.dot(l)){let e=A.start;A.start=A.end,A.end=e}let r=u.start.dot(s),i=u.end.dot(s),n=A.start.dot(s),a=A.end.dot(s);return(r===a||n===i||i<n!=r<a)&&(h&&(c.subVectors(u.start,A.start),c.dot(s)>0?h.start.copy(u.start):h.start.copy(A.start),c.subVectors(u.end,A.end),0>c.dot(s)?h.end.copy(u.end):h.end.copy(A.end)),!0)}}}(),dU.prototype.distanceToPoint=(eh=new dD.Vector3,function(e){return this.closestPointToPoint(e,eh),e.distanceTo(eh)}),dU.prototype.distanceToTriangle=(eu=new dD.Vector3,eA=new dD.Vector3,ed=["a","b","c"],ef=new dD.Line3,em=new dD.Line3,function(e,t=null,r=null){let i=t||r?ef:null;if(this.intersectsTriangle(e,i))return(t||r)&&(t&&i.getCenter(t),r&&i.getCenter(r)),0;let n=1/0;for(let i=0;i<3;i++){let a,o=ed[i],s=e[o];this.closestPointToPoint(s,eu),(a=s.distanceToSquared(eu))<n&&(n=a,t&&t.copy(eu),r&&r.copy(s));let l=this[o];e.closestPointToPoint(l,eu),(a=l.distanceToSquared(eu))<n&&(n=a,t&&t.copy(l),r&&r.copy(eu))}for(let i=0;i<3;i++){let a=ed[i],o=ed[(i+1)%3];ef.set(this[a],this[o]);for(let i=0;i<3;i++){let a=ed[i],o=ed[(i+1)%3];em.set(e[a],e[o]),dR(ef,em,eu,eA);let s=eu.distanceToSquared(eA);s<n&&(n=s,t&&t.copy(eu),r&&r.copy(eA))}}return Math.sqrt(n)});class dz{constructor(e,t,r){this.isOrientedBox=!0,this.min=new tw.Vector3,this.max=new tw.Vector3,this.matrix=new tw.Matrix4,this.invMatrix=new tw.Matrix4,this.points=Array(8).fill().map(()=>new tw.Vector3),this.satAxes=[,,,].fill().map(()=>new tw.Vector3),this.satBounds=[,,,].fill().map(()=>new dT),this.alignedSatBounds=[,,,].fill().map(()=>new dT),this.needsUpdate=!1,e&&this.min.copy(e),t&&this.max.copy(t),r&&this.matrix.copy(r)}set(e,t,r){this.min.copy(e),this.max.copy(t),this.matrix.copy(r),this.needsUpdate=!0}copy(e){this.min.copy(e.min),this.max.copy(e.max),this.matrix.copy(e.matrix),this.needsUpdate=!0}}dz.prototype.update=function(){let e=this.matrix,t=this.min,r=this.max,i=this.points;for(let n=0;n<=1;n++)for(let a=0;a<=1;a++)for(let o=0;o<=1;o++){let s=i[n|2*a|4*o];s.x=n?r.x:t.x,s.y=a?r.y:t.y,s.z=o?r.z:t.z,s.applyMatrix4(e)}let n=this.satBounds,a=this.satAxes,o=i[0];for(let e=0;e<3;e++){let t=a[e],r=n[e],s=i[1<<e];t.subVectors(o,s),r.setFromPoints(t,i)}let s=this.alignedSatBounds;s[0].setFromPointsField(i,"x"),s[1].setFromPointsField(i,"y"),s[2].setFromPointsField(i,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1},dz.prototype.intersectsBox=(ep=new dT,function(e){this.needsUpdate&&this.update();let t=e.min,r=e.max,i=this.satBounds,n=this.satAxes,a=this.alignedSatBounds;if(ep.min=t.x,ep.max=r.x,a[0].isSeparated(ep)||(ep.min=t.y,ep.max=r.y,a[1].isSeparated(ep))||(ep.min=t.z,ep.max=r.z,a[2].isSeparated(ep)))return!1;for(let t=0;t<3;t++){let r=n[t],a=i[t];if(ep.setFromBox(r,e),a.isSeparated(ep))return!1}return!0}),dz.prototype.intersectsTriangle=(eg=new dU,ev=[,,,],ey=new dT,ex=new dT,eE=new tw.Vector3,function(e){this.needsUpdate&&this.update(),e.isExtendedTriangle?e.needsUpdate&&e.update():(eg.copy(e),eg.update(),e=eg);let t=this.satBounds,r=this.satAxes;ev[0]=e.a,ev[1]=e.b,ev[2]=e.c;for(let e=0;e<3;e++){let i=t[e],n=r[e];if(ey.setFromPoints(n,ev),i.isSeparated(ey))return!1}let i=e.satBounds,n=e.satAxes,a=this.points;for(let e=0;e<3;e++){let t=i[e],r=n[e];if(ey.setFromPoints(r,a),t.isSeparated(ey))return!1}for(let e=0;e<3;e++){let t=r[e];for(let e=0;e<4;e++){let r=n[e];if(eE.crossVectors(t,r),ey.setFromPoints(eE,ev),ex.setFromPoints(eE,a),ey.isSeparated(ex))return!1}}return!0}),dz.prototype.closestPointToPoint=function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t},dz.prototype.distanceToPoint=(eC=new tw.Vector3,function(e){return this.closestPointToPoint(e,eC),e.distanceTo(eC)}),dz.prototype.distanceToBox=(eB=["x","y","z"],ew=Array(12).fill().map(()=>new tw.Line3),eI=Array(12).fill().map(()=>new tw.Line3),eb=new tw.Vector3,e_=new tw.Vector3,function(e,t=0,r=null,i=null){if(this.needsUpdate&&this.update(),this.intersectsBox(e))return(r||i)&&(e.getCenter(e_),this.closestPointToPoint(e_,eb),e.closestPointToPoint(eb,e_),r&&r.copy(eb),i&&i.copy(e_)),0;let n=t*t,a=e.min,o=e.max,s=this.points,l=1/0;for(let e=0;e<8;e++){let t=s[e];e_.copy(t).clamp(a,o);let c=t.distanceToSquared(e_);if(c<l&&(l=c,r&&r.copy(t),i&&i.copy(e_),c<n))return Math.sqrt(c)}let c=0;for(let e=0;e<3;e++)for(let t=0;t<=1;t++)for(let r=0;r<=1;r++){let i=(e+1)%3,n=(e+2)%3,l=t<<i|r<<n,h=1<<e|t<<i|r<<n,u=s[l],A=s[h];ew[c].set(u,A);let d=eB[e],f=eB[i],m=eB[n],p=eI[c],g=p.start,v=p.end;g[d]=a[d],g[f]=t?a[f]:o[f],g[m]=r?a[m]:o[f],v[d]=o[d],v[f]=t?a[f]:o[f],v[m]=r?a[m]:o[f],c++}for(let e=0;e<=1;e++)for(let t=0;t<=1;t++)for(let s=0;s<=1;s++){e_.x=e?o.x:a.x,e_.y=t?o.y:a.y,e_.z=s?o.z:a.z,this.closestPointToPoint(e_,eb);let c=e_.distanceToSquared(eb);if(c<l&&(l=c,r&&r.copy(eb),i&&i.copy(e_),c<n))return Math.sqrt(c)}for(let e=0;e<12;e++){let t=ew[e];for(let e=0;e<12;e++){dR(t,eI[e],eb,e_);let a=eb.distanceToSquared(e_);if(a<l&&(l=a,r&&r.copy(eb),i&&i.copy(e_),a<n))return Math.sqrt(a)}}return Math.sqrt(l)});class dk{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){let e=this._primitives;return 0===e.length?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}}let dL=new class extends dk{constructor(){super(()=>new dU)}},dO=new class{constructor(){this.float32Array=null,this.uint16Array=null,this.uint32Array=null;const e=[];let t=null;this.setBuffer=r=>{t&&e.push(t),t=r,this.float32Array=new Float32Array(r),this.uint16Array=new Uint16Array(r),this.uint32Array=new Uint32Array(r)},this.clearBuffer=()=>{t=null,this.float32Array=null,this.uint16Array=null,this.uint32Array=null,0!==e.length&&this.setBuffer(e.pop())}}},dG=[],dN=new dk(()=>new tw.Box3),dH=new tw.Vector3,dV=new tw.Vector3,dj=parseInt(tw.REVISION)>=169,dJ=new tw.Vector3,dY=new tw.Vector3,dW=new tw.Vector3,dK=new tw.Vector2,dX=new tw.Vector2,dq=new tw.Vector2,dZ=new tw.Vector3,d$=new tw.Vector3,d1=new tw.Vector3,d0=new tw.Vector3;function d2(e,t,r,i,n,a,o){let s=3*i,l=s+0,c=s+1,h=s+2,u=e.index;e.index&&(l=u.getX(l),c=u.getX(c),h=u.getX(h));let{position:A,normal:d,uv:f,uv1:m}=e.attributes,p=function(e,t,r,i,n,a,o,s,l,c,h){dJ.fromBufferAttribute(t,a),dY.fromBufferAttribute(t,o),dW.fromBufferAttribute(t,s);let u=function(e,t,r,i,n,a,o,s){if(null===(a===tw.BackSide?e.intersectTriangle(i,r,t,!0,n):e.intersectTriangle(t,r,i,a!==tw.DoubleSide,n)))return null;let l=e.origin.distanceTo(n);return l<o||l>s?null:{distance:l,point:n.clone()}}(e,dJ,dY,dW,d0,l,c,h);if(u){let t=new tw.Vector3;tw.Triangle.getBarycoord(d0,dJ,dY,dW,t),i&&(dK.fromBufferAttribute(i,a),dX.fromBufferAttribute(i,o),dq.fromBufferAttribute(i,s),u.uv=tw.Triangle.getInterpolation(d0,dJ,dY,dW,dK,dX,dq,new tw.Vector2)),n&&(dK.fromBufferAttribute(n,a),dX.fromBufferAttribute(n,o),dq.fromBufferAttribute(n,s),u.uv1=tw.Triangle.getInterpolation(d0,dJ,dY,dW,dK,dX,dq,new tw.Vector2)),r&&(dZ.fromBufferAttribute(r,a),d$.fromBufferAttribute(r,o),d1.fromBufferAttribute(r,s),u.normal=tw.Triangle.getInterpolation(d0,dJ,dY,dW,dZ,d$,d1,new tw.Vector3),u.normal.dot(e.direction)>0&&u.normal.multiplyScalar(-1));let l={a:a,b:o,c:s,normal:new tw.Vector3,materialIndex:0};tw.Triangle.getNormal(dJ,dY,dW,l.normal),u.face=l,u.faceIndex=a,dj&&(u.barycoord=t)}return u}(r,A,d,f,m,l,c,h,t,a,o);return p?(p.faceIndex=i,n&&n.push(p),p):null}function d3(e,t,r,i){let n=e.a,a=e.b,o=e.c,s=t,l=t+1,c=t+2;r&&(s=r.getX(s),l=r.getX(l),c=r.getX(c)),n.x=i.getX(s),n.y=i.getY(s),n.z=i.getZ(s),a.x=i.getX(l),a.y=i.getY(l),a.z=i.getZ(l),o.x=i.getX(c),o.y=i.getY(c),o.z=i.getZ(c)}function d4(e,t,r,i,n,a,o){let{geometry:s}=r,{index:l}=s,c=s.attributes.position;for(let r=e,s=t+e;r<s;r++){let e;if(d3(o,3*(e=r),l,c),o.needsUpdate=!0,i(o,e,n,a))return!0}return!1}function d5(e,t,r,i,n){let a,o,s,l,c,h,u=1/r.direction.x,A=1/r.direction.y,d=1/r.direction.z,f=r.origin.x,m=r.origin.y,p=r.origin.z,g=t[e],v=t[e+3],y=t[e+1],x=t[e+3+1],E=t[e+2],C=t[e+3+2];return u>=0?(a=(g-f)*u,o=(v-f)*u):(a=(v-f)*u,o=(g-f)*u),A>=0?(s=(y-m)*A,l=(x-m)*A):(s=(x-m)*A,l=(y-m)*A),!(a>l)&&!(s>o)&&((s>a||isNaN(a))&&(a=s),(l<o||isNaN(o))&&(o=l),d>=0?(c=(E-p)*d,h=(C-p)*d):(c=(C-p)*d,h=(E-p)*d),!(a>h)&&!(c>o)&&((c>a||a!=a)&&(a=c),(h<o||o!=o)&&(o=h),a<=n&&o>=i))}function d6(e,t,r,i,n,a,o){dO.setBuffer(e._roots[t]),function e(t,r,i,n,a,o,s){let{float32Array:l,uint16Array:c,uint32Array:h}=dO,u=2*t;if(dM(u,c))!function(e,t,r,i,n,a,o,s){let{geometry:l,_indirectBuffer:c}=e;for(let e=i,c=i+n;e<c;e++)d2(l,t,r,e,a,o,s)}(r,i,n,h[t+6],dS(u,c),a,o,s);else{let c=t+8;d5(c,l,n,o,s)&&e(c,r,i,n,a,o,s);let u=h[t+6];d5(u,l,n,o,s)&&e(u,r,i,n,a,o,s)}}(0,e,r,i,n,a,o),dO.clearBuffer()}let d8=["x","y","z"];function d9(e,t,r,i,n,a){dO.setBuffer(e._roots[t]);let o=function e(t,r,i,n,a,o){let{float32Array:s,uint16Array:l,uint32Array:c}=dO,h=2*t;if(dM(h,l))return function(e,t,r,i,n,a,o){let{geometry:s,_indirectBuffer:l}=e,c=1/0,h=null;for(let e=i,l=i+n;e<l;e++){let i;(i=d2(s,t,r,e,null,a,o))&&i.distance<c&&(h=i,c=i.distance)}return h}(r,i,n,c[t+6],dS(h,l),a,o);{let l,h,u=c[t+7],A=d8[u],d=n.direction[A]>=0;d?(l=t+8,h=c[t+6]):(l=c[t+6],h=t+8);let f=d5(l,s,n,a,o)?e(l,r,i,n,a,o):null;if(f){let e=f.point[A];if(d?e<=s[h+u]:e>=s[h+u+3])return f}let m=d5(h,s,n,a,o)?e(h,r,i,n,a,o):null;return f&&m?f.distance<=m.distance?f:m:f||m||null}}(0,e,r,i,n,a);return dO.clearBuffer(),o}let d7=new tw.Box3,fe=new dU,ft=new dU,fr=new tw.Matrix4,fi=new dz,fn=new dz;function fa(e,t,r,i){dO.setBuffer(e._roots[t]);let n=function e(t,r,i,n,a=null){let{float32Array:o,uint16Array:s,uint32Array:l}=dO,c=2*t;if(null===a&&(i.boundingBox||i.computeBoundingBox(),fi.set(i.boundingBox.min,i.boundingBox.max,n),a=fi),dM(c,s)){let e=r.geometry,a=e.index,h=e.attributes.position,u=i.index,A=i.attributes.position,d=l[t+6],f=dS(c,s);if(fr.copy(n).invert(),i.boundsTree)return dg(t,o,fn),fn.matrix.copy(fr),fn.needsUpdate=!0,i.boundsTree.shapecast({intersectsBounds:e=>fn.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(n),e.b.applyMatrix4(n),e.c.applyMatrix4(n),e.needsUpdate=!0;for(let t=3*d,r=(f+d)*3;t<r;t+=3)if(d3(ft,t,a,h),ft.needsUpdate=!0,e.intersectsTriangle(ft))return!0;return!1}});for(let e=3*d,t=(f+d)*3;e<t;e+=3){d3(fe,e,a,h),fe.a.applyMatrix4(fr),fe.b.applyMatrix4(fr),fe.c.applyMatrix4(fr),fe.needsUpdate=!0;for(let e=0,t=u.count;e<t;e+=3)if(d3(ft,e,u,A),ft.needsUpdate=!0,fe.intersectsTriangle(ft))return!0}}else{let s=t+8,c=l[t+6];return dg(s,o,d7),!!(a.intersectsBox(d7)&&e(s,r,i,n,a))||(dg(c,o,d7),!!(a.intersectsBox(d7)&&e(c,r,i,n,a)))}}(0,e,r,i);return dO.clearBuffer(),n}let fo=new tw.Matrix4,fs=new dz,fl=new dz,fc=new tw.Vector3,fh=new tw.Vector3,fu=new tw.Vector3,fA=new tw.Vector3;function fd(e,t,r,i,n,a,o){let{geometry:s}=r,{index:l}=s,c=s.attributes.position;for(let s=e,h=t+e;s<h;s++){let e;if(d3(o,3*(e=r.resolveTriangleIndex(s)),l,c),o.needsUpdate=!0,i(o,e,n,a))return!0}return!1}function ff(e,t,r,i,n,a,o){dO.setBuffer(e._roots[t]),function e(t,r,i,n,a,o,s){let{float32Array:l,uint16Array:c,uint32Array:h}=dO,u=2*t;if(dM(u,c))!function(e,t,r,i,n,a,o,s){let{geometry:l,_indirectBuffer:c}=e;for(let e=i,h=i+n;e<h;e++)d2(l,t,r,c?c[e]:e,a,o,s)}(r,i,n,h[t+6],dS(u,c),a,o,s);else{let c=t+8;d5(c,l,n,o,s)&&e(c,r,i,n,a,o,s);let u=h[t+6];d5(u,l,n,o,s)&&e(u,r,i,n,a,o,s)}}(0,e,r,i,n,a,o),dO.clearBuffer()}let fm=["x","y","z"];function fp(e,t,r,i,n,a){dO.setBuffer(e._roots[t]);let o=function e(t,r,i,n,a,o){let{float32Array:s,uint16Array:l,uint32Array:c}=dO,h=2*t;if(dM(h,l))return function(e,t,r,i,n,a,o){let{geometry:s,_indirectBuffer:l}=e,c=1/0,h=null;for(let e=i,u=i+n;e<u;e++){let i;(i=d2(s,t,r,l?l[e]:e,null,a,o))&&i.distance<c&&(h=i,c=i.distance)}return h}(r,i,n,c[t+6],dS(h,l),a,o);{let l,h,u=c[t+7],A=fm[u],d=n.direction[A]>=0;d?(l=t+8,h=c[t+6]):(l=c[t+6],h=t+8);let f=d5(l,s,n,a,o)?e(l,r,i,n,a,o):null;if(f){let e=f.point[A];if(d?e<=s[h+u]:e>=s[h+u+3])return f}let m=d5(h,s,n,a,o)?e(h,r,i,n,a,o):null;return f&&m?f.distance<=m.distance?f:m:f||m||null}}(0,e,r,i,n,a);return dO.clearBuffer(),o}let fg=new tw.Box3,fv=new dU,fy=new dU,fx=new tw.Matrix4,fE=new dz,fC=new dz;function fB(e,t,r,i){dO.setBuffer(e._roots[t]);let n=function e(t,r,i,n,a=null){let{float32Array:o,uint16Array:s,uint32Array:l}=dO,c=2*t;if(null===a&&(i.boundingBox||i.computeBoundingBox(),fE.set(i.boundingBox.min,i.boundingBox.max,n),a=fE),dM(c,s)){let e=r.geometry,a=e.index,h=e.attributes.position,u=i.index,A=i.attributes.position,d=l[t+6],f=dS(c,s);if(fx.copy(n).invert(),i.boundsTree)return dg(t,o,fC),fC.matrix.copy(fx),fC.needsUpdate=!0,i.boundsTree.shapecast({intersectsBounds:e=>fC.intersectsBox(e),intersectsTriangle:e=>{e.a.applyMatrix4(n),e.b.applyMatrix4(n),e.c.applyMatrix4(n),e.needsUpdate=!0;for(let t=d,i=f+d;t<i;t++)if(d3(fy,3*r.resolveTriangleIndex(t),a,h),fy.needsUpdate=!0,e.intersectsTriangle(fy))return!0;return!1}});for(let e=d,t=f+d;e<t;e++){d3(fv,3*r.resolveTriangleIndex(e),a,h),fv.a.applyMatrix4(fx),fv.b.applyMatrix4(fx),fv.c.applyMatrix4(fx),fv.needsUpdate=!0;for(let e=0,t=u.count;e<t;e+=3)if(d3(fy,e,u,A),fy.needsUpdate=!0,fv.intersectsTriangle(fy))return!0}}else{let s=t+8,c=l[t+6];return dg(s,o,fg),!!(a.intersectsBox(fg)&&e(s,r,i,n,a))||(dg(c,o,fg),!!(a.intersectsBox(fg)&&e(c,r,i,n,a)))}}(0,e,r,i);return dO.clearBuffer(),n}let fw=new tw.Matrix4,fI=new dz,fb=new dz,f_=new tw.Vector3,fM=new tw.Vector3,fS=new tw.Vector3,fT=new tw.Vector3,fD=new dO.constructor,fF=new dO.constructor,fR=new dk(()=>new tw.Box3),fP=new tw.Box3,fQ=new tw.Box3,fU=new tw.Box3,fz=new tw.Box3,fk=!1,fL=new dz,fO=new tw.Box3,fG={strategy:0,maxDepth:40,maxLeafTris:10,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,indirect:!1,verbose:!0,range:null};class fN{static serialize(e,t={}){t={cloneBuffers:!0,...t};let r=e.geometry,i=e._roots,n=e._indirectBuffer,a=r.getIndex();return t.cloneBuffers?{roots:i.map(e=>e.slice()),index:a?a.array.slice():null,indirectBuffer:n?n.slice():null}:{roots:i,index:a?a.array:null,indirectBuffer:n}}static deserialize(e,t,r={}){r={setIndex:!0,indirect:!!e.indirectBuffer,...r};let{index:i,roots:n,indirectBuffer:a}=e,o=new fN(t,{...r,[dc]:!0});if(o._roots=n,o._indirectBuffer=a||null,r.setIndex){let r=t.getIndex();if(null===r){let r=new tw.BufferAttribute(e.index,1,!1);t.setIndex(r)}else r.array!==i&&(r.array.set(i),r.needsUpdate=!0)}return o}get indirect(){return!!this._indirectBuffer}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw Error("MeshBVH: Only BufferGeometries are supported.");if((t=Object.assign({...fG,[dc]:!1},t)).useSharedArrayBuffer&&"undefined"==typeof SharedArrayBuffer)throw Error("MeshBVH: SharedArrayBuffer is not available.");this.geometry=e,this._roots=null,this._indirectBuffer=null,t[dc]||(!function(e,t){let r=e.geometry;if(t.indirect){var i;let n,a,o,s;e._indirectBuffer=function(e,t){let r=(e.index?e.index.count:e.attributes.position.count)/3,i=r>65536,n=i?4:2,a=t?new SharedArrayBuffer(r*n):new ArrayBuffer(r*n),o=i?new Uint32Array(a):new Uint16Array(a);for(let e=0,t=o.length;e<t;e++)o[e]=e;return o}(r,t.useSharedArrayBuffer),i=t.range,n=dA(r),(o=(a=dm(r,i).sort((e,t)=>e.offset-t.offset))[a.length-1]).count=Math.min(n-o.offset,o.count),s=0,a.forEach(({count:e})=>s+=e),n===s||t.verbose||console.warn('MeshBVH: Provided geometry contains groups or a range that do not fully span the vertex contents while using the "indirect" option. BVH may incorrectly report intersections on unrendered portions of the geometry.')}e._indirectBuffer||function(e,t){if(!e.index){let r=e.attributes.position.count,i=dd(r,t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer);e.setIndex(new tw.BufferAttribute(i,1));for(let e=0;e<r;e++)i[e]=e}}(r,t);let n=t.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,a=function(e,t=null,r=null,i=null){let n,a=e.attributes.position,o=e.index?e.index.array:null,s=dA(e),l=a.normalized;null===t?(n=new Float32Array(6*s),r=0,i=s):(n=t,r=r||0,i=i||s);let c=a.array,h=a.offset||0,u=3;a.isInterleavedBufferAttribute&&(u=a.data.stride);let A=["getX","getY","getZ"];for(let e=r;e<r+i;e++){let t=3*e,r=6*e,i=t+0,s=t+1,d=t+2;o&&(i=o[i],s=o[s],d=o[d]),l||(i=i*u+h,s=s*u+h,d=d*u+h);for(let e=0;e<3;e++){let t,o,h;l?(t=a[A[e]](i),o=a[A[e]](s),h=a[A[e]](d)):(t=c[i+e],o=c[s+e],h=c[d+e]);let u=t;o<u&&(u=o),h<u&&(u=h);let f=t;o>f&&(f=o),h>f&&(f=h);let m=(f-u)/2,p=2*e;n[r+p+0]=u+m,n[r+p+1]=m+(Math.abs(u)+m)*5960464477539063e-23}}return n}(r);e._roots=(t.indirect?df(r,t.range):dm(r,t.range)).map(r=>{let i=function(e,t,r,i,n){let{maxDepth:a,verbose:o,maxLeafTris:s,strategy:l,onProgress:c,indirect:h}=n,u=e._indirectBuffer,A=e.geometry,d=A.index?A.index.array:null,f=h?d_:db,m=dA(A),p=new Float32Array(6),g=!1,v=new dI;return dp(t,r,i,v.boundingData,p),function e(r,i,n,c=null,h=0){if(!g&&h>=a&&(g=!0,o&&(console.warn(`MeshBVH: Max depth of ${a} reached when generating BVH. Consider increasing maxDepth.`),console.warn(A))),n<=s||h>=a)return y(i+n),r.offset=i,r.count=n,r;let m=function(e,t,r,i,n,a){let o=-1,s=0;if(0===a)-1!==(o=dv(t))&&(s=(t[o]+t[o+3])/2);else if(1===a)-1!==(o=dv(e))&&(s=function(e,t,r,i){let n=0;for(let a=t,o=t+r;a<o;a++)n+=e[6*a+2*i];return n/r}(r,i,n,o));else if(a===dl){let a=dE(e),c=1.25*n,h=6*i,u=(i+n)*6;for(let e=0;e<3;e++){let i=t[e],A=(t[e+3]-i)/32;if(n<8){let t=[...dB];t.length=n;let i=0;for(let n=h;n<u;n+=6,i++){let a=t[i];a.candidate=r[n+2*e],a.count=0;let{bounds:o,leftCacheBounds:s,rightCacheBounds:l}=a;for(let e=0;e<3;e++)l[e]=1/0,l[e+3]=-1/0,s[e]=1/0,s[e+3]=-1/0,o[e]=1/0,o[e+3]=-1/0;dx(n,r,o)}t.sort(dC);let l=n;for(let e=0;e<l;e++){let r=t[e];for(;e+1<l&&t[e+1].candidate===r.candidate;)t.splice(e+1,1),l--}for(let i=h;i<u;i+=6){let n=r[i+2*e];for(let e=0;e<l;e++){let a=t[e];n>=a.candidate?dx(i,r,a.rightCacheBounds):(dx(i,r,a.leftCacheBounds),a.count++)}}for(let r=0;r<l;r++){let i=t[r],l=i.count,h=n-i.count,u=i.leftCacheBounds,A=i.rightCacheBounds,d=0;0!==l&&(d=dE(u)/a);let f=0;0!==h&&(f=dE(A)/a);let m=1+1.25*(d*l+f*h);m<c&&(o=e,c=m,s=i.candidate)}}else{var l;for(let e=0;e<32;e++){let t=dB[e];t.count=0,t.candidate=i+A+e*A;let r=t.bounds;for(let e=0;e<3;e++)r[e]=1/0,r[e+3]=-1/0}for(let t=h;t<u;t+=6){let n=~~((r[t+2*e]-i)/A);n>=32&&(n=31);let a=dB[n];a.count++,dx(t,r,a.bounds)}let t=dB[31];l=t.bounds,t.rightCacheBounds.set(l);for(let e=30;e>=0;e--){let t=dB[e],r=dB[e+1];dy(t.bounds,r.rightCacheBounds,t.rightCacheBounds)}let d=0;for(let t=0;t<31;t++){let r=dB[t],i=r.count,l=r.bounds,h=dB[t+1].rightCacheBounds;0!==i&&(0===d?dw.set(l):dy(l,dw,dw));let u=0,A=0;0!==(d+=i)&&(u=dE(dw)/a);let f=n-d;0!==f&&(A=dE(h)/a);let m=1+1.25*(u*d+A*f);m<c&&(o=e,c=m,s=r.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${a} used.`);return{axis:o,pos:s}}(r.boundingData,c,t,i,n,l);if(-1===m.axis)return y(i+n),r.offset=i,r.count=n,r;let v=f(u,d,t,i,n,m);if(v===i||v===i+n)y(i+n),r.offset=i,r.count=n;else{r.splitAxis=m.axis;let a=new dI,o=v-i;r.left=a,dp(t,i,o,a.boundingData,p),e(a,i,o,p,h+1);let s=new dI,l=n-o;r.right=s,dp(t,v,l,s.boundingData,p),e(s,v,l,p,h+1)}return r}(v,r,i,p),v;function y(e){c&&c(e/m)}}(e,a,r.offset,r.count,t),o=new n(32*function e(t){return"count"in t?1:1+e(t.left)+e(t.right)}(i));return U=new Float32Array(o),z=new Uint32Array(o),k=new Uint16Array(o),L=new Uint8Array(o),function e(t,r){let i=t/4,n=t/2,a="count"in r,o=r.boundingData;for(let e=0;e<6;e++)U[i+e]=o[e];if(a)if(r.buffer){let e=r.buffer;L.set(new Uint8Array(e),t);for(let r=t,n=t+e.byteLength;r<n;r+=32)dM(r/2,k)||(z[r/4+6]+=i);return t+e.byteLength}else{let e=r.offset,a=r.count;return z[i+6]=e,k[n+14]=a,k[n+15]=65535,t+32}{let n,a=r.left,o=r.right,s=r.splitAxis;if((n=e(t+32,a))/4>0x100000000)throw Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return z[i+6]=n/4,n=e(n,o),z[i+7]=s,n}}(0,i),o})}(this,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new tw.Box3))),this.resolveTriangleIndex=t.indirect?e=>this._indirectBuffer[e]:e=>e}refit(e=null){return(this.indirect?function(e,t=null){let r,i,n,a;t&&Array.isArray(t)&&(t=new Set(t));let o=e.geometry,s=o.index?o.index.array:null,l=o.attributes.position,c=0,h=e._roots;for(let o=0,u=h.length;o<u;o++)i=new Uint32Array(r=h[o]),n=new Uint16Array(r),a=new Float32Array(r),function r(o,c,h=!1){let u=2*o;if(65535===n[u+15]){let t=i[o+6],r=n[u+14],c=1/0,h=1/0,A=1/0,d=-1/0,f=-1/0,m=-1/0;for(let i=t,n=t+r;i<n;i++){let t=3*e.resolveTriangleIndex(i);for(let e=0;e<3;e++){let r=t+e;r=s?s[r]:r;let i=l.getX(r),n=l.getY(r),a=l.getZ(r);i<c&&(c=i),i>d&&(d=i),n<h&&(h=n),n>f&&(f=n),a<A&&(A=a),a>m&&(m=a)}}return(a[o+0]!==c||a[o+1]!==h||a[o+2]!==A||a[o+3]!==d||a[o+4]!==f||a[o+5]!==m)&&(a[o+0]=c,a[o+1]=h,a[o+2]=A,a[o+3]=d,a[o+4]=f,a[o+5]=m,!0)}{let e=o+8,n=i[o+6],s=e+c,l=n+c,u=h,A=!1,d=!1;t?u||(A=t.has(s),d=t.has(l),u=!A&&!d):(A=!0,d=!0);let f=u||A,m=u||d,p=!1;f&&(p=r(e,c,u));let g=!1;m&&(g=r(n,c,u));let v=p||g;if(v)for(let t=0;t<3;t++){let r=e+t,i=n+t,s=a[r],l=a[r+3],c=a[i],h=a[i+3];a[o+t]=s<c?s:c,a[o+t+3]=l>h?l:h}return v}}(0,c),c+=r.byteLength}:function(e,t=null){let r,i,n,a;t&&Array.isArray(t)&&(t=new Set(t));let o=e.geometry,s=o.index?o.index.array:null,l=o.attributes.position,c=0,h=e._roots;for(let e=0,o=h.length;e<o;e++)i=new Uint32Array(r=h[e]),n=new Uint16Array(r),a=new Float32Array(r),function e(r,o,c=!1){let h=2*r;if(65535===n[h+15]){let e=i[r+6],t=n[h+14],o=1/0,c=1/0,u=1/0,A=-1/0,d=-1/0,f=-1/0;for(let r=3*e,i=3*(e+t);r<i;r++){let e=s[r],t=l.getX(e),i=l.getY(e),n=l.getZ(e);t<o&&(o=t),t>A&&(A=t),i<c&&(c=i),i>d&&(d=i),n<u&&(u=n),n>f&&(f=n)}return(a[r+0]!==o||a[r+1]!==c||a[r+2]!==u||a[r+3]!==A||a[r+4]!==d||a[r+5]!==f)&&(a[r+0]=o,a[r+1]=c,a[r+2]=u,a[r+3]=A,a[r+4]=d,a[r+5]=f,!0)}{let n=r+8,s=i[r+6],l=n+o,h=s+o,u=c,A=!1,d=!1;t?u||(A=t.has(l),d=t.has(h),u=!A&&!d):(A=!0,d=!0);let f=u||A,m=u||d,p=!1;f&&(p=e(n,o,u));let g=!1;m&&(g=e(s,o,u));let v=p||g;if(v)for(let e=0;e<3;e++){let t=n+e,i=s+e,o=a[t],l=a[t+3],c=a[i],h=a[i+3];a[r+e]=o<c?o:c,a[r+e+3]=l>h?l:h}return v}}(0,c),c+=r.byteLength})(this,e)}traverse(e,t=0){let r=this._roots[t],i=new Uint32Array(r),n=new Uint16Array(r);!function t(a,o=0){let s=2*a,l=65535===n[s+15];if(l){let t=i[a+6],c=n[s+14];e(o,l,new Float32Array(r,4*a,6),t,c)}else{let n=i[a+6],s=i[a+7];e(o,l,new Float32Array(r,4*a,6),s)||(t(a+8,o+1),t(n,o+1))}}(0)}raycast(e,t=tw.FrontSide,r=0,i=1/0){let n=this._roots,a=this.geometry,o=[],s=t.isMaterial,l=Array.isArray(t),c=a.groups,h=s?t.side:t,u=this.indirect?ff:d6;for(let a=0,s=n.length;a<s;a++){let n=l?t[c[a].materialIndex].side:h,s=o.length;if(u(this,a,n,e,o,r,i),l){let e=c[a].materialIndex;for(let t=s,r=o.length;t<r;t++)o[t].face.materialIndex=e}}return o}raycastFirst(e,t=tw.FrontSide,r=0,i=1/0){let n=this._roots,a=this.geometry,o=t.isMaterial,s=Array.isArray(t),l=null,c=a.groups,h=o?t.side:t,u=this.indirect?fp:d9;for(let a=0,o=n.length;a<o;a++){let n=s?t[c[a].materialIndex].side:h,o=u(this,a,n,e,r,i);null!=o&&(null==l||o.distance<l.distance)&&(l=o,s&&(o.face.materialIndex=c[a].materialIndex))}return l}intersectsGeometry(e,t){let r=!1,i=this._roots,n=this.indirect?fB:fa;for(let a=0,o=i.length;a<o&&!(r=n(this,a,e,t));a++);return r}shapecast(e){let t=dL.getPrimitive(),r=this.indirect?fd:d4,{boundsTraverseOrder:i,intersectsBounds:n,intersectsRange:a,intersectsTriangle:o}=e;if(a&&o){let e=a;a=(i,n,a,s,l)=>!!e(i,n,a,s,l)||r(i,n,this,o,a,s,t)}else a||(a=o?(e,i,n,a)=>r(e,i,this,o,n,a,t):(e,t,r)=>r);let s=!1,l=0,c=this._roots;for(let e=0,t=c.length;e<t;e++){let t=c[e];if(s=function(e,t,r,i,n,a){O=dN.getPrimitive(),G=dN.getPrimitive(),dG.push(O,G),dO.setBuffer(e._roots[t]);let o=function e(t,r,i,n,a=null,o=0,s=0){let{float32Array:l,uint16Array:c,uint32Array:h}=dO,u=2*t;if(dM(u,c)){let e=h[t+6],r=dS(u,c);return dg(t,l,O),n(e,r,!1,s,o+t,O)}{let u,f,m,p,g,v,y=t+8,x=h[t+6],E=y,C=x;if(a&&(m=O,p=G,dg(E,l,m),dg(C,l,p),u=a(m),(f=a(p))<u)){E=x,C=y;let e=u;u=f,f=e,m=p}m||dg(E,l,m=O);let B=i(m,dM(2*E,c),u,s+1,o+E);if(2===B){let e=A(E);g=n(e,d(E)-e,!0,s+1,o+E,m)}else g=B&&e(E,r,i,n,a,o,s+1);if(g)return!0;dg(C,l,p=G);let w=i(p,dM(2*C,c),f,s+1,o+C);if(2===w){let e=A(C);v=n(e,d(C)-e,!0,s+1,o+C,p)}else v=w&&e(C,r,i,n,a,o,s+1);if(v)return!0;return!1;function A(e){let{uint16Array:t,uint32Array:r}=dO,i=2*e;for(;!dM(i,t);)i=2*(e+=8);return r[e+6]}function d(e){let{uint16Array:t,uint32Array:r}=dO,i=2*e;for(;!dM(i,t);)i=2*(e=r[e+6]);return r[e+6]+dS(i,t)}}}(0,e.geometry,r,i,n,a);dO.clearBuffer(),dN.releasePrimitive(O),dN.releasePrimitive(G),dG.pop(),dG.pop();let s=dG.length;return s>0&&(G=dG[s-1],O=dG[s-2]),o}(this,e,n,a,i,l))break;l+=t.byteLength}return dL.releasePrimitive(t),s}bvhcast(e,t,r){let{intersectsRanges:i,intersectsTriangles:n}=r,a=dL.getPrimitive(),o=this.geometry.index,s=this.geometry.attributes.position,l=this.indirect?e=>{d3(a,3*this.resolveTriangleIndex(e),o,s)}:e=>{d3(a,3*e,o,s)},c=dL.getPrimitive(),h=e.geometry.index,u=e.geometry.attributes.position,A=e.indirect?t=>{d3(c,3*e.resolveTriangleIndex(t),h,u)}:e=>{d3(c,3*e,h,u)};if(n){let e=(e,r,i,o,s,h,u,d)=>{for(let f=i,m=i+o;f<m;f++){A(f),c.a.applyMatrix4(t),c.b.applyMatrix4(t),c.c.applyMatrix4(t),c.needsUpdate=!0;for(let t=e,i=e+r;t<i;t++)if(l(t),a.needsUpdate=!0,n(a,c,t,f,s,h,u,d))return!0}return!1};if(i){let t=i;i=function(r,i,n,a,o,s,l,c){return!!t(r,i,n,a,o,s,l,c)||e(r,i,n,a,o,s,l,c)}}else i=e}return function(e,t,r,i){let n;if(fk)throw Error("MeshBVH: Recursive calls to bvhcast not supported.");fk=!0;let a=e._roots,o=t._roots,s=0,l=0,c=new tw.Matrix4().copy(r).invert();for(let e=0,t=a.length;e<t;e++){fD.setBuffer(a[e]),l=0;let t=fR.getPrimitive();dg(0,fD.float32Array,t),t.applyMatrix4(c);for(let e=0,a=o.length;e<a&&(fF.setBuffer(o[e]),n=function e(t,r,i,n,a,o=0,s=0,l=0,c=0,h=null,u=!1){let A,d;u?(A=fF,d=fD):(A=fD,d=fF);let f=A.float32Array,m=A.uint32Array,p=A.uint16Array,g=d.float32Array,v=d.uint32Array,y=d.uint16Array,x=2*r,E=dM(2*t,p),C=dM(x,y),B=!1;if(C&&E)B=u?a(v[r+6],dS(2*r,y),m[t+6],dS(2*t,p),c,s+r,l,o+t):a(m[t+6],dS(2*t,p),v[r+6],dS(2*r,y),l,o+t,c,s+r);else if(C){let h=fR.getPrimitive();dg(r,g,h),h.applyMatrix4(i);let A=t+8,d=m[t+6];dg(A,f,fP),dg(d,f,fQ);let p=h.intersectsBox(fP),v=h.intersectsBox(fQ);B=p&&e(r,A,n,i,a,s,o,c,l+1,h,!u)||v&&e(r,d,n,i,a,s,o,c,l+1,h,!u),fR.releasePrimitive(h)}else{let A=r+8,d=v[r+6];dg(A,g,fU),dg(d,g,fz);let p=h.intersectsBox(fU),y=h.intersectsBox(fz);if(p&&y)B=e(t,A,i,n,a,o,s,l,c+1,h,u)||e(t,d,i,n,a,o,s,l,c+1,h,u);else if(p)if(E)B=e(t,A,i,n,a,o,s,l,c+1,h,u);else{let r=fR.getPrimitive();r.copy(fU).applyMatrix4(i);let h=t+8,d=m[t+6];dg(h,f,fP),dg(d,f,fQ);let p=r.intersectsBox(fP),g=r.intersectsBox(fQ);B=p&&e(A,h,n,i,a,s,o,c,l+1,r,!u)||g&&e(A,d,n,i,a,s,o,c,l+1,r,!u),fR.releasePrimitive(r)}else if(y)if(E)B=e(t,d,i,n,a,o,s,l,c+1,h,u);else{let r=fR.getPrimitive();r.copy(fz).applyMatrix4(i);let h=t+8,A=m[t+6];dg(h,f,fP),dg(A,f,fQ);let p=r.intersectsBox(fP),g=r.intersectsBox(fQ);B=p&&e(d,h,n,i,a,s,o,c,l+1,r,!u)||g&&e(d,A,n,i,a,s,o,c,l+1,r,!u),fR.releasePrimitive(r)}}return B}(0,0,r,c,i,s,l,0,0,t),fF.clearBuffer(),l+=o[e].length,!n);e++);if(fR.releasePrimitive(t),fD.clearBuffer(),s+=a[e].length,n)break}return fk=!1,n}(this,e,t,i)}intersectsBox(e,t){return fL.set(e.min,e.max,t),fL.needsUpdate=!0,this.shapecast({intersectsBounds:e=>fL.intersectsBox(e),intersectsTriangle:e=>fL.intersectsTriangle(e)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,r={},i={},n=0,a=1/0){return(this.indirect?function(e,t,r,i={},n={},a=0,o=1/0){t.boundingBox||t.computeBoundingBox(),fI.set(t.boundingBox.min,t.boundingBox.max,r),fI.needsUpdate=!0;let s=e.geometry,l=s.attributes.position,c=s.index,h=t.attributes.position,u=t.index,A=dL.getPrimitive(),d=dL.getPrimitive(),f=null,m=null;n&&(f=fS,m=fT);let p=1/0,g=null,v=null;return(fw.copy(r).invert(),fb.matrix.copy(fw),e.shapecast({boundsTraverseOrder:e=>fI.distanceToBox(e),intersectsBounds:(e,t,r)=>r<p&&r<o&&(t&&(fb.min.copy(e.min),fb.max.copy(e.max),fb.needsUpdate=!0),!0),intersectsRange:(i,n)=>{if(t.boundsTree){let s=t.boundsTree;return s.shapecast({boundsTraverseOrder:e=>fb.distanceToBox(e),intersectsBounds:(e,t,r)=>r<p&&r<o,intersectsRange:(t,o)=>{for(let y=t,x=t+o;y<x;y++){d3(d,3*s.resolveTriangleIndex(y),u,h),d.a.applyMatrix4(r),d.b.applyMatrix4(r),d.c.applyMatrix4(r),d.needsUpdate=!0;for(let t=i,r=i+n;t<r;t++){d3(A,3*e.resolveTriangleIndex(t),c,l),A.needsUpdate=!0;let r=A.distanceToTriangle(d,f_,f);if(r<p&&(fM.copy(f_),m&&m.copy(f),p=r,g=t,v=y),r<a)return!0}}}})}{let o=dA(t);for(let t=0;t<o;t++){d3(d,3*t,u,h),d.a.applyMatrix4(r),d.b.applyMatrix4(r),d.c.applyMatrix4(r),d.needsUpdate=!0;for(let r=i,o=i+n;r<o;r++){d3(A,3*e.resolveTriangleIndex(r),c,l),A.needsUpdate=!0;let i=A.distanceToTriangle(d,f_,f);if(i<p&&(fM.copy(f_),m&&m.copy(f),p=i,g=r,v=t),i<a)return!0}}}}}),dL.releasePrimitive(A),dL.releasePrimitive(d),p===1/0)?null:(i.point?i.point.copy(fM):i.point=fM.clone(),i.distance=p,i.faceIndex=g,n&&(n.point?n.point.copy(m):n.point=m.clone(),n.point.applyMatrix4(fw),fM.applyMatrix4(fw),n.distance=fM.sub(n.point).length(),n.faceIndex=v),i)}:function(e,t,r,i={},n={},a=0,o=1/0){t.boundingBox||t.computeBoundingBox(),fs.set(t.boundingBox.min,t.boundingBox.max,r),fs.needsUpdate=!0;let s=e.geometry,l=s.attributes.position,c=s.index,h=t.attributes.position,u=t.index,A=dL.getPrimitive(),d=dL.getPrimitive(),f=null,m=null;n&&(f=fu,m=fA);let p=1/0,g=null,v=null;return(fo.copy(r).invert(),fl.matrix.copy(fo),e.shapecast({boundsTraverseOrder:e=>fs.distanceToBox(e),intersectsBounds:(e,t,r)=>r<p&&r<o&&(t&&(fl.min.copy(e.min),fl.max.copy(e.max),fl.needsUpdate=!0),!0),intersectsRange:(e,i)=>{if(t.boundsTree)return t.boundsTree.shapecast({boundsTraverseOrder:e=>fl.distanceToBox(e),intersectsBounds:(e,t,r)=>r<p&&r<o,intersectsRange:(t,n)=>{for(let o=t,s=t+n;o<s;o++){d3(d,3*o,u,h),d.a.applyMatrix4(r),d.b.applyMatrix4(r),d.c.applyMatrix4(r),d.needsUpdate=!0;for(let t=e,r=e+i;t<r;t++){d3(A,3*t,c,l),A.needsUpdate=!0;let e=A.distanceToTriangle(d,fc,f);if(e<p&&(fh.copy(fc),m&&m.copy(f),p=e,g=t,v=o),e<a)return!0}}}});{let n=dA(t);for(let t=0;t<n;t++){d3(d,3*t,u,h),d.a.applyMatrix4(r),d.b.applyMatrix4(r),d.c.applyMatrix4(r),d.needsUpdate=!0;for(let r=e,n=e+i;r<n;r++){d3(A,3*r,c,l),A.needsUpdate=!0;let e=A.distanceToTriangle(d,fc,f);if(e<p&&(fh.copy(fc),m&&m.copy(f),p=e,g=r,v=t),e<a)return!0}}}}}),dL.releasePrimitive(A),dL.releasePrimitive(d),p===1/0)?null:(i.point?i.point.copy(fh):i.point=fh.clone(),i.distance=p,i.faceIndex=g,n&&(n.point?n.point.copy(m):n.point=m.clone(),n.point.applyMatrix4(fo),fh.applyMatrix4(fo),n.distance=fh.sub(n.point).length(),n.faceIndex=v),i)})(this,e,t,r,i,n,a)}closestPointToPoint(e,t={},r=0,i=1/0){return function(e,t,r={},i=0,n=1/0){let a=i*i,o=n*n,s=1/0,l=null;if(e.shapecast({boundsTraverseOrder:e=>(dH.copy(t).clamp(e.min,e.max),dH.distanceToSquared(t)),intersectsBounds:(e,t,r)=>r<s&&r<o,intersectsTriangle:(e,r)=>{e.closestPointToPoint(t,dH);let i=t.distanceToSquared(dH);return i<s&&(dV.copy(dH),s=i,l=r),i<a}}),s===1/0)return null;let c=Math.sqrt(s);return r.point?r.point.copy(dV):r.point=dV.clone(),r.distance=c,r.faceIndex=l,r}(this,e,t,r,i)}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(t=>{dg(0,new Float32Array(t),fO),e.union(fO)}),e}}parseInt(tw.REVISION);let fH=new tw.Ray,fV=new tw.Vector3,fj=new tw.Matrix4,fJ=tw.Mesh.prototype.raycast,fY=tw.BatchedMesh.prototype.raycast,fW=new tw.Vector3,fK=new tw.Mesh,fX=[];function fq(e,t){this.isBatchedMesh?fZ.call(this,e,t):f$.call(this,e,t)}function fZ(e,t){if(this.boundsTrees){let r=this.boundsTrees,i=this._drawInfo||this._instanceInfo,n=this._drawRanges||this._geometryInfo,a=this.matrixWorld;fK.material=this.material,fK.geometry=this.geometry;let o=fK.geometry.boundsTree,s=fK.geometry.drawRange;null===fK.geometry.boundingSphere&&(fK.geometry.boundingSphere=new tw.Sphere);for(let o=0,s=i.length;o<s;o++){if(!this.getVisibleAt(o))continue;let s=i[o].geometryIndex;if(fK.geometry.boundsTree=r[s],this.getMatrixAt(o,fK.matrixWorld).premultiply(a),!fK.geometry.boundsTree){this.getBoundingBoxAt(s,fK.geometry.boundingBox),this.getBoundingSphereAt(s,fK.geometry.boundingSphere);let e=n[s];fK.geometry.setDrawRange(e.start,e.count)}fK.raycast(e,fX);for(let e=0,r=fX.length;e<r;e++){let r=fX[e];r.object=this,r.batchId=o,t.push(r)}fX.length=0}fK.geometry.boundsTree=o,fK.geometry.drawRange=s,fK.material=null,fK.geometry=null}else fY.call(this,e,t)}function f$(e,t){if(this.geometry.boundsTree){if(void 0===this.material)return;fj.copy(this.matrixWorld).invert(),fH.copy(e.ray).applyMatrix4(fj),fW.setFromMatrixScale(this.matrixWorld),fV.copy(fH.direction).multiply(fW);let r=fV.length(),i=e.near/r,n=e.far/r,a=this.geometry.boundsTree;if(!0===e.firstHitOnly){let r=dh(a.raycastFirst(fH,this.material,i,n),this,e);r&&t.push(r)}else{let r=a.raycast(fH,this.material,i,n);for(let i=0,n=r.length;i<n;i++){let n=dh(r[i],this,e);n&&t.push(n)}}}else fJ.call(this,e,t)}function f1(e={}){return this.boundsTree=new fN(this,e),this.boundsTree}function f0(){this.boundsTree=null}function f2(e,t){t={strategy:dl,verbose:!1,setBoundingBox:!0,maxDepth:40,maxLeafTris:10,indirect:!1,...t},tC.useEffect(()=>{if(e.current){e.current.raycast=fq;let r=e.current.geometry;return r.computeBoundsTree=f1,r.disposeBoundsTree=f0,r.computeBoundsTree(t),()=>{r.boundsTree&&r.disposeBoundsTree()}}},[e,JSON.stringify(t)])}let f3=tC.forwardRef(({enabled:e=!0,firstHitOnly:t=!1,children:r,strategy:i=dl,verbose:n=!1,setBoundingBox:a=!0,maxDepth:o=40,maxLeafTris:s=10,indirect:l=!1,...c},h)=>{let u=tC.useRef(null),A=(0,tI.C)(e=>e.raycaster);return tC.useImperativeHandle(h,()=>u.current,[]),tC.useEffect(()=>{if(e){let e={strategy:i,verbose:n,setBoundingBox:a,maxDepth:o,maxLeafTris:s,indirect:l},r=u.current;return A.firstHitOnly=t,r.traverse(t=>{t.isMesh&&!t.geometry.boundsTree&&t.raycast===tw.Mesh.prototype.raycast&&(t.raycast=fq,t.geometry.computeBoundsTree=f1,t.geometry.disposeBoundsTree=f0,t.geometry.computeBoundsTree(e))}),()=>{delete A.firstHitOnly,r.traverse(e=>{e.isMesh&&e.geometry.boundsTree&&(e.geometry.disposeBoundsTree(),e.raycast=tw.Mesh.prototype.raycast)})}}},[]),tC.createElement("group",e2({ref:u},c),r)});function f4(...e){let t=tC.useRef([]);return t.current=e.map(e=>tC.useContext(e)),tC.useMemo(()=>({children:r})=>e.reduceRight((e,r,i)=>tC.createElement(r.Provider,{value:t.current[i],children:e}),r),[])}function f5(e,t){let r=tC.useRef(null),[i]=tC.useState(()=>t?t instanceof tw.Object3D?{current:t}:t:r),[n]=tC.useState(()=>new tw.AnimationMixer(void 0));tC.useLayoutEffect(()=>{t&&(i.current=t instanceof tw.Object3D?t:t.current),n._root=i.current});let a=tC.useRef({}),o=tC.useMemo(()=>{let t={};return e.forEach(e=>Object.defineProperty(t,e.name,{enumerable:!0,get(){if(i.current)return a.current[e.name]||(a.current[e.name]=n.clipAction(e,i.current))},configurable:!0})),{ref:i,clips:e,actions:t,names:e.map(e=>e.name),mixer:n}},[e]);return(0,tb.useFrame)((e,t)=>n.update(t)),tC.useEffect(()=>{let e=i.current;return()=>{a.current={},n.stopAllAction(),Object.values(o.actions).forEach(t=>{e&&n.uncacheAction(t,e)})}},[e]),o}var AX=tI,Aq=tI;function f6(e){let t=tC.useRef(null),r=tC.useRef(!1),i=tC.useRef(!1),n=tC.useRef(e);return tC.useLayoutEffect(()=>void(n.current=e),[e]),tC.useEffect(()=>{let e=t.current;if(e){let t=(0,AX.j)(()=>(r.current=!1,!0)),a=e.onBeforeRender;e.onBeforeRender=()=>r.current=!0;let o=(0,Aq.k)(()=>(r.current!==i.current&&(null==n.current||n.current(i.current=r.current)),!0));return()=>{e.onBeforeRender=a,t(),o()}}},[]),t}var o0=tI;let f8=`
#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )
  vec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );
  #ifdef BOX_PROJECTED_ENV_MAP
    vWorldPosition = worldPosition.xyz;
  #endif
#endif
`,f9=`
#ifdef BOX_PROJECTED_ENV_MAP
  uniform vec3 envMapSize;
  uniform vec3 envMapPosition;
  varying vec3 vWorldPosition;
    
  vec3 parallaxCorrectNormal( vec3 v, vec3 cubeSize, vec3 cubePos ) {
    vec3 nDir = normalize( v );
    vec3 rbmax = ( .5 * cubeSize + cubePos - vWorldPosition ) / nDir;
    vec3 rbmin = ( -.5 * cubeSize + cubePos - vWorldPosition ) / nDir;
    vec3 rbminmax;
    rbminmax.x = ( nDir.x > 0. ) ? rbmax.x : rbmin.x;
    rbminmax.y = ( nDir.y > 0. ) ? rbmax.y : rbmin.y;
    rbminmax.z = ( nDir.z > 0. ) ? rbmax.z : rbmin.z;
    float correction = min( min( rbminmax.x, rbminmax.y ), rbminmax.z );
    vec3 boxIntersection = vWorldPosition + nDir * correction;    
    return boxIntersection - cubePos;
  }
#endif
`,f7=`
#ifdef BOX_PROJECTED_ENV_MAP
  worldNormal = parallaxCorrectNormal( worldNormal, envMapSize, envMapPosition );
#endif
`,me=`
#ifdef BOX_PROJECTED_ENV_MAP
  reflectVec = parallaxCorrectNormal( reflectVec, envMapSize, envMapPosition );
#endif
`;function mt(e=new tw.Vector3,t=new tw.Vector3){let[r]=tC.useState(()=>({position:new tw.Vector3,size:new tw.Vector3}));(0,o0.s)(r,{position:e,size:t});let i=tC.useRef(null),n=tC.useMemo(()=>({ref:i,onBeforeCompile:e=>{var t,i;return t=r.position,i=r.size,void(e.defines.BOX_PROJECTED_ENV_MAP=!0,e.uniforms.envMapPosition={value:t},e.uniforms.envMapSize={value:i},e.vertexShader=`
  varying vec3 vWorldPosition;
  ${e.vertexShader.replace("#include <worldpos_vertex>",f8)}`,e.fragmentShader=`
    ${f9}
    ${e.fragmentShader.replace("#include <envmap_physical_pars_fragment>",nw.ShaderChunk.envmap_physical_pars_fragment).replace("vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );",`vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
         ${f7}
         `).replace("reflectVec = inverseTransformDirection( reflectVec, viewMatrix );",`reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
         ${me}
        `)}`)},customProgramCacheKey:()=>JSON.stringify(r.position.toArray())+JSON.stringify(r.size.toArray())}),[...r.position.toArray(),...r.size.toArray()]);return tC.useLayoutEffect(()=>void(i.current.needsUpdate=!0),[r]),n}let mr=new tw.Box3,mi=new tw.Vector3,mn=({anchor:e,...t})=>{let r=tC.useRef(null),i=tC.useRef(null);return tC.useEffect(()=>{var e;null!=(e=r.current)&&null!=(e=e.parent)&&e.parent&&(i.current=r.current.parent,r.current.parent.parent.add(r.current))},[]),(0,tb.useFrame)(()=>{i.current&&(mr.setFromObject(i.current),mr.getSize(mi),r.current.position.set(i.current.position.x+mi.x*(Array.isArray(e)?e[0]:e.x)/2,i.current.position.y+mi.y*(Array.isArray(e)?e[1]:e.y)/2,i.current.position.z+mi.z*(Array.isArray(e)?e[2]:e.z)/2))}),tC.createElement("group",e2({ref:r},t))},ma=e=>Math.sqrt(1-Math.pow(e-1,2));class mo{constructor({size:e=256,maxAge:t=750,radius:r=.3,intensity:i=.2,interpolate:n=0,smoothing:a=0,minForce:o=.3,blend:s="screen",ease:l=ma}={}){this.size=e,this.maxAge=t,this.radius=r,this.intensity=i,this.ease=l,this.interpolate=n,this.smoothing=a,this.minForce=o,this.blend=s,this.trail=[],this.force=0,this.initTexture()}initTexture(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=this.size;let e=this.canvas.getContext("2d");if(null===e)throw Error("2D not available");this.ctx=e,this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.texture=new tw.Texture(this.canvas),this.canvas.id="touchTexture",this.canvas.style.width=this.canvas.style.height=`${this.canvas.width}px`}update(e){this.clear(),this.trail.forEach((t,r)=>{t.age+=1e3*e,t.age>this.maxAge&&this.trail.splice(r,1)}),this.trail.length||(this.force=0),this.trail.forEach(e=>{this.drawTouch(e)}),this.texture.needsUpdate=!0}clear(){this.ctx.globalCompositeOperation="source-over",this.ctx.fillStyle="black",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)}addTouch(e){let t=this.trail[this.trail.length-1];if(t){let r=t.x-e.x,i=t.y-e.y,n=r*r+i*i,a=Math.max(this.minForce,Math.min(1e4*n,1));if(this.force=function(e,t,r=.9){return t*r+e*(1-r)}(a,this.force,this.smoothing),this.interpolate){let e=Math.ceil(n/Math.pow(.5*this.radius/this.interpolate,2));if(e>1)for(let n=1;n<e;n++)this.trail.push({x:t.x-r/e*n,y:t.y-i/e*n,age:0,force:a})}}this.trail.push({x:e.x,y:e.y,age:0,force:this.force})}drawTouch(e){let t={x:e.x*this.size,y:(1-e.y)*this.size},r=1;r=(e.age<.3*this.maxAge?this.ease(e.age/(.3*this.maxAge)):this.ease(1-(e.age-.3*this.maxAge)/(.7*this.maxAge)))*e.force,this.ctx.globalCompositeOperation=this.blend;let i=this.size*this.radius*r,n=this.ctx.createRadialGradient(t.x,t.y,Math.max(0,.25*i),t.x,t.y,Math.max(0,i));n.addColorStop(0,`rgba(255, 255, 255, ${this.intensity})`),n.addColorStop(1,"rgba(0, 0, 0, 0.0)"),this.ctx.beginPath(),this.ctx.fillStyle=n,this.ctx.arc(t.x,t.y,Math.max(0,i),0,2*Math.PI),this.ctx.fill()}}function ms(e={}){let{size:t,maxAge:r,radius:i,intensity:n,interpolate:a,smoothing:o,minForce:s,blend:l,ease:c}=e,h=(0,tC.useMemo)(()=>new mo(e),[t,r,i,n,a,o,s,l,c]);(0,tb.useFrame)((e,t)=>void h.update(t));let u=(0,tC.useCallback)(e=>h.addTouch(e.uv),[h]);return[h.texture,u]}let ml=({children:e,...t})=>{let r=ms(t);return tC.createElement(tC.Fragment,null,null==e?void 0:e(r))},mc=tC.forwardRef(function({children:e,object:t,disable:r,disableX:i,disableY:n,disableZ:a,left:o,right:s,top:l,bottom:c,front:h,back:u,onCentered:A,precise:d=!0,cacheKey:f=0,...m},p){let g=tC.useRef(null),v=tC.useRef(null),y=tC.useRef(null),[x]=tC.useState(()=>new tw.Box3),[E]=tC.useState(()=>new tw.Vector3),[C]=tC.useState(()=>new tw.Sphere);return tC.useLayoutEffect(()=>{v.current.matrixWorld.identity(),x.setFromObject(null!=t?t:y.current,d);let e=x.max.x-x.min.x,f=x.max.y-x.min.y,m=x.max.z-x.min.z;x.getCenter(E),x.getBoundingSphere(C);let p=l?f/2:c?-f/2:0,B=o?-e/2:s?e/2:0,w=h?m/2:u?-m/2:0;v.current.position.set(r||i?0:-E.x+B,r||n?0:-E.y+p,r||a?0:-E.z+w),null==A||A({parent:g.current.parent,container:g.current,width:e,height:f,depth:m,boundingBox:x,boundingSphere:C,center:E,verticalAlignment:p,horizontalAlignment:B,depthAlignment:w})},[f,A,l,o,h,r,i,n,a,t,d,s,c,u,x,E,C]),tC.useImperativeHandle(p,()=>g.current,[]),tC.createElement("group",e2({ref:g},m),tC.createElement("group",{ref:v},tC.createElement("group",{ref:y},e)))}),mh=tC.forwardRef(({font:e,color:t="#cbcbcb",bevelSize:r=.04,debug:i=!1,children:n,...a},o)=>{let[s,l]=tC.useState(0),c=tC.useCallback((e=1)=>l(s+e),[s]),h=tC.useCallback((e=1)=>l(s-e),[s]),u=tC.useMemo(()=>({incr:c,decr:h}),[c,h]);return tC.useImperativeHandle(o,()=>u,[u]),tC.createElement("group",a,tC.createElement(tC.Suspense,{fallback:null},tC.createElement(mc,{top:!0,cacheKey:JSON.stringify({counter:s,font:e})},tC.createElement(oy,{bevelEnabled:!0,bevelSize:r,font:e},i?tC.createElement("meshNormalMaterial",{wireframe:!0}):tC.createElement("meshStandardMaterial",{color:t}),s))),n)});var mu=tw,on=tI;let mA=(e,t)=>{e.updateRanges[0]=t},md=new mu.Matrix4,mf=new mu.Matrix4,mm=[],mp=new mu.Mesh;class mg extends mu.Group{constructor(){super(),this.color=new mu.Color("white"),this.instance={current:void 0},this.instanceKey={current:void 0}}get geometry(){var e;return null==(e=this.instance.current)?void 0:e.geometry}raycast(e,t){let r=this.instance.current;if(!r||!r.geometry||!r.material)return;mp.geometry=r.geometry;let i=r.matrixWorld,n=r.userData.instances.indexOf(this.instanceKey);if(-1!==n&&!(n>r.count)){r.getMatrixAt(n,md),mf.multiplyMatrices(i,md),mp.matrixWorld=mf,r.material instanceof mu.Material?mp.material.side=r.material.side:mp.material.side=r.material[0].side,mp.raycast(e,mm);for(let e=0,r=mm.length;e<r;e++){let r=mm[e];r.instanceId=n,r.object=this,t.push(r)}mm.length=0}}}let mv=tC.createContext(null),my=new mu.Matrix4,mx=new mu.Matrix4,mE=new mu.Matrix4,mC=new mu.Vector3,mB=new mu.Quaternion,mw=new mu.Vector3,mI=tC.forwardRef(({context:e,children:t,...r},i)=>{tC.useMemo(()=>(0,on.e)({PositionMesh:mg}),[]);let n=tC.useRef(null);tC.useImperativeHandle(i,()=>n.current,[]);let{subscribe:a,getParent:o}=tC.useContext(e||mv);return tC.useLayoutEffect(()=>a(n),[]),tC.createElement("positionMesh",e2({instance:o(),instanceKey:n,ref:n},r),t)}),mb=tC.forwardRef(({context:e,children:t,range:r,limit:i=1e3,frames:n=1/0,...a},o)=>{let[{localContext:s,instance:l}]=tC.useState(()=>{let e=tC.createContext(null);return{localContext:e,instance:tC.forwardRef((t,r)=>tC.createElement(mI,e2({context:e},t,{ref:r})))}}),c=tC.useRef(null);tC.useImperativeHandle(o,()=>c.current,[]);let[h,u]=tC.useState([]),[[A,d]]=tC.useState(()=>{let e=new Float32Array(16*i);for(let t=0;t<i;t++)mE.identity().toArray(e,16*t);return[e,new Float32Array([...Array(3*i)].map(()=>1))]});tC.useEffect(()=>{c.current.instanceMatrix.needsUpdate=!0});let f=0,m=0,p=tC.useRef([]);tC.useLayoutEffect(()=>{p.current=Object.entries(c.current.geometry.attributes).filter(([e,t])=>t.isInstancedBufferAttribute)}),(0,tb.useFrame)(()=>{if(n===1/0||f<n){c.current.updateMatrix(),c.current.updateMatrixWorld(),my.copy(c.current.matrixWorld).invert(),m=Math.min(i,void 0!==r?r:i,h.length),c.current.count=m,mA(c.current.instanceMatrix,{start:0,count:16*m}),mA(c.current.instanceColor,{start:0,count:3*m});for(let e=0;e<h.length;e++){let t=h[e].current;t.matrixWorld.decompose(mC,mB,mw),mx.compose(mC,mB,mw).premultiply(my),mx.toArray(A,16*e),c.current.instanceMatrix.needsUpdate=!0,t.color.toArray(d,3*e),c.current.instanceColor.needsUpdate=!0}f++}});let g=tC.useMemo(()=>({getParent:()=>c,subscribe:e=>(u(t=>[...t,e]),()=>u(t=>t.filter(t=>t.current!==e.current)))}),[]);return tC.createElement("instancedMesh",e2({userData:{instances:h,limit:i,frames:n},matrixAutoUpdate:!1,ref:c,args:[null,null,0],raycast:()=>null},a),tC.createElement("instancedBufferAttribute",{attach:"instanceMatrix",args:[A,16],usage:mu.DynamicDrawUsage}),tC.createElement("instancedBufferAttribute",{attach:"instanceColor",args:[d,3],usage:mu.DynamicDrawUsage}),"function"==typeof t?tC.createElement(s.Provider,{value:g},t(l)):e?tC.createElement(e.Provider,{value:g},t):tC.createElement(mv.Provider,{value:g},t))}),m_=tC.forwardRef(function({meshes:e,children:t,...r},i){let n=Array.isArray(e);if(!n)for(let t of Object.keys(e))e[t].isMesh||delete e[t];let a=(n?e:Object.values(e)).map(({geometry:e,material:t})=>tC.createElement(mb,e2({key:e.uuid,geometry:e,material:t},r)));return tC.createElement("group",{ref:i},function e(t,r,i=[]){if(!r[0])return t(i);function n(n){return e(t,r.slice(1),i.concat([n]))}return"function"==typeof r[0]?r[0]({results:i,render:n}):tC.cloneElement(r[0],{children:n})}(r=>n?t(...r):t(Object.keys(e).filter(t=>e[t].isMesh).reduce((e,t,i)=>({...e,[t]:r[i]}),{})),a))});function mM(){let e=tC.createContext(null);return[tC.forwardRef((t,r)=>tC.createElement(mb,e2({ref:r,context:e},t))),tC.forwardRef((t,r)=>tC.createElement(mI,e2({ref:r,context:e},t)))]}let mS=tC.forwardRef(({name:e,defaultValue:t,normalized:r,usage:i=mu.DynamicDrawUsage},n)=>{let a=tC.useRef(null);tC.useImperativeHandle(n,()=>a.current,[]),tC.useLayoutEffect(()=>{let r=a.current.__r3f.parent.object;r.geometry.attributes[e]=a.current;let i=Array.isArray(t)?t:[t],n=Array.from({length:r.userData.limit},()=>i).flat();return a.current.array=new Float32Array(n),a.current.itemSize=i.length,a.current.count=n.length/a.current.itemSize,()=>{delete r.geometry.attributes[e]}},[e]);let o=0;return(0,tb.useFrame)(()=>{let t=a.current.__r3f.parent.object;if(t.userData.frames===1/0||o<t.userData.frames){for(let r=0;r<t.userData.instances.length;r++){let i=t.userData.instances[r].current[e];void 0!==i&&(a.current.set(Array.isArray(i)?i:"function"==typeof i.toArray?i.toArray():[i],r*a.current.itemSize),a.current.needsUpdate=!0)}o++}}),tC.createElement("instancedBufferAttribute",{ref:a,usage:i,normalized:r})}),mT=tC.createContext(null);function mD(){return tC.useContext(mT)}let mF=new tw.PlaneGeometry(1,1),mR=tC.forwardRef(({startFrame:e=0,endFrame:t,fps:r=30,frameName:i="",textureDataURL:n,textureImageURL:a,loop:o=!1,numberOfFrames:s=1,autoPlay:l=!0,animationNames:c,onStart:h,onEnd:u,onLoopEnd:A,onFrame:d,play:f,pause:m=!1,flipX:p=!1,alphaTest:g=0,children:v,asSprite:y=!1,offset:x,playBackwards:E=!1,resetOnEnd:C=!1,maxItems:B=1,instanceItems:w=[[0,0,0]],spriteDataset:I,canvasRenderingContext2DSettings:b,roundFramePosition:_=!1,meshProps:M={},...S},T)=>{let D=tC.useRef(new tw.Group),F=tC.useRef(null),R=tC.useRef(null),P=tC.useRef(null),Q=tC.useRef(window.performance.now()),U=tC.useRef(e),z=tC.useRef(i),k=r>0?1e3/r:0,[L,O]=tC.useState(new tw.Texture),G=tC.useRef(0),[N,H]=tC.useState(new tw.Vector3(1,1,1)),V=p?-1:1,j=tC.useRef(m),J=tC.useRef(x),Y=tC.useRef(!1),{spriteObj:W,loadJsonAndTexture:K}=AY(null,null,c,s,void 0,b),X=tC.useRef(i),q=tC.useCallback((e,t)=>{if(null===t)s&&(G.current=s,E&&(U.current=s-1),F.current=t);else{var r,i;F.current=t,F.current&&Array.isArray(F.current.frames)?G.current=F.current.frames.length:F.current&&"object"==typeof F.current&&X.current?G.current=F.current.frames[X.current].length:G.current=0,E&&(U.current=G.current-1);let{w:n,h:a}=Aj(null!=(r=null==(i=F.current)?void 0:i.frames)?r:[],X.current).sourceSize;H(ee(n,a)),R.current&&(R.current.map=e)}O(e)},[s,E]),Z=tC.useCallback(()=>{if(!F.current)return;let{meta:{size:e},frames:t}=F.current,{w:r,h:n}=Array.isArray(t)?t[0].sourceSize:i&&t[i]?t[i][0].sourceSize:{w:0,h:0};R.current&&R.current.map&&(R.current.map.wrapS=R.current.map.wrapT=tw.RepeatWrapping,R.current.map.center.set(0,0),R.current.map.repeat.set(V/(e.w/r),1/(e.h/n)));let a=(e.h-1)/n;R.current&&R.current.map&&(R.current.map.offset.x=0,R.current.map.offset.y=1-1/a),h&&h({currentFrameName:null!=i?i:"",currentFrame:U.current})},[V,i,h]),$=tC.useMemo(()=>({current:J.current,offset:J.current,imageUrl:a,hasEnded:!1,ref:T}),[a,T]);tC.useImperativeHandle(T,()=>D.current,[]),tC.useLayoutEffect(()=>{J.current=x},[x]);let ee=(e,t)=>{var r;let i=new tw.Vector3;return i.set(1,t/e,1),null==(r=P.current)||r.scale.copy(i),i};tC.useEffect(()=>{if(I){var e;q(null==I||null==(e=I.spriteTexture)?void 0:e.clone(),I.spriteData)}else a&&n&&K(a,n)},[K,I,n,a,q]),tC.useEffect(()=>{if(W){var e;q(null==W||null==(e=W.spriteTexture)?void 0:e.clone(),null==W?void 0:W.spriteData)}},[W,q]),tC.useEffect(()=>{if($.hasEnded=!1,F.current&&!0===E){var e;U.current=(null!=(e=F.current.frames.length)?e:0)-1}else U.current=0},[E,$]),tC.useLayoutEffect(()=>{Z()},[L,p,Z]),tC.useEffect(()=>{l&&(j.current=!1)},[l]),tC.useLayoutEffect(()=>{if(z.current!==i&&i&&(U.current=0,z.current=i,$.hasEnded=!1,k<=0&&(U.current=t||e||0),F.current)){let{w:e,h:t}=Aj(F.current.frames,i).sourceSize;H(ee(e,t))}},[i,k,$,t,e]);let et=(e,t,r,i)=>{var n=void 0===x?$.current:x;let a=U.current,o=0,s=0;ee(e,t);let l=_?Math.round((r.w-1)/e):(r.w-1)/e,c=_?Math.round((r.h-1)/t):(r.h-1)/t;if(!i[a])return;let{frame:{x:h,y:u},sourceSize:{w:A,h:d}}=i[a],f=1/l,m=1/c;if(R.current&&R.current.map&&(o=V>0?h/A*f:h/A*f-R.current.map.repeat.x,s=Math.abs(1-m)-u/d*m,R.current.map.offset.x=o,R.current.map.offset.y=s),null!=n){let e=Math.floor(n*i.length);isNaN(e=Math.max(0,Math.min(e,i.length-1)))&&(e=0),U.current=e}else E?U.current-=1:U.current+=1};return(0,tb.useFrame)((r,n)=>{var a,s;null!=(a=F.current)&&a.frames&&null!=(s=R.current)&&s.map&&!j.current&&!$.hasEnded&&(l||f)&&((()=>{if(!(null!==(d=F.current)&&"meta"in d&&"frames"in d))return;let{meta:{size:r},frames:n}=F.current,{w:a,h:s}=Aj(n,i).sourceSize,l=Array.isArray(n)?n:i?n[i]:[],c=t||l.length-1;var d,f=void 0===x?$.current:x;if(k<=0){U.current=t||e||0,et(a,s,r,l);return}let m=window.performance.now(),p=m-Q.current;if(!(p<=k)){var g=E?U.current<0:U.current>c,v=E?U.current===c:0===U.current,y=E?U.current<0:U.current>=c;if(g){if(U.current=o&&null!=e?e:0,E&&(U.current=c),o?null==A||A({currentFrameName:null!=i?i:"",currentFrame:U.current}):(null==u||u({currentFrameName:null!=i?i:"",currentFrame:U.current}),$.hasEnded=!C,C&&(j.current=!0)),!o)return}else v&&(null==h||h({currentFrameName:null!=i?i:"",currentFrame:U.current}));void 0!==f&&y?!1===Y.current&&(null==u||u({currentFrameName:null!=i?i:"",currentFrame:U.current}),Y.current=!0):Y.current=!1,p<=k||(Q.current=m-p%k,et(a,s,r,l))}})(),null==d||d({currentFrameName:z.current,currentFrame:U.current}))}),tC.createElement("group",e2({},S,{ref:D,scale:function(e=new tw.Vector3(1,1,1),t=1){return"number"==typeof t?e.multiplyScalar(t):Array.isArray(t)?e.multiply(new tw.Vector3(...t)):t instanceof tw.Vector3?e.multiply(t):void 0}(N,S.scale)}),tC.createElement(mT.Provider,{value:$},y&&tC.createElement(nc,null,tC.createElement("mesh",e2({ref:P,scale:1,geometry:mF},M),tC.createElement("meshBasicMaterial",{premultipliedAlpha:!1,toneMapped:!1,side:tw.DoubleSide,ref:R,map:L,transparent:!0,alphaTest:null!=g?g:0}))),!y&&tC.createElement(mb,e2({geometry:mF,limit:null!=B?B:1},M),tC.createElement("meshBasicMaterial",{premultipliedAlpha:!1,toneMapped:!1,side:tw.DoubleSide,ref:R,map:L,transparent:!0,alphaTest:null!=g?g:0}),(null!=w?w:[0]).map((e,t)=>tC.createElement(mI,e2({key:t,ref:(null==w?void 0:w.length)===1?P:null,position:e,scale:1},M)))),v))});var o4=tI,mP=Object.defineProperty,mQ=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?mP(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r,r};let mU=(e,t,r,i,n,a)=>{let{data:o}=e.image,s=4096*a;o[4*t+s+0]=r,o[4*t+s+1]=i,o[4*t+s+2]=n,o[4*t+s+3]=1};class mz{constructor(e,t=1){mQ(this,"curveArray"),mQ(this,"curveLengthArray"),mQ(this,"object3D"),mQ(this,"splineTexure"),mQ(this,"uniforms");const r=e.clone(),i=((e=1)=>{let t=new Float32Array(4096*e*4),r=new tw.DataTexture(t,1024,4*e,tw.RGBAFormat,tw.FloatType);return r.wrapS=tw.RepeatWrapping,r.wrapT=tw.RepeatWrapping,r.magFilter=tw.NearestFilter,r.needsUpdate=!0,r})(t),n={spineTexture:{value:i},pathOffset:{type:"f",value:0},pathSegment:{type:"f",value:1},spineOffset:{type:"f",value:161},spineLength:{type:"f",value:400},flow:{type:"i",value:1}};r.traverse(e=>{(e instanceof tw.Mesh||e instanceof tw.InstancedMesh)&&(e.material=e.material.clone(),function(e,t,r=1){e.__ok||(e.__ok=!0,e.onBeforeCompile=e=>{if(e.__modified)return;e.__modified=!0,Object.assign(e.uniforms,t);let i=`
		uniform sampler2D spineTexture;
		uniform float pathOffset;
		uniform float pathSegment;
		uniform float spineOffset;
		uniform float spineLength;
		uniform int flow;

		float textureLayers = ${4*r}.;
		float textureStacks = 1.;

		${e.vertexShader}
		`.replace("#include <beginnormal_vertex>","").replace("#include <defaultnormal_vertex>","").replace("#include <begin_vertex>","").replace(/void\s*main\s*\(\)\s*\{/,`
        void main() {
        #include <beginnormal_vertex>

        vec4 worldPos = modelMatrix * vec4(position, 1.);

        bool bend = flow > 0;
        float xWeight = bend ? 0. : 1.;

        #ifdef USE_INSTANCING
        float pathOffsetFromInstanceMatrix = instanceMatrix[3][2];
        float spineLengthFromInstanceMatrix = instanceMatrix[3][0];
        float spinePortion = bend ? (worldPos.x + spineOffset) / spineLengthFromInstanceMatrix : 0.;
        float mt = (spinePortion * pathSegment + pathOffset + pathOffsetFromInstanceMatrix)*textureStacks;
        #else
        float spinePortion = bend ? (worldPos.x + spineOffset) / spineLength : 0.;
        float mt = (spinePortion * pathSegment + pathOffset)*textureStacks;
        #endif

        mt = mod(mt, textureStacks);
        float rowOffset = floor(mt);

        #ifdef USE_INSTANCING
        rowOffset += instanceMatrix[3][1] * 4.;
        #endif

        vec3 spinePos = texture2D(spineTexture, vec2(mt, (0. + rowOffset + 0.5) / textureLayers)).xyz;
        vec3 a =        texture2D(spineTexture, vec2(mt, (1. + rowOffset + 0.5) / textureLayers)).xyz;
        vec3 b =        texture2D(spineTexture, vec2(mt, (2. + rowOffset + 0.5) / textureLayers)).xyz;
        vec3 c =        texture2D(spineTexture, vec2(mt, (3. + rowOffset + 0.5) / textureLayers)).xyz;
        mat3 basis = mat3(a, b, c);

        vec3 transformed = basis
          * vec3(worldPos.x * xWeight, worldPos.y * 1., worldPos.z * 1.)
          + spinePos;

        vec3 transformedNormal = normalMatrix * (basis * objectNormal);
			`).replace("#include <project_vertex>",`vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );
				gl_Position = projectionMatrix * mvPosition;`);e.vertexShader=i})}(e.material,n,t))}),this.curveArray=Array(t),this.curveLengthArray=Array(t),this.object3D=r,this.splineTexure=i,this.uniforms=n}updateCurve(e,t){if(e>=this.curveArray.length)throw Error("Index out of range for Flow");let r=t.getLength();this.uniforms.spineLength.value=r,this.curveLengthArray[e]=r,this.curveArray[e]=t,((e,t,r=0)=>{let i=Math.floor(1024);t.arcLengthDivisions=i/2,t.updateArcLengths();let n=t.getSpacedPoints(i),a=t.computeFrenetFrames(i,!0);for(let t=0;t<i;t++){let i=Math.floor(t/1024),o=t%1024,s=n[t];mU(e,o,s.x,s.y,s.z,0+i+4*r),mU(e,o,(s=a.tangents[t]).x,s.y,s.z,1+i+4*r),mU(e,o,(s=a.normals[t]).x,s.y,s.z,2+i+4*r),mU(e,o,(s=a.binormals[t]).x,s.y,s.z,3+i+4*r)}e.needsUpdate=!0})(this.splineTexure,t,e)}moveAlongCurve(e){this.uniforms.pathOffset.value+=e}}let mk=tC.forwardRef(({children:e,curve:t},r)=>{let[i]=tC.useState(()=>new tw.Scene),[n,a]=tC.useState(),o=tC.useRef(null);return tC.useLayoutEffect(()=>{o.current=new mz(i.children[0]),a(o.current.object3D)},[e]),tC.useEffect(()=>{var e;t&&(null==(e=o.current)||e.updateCurve(0,t))},[t]),tC.useImperativeHandle(r,()=>o.current),tC.createElement(tC.Fragment,null,(0,o4.o)(e,i),n&&tC.createElement("primitive",{object:n}))});var mL=tw;class mO extends mL.MeshPhysicalMaterial{constructor(e={}){super(e),this.setValues(e),this._time={value:0},this._distort={value:.4},this._radius={value:1}}onBeforeCompile(e){e.uniforms.time=this._time,e.uniforms.radius=this._radius,e.uniforms.distort=this._distort,e.vertexShader=`
      uniform float time;
      uniform float radius;
      uniform float distort;
      #define GLSLIFY 1
vec3 mod289(vec3 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 mod289(vec4 x){return x-floor(x*(1.0/289.0))*289.0;}vec4 permute(vec4 x){return mod289(((x*34.0)+1.0)*x);}vec4 taylorInvSqrt(vec4 r){return 1.79284291400159-0.85373472095314*r;}float snoise(vec3 v){const vec2 C=vec2(1.0/6.0,1.0/3.0);const vec4 D=vec4(0.0,0.5,1.0,2.0);vec3 i=floor(v+dot(v,C.yyy));vec3 x0=v-i+dot(i,C.xxx);vec3 g=step(x0.yzx,x0.xyz);vec3 l=1.0-g;vec3 i1=min(g.xyz,l.zxy);vec3 i2=max(g.xyz,l.zxy);vec3 x1=x0-i1+C.xxx;vec3 x2=x0-i2+C.yyy;vec3 x3=x0-D.yyy;i=mod289(i);vec4 p=permute(permute(permute(i.z+vec4(0.0,i1.z,i2.z,1.0))+i.y+vec4(0.0,i1.y,i2.y,1.0))+i.x+vec4(0.0,i1.x,i2.x,1.0));float n_=0.142857142857;vec3 ns=n_*D.wyz-D.xzx;vec4 j=p-49.0*floor(p*ns.z*ns.z);vec4 x_=floor(j*ns.z);vec4 y_=floor(j-7.0*x_);vec4 x=x_*ns.x+ns.yyyy;vec4 y=y_*ns.x+ns.yyyy;vec4 h=1.0-abs(x)-abs(y);vec4 b0=vec4(x.xy,y.xy);vec4 b1=vec4(x.zw,y.zw);vec4 s0=floor(b0)*2.0+1.0;vec4 s1=floor(b1)*2.0+1.0;vec4 sh=-step(h,vec4(0.0));vec4 a0=b0.xzyw+s0.xzyw*sh.xxyy;vec4 a1=b1.xzyw+s1.xzyw*sh.zzww;vec3 p0=vec3(a0.xy,h.x);vec3 p1=vec3(a0.zw,h.y);vec3 p2=vec3(a1.xy,h.z);vec3 p3=vec3(a1.zw,h.w);vec4 norm=taylorInvSqrt(vec4(dot(p0,p0),dot(p1,p1),dot(p2,p2),dot(p3,p3)));p0*=norm.x;p1*=norm.y;p2*=norm.z;p3*=norm.w;vec4 m=max(0.6-vec4(dot(x0,x0),dot(x1,x1),dot(x2,x2),dot(x3,x3)),0.0);m=m*m;return 42.0*dot(m*m,vec4(dot(p0,x0),dot(p1,x1),dot(p2,x2),dot(p3,x3)));}
      ${e.vertexShader}
    `,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>",`
        float updateTime = time / 50.0;
        float noise = snoise(vec3(position / 2.0 + updateTime * 5.0));
        vec3 transformed = vec3(position * (noise * pow(distort, 2.0) + radius));
        `)}get time(){return this._time.value}set time(e){this._time.value=e}get distort(){return this._distort.value}set distort(e){this._distort.value=e}get radius(){return this._radius.value}set radius(e){this._radius.value=e}}let mG=tC.forwardRef(({speed:e=1,...t},r)=>{let[i]=tC.useState(()=>new mO);return(0,tb.useFrame)(t=>i&&(i.time=t.clock.elapsedTime*e)),tC.createElement("primitive",e2({object:i,ref:r,attach:"material"},t))});var mN=tw;class mH extends mN.MeshStandardMaterial{constructor(e={}){super(e),this.setValues(e),this._time={value:0},this._factor={value:1}}onBeforeCompile(e){e.uniforms.time=this._time,e.uniforms.factor=this._factor,e.vertexShader=`
      uniform float time;
      uniform float factor;
      ${e.vertexShader}
    `,e.vertexShader=e.vertexShader.replace("#include <begin_vertex>",`float theta = sin( time + position.y ) / 2.0 * factor;
        float c = cos( theta );
        float s = sin( theta );
        mat3 m = mat3( c, 0, s, 0, 1, 0, -s, 0, c );
        vec3 transformed = vec3( position ) * m;
        vNormal = vNormal * m;`)}get time(){return this._time.value}set time(e){this._time.value=e}get factor(){return this._factor.value}set factor(e){this._factor.value=e}}let mV=tC.forwardRef(({speed:e=1,...t},r)=>{let[i]=tC.useState(()=>new mH);return(0,tb.useFrame)(t=>i&&(i.time=t.clock.elapsedTime*e)),tC.createElement("primitive",e2({object:i,ref:r,attach:"material"},t))});var on=tI,tI=tI,mj=tw;class mJ extends mj.ShaderMaterial{constructor(e=new mj.Vector2){super({uniforms:{inputBuffer:new mj.Uniform(null),depthBuffer:new mj.Uniform(null),resolution:new mj.Uniform(new mj.Vector2),texelSize:new mj.Uniform(new mj.Vector2),halfTexelSize:new mj.Uniform(new mj.Vector2),kernel:new mj.Uniform(0),scale:new mj.Uniform(1),cameraNear:new mj.Uniform(0),cameraFar:new mj.Uniform(1),minDepthThreshold:new mj.Uniform(0),maxDepthThreshold:new mj.Uniform(1),depthScale:new mj.Uniform(0),depthToBlurRatioBias:new mj.Uniform(.25)},fragmentShader:`#include <common>
        #include <dithering_pars_fragment>      
        uniform sampler2D inputBuffer;
        uniform sampler2D depthBuffer;
        uniform float cameraNear;
        uniform float cameraFar;
        uniform float minDepthThreshold;
        uniform float maxDepthThreshold;
        uniform float depthScale;
        uniform float depthToBlurRatioBias;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          float depthFactor = 0.0;
          
          #ifdef USE_DEPTH
            vec4 depth = texture2D(depthBuffer, vUv);
            depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));
            depthFactor *= depthScale;
            depthFactor = max(0.0, min(1.0, depthFactor + 0.25));
          #endif
          
          vec4 sum = texture2D(inputBuffer, mix(vUv0, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv1, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv2, vUv, depthFactor));
          sum += texture2D(inputBuffer, mix(vUv3, vUv, depthFactor));
          gl_FragColor = sum * 0.25 ;

          #include <dithering_fragment>
          #include <tonemapping_fragment>
          #include <${oW>=154?"colorspace_fragment":"encodings_fragment"}>
        }`,vertexShader:`uniform vec2 texelSize;
        uniform vec2 halfTexelSize;
        uniform float kernel;
        uniform float scale;
        varying vec2 vUv;
        varying vec2 vUv0;
        varying vec2 vUv1;
        varying vec2 vUv2;
        varying vec2 vUv3;

        void main() {
          vec2 uv = position.xy * 0.5 + 0.5;
          vUv = uv;

          vec2 dUv = (texelSize * vec2(kernel) + halfTexelSize) * scale;
          vUv0 = vec2(uv.x - dUv.x, uv.y + dUv.y);
          vUv1 = vec2(uv.x + dUv.x, uv.y + dUv.y);
          vUv2 = vec2(uv.x + dUv.x, uv.y - dUv.y);
          vUv3 = vec2(uv.x - dUv.x, uv.y - dUv.y);

          gl_Position = vec4(position.xy, 1.0, 1.0);
        }`,blending:mj.NoBlending,depthWrite:!1,depthTest:!1}),this.toneMapped=!1,this.setTexelSize(e.x,e.y),this.kernel=new Float32Array([0,1,2,2,3])}setTexelSize(e,t){this.uniforms.texelSize.value.set(e,t),this.uniforms.halfTexelSize.value.set(e,t).multiplyScalar(.5)}setResolution(e){this.uniforms.resolution.value.copy(e)}}class mY{constructor({gl:e,resolution:t,width:r=500,height:i=500,minDepthThreshold:n=0,maxDepthThreshold:a=1,depthScale:o=0,depthToBlurRatioBias:s=.25}){this.renderToScreen=!1,this.renderTargetA=new tw.WebGLRenderTarget(t,t,{minFilter:tw.LinearFilter,magFilter:tw.LinearFilter,stencilBuffer:!1,depthBuffer:!1,type:tw.HalfFloatType}),this.renderTargetB=this.renderTargetA.clone(),this.convolutionMaterial=new mJ,this.convolutionMaterial.setTexelSize(1/r,1/i),this.convolutionMaterial.setResolution(new tw.Vector2(r,i)),this.scene=new tw.Scene,this.camera=new tw.Camera,this.convolutionMaterial.uniforms.minDepthThreshold.value=n,this.convolutionMaterial.uniforms.maxDepthThreshold.value=a,this.convolutionMaterial.uniforms.depthScale.value=o,this.convolutionMaterial.uniforms.depthToBlurRatioBias.value=s,this.convolutionMaterial.defines.USE_DEPTH=o>0;const l=new Float32Array([-1,-1,0,3,-1,0,-1,3,0]),c=new Float32Array([0,0,2,0,0,2]),h=new tw.BufferGeometry;h.setAttribute("position",new tw.BufferAttribute(l,3)),h.setAttribute("uv",new tw.BufferAttribute(c,2)),this.screen=new tw.Mesh(h,this.convolutionMaterial),this.screen.frustumCulled=!1,this.scene.add(this.screen)}render(e,t,r){let i,n,a,o=this.scene,s=this.camera,l=this.renderTargetA,c=this.renderTargetB,h=this.convolutionMaterial,u=h.uniforms;u.depthBuffer.value=t.depthTexture;let A=h.kernel,d=t;for(n=0,a=A.length-1;n<a;++n)i=(1&n)==0?l:c,u.kernel.value=A[n],u.inputBuffer.value=d.texture,e.setRenderTarget(i),e.render(o,s),d=i;u.kernel.value=A[n],u.inputBuffer.value=d.texture,e.setRenderTarget(this.renderToScreen?null:r),e.render(o,s)}}var mW=tw;class mK extends mW.MeshStandardMaterial{constructor(e={}){super(e),this._tDepth={value:null},this._distortionMap={value:null},this._tDiffuse={value:null},this._tDiffuseBlur={value:null},this._textureMatrix={value:null},this._hasBlur={value:!1},this._mirror={value:0},this._mixBlur={value:0},this._blurStrength={value:.5},this._minDepthThreshold={value:.9},this._maxDepthThreshold={value:1},this._depthScale={value:0},this._depthToBlurRatioBias={value:.25},this._distortion={value:1},this._mixContrast={value:1},this.setValues(e)}onBeforeCompile(e){var t;null!=(t=e.defines)&&t.USE_UV||(e.defines.USE_UV=""),e.uniforms.hasBlur=this._hasBlur,e.uniforms.tDiffuse=this._tDiffuse,e.uniforms.tDepth=this._tDepth,e.uniforms.distortionMap=this._distortionMap,e.uniforms.tDiffuseBlur=this._tDiffuseBlur,e.uniforms.textureMatrix=this._textureMatrix,e.uniforms.mirror=this._mirror,e.uniforms.mixBlur=this._mixBlur,e.uniforms.mixStrength=this._blurStrength,e.uniforms.minDepthThreshold=this._minDepthThreshold,e.uniforms.maxDepthThreshold=this._maxDepthThreshold,e.uniforms.depthScale=this._depthScale,e.uniforms.depthToBlurRatioBias=this._depthToBlurRatioBias,e.uniforms.distortion=this._distortion,e.uniforms.mixContrast=this._mixContrast,e.vertexShader=`
        uniform mat4 textureMatrix;
        varying vec4 my_vUv;
      ${e.vertexShader}`,e.vertexShader=e.vertexShader.replace("#include <project_vertex>",`#include <project_vertex>
        my_vUv = textureMatrix * vec4( position, 1.0 );
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );`),e.fragmentShader=`
        uniform sampler2D tDiffuse;
        uniform sampler2D tDiffuseBlur;
        uniform sampler2D tDepth;
        uniform sampler2D distortionMap;
        uniform float distortion;
        uniform float cameraNear;
			  uniform float cameraFar;
        uniform bool hasBlur;
        uniform float mixBlur;
        uniform float mirror;
        uniform float mixStrength;
        uniform float minDepthThreshold;
        uniform float maxDepthThreshold;
        uniform float mixContrast;
        uniform float depthScale;
        uniform float depthToBlurRatioBias;
        varying vec4 my_vUv;
        ${e.fragmentShader}`,e.fragmentShader=e.fragmentShader.replace("#include <emissivemap_fragment>",`#include <emissivemap_fragment>

      float distortionFactor = 0.0;
      #ifdef USE_DISTORTION
        distortionFactor = texture2D(distortionMap, vUv).r * distortion;
      #endif

      vec4 new_vUv = my_vUv;
      new_vUv.x += distortionFactor;
      new_vUv.y += distortionFactor;

      vec4 base = texture2DProj(tDiffuse, new_vUv);
      vec4 blur = texture2DProj(tDiffuseBlur, new_vUv);

      vec4 merge = base;

      #ifdef USE_NORMALMAP
        vec2 normal_uv = vec2(0.0);
        vec4 normalColor = texture2D(normalMap, vUv * normalScale);
        vec3 my_normal = normalize( vec3( normalColor.r * 2.0 - 1.0, normalColor.b,  normalColor.g * 2.0 - 1.0 ) );
        vec3 coord = new_vUv.xyz / new_vUv.w;
        normal_uv = coord.xy + coord.z * my_normal.xz * 0.05;
        vec4 base_normal = texture2D(tDiffuse, normal_uv);
        vec4 blur_normal = texture2D(tDiffuseBlur, normal_uv);
        merge = base_normal;
        blur = blur_normal;
      #endif

      float depthFactor = 0.0001;
      float blurFactor = 0.0;

      #ifdef USE_DEPTH
        vec4 depth = texture2DProj(tDepth, new_vUv);
        depthFactor = smoothstep(minDepthThreshold, maxDepthThreshold, 1.0-(depth.r * depth.a));
        depthFactor *= depthScale;
        depthFactor = max(0.0001, min(1.0, depthFactor));

        #ifdef USE_BLUR
          blur = blur * min(1.0, depthFactor + depthToBlurRatioBias);
          merge = merge * min(1.0, depthFactor + 0.5);
        #else
          merge = merge * depthFactor;
        #endif

      #endif

      float reflectorRoughnessFactor = roughness;
      #ifdef USE_ROUGHNESSMAP
        vec4 reflectorTexelRoughness = texture2D( roughnessMap, vUv );
        reflectorRoughnessFactor *= reflectorTexelRoughness.g;
      #endif

      #ifdef USE_BLUR
        blurFactor = min(1.0, mixBlur * reflectorRoughnessFactor);
        merge = mix(merge, blur, blurFactor);
      #endif

      vec4 newMerge = vec4(0.0, 0.0, 0.0, 1.0);
      newMerge.r = (merge.r - 0.5) * mixContrast + 0.5;
      newMerge.g = (merge.g - 0.5) * mixContrast + 0.5;
      newMerge.b = (merge.b - 0.5) * mixContrast + 0.5;

      diffuseColor.rgb = diffuseColor.rgb * ((1.0 - min(1.0, mirror)) + newMerge.rgb * mixStrength);
      `)}get tDiffuse(){return this._tDiffuse.value}set tDiffuse(e){this._tDiffuse.value=e}get tDepth(){return this._tDepth.value}set tDepth(e){this._tDepth.value=e}get distortionMap(){return this._distortionMap.value}set distortionMap(e){this._distortionMap.value=e}get tDiffuseBlur(){return this._tDiffuseBlur.value}set tDiffuseBlur(e){this._tDiffuseBlur.value=e}get textureMatrix(){return this._textureMatrix.value}set textureMatrix(e){this._textureMatrix.value=e}get hasBlur(){return this._hasBlur.value}set hasBlur(e){this._hasBlur.value=e}get mirror(){return this._mirror.value}set mirror(e){this._mirror.value=e}get mixBlur(){return this._mixBlur.value}set mixBlur(e){this._mixBlur.value=e}get mixStrength(){return this._blurStrength.value}set mixStrength(e){this._blurStrength.value=e}get minDepthThreshold(){return this._minDepthThreshold.value}set minDepthThreshold(e){this._minDepthThreshold.value=e}get maxDepthThreshold(){return this._maxDepthThreshold.value}set maxDepthThreshold(e){this._maxDepthThreshold.value=e}get depthScale(){return this._depthScale.value}set depthScale(e){this._depthScale.value=e}get depthToBlurRatioBias(){return this._depthToBlurRatioBias.value}set depthToBlurRatioBias(e){this._depthToBlurRatioBias.value=e}get distortion(){return this._distortion.value}set distortion(e){this._distortion.value=e}get mixContrast(){return this._mixContrast.value}set mixContrast(e){this._mixContrast.value=e}}let mX=tC.forwardRef(({mixBlur:e=0,mixStrength:t=1,resolution:r=256,blur:i=[0,0],minDepthThreshold:n=.9,maxDepthThreshold:a=1,depthScale:o=0,depthToBlurRatioBias:s=.25,mirror:l=0,distortion:c=1,mixContrast:h=1,distortionMap:u,reflectorOffset:A=0,...d},f)=>{(0,on.e)({MeshReflectorMaterialImpl:mK});let m=(0,tI.C)(({gl:e})=>e),p=(0,tI.C)(({camera:e})=>e),g=(0,tI.C)(({scene:e})=>e),v=(i=Array.isArray(i)?i:[i,i])[0]+i[1]>0,y=i[0],x=i[1],E=tC.useRef(null);tC.useImperativeHandle(f,()=>E.current,[]);let[C]=tC.useState(()=>new tw.Plane),[B]=tC.useState(()=>new tw.Vector3),[w]=tC.useState(()=>new tw.Vector3),[I]=tC.useState(()=>new tw.Vector3),[b]=tC.useState(()=>new tw.Matrix4),[_]=tC.useState(()=>new tw.Vector3(0,0,-1)),[M]=tC.useState(()=>new tw.Vector4),[S]=tC.useState(()=>new tw.Vector3),[T]=tC.useState(()=>new tw.Vector3),[D]=tC.useState(()=>new tw.Vector4),[F]=tC.useState(()=>new tw.Matrix4),[R]=tC.useState(()=>new tw.PerspectiveCamera),P=tC.useCallback(()=>{var e;let t=E.current.parent||(null==(e=E.current)||null==(e=e.__r3f.parent)?void 0:e.object);if(!t||(w.setFromMatrixPosition(t.matrixWorld),I.setFromMatrixPosition(p.matrixWorld),b.extractRotation(t.matrixWorld),B.set(0,0,1),B.applyMatrix4(b),w.addScaledVector(B,A),S.subVectors(w,I),S.dot(B)>0))return;S.reflect(B).negate(),S.add(w),b.extractRotation(p.matrixWorld),_.set(0,0,-1),_.applyMatrix4(b),_.add(I),T.subVectors(w,_),T.reflect(B).negate(),T.add(w),R.position.copy(S),R.up.set(0,1,0),R.up.applyMatrix4(b),R.up.reflect(B),R.lookAt(T),R.far=p.far,R.updateMatrixWorld(),R.projectionMatrix.copy(p.projectionMatrix),F.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),F.multiply(R.projectionMatrix),F.multiply(R.matrixWorldInverse),F.multiply(t.matrixWorld),C.setFromNormalAndCoplanarPoint(B,w),C.applyMatrix4(R.matrixWorldInverse),M.set(C.normal.x,C.normal.y,C.normal.z,C.constant);let r=R.projectionMatrix;D.x=(Math.sign(M.x)+r.elements[8])/r.elements[0],D.y=(Math.sign(M.y)+r.elements[9])/r.elements[5],D.z=-1,D.w=(1+r.elements[10])/r.elements[14],M.multiplyScalar(2/M.dot(D)),r.elements[2]=M.x,r.elements[6]=M.y,r.elements[10]=M.z+1,r.elements[14]=M.w},[p,A]),[Q,U,z,k]=tC.useMemo(()=>{let i={minFilter:tw.LinearFilter,magFilter:tw.LinearFilter,type:tw.HalfFloatType},A=new tw.WebGLRenderTarget(r,r,i);A.depthBuffer=!0,A.depthTexture=new tw.DepthTexture(r,r),A.depthTexture.format=tw.DepthFormat,A.depthTexture.type=tw.UnsignedShortType;let d=new tw.WebGLRenderTarget(r,r,i),f=new mY({gl:m,resolution:r,width:y,height:x,minDepthThreshold:n,maxDepthThreshold:a,depthScale:o,depthToBlurRatioBias:s}),p={mirror:l,textureMatrix:F,mixBlur:e,tDiffuse:A.texture,tDepth:A.depthTexture,tDiffuseBlur:d.texture,hasBlur:v,mixStrength:t,minDepthThreshold:n,maxDepthThreshold:a,depthScale:o,depthToBlurRatioBias:s,distortion:c,distortionMap:u,mixContrast:h,"defines-USE_BLUR":v?"":void 0,"defines-USE_DEPTH":o>0?"":void 0,"defines-USE_DISTORTION":u?"":void 0};return[A,d,f,p]},[m,y,x,F,r,l,v,e,t,n,a,o,s,c,u,h]);return(0,tb.useFrame)(()=>{var e;let t=E.current.parent||(null==(e=E.current)||null==(e=e.__r3f.parent)?void 0:e.object);if(!t)return;t.visible=!1;let r=m.xr.enabled,i=m.shadowMap.autoUpdate;P(),m.xr.enabled=!1,m.shadowMap.autoUpdate=!1,m.setRenderTarget(Q),m.state.buffers.depth.setMask(!0),m.autoClear||m.clear(),m.render(g,R),v&&z.render(m,Q,U),m.xr.enabled=r,m.shadowMap.autoUpdate=i,t.visible=!0,m.setRenderTarget(null)}),tC.createElement("meshReflectorMaterialImpl",e2({attach:"material",key:"key"+k["defines-USE_BLUR"]+k["defines-USE_DEPTH"]+k["defines-USE_DISTORTION"],ref:E},k,d))});var on=tI,tI=tI,mq=tw;function mZ(e){switch(e){case 1:return mq.RedIntegerFormat;case 2:return mq.RGIntegerFormat;case 3:case 4:return mq.RGBAIntegerFormat}}class m$ extends mq.DataTexture{constructor(){super(),this.minFilter=mq.NearestFilter,this.magFilter=mq.NearestFilter,this.generateMipmaps=!1,this.overrideItemSize=null,this._forcedType=null}updateFrom(e){let t,r,i,n,a=this.overrideItemSize,o=e.itemSize,s=e.count;if(null!==a){if(o*s%a!=0)throw Error("VertexAttributeTexture: overrideItemSize must divide evenly into buffer length.");e.itemSize=a,e.count=s*o/a}let l=e.itemSize,c=e.count,h=e.normalized,u=e.array.constructor,A=u.BYTES_PER_ELEMENT,d=this._forcedType,f=l;if(null===d)switch(u){case Float32Array:d=mq.FloatType;break;case Uint8Array:case Uint16Array:case Uint32Array:d=mq.UnsignedIntType;break;case Int8Array:case Int16Array:case Int32Array:d=mq.IntType}let m=function(e){switch(e){case 1:return"R";case 2:return"RG";case 3:case 4:return"RGBA"}throw Error()}(l);switch(d){case mq.FloatType:i=1,r=function(e){switch(e){case 1:return mq.RedFormat;case 2:return mq.RGFormat;case 3:case 4:return mq.RGBAFormat}}(l),h&&1===A?(n=u,m+="8",u===Uint8Array?t=mq.UnsignedByteType:(t=mq.ByteType,m+="_SNORM")):(n=Float32Array,m+="32F",t=mq.FloatType);break;case mq.IntType:m+=8*A+"I",i=h?Math.pow(2,8*u.BYTES_PER_ELEMENT-1):1,r=mZ(l),1===A?(n=Int8Array,t=mq.ByteType):2===A?(n=Int16Array,t=mq.ShortType):(n=Int32Array,t=mq.IntType);break;case mq.UnsignedIntType:m+=8*A+"UI",i=h?Math.pow(2,8*u.BYTES_PER_ELEMENT-1):1,r=mZ(l),1===A?(n=Uint8Array,t=mq.UnsignedByteType):2===A?(n=Uint16Array,t=mq.UnsignedShortType):(n=Uint32Array,t=mq.UnsignedIntType)}3===f&&(r===mq.RGBAFormat||r===mq.RGBAIntegerFormat)&&(f=4);let p=Math.ceil(Math.sqrt(c))||1,g=new n(f*p*p),v=e.normalized;e.normalized=!1;for(let t=0;t<c;t++){let r=f*t;g[r]=e.getX(t)/i,l>=2&&(g[r+1]=e.getY(t)/i),l>=3&&(g[r+2]=e.getZ(t)/i,4===f&&(g[r+3]=1)),l>=4&&(g[r+3]=e.getW(t)/i)}e.normalized=v,this.internalFormat=m,this.format=r,this.type=t,this.image.width=p,this.image.height=p,this.image.data=g,this.needsUpdate=!0,this.dispose(),e.itemSize=o,e.count=s}}class m1 extends m${constructor(){super(),this._forcedType=mq.UnsignedIntType}}class m0 extends m${constructor(){super(),this._forcedType=mq.FloatType}}class m2{constructor(){this.index=new m1,this.position=new m0,this.bvhBounds=new tw.DataTexture,this.bvhContents=new tw.DataTexture,this._cachedIndexAttr=null,this.index.overrideItemSize=3}updateFrom(e){let{geometry:t}=e;if(function(e,t,r){let i=e._roots;if(1!==i.length)throw Error("MeshBVHUniformStruct: Multi-root BVHs not supported.");let n=i[0],a=new Uint16Array(n),o=new Uint32Array(n),s=new Float32Array(n),l=n.byteLength/32,c=2*Math.ceil(Math.sqrt(l/2)),h=new Float32Array(4*c*c),u=Math.ceil(Math.sqrt(l)),A=new Uint32Array(2*u*u);for(let e=0;e<l;e++){let t=32*e/4,r=2*t;for(let r=0;r<3;r++)h[8*e+0+r]=s[t+0+r],h[8*e+4+r]=s[t+3+r];if(dM(r,a)){let i=dS(r,a),n=o[t+6],s=0xffff0000|i;A[2*e+0]=s,A[2*e+1]=n}else{let r=4*o[t+6]/32,i=o[t+7];A[2*e+0]=i,A[2*e+1]=r}}t.image.data=h,t.image.width=c,t.image.height=c,t.format=tw.RGBAFormat,t.type=tw.FloatType,t.internalFormat="RGBA32F",t.minFilter=tw.NearestFilter,t.magFilter=tw.NearestFilter,t.generateMipmaps=!1,t.needsUpdate=!0,t.dispose(),r.image.data=A,r.image.width=u,r.image.height=u,r.format=tw.RGIntegerFormat,r.type=tw.UnsignedIntType,r.internalFormat="RG32UI",r.minFilter=tw.NearestFilter,r.magFilter=tw.NearestFilter,r.generateMipmaps=!1,r.needsUpdate=!0,r.dispose()}(e,this.bvhBounds,this.bvhContents),this.position.updateFrom(t.attributes.position),e.indirect){let r=e._indirectBuffer;if(null===this._cachedIndexAttr||this._cachedIndexAttr.count!==r.length)if(t.index)this._cachedIndexAttr=t.index.clone();else{let e=dd(du(t));this._cachedIndexAttr=new tw.BufferAttribute(e,1,!1)}(function(e,t,r){let i=r.array,n=e.index?e.index.array:null;for(let e=0,r=t.length;e<r;e++){let r=3*e,a=3*t[e];for(let e=0;e<3;e++)i[r+e]=n?n[a+e]:a+e}})(t,r,this._cachedIndexAttr),this.index.updateFrom(this._cachedIndexAttr)}else this.index.updateFrom(t.index)}dispose(){let{index:e,position:t,bvhBounds:r,bvhContents:i}=this;e&&e.dispose(),t&&t.dispose(),r&&r.dispose(),i&&i.dispose()}}let m3=`
struct BVH {

	usampler2D index;
	sampler2D position;

	sampler2D bvhBounds;
	usampler2D bvhContents;

};
`,m4=`

// A stack of uint32 indices can can store the indices for
// a perfectly balanced tree with a depth up to 31. Lower stack
// depth gets higher performance.
//
// However not all trees are balanced. Best value to set this to
// is the trees max depth.
#ifndef BVH_STACK_DEPTH
#define BVH_STACK_DEPTH 60
#endif

#ifndef INFINITY
#define INFINITY 1e20
#endif

// Utilities
uvec4 uTexelFetch1D( usampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

ivec4 iTexelFetch1D( isampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 texelFetch1D( sampler2D tex, uint index ) {

	uint width = uint( textureSize( tex, 0 ).x );
	uvec2 uv;
	uv.x = index % width;
	uv.y = index / width;

	return texelFetch( tex, ivec2( uv ), 0 );

}

vec4 textureSampleBarycoord( sampler2D tex, vec3 barycoord, uvec3 faceIndices ) {

	return
		barycoord.x * texelFetch1D( tex, faceIndices.x ) +
		barycoord.y * texelFetch1D( tex, faceIndices.y ) +
		barycoord.z * texelFetch1D( tex, faceIndices.z );

}

void ndcToCameraRay(
	vec2 coord, mat4 cameraWorld, mat4 invProjectionMatrix,
	out vec3 rayOrigin, out vec3 rayDirection
) {

	// get camera look direction and near plane for camera clipping
	vec4 lookDirection = cameraWorld * vec4( 0.0, 0.0, - 1.0, 0.0 );
	vec4 nearVector = invProjectionMatrix * vec4( 0.0, 0.0, - 1.0, 1.0 );
	float near = abs( nearVector.z / nearVector.w );

	// get the camera direction and position from camera matrices
	vec4 origin = cameraWorld * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec4 direction = invProjectionMatrix * vec4( coord, 0.5, 1.0 );
	direction /= direction.w;
	direction = cameraWorld * direction - origin;

	// slide the origin along the ray until it sits at the near clip plane position
	origin.xyz += direction.xyz * near / dot( direction, lookDirection );

	rayOrigin = origin.xyz;
	rayDirection = direction.xyz;

}
`,m5=`

#ifndef TRI_INTERSECT_EPSILON
#define TRI_INTERSECT_EPSILON 1e-5
#endif

// Raycasting
bool intersectsBounds( vec3 rayOrigin, vec3 rayDirection, vec3 boundsMin, vec3 boundsMax, out float dist ) {

	// https://www.reddit.com/r/opengl/comments/8ntzz5/fast_glsl_ray_box_intersection/
	// https://tavianator.com/2011/ray_box.html
	vec3 invDir = 1.0 / rayDirection;

	// find intersection distances for each plane
	vec3 tMinPlane = invDir * ( boundsMin - rayOrigin );
	vec3 tMaxPlane = invDir * ( boundsMax - rayOrigin );

	// get the min and max distances from each intersection
	vec3 tMinHit = min( tMaxPlane, tMinPlane );
	vec3 tMaxHit = max( tMaxPlane, tMinPlane );

	// get the furthest hit distance
	vec2 t = max( tMinHit.xx, tMinHit.yz );
	float t0 = max( t.x, t.y );

	// get the minimum hit distance
	t = min( tMaxHit.xx, tMaxHit.yz );
	float t1 = min( t.x, t.y );

	// set distance to 0.0 if the ray starts inside the box
	dist = max( t0, 0.0 );

	return t1 >= dist;

}

bool intersectsTriangle(
	vec3 rayOrigin, vec3 rayDirection, vec3 a, vec3 b, vec3 c,
	out vec3 barycoord, out vec3 norm, out float dist, out float side
) {

	// https://stackoverflow.com/questions/42740765/intersection-between-line-and-triangle-in-3d
	vec3 edge1 = b - a;
	vec3 edge2 = c - a;
	norm = cross( edge1, edge2 );

	float det = - dot( rayDirection, norm );
	float invdet = 1.0 / det;

	vec3 AO = rayOrigin - a;
	vec3 DAO = cross( AO, rayDirection );

	vec4 uvt;
	uvt.x = dot( edge2, DAO ) * invdet;
	uvt.y = - dot( edge1, DAO ) * invdet;
	uvt.z = dot( AO, norm ) * invdet;
	uvt.w = 1.0 - uvt.x - uvt.y;

	// set the hit information
	barycoord = uvt.wxy; // arranged in A, B, C order
	dist = uvt.z;
	side = sign( det );
	norm = side * normalize( norm );

	// add an epsilon to avoid misses between triangles
	uvt += vec4( TRI_INTERSECT_EPSILON );

	return all( greaterThanEqual( uvt, vec4( 0.0 ) ) );

}

bool intersectTriangles(
	// geometry info and triangle range
	sampler2D positionAttr, usampler2D indexAttr, uint offset, uint count,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// outputs
	inout float minDistance, inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	bool found = false;
	vec3 localBarycoord, localNormal;
	float localDist, localSide;
	for ( uint i = offset, l = offset + count; i < l; i ++ ) {

		uvec3 indices = uTexelFetch1D( indexAttr, i ).xyz;
		vec3 a = texelFetch1D( positionAttr, indices.x ).rgb;
		vec3 b = texelFetch1D( positionAttr, indices.y ).rgb;
		vec3 c = texelFetch1D( positionAttr, indices.z ).rgb;

		if (
			intersectsTriangle( rayOrigin, rayDirection, a, b, c, localBarycoord, localNormal, localDist, localSide )
			&& localDist < minDistance
		) {

			found = true;
			minDistance = localDist;

			faceIndices = uvec4( indices.xyz, i );
			faceNormal = localNormal;

			side = localSide;
			barycoord = localBarycoord;
			dist = localDist;

		}

	}

	return found;

}

bool intersectsBVHNodeBounds( vec3 rayOrigin, vec3 rayDirection, sampler2D bvhBounds, uint currNodeIndex, out float dist ) {

	uint cni2 = currNodeIndex * 2u;
	vec3 boundsMin = texelFetch1D( bvhBounds, cni2 ).xyz;
	vec3 boundsMax = texelFetch1D( bvhBounds, cni2 + 1u ).xyz;
	return intersectsBounds( rayOrigin, rayDirection, boundsMin, boundsMax, dist );

}

// use a macro to hide the fact that we need to expand the struct into separate fields
#define\
	bvhIntersectFirstHit(\
		bvh,\
		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist\
	)\
	_bvhIntersectFirstHit(\
		bvh.position, bvh.index, bvh.bvhBounds, bvh.bvhContents,\
		rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist\
	)

bool _bvhIntersectFirstHit(
	// bvh info
	sampler2D bvh_position, usampler2D bvh_index, sampler2D bvh_bvhBounds, usampler2D bvh_bvhContents,

	// ray
	vec3 rayOrigin, vec3 rayDirection,

	// output variables split into separate variables due to output precision
	inout uvec4 faceIndices, inout vec3 faceNormal, inout vec3 barycoord,
	inout float side, inout float dist
) {

	// stack needs to be twice as long as the deepest tree we expect because
	// we push both the left and right child onto the stack every traversal
	int ptr = 0;
	uint stack[ BVH_STACK_DEPTH ];
	stack[ 0 ] = 0u;

	float triangleDistance = INFINITY;
	bool found = false;
	while ( ptr > - 1 && ptr < BVH_STACK_DEPTH ) {

		uint currNodeIndex = stack[ ptr ];
		ptr --;

		// check if we intersect the current bounds
		float boundsHitDistance;
		if (
			! intersectsBVHNodeBounds( rayOrigin, rayDirection, bvh_bvhBounds, currNodeIndex, boundsHitDistance )
			|| boundsHitDistance > triangleDistance
		) {

			continue;

		}

		uvec2 boundsInfo = uTexelFetch1D( bvh_bvhContents, currNodeIndex ).xy;
		bool isLeaf = bool( boundsInfo.x & 0xffff0000u );

		if ( isLeaf ) {

			uint count = boundsInfo.x & 0x0000ffffu;
			uint offset = boundsInfo.y;

			found = intersectTriangles(
				bvh_position, bvh_index, offset, count,
				rayOrigin, rayDirection, triangleDistance,
				faceIndices, faceNormal, barycoord, side, dist
			) || found;

		} else {

			uint leftIndex = currNodeIndex + 1u;
			uint splitAxis = boundsInfo.x & 0x0000ffffu;
			uint rightIndex = boundsInfo.y;

			bool leftToRight = rayDirection[ splitAxis ] >= 0.0;
			uint c1 = leftToRight ? leftIndex : rightIndex;
			uint c2 = leftToRight ? rightIndex : leftIndex;

			// set c2 in the stack so we traverse it later. We need to keep track of a pointer in
			// the stack while we traverse. The second pointer added is the one that will be
			// traversed first
			ptr ++;
			stack[ ptr ] = c2;

			ptr ++;
			stack[ ptr ] = c1;

		}

	}

	return found;

}
`,m6=`
	${m4}
	${m5}
`,m8=oV({envMap:null,bounces:3,ior:2.4,correctMips:!0,aberrationStrength:.01,fresnel:0,bvh:new m2,color:new tw.Color("white"),opacity:1,resolution:new tw.Vector2,viewMatrixInverse:new tw.Matrix4,projectionMatrixInverse:new tw.Matrix4},`
  uniform mat4 viewMatrixInverse;

  varying vec3 vWorldPosition;
  varying vec3 vNormal;
  varying mat4 vModelMatrixInverse;

  #include <color_pars_vertex>

  void main() {
    #include <color_vertex>

    vec4 transformedNormal = vec4(normal, 0.0);
    vec4 transformedPosition = vec4(position, 1.0);
    #ifdef USE_INSTANCING
      transformedNormal = instanceMatrix * transformedNormal;
      transformedPosition = instanceMatrix * transformedPosition;
    #endif

    #ifdef USE_INSTANCING
      vModelMatrixInverse = inverse(modelMatrix * instanceMatrix);
    #else
      vModelMatrixInverse = inverse(modelMatrix);
    #endif

    vWorldPosition = (modelMatrix * transformedPosition).xyz;
    vNormal = normalize((viewMatrixInverse * vec4(normalMatrix * transformedNormal.xyz, 0.0)).xyz);
    gl_Position = projectionMatrix * viewMatrix * modelMatrix * transformedPosition;
  }`,`
  #define ENVMAP_TYPE_CUBE_UV
  precision highp isampler2D;
  precision highp usampler2D;
  varying vec3 vWorldPosition;
  varying vec3 vNormal;
  varying mat4 vModelMatrixInverse;

  #include <color_pars_fragment>

  #ifdef ENVMAP_TYPE_CUBEM
    uniform samplerCube envMap;
  #else
    uniform sampler2D envMap;
  #endif

  uniform float bounces;
  ${m3}
  ${m6}
  uniform BVH bvh;
  uniform float ior;
  uniform bool correctMips;
  uniform vec2 resolution;
  uniform float fresnel;
  uniform mat4 modelMatrix;
  uniform mat4 projectionMatrixInverse;
  uniform mat4 viewMatrixInverse;
  uniform float aberrationStrength;
  uniform vec3 color;
  uniform float opacity;

  float fresnelFunc(vec3 viewDirection, vec3 worldNormal) {
    return pow( 1.0 + dot( viewDirection, worldNormal), 10.0 );
  }

  vec3 totalInternalReflection(vec3 ro, vec3 rd, vec3 normal, float ior, mat4 modelMatrixInverse) {
    vec3 rayOrigin = ro;
    vec3 rayDirection = rd;
    rayDirection = refract(rayDirection, normal, 1.0 / ior);
    rayOrigin = vWorldPosition + rayDirection * 0.001;
    rayOrigin = (modelMatrixInverse * vec4(rayOrigin, 1.0)).xyz;
    rayDirection = normalize((modelMatrixInverse * vec4(rayDirection, 0.0)).xyz);
    for(float i = 0.0; i < bounces; i++) {
      uvec4 faceIndices = uvec4( 0u );
      vec3 faceNormal = vec3( 0.0, 0.0, 1.0 );
      vec3 barycoord = vec3( 0.0 );
      float side = 1.0;
      float dist = 0.0;
      bvhIntersectFirstHit( bvh, rayOrigin, rayDirection, faceIndices, faceNormal, barycoord, side, dist );
      vec3 hitPos = rayOrigin + rayDirection * max(dist - 0.001, 0.0);
      vec3 tempDir = refract(rayDirection, faceNormal, ior);
      if (length(tempDir) != 0.0) {
        rayDirection = tempDir;
        break;
      }
      rayDirection = reflect(rayDirection, faceNormal);
      rayOrigin = hitPos + rayDirection * 0.01;
    }
    rayDirection = normalize((modelMatrix * vec4(rayDirection, 0.0)).xyz);
    return rayDirection;
  }

  #include <common>
  #include <cube_uv_reflection_fragment>

  #ifdef ENVMAP_TYPE_CUBEM
    vec4 textureGradient(samplerCube envMap, vec3 rayDirection, vec3 directionCamPerfect) {
      return textureGrad(envMap, rayDirection, dFdx(correctMips ? directionCamPerfect: rayDirection), dFdy(correctMips ? directionCamPerfect: rayDirection));
    }
  #else
    vec4 textureGradient(sampler2D envMap, vec3 rayDirection, vec3 directionCamPerfect) {
      vec2 uvv = equirectUv( rayDirection );
      vec2 smoothUv = equirectUv( directionCamPerfect );
      return textureGrad(envMap, uvv, dFdx(correctMips ? smoothUv : uvv), dFdy(correctMips ? smoothUv : uvv));
    }
  #endif

  void main() {
    vec2 uv = gl_FragCoord.xy / resolution;
    vec3 directionCamPerfect = (projectionMatrixInverse * vec4(uv * 2.0 - 1.0, 0.0, 1.0)).xyz;
    directionCamPerfect = (viewMatrixInverse * vec4(directionCamPerfect, 0.0)).xyz;
    directionCamPerfect = normalize(directionCamPerfect);
    vec3 normal = vNormal;
    vec3 rayOrigin = cameraPosition;
    vec3 rayDirection = normalize(vWorldPosition - cameraPosition);

    vec4 diffuseColor = vec4(color, opacity);
    #include <color_fragment>

    #ifdef CHROMATIC_ABERRATIONS
      vec3 rayDirectionG = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior, 1.0), vModelMatrixInverse);
      #ifdef FAST_CHROMA
        vec3 rayDirectionR = normalize(rayDirectionG + 1.0 * vec3(aberrationStrength / 2.0));
        vec3 rayDirectionB = normalize(rayDirectionG - 1.0 * vec3(aberrationStrength / 2.0));
      #else
        vec3 rayDirectionR = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior * (1.0 - aberrationStrength), 1.0), vModelMatrixInverse);
        vec3 rayDirectionB = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior * (1.0 + aberrationStrength), 1.0), vModelMatrixInverse);
      #endif
      float finalColorR = textureGradient(envMap, rayDirectionR, directionCamPerfect).r;
      float finalColorG = textureGradient(envMap, rayDirectionG, directionCamPerfect).g;
      float finalColorB = textureGradient(envMap, rayDirectionB, directionCamPerfect).b;
      diffuseColor.rgb *= vec3(finalColorR, finalColorG, finalColorB);
    #else
      rayDirection = totalInternalReflection(rayOrigin, rayDirection, normal, max(ior, 1.0), vModelMatrixInverse);
      diffuseColor.rgb *= textureGradient(envMap, rayDirection, directionCamPerfect).rgb;
    #endif

    vec3 viewDirection = normalize(vWorldPosition - cameraPosition);
    float nFresnel = fresnelFunc(viewDirection, normal) * fresnel;
    gl_FragColor = vec4(mix(diffuseColor.rgb, vec3(1.0), nFresnel), diffuseColor.a);

    #include <tonemapping_fragment>
    #include <${oW>=154?"colorspace_fragment":"encodings_fragment"}>
  }`);function m9({aberrationStrength:e=0,fastChroma:t=!0,envMap:r,...i}){(0,on.e)({MeshRefractionMaterial:m8});let n=(0,tC.useRef)(null),{size:a}=(0,tI.C)(),o=(0,tC.useMemo)(()=>{var i,n;let a={},o=r&&r.isCubeTexture,s=Math.floor(Math.log2((null!=(i=o?null==(n=r.image[0])?void 0:n.width:r.image.width)?i:1024)/4)),l=Math.pow(2,s),c=3*Math.max(l,112);return o&&(a.ENVMAP_TYPE_CUBEM=""),a.CUBEUV_TEXEL_WIDTH=`${1/c}`,a.CUBEUV_TEXEL_HEIGHT=`${1/(4*l)}`,a.CUBEUV_MAX_MIP=`${s}.0`,e>0&&(a.CHROMATIC_ABERRATIONS=""),t&&(a.FAST_CHROMA=""),a},[e,t]);return(0,tC.useLayoutEffect)(()=>{var e;let t=null==(e=n.current)||null==(e=e.__r3f)||null==(e=e.parent)||null==(e=e.object)?void 0:e.geometry;t&&(n.current.bvh=new m2,n.current.bvh.updateFrom(new fN(t.clone().toNonIndexed(),{strategy:dl})))},[]),(0,tb.useFrame)(({camera:e})=>{n.current.viewMatrixInverse=e.matrixWorld,n.current.projectionMatrixInverse=e.projectionMatrixInverse}),tC.createElement("meshRefractionMaterial",e2({key:JSON.stringify(o),defines:o,ref:n,resolution:[a.width,a.height],aberrationStrength:e,envMap:r},i))}var m7=tw,on=tI;let pe=oV({},"void main() { }","void main() { gl_FragColor = vec4(0.0, 0.0, 0.0, 0.0); discard;  }");class pt extends m7.MeshPhysicalMaterial{constructor(e=6,t=!1){super(),this.uniforms={chromaticAberration:{value:.05},transmission:{value:0},_transmission:{value:1},transmissionMap:{value:null},roughness:{value:0},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:1/0},attenuationColor:{value:new m7.Color("white")},anisotropicBlur:{value:.1},time:{value:0},distortion:{value:0},distortionScale:{value:.5},temporalDistortion:{value:0},buffer:{value:null}},this.onBeforeCompile=r=>{r.uniforms={...r.uniforms,...this.uniforms},this.anisotropy>0&&(r.defines.USE_ANISOTROPY=""),t?r.defines.USE_SAMPLER="":r.defines.USE_TRANSMISSION="",r.fragmentShader=`
      uniform float chromaticAberration;         
      uniform float anisotropicBlur;      
      uniform float time;
      uniform float distortion;
      uniform float distortionScale;
      uniform float temporalDistortion;
      uniform sampler2D buffer;

      vec3 random3(vec3 c) {
        float j = 4096.0*sin(dot(c,vec3(17.0, 59.4, 15.0)));
        vec3 r;
        r.z = fract(512.0*j);
        j *= .125;
        r.x = fract(512.0*j);
        j *= .125;
        r.y = fract(512.0*j);
        return r-0.5;
      }

      uint hash( uint x ) {
        x += ( x << 10u );
        x ^= ( x >>  6u );
        x += ( x <<  3u );
        x ^= ( x >> 11u );
        x += ( x << 15u );
        return x;
      }

      // Compound versions of the hashing algorithm I whipped together.
      uint hash( uvec2 v ) { return hash( v.x ^ hash(v.y)                         ); }
      uint hash( uvec3 v ) { return hash( v.x ^ hash(v.y) ^ hash(v.z)             ); }
      uint hash( uvec4 v ) { return hash( v.x ^ hash(v.y) ^ hash(v.z) ^ hash(v.w) ); }

      // Construct a float with half-open range [0:1] using low 23 bits.
      // All zeroes yields 0.0, all ones yields the next smallest representable value below 1.0.
      float floatConstruct( uint m ) {
        const uint ieeeMantissa = 0x007FFFFFu; // binary32 mantissa bitmask
        const uint ieeeOne      = 0x3F800000u; // 1.0 in IEEE binary32
        m &= ieeeMantissa;                     // Keep only mantissa bits (fractional part)
        m |= ieeeOne;                          // Add fractional part to 1.0
        float  f = uintBitsToFloat( m );       // Range [1:2]
        return f - 1.0;                        // Range [0:1]
      }

      // Pseudo-random value in half-open range [0:1].
      float randomBase( float x ) { return floatConstruct(hash(floatBitsToUint(x))); }
      float randomBase( vec2  v ) { return floatConstruct(hash(floatBitsToUint(v))); }
      float randomBase( vec3  v ) { return floatConstruct(hash(floatBitsToUint(v))); }
      float randomBase( vec4  v ) { return floatConstruct(hash(floatBitsToUint(v))); }
      float rand(float seed) {
        float result = randomBase(vec3(gl_FragCoord.xy, seed));
        return result;
      }

      const float F3 =  0.3333333;
      const float G3 =  0.1666667;

      float snoise(vec3 p) {
        vec3 s = floor(p + dot(p, vec3(F3)));
        vec3 x = p - s + dot(s, vec3(G3));
        vec3 e = step(vec3(0.0), x - x.yzx);
        vec3 i1 = e*(1.0 - e.zxy);
        vec3 i2 = 1.0 - e.zxy*(1.0 - e);
        vec3 x1 = x - i1 + G3;
        vec3 x2 = x - i2 + 2.0*G3;
        vec3 x3 = x - 1.0 + 3.0*G3;
        vec4 w, d;
        w.x = dot(x, x);
        w.y = dot(x1, x1);
        w.z = dot(x2, x2);
        w.w = dot(x3, x3);
        w = max(0.6 - w, 0.0);
        d.x = dot(random3(s), x);
        d.y = dot(random3(s + i1), x1);
        d.z = dot(random3(s + i2), x2);
        d.w = dot(random3(s + 1.0), x3);
        w *= w;
        w *= w;
        d *= w;
        return dot(d, vec4(52.0));
      }

      float snoiseFractal(vec3 m) {
        return 0.5333333* snoise(m)
              +0.2666667* snoise(2.0*m)
              +0.1333333* snoise(4.0*m)
              +0.0666667* snoise(8.0*m);
      }
`+r.fragmentShader,r.fragmentShader=r.fragmentShader.replace("#include <transmission_pars_fragment>",`
        #ifdef USE_TRANSMISSION
          // Transmission code is based on glTF-Sampler-Viewer
          // https://github.com/KhronosGroup/glTF-Sample-Viewer
          uniform float _transmission;
          uniform float thickness;
          uniform float attenuationDistance;
          uniform vec3 attenuationColor;
          #ifdef USE_TRANSMISSIONMAP
            uniform sampler2D transmissionMap;
          #endif
          #ifdef USE_THICKNESSMAP
            uniform sampler2D thicknessMap;
          #endif
          uniform vec2 transmissionSamplerSize;
          uniform sampler2D transmissionSamplerMap;
          uniform mat4 modelMatrix;
          uniform mat4 projectionMatrix;
          varying vec3 vWorldPosition;
          vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
            // Direction of refracted light.
            vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
            // Compute rotation-independant scaling of the model matrix.
            vec3 modelScale;
            modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
            modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
            modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
            // The thickness is specified in local space.
            return normalize( refractionVector ) * thickness * modelScale;
          }
          float applyIorToRoughness( const in float roughness, const in float ior ) {
            // Scale roughness with IOR so that an IOR of 1.0 results in no microfacet refraction and
            // an IOR of 1.5 results in the default amount of microfacet refraction.
            return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
          }
          vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
            float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );            
            #ifdef USE_SAMPLER
              #ifdef texture2DLodEXT
                return texture2DLodEXT(transmissionSamplerMap, fragCoord.xy, framebufferLod);
              #else
                return texture2D(transmissionSamplerMap, fragCoord.xy, framebufferLod);
              #endif
            #else
              return texture2D(buffer, fragCoord.xy);
            #endif
          }
          vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
            if ( isinf( attenuationDistance ) ) {
              // Attenuation distance is +, i.e. the transmitted color is not attenuated at all.
              return radiance;
            } else {
              // Compute light attenuation using Beer's law.
              vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
              vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance ); // Beer's law
              return transmittance * radiance;
            }
          }
          vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
            const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
            const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
            const in vec3 attenuationColor, const in float attenuationDistance ) {
            vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
            vec3 refractedRayExit = position + transmissionRay;
            // Project refracted vector on the framebuffer, while mapping to normalized device coordinates.
            vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
            vec2 refractionCoords = ndcPos.xy / ndcPos.w;
            refractionCoords += 1.0;
            refractionCoords /= 2.0;
            // Sample framebuffer to get pixel the refracted ray hits.
            vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
            vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
            // Get the specular component.
            vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
            return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
          }
        #endif
`),r.fragmentShader=r.fragmentShader.replace("#include <transmission_fragment>",`  
        // Improve the refraction to use the world pos
        material.transmission = _transmission;
        material.transmissionAlpha = 1.0;
        material.thickness = thickness;
        material.attenuationDistance = attenuationDistance;
        material.attenuationColor = attenuationColor;
        #ifdef USE_TRANSMISSIONMAP
          material.transmission *= texture2D( transmissionMap, vUv ).r;
        #endif
        #ifdef USE_THICKNESSMAP
          material.thickness *= texture2D( thicknessMap, vUv ).g;
        #endif
        
        vec3 pos = vWorldPosition;
        float runningSeed = 0.0;
        vec3 v = normalize( cameraPosition - pos );
        vec3 n = inverseTransformDirection( normal, viewMatrix );
        vec3 transmission = vec3(0.0);
        float transmissionR, transmissionB, transmissionG;
        float randomCoords = rand(runningSeed++);
        float thickness_smear = thickness * max(pow(roughnessFactor, 0.33), anisotropicBlur);
        vec3 distortionNormal = vec3(0.0);
        vec3 temporalOffset = vec3(time, -time, -time) * temporalDistortion;
        if (distortion > 0.0) {
          distortionNormal = distortion * vec3(snoiseFractal(vec3((pos * distortionScale + temporalOffset))), snoiseFractal(vec3(pos.zxy * distortionScale - temporalOffset)), snoiseFractal(vec3(pos.yxz * distortionScale + temporalOffset)));
        }
        for (float i = 0.0; i < ${e}.0; i ++) {
          vec3 sampleNorm = normalize(n + roughnessFactor * roughnessFactor * 2.0 * normalize(vec3(rand(runningSeed++) - 0.5, rand(runningSeed++) - 0.5, rand(runningSeed++) - 0.5)) * pow(rand(runningSeed++), 0.33) + distortionNormal);
          transmissionR = getIBLVolumeRefraction(
            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness  + thickness_smear * (i + randomCoords) / float(${e}),
            material.attenuationColor, material.attenuationDistance
          ).r;
          transmissionG = getIBLVolumeRefraction(
            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior  * (1.0 + chromaticAberration * (i + randomCoords) / float(${e})) , material.thickness + thickness_smear * (i + randomCoords) / float(${e}),
            material.attenuationColor, material.attenuationDistance
          ).g;
          transmissionB = getIBLVolumeRefraction(
            sampleNorm, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
            pos, modelMatrix, viewMatrix, projectionMatrix, material.ior * (1.0 + 2.0 * chromaticAberration * (i + randomCoords) / float(${e})), material.thickness + thickness_smear * (i + randomCoords) / float(${e}),
            material.attenuationColor, material.attenuationDistance
          ).b;
          transmission.r += transmissionR;
          transmission.g += transmissionG;
          transmission.b += transmissionB;
        }
        transmission /= ${e}.0;
        totalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );
`)},Object.keys(this.uniforms).forEach(e=>Object.defineProperty(this,e,{get:()=>this.uniforms[e].value,set:t=>this.uniforms[e].value=t}))}}let pr=tC.forwardRef(({buffer:e,transmissionSampler:t=!1,backside:r=!1,side:i=m7.FrontSide,transmission:n=1,thickness:a=0,backsideThickness:o=0,backsideEnvMapIntensity:s=1,samples:l=10,resolution:c,backsideResolution:h,background:u,anisotropy:A,anisotropicBlur:d,...f},m)=>{let p,g,v,y;(0,on.e)({MeshTransmissionMaterial:pt});let x=tC.useRef(null),[E]=tC.useState(()=>new pe),C=lQ(h||c),B=lQ(c);return(0,tb.useFrame)(e=>{if(x.current.time=e.clock.elapsedTime,x.current.buffer===B.texture&&!t){var n;(y=null==(n=x.current.__r3f.parent)?void 0:n.object)&&(v=e.gl.toneMapping,p=e.scene.background,g=x.current.envMapIntensity,e.gl.toneMapping=m7.NoToneMapping,u&&(e.scene.background=u),y.material=E,r&&(e.gl.setRenderTarget(C),e.gl.render(e.scene,e.camera),y.material=x.current,y.material.buffer=C.texture,y.material.thickness=o,y.material.side=m7.BackSide,y.material.envMapIntensity=s),e.gl.setRenderTarget(B),e.gl.render(e.scene,e.camera),y.material=x.current,y.material.thickness=a,y.material.side=i,y.material.buffer=B.texture,y.material.envMapIntensity=g,e.scene.background=p,e.gl.setRenderTarget(null),e.gl.toneMapping=v)}}),tC.useImperativeHandle(m,()=>x.current,[]),tC.createElement("meshTransmissionMaterial",e2({args:[l,t],ref:x},f,{buffer:e||B.texture,_transmission:n,anisotropicBlur:null!=d?d:A,transmission:t?n:0,thickness:a,side:i}))});var on=tI;let pi=tC.forwardRef((e,t)=>((0,on.e)({DiscardMaterialImpl:pe}),tC.createElement("discardMaterialImpl",e2({ref:t},e))));function pn(e){let t=tC.useRef(null);return tC.useLayoutEffect(()=>{let e=t.current.parent,r=null==e?void 0:e.geometry;if(r){let i=e.material;e.material=t.current.__r3f.children.map(e=>e.object);let n=[...r.groups];return r.clearGroups(),e.material.forEach((t,i)=>{i<e.material.length-1&&(t.depthWrite=!1),r.addGroup(0,1/0,i)}),()=>{e.material=i,r.groups=n}}}),tC.createElement("group",e2({ref:t},e))}var pa=tw;let po=oW>=154?"opaque_fragment":"output_fragment";class ps extends pa.PointsMaterial{constructor(e){super(e),this.onBeforeCompile=(e,t)=>{let{isWebGL2:r}=t.capabilities;e.fragmentShader=e.fragmentShader.replace(`#include <${po}>`,`
        ${!r?`#extension GL_OES_standard_derivatives : enable
#include <${po}>`:`#include <${po}>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <${oW>=154?"colorspace_fragment":"encodings_fragment"}>
      `)}}}let pl=tC.forwardRef((e,t)=>{let[r]=tC.useState(()=>new ps(null));return tC.createElement("primitive",e2({},e,{object:r,ref:t,attach:"material"}))});var tI=tI;function pc(e,t,r){t.traverse(t=>{t.material&&(e.properties.remove(t.material),null==t.material.dispose||t.material.dispose())}),e.info.programs.length=0,e.compile(t,r)}function ph({focus:e=0,samples:t=10,size:r=25}){let i=(0,tI.C)(e=>e.gl),n=(0,tI.C)(e=>e.scene),a=(0,tI.C)(e=>e.camera);return tC.useEffect(()=>{let o=nw.ShaderChunk.shadowmap_pars_fragment;return nw.ShaderChunk.shadowmap_pars_fragment=nw.ShaderChunk.shadowmap_pars_fragment.replace("#ifdef USE_SHADOWMAP","#ifdef USE_SHADOWMAP\n"+(({focus:e=0,size:t=25,samples:r=10}={})=>`
#define PENUMBRA_FILTER_SIZE float(${t})
#define RGB_NOISE_FUNCTION(uv) (randRGB(uv))
vec3 randRGB(vec2 uv) {
  return vec3(
    fract(sin(dot(uv, vec2(12.75613, 38.12123))) * 13234.76575),
    fract(sin(dot(uv, vec2(19.45531, 58.46547))) * 43678.23431),
    fract(sin(dot(uv, vec2(23.67817, 78.23121))) * 93567.23423)
  );
}

vec3 lowPassRandRGB(vec2 uv) {
  // 3x3 convolution (average)
  // can be implemented as separable with an extra buffer for a total of 6 samples instead of 9
  vec3 result = vec3(0);
  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0, -1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0,  0.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(-1.0, +1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0, -1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0,  0.0));
  result += RGB_NOISE_FUNCTION(uv + vec2( 0.0, +1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0, -1.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0,  0.0));
  result += RGB_NOISE_FUNCTION(uv + vec2(+1.0, +1.0));
  result *= 0.111111111; // 1.0 / 9.0
  return result;
}
vec3 highPassRandRGB(vec2 uv) {
  // by subtracting the low-pass signal from the original signal, we're being left with the high-pass signal
  // hp(x) = x - lp(x)
  return RGB_NOISE_FUNCTION(uv) - lowPassRandRGB(uv) + 0.5;
}


vec2 vogelDiskSample(int sampleIndex, int sampleCount, float angle) {
  const float goldenAngle = 2.399963f; // radians
  float r = sqrt(float(sampleIndex) + 0.5f) / sqrt(float(sampleCount));
  float theta = float(sampleIndex) * goldenAngle + angle;
  float sine = sin(theta);
  float cosine = cos(theta);
  return vec2(cosine, sine) * r;
}
float penumbraSize( const in float zReceiver, const in float zBlocker ) { // Parallel plane estimation
  return (zReceiver - zBlocker) / zBlocker;
}
float findBlocker(sampler2D shadowMap, vec2 uv, float compare, float angle) {
  float texelSize = 1.0 / float(textureSize(shadowMap, 0).x);
  float blockerDepthSum = float(${e});
  float blockers = 0.0;

  int j = 0;
  vec2 offset = vec2(0.);
  float depth = 0.;

  #pragma unroll_loop_start
  for(int i = 0; i < ${r}; i ++) {
    offset = (vogelDiskSample(j, ${r}, angle) * texelSize) * 2.0 * PENUMBRA_FILTER_SIZE;
    depth = unpackRGBAToDepth( texture2D( shadowMap, uv + offset));
    if (depth < compare) {
      blockerDepthSum += depth;
      blockers++;
    }
    j++;
  }
  #pragma unroll_loop_end

  if (blockers > 0.0) {
    return blockerDepthSum / blockers;
  }
  return -1.0;
}

        
float vogelFilter(sampler2D shadowMap, vec2 uv, float zReceiver, float filterRadius, float angle) {
  float texelSize = 1.0 / float(textureSize(shadowMap, 0).x);
  float shadow = 0.0f;
  int j = 0;
  vec2 vogelSample = vec2(0.0);
  vec2 offset = vec2(0.0);
  #pragma unroll_loop_start
  for (int i = 0; i < ${r}; i++) {
    vogelSample = vogelDiskSample(j, ${r}, angle) * texelSize;
    offset = vogelSample * (1.0 + filterRadius * float(${t}));
    shadow += step( zReceiver, unpackRGBAToDepth( texture2D( shadowMap, uv + offset ) ) );
    j++;
  }
  #pragma unroll_loop_end
  return shadow * 1.0 / ${r}.0;
}

float PCSS (sampler2D shadowMap, vec4 coords) {
  vec2 uv = coords.xy;
  float zReceiver = coords.z; // Assumed to be eye-space z in this code
  float angle = highPassRandRGB(gl_FragCoord.xy).r * PI2;
  float avgBlockerDepth = findBlocker(shadowMap, uv, zReceiver, angle);
  if (avgBlockerDepth == -1.0) {
    return 1.0;
  }
  float penumbraRatio = penumbraSize(zReceiver, avgBlockerDepth);
  return vogelFilter(shadowMap, uv, zReceiver, 1.25 * penumbraRatio, angle);
}`)({size:r,samples:t,focus:e})).replace("#if defined( SHADOWMAP_TYPE_PCF )","\nreturn PCSS(shadowMap, shadowCoord);\n#if defined( SHADOWMAP_TYPE_PCF )"),pc(i,n,a),()=>{nw.ShaderChunk.shadowmap_pars_fragment=o,pc(i,n,a)}},[e,r,t]),null}function pu(e,t){let r=e+"Geometry";return tC.forwardRef(({args:e,children:i,...n},a)=>{let o=tC.useRef(null);return tC.useImperativeHandle(a,()=>o.current),tC.useLayoutEffect(()=>void(null==t||t(o.current))),tC.createElement("mesh",e2({ref:o},n),tC.createElement(r,{attach:"geometry",args:e}),i)})}let pA=pu("box"),pd=pu("circle"),pf=pu("cone"),pm=pu("cylinder"),pp=pu("sphere"),pg=pu("plane"),pv=pu("tube"),py=pu("torus"),px=pu("torusKnot"),pE=pu("tetrahedron"),pC=pu("ring"),pB=pu("polyhedron"),pw=pu("icosahedron"),pI=pu("octahedron"),pb=pu("dodecahedron"),p_=pu("extrude"),pM=pu("lathe"),pS=pu("capsule"),pT=pu("shape",({geometry:e})=>{let t=e.attributes.position,r=new tw.Box3().setFromBufferAttribute(t),i=new tw.Vector3;r.getSize(i);let n=[],a=0,o=0,s=0,l=0;for(let e=0;e<t.count;e++)a=t.getX(e),o=t.getY(e),s=(a-r.min.x)/i.x,l=(o-r.min.y)/i.y,n.push(s,l);e.setAttribute("uv",new tw.Float32BufferAttribute(n,2))}),pD=tC.forwardRef(function({args:[e=1,t=1,r=1]=[],radius:i=.05,steps:n=1,smoothness:a=4,bevelSegments:o=4,creaseAngle:s=.4,children:l,...c},h){return tC.createElement("mesh",e2({ref:h},c),tC.createElement(pF,{args:[e,t,r],radius:i,steps:n,smoothness:a,bevelSegments:o,creaseAngle:s}),l)}),pF=tC.forwardRef(function({args:[e=1,t=1,r=1]=[],radius:i=.05,steps:n=1,smoothness:a=4,bevelSegments:o=4,creaseAngle:s=.4,...l},c){let h=tC.useMemo(()=>{let r,n;return r=new tw.Shape,n=i-1e-5,r.absarc(1e-5,1e-5,1e-5,-Math.PI/2,-Math.PI,!0),r.absarc(1e-5,t-2*n,1e-5,Math.PI,Math.PI/2,!0),r.absarc(e-2*n,t-2*n,1e-5,Math.PI/2,0,!0),r.absarc(e-2*n,1e-5,1e-5,0,-Math.PI/2,!0),r},[e,t,i]),u=tC.useMemo(()=>({depth:r-2*i,bevelEnabled:!0,bevelSegments:2*o,steps:n,bevelSize:i-1e-5,bevelThickness:i,curveSegments:a}),[r,i,a,o,n]),A=tC.useRef(null);return tC.useLayoutEffect(()=>{A.current&&(A.current.center(),ol(A.current,s))},[h,u,s]),tC.useImperativeHandle(c,()=>A.current),tC.createElement("extrudeGeometry",e2({ref:A,args:[h,u]},l))});function pR(){let e=new tw.BufferGeometry,t=new Float32Array([-1,-1,3,-1,-1,3]);return e.boundingSphere=new tw.Sphere,e.boundingSphere.set(new tw.Vector3,1/0),e.setAttribute("position",new tw.BufferAttribute(t,2)),e}let pP=tC.forwardRef(function({children:e,...t},r){let i=tC.useMemo(pR,[]);return tC.createElement("mesh",e2({ref:r,geometry:i,frustumCulled:!1},t),e)}),pQ=tC.forwardRef(({children:e,width:t,height:r,depth:i,box3:n,precise:a=!0,...o},s)=>{let l=tC.useRef(null),c=tC.useRef(null),h=tC.useRef(null);return tC.useLayoutEffect(()=>{c.current.matrixWorld.identity();let e=n||new tw.Box3().setFromObject(h.current,a),o=e.max.x-e.min.x,s=e.max.y-e.min.y,l=e.max.z-e.min.z,u=Math.max(o,s,l);t&&(u=o),r&&(u=s),i&&(u=l),c.current.scale.setScalar(1/u)},[t,r,i,n,a]),tC.useImperativeHandle(s,()=>l.current,[]),tC.createElement("group",e2({ref:l},o),tC.createElement("group",{ref:c},tC.createElement("group",{ref:h},e)))});var tI=tI,pU=((e4=pU||{})[e4.NONE=0]="NONE",e4[e4.START=1]="START",e4[e4.ACTIVE=2]="ACTIVE",e4);let pz=e=>1-Math.exp(-5*e)+.007*e,pk=tC.createContext(null);function pL({children:e,maxDuration:t=1,margin:r=1.2,observe:i,fit:n,clip:a,interpolateFunc:o=pz,onFit:s}){let l=tC.useRef(null),{camera:c,size:h,invalidate:u}=(0,tI.C)(),A=(0,tI.C)(e=>e.controls),d=tC.useRef(s);d.current=s;let f=tC.useRef({camPos:new tw.Vector3,camRot:new tw.Quaternion,camZoom:1}),m=tC.useRef({camPos:void 0,camRot:void 0,camZoom:void 0,camUp:void 0,target:void 0}),p=tC.useRef(pU.NONE),g=tC.useRef(0),[v]=tC.useState(()=>new tw.Box3),y=tC.useMemo(()=>{function e(){let e=v.getSize(new tw.Vector3),t=v.getCenter(new tw.Vector3),i=Math.max(e.x,e.y,e.z),n=c&&c.isOrthographicCamera?4*i:i/(2*Math.atan(Math.PI*c.fov/360)),a=c&&c.isOrthographicCamera?4*i:n/c.aspect;return{box:v,size:e,center:t,distance:r*Math.max(n,a)}}return{getSize:e,refresh(e){if(e&&e.isBox3)v.copy(e);else{let t=e||l.current;if(!t)return this;t.updateWorldMatrix(!0,!0),v.setFromObject(t)}if(v.isEmpty()){let e=c.position.length()||10;v.setFromCenterAndSize(new tw.Vector3,new tw.Vector3(e,e,e))}return f.current.camPos.copy(c.position),f.current.camRot.copy(c.quaternion),c&&c.isOrthographicCamera&&(f.current.camZoom=c.zoom),m.current.camPos=void 0,m.current.camRot=void 0,m.current.camZoom=void 0,m.current.camUp=void 0,m.current.target=void 0,this},reset(){let{center:t,distance:r}=e(),i=c.position.clone().sub(t).normalize();m.current.camPos=t.clone().addScaledVector(i,r),m.current.target=t.clone();let n=new tw.Matrix4().lookAt(m.current.camPos,m.current.target,c.up);return m.current.camRot=new tw.Quaternion().setFromRotationMatrix(n),p.current=pU.START,g.current=0,this},moveTo(e){return m.current.camPos=Array.isArray(e)?new tw.Vector3(...e):e.clone(),p.current=pU.START,g.current=0,this},lookAt({target:e,up:t}){m.current.target=Array.isArray(e)?new tw.Vector3(...e):e.clone(),t?m.current.camUp=Array.isArray(t)?new tw.Vector3(...t):t.clone():m.current.camUp=c.up.clone();let r=new tw.Matrix4().lookAt(m.current.camPos||c.position,m.current.target,m.current.camUp);return m.current.camRot=new tw.Quaternion().setFromRotationMatrix(r),p.current=pU.START,g.current=0,this},to({position:e,target:t}){return this.moveTo(e).lookAt({target:t})},fit(){if(!(c&&c.isOrthographicCamera))return this.reset();let e=0,t=0,i=[new tw.Vector3(v.min.x,v.min.y,v.min.z),new tw.Vector3(v.min.x,v.max.y,v.min.z),new tw.Vector3(v.min.x,v.min.y,v.max.z),new tw.Vector3(v.min.x,v.max.y,v.max.z),new tw.Vector3(v.max.x,v.max.y,v.max.z),new tw.Vector3(v.max.x,v.max.y,v.min.z),new tw.Vector3(v.max.x,v.min.y,v.max.z),new tw.Vector3(v.max.x,v.min.y,v.min.z)],n=m.current.camPos||c.position,a=m.current.target||(null==A?void 0:A.target),o=m.current.camUp||c.up,s=a?new tw.Matrix4().lookAt(n,a,o).setPosition(n).invert():c.matrixWorldInverse;for(let r of i)r.applyMatrix4(s),e=Math.max(e,Math.abs(r.y)),t=Math.max(t,Math.abs(r.x));e*=2,t*=2;let l=(c.top-c.bottom)/e,h=(c.right-c.left)/t;return m.current.camZoom=Math.min(l,h)/r,p.current=pU.START,g.current=0,d.current&&d.current(this.getSize()),this},clip(){let{distance:t}=e();return c.near=t/100,c.far=100*t,c.updateProjectionMatrix(),A&&(A.maxDistance=10*t,A.update()),u(),this}}},[v,c,A,r,u]);tC.useLayoutEffect(()=>{if(A){let e=()=>{if(A&&m.current.target&&p.current!==pU.NONE){let e=new tw.Vector3().setFromMatrixColumn(c.matrix,2),t=f.current.camPos.distanceTo(A.target),r=(m.current.camPos||f.current.camPos).distanceTo(m.current.target),i=(1-g.current)*t+g.current*r;A.target.copy(c.position).addScaledVector(e,-i),A.update()}p.current=pU.NONE};return A.addEventListener("start",e),()=>A.removeEventListener("start",e)}},[A]);let x=tC.useRef(0);return tC.useLayoutEffect(()=>{(i||0==x.current++)&&(y.refresh(),n&&y.reset().fit(),a&&y.clip())},[h,a,n,i,c,A]),(0,tb.useFrame)((e,r)=>{if(p.current===pU.START)p.current=pU.ACTIVE,u();else if(p.current===pU.ACTIVE){if(g.current+=r/t,g.current>=1)m.current.camPos&&c.position.copy(m.current.camPos),m.current.camRot&&c.quaternion.copy(m.current.camRot),m.current.camUp&&c.up.copy(m.current.camUp),m.current.camZoom&&c&&c.isOrthographicCamera&&(c.zoom=m.current.camZoom),c.updateMatrixWorld(),c.updateProjectionMatrix(),A&&m.current.target&&(A.target.copy(m.current.target),A.update()),p.current=pU.NONE;else{let e=o(g.current);m.current.camPos&&c.position.lerpVectors(f.current.camPos,m.current.camPos,e),m.current.camRot&&c.quaternion.slerpQuaternions(f.current.camRot,m.current.camRot,e),m.current.camUp&&c.up.set(0,1,0).applyQuaternion(c.quaternion),m.current.camZoom&&c&&c.isOrthographicCamera&&(c.zoom=(1-e)*f.current.camZoom+e*m.current.camZoom),c.updateMatrixWorld(),c.updateProjectionMatrix()}u()}}),tC.createElement("group",{ref:l},tC.createElement(pk.Provider,{value:y},e))}function pO(){return tC.useContext(pk)}var tI=tI,pG=Object.defineProperty,pN=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?pG(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r,r};class pH{constructor(e=Math){pN(this,"grad3",[[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],[1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],[0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]]),pN(this,"grad4",[[0,1,1,1],[0,1,1,-1],[0,1,-1,1],[0,1,-1,-1],[0,-1,1,1],[0,-1,1,-1],[0,-1,-1,1],[0,-1,-1,-1],[1,0,1,1],[1,0,1,-1],[1,0,-1,1],[1,0,-1,-1],[-1,0,1,1],[-1,0,1,-1],[-1,0,-1,1],[-1,0,-1,-1],[1,1,0,1],[1,1,0,-1],[1,-1,0,1],[1,-1,0,-1],[-1,1,0,1],[-1,1,0,-1],[-1,-1,0,1],[-1,-1,0,-1],[1,1,1,0],[1,1,-1,0],[1,-1,1,0],[1,-1,-1,0],[-1,1,1,0],[-1,1,-1,0],[-1,-1,1,0],[-1,-1,-1,0]]),pN(this,"p",[]),pN(this,"perm",[]),pN(this,"simplex",[[0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],[0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],[1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],[2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]]),pN(this,"dot",(e,t,r)=>e[0]*t+e[1]*r),pN(this,"dot3",(e,t,r,i)=>e[0]*t+e[1]*r+e[2]*i),pN(this,"dot4",(e,t,r,i,n)=>e[0]*t+e[1]*r+e[2]*i+e[3]*n),pN(this,"noise",(e,t)=>{let r,i,n,a=.5*(Math.sqrt(3)-1)*(e+t),o=Math.floor(e+a),s=Math.floor(t+a),l=(3-Math.sqrt(3))/6,c=(o+s)*l,h=e-(o-c),u=t-(s-c),A=0,d=1;h>u&&(A=1,d=0);let f=h-A+l,m=u-d+l,p=h-1+2*l,g=u-1+2*l,v=255&o,y=255&s,x=this.perm[v+this.perm[y]]%12,E=this.perm[v+A+this.perm[y+d]]%12,C=this.perm[v+1+this.perm[y+1]]%12,B=.5-h*h-u*u;B<0?r=0:(B*=B,r=B*B*this.dot(this.grad3[x],h,u));let w=.5-f*f-m*m;w<0?i=0:(w*=w,i=w*w*this.dot(this.grad3[E],f,m));let I=.5-p*p-g*g;return I<0?n=0:(I*=I,n=I*I*this.dot(this.grad3[C],p,g)),70*(r+i+n)}),pN(this,"noise3d",(e,t,r)=>{let i,n,a,o,s,l,c,h,u,A,d=1/3*(e+t+r),f=Math.floor(e+d),m=Math.floor(t+d),p=Math.floor(r+d),g=1/6*(f+m+p),v=e-(f-g),y=t-(m-g),x=r-(p-g);v>=y?y>=x?(s=1,l=0,c=0,h=1,u=1,A=0):(v>=x?(s=1,l=0,c=0):(s=0,l=0,c=1),h=1,u=0,A=1):y<x?(s=0,l=0,c=1,h=0,u=1,A=1):v<x?(s=0,l=1,c=0,h=0,u=1,A=1):(s=0,l=1,c=0,h=1,u=1,A=0);let E=v-s+1/6,C=y-l+1/6,B=x-c+1/6,w=v-h+1/6*2,I=y-u+1/6*2,b=x-A+1/6*2,_=v-1+1/6*3,M=y-1+1/6*3,S=x-1+1/6*3,T=255&f,D=255&m,F=255&p,R=this.perm[T+this.perm[D+this.perm[F]]]%12,P=this.perm[T+s+this.perm[D+l+this.perm[F+c]]]%12,Q=this.perm[T+h+this.perm[D+u+this.perm[F+A]]]%12,U=this.perm[T+1+this.perm[D+1+this.perm[F+1]]]%12,z=.6-v*v-y*y-x*x;z<0?i=0:(z*=z,i=z*z*this.dot3(this.grad3[R],v,y,x));let k=.6-E*E-C*C-B*B;k<0?n=0:(k*=k,n=k*k*this.dot3(this.grad3[P],E,C,B));let L=.6-w*w-I*I-b*b;L<0?a=0:(L*=L,a=L*L*this.dot3(this.grad3[Q],w,I,b));let O=.6-_*_-M*M-S*S;return O<0?o=0:(O*=O,o=O*O*this.dot3(this.grad3[U],_,M,S)),32*(i+n+a+o)}),pN(this,"noise4d",(e,t,r,i)=>{let n,a,o,s,l,c,h,u,A,d,f,m,p,g,v,y,x,E=this.grad4,C=this.simplex,B=this.perm,w=(5-Math.sqrt(5))/20,I=(Math.sqrt(5)-1)/4*(e+t+r+i),b=Math.floor(e+I),_=Math.floor(t+I),M=Math.floor(r+I),S=Math.floor(i+I),T=(b+_+M+S)*w,D=e-(b-T),F=t-(_-T),R=r-(M-T),P=i-(S-T),Q=32*(D>F)+16*(D>R)+8*(F>R)+4*(D>P)+2*(F>P)+ +(R>P);c=+(C[Q][0]>=3),h=+(C[Q][1]>=3),u=+(C[Q][2]>=3),A=+(C[Q][3]>=3),d=+(C[Q][0]>=2),f=+(C[Q][1]>=2),m=+(C[Q][2]>=2),p=+(C[Q][3]>=2),g=+(C[Q][0]>=1),v=+(C[Q][1]>=1),y=+(C[Q][2]>=1),x=+(C[Q][3]>=1);let U=D-c+w,z=F-h+w,k=R-u+w,L=P-A+w,O=D-d+2*w,G=F-f+2*w,N=R-m+2*w,H=P-p+2*w,V=D-g+3*w,j=F-v+3*w,J=R-y+3*w,Y=P-x+3*w,W=D-1+4*w,K=F-1+4*w,X=R-1+4*w,q=P-1+4*w,Z=255&b,$=255&_,ee=255&M,et=255&S,er=B[Z+B[$+B[ee+B[et]]]]%32,ei=B[Z+c+B[$+h+B[ee+u+B[et+A]]]]%32,en=B[Z+d+B[$+f+B[ee+m+B[et+p]]]]%32,ea=B[Z+g+B[$+v+B[ee+y+B[et+x]]]]%32,eo=B[Z+1+B[$+1+B[ee+1+B[et+1]]]]%32,es=.6-D*D-F*F-R*R-P*P;es<0?n=0:(es*=es,n=es*es*this.dot4(E[er],D,F,R,P));let el=.6-U*U-z*z-k*k-L*L;el<0?a=0:(el*=el,a=el*el*this.dot4(E[ei],U,z,k,L));let ec=.6-O*O-G*G-N*N-H*H;ec<0?o=0:(ec*=ec,o=ec*ec*this.dot4(E[en],O,G,N,H));let eh=.6-V*V-j*j-J*J-Y*Y;eh<0?s=0:(eh*=eh,s=eh*eh*this.dot4(E[ea],V,j,J,Y));let eu=.6-W*W-K*K-X*X-q*q;return eu<0?l=0:(eu*=eu,l=eu*eu*this.dot4(E[eo],W,K,X,q)),27*(n+a+o+s+l)});for(let t=0;t<256;t++)this.p[t]=Math.floor(256*e.random());for(let e=0;e<512;e++)this.perm[e]=this.p[255&e]}}let pV=tC.forwardRef(({intensity:e=1,decay:t,decayRate:r=.65,maxYaw:i=.1,maxPitch:n=.1,maxRoll:a=.1,yawFrequency:o=.1,pitchFrequency:s=.1,rollFrequency:l=.1},c)=>{let h=(0,tI.C)(e=>e.camera),u=(0,tI.C)(e=>e.controls),A=tC.useRef(e),d=tC.useRef(h.rotation.clone()),[f]=tC.useState(()=>new pH),[m]=tC.useState(()=>new pH),[p]=tC.useState(()=>new pH),g=()=>{(A.current<0||A.current>1)&&(A.current=A.current<0?0:1)};return tC.useImperativeHandle(c,()=>({getIntensity:()=>A.current,setIntensity:e=>{A.current=e,g()}}),[]),tC.useEffect(()=>{if(u){let e=()=>void(d.current=h.rotation.clone());return u.addEventListener("change",e),e(),()=>void u.removeEventListener("change",e)}},[h,u]),(0,tb.useFrame)((e,c)=>{let u=Math.pow(A.current,2),v=i*u*f.noise(e.clock.elapsedTime*o,1),y=n*u*m.noise(e.clock.elapsedTime*s,1),x=a*u*p.noise(e.clock.elapsedTime*l,1);h.rotation.set(d.current.x+y,d.current.y+v,d.current.z+x),t&&A.current>0&&(A.current-=r*c,g())}),null}),pj=tC.forwardRef(({children:e,enabled:t=!0,speed:r=1,rotationIntensity:i=1,floatIntensity:n=1,floatingRange:a=[-.1,.1],autoInvalidate:o=!1,...s},l)=>{let c=tC.useRef(null);tC.useImperativeHandle(l,()=>c.current,[]);let h=tC.useRef(1e4*Math.random());return(0,tb.useFrame)(e=>{var s,l;if(!t||0===r)return;o&&e.invalidate();let u=h.current+e.clock.elapsedTime;c.current.rotation.x=Math.cos(u/4*r)/8*i,c.current.rotation.y=Math.sin(u/4*r)/8*i,c.current.rotation.z=Math.sin(u/4*r)/20*i;let A=Math.sin(u/4*r)/10;A=tw.MathUtils.mapLinear(A,-.1,.1,null!=(s=null==a?void 0:a[0])?s:-.1,null!=(l=null==a?void 0:a[1])?l:.1),c.current.position.y=A*n,c.current.updateMatrix()}),tC.createElement("group",s,tC.createElement("group",{ref:c,matrixAutoUpdate:!1},e))});var tI=tI,o4=tI,o0=tI,on=tI,pJ=tw;class pY extends pJ.Mesh{constructor(e,t){var r,i;const n=(e=>e&&e.isCubeTexture)(e),a=Math.floor(Math.log2((null!=(i=n?null==(r=e.image[0])?void 0:r.width:e.image.width)?i:1024)/4)),o=Math.pow(2,a),s=3*Math.max(o,112),l=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,c=[n?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/s}`,`#define CUBEUV_TEXEL_HEIGHT ${1/(4*o)}`,`#define CUBEUV_MAX_MIP ${a}.0`].join("\n")+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${nI>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,h={map:{value:e},height:{value:(null==t?void 0:t.height)||15},radius:{value:(null==t?void 0:t.radius)||100}};super(new pJ.IcosahedronGeometry(1,16),new pJ.ShaderMaterial({uniforms:h,fragmentShader:c,vertexShader:l,side:pJ.DoubleSide}))}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}var tI=tI,nX=tI,pW=tw;class pK extends pW.DataTextureLoader{constructor(e){super(e),this.type=pW.HalfFloatType}parse(e){let t,r,i,n=function(e,t){switch(e){case 1:throw Error("THREE.RGBELoader: Read Error: "+(t||""));case 2:throw Error("THREE.RGBELoader: Write Error: "+(t||""));case 3:throw Error("THREE.RGBELoader: Bad File Format: "+(t||""));default:throw Error("THREE.RGBELoader: Memory Error: "+(t||""))}},a=function(e,t,r){t=t||1024;let i=e.pos,n=-1,a=0,o="",s=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));for(;0>(n=s.indexOf("\n"))&&a<t&&i<e.byteLength;)o+=s,a+=s.length,i+=128,s+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(i,i+128)));return -1<n&&(!1!==r&&(e.pos+=a+n+1),o+s.slice(0,n))},o=new Uint8Array(e);o.pos=0;let s=function(e){let t,r,i=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*FORMAT=(\S+)\s*$/,l=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,c={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};for(!(e.pos>=e.byteLength)&&(t=a(e))||n(1,"no header found"),(r=t.match(/^#\?(\S+)/))||n(3,"bad initial token"),c.valid|=1,c.programtype=r[1],c.string+=t+"\n";!1!==(t=a(e));){if(c.string+=t+"\n","#"===t.charAt(0)){c.comments+=t+"\n";continue}if((r=t.match(i))&&(c.gamma=parseFloat(r[1])),(r=t.match(o))&&(c.exposure=parseFloat(r[1])),(r=t.match(s))&&(c.valid|=2,c.format=r[1]),(r=t.match(l))&&(c.valid|=4,c.height=parseInt(r[1],10),c.width=parseInt(r[2],10)),2&c.valid&&4&c.valid)break}return 2&c.valid||n(3,"missing format specifier"),4&c.valid||n(3,"missing image size specifier"),c}(o),l=s.width,c=s.height,h=function(e,t,r){if(t<8||t>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);t!==(e[2]<<8|e[3])&&n(3,"wrong scanline width");let i=new Uint8Array(4*t*r);i.length||n(4,"unable to allocate buffer space");let a=0,o=0,s=4*t,l=new Uint8Array(4),c=new Uint8Array(s),h=r;for(;h>0&&o<e.byteLength;){o+4>e.byteLength&&n(1),l[0]=e[o++],l[1]=e[o++],l[2]=e[o++],l[3]=e[o++],(2!=l[0]||2!=l[1]||(l[2]<<8|l[3])!=t)&&n(3,"bad rgbe scanline format");let r=0,u;for(;r<s&&o<e.byteLength;){let t=(u=e[o++])>128;if(t&&(u-=128),(0===u||r+u>s)&&n(3,"bad scanline data"),t){let t=e[o++];for(let e=0;e<u;e++)c[r++]=t}else c.set(e.subarray(o,o+u),r),r+=u,o+=u}for(let e=0;e<t;e++){let r=0;i[a]=c[e+r],r+=t,i[a+1]=c[e+r],r+=t,i[a+2]=c[e+r],r+=t,i[a+3]=c[e+r],a+=4}h--}return i}(o.subarray(o.pos),l,c);switch(this.type){case pW.FloatType:let u=new Float32Array(4*(i=h.length/4));for(let e=0;e<i;e++)!function(e,t,r,i){let n=Math.pow(2,e[t+3]-128)/255;r[i+0]=e[t+0]*n,r[i+1]=e[t+1]*n,r[i+2]=e[t+2]*n,r[i+3]=1}(h,4*e,u,4*e);t=u,r=pW.FloatType;break;case pW.HalfFloatType:let A=new Uint16Array(4*(i=h.length/4));for(let e=0;e<i;e++)!function(e,t,r,i){let n=Math.pow(2,e[t+3]-128)/255;r[i+0]=pW.DataUtils.toHalfFloat(Math.min(e[t+0]*n,65504)),r[i+1]=pW.DataUtils.toHalfFloat(Math.min(e[t+1]*n,65504)),r[i+2]=pW.DataUtils.toHalfFloat(Math.min(e[t+2]*n,65504)),r[i+3]=pW.DataUtils.toHalfFloat(1)}(h,4*e,A,4*e);t=A,r=pW.HalfFloatType;break;default:throw Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:l,height:c,data:t,header:s.string,gamma:s.gamma,exposure:s.exposure,type:r}}setDataType(e){return this.type=e,this}load(e,t,r,i){return super.load(e,function(e,r){switch(e.type){case pW.FloatType:case pW.HalfFloatType:"colorSpace"in e?e.colorSpace="srgb-linear":e.encoding=3e3,e.minFilter=pW.LinearFilter,e.magFilter=pW.LinearFilter,e.generateMipmaps=!1,e.flipY=!0}t&&t(e,r)},r,i)}}var pX=tw;let pq=nI>=152;class pZ extends pX.DataTextureLoader{constructor(e){super(e),this.type=pX.HalfFloatType}parse(e){let t={l:0,c:0,lc:0};function r(e,r,i,n,a){for(;i<e;)r=r<<8|I(n,a),i+=8;t.l=r>>(i-=e)&(1<<e)-1,t.c=r,t.lc=i}let i=Array(59),n={c:0,lc:0};function a(e,t,r,i){e=e<<8|I(r,i),t+=8,n.c=e,n.lc=t}let o={c:0,lc:0};function s(e,t,r,i,s,l,c,h,u,A){if(e==t){i<8&&(a(r,i,s,c),r=n.c,i=n.lc);var d=r>>(i-=8),d=new Uint8Array([d])[0];if(u.value+d>A)return!1;for(var f=h[u.value-1];d-- >0;)h[u.value++]=f}else{if(!(u.value<A))return!1;h[u.value++]=e}o.c=r,o.lc=i}function l(e){var t=65535&e;return t>32767?t-65536:t}let c={a:0,b:0};function h(e,t){var r=l(e),i=l(t),n=r+(1&i)+(i>>1),a=n-i;c.a=n,c.b=a}function u(e,t){var r=65535&t,i=(65535&e)-(r>>1)&65535;c.a=r+i-32768&65535,c.b=i}function A(e,l,c,h,u,A){var d=c.value,f=w(l,c),m=w(l,c);c.value+=4;var p=w(l,c);if(c.value+=4,f<0||f>=65537||m<0||m>=65537)throw"Something wrong with HUF_ENCSIZE";for(var g=Array(65537),v=Array(16384),y=0;y<16384;y++)v[y]={},v[y].len=0,v[y].lit=0,v[y].p=null;var x=h-(c.value-d);if(!function(e,n,a,o,s,l,c){for(var h=0,u=0;s<=l;s++){if(a.value-a.value>o)return!1;r(6,h,u,e,a);var A=t.l;if(h=t.c,u=t.lc,c[s]=A,63==A){if(a.value-a.value>o)throw"Something wrong with hufUnpackEncTable";r(8,h,u,e,a);var d=t.l+6;if(h=t.c,u=t.lc,s+d>l+1)throw"Something wrong with hufUnpackEncTable";for(;d--;)c[s++]=0;s--}else if(A>=59){var d=A-59+2;if(s+d>l+1)throw"Something wrong with hufUnpackEncTable";for(;d--;)c[s++]=0;s--}}!function(e){for(var t=0;t<=58;++t)i[t]=0;for(var t=0;t<65537;++t)i[e[t]]+=1;for(var r=0,t=58;t>0;--t){var n=r+i[t]>>1;i[t]=r,r=n}for(var t=0;t<65537;++t){var a=e[t];a>0&&(e[t]=a|i[a]++<<6)}}(c)}(e,0,c,x,f,m,g),p>8*(h-(c.value-d)))throw"Something wrong with hufUncompress";!function(e,t,r,i){for(;t<=r;t++){var n=e[t]>>6,a=63&e[t];if(n>>a)throw"Invalid table entry";if(a>14){var o=i[n>>a-14];if(o.len)throw"Invalid table entry";if(o.lit++,o.p){var s=o.p;o.p=Array(o.lit);for(var l=0;l<o.lit-1;++l)o.p[l]=s[l]}else o.p=[,];o.p[o.lit-1]=t}else if(a)for(var c=0,l=1<<14-a;l>0;l--){var o=i[(n<<14-a)+c];if(o.len||o.p)throw"Invalid table entry";o.len=a,o.lit=t,c++}}}(g,f,m,v),function(e,t,r,i,l,c,h,u,A,d){for(var f=0,m=0,p=Math.trunc(l.value+(c+7)/8);l.value<p;)for(a(f,m,r,l),f=n.c,m=n.lc;m>=14;){var g=t[f>>m-14&16383];if(g.len)m-=g.len,s(g.lit,h,f,m,r,i,l,A,d,u),f=o.c,m=o.lc;else{if(!g.p)throw"hufDecode issues";for(v=0;v<g.lit;v++){for(var v,y=63&e[g.p[v]];m<y&&l.value<p;)a(f,m,r,l),f=n.c,m=n.lc;if(m>=y&&e[g.p[v]]>>6==(f>>m-y&(1<<y)-1)){m-=y,s(g.p[v],h,f,m,r,i,l,A,d,u),f=o.c,m=o.lc;break}}if(v==g.lit)throw"hufDecode issues"}}var x=8-c&7;for(f>>=x,m-=x;m>0;){var g=t[f<<14-m&16383];if(g.len)m-=g.len,s(g.lit,h,f,m,r,i,l,A,d,u),f=o.c,m=o.lc;else throw"hufDecode issues"}}(g,v,e,l,c,p,m,A,u,{value:0})}function d(e){for(var t=1;t<e.length;t++){var r=e[t-1]+e[t]-128;e[t]=r}}function f(e,t){for(var r=0,i=Math.floor((e.length+1)/2),n=0,a=e.length-1;!(n>a)&&(t[n++]=e[r++],!(n>a));){;t[n++]=e[i++]}}function m(e){for(var t=e.byteLength,r=[],i=0,n=new DataView(e);t>0;){var a=n.getInt8(i++);if(a<0){var o=-a;t-=o+1;for(var s=0;s<o;s++)r.push(n.getUint8(i++))}else{var o=a;t-=2;for(var l=n.getUint8(i++),s=0;s<o+1;s++)r.push(l)}}return r}function p(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function g(e){var t=new Uint8Array(m(e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size))),r=new Uint8Array(t.length);return d(t),f(t,r),new DataView(r.buffer)}function v(e){var t=uM(e.array.slice(e.offset.value,e.offset.value+e.size)),r=new Uint8Array(t.length);return d(t),f(t,r),new DataView(r.buffer)}function y(e){for(var t=e.viewer,r={value:e.offset.value},i=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),n=new Uint8Array(8192),a=0,o=Array(e.channels),s=0;s<e.channels;s++)o[s]={},o[s].start=a,o[s].end=o[s].start,o[s].nx=e.width,o[s].ny=e.lines,o[s].size=e.type,a+=o[s].nx*o[s].ny*o[s].size;var l=D(t,r),d=D(t,r);if(d>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(l<=d)for(var s=0;s<d-l+1;s++)n[s+l]=b(t,r);var f=new Uint16Array(65536),m=function(e,t){for(var r=0,i=0;i<65536;++i)(0==i||e[i>>3]&1<<(7&i))&&(t[r++]=i);for(var n=r-1;r<65536;)t[r++]=0;return n}(n,f),p=w(t,r);A(e.array,t,r,p,i,a);for(var s=0;s<e.channels;++s)for(var g=o[s],v=0;v<o[s].size;++v)!function(e,t,r,i,n,a,o){for(var s=o<16384,l=r>n?n:r,A=1;A<=l;)A<<=1;for(A>>=1,d=A,A>>=1;A>=1;){for(var d,f,m,p,g,v=0,y=0+a*(n-d),x=a*A,E=a*d,C=i*A,B=i*d;v<=y;v+=E){for(var w=v,I=v+i*(r-d);w<=I;w+=B){var b=w+C,_=w+x,M=_+C;s?(h(e[w+t],e[_+t]),f=c.a,p=c.b,h(e[b+t],e[M+t]),m=c.a,g=c.b,h(f,m),e[w+t]=c.a,e[b+t]=c.b,h(p,g)):(u(e[w+t],e[_+t]),f=c.a,p=c.b,u(e[b+t],e[M+t]),m=c.a,g=c.b,u(f,m),e[w+t]=c.a,e[b+t]=c.b,u(p,g)),e[_+t]=c.a,e[M+t]=c.b}if(r&A){var _=w+x;s?h(e[w+t],e[_+t]):u(e[w+t],e[_+t]),f=c.a,e[_+t]=c.b,e[w+t]=f}}if(n&A)for(var w=v,I=v+i*(r-d);w<=I;w+=B){var b=w+C;s?h(e[w+t],e[b+t]):u(e[w+t],e[b+t]),f=c.a,e[b+t]=c.b,e[w+t]=f}d=A,A>>=1}}(i,g.start+v,g.nx,g.size,g.ny,g.nx*g.size,m);for(var y=a,x=0;x<y;++x)i[x]=f[i[x]];for(var E=0,C=new Uint8Array(i.buffer.byteLength),B=0;B<e.lines;B++)for(var I=0;I<e.channels;I++){var g=o[I],_=g.nx*g.size,M=new Uint8Array(i.buffer,2*g.end,2*_);C.set(M,E),E+=2*_,g.end+=_}return new DataView(C.buffer)}function x(e){var t=uM(e.array.slice(e.offset.value,e.offset.value+e.size));let r=e.lines*e.channels*e.width,i=1==e.type?new Uint16Array(r):new Uint32Array(r),n=0,a=0,o=[,,,,];for(let r=0;r<e.lines;r++)for(let r=0;r<e.channels;r++){let r=0;switch(e.type){case 1:o[0]=n,o[1]=o[0]+e.width,n=o[1]+e.width;for(let n=0;n<e.width;++n)r+=t[o[0]++]<<8|t[o[1]++],i[a]=r,a++;break;case 2:o[0]=n,o[1]=o[0]+e.width,o[2]=o[1]+e.width,n=o[2]+e.width;for(let n=0;n<e.width;++n)r+=t[o[0]++]<<24|t[o[1]++]<<16|t[o[2]++]<<8,i[a]=r,a++}}return new DataView(i.buffer)}function E(e){var t=e.viewer,r={value:e.offset.value},i=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),n={version:_(t,r),unknownUncompressedSize:_(t,r),unknownCompressedSize:_(t,r),acCompressedSize:_(t,r),dcCompressedSize:_(t,r),rleCompressedSize:_(t,r),rleUncompressedSize:_(t,r),rleRawSize:_(t,r),totalAcUncompressedCount:_(t,r),totalDcUncompressedCount:_(t,r),acCompression:_(t,r)};if(n.version<2)throw"EXRLoader.parse: "+U.compression+" version "+n.version+" is unsupported";for(var a=[],o=D(t,r)-2;o>0;){var s=C(t.buffer,r),l=b(t,r),c=l>>2&3,h=new Int8Array([(l>>4)-1])[0],u=b(t,r);a.push({name:s,index:h,type:u,compression:c}),o-=s.length+3}for(var d=U.channels,f=Array(e.channels),p=0;p<e.channels;++p){var g=f[p]={},y=d[p];g.name=y.name,g.compression=0,g.decoded=!1,g.type=y.pixelType,g.pLinear=y.pLinear,g.width=e.width,g.height=e.lines}for(var x={idx:[,,,]},E=0;E<e.channels;++E)for(var g=f[E],p=0;p<a.length;++p){var B=a[p];g.name==B.name&&(g.compression=B.compression,B.index>=0&&(x.idx[B.index]=E),g.offset=E)}if(n.acCompressedSize>0)switch(n.acCompression){case 0:var w=new Uint16Array(n.totalAcUncompressedCount);A(e.array,t,r,n.acCompressedSize,w,n.totalAcUncompressedCount);break;case 1:var I=e.array.slice(r.value,r.value+n.totalAcUncompressedCount),M=uM(I),w=new Uint16Array(M.buffer);r.value+=n.totalAcUncompressedCount}if(n.dcCompressedSize>0){var S=new Uint16Array(v({array:e.array,offset:r,size:n.dcCompressedSize}).buffer);r.value+=n.dcCompressedSize}if(n.rleRawSize>0){var I=e.array.slice(r.value,r.value+n.rleCompressedSize),M=uM(I),F=m(M.buffer);r.value+=n.rleCompressedSize}for(var R=0,P=Array(f.length),p=0;p<P.length;++p)P[p]=[];for(var Q=0;Q<e.lines;++Q)for(var z=0;z<f.length;++z)P[z].push(R),R+=f[z].width*e.type*2;!function(e,t,r,i,n,a){var o=new DataView(a.buffer),s=r[e.idx[0]].width,l=r[e.idx[0]].height,c=Math.floor(s/8),h=Math.ceil(s/8),u=Math.ceil(l/8),A=s-(h-1)*8,d=l-(u-1)*8,f={value:0},m=[,,,],p=[,,,],g=[,,,],v=[,,,],y=[,,,];for(let r=0;r<3;++r)y[r]=t[e.idx[r]],m[r]=r<1?0:m[r-1]+h*u,p[r]=new Float32Array(64),g[r]=new Uint16Array(64),v[r]=new Uint16Array(64*h);for(let t=0;t<u;++t){var x,E,C=8;t==u-1&&(C=d);var B=8;for(let e=0;e<h;++e){e==h-1&&(B=A);for(let e=0;e<3;++e){g[e].fill(0),g[e][0]=n[m[e]++],function(e,t,r){for(var i,n=1;n<64;)65280==(i=t[e.value])?n=64:i>>8==255?n+=255&i:(r[n]=i,n++),e.value++}(f,i,g[e]),x=g[e],(E=p[e])[0]=T(x[0]),E[1]=T(x[1]),E[2]=T(x[5]),E[3]=T(x[6]),E[4]=T(x[14]),E[5]=T(x[15]),E[6]=T(x[27]),E[7]=T(x[28]),E[8]=T(x[2]),E[9]=T(x[4]),E[10]=T(x[7]),E[11]=T(x[13]),E[12]=T(x[16]),E[13]=T(x[26]),E[14]=T(x[29]),E[15]=T(x[42]),E[16]=T(x[3]),E[17]=T(x[8]),E[18]=T(x[12]),E[19]=T(x[17]),E[20]=T(x[25]),E[21]=T(x[30]),E[22]=T(x[41]),E[23]=T(x[43]),E[24]=T(x[9]),E[25]=T(x[11]),E[26]=T(x[18]),E[27]=T(x[24]),E[28]=T(x[31]),E[29]=T(x[40]),E[30]=T(x[44]),E[31]=T(x[53]),E[32]=T(x[10]),E[33]=T(x[19]),E[34]=T(x[23]),E[35]=T(x[32]),E[36]=T(x[39]),E[37]=T(x[45]),E[38]=T(x[52]),E[39]=T(x[54]),E[40]=T(x[20]),E[41]=T(x[22]),E[42]=T(x[33]),E[43]=T(x[38]),E[44]=T(x[46]),E[45]=T(x[51]),E[46]=T(x[55]),E[47]=T(x[60]),E[48]=T(x[21]),E[49]=T(x[34]),E[50]=T(x[37]),E[51]=T(x[47]),E[52]=T(x[50]),E[53]=T(x[56]),E[54]=T(x[59]),E[55]=T(x[61]),E[56]=T(x[35]),E[57]=T(x[36]),E[58]=T(x[48]),E[59]=T(x[49]),E[60]=T(x[57]),E[61]=T(x[58]),E[62]=T(x[62]),E[63]=T(x[63]),function(e){let t=.5*Math.cos(3.14159/16),r=.5*Math.cos(3.14159/8),i=.5*Math.cos(3*3.14159/16),n=.5*Math.cos(3*3.14159/8);for(var a=[,,,,],o=[,,,,],s=[,,,,],l=[,,,,],c=0;c<8;++c){var h=8*c;a[0]=r*e[h+2],a[1]=n*e[h+2],a[2]=r*e[h+6],a[3]=n*e[h+6],o[0]=t*e[h+1]+i*e[h+3]+.2777854612564676*e[h+5]+.09754573032714427*e[h+7],o[1]=i*e[h+1]-.09754573032714427*e[h+3]-t*e[h+5]-.2777854612564676*e[h+7],o[2]=.2777854612564676*e[h+1]-t*e[h+3]+.09754573032714427*e[h+5]+i*e[h+7],o[3]=.09754573032714427*e[h+1]-.2777854612564676*e[h+3]+i*e[h+5]-t*e[h+7],s[0]=.35355362513961314*(e[h+0]+e[h+4]),s[3]=.35355362513961314*(e[h+0]-e[h+4]),s[1]=a[0]+a[3],s[2]=a[1]-a[2],l[0]=s[0]+s[1],l[1]=s[3]+s[2],l[2]=s[3]-s[2],l[3]=s[0]-s[1],e[h+0]=l[0]+o[0],e[h+1]=l[1]+o[1],e[h+2]=l[2]+o[2],e[h+3]=l[3]+o[3],e[h+4]=l[3]-o[3],e[h+5]=l[2]-o[2],e[h+6]=l[1]-o[1],e[h+7]=l[0]-o[0]}for(var u=0;u<8;++u)a[0]=r*e[16+u],a[1]=n*e[16+u],a[2]=r*e[48+u],a[3]=n*e[48+u],o[0]=t*e[8+u]+i*e[24+u]+.2777854612564676*e[40+u]+.09754573032714427*e[56+u],o[1]=i*e[8+u]-.09754573032714427*e[24+u]-t*e[40+u]-.2777854612564676*e[56+u],o[2]=.2777854612564676*e[8+u]-t*e[24+u]+.09754573032714427*e[40+u]+i*e[56+u],o[3]=.09754573032714427*e[8+u]-.2777854612564676*e[24+u]+i*e[40+u]-t*e[56+u],s[0]=.35355362513961314*(e[u]+e[32+u]),s[3]=.35355362513961314*(e[u]-e[32+u]),s[1]=a[0]+a[3],s[2]=a[1]-a[2],l[0]=s[0]+s[1],l[1]=s[3]+s[2],l[2]=s[3]-s[2],l[3]=s[0]-s[1],e[0+u]=l[0]+o[0],e[8+u]=l[1]+o[1],e[16+u]=l[2]+o[2],e[24+u]=l[3]+o[3],e[32+u]=l[3]-o[3],e[40+u]=l[2]-o[2],e[48+u]=l[1]-o[1],e[56+u]=l[0]-o[0]}(p[e])}for(var w=p,I=0;I<64;++I){var b=w[0][I],_=w[1][I],M=w[2][I];w[0][I]=b+1.5747*M,w[1][I]=b-.1873*_-.4682*M,w[2][I]=b+1.8556*_}for(let t=0;t<3;++t)!function(e,t,r){for(var i,n=0;n<64;++n){t[r+n]=pX.DataUtils.toHalfFloat((i=e[n])<=1?Math.sign(i)*Math.pow(Math.abs(i),2.2):Math.sign(i)*Math.pow(9.025013291561939,Math.abs(i)-1))}}(p[t],v[t],64*e)}let a=0;for(let i=0;i<3;++i){let n=r[e.idx[i]].type;for(let e=8*t;e<8*t+C;++e){a=y[i][e];for(let t=0;t<c;++t){let r=64*t+(7&e)*8;o.setUint16(a+0*n,v[i][r+0],!0),o.setUint16(a+2*n,v[i][r+1],!0),o.setUint16(a+4*n,v[i][r+2],!0),o.setUint16(a+6*n,v[i][r+3],!0),o.setUint16(a+8*n,v[i][r+4],!0),o.setUint16(a+10*n,v[i][r+5],!0),o.setUint16(a+12*n,v[i][r+6],!0),o.setUint16(a+14*n,v[i][r+7],!0),a+=16*n}}if(c!=h)for(let e=8*t;e<8*t+C;++e){let t=y[i][e]+8*c*2*n,r=64*c+(7&e)*8;for(let e=0;e<B;++e)o.setUint16(t+2*e*n,v[i][r+e],!0)}}}for(var S=new Uint16Array(s),o=new DataView(a.buffer),D=0;D<3;++D){r[e.idx[D]].decoded=!0;var F=r[e.idx[D]].type;if(2==r[D].type)for(var R=0;R<l;++R){let e=y[D][R];for(var P=0;P<s;++P)S[P]=o.getUint16(e+2*P*F,!0);for(var P=0;P<s;++P)o.setFloat32(e+2*P*F,T(S[P]),!0)}}}(x,P,f,w,S,i);for(var p=0;p<f.length;++p){var g=f[p];if(!g.decoded)if(2===g.compression)for(var k=0,L=0,Q=0;Q<e.lines;++Q){for(var O=P[p][k],G=0;G<g.width;++G){for(var N=0;N<2*g.type;++N)i[O++]=F[L+N*g.width*g.height];L++}k++}else throw"EXRLoader.parse: unsupported channel compression"}return new DataView(i.buffer)}function C(e,t){for(var r=new Uint8Array(e),i=0;0!=r[t.value+i];)i+=1;var n=new TextDecoder().decode(r.slice(t.value,t.value+i));return t.value=t.value+i+1,n}function B(e,t){var r=e.getInt32(t.value,!0);return t.value=t.value+4,r}function w(e,t){var r=e.getUint32(t.value,!0);return t.value=t.value+4,r}function I(e,t){var r=e[t.value];return t.value=t.value+1,r}function b(e,t){var r=e.getUint8(t.value);return t.value=t.value+1,r}let _=function(e,t){let r;return r="getBigInt64"in DataView.prototype?Number(e.getBigInt64(t.value,!0)):e.getUint32(t.value+4,!0)+Number(e.getUint32(t.value,!0)<<32),t.value+=8,r};function M(e,t){var r=e.getFloat32(t.value,!0);return t.value+=4,r}function S(e,t){return pX.DataUtils.toHalfFloat(M(e,t))}function T(e){var t=(31744&e)>>10,r=1023&e;return(e>>15?-1:1)*(t?31===t?r?NaN:1/0:Math.pow(2,t-15)*(1+r/1024):r/1024*6103515625e-14)}function D(e,t){var r=e.getUint16(t.value,!0);return t.value+=2,r}function F(e,t){return T(D(e,t))}let R=new DataView(e),P=new Uint8Array(e),Q={value:0},U=function(e,t,r){let i={};if(0x1312f76!=e.getUint32(0,!0))throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";i.version=e.getUint8(4);let n=e.getUint8(5);i.spec={singleTile:!!(2&n),longName:!!(4&n),deepFormat:!!(8&n),multiPart:!!(16&n)},r.value=8;for(var a=!0;a;){var o=C(t,r);if(0==o)a=!1;else{var s=C(t,r),l=w(e,r),c=function(e,t,r,i,n){var a,o,s,l,c,h,u;if("string"===i||"stringvector"===i||"iccProfile"===i)return a=new TextDecoder().decode(new Uint8Array(t).slice(r.value,r.value+n)),r.value=r.value+n,a;if("chlist"===i)return function(e,t,r,i){for(var n=r.value,a=[];r.value<n+i-1;){var o=C(t,r),s=B(e,r),l=b(e,r);r.value+=3;var c=B(e,r),h=B(e,r);a.push({name:o,pixelType:s,pLinear:l,xSampling:c,ySampling:h})}return r.value+=1,a}(e,t,r,n);if("chromaticities"===i)return o=M(e,r),s=M(e,r),l=M(e,r),c=M(e,r),h=M(e,r),{redX:o,redY:s,greenX:l,greenY:c,blueX:h,blueY:M(e,r),whiteX:M(e,r),whiteY:M(e,r)};if("compression"===i)return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][b(e,r)];if("box2i"===i)return u=w(e,r),{xMin:u,yMin:w(e,r),xMax:w(e,r),yMax:w(e,r)};else if("lineOrder"===i)return["INCREASING_Y"][b(e,r)];else if("float"===i)return M(e,r);else if("v2f"===i)return[M(e,r),M(e,r)];else if("v3f"===i)return[M(e,r),M(e,r),M(e,r)];else if("int"===i)return B(e,r);else if("rational"===i)return[B(e,r),w(e,r)];else if("timecode"===i)return[w(e,r),w(e,r)];else return"preview"===i?(r.value+=n,"skipped"):(r.value+=n,void 0)}(e,t,r,s,l);void 0===c?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${s}'.`):i[o]=c}}if((-5&n)!=0)throw console.error("EXRHeader:",i),"THREE.EXRLoader: provided file is currently unsupported.";return i}(R,e,Q),z=function(e,t,r,i,n){let a={size:0,viewer:t,array:r,offset:i,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[pq?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":a.lines=1,a.uncompress=p;break;case"RLE_COMPRESSION":a.lines=1,a.uncompress=g;break;case"ZIPS_COMPRESSION":a.lines=1,a.uncompress=v;break;case"ZIP_COMPRESSION":a.lines=16,a.uncompress=v;break;case"PIZ_COMPRESSION":a.lines=32,a.uncompress=y;break;case"PXR24_COMPRESSION":a.lines=16,a.uncompress=x;break;case"DWAA_COMPRESSION":a.lines=32,a.uncompress=E;break;case"DWAB_COMPRESSION":a.lines=256,a.uncompress=E;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(a.scanlineBlockSize=a.lines,1==a.type)switch(n){case pX.FloatType:a.getter=F,a.inputSize=2;break;case pX.HalfFloatType:a.getter=D,a.inputSize=2}else if(2==a.type)switch(n){case pX.FloatType:a.getter=M,a.inputSize=4;break;case pX.HalfFloatType:a.getter=S,a.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+a.type+" for "+e.compression+".";a.blockCount=(e.dataWindow.yMax+1)/a.scanlineBlockSize;for(var o=0;o<a.blockCount;o++)_(t,i);a.outputChannels=3==a.channels?4:a.channels;let s=a.width*a.height*a.outputChannels;switch(n){case pX.FloatType:a.byteArray=new Float32Array(s),a.channels<a.outputChannels&&a.byteArray.fill(1,0,s);break;case pX.HalfFloatType:a.byteArray=new Uint16Array(s),a.channels<a.outputChannels&&a.byteArray.fill(15360,0,s);break;default:console.error("THREE.EXRLoader: unsupported type: ",n)}return a.bytesPerLine=a.width*a.inputSize*a.channels,4==a.outputChannels?a.format=pX.RGBAFormat:a.format=pX.RedFormat,pq?a.colorSpace="srgb-linear":a.encoding=3e3,a}(U,R,P,Q,this.type),k={value:0},L={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<z.height/z.scanlineBlockSize;e++){let t=w(R,Q);z.size=w(R,Q),z.lines=t+z.scanlineBlockSize>z.height?z.height-t:z.scanlineBlockSize;let r=z.size<z.lines*z.bytesPerLine?z.uncompress(z):p(z);Q.value+=z.size;for(let t=0;t<z.scanlineBlockSize;t++){let i=t+e*z.scanlineBlockSize;if(i>=z.height)break;for(let e=0;e<z.channels;e++){let n=L[U.channels[e].name];for(let a=0;a<z.width;a++){k.value=(t*(z.channels*z.width)+e*z.width+a)*z.inputSize;let o=(z.height-1-i)*(z.width*z.outputChannels)+a*z.outputChannels+n;z.byteArray[o]=z.getter(r,k)}}}}return{header:U,width:z.width,height:z.height,data:z.byteArray,format:z.format,[pq?"colorSpace":"encoding"]:z[pq?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,t,r,i){return super.load(e,function(e,r){pq?e.colorSpace=r.colorSpace:e.encoding=r.encoding,e.minFilter=pX.LinearFilter,e.magFilter=pX.LinearFilter,e.generateMipmaps=!1,e.flipY=!1,t&&t(e,r)},r,i)}}let p$=(e,t,r)=>{let i;switch(e){case tw.UnsignedByteType:i=new Uint8ClampedArray(t*r*4);break;case tw.HalfFloatType:i=new Uint16Array(t*r*4);break;case tw.UnsignedIntType:i=new Uint32Array(t*r*4);break;case tw.ByteType:i=new Int8Array(t*r*4);break;case tw.ShortType:i=new Int16Array(t*r*4);break;case tw.IntType:i=new Int32Array(t*r*4);break;case tw.FloatType:i=new Float32Array(t*r*4);break;default:throw Error("Unsupported data type")}return i};class p1{_renderer;_rendererIsDisposable=!1;_material;_scene;_camera;_quad;_renderTarget;_width;_height;_type;_colorSpace;_supportsReadPixels=!0;constructor(e){this._width=e.width,this._height=e.height,this._type=e.type,this._colorSpace=e.colorSpace;const t={format:tw.RGBAFormat,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:e.renderTargetOptions?.anisotropy!==void 0?e.renderTargetOptions?.anisotropy:1,generateMipmaps:e.renderTargetOptions?.generateMipmaps!==void 0&&e.renderTargetOptions?.generateMipmaps,magFilter:e.renderTargetOptions?.magFilter!==void 0?e.renderTargetOptions?.magFilter:tw.LinearFilter,minFilter:e.renderTargetOptions?.minFilter!==void 0?e.renderTargetOptions?.minFilter:tw.LinearFilter,samples:e.renderTargetOptions?.samples!==void 0?e.renderTargetOptions?.samples:void 0,wrapS:e.renderTargetOptions?.wrapS!==void 0?e.renderTargetOptions?.wrapS:tw.ClampToEdgeWrapping,wrapT:e.renderTargetOptions?.wrapT!==void 0?e.renderTargetOptions?.wrapT:tw.ClampToEdgeWrapping};if(this._material=e.material,e.renderer?this._renderer=e.renderer:(this._renderer=p1.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new tw.Scene,this._camera=new tw.OrthographicCamera,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!((e,t,r,i)=>{if(void 0!==N)return N;let n=new tw.WebGLRenderTarget(1,1,i);t.setRenderTarget(n);let a=new tw.Mesh(new tw.PlaneGeometry,new tw.MeshBasicMaterial({color:0xffffff}));t.render(a,r),t.setRenderTarget(null);let o=p$(e,n.width,n.height);return t.readRenderTargetPixels(n,0,0,n.width,n.height,o),n.dispose(),a.geometry.dispose(),a.material.dispose(),N=0!==o[0]})(this._type,this._renderer,this._camera,t)){let e;this._type===tw.HalfFloatType&&(e=this._renderer.extensions.has("EXT_color_buffer_float")?tw.FloatType:void 0),void 0!==e?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${tw.FloatType}`),this._type=e):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new tw.Mesh(new tw.PlaneGeometry,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new tw.WebGLRenderTarget(this.width,this.height,t),this._renderTarget.texture.mapping=e.renderTargetOptions?.mapping!==void 0?e.renderTargetOptions?.mapping:tw.UVMapping}static instantiateRenderer(){let e=new nw.WebGLRenderer;return e.setSize(128,128),e}render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(e){throw this._renderer.setRenderTarget(null),e}this._renderer.setRenderTarget(null)};toArray(){if(!this._supportsReadPixels)throw Error("Can't read pixels in this browser");let e=p$(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,e),e}toDataTexture(e){let t=new tw.DataTexture(this.toArray(),this.width,this.height,tw.RGBAFormat,this._type,e?.mapping||tw.UVMapping,e?.wrapS||tw.ClampToEdgeWrapping,e?.wrapT||tw.ClampToEdgeWrapping,e?.magFilter||tw.LinearFilter,e?.minFilter||tw.LinearFilter,e?.anisotropy||1,tw.LinearSRGBColorSpace);return t.generateMipmaps=e?.generateMipmaps!==void 0&&e?.generateMipmaps,t}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(e){this.disposeOnDemandRenderer(),e&&this.renderTarget.dispose(),this.material instanceof tw.ShaderMaterial&&Object.values(this.material.uniforms).forEach(e=>{e.value instanceof tw.Texture&&e.value.dispose()}),Object.values(this.material).forEach(e=>{e instanceof tw.Texture&&e.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(e){this._width=e,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(e){this._height=e,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(e){this._renderTarget=e,this._width=e.width,this._height=e.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}var p0=tw;class p2 extends Error{}class p3 extends Error{}let p4=(e,t,r)=>{let i=RegExp(`${t}="([^"]*)"`,"i").exec(e);if(i)return i[1];let n=RegExp(`<${t}[^>]*>([\\s\\S]*?)</${t}>`,"i").exec(e);if(n){let e=n[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return e&&3===e.length?e.map(e=>e.replace(/<\/?rdf:li>/g,"")):n[1].trim()}if(void 0!==r)return r;throw Error(`Can't find ${t} in gainmap metadata`)};class p5{options;constructor(e){this.options={debug:!!e&&void 0!==e.debug&&e.debug,extractFII:!e||void 0===e.extractFII||e.extractFII,extractNonFII:!e||void 0===e.extractNonFII||e.extractNonFII}}extract(e){return new Promise((t,r)=>{let i,n=this.options.debug,a=new DataView(e.buffer);if(65496!==a.getUint16(0))return void r(Error("Not a valid jpeg"));let o=a.byteLength,s=2,l=0;for(;s<o;){if(++l>250)return void r(Error(`Found no marker after ${l} loops `));if(255!==a.getUint8(s))return void r(Error(`Not a valid marker at offset 0x${s.toString(16)}, found: 0x${a.getUint8(s).toString(16)}`));if(i=a.getUint8(s+1),n&&console.log(`Marker: ${i.toString(16)}`),226===i){n&&console.log("Found APP2 marker (0xffe2)");let e=s+4;if(0x4d504600===a.getUint32(e)){let i,n=e+4;if(18761===a.getUint16(n))i=!1;else{if(19789!==a.getUint16(n))return void r(Error("No valid endianness marker found in TIFF header"));i=!0}if(42!==a.getUint16(n+2,!i))return void r(Error("Not valid TIFF data! (no 0x002A marker)"));let o=a.getUint32(n+4,!i);if(o<8)return void r(Error("Not valid TIFF data! (First offset less than 8)"));let s=n+o,l=a.getUint16(s,!i),c=s+2,h=0;for(let e=c;e<c+12*l;e+=12)45057===a.getUint16(e,!i)&&(h=a.getUint32(e+8,!i));let u=s+2+12*l+4,A=[];for(let e=u;e<u+16*h;e+=16){let t={MPType:a.getUint32(e,!i),size:a.getUint32(e+4,!i),dataOffset:a.getUint32(e+8,!i),dependantImages:a.getUint32(e+12,!i),start:-1,end:-1,isFII:!1};t.dataOffset?(t.start=n+t.dataOffset,t.isFII=!1):(t.start=0,t.isFII=!0),t.end=t.start+t.size,A.push(t)}if(this.options.extractNonFII&&A.length){let e=new Blob([a]),r=[];for(let t of A){if(t.isFII&&!this.options.extractFII)continue;let i=e.slice(t.start,t.end+1,"image/jpeg");r.push(i)}t(r)}}}s+=2+a.getUint16(s+2)}})}}let p6=async e=>{let t=(e=>{let t,r=(t="undefined"!=typeof TextDecoder?new TextDecoder().decode(e):e.toString()).indexOf("<x:xmpmeta");for(;-1!==r;){let e=t.indexOf("x:xmpmeta>",r),i=t.slice(r,e+10);try{let e=p4(i,"hdrgm:GainMapMin","0"),t=p4(i,"hdrgm:GainMapMax"),r=p4(i,"hdrgm:Gamma","1"),n=p4(i,"hdrgm:OffsetSDR","0.015625"),a=p4(i,"hdrgm:OffsetHDR","0.015625"),o=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(i),s=o?o[1]:"0",l=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(i);if(!l)throw Error("Incomplete gainmap metadata");let c=l[1];return{gainMapMin:Array.isArray(e)?e.map(e=>parseFloat(e)):[parseFloat(e),parseFloat(e),parseFloat(e)],gainMapMax:Array.isArray(t)?t.map(e=>parseFloat(e)):[parseFloat(t),parseFloat(t),parseFloat(t)],gamma:Array.isArray(r)?r.map(e=>parseFloat(e)):[parseFloat(r),parseFloat(r),parseFloat(r)],offsetSdr:Array.isArray(n)?n.map(e=>parseFloat(e)):[parseFloat(n),parseFloat(n),parseFloat(n)],offsetHdr:Array.isArray(a)?a.map(e=>parseFloat(e)):[parseFloat(a),parseFloat(a),parseFloat(a)],hdrCapacityMin:parseFloat(s),hdrCapacityMax:parseFloat(c)}}catch(e){}r=t.indexOf("<x:xmpmeta",e)}})(e);if(!t)throw new p3("Gain map XMP metadata not found");let r=new p5({extractFII:!0,extractNonFII:!0}),i=await r.extract(e);if(2!==i.length)throw new p2("Gain map recovery image not found");return{sdr:new Uint8Array(await i[0].arrayBuffer()),gainMap:new Uint8Array(await i[1].arrayBuffer()),metadata:t}},p8=e=>new Promise((t,r)=>{let i=document.createElement("img");i.onload=()=>{t(i)},i.onerror=e=>{r(e)},i.src=URL.createObjectURL(e)});class p9 extends p0.Loader{_renderer;_renderTargetOptions;_internalLoadingManager;_config;constructor(e,t){super(t),this._config=e,e.renderer&&(this._renderer=e.renderer),this._internalLoadingManager=new p0.LoadingManager}setRenderer(e){return this._renderer=e,this}setRenderTargetOptions(e){return this._renderTargetOptions=e,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: A Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");let e=this._config.createMaterial({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new p0.Texture,sdr:new p0.Texture});return this._config.createQuadRenderer({width:16,height:16,type:p0.HalfFloatType,colorSpace:p0.LinearSRGBColorSpace,material:e,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async processImages(e,t,r){let i,n,a=t?new Blob([t],{type:"image/jpeg"}):void 0,o=new Blob([e],{type:"image/jpeg"}),s=!1;if("undefined"==typeof createImageBitmap){let e=await Promise.all([a?p8(a):Promise.resolve(void 0),p8(o)]);n=e[0],i=e[1],s="flipY"===r}else{let e=await Promise.all([a?createImageBitmap(a,{imageOrientation:r||"flipY"}):Promise.resolve(void 0),createImageBitmap(o,{imageOrientation:r||"flipY"})]);n=e[0],i=e[1]}return{sdrImage:i,gainMapImage:n,needsFlip:s}}createTextures(e,t,r){let i=new p0.Texture(t||new ImageData(2,2),p0.UVMapping,p0.ClampToEdgeWrapping,p0.ClampToEdgeWrapping,p0.LinearFilter,p0.LinearMipMapLinearFilter,p0.RGBAFormat,p0.UnsignedByteType,1,p0.LinearSRGBColorSpace);i.flipY=r,i.needsUpdate=!0;let n=new p0.Texture(e,p0.UVMapping,p0.ClampToEdgeWrapping,p0.ClampToEdgeWrapping,p0.LinearFilter,p0.LinearMipMapLinearFilter,p0.RGBAFormat,p0.UnsignedByteType,1,p0.SRGBColorSpace);return n.flipY=r,n.needsUpdate=!0,{gainMap:i,sdr:n}}updateQuadRenderer(e,t,r,i,n){e.width=t.width,e.height=t.height,e.material.gainMap=r,e.material.sdr=i,e.material.gainMapMin=n.gainMapMin,e.material.gainMapMax=n.gainMapMax,e.material.offsetHdr=n.offsetHdr,e.material.offsetSdr=n.offsetSdr,e.material.gamma=n.gamma,e.material.hdrCapacityMin=n.hdrCapacityMin,e.material.hdrCapacityMax=n.hdrCapacityMax,e.material.maxDisplayBoost=Math.pow(2,n.hdrCapacityMax),e.material.needsUpdate=!0}}var p7=tw;let ge=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,gt=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class gr extends p7.ShaderMaterial{_maxDisplayBoost;_hdrCapacityMin;_hdrCapacityMax;constructor({gamma:e,offsetHdr:t,offsetSdr:r,gainMapMin:i,gainMapMax:n,maxDisplayBoost:a,hdrCapacityMin:o,hdrCapacityMax:s,sdr:l,gainMap:c}){super({name:"GainMapDecoderMaterial",vertexShader:ge,fragmentShader:gt,uniforms:{sdr:{value:l},gainMap:{value:c},gamma:{value:new p7.Vector3(1/e[0],1/e[1],1/e[2])},offsetHdr:{value:new p7.Vector3().fromArray(t)},offsetSdr:{value:new p7.Vector3().fromArray(r)},gainMapMin:{value:new p7.Vector3().fromArray(i)},gainMapMax:{value:new p7.Vector3().fromArray(n)},weightFactor:{value:(Math.log2(a)-o)/(s-o)}},blending:p7.NoBlending,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=a,this._hdrCapacityMin=o,this._hdrCapacityMax=s,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(e){this.uniforms.sdr.value=e}get gainMap(){return this.uniforms.gainMap.value}set gainMap(e){this.uniforms.gainMap.value=e}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(e){this.uniforms.offsetHdr.value.fromArray(e)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(e){this.uniforms.offsetSdr.value.fromArray(e)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(e){this.uniforms.gainMapMin.value.fromArray(e)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(e){this.uniforms.gainMapMax.value.fromArray(e)}get gamma(){let e=this.uniforms.gamma.value;return[1/e.x,1/e.y,1/e.z]}set gamma(e){let t=this.uniforms.gamma.value;t.x=1/e[0],t.y=1/e[1],t.z=1/e[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(e){this._hdrCapacityMin=e,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(e){this._hdrCapacityMax=e,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(e){this._maxDisplayBoost=Math.max(1,Math.min(65504,e)),this.calculateWeight()}calculateWeight(){let e=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,e))}}nw.WebGLRenderer;class gi extends p9{constructor(e,t){super({renderer:e,createMaterial:e=>new gr(e),createQuadRenderer:e=>new p1(e)},t)}async render(e,t,r,i){let{sdrImage:n,gainMapImage:a,needsFlip:o}=await this.processImages(r,i,"flipY"),{gainMap:s,sdr:l}=this.createTextures(n,a,o);this.updateQuadRenderer(e,n,s,l,t),e.render()}}class gn extends gi{load([e,t,r],i,n,a){let o,s,l,c=this.prepareQuadRenderer(),h=async()=>{if(o&&s&&l){try{await this.render(c,l,o,s)}catch(i){this.manager.itemError(e),this.manager.itemError(t),this.manager.itemError(r),"function"==typeof a&&a(i),c.disposeOnDemandRenderer();return}"function"==typeof i&&i(c),this.manager.itemEnd(e),this.manager.itemEnd(t),this.manager.itemEnd(r),c.disposeOnDemandRenderer()}},u=!0,A=0,d=0,f=!0,m=0,p=0,g=!0,v=0,y=0,x=()=>{"function"==typeof n&&n(new ProgressEvent("progress",{lengthComputable:u&&f&&g,loaded:d+p+y,total:A+m+v}))};this.manager.itemStart(e),this.manager.itemStart(t),this.manager.itemStart(r);let E=new p7.FileLoader(this._internalLoadingManager);E.setResponseType("arraybuffer"),E.setRequestHeader(this.requestHeader),E.setPath(this.path),E.setWithCredentials(this.withCredentials),E.load(e,async e=>{if("string"==typeof e)throw Error("Invalid sdr buffer");o=e,await h()},e=>{u=e.lengthComputable,d=e.loaded,A=e.total,x()},t=>{this.manager.itemError(e),"function"==typeof a&&a(t)});let C=new p7.FileLoader(this._internalLoadingManager);C.setResponseType("arraybuffer"),C.setRequestHeader(this.requestHeader),C.setPath(this.path),C.setWithCredentials(this.withCredentials),C.load(t,async e=>{if("string"==typeof e)throw Error("Invalid gainmap buffer");s=e,await h()},e=>{f=e.lengthComputable,p=e.loaded,m=e.total,x()},e=>{this.manager.itemError(t),"function"==typeof a&&a(e)});let B=new p7.FileLoader(this._internalLoadingManager);return B.setRequestHeader(this.requestHeader),B.setPath(this.path),B.setWithCredentials(this.withCredentials),B.load(r,async e=>{if("string"!=typeof e)throw Error("Invalid metadata string");l=JSON.parse(e),await h()},e=>{g=e.lengthComputable,y=e.loaded,v=e.total,x()},e=>{this.manager.itemError(r),"function"==typeof a&&a(e)}),c}}class ga extends gi{load(e,t,r,i){let n=this.prepareQuadRenderer(),a=new p7.FileLoader(this._internalLoadingManager);return a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setPath(this.path),a.setWithCredentials(this.withCredentials),this.manager.itemStart(e),a.load(e,async r=>{let a,o,s;if("string"==typeof r)throw Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");let l=new Uint8Array(r);try{let e=await p6(l);a=e.sdr,o=e.gainMap,s=e.metadata}catch(t){if(t instanceof p3||t instanceof p2)console.warn(`Failure to reconstruct an HDR image from ${e}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),s={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},a=l;else throw t}try{await this.render(n,s,a.buffer,o?.buffer)}catch(t){this.manager.itemError(e),"function"==typeof i&&i(t),n.disposeOnDemandRenderer();return}"function"==typeof t&&t(n),this.manager.itemEnd(e),n.disposeOnDemandRenderer()},r,t=>{this.manager.itemError(e),"function"==typeof i&&i(t)}),n}}let go={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},gs="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",gl=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function gc({files:e=gl,path:t="",preset:r,colorSpace:i,extensions:n}={}){r&&(gA(r),e=go[r],t=gs);let a=Array.isArray(e),{extension:o,isCubemap:s}=gd(e),l=gf(o);if(!l)throw Error("useEnvironment: Unrecognized file extension: "+e);let c=(0,tI.C)(e=>e.gl);(0,tC.useLayoutEffect)(()=>{("webp"===o||"jpg"===o||"jpeg"===o)&&c.domElement.addEventListener("webglcontextlost",function(){nX.G.clear(l,a?[e]:e)},{once:!0})},[e,c.domElement]);let h=(0,nX.G)(l,a?[e]:e,e=>{("webp"===o||"jpg"===o||"jpeg"===o)&&e.setRenderer(c),null==e.setPath||e.setPath(t),n&&n(e)}),u=a?h[0]:h;if("jpg"===o||"jpeg"===o||"webp"===o){var A;u=null==(A=u.renderTarget)?void 0:A.texture}return u.mapping=s?tw.CubeReflectionMapping:tw.EquirectangularReflectionMapping,u.colorSpace=null!=i?i:s?"srgb":"srgb-linear",u}let gh={files:gl,path:"",preset:void 0,extensions:void 0};gc.preload=e=>{let t={...gh,...e},{files:r,path:i=""}=t,{preset:n,extensions:a}=t;n&&(gA(n),r=go[n],i=gs);let{extension:o}=gd(r);if("webp"===o||"jpg"===o||"jpeg"===o)throw Error("useEnvironment: Preloading gainmaps is not supported");let s=gf(o);if(!s)throw Error("useEnvironment: Unrecognized file extension: "+r);nX.G.preload(s,Array.isArray(r)?[r]:r,e=>{null==e.setPath||e.setPath(i),a&&a(e)})};let gu={files:gl,preset:void 0};function gA(e){if(!(e in go))throw Error("Preset must be one of: "+Object.keys(go).join(", "))}function gd(e){var t;let r=Array.isArray(e)&&6===e.length,i=Array.isArray(e)&&3===e.length&&e.some(e=>e.endsWith("json")),n=Array.isArray(e)?e[0]:e;return{extension:r?"cube":i?"webp":n.startsWith("data:application/exr")?"exr":n.startsWith("data:application/hdr")?"hdr":n.startsWith("data:image/jpeg")?"jpg":null==(t=n.split(".").pop())||null==(t=t.split("?"))||null==(t=t.shift())?void 0:t.toLowerCase(),isCubemap:r,isGainmap:i}}function gf(e){return"cube"===e?tw.CubeTextureLoader:"hdr"===e?pK:"exr"===e?pZ:"jpg"===e||"jpeg"===e?ga:"webp"===e?gn:null}function gm(e,t,r,i,n={}){var a,o,s,l,c;let h;n={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...n};let u=(h=c=t||r).current&&h.current.isScene?c.current:c,A=u.background,d=u.environment,f={backgroundBlurriness:u.backgroundBlurriness,backgroundIntensity:u.backgroundIntensity,backgroundRotation:null!=(a=null==(o=u.backgroundRotation)||null==o.clone?void 0:o.clone())?a:[0,0,0],environmentIntensity:u.environmentIntensity,environmentRotation:null!=(s=null==(l=u.environmentRotation)||null==l.clone?void 0:l.clone())?s:[0,0,0]};return"only"!==e&&(u.environment=i),e&&(u.background=i),(0,o0.s)(u,n),()=>{"only"!==e&&(u.environment=d),e&&(u.background=A),(0,o0.s)(u,f)}}function gp({scene:e,background:t=!1,map:r,...i}){let n=(0,tI.C)(e=>e.scene);return tC.useLayoutEffect(()=>{if(r)return gm(t,e,n,r,i)}),null}function gg({background:e=!1,scene:t,blur:r,backgroundBlurriness:i,backgroundIntensity:n,backgroundRotation:a,environmentIntensity:o,environmentRotation:s,...l}){let c=gc(l),h=(0,tI.C)(e=>e.scene);return tC.useLayoutEffect(()=>gm(e,t,h,c,{backgroundBlurriness:null!=r?r:i,backgroundIntensity:n,backgroundRotation:a,environmentIntensity:o,environmentRotation:s})),tC.useEffect(()=>()=>{c.dispose()},[c]),null}function gv({children:e,near:t=.1,far:r=1e3,resolution:i=256,frames:n=1,map:a,background:o=!1,blur:s,backgroundBlurriness:l,backgroundIntensity:c,backgroundRotation:h,environmentIntensity:u,environmentRotation:A,scene:d,files:f,path:m,preset:p,extensions:g}){let v=(0,tI.C)(e=>e.gl),y=(0,tI.C)(e=>e.scene),x=tC.useRef(null),[E]=tC.useState(()=>new tw.Scene),C=tC.useMemo(()=>{let e=new tw.WebGLCubeRenderTarget(i);return e.texture.type=tw.HalfFloatType,e},[i]);tC.useEffect(()=>()=>{C.dispose()},[C]),tC.useLayoutEffect(()=>{if(1===n){let e=v.autoClear;v.autoClear=!0,x.current.update(v,E),v.autoClear=e}return gm(o,d,y,C.texture,{backgroundBlurriness:null!=s?s:l,backgroundIntensity:c,backgroundRotation:h,environmentIntensity:u,environmentRotation:A})},[e,E,C.texture,d,y,o,n,v]);let B=1;return(0,tb.useFrame)(()=>{if(n===1/0||B<n){let e=v.autoClear;v.autoClear=!0,x.current.update(v,E),v.autoClear=e,B++}}),tC.createElement(tC.Fragment,null,(0,o4.o)(tC.createElement(tC.Fragment,null,e,tC.createElement("cubeCamera",{ref:x,args:[t,r,C]}),f||p?tC.createElement(gg,{background:!0,files:f,preset:p,path:m,extensions:g}):a?tC.createElement(gp,{background:!0,map:a,extensions:g}):null),E))}function gy(e){var t,r,i,n;let a=gc(e),o=e.map||a;tC.useMemo(()=>(0,on.e)({GroundProjectedEnvImpl:pY}),[]),tC.useEffect(()=>()=>{a.dispose()},[a]);let s=tC.useMemo(()=>[o],[o]),l=null==(t=e.ground)?void 0:t.height,c=null==(r=e.ground)?void 0:r.radius,h=null!=(i=null==(n=e.ground)?void 0:n.scale)?i:1e3;return tC.createElement(tC.Fragment,null,tC.createElement(gp,e2({},e,{map:o})),tC.createElement("groundProjectedEnvImpl",{args:s,scale:h,height:l,radius:c}))}function gx(e){return e.ground?tC.createElement(gy,e):e.map?tC.createElement(gp,e):e.children?tC.createElement(gv,e):tC.createElement(gg,e)}gc.clear=e=>{let t={...gu,...e},{files:r}=t,{preset:i}=t;i&&(gA(i),r=go[i]);let{extension:n}=gd(r),a=gf(n);if(!a)throw Error("useEnvironment: Unrecognized file extension: "+r);nX.G.clear(a,Array.isArray(r)?[r]:r)};var tI=tI;let gE={uniforms:{tDiffuse:{value:null},h:{value:1/512}},vertexShader:`
      varying vec2 vUv;

      void main() {

        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

      }
  `,fragmentShader:`
    uniform sampler2D tDiffuse;
    uniform float h;

    varying vec2 vUv;

    void main() {

    	vec4 sum = vec4( 0.0 );

    	sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;
    	sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;

    	gl_FragColor = sum;

    }
  `},gC={uniforms:{tDiffuse:{value:null},v:{value:1/512}},vertexShader:`
    varying vec2 vUv;

    void main() {

      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

    }
  `,fragmentShader:`

  uniform sampler2D tDiffuse;
  uniform float v;

  varying vec2 vUv;

  void main() {

    vec4 sum = vec4( 0.0 );

    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;
    sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;

    gl_FragColor = sum;

  }
  `},gB=tC.forwardRef(({scale:e=10,frames:t=1/0,opacity:r=1,width:i=1,height:n=1,blur:a=1,near:o=0,far:s=10,resolution:l=512,smooth:c=!0,color:h="#000000",depthWrite:u=!1,renderOrder:A,...d},f)=>{let m,p,g=tC.useRef(null),v=(0,tI.C)(e=>e.scene),y=(0,tI.C)(e=>e.gl),x=tC.useRef(null);i*=Array.isArray(e)?e[0]:e||1,n*=Array.isArray(e)?e[1]:e||1;let[E,C,B,w,I,b,_]=tC.useMemo(()=>{let e=new tw.WebGLRenderTarget(l,l),t=new tw.WebGLRenderTarget(l,l);t.texture.generateMipmaps=e.texture.generateMipmaps=!1;let r=new tw.PlaneGeometry(i,n).rotateX(Math.PI/2),a=new tw.Mesh(r),o=new tw.MeshDepthMaterial;o.depthTest=o.depthWrite=!1,o.onBeforeCompile=e=>{e.uniforms={...e.uniforms,ucolor:{value:new tw.Color(h)}},e.fragmentShader=e.fragmentShader.replace("void main() {",`uniform vec3 ucolor;
           void main() {
          `),e.fragmentShader=e.fragmentShader.replace("vec4( vec3( 1.0 - fragCoordZ ), opacity );","vec4( ucolor * fragCoordZ * 2.0, ( 1.0 - fragCoordZ ) * 1.0 );")};let s=new tw.ShaderMaterial(gE),c=new tw.ShaderMaterial(gC);return c.depthTest=s.depthTest=!1,[e,r,o,a,s,c,t]},[l,i,n,e,h]),M=e=>{w.visible=!0,w.material=I,I.uniforms.tDiffuse.value=E.texture,I.uniforms.h.value=e/256,y.setRenderTarget(_),y.render(w,x.current),w.material=b,b.uniforms.tDiffuse.value=_.texture,b.uniforms.v.value=e/256,y.setRenderTarget(E),y.render(w,x.current),w.visible=!1},S=0;return(0,tb.useFrame)(()=>{x.current&&(t===1/0||S<t)&&(S++,m=v.background,p=v.overrideMaterial,g.current.visible=!1,v.background=null,v.overrideMaterial=B,y.setRenderTarget(E),y.render(v,x.current),M(a),c&&M(.4*a),y.setRenderTarget(null),g.current.visible=!0,v.overrideMaterial=p,v.background=m)}),tC.useImperativeHandle(f,()=>g.current,[]),tC.createElement("group",e2({"rotation-x":Math.PI/2},d,{ref:g}),tC.createElement("mesh",{renderOrder:A,geometry:C,scale:[1,-1,1],rotation:[-Math.PI/2,0,0]},tC.createElement("meshBasicMaterial",{transparent:!0,map:E.texture,opacity:r,depthWrite:u})),tC.createElement("orthographicCamera",{ref:x,args:[-i/2,i/2,n/2,-n/2,o,s]}))});var on=tI,tI=tI;let gw=tC.createContext(null),gI=oV({color:new tw.Color,blend:2,alphaTest:.75,opacity:0,map:null},`varying vec2 vUv;
   void main() {
     gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
     vUv = uv;
   }`,`varying vec2 vUv;
   uniform sampler2D map;
   uniform vec3 color;
   uniform float opacity;
   uniform float alphaTest;
   uniform float blend;
   void main() {
     vec4 sampledDiffuseColor = texture2D(map, vUv);
     gl_FragColor = vec4(color * sampledDiffuseColor.r * blend, max(0.0, (1.0 - (sampledDiffuseColor.r + sampledDiffuseColor.g + sampledDiffuseColor.b) / alphaTest)) * opacity);
     #include <tonemapping_fragment>
     #include <${oW>=154?"colorspace_fragment":"encodings_fragment"}>
   }`),gb=tC.forwardRef(({children:e,temporal:t,frames:r=40,limit:i=1/0,blend:n=20,scale:a=10,opacity:o=1,alphaTest:s=.75,color:l="black",colorBlend:c=2,resolution:h=1024,toneMapped:u=!0,...A},d)=>{(0,on.e)({SoftShadowMaterial:gI});let f=(0,tI.C)(e=>e.gl),m=(0,tI.C)(e=>e.scene),p=(0,tI.C)(e=>e.camera),g=(0,tI.C)(e=>e.invalidate),v=tC.useRef(null),y=tC.useRef(null),[x]=tC.useState(()=>new gM(f,m,h));tC.useLayoutEffect(()=>{x.configure(v.current)},[]);let E=tC.useMemo(()=>({lights:new Map,temporal:!!t,frames:Math.max(2,r),blend:Math.max(2,r===1/0?n:r),count:0,getMesh:()=>v.current,reset:()=>{x.clear();let e=v.current.material;e.opacity=0,e.alphaTest=0,E.count=0},update:(e=1)=>{let t=v.current.material;E.temporal?(t.opacity=Math.min(o,t.opacity+o/E.blend),t.alphaTest=Math.min(s,t.alphaTest+s/E.blend)):(t.opacity=o,t.alphaTest=s),y.current.visible=!0,x.prepare();for(let t=0;t<e;t++)E.lights.forEach(e=>e.update()),x.update(p,E.blend);y.current.visible=!1,x.finish()}}),[x,p,m,t,r,n,o,s]);return tC.useLayoutEffect(()=>{E.reset(),E.temporal||E.frames===1/0||E.update(E.blend)}),tC.useImperativeHandle(d,()=>E,[E]),(0,tb.useFrame)(()=>{(E.temporal||E.frames===1/0)&&E.count<E.frames&&E.count<i&&(g(),E.update(),E.count++)}),tC.createElement("group",A,tC.createElement("group",{traverse:()=>null,ref:y},tC.createElement(gw.Provider,{value:E},e)),tC.createElement("mesh",{receiveShadow:!0,ref:v,scale:a,rotation:[-Math.PI/2,0,0]},tC.createElement("planeGeometry",null),tC.createElement("softShadowMaterial",{transparent:!0,depthWrite:!1,toneMapped:u,color:l,blend:c,map:x.progressiveLightMap2.texture})))}),g_=tC.forwardRef(({castShadow:e=!0,bias:t=.001,mapSize:r=512,size:i=5,near:n=.5,far:a=500,frames:o=1,position:s=[0,0,0],radius:l=1,amount:c=8,intensity:h=oW>=155?Math.PI:1,ambient:u=.5,...A},d)=>{let f=tC.useRef(null),m=new tw.Vector3(...s).length(),p=tC.useContext(gw),g=tC.useCallback(()=>{let e;if(f.current)for(let t=0;t<f.current.children.length;t++)if(e=f.current.children[t],Math.random()>u)e.position.set(s[0]+tw.MathUtils.randFloatSpread(l),s[1]+tw.MathUtils.randFloatSpread(l),s[2]+tw.MathUtils.randFloatSpread(l));else{let t=Math.acos(2*Math.random()-1)-Math.PI/2,r=2*Math.PI*Math.random();e.position.set(Math.cos(t)*Math.cos(r)*m,Math.abs(Math.cos(t)*Math.sin(r)*m),Math.sin(t)*m)}},[l,u,m,...s]),v=tC.useMemo(()=>({update:g}),[g]);return tC.useImperativeHandle(d,()=>v,[v]),tC.useLayoutEffect(()=>{var e;let t=f.current;return p&&(null==(e=p.lights)||e.set(t.uuid,v)),()=>{var e;null==p||null==(e=p.lights)||e.delete(t.uuid)}},[p,v]),tC.createElement("group",e2({ref:f},A),Array.from({length:c},(o,s)=>tC.createElement("directionalLight",{key:s,castShadow:e,"shadow-bias":t,"shadow-mapSize":[r,r],intensity:h/c},tC.createElement("orthographicCamera",{attach:"shadow-camera",args:[-i,i,i,-i,n,a]}))))});class gM{constructor(e,t,r=1024){this.renderer=e,this.res=r,this.scene=t,this.buffer1Active=!1,this.lights=[],this.meshes=[],this.object=null,this.clearColor=new tw.Color,this.clearAlpha=0;const i={type:tw.HalfFloatType,magFilter:tw.NearestFilter,minFilter:tw.NearestFilter};this.progressiveLightMap1=new tw.WebGLRenderTarget(this.res,this.res,i),this.progressiveLightMap2=new tw.WebGLRenderTarget(this.res,this.res,i),this.discardMat=new pe,this.targetMat=new tw.MeshLambertMaterial({fog:!1}),this.previousShadowMap={value:this.progressiveLightMap1.texture},this.averagingWindow={value:100},this.targetMat.onBeforeCompile=e=>{e.vertexShader="varying vec2 vUv;\n"+e.vertexShader.slice(0,-1)+"vUv = uv; gl_Position = vec4((uv - 0.5) * 2.0, 1.0, 1.0); }";let t=e.fragmentShader.indexOf("void main() {");e.fragmentShader="varying vec2 vUv;\n"+e.fragmentShader.slice(0,t)+"uniform sampler2D previousShadowMap;\n	uniform float averagingWindow;\n"+e.fragmentShader.slice(t-1,-1)+`
vec3 texelOld = texture2D(previousShadowMap, vUv).rgb;
        gl_FragColor.rgb = mix(texelOld, gl_FragColor.rgb, 1.0/ averagingWindow);
      }`,e.uniforms.previousShadowMap=this.previousShadowMap,e.uniforms.averagingWindow=this.averagingWindow}}clear(){this.renderer.getClearColor(this.clearColor),this.clearAlpha=this.renderer.getClearAlpha(),this.renderer.setClearColor("black",1),this.renderer.setRenderTarget(this.progressiveLightMap1),this.renderer.clear(),this.renderer.setRenderTarget(this.progressiveLightMap2),this.renderer.clear(),this.renderer.setRenderTarget(null),this.renderer.setClearColor(this.clearColor,this.clearAlpha),this.lights=[],this.meshes=[],this.scene.traverse(e=>{e.geometry?this.meshes.push({object:e,material:e.material}):e.isLight&&this.lights.push({object:e,intensity:e.intensity})})}prepare(){this.lights.forEach(e=>e.object.intensity=0),this.meshes.forEach(e=>e.object.material=this.discardMat)}finish(){this.lights.forEach(e=>e.object.intensity=e.intensity),this.meshes.forEach(e=>e.object.material=e.material)}configure(e){this.object=e}update(e,t=100){if(!this.object)return;this.averagingWindow.value=t,this.object.material=this.targetMat;let r=this.buffer1Active?this.progressiveLightMap1:this.progressiveLightMap2,i=this.buffer1Active?this.progressiveLightMap2:this.progressiveLightMap1,n=this.scene.background;this.scene.background=null,this.renderer.setRenderTarget(r),this.previousShadowMap.value=i.texture,this.buffer1Active=!this.buffer1Active,this.renderer.render(this.scene,e),this.renderer.setRenderTarget(null),this.scene.background=n}}let gS={rembrandt:{main:[1,2,1],fill:[-2,-.5,-2]},portrait:{main:[-1,2,.5],fill:[-1,.5,-1.5]},upfront:{main:[0,2,1],fill:[-1,.5,-1.5]},soft:{main:[-2,4,4],fill:[-1,.5,-1.5]}};function gT({radius:e,adjustCamera:t}){let r=pO();return tC.useEffect(()=>{t&&r.refresh().clip().fit()},[e,t]),null}function gD({children:e,center:t,adjustCamera:r=!0,intensity:i=.5,shadows:n="contact",environment:a="city",preset:o="rembrandt",...s}){var l,c,h,u,A,d,f,m;let p="string"==typeof o?gS[o]:o,[{radius:g,height:v},y]=tC.useState({radius:0,width:0,height:0,depth:0}),x=null!=(l=null==n?void 0:n.bias)?l:-1e-4,E=null!=(c=null==n?void 0:n.normalBias)?c:0,C=null!=(h=null==n?void 0:n.size)?h:1024,B=null!=(u=null==n?void 0:n.offset)?u:0,w="contact"===n||(null==n?void 0:n.type)==="contact",I="accumulative"===n||(null==n?void 0:n.type)==="accumulative",b={..."object"==typeof n?n:{}},_=a?"string"==typeof a?{preset:a}:a:null,M=tC.useCallback(e=>{let{width:r,height:i,depth:n,boundingSphere:a}=e;y({radius:a.radius,width:r,height:i,depth:n}),null!=t&&t.onCentered&&t.onCentered(e)},[]);return tC.createElement(tC.Fragment,null,tC.createElement("ambientLight",{intensity:i/3}),tC.createElement("spotLight",{penumbra:1,position:[p.main[0]*g,p.main[1]*g,p.main[2]*g],intensity:2*i,castShadow:!!n,"shadow-bias":x,"shadow-normalBias":E,"shadow-mapSize":C}),tC.createElement("pointLight",{position:[p.fill[0]*g,p.fill[1]*g,p.fill[2]*g],intensity:i}),tC.createElement(pL,e2({fit:!!r,clip:!!r,margin:Number(r),observe:!0},s),tC.createElement(gT,{radius:g,adjustCamera:r}),tC.createElement(mc,e2({},t,{position:[0,B/2,0],onCentered:M}),e)),tC.createElement("group",{position:[0,-v/2-B/2,0]},w&&tC.createElement(gB,e2({scale:4*g,far:g,blur:2},b)),I&&tC.createElement(gb,e2({temporal:!0,frames:100,alphaTest:.9,toneMapped:!0,scale:4*g},b),tC.createElement(g_,{amount:null!=(A=b.amount)?A:8,radius:null!=(d=b.radius)?d:g,ambient:null!=(f=b.ambient)?f:.5,intensity:null!=(m=b.intensity)?m:1,position:[p.main[0]*g,p.main[1]*g,p.main[2]*g],size:4*g,bias:-x,mapSize:C}))),a&&tC.createElement(gx,_))}let gF=e=>0===e?0:Math.pow(2,10*e-10);function gR({children:e,floor:t=.25,segments:r=20,receiveShadow:i,...n}){let a=tC.useRef(null);return tC.useLayoutEffect(()=>{let e=0,i=r/r/2,n=a.current.attributes.position;for(let a=0;a<r+1;a++)for(let o=0;o<r+1;o++)n.setXYZ(e++,a/r-i+(0===a?-t:0),o/r-i,gF(a/r));n.needsUpdate=!0,a.current.computeVertexNormals()},[r,t]),tC.createElement("group",n,tC.createElement("mesh",{receiveShadow:i,rotation:[-Math.PI/2,0,Math.PI/2]},tC.createElement("planeGeometry",{ref:a,args:[1,1,r,r]}),e))}let gP=tC.forwardRef(({fog:e=!1,renderOrder:t,depthWrite:r=!1,colorStop:i=0,color:n="black",opacity:a=.5,...o},s)=>{let l=tC.useMemo(()=>{let e=document.createElement("canvas");e.width=128,e.height=128;let t=e.getContext("2d"),r=t.createRadialGradient(e.width/2,e.height/2,0,e.width/2,e.height/2,e.width/2);return r.addColorStop(i,new tw.Color(n).getStyle()),r.addColorStop(1,"rgba(0,0,0,0)"),t.fillStyle=r,t.fillRect(0,0,e.width,e.height),e},[n,i]);return tC.createElement("mesh",e2({renderOrder:t,ref:s,"rotation-x":-Math.PI/2},o),tC.createElement("planeGeometry",null),tC.createElement("meshBasicMaterial",{transparent:!0,opacity:a,fog:e,depthWrite:r,side:tw.DoubleSide},tC.createElement("canvasTexture",{attach:"map",args:[l]})))});var on=tI,tI=tI;function gQ(e=tw.FrontSide){let t={value:new tw.Matrix4};return Object.assign(new tw.MeshNormalMaterial({side:e}),{viewMatrix:t,onBeforeCompile:e=>{e.uniforms.viewMatrix=t,e.fragmentShader=`vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
           return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
         }
`+e.fragmentShader.replace("#include <normal_fragment_maps>",`#include <normal_fragment_maps>
           normal = inverseTransformDirection( normal, viewMatrix );
`)}})}let gU=oV({causticsTexture:null,causticsTextureB:null,color:new tw.Color,lightProjMatrix:new tw.Matrix4,lightViewMatrix:new tw.Matrix4},`varying vec3 vWorldPosition;
   void main() {
     gl_Position = projectionMatrix * viewMatrix * modelMatrix * vec4(position, 1.);
     vec4 worldPosition = modelMatrix * vec4(position, 1.);
     vWorldPosition = worldPosition.xyz;
   }`,`varying vec3 vWorldPosition;
  uniform vec3 color;
  uniform sampler2D causticsTexture;
  uniform sampler2D causticsTextureB;
  uniform mat4 lightProjMatrix;
  uniform mat4 lightViewMatrix;
   void main() {
    // Apply caustics
    vec4 lightSpacePos = lightProjMatrix * lightViewMatrix * vec4(vWorldPosition, 1.0);
    lightSpacePos.xyz /= lightSpacePos.w;
    lightSpacePos.xyz = lightSpacePos.xyz * 0.5 + 0.5;
    vec3 front = texture2D(causticsTexture, lightSpacePos.xy).rgb;
    vec3 back = texture2D(causticsTextureB, lightSpacePos.xy).rgb;
    gl_FragColor = vec4((front + back) * color, 1.0);
    #include <tonemapping_fragment>
    #include <${oW>=154?"colorspace_fragment":"encodings_fragment"}>
   }`),gz=oV({cameraMatrixWorld:new tw.Matrix4,cameraProjectionMatrixInv:new tw.Matrix4,normalTexture:null,depthTexture:null,lightDir:new tw.Vector3(0,1,0),lightPlaneNormal:new tw.Vector3(0,1,0),lightPlaneConstant:0,near:.1,far:100,modelMatrix:new tw.Matrix4,worldRadius:1/40,ior:1.1,bounces:0,resolution:1024,size:10,intensity:.5},`
  varying vec2 vUv;
  void main() {
      vUv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
  }`,`
  uniform mat4 cameraMatrixWorld;
  uniform mat4 cameraProjectionMatrixInv;
  uniform vec3 lightDir;
  uniform vec3 lightPlaneNormal;
  uniform float lightPlaneConstant;
  uniform float near;
  uniform float far;
  uniform float time;
  uniform float worldRadius;
  uniform float resolution;
  uniform float size;
  uniform float intensity;
  uniform float ior;
  precision highp isampler2D;
  precision highp usampler2D;
  uniform sampler2D normalTexture;
  uniform sampler2D depthTexture;
  uniform float bounces;
  varying vec2 vUv;
  vec3 WorldPosFromDepth(float depth, vec2 coord) {
    float z = depth * 2.0 - 1.0;
    vec4 clipSpacePosition = vec4(coord * 2.0 - 1.0, z, 1.0);
    vec4 viewSpacePosition = cameraProjectionMatrixInv * clipSpacePosition;
    // Perspective division
    viewSpacePosition /= viewSpacePosition.w;
    vec4 worldSpacePosition = cameraMatrixWorld * viewSpacePosition;
    return worldSpacePosition.xyz;
  }
  float sdPlane( vec3 p, vec3 n, float h ) {
    // n must be normalized
    return dot(p,n) + h;
  }
  float planeIntersect( vec3 ro, vec3 rd, vec4 p ) {
    return -(dot(ro,p.xyz)+p.w)/dot(rd,p.xyz);
  }
  vec3 totalInternalReflection(vec3 ro, vec3 rd, vec3 pos, vec3 normal, float ior, out vec3 rayOrigin, out vec3 rayDirection) {
    rayOrigin = ro;
    rayDirection = rd;
    rayDirection = refract(rayDirection, normal, 1.0 / ior);
    rayOrigin = pos + rayDirection * 0.1;
    return rayDirection;
  }
  void main() {
    // Each sample consists of random offset in the x and y direction
    float caustic = 0.0;
    float causticTexelSize = (1.0 / resolution) * size * 2.0;
    float texelsNeeded = worldRadius / causticTexelSize;
    float sampleRadius = texelsNeeded / resolution;
    float sum = 0.0;
    if (texture2D(depthTexture, vUv).x == 1.0) {
      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
      return;
    }
    vec2 offset1 = vec2(-0.5, -0.5);//vec2(rand() - 0.5, rand() - 0.5);
    vec2 offset2 = vec2(-0.5, 0.5);//vec2(rand() - 0.5, rand() - 0.5);
    vec2 offset3 = vec2(0.5, 0.5);//vec2(rand() - 0.5, rand() - 0.5);
    vec2 offset4 = vec2(0.5, -0.5);//vec2(rand() - 0.5, rand() - 0.5);
    vec2 uv1 = vUv + offset1 * sampleRadius;
    vec2 uv2 = vUv + offset2 * sampleRadius;
    vec2 uv3 = vUv + offset3 * sampleRadius;
    vec2 uv4 = vUv + offset4 * sampleRadius;
    vec3 normal1 = texture2D(normalTexture, uv1, -10.0).rgb * 2.0 - 1.0;
    vec3 normal2 = texture2D(normalTexture, uv2, -10.0).rgb * 2.0 - 1.0;
    vec3 normal3 = texture2D(normalTexture, uv3, -10.0).rgb * 2.0 - 1.0;
    vec3 normal4 = texture2D(normalTexture, uv4, -10.0).rgb * 2.0 - 1.0;
    float depth1 = texture2D(depthTexture, uv1, -10.0).x;
    float depth2 = texture2D(depthTexture, uv2, -10.0).x;
    float depth3 = texture2D(depthTexture, uv3, -10.0).x;
    float depth4 = texture2D(depthTexture, uv4, -10.0).x;
    // Sanity check the depths
    if (depth1 == 1.0 || depth2 == 1.0 || depth3 == 1.0 || depth4 == 1.0) {
      gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);
      return;
    }
    vec3 pos1 = WorldPosFromDepth(depth1, uv1);
    vec3 pos2 = WorldPosFromDepth(depth2, uv2);
    vec3 pos3 = WorldPosFromDepth(depth3, uv3);
    vec3 pos4 = WorldPosFromDepth(depth4, uv4);
    vec3 originPos1 = WorldPosFromDepth(0.0, uv1);
    vec3 originPos2 = WorldPosFromDepth(0.0, uv2);
    vec3 originPos3 = WorldPosFromDepth(0.0, uv3);
    vec3 originPos4 = WorldPosFromDepth(0.0, uv4);
    vec3 endPos1, endPos2, endPos3, endPos4;
    vec3 endDir1, endDir2, endDir3, endDir4;
    totalInternalReflection(originPos1, lightDir, pos1, normal1, ior, endPos1, endDir1);
    totalInternalReflection(originPos2, lightDir, pos2, normal2, ior, endPos2, endDir2);
    totalInternalReflection(originPos3, lightDir, pos3, normal3, ior, endPos3, endDir3);
    totalInternalReflection(originPos4, lightDir, pos4, normal4, ior, endPos4, endDir4);
    float lightPosArea = length(cross(originPos2 - originPos1, originPos3 - originPos1)) + length(cross(originPos3 - originPos1, originPos4 - originPos1));
    float t1 = planeIntersect(endPos1, endDir1, vec4(lightPlaneNormal, lightPlaneConstant));
    float t2 = planeIntersect(endPos2, endDir2, vec4(lightPlaneNormal, lightPlaneConstant));
    float t3 = planeIntersect(endPos3, endDir3, vec4(lightPlaneNormal, lightPlaneConstant));
    float t4 = planeIntersect(endPos4, endDir4, vec4(lightPlaneNormal, lightPlaneConstant));
    vec3 finalPos1 = endPos1 + endDir1 * t1;
    vec3 finalPos2 = endPos2 + endDir2 * t2;
    vec3 finalPos3 = endPos3 + endDir3 * t3;
    vec3 finalPos4 = endPos4 + endDir4 * t4;
    float finalArea = length(cross(finalPos2 - finalPos1, finalPos3 - finalPos1)) + length(cross(finalPos3 - finalPos1, finalPos4 - finalPos1));
    caustic += intensity * (lightPosArea / finalArea);
    // Calculate the area of the triangle in light spaces
    gl_FragColor = vec4(vec3(max(caustic, 0.0)), 1.0);
  }`),gk={depth:!0,minFilter:tw.LinearFilter,magFilter:tw.LinearFilter,type:tw.UnsignedByteType},gL={minFilter:tw.LinearMipmapLinearFilter,magFilter:tw.LinearFilter,type:tw.FloatType,generateMipmaps:!0},gO=tC.forwardRef(({debug:e,children:t,frames:r=1,ior:i=1.1,color:n="white",causticsOnly:a=!1,backside:o=!1,backsideIOR:s=1.1,worldRadius:l=.3125,intensity:c=.05,resolution:h=2024,lightSource:u=[5,5,5],...A},d)=>{(0,on.e)({CausticsProjectionMaterial:gU});let f=tC.useRef(null),m=tC.useRef(null),p=tC.useRef(null),g=tC.useRef(null),v=(0,tI.C)(e=>e.gl),y=AW(e&&m,tw.CameraHelper),x=lQ(h,h,gk),E=lQ(h,h,gk),C=lQ(h,h,gL),B=lQ(h,h,gL),[w]=tC.useState(()=>gQ()),[I]=tC.useState(()=>gQ(tw.BackSide)),[b]=tC.useState(()=>new gz),[_]=tC.useState(()=>new ow(b));tC.useLayoutEffect(()=>{f.current.updateWorldMatrix(!1,!0)});let M=0,S=new tw.Vector3,T=new tw.Frustum,D=new tw.Matrix4,F=new tw.Plane,R=new tw.Vector3,P=new tw.Vector3,Q=new tw.Box3,U=new tw.Vector3,z=[],k=[],L=[],O=[],G=new tw.Vector3;for(let e=0;e<8;e++)z.push(new tw.Vector3),k.push(new tw.Vector3),L.push(new tw.Vector3),O.push(new tw.Vector3);return(0,tb.useFrame)(()=>{if(r===1/0||M++<r){var t,n;Array.isArray(u)?R.fromArray(u).normalize():R.copy(f.current.worldToLocal(u.current.getWorldPosition(S)).normalize()),P.copy(R).multiplyScalar(-1),null==(t=p.current.parent)||t.matrixWorld.identity(),Q.setFromObject(p.current,!0),z[0].set(Q.min.x,Q.min.y,Q.min.z),z[1].set(Q.min.x,Q.min.y,Q.max.z),z[2].set(Q.min.x,Q.max.y,Q.min.z),z[3].set(Q.min.x,Q.max.y,Q.max.z),z[4].set(Q.max.x,Q.min.y,Q.min.z),z[5].set(Q.max.x,Q.min.y,Q.max.z),z[6].set(Q.max.x,Q.max.y,Q.min.z),z[7].set(Q.max.x,Q.max.y,Q.max.z);for(let e=0;e<8;e++)k[e].copy(z[e]);Q.getCenter(U),z.map(e=>e.sub(U));let r=F.set(P,0);z.map((e,t)=>r.projectPoint(e,L[t]));let A=L.reduce((e,t)=>e.add(t),S.set(0,0,0)).divideScalar(L.length),d=L.map(e=>e.distanceTo(A)).reduce((e,t)=>Math.max(e,t)),M=z.map(e=>e.dot(R)).reduce((e,t)=>Math.max(e,t));m.current.position.copy(G.copy(R).multiplyScalar(M).add(U)),m.current.lookAt(p.current.localToWorld(U));let N=D.lookAt(m.current.position,U,S.set(0,1,0));m.current.left=-d,m.current.right=d,m.current.top=d,m.current.bottom=-d;let H=S.set(0,d,0).applyMatrix4(N),V=(m.current.position.y+H.y)/R.y;m.current.near=.1,m.current.far=V,m.current.updateProjectionMatrix(),m.current.updateMatrixWorld();let j=k.map((e,t)=>e.add(O[t].copy(R).multiplyScalar(-e.y/R.y))),J=j.reduce((e,t)=>e.add(t),S.set(0,0,0)).divideScalar(j.length),Y=2*j.map(e=>Math.hypot(e.x-J.x,e.z-J.z)).reduce((e,t)=>Math.max(e,t));g.current.scale.setScalar(Y),g.current.position.copy(J),e&&(null==(n=y.current)||n.update()),I.viewMatrix.value=w.viewMatrix.value=m.current.matrixWorldInverse;let W=T.setFromProjectionMatrix(D.multiplyMatrices(m.current.projectionMatrix,m.current.matrixWorldInverse)).planes[4];b.cameraMatrixWorld=m.current.matrixWorld,b.cameraProjectionMatrixInv=m.current.projectionMatrixInverse,b.lightDir=P,b.lightPlaneNormal=W.normal,b.lightPlaneConstant=W.constant,b.near=m.current.near,b.far=m.current.far,b.resolution=h,b.size=d,b.intensity=c,b.worldRadius=l,p.current.visible=!0,v.setRenderTarget(x),v.clear(),p.current.overrideMaterial=w,v.render(p.current,m.current),v.setRenderTarget(E),v.clear(),o&&(p.current.overrideMaterial=I,v.render(p.current,m.current)),p.current.overrideMaterial=null,b.ior=i,g.current.material.lightProjMatrix=m.current.projectionMatrix,g.current.material.lightViewMatrix=m.current.matrixWorldInverse,b.normalTexture=x.texture,b.depthTexture=x.depthTexture,v.setRenderTarget(C),v.clear(),_.render(v),b.ior=s,b.normalTexture=E.texture,b.depthTexture=E.depthTexture,v.setRenderTarget(B),v.clear(),o&&_.render(v),v.setRenderTarget(null),a&&(p.current.visible=!1)}}),tC.useImperativeHandle(d,()=>f.current,[]),tC.createElement("group",e2({ref:f},A),tC.createElement("scene",{ref:p},tC.createElement("orthographicCamera",{ref:m,up:[0,1,0]}),t),tC.createElement("mesh",{renderOrder:2,ref:g,"rotation-x":-Math.PI/2},tC.createElement("planeGeometry",null),tC.createElement("causticsProjectionMaterial",{transparent:!0,color:n,causticsTexture:C.texture,causticsTextureB:B.texture,blending:tw.CustomBlending,blendSrc:tw.OneFactor,blendDst:tw.SrcAlphaFactor,depthWrite:!1}),e&&tC.createElement(o1,null,tC.createElement("lineBasicMaterial",{color:"#ffff00",toneMapped:!1}))))});var tI=tI,gG=tw;class gN extends gG.ShaderMaterial{constructor(){super({uniforms:{depth:{value:null},opacity:{value:1},attenuation:{value:2.5},anglePower:{value:12},spotPosition:{value:new gG.Vector3(0,0,0)},lightColor:{value:new gG.Color("white")},cameraNear:{value:0},cameraFar:{value:1},resolution:{value:new gG.Vector2(0,0)}},transparent:!0,depthWrite:!1,vertexShader:`
        varying vec3 vNormal;
        varying float vViewZ;
        varying float vIntensity;
        uniform vec3 spotPosition;
        uniform float attenuation;

        #include <common>
        #include <logdepthbuf_pars_vertex>

        void main() {
          // compute intensity
          vNormal = normalize(normalMatrix * normal);
          vec4 worldPosition = modelMatrix * vec4(position, 1);
          vec4 viewPosition = viewMatrix * worldPosition;
          vViewZ = viewPosition.z;

          vIntensity = 1.0 - saturate(distance(worldPosition.xyz, spotPosition) / attenuation);

          gl_Position = projectionMatrix * viewPosition;

          #include <logdepthbuf_vertex>
        }
      `,fragmentShader:`
        varying vec3 vNormal;
        varying float vViewZ;
        varying float vIntensity;

        uniform vec3 lightColor;
        uniform float anglePower;
        uniform sampler2D depth;
        uniform vec2 resolution;
        uniform float cameraNear;
        uniform float cameraFar;
        uniform float opacity;

        #include <packing>
        #include <logdepthbuf_pars_fragment>

        float readDepth(sampler2D depthSampler, vec2 uv) {
          float fragCoordZ = texture(depthSampler, uv).r;

          // https://github.com/mrdoob/three.js/issues/23072
          #ifdef USE_LOGDEPTHBUF
            float viewZ = 1.0 - exp2(fragCoordZ * log(cameraFar + 1.0) / log(2.0));
          #else
            float viewZ = perspectiveDepthToViewZ(fragCoordZ, cameraNear, cameraFar);
          #endif

          return viewZ;
        }

        void main() {
          #include <logdepthbuf_fragment>

          vec3 normal = vec3(vNormal.x, vNormal.y, abs(vNormal.z));
          float angleIntensity = pow(dot(normal, vec3(0, 0, 1)), anglePower);
          float intensity = vIntensity * angleIntensity;

          // fades when z is close to sampled depth, meaning the cone is intersecting existing geometry
          bool isSoft = resolution[0] > 0.0 && resolution[1] > 0.0;
          if (isSoft) {
            vec2 uv = gl_FragCoord.xy / resolution;
            intensity *= smoothstep(0.0, 1.0, vViewZ - readDepth(depth, uv));
          }

          gl_FragColor = vec4(lightColor, intensity * opacity);

          #include <tonemapping_fragment>
          #include <${oW>=154?"colorspace_fragment":"encodings_fragment"}>
        }
      `})}}function gH({opacity:e=1,radiusTop:t,radiusBottom:r,depthBuffer:i,color:n="white",distance:a=5,angle:o=.15,attenuation:s=5,anglePower:l=5}){let c=tC.useRef(null),h=(0,tI.C)(e=>e.size),u=(0,tI.C)(e=>e.camera),A=(0,tI.C)(e=>e.viewport.dpr),[d]=tC.useState(()=>new gN),[f]=tC.useState(()=>new tw.Vector3);t=void 0===t?.1:t,r=void 0===r?7*o:r,(0,tb.useFrame)(()=>{d.uniforms.spotPosition.value.copy(c.current.getWorldPosition(f)),c.current.lookAt(c.current.parent.target.getWorldPosition(f))});let m=tC.useMemo(()=>{let e=new tw.CylinderGeometry(t,r,a,128,64,!0);return e.applyMatrix4(new tw.Matrix4().makeTranslation(0,-a/2,0)),e.applyMatrix4(new tw.Matrix4().makeRotationX(-Math.PI/2)),e},[a,t,r]);return tC.createElement(tC.Fragment,null,tC.createElement("mesh",{ref:c,geometry:m,raycast:()=>null},tC.createElement("primitive",{object:d,attach:"material","uniforms-opacity-value":e,"uniforms-lightColor-value":n,"uniforms-attenuation-value":s,"uniforms-anglePower-value":l,"uniforms-depth-value":i,"uniforms-cameraNear-value":u.near,"uniforms-cameraFar-value":u.far,"uniforms-resolution-value":i?[h.width*A,h.height*A]:[0,0]})))}function gV(e,t,r,i,n){let[[a,o]]=tC.useState(()=>[new tw.Vector3,new tw.Vector3]);tC.useLayoutEffect(()=>{let t;if(null==(t=e.current)?void 0:t.isSpotLight)e.current.shadow.mapSize.set(r,i),e.current.shadow.needsUpdate=!0;else throw Error("SpotlightShadow must be a child of a SpotLight")},[e,r,i]),(0,tb.useFrame)(()=>{if(!e.current)return;let r=e.current.position,i=e.current.target.position;o.copy(i).sub(r);var s=o.length();o.normalize().multiplyScalar(s*n),a.copy(r).add(o),t.current.position.copy(a),t.current.lookAt(e.current.target.position)})}function gj({distance:e=.4,alphaTest:t=.5,map:r,shader:i="#define GLSLIFY 1\nvarying vec2 vUv;uniform sampler2D uShadowMap;uniform float uTime;void main(){vec3 color=texture2D(uShadowMap,vUv).xyz;gl_FragColor=vec4(color,1.);}",width:n=512,height:a=512,scale:o=1,children:s,...l}){let c=tC.useRef(null),h=l.spotlightRef,u=l.debug;gV(h,c,n,a,e);let A=tC.useMemo(()=>new tw.WebGLRenderTarget(n,a,{format:tw.RGBAFormat,stencilBuffer:!1}),[n,a]),d=tC.useRef({uShadowMap:{value:r},uTime:{value:0}});tC.useEffect(()=>void(d.current.uShadowMap.value=r),[r]);let f=tC.useMemo(()=>new ow(new tw.ShaderMaterial({uniforms:d.current,vertexShader:`
          varying vec2 vUv;

          void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
          }
          `,fragmentShader:i})),[i]);return tC.useEffect(()=>()=>{f.material.dispose(),f.dispose()},[f]),tC.useEffect(()=>()=>A.dispose(),[A]),(0,tb.useFrame)(({gl:e},t)=>{d.current.uTime.value+=t,e.setRenderTarget(A),f.render(e),e.setRenderTarget(null)}),tC.createElement(tC.Fragment,null,tC.createElement("mesh",{ref:c,scale:o,castShadow:!0},tC.createElement("planeGeometry",null),tC.createElement("meshBasicMaterial",{transparent:!0,side:tw.DoubleSide,alphaTest:t,alphaMap:A.texture,"alphaMap-wrapS":tw.RepeatWrapping,"alphaMap-wrapT":tw.RepeatWrapping,opacity:+!!u},s)))}function gJ({distance:e=.4,alphaTest:t=.5,map:r,width:i=512,height:n=512,scale:a,children:o,...s}){let l=tC.useRef(null),c=s.spotlightRef,h=s.debug;return gV(c,l,i,n,e),tC.createElement(tC.Fragment,null,tC.createElement("mesh",{ref:l,scale:a,castShadow:!0},tC.createElement("planeGeometry",null),tC.createElement("meshBasicMaterial",{transparent:!0,side:tw.DoubleSide,alphaTest:t,alphaMap:r,"alphaMap-wrapS":tw.RepeatWrapping,"alphaMap-wrapT":tw.RepeatWrapping,opacity:+!!h},o)))}function gY(e){return e.shader?tC.createElement(gj,e):tC.createElement(gJ,e)}let gW=tC.forwardRef(({opacity:e=1,radiusTop:t,radiusBottom:r,depthBuffer:i,color:n="white",distance:a=5,angle:o=.15,attenuation:s=5,anglePower:l=5,volumetric:c=!0,debug:h=!1,children:u,...A},d)=>{let f=tC.useRef(null);return tC.useImperativeHandle(d,()=>f.current,[]),tC.createElement("group",null,h&&f.current&&tC.createElement("spotLightHelper",{args:[f.current]}),tC.createElement("spotLight",e2({ref:f,angle:o,color:n,distance:a,castShadow:!0},A),c&&tC.createElement(gH,{debug:h,opacity:e,radiusTop:t,radiusBottom:r,depthBuffer:i,color:n,distance:a,angle:o,attenuation:s,anglePower:l})),u&&tC.cloneElement(u,{spotlightRef:f,debug:h}))});var o0=tI;let gK=tC.forwardRef(({light:e,args:t,map:r,toneMapped:i=!1,color:n="white",form:a="rect",intensity:o=1,scale:s=1,target:l=[0,0,0],children:c,...h},u)=>{let A=tC.useRef(null);return tC.useImperativeHandle(u,()=>A.current,[]),tC.useLayoutEffect(()=>{c||h.material||((0,o0.s)(A.current.material,{color:n}),A.current.material.color.multiplyScalar(o))},[n,o,c,h.material]),tC.useLayoutEffect(()=>{h.rotation||A.current.quaternion.identity(),l&&!h.rotation&&("boolean"==typeof l?A.current.lookAt(0,0,0):A.current.lookAt(Array.isArray(l)?new tw.Vector3(...l):l))},[l,h.rotation]),s=Array.isArray(s)&&2===s.length?[s[0],s[1],1]:s,tC.createElement("mesh",e2({ref:A,scale:s},h),"circle"===a?tC.createElement("ringGeometry",{args:t||[0,.5,64]}):"ring"===a?tC.createElement("ringGeometry",{args:t||[.25,.5,64]}):"rect"===a||"plane"===a?tC.createElement("planeGeometry",{args:t||[1,1]}):"box"===a?tC.createElement("boxGeometry",{args:t||[1,1,1]}):tC.createElement(a,{args:t}),c||tC.createElement("meshBasicMaterial",{toneMapped:i,map:r,side:tw.DoubleSide}),e&&tC.createElement("pointLight",e2({castShadow:!0},e)))});var gX=tw,gq=Object.defineProperty,gZ=(e,t,r)=>{let i;return(i="symbol"!=typeof t?t+"":t)in e?gq(e,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[i]=r,r};let g$=(()=>{let e={uniforms:{turbidity:{value:2},rayleigh:{value:1},mieCoefficient:{value:.005},mieDirectionalG:{value:.8},sunPosition:{value:new gX.Vector3},up:{value:new gX.Vector3(0,1,0)}},vertexShader:`
      uniform vec3 sunPosition;
      uniform float rayleigh;
      uniform float turbidity;
      uniform float mieCoefficient;
      uniform vec3 up;

      varying vec3 vWorldPosition;
      varying vec3 vSunDirection;
      varying float vSunfade;
      varying vec3 vBetaR;
      varying vec3 vBetaM;
      varying float vSunE;

      // constants for atmospheric scattering
      const float e = 2.71828182845904523536028747135266249775724709369995957;
      const float pi = 3.141592653589793238462643383279502884197169;

      // wavelength of used primaries, according to preetham
      const vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );
      // this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:
      // (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))
      const vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );

      // mie stuff
      // K coefficient for the primaries
      const float v = 4.0;
      const vec3 K = vec3( 0.686, 0.678, 0.666 );
      // MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K
      const vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );

      // earth shadow hack
      // cutoffAngle = pi / 1.95;
      const float cutoffAngle = 1.6110731556870734;
      const float steepness = 1.5;
      const float EE = 1000.0;

      float sunIntensity( float zenithAngleCos ) {
        zenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );
        return EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );
      }

      vec3 totalMie( float T ) {
        float c = ( 0.2 * T ) * 10E-18;
        return 0.434 * c * MieConst;
      }

      void main() {

        vec4 worldPosition = modelMatrix * vec4( position, 1.0 );
        vWorldPosition = worldPosition.xyz;

        gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        gl_Position.z = gl_Position.w; // set z to camera.far

        vSunDirection = normalize( sunPosition );

        vSunE = sunIntensity( dot( vSunDirection, up ) );

        vSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );

        float rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );

      // extinction (absorbtion + out scattering)
      // rayleigh coefficients
        vBetaR = totalRayleigh * rayleighCoefficient;

      // mie coefficients
        vBetaM = totalMie( turbidity ) * mieCoefficient;

      }
    `,fragmentShader:`
      varying vec3 vWorldPosition;
      varying vec3 vSunDirection;
      varying float vSunfade;
      varying vec3 vBetaR;
      varying vec3 vBetaM;
      varying float vSunE;

      uniform float mieDirectionalG;
      uniform vec3 up;

      const vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );

      // constants for atmospheric scattering
      const float pi = 3.141592653589793238462643383279502884197169;

      const float n = 1.0003; // refractive index of air
      const float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)

      // optical length at zenith for molecules
      const float rayleighZenithLength = 8.4E3;
      const float mieZenithLength = 1.25E3;
      // 66 arc seconds -> degrees, and the cosine of that
      const float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;

      // 3.0 / ( 16.0 * pi )
      const float THREE_OVER_SIXTEENPI = 0.05968310365946075;
      // 1.0 / ( 4.0 * pi )
      const float ONE_OVER_FOURPI = 0.07957747154594767;

      float rayleighPhase( float cosTheta ) {
        return THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );
      }

      float hgPhase( float cosTheta, float g ) {
        float g2 = pow( g, 2.0 );
        float inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );
        return ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );
      }

      void main() {

        vec3 direction = normalize( vWorldPosition - cameraPos );

      // optical length
      // cutoff angle at 90 to avoid singularity in next formula.
        float zenithAngle = acos( max( 0.0, dot( up, direction ) ) );
        float inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );
        float sR = rayleighZenithLength * inverse;
        float sM = mieZenithLength * inverse;

      // combined extinction factor
        vec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );

      // in scattering
        float cosTheta = dot( direction, vSunDirection );

        float rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );
        vec3 betaRTheta = vBetaR * rPhase;

        float mPhase = hgPhase( cosTheta, mieDirectionalG );
        vec3 betaMTheta = vBetaM * mPhase;

        vec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );
        Lin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );

      // nightsky
        float theta = acos( direction.y ); // elevation --> y-axis, [-pi/2, pi/2]
        float phi = atan( direction.z, direction.x ); // azimuth --> x-axis [-pi/2, pi/2]
        vec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );
        vec3 L0 = vec3( 0.1 ) * Fex;

      // composition + solar disc
        float sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );
        L0 += ( vSunE * 19000.0 * Fex ) * sundisk;

        vec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );

        vec3 retColor = pow( texColor, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );

        gl_FragColor = vec4( retColor, 1.0 );

      #include <tonemapping_fragment>
      #include <${nI>=154?"colorspace_fragment":"encodings_fragment"}>

      }
    `},t=new gX.ShaderMaterial({name:"SkyShader",fragmentShader:e.fragmentShader,vertexShader:e.vertexShader,uniforms:gX.UniformsUtils.clone(e.uniforms),side:gX.BackSide,depthWrite:!1});class r extends gX.Mesh{constructor(){super(new gX.BoxGeometry(1,1,1),t)}}return gZ(r,"SkyShader",e),gZ(r,"material",t),r})();function g1(e,t,r=new tw.Vector3){let i=Math.PI*(e-.5),n=2*Math.PI*(t-.5);return r.x=Math.cos(n),r.y=Math.sin(i),r.z=Math.sin(n),r}let g0=tC.forwardRef(({inclination:e=.6,azimuth:t=.1,distance:r=1e3,mieCoefficient:i=.005,mieDirectionalG:n=.8,rayleigh:a=.5,turbidity:o=10,sunPosition:s=g1(e,t),...l},c)=>{let h=tC.useMemo(()=>new tw.Vector3().setScalar(r),[r]),[u]=tC.useState(()=>new g$);return tC.createElement("primitive",e2({object:u,ref:c,"material-uniforms-mieCoefficient-value":i,"material-uniforms-mieDirectionalG-value":n,"material-uniforms-rayleigh-value":a,"material-uniforms-sunPosition-value":s,"material-uniforms-turbidity-value":o,scale:h},l))});var g2=tw;class g3 extends g2.ShaderMaterial{constructor(){super({uniforms:{time:{value:0},fade:{value:1}},vertexShader:`
      uniform float time;
      attribute float size;
      varying vec3 vColor;
      void main() {
        vColor = color;
        vec4 mvPosition = modelViewMatrix * vec4(position, 0.5);
        gl_PointSize = size * (30.0 / -mvPosition.z) * (3.0 + sin(time + 100.0));
        gl_Position = projectionMatrix * mvPosition;
      }`,fragmentShader:`
      uniform sampler2D pointTexture;
      uniform float fade;
      varying vec3 vColor;
      void main() {
        float opacity = 1.0;
        if (fade == 1.0) {
          float d = distance(gl_PointCoord, vec2(0.5, 0.5));
          opacity = 1.0 / (1.0 + exp(16.0 * (d - 0.25)));
        }
        gl_FragColor = vec4(vColor, opacity);

        #include <tonemapping_fragment>
	      #include <${oW>=154?"colorspace_fragment":"encodings_fragment"}>
      }`})}}let g4=e=>new g2.Vector3().setFromSpherical(new g2.Spherical(e,Math.acos(1-2*Math.random()),2*Math.random()*Math.PI)),g5=tC.forwardRef(({radius:e=100,depth:t=50,count:r=5e3,saturation:i=0,factor:n=4,fade:a=!1,speed:o=1},s)=>{let l=tC.useRef(null),[c,h,u]=tC.useMemo(()=>{let a=[],o=[],s=Array.from({length:r},()=>(.5+.5*Math.random())*n),l=new g2.Color,c=e+t,h=t/r;for(let e=0;e<r;e++)c-=h*Math.random(),a.push(...g4(c).toArray()),l.setHSL(e/r,i,.9),o.push(l.r,l.g,l.b);return[new Float32Array(a),new Float32Array(o),new Float32Array(s)]},[r,t,n,e,i]);(0,tb.useFrame)(e=>l.current&&(l.current.uniforms.time.value=e.clock.elapsedTime*o));let[A]=tC.useState(()=>new g3);return tC.createElement("points",{ref:s},tC.createElement("bufferGeometry",null,tC.createElement("bufferAttribute",{attach:"attributes-position",args:[c,3]}),tC.createElement("bufferAttribute",{attach:"attributes-color",args:[h,3]}),tC.createElement("bufferAttribute",{attach:"attributes-size",args:[u,1]})),tC.createElement("primitive",{ref:l,object:A,attach:"material",blending:g2.AdditiveBlending,"uniforms-fade-value":a,depthWrite:!1,transparent:!0,vertexColors:!0}))});var g6=tw,on=tI,o0=tI;let g8="https://rawcdn.githack.com/pmndrs/drei-assets/9225a9f1fbd449d9411125c2f419b843d0308c9f/cloud.png",g9=new g6.Matrix4,g7=new g6.Vector3,ve=new g6.Quaternion,vt=new g6.Vector3,vr=new g6.Quaternion,vi=new g6.Vector3,vn=tC.createContext(null),va=tC.forwardRef(({children:e,material:t=g6.MeshLambertMaterial,texture:r=g8,range:i,limit:n=200,frustumCulled:a,...o},s)=>{var l,c;let h,u=tC.useMemo(()=>class extends t{constructor(){super();const e=parseInt(g6.REVISION.replace(/\D+/g,""))>=154?"opaque_fragment":"output_fragment";this.onBeforeCompile=t=>{t.vertexShader=`attribute float cloudOpacity;
               varying float vOpacity;
              `+t.vertexShader.replace("#include <fog_vertex>",`#include <fog_vertex>
                 vOpacity = cloudOpacity;
                `),t.fragmentShader=`varying float vOpacity;
              `+t.fragmentShader.replace(`#include <${e}>`,`#include <${e}>
                 gl_FragColor = vec4(outgoingLight, diffuseColor.a * vOpacity);
                `)}}},[t]);(0,on.e)({CloudMaterial:u});let A=tC.useRef(null),d=tC.useRef([]),f=tC.useMemo(()=>new Float32Array(Array.from({length:n},()=>1)),[n]),m=tC.useMemo(()=>new Float32Array(Array.from({length:n},()=>[1,1,1]).flat()),[n]),p=oJ(r),g=0,v=0,y=new g6.Quaternion,x=new g6.Vector3(0,0,1),E=new g6.Vector3;(0,tb.useFrame)((e,t)=>{for(g=e.clock.elapsedTime,g9.copy(A.current.matrixWorld).invert(),e.camera.matrixWorld.decompose(vt,vr,vi),v=0;v<d.current.length;v++)(h=d.current[v]).ref.current.matrixWorld.decompose(g7,ve,vi),g7.add(E.copy(h.position).applyQuaternion(ve).multiply(vi)),ve.copy(vr).multiply(y.setFromAxisAngle(x,h.rotation+=t*h.rotationFactor)),vi.multiplyScalar(h.volume+(1+Math.sin(g*h.density*h.speed))/2*h.growth),h.matrix.compose(g7,ve,vi).premultiply(g9),h.dist=g7.distanceTo(vt);for(d.current.sort((e,t)=>t.dist-e.dist),v=0;v<d.current.length;v++)h=d.current[v],f[v]=h.opacity*(h.dist<h.fade-1?h.dist/h.fade:1),A.current.setMatrixAt(v,h.matrix),A.current.setColorAt(v,h.color);A.current.geometry.attributes.cloudOpacity.needsUpdate=!0,A.current.instanceMatrix.needsUpdate=!0,A.current.instanceColor&&(A.current.instanceColor.needsUpdate=!0)}),tC.useLayoutEffect(()=>{let e=Math.min(n,void 0!==i?i:n,d.current.length);A.current.count=e,mA(A.current.instanceMatrix,{start:0,count:16*e}),A.current.instanceColor&&mA(A.current.instanceColor,{start:0,count:3*e}),mA(A.current.geometry.attributes.cloudOpacity,{start:0,count:e})});let C=[null!=(l=p.image.width)?l:1,null!=(c=p.image.height)?c:1],B=Math.max(C[0],C[1]);return C=[C[0]/B,C[1]/B],tC.createElement("group",e2({ref:s},o),tC.createElement(vn.Provider,{value:d},e,tC.createElement("instancedMesh",{matrixAutoUpdate:!1,ref:A,args:[null,null,n],frustumCulled:a},tC.createElement("instancedBufferAttribute",{usage:g6.DynamicDrawUsage,attach:"instanceColor",args:[m,3]}),tC.createElement("planeGeometry",{args:[...C]},tC.createElement("instancedBufferAttribute",{usage:g6.DynamicDrawUsage,attach:"attributes-cloudOpacity",args:[f,1]})),tC.createElement("cloudMaterial",{key:t.name,map:p,transparent:!0,depthWrite:!1}))))}),vo=tC.forwardRef(({opacity:e=1,speed:t=0,bounds:r=[5,1,1],segments:i=20,color:n="#ffffff",fade:a=10,volume:o=6,smallestVolume:s=.25,distribute:l=null,growth:c=4,concentrate:h="inside",seed:u=Math.random(),...A},d)=>{function f(){let e=1e4*Math.sin(u++);return e-Math.floor(e)}let m=tC.useContext(vn),p=tC.useRef(null),g=tC.useId(),v=tC.useMemo(()=>[...Array(i)].map((e,t)=>({segments:i,bounds:new g6.Vector3(1,1,1),position:new g6.Vector3,uuid:g,index:t,ref:p,dist:0,matrix:new g6.Matrix4,color:new g6.Color,rotation:Math.PI/i*t})),[i,g]);return tC.useLayoutEffect(()=>{v.forEach((u,A)=>{(0,o0.s)(u,{volume:o,color:n,speed:t,growth:c,opacity:e,fade:a,bounds:r,density:Math.max(.5,f()),rotationFactor:Math.max(.2,.5*f())*t});let d=null==l?void 0:l(u,A);if(d||i>1){var m;u.position.copy(u.bounds).multiply(null!=(m=null==d?void 0:d.point)?m:{x:2*f()-1,y:2*f()-1,z:2*f()-1})}let p=Math.abs(u.position.x),g=Math.abs(u.position.y),v=Math.abs(u.position.z),y=Math.max(p,g,v);u.length=1,p===y&&(u.length-=p/u.bounds.x),g===y&&(u.length-=g/u.bounds.y),v===y&&(u.length-=v/u.bounds.z),u.volume=((null==d?void 0:d.volume)!==void 0?d.volume:Math.max(Math.max(0,s),"random"===h?f():"inside"===h?u.length:1-u.length))*o})},[h,r,a,n,e,c,o,u,i,t]),tC.useLayoutEffect(()=>(m.current=[...m.current,...v],()=>{m.current=m.current.filter(e=>e.uuid!==g)}),[v]),tC.useImperativeHandle(d,()=>p.current,[]),tC.createElement("group",e2({ref:p},A))}),vs=tC.forwardRef((e,t)=>tC.useContext(vn)?tC.createElement(vo,e2({ref:t},e)):tC.createElement(va,null,tC.createElement(vo,e2({ref:t},e))));var vl=tw,on=tI,tI=tI;class vc extends vl.ShaderMaterial{constructor(){super({uniforms:{time:{value:0},pixelRatio:{value:1}},vertexShader:`
        uniform float pixelRatio;
        uniform float time;
        attribute float size;  
        attribute float speed;  
        attribute float opacity;
        attribute vec3 noise;
        attribute vec3 color;
        varying vec3 vColor;
        varying float vOpacity;

        void main() {
          vec4 modelPosition = modelMatrix * vec4(position, 1.0);
          modelPosition.y += sin(time * speed + modelPosition.x * noise.x * 100.0) * 0.2;
          modelPosition.z += cos(time * speed + modelPosition.x * noise.y * 100.0) * 0.2;
          modelPosition.x += cos(time * speed + modelPosition.x * noise.z * 100.0) * 0.2;
          vec4 viewPosition = viewMatrix * modelPosition;
          vec4 projectionPostion = projectionMatrix * viewPosition;
          gl_Position = projectionPostion;
          gl_PointSize = size * 25. * pixelRatio;
          gl_PointSize *= (1.0 / - viewPosition.z);
          vColor = color;
          vOpacity = opacity;
        }
      `,fragmentShader:`
        varying vec3 vColor;
        varying float vOpacity;
        void main() {
          float distanceToCenter = distance(gl_PointCoord, vec2(0.5));
          float strength = 0.05 / distanceToCenter - 0.1;
          gl_FragColor = vec4(vColor, strength * vOpacity);
          #include <tonemapping_fragment>
          #include <${oW>=154?"colorspace_fragment":"encodings_fragment"}>
        }
      `})}get time(){return this.uniforms.time.value}set time(e){this.uniforms.time.value=e}get pixelRatio(){return this.uniforms.pixelRatio.value}set pixelRatio(e){this.uniforms.pixelRatio.value=e}}let vh=e=>e&&e.constructor===Float32Array,vu=e=>e instanceof vl.Vector2||e instanceof vl.Vector3||e instanceof vl.Vector4,vA=e=>Array.isArray(e)?e:vu(e)?e.toArray():[e,e,e];function vd(e,t,r){return tC.useMemo(()=>{if(void 0!==t)if(vh(t))return t;else{if(t instanceof vl.Color){let r=Array.from({length:3*e},()=>[t.r,t.g,t.b]).flat();return Float32Array.from(r)}if(vu(t)||Array.isArray(t)){let r=Array.from({length:3*e},()=>vA(t)).flat();return Float32Array.from(r)}return Float32Array.from({length:e},()=>t)}return Float32Array.from({length:e},r)},[t])}let vf=tC.forwardRef(({noise:e=1,count:t=100,speed:r=1,opacity:i=1,scale:n=1,size:a,color:o,children:s,...l},c)=>{tC.useMemo(()=>(0,on.e)({SparklesImplMaterial:vc}),[]);let h=tC.useRef(null),u=(0,tI.C)(e=>e.viewport.dpr),A=vA(n),d=tC.useMemo(()=>Float32Array.from(Array.from({length:t},()=>A.map(vl.MathUtils.randFloatSpread)).flat()),[t,...A]),f=vd(t,a,Math.random),m=vd(t,i),p=vd(t,r),g=vd(3*t,e),v=vd(void 0===o?3*t:t,vh(o)?o:new vl.Color(o),()=>1);return(0,tb.useFrame)(e=>{h.current&&h.current.material&&(h.current.material.time=e.clock.elapsedTime)}),tC.useImperativeHandle(c,()=>h.current,[]),tC.createElement("points",e2({key:`particle-${t}-${JSON.stringify(n)}`},l,{ref:h}),tC.createElement("bufferGeometry",null,tC.createElement("bufferAttribute",{attach:"attributes-position",args:[d,3]}),tC.createElement("bufferAttribute",{attach:"attributes-size",args:[f,1]}),tC.createElement("bufferAttribute",{attach:"attributes-opacity",args:[m,1]}),tC.createElement("bufferAttribute",{attach:"attributes-speed",args:[p,1]}),tC.createElement("bufferAttribute",{attach:"attributes-color",args:[v,3]}),tC.createElement("bufferAttribute",{attach:"attributes-noise",args:[g,3]})),s||tC.createElement("sparklesImplMaterial",{transparent:!0,pixelRatio:u,depthWrite:!1}))});function vm(e=0,t=1024,r){let i=(0,or.suspend)(()=>fetch("https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master/matcaps.json").then(e=>e.json()),["matcapList"]),n=i[0],a=tC.useMemo(()=>Object.keys(i).length,[]),o=tC.useMemo(()=>"string"==typeof e?e:"number"==typeof e?i[e]:null,[e]),s=`${o||n}${function(e){switch(e){case 64:return"-64px";case 128:return"-128px";case 256:return"-256px";case 512:return"-512px";default:return""}}(t)}.png`,l=`https://rawcdn.githack.com/emmelleppi/matcaps/9b36ccaaf0a24881a39062d05566c9e92be4aa0d/${t}/${s}`;return[oJ(l,r),l,a]}let vp=({children:e,id:t,format:r,onLoad:i})=>{let n=vm(t,r,i);return tC.createElement(tC.Fragment,null,null==e?void 0:e(n))};function vg(e=0,t={},r){let{repeat:i=[1,1],anisotropy:n=1,offset:a=[0,0]}=t,o=(0,or.suspend)(()=>fetch("https://cdn.jsdelivr.net/gh/pmndrs/drei-assets@master/normals/normals.json").then(e=>e.json()),["normalsList"]),s=tC.useMemo(()=>Object.keys(o).length,[]),l=o[0],c=o[e]||l,h=`https://rawcdn.githack.com/pmndrs/drei-assets/7a3104997e1576f83472829815b00880d88b32fb/normals/${c}`,u=oJ(h,r);return tC.useLayoutEffect(()=>{u&&(u.wrapS=u.wrapT=tw.RepeatWrapping,u.repeat=new tw.Vector2(i[0],i[1]),u.offset=new tw.Vector2(a[0],a[1]),u.anisotropy=n)},[u,n,i,a]),[u,h,s]}let vv=({children:e,id:t,onLoad:r,...i})=>{let n=vg(t,i,r);return tC.createElement(tC.Fragment,null,null==e?void 0:e(n))};var on=tI;let vy={uniforms:{strokeOpacity:1,fillOpacity:.25,fillMix:0,thickness:.05,colorBackfaces:!1,dashInvert:!0,dash:!1,dashRepeats:4,dashLength:.5,squeeze:!1,squeezeMin:.2,squeezeMax:1,stroke:new tw.Color("#ff0000"),backfaceStroke:new tw.Color("#0000ff"),fill:new tw.Color("#00ff00")},vertex:`
	  attribute vec3 barycentric;
	
		varying vec3 v_edges_Barycentric;
		varying vec3 v_edges_Position;

		void initWireframe() {
			v_edges_Barycentric = barycentric;
			v_edges_Position = position.xyz;
		}
	  `,fragment:`
		#ifndef PI
	  	#define PI 3.1415926535897932384626433832795
		#endif
  
	  varying vec3 v_edges_Barycentric;
	  varying vec3 v_edges_Position;
  
	  uniform float strokeOpacity;
	  uniform float fillOpacity;
	  uniform float fillMix;
	  uniform float thickness;
	  uniform bool colorBackfaces;
  
	  // Dash
	  uniform bool dashInvert;
	  uniform bool dash;
	  uniform bool dashOnly;
	  uniform float dashRepeats;
	  uniform float dashLength;
  
	  // Squeeze
	  uniform bool squeeze;
	  uniform float squeezeMin;
	  uniform float squeezeMax;
  
	  // Colors
	  uniform vec3 stroke;
	  uniform vec3 backfaceStroke;
	  uniform vec3 fill;
  
	  // This is like
	  float wireframe_aastep(float threshold, float dist) {
		  float afwidth = fwidth(dist) * 0.5;
		  return smoothstep(threshold - afwidth, threshold + afwidth, dist);
	  }
  
	  float wireframe_map(float value, float min1, float max1, float min2, float max2) {
		  return min2 + (value - min1) * (max2 - min2) / (max1 - min1);
	  }
  
	  float getWireframe() {
			vec3 barycentric = v_edges_Barycentric;
		
			// Distance from center of each triangle to its edges.
			float d = min(min(barycentric.x, barycentric.y), barycentric.z);

			// for dashed rendering, we can use this to get the 0 .. 1 value of the line length
			float positionAlong = max(barycentric.x, barycentric.y);
			if (barycentric.y < barycentric.x && barycentric.y < barycentric.z) {
				positionAlong = 1.0 - positionAlong;
			}

			// the thickness of the stroke
			float computedThickness = wireframe_map(thickness, 0.0, 1.0, 0.0, 0.34);

			// if we want to shrink the thickness toward the center of the line segment
			if (squeeze) {
				computedThickness *= mix(squeezeMin, squeezeMax, (1.0 - sin(positionAlong * PI)));
			}

			// Create dash pattern
			if (dash) {
				// here we offset the stroke position depending on whether it
				// should overlap or not
				float offset = 1.0 / dashRepeats * dashLength / 2.0;
				if (!dashInvert) {
					offset += 1.0 / dashRepeats / 2.0;
				}

				// if we should animate the dash or not
				// if (dashAnimate) {
				// 	offset += time * 0.22;
				// }

				// create the repeating dash pattern
				float pattern = fract((positionAlong + offset) * dashRepeats);
				computedThickness *= 1.0 - wireframe_aastep(dashLength, pattern);
			}

			// compute the anti-aliased stroke edge  
			float edge = 1.0 - wireframe_aastep(computedThickness, d);

			return edge;
	  }
	  `},vx=oV(vy.uniforms,vy.vertex+`
  	void main() {
		initWireframe();
		gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
	}
  `,vy.fragment+`
  void main () {
		// Compute color

		float edge = getWireframe();
		vec4 colorStroke = vec4(stroke, edge);

		#ifdef FLIP_SIDED
			colorStroke.rgb = backfaceStroke;
		#endif
    
		vec4 colorFill = vec4(fill, fillOpacity);
		vec4 outColor = mix(colorFill, colorStroke, edge * strokeOpacity);

		gl_FragColor = outColor;
	}
  `);function vE(e){return(null==e?void 0:e.current)!==void 0}function vC(e){return"WireframeGeometry"===e.type}function vB(e){let t=null!=e&&e.current?e.current:e;if(null!=t&&t.isBufferGeometry)return t;{if(vC(t))throw Error("Wireframe: WireframeGeometry is not supported.");let e=t.parent;if(null!=e&&e.geometry){if(vC(e.geometry))throw Error("Wireframe: WireframeGeometry is not supported.");return e.geometry}}}function vw(e,t){if(e.index){console.warn("Wireframe: Requires non-indexed geometry, converting to non-indexed geometry.");let t=e.toNonIndexed();e.copy(t),e.setIndex(null)}let r=function(e,t){let r=e.getAttribute("position").count,i=[];for(let e=0;e<r;e++){let r=+!!t;e%2==0?i.push(0,0,1,0,1,0,1,0,r):i.push(0,1,0,0,0,1,1,0,r)}return new tw.BufferAttribute(Float32Array.from(i),3)}(e,t);e.setAttribute("barycentric",r)}function vI({geometry:e,simplify:t=!1,...r}){(0,on.e)({MeshWireframeMaterial:vx});let[i,n]=tC.useState(null);tC.useLayoutEffect(()=>{let r=vB(e);if(!r)throw Error("Wireframe: geometry prop must be a BufferGeometry or a ref to a BufferGeometry.");vw(r,t),vE(e)&&n(r)},[t,e]);let a=vE(e)?i:e;return tC.createElement(tC.Fragment,null,a&&tC.createElement("mesh",{geometry:a},tC.createElement("meshWireframeMaterial",e2({attach:"material",transparent:!0,side:tw.DoubleSide,polygonOffset:!0,polygonOffsetFactor:-4},r,{extensions:{derivatives:!0,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1}}))))}function vb({simplify:e=!1,...t}){let r=tC.useRef(null),i=tC.useMemo(()=>(function(){let e={};for(let t in vy.uniforms)e[t]={value:vy.uniforms[t]};return e})(),[vy.uniforms]);return tC.useEffect(()=>{var e;i.fillOpacity.value=null!=(e=t.fillOpacity)?e:i.fillOpacity.value},[t.fillOpacity]),tC.useEffect(()=>{var e;i.fillMix.value=null!=(e=t.fillMix)?e:i.fillMix.value},[t.fillMix]),tC.useEffect(()=>{var e;i.strokeOpacity.value=null!=(e=t.strokeOpacity)?e:i.strokeOpacity.value},[t.strokeOpacity]),tC.useEffect(()=>{var e;i.thickness.value=null!=(e=t.thickness)?e:i.thickness.value},[t.thickness]),tC.useEffect(()=>void(i.colorBackfaces.value=!!t.colorBackfaces),[t.colorBackfaces]),tC.useEffect(()=>void(i.dash.value=!!t.dash),[t.dash]),tC.useEffect(()=>void(i.dashInvert.value=!!t.dashInvert),[t.dashInvert]),tC.useEffect(()=>{var e;i.dashRepeats.value=null!=(e=t.dashRepeats)?e:i.dashRepeats.value},[t.dashRepeats]),tC.useEffect(()=>{var e;i.dashLength.value=null!=(e=t.dashLength)?e:i.dashLength.value},[t.dashLength]),tC.useEffect(()=>void(i.squeeze.value=!!t.squeeze),[t.squeeze]),tC.useEffect(()=>{var e;i.squeezeMin.value=null!=(e=t.squeezeMin)?e:i.squeezeMin.value},[t.squeezeMin]),tC.useEffect(()=>{var e;i.squeezeMax.value=null!=(e=t.squeezeMax)?e:i.squeezeMax.value},[t.squeezeMax]),tC.useEffect(()=>void(i.stroke.value=t.stroke?new tw.Color(t.stroke):i.stroke.value),[t.stroke]),tC.useEffect(()=>void(i.fill.value=t.fill?new tw.Color(t.fill):i.fill.value),[t.fill]),tC.useEffect(()=>void(i.backfaceStroke.value=t.backfaceStroke?new tw.Color(t.backfaceStroke):i.backfaceStroke.value),[t.backfaceStroke]),tC.useLayoutEffect(()=>{let t=vB(r);if(!t)throw Error("Wireframe: Must be a child of a Mesh, Line or Points object or specify a geometry prop.");let i=t.clone();return vw(t,e),()=>{t.copy(i),i.dispose()}},[e]),tC.useLayoutEffect(()=>{var e;let t=r.current.parent,n=t.material.clone();return e=t.material,e.onBeforeCompile=e=>{e.uniforms={...e.uniforms,...i},e.vertexShader=e.vertexShader.replace("void main() {",`
		  ${vy.vertex}
		  void main() {
			initWireframe();
		`),e.fragmentShader=e.fragmentShader.replace("void main() {",`
		  ${vy.fragment}
		  void main() {
		`),e.fragmentShader=e.fragmentShader.replace("#include <color_fragment>",`
		  #include <color_fragment>
			  float edge = getWireframe();
		  vec4 colorStroke = vec4(stroke, edge);
		  #ifdef FLIP_SIDED
			colorStroke.rgb = backfaceStroke;
		  #endif
		  vec4 colorFill = vec4(mix(diffuseColor.rgb, fill, fillMix), mix(diffuseColor.a, fillOpacity, fillMix));
		  vec4 outColor = mix(colorFill, colorStroke, edge * strokeOpacity);

		  diffuseColor.rgb = outColor.rgb;
		  diffuseColor.a *= outColor.a;
		`)},e.side=tw.DoubleSide,e.transparent=!0,()=>{t.material.dispose(),t.material=n}},[]),tC.createElement("object3D",{ref:r})}function v_({geometry:e,...t}){return e?tC.createElement(vI,e2({geometry:e},t)):tC.createElement(vb,t)}function vM({opacity:e,alphaMap:t}){let r=tC.useRef(null),i=tC.useRef(null),n=tC.useRef({value:1}),a=tC.useRef({value:null}),o=tC.useRef({value:!1});return tC.useLayoutEffect(()=>{r.current.onBeforeCompile=i.current.onBeforeCompile=e=>{let t,r=e.fragmentShader.indexOf("void main"),i="",s=r;for(;"\n"!==t&&s<r+100;)i+=t=e.fragmentShader.charAt(s),s++;i=i.trim(),e.vertexShader=e.vertexShader.replace("void main() {",`
        varying vec2 custom_vUv;

        void main() {
          custom_vUv = uv;
          
        `),e.fragmentShader=e.fragmentShader.replace(i,`
          uniform float uShadowOpacity;
          uniform sampler2D uAlphaMap;
          uniform bool uHasAlphaMap;

          varying vec2 custom_vUv;
  
          float bayerDither2x2( vec2 v ) {
            return mod( 3.0 * v.y + 2.0 * v.x, 4.0 );
          }
    
          float bayerDither4x4( vec2 v ) {
            vec2 P1 = mod( v, 2.0 );
            vec2 P2 = mod( floor( 0.5  * v ), 2.0 );
            return 4.0 * bayerDither2x2( P1 ) + bayerDither2x2( P2 );
          }
  
          void main() {
            float alpha = 
              uHasAlphaMap ? 
                uShadowOpacity * texture2D(uAlphaMap, custom_vUv).x
              : uShadowOpacity;

            if( ( bayerDither4x4( floor( mod( gl_FragCoord.xy, 4.0 ) ) ) ) / 16.0 >= alpha ) discard;
            
          `),e.uniforms.uShadowOpacity=n.current,e.uniforms.uAlphaMap=a.current,e.uniforms.uHasAlphaMap=o.current}},[]),(0,tb.useFrame)(()=>{var i;let s=null==(i=r.current.__r3f)||null==(i=i.parent)?void 0:i.object;if(s){let r=s.material;r&&(n.current.value=null!=e?e:r.opacity,!1===t?(a.current.value=null,o.current.value=!1):(a.current.value=t||r.alphaMap,o.current.value=!!a.current.value))}}),tC.createElement(tC.Fragment,null,tC.createElement("meshDepthMaterial",{ref:r,attach:"customDepthMaterial",depthPacking:tw.RGBADepthPacking}),tC.createElement("meshDistanceMaterial",{ref:i,attach:"customDistanceMaterial"}))}var vS=tw,on=tI;let vT=new vS.Matrix4,vD=new vS.Ray,vF=new vS.Sphere,vR=new vS.Vector3;class vP extends vS.Group{constructor(){super(),this.size=0,this.color=new vS.Color("white"),this.instance={current:void 0},this.instanceKey={current:void 0}}get geometry(){var e;return null==(e=this.instance.current)?void 0:e.geometry}raycast(e,t){var r,i;let n=this.instance.current;if(!n||!n.geometry)return;let a=n.userData.instances.indexOf(this.instanceKey);if(-1===a||a>n.geometry.drawRange.count)return;let o=null!=(r=null==(i=e.params.Points)?void 0:i.threshold)?r:1;if(vF.set(this.getWorldPosition(vR),o),!1===e.ray.intersectsSphere(vF))return;vT.copy(n.matrixWorld).invert(),vD.copy(e.ray).applyMatrix4(vT);let s=o/((this.scale.x+this.scale.y+this.scale.z)/3),l=vD.distanceSqToPoint(this.position);if(l<s*s){let r=new vS.Vector3;vD.closestPointToPoint(this.position,r),r.applyMatrix4(this.matrixWorld);let i=e.ray.origin.distanceTo(r);if(i<e.near||i>e.far)return;t.push({distance:i,distanceToRay:Math.sqrt(l),point:r,index:a,face:null,object:this})}}}let vQ=tC.createContext(null),vU=new vS.Matrix4,vz=new vS.Vector3,vk=tC.forwardRef(({children:e,range:t,limit:r=1e3,...i},n)=>{let a=tC.useRef(null);tC.useImperativeHandle(n,()=>a.current,[]);let[o,s]=tC.useState([]),[[l,c,h]]=tC.useState(()=>[new Float32Array(3*r),Float32Array.from({length:3*r},()=>1),Float32Array.from({length:r},()=>1)]);tC.useEffect(()=>{a.current.geometry.attributes.position.needsUpdate=!0}),(0,tb.useFrame)(()=>{for(a.current.updateMatrix(),a.current.updateMatrixWorld(),vU.copy(a.current.matrixWorld).invert(),a.current.geometry.drawRange.count=Math.min(r,void 0!==t?t:r,o.length),H=0;H<o.length;H++)(V=o[H].current).getWorldPosition(vz).applyMatrix4(vU),vz.toArray(l,3*H),a.current.geometry.attributes.position.needsUpdate=!0,V.matrixWorldNeedsUpdate=!0,V.color.toArray(c,3*H),a.current.geometry.attributes.color.needsUpdate=!0,h.set([V.size],H),a.current.geometry.attributes.size.needsUpdate=!0});let u=tC.useMemo(()=>({getParent:()=>a,subscribe:e=>(s(t=>[...t,e]),()=>s(t=>t.filter(t=>t.current!==e.current)))}),[]);return tC.createElement("points",e2({userData:{instances:o},matrixAutoUpdate:!1,ref:a,raycast:()=>null},i),tC.createElement("bufferGeometry",null,tC.createElement("bufferAttribute",{attach:"attributes-position",args:[l,3],usage:vS.DynamicDrawUsage}),tC.createElement("bufferAttribute",{attach:"attributes-color",args:[c,3],usage:vS.DynamicDrawUsage}),tC.createElement("bufferAttribute",{attach:"attributes-size",args:[h,1],usage:vS.DynamicDrawUsage})),tC.createElement(vQ.Provider,{value:u},e))}),vL=tC.forwardRef(({children:e,...t},r)=>{tC.useMemo(()=>(0,on.e)({PositionPoint:vP}),[]);let i=tC.useRef(null);tC.useImperativeHandle(r,()=>i.current,[]);let{subscribe:n,getParent:a}=tC.useContext(vQ);return tC.useLayoutEffect(()=>n(i),[]),tC.createElement("positionPoint",e2({instance:a(),instanceKey:i,ref:i},t),e)}),vO=tC.forwardRef(({children:e,positions:t,colors:r,sizes:i,stride:n=3,...a},o)=>{let s=tC.useRef(null);return tC.useImperativeHandle(o,()=>s.current,[]),(0,tb.useFrame)(()=>{let e=s.current.geometry.attributes;e.position.needsUpdate=!0,r&&(e.color.needsUpdate=!0),i&&(e.size.needsUpdate=!0)}),tC.createElement("points",e2({ref:s},a),tC.createElement("bufferGeometry",null,tC.createElement("bufferAttribute",{attach:"attributes-position",args:[t,n],usage:vS.DynamicDrawUsage}),r&&tC.createElement("bufferAttribute",{attach:"attributes-color",args:[r,n],count:r.length/n,usage:vS.DynamicDrawUsage}),i&&tC.createElement("bufferAttribute",{attach:"attributes-size",args:[i,1],count:i.length/n,usage:vS.DynamicDrawUsage})),e)}),vG=tC.forwardRef((e,t)=>e.positions instanceof Float32Array?tC.createElement(vO,e2({},e,{ref:t})):tC.createElement(vk,e2({},e,{ref:t})));var on=tI;let vN=tC.createContext(null),vH=tC.forwardRef((e,t)=>{tC.useMemo(()=>(0,on.e)({SegmentObject:vV}),[]);let{limit:r=1e3,lineWidth:i=1,children:n,...a}=e,[o,s]=tC.useState([]),[l]=tC.useState(()=>new nV),[c]=tC.useState(()=>new nb),[h]=tC.useState(()=>new nC),[u]=tC.useState(()=>new tw.Vector2(512,512)),[A]=tC.useState(()=>Array(6*r).fill(0)),[d]=tC.useState(()=>Array(6*r).fill(0)),f=tC.useMemo(()=>({subscribe:e=>(s(t=>[...t,e]),()=>s(t=>t.filter(t=>t.current!==e.current)))}),[]);return(0,tb.useFrame)(()=>{for(let t=0;t<r;t++){var e;let r=null==(e=o[t])?void 0:e.current;r&&(A[6*t+0]=r.start.x,A[6*t+1]=r.start.y,A[6*t+2]=r.start.z,A[6*t+3]=r.end.x,A[6*t+4]=r.end.y,A[6*t+5]=r.end.z,d[6*t+0]=r.color.r,d[6*t+1]=r.color.g,d[6*t+2]=r.color.b,d[6*t+3]=r.color.r,d[6*t+4]=r.color.g,d[6*t+5]=r.color.b)}h.setColors(d),h.setPositions(A),l.computeLineDistances()}),tC.createElement("primitive",{object:l,ref:t},tC.createElement("primitive",{object:h,attach:"geometry"}),tC.createElement("primitive",e2({object:c,attach:"material",vertexColors:!0,resolution:u,linewidth:i},a)),tC.createElement(vN.Provider,{value:f},n))});class vV{constructor(){this.color=new tw.Color("white"),this.start=new tw.Vector3(0,0,0),this.end=new tw.Vector3(0,0,0)}}let vj=e=>e instanceof tw.Vector3?e:new tw.Vector3(..."number"==typeof e?[e,e,e]:e),vJ=tC.forwardRef(({color:e,start:t,end:r},i)=>{let n=tC.useContext(vN);if(!n)throw"Segment must used inside Segments component.";let a=tC.useRef(null);return tC.useImperativeHandle(i,()=>a.current,[]),tC.useLayoutEffect(()=>n.subscribe(a),[]),tC.createElement("segmentObject",{ref:a,color:e,start:vj(t),end:vj(r)})}),vY=tC.forwardRef(({children:e,hysteresis:t=0,distances:r,...i},n)=>{let a=tC.useRef(null);return tC.useImperativeHandle(n,()=>a.current,[]),tC.useLayoutEffect(()=>{let{current:e}=a;e.levels.length=0,e.children.forEach((i,n)=>e.levels.push({object:i,hysteresis:t,distance:r[n]}))}),(0,tb.useFrame)(e=>{var t;return null==(t=a.current)?void 0:t.update(e.camera)}),tC.createElement("lOD",e2({ref:a},i),e)});var tI=tI;function vW({all:e,scene:t,camera:r}){let i=(0,tI.C)(({gl:e})=>e),n=(0,tI.C)(({camera:e})=>e),a=(0,tI.C)(({scene:e})=>e);return tC.useLayoutEffect(()=>{let o=[];e&&(t||a).traverse(e=>{!1===e.visible&&(o.push(e),e.visible=!0)}),i.compile(t||a,r||n);let s=new tw.WebGLCubeRenderTarget(128);new tw.CubeCamera(.01,1e5,s).update(i,t||a),s.dispose(),o.forEach(e=>e.visible=!1)},[]),null}var tI=tI;function vK(){let e=(0,tI.C)(e=>e.gl);return(0,tC.useEffect)(()=>(e.shadowMap.autoUpdate=!1,e.shadowMap.needsUpdate=!0,()=>{e.shadowMap.autoUpdate=e.shadowMap.needsUpdate=!0}),[e.shadowMap]),null}let vX=new tw.Matrix4,vq=new tw.Ray,vZ=new tw.Sphere,v$=new tw.Vector3;function v1(e,t){let r=this.geometry,i=this.material,n=this.matrixWorld;void 0===i||(null===r.boundingSphere&&r.computeBoundingSphere(),vZ.copy(r.boundingSphere),vZ.applyMatrix4(n),!1===e.ray.intersectsSphere(vZ)||(vX.copy(n).invert(),vq.copy(e.ray).applyMatrix4(vX),(null===r.boundingBox||null!==vq.intersectBox(r.boundingBox,v$))&&t.push({distance:v$.distanceTo(e.ray.origin),point:v$.clone(),object:this})))}var tI=tI;function v0({pixelated:e}){let t=(0,tI.C)(e=>e.gl),r=(0,tI.C)(e=>e.internal.active),i=(0,tI.C)(e=>e.performance.current),n=(0,tI.C)(e=>e.viewport.initialDpr),a=(0,tI.C)(e=>e.setDpr);return tC.useEffect(()=>{let i=t.domElement;return()=>{r&&a(n),e&&i&&(i.style.imageRendering="auto")}},[]),tC.useEffect(()=>{a(i*n),e&&t.domElement&&(t.domElement.style.imageRendering=1===i?"auto":"pixelated")},[i]),null}var tI=tI;function v2(){let e=(0,tI.C)(e=>e.get),t=(0,tI.C)(e=>e.setEvents),r=(0,tI.C)(e=>e.performance.current);return tC.useEffect(()=>{let r=e().events.enabled;return()=>t({enabled:r})},[]),tC.useEffect(()=>t({enabled:1===r}),[r]),null}let v3=(0,tC.createContext)(null);function v4({iterations:e=10,ms:t=250,threshold:r=.75,step:i=.1,factor:n=.5,flipflops:a=1/0,bounds:o=e=>e>100?[60,100]:[40,60],onIncline:s,onDecline:l,onChange:c,onFallback:h,children:u}){let[A,d]=(0,tC.useState)(()=>({fps:0,index:0,factor:n,flipped:0,refreshrate:0,fallback:!1,frames:[],averages:[],subscriptions:new Map,subscribe:e=>{let t=Symbol();return A.subscriptions.set(t,e.current),()=>void A.subscriptions.delete(t)}})),f=0;return(0,tb.useFrame)(()=>{let{frames:n,averages:u}=A;if(!A.fallback&&u.length<e){n.push(performance.now());let d=n[n.length-1]-n[0];if(d>=t){if(A.fps=Math.round(n.length/d*1e3)/1,A.refreshrate=Math.max(A.refreshrate,A.fps),u[A.index++%e]=A.fps,u.length===e){let[t,n]=o(A.refreshrate),d=u.filter(e=>e>=n),m=u.filter(e=>e<t);d.length>e*r&&(A.factor=Math.min(1,A.factor+i),A.flipped++,s&&s(A),A.subscriptions.forEach(e=>e.onIncline&&e.onIncline(A))),m.length>e*r&&(A.factor=Math.max(0,A.factor-i),A.flipped++,l&&l(A),A.subscriptions.forEach(e=>e.onDecline&&e.onDecline(A))),f!==A.factor&&(f=A.factor,c&&c(A),A.subscriptions.forEach(e=>e.onChange&&e.onChange(A))),A.flipped>a&&!A.fallback&&(A.fallback=!0,h&&h(A),A.subscriptions.forEach(e=>e.onFallback&&e.onFallback(A))),A.averages=[]}A.frames=[]}}}),tC.createElement(v3.Provider,{value:A},u)}function v5({onIncline:e,onDecline:t,onChange:r,onFallback:i}){let n=(0,tC.useContext)(v3),a=(0,tC.useRef)({onIncline:e,onDecline:t,onChange:r,onFallback:i});(0,tC.useLayoutEffect)(()=>{a.current.onIncline=e,a.current.onDecline=t,a.current.onChange=r,a.current.onFallback=i},[e,t,r,i]),(0,tC.useLayoutEffect)(()=>n.subscribe(a),[n])}var tI=tI,o4=tI;let v6=tC.forwardRef(({children:e,compute:t,width:r,height:i,samples:n=8,renderPriority:a=0,eventPriority:o=0,frames:s=1/0,stencilBuffer:l=!1,depthBuffer:c=!0,generateMipmaps:h=!1,...u},A)=>{let{size:d,viewport:f}=(0,tI.C)(),m=lQ((r||d.width)*f.dpr,(i||d.height)*f.dpr,{samples:n,stencilBuffer:l,depthBuffer:c,generateMipmaps:h}),[p]=tC.useState(()=>new tw.Scene),g=tC.useCallback((e,t,r)=>{var i,n,a;let o=null==(i=m.texture)||null==(i=i.__r3f.parent)?void 0:i.object;for(;o&&!(o instanceof tw.Object3D);)o=null==(a=o.__r3f.parent)?void 0:a.object;if(!o)return!1;r.raycaster.camera||r.events.compute(e,r,null==(n=r.previousRoot)?void 0:n.getState());let[s]=r.raycaster.intersectObject(o);if(!s)return!1;let l=s.uv;if(!l)return!1;t.raycaster.setFromCamera(t.pointer.set(2*l.x-1,2*l.y-1),t.camera)},[]);return tC.useImperativeHandle(A,()=>m.texture,[m]),tC.createElement(tC.Fragment,null,(0,o4.o)(tC.createElement(v8,{renderPriority:a,frames:s,fbo:m},e,tC.createElement("group",{onPointerOver:()=>null})),p,{events:{compute:t||g,priority:o}}),tC.createElement("primitive",e2({object:m.texture},u)))});function v8({frames:e,renderPriority:t,children:r,fbo:i}){let n,a,o,s,l=0;return(0,tb.useFrame)(t=>{(e===1/0||l<e)&&(n=t.gl.autoClear,a=t.gl.xr.enabled,o=t.gl.getRenderTarget(),s=t.gl.xr.isPresenting,t.gl.autoClear=!0,t.gl.xr.enabled=!1,t.gl.xr.isPresenting=!1,t.gl.setRenderTarget(i),t.gl.render(t.scene,t.camera),t.gl.setRenderTarget(o),t.gl.autoClear=n,t.gl.xr.enabled=a,t.gl.xr.isPresenting=s,l++)},t),tC.createElement(tC.Fragment,null,r)}var tI=tI,o4=tI;let v9=tC.forwardRef(({children:e,compute:t,renderPriority:r=-1,eventPriority:i=0,frames:n=1/0,stencilBuffer:a=!1,depthBuffer:o=!0,generateMipmaps:s=!1,resolution:l=896,near:c=.1,far:h=1e3,flip:u=!1,position:A,rotation:d,scale:f,quaternion:m,matrix:p,matrixAutoUpdate:g,...v},y)=>{let{size:x,viewport:E}=(0,tI.C)(),C=tC.useRef(null),B=tC.useMemo(()=>{let e=new tw.WebGLCubeRenderTarget(Math.max((l||x.width)*E.dpr,(l||x.height)*E.dpr),{stencilBuffer:a,depthBuffer:o,generateMipmaps:s});return e.texture.isRenderTargetTexture=!u,e.texture.flipY=!0,e.texture.type=tw.HalfFloatType,e},[l,u]);tC.useEffect(()=>()=>B.dispose(),[B]);let[w]=tC.useState(()=>new tw.Scene);return tC.useImperativeHandle(y,()=>({scene:w,fbo:B,camera:C.current}),[B]),tC.createElement(tC.Fragment,null,(0,o4.o)(tC.createElement(v7,{renderPriority:r,frames:n,camera:C},e,tC.createElement("group",{onPointerOver:()=>null})),w,{events:{compute:t,priority:i}}),tC.createElement("primitive",e2({object:B.texture},v)),tC.createElement("cubeCamera",{ref:C,args:[c,h,B],position:A,rotation:d,scale:f,quaternion:m,matrix:p,matrixAutoUpdate:g}))});function v7({frames:e,renderPriority:t,children:r,camera:i}){let n=0;return(0,tb.useFrame)(t=>{(e===1/0||n<e)&&(i.current.update(t.gl,t.scene),n++)},t),tC.createElement(tC.Fragment,null,r)}let ye=tC.forwardRef(({id:e=1,colorWrite:t=!1,depthWrite:r=!1,...i},n)=>{let a=tC.useRef(null),o=tC.useMemo(()=>({colorWrite:t,depthWrite:r,stencilWrite:!0,stencilRef:e,stencilFunc:tw.AlwaysStencilFunc,stencilFail:tw.ReplaceStencilOp,stencilZFail:tw.ReplaceStencilOp,stencilZPass:tw.ReplaceStencilOp}),[e,t,r]);return tC.useLayoutEffect(()=>{Object.assign(a.current.material,o)}),tC.useImperativeHandle(n,()=>a.current,[]),tC.createElement("mesh",e2({ref:a,renderOrder:-e},i))});function yt(e,t=!1){return{stencilWrite:!0,stencilRef:e,stencilFunc:t?tw.NotEqualStencilFunc:tw.EqualStencilFunc,stencilFail:tw.KeepStencilOp,stencilZFail:tw.KeepStencilOp,stencilZPass:tw.KeepStencilOp}}var tI=tI;function yr({renderPriority:e=1,zoom:t=0,segments:r=64,children:i,resolution:n=896,...a}){let o=tC.useRef(null),s=tC.useRef(null),{width:l,height:c}=(0,tI.C)(e=>e.size),[h]=tC.useState(()=>new tw.OrthographicCamera);tC.useLayoutEffect(()=>{h.position.set(0,0,100),h.zoom=100,h.left=-(l/2),h.right=l/2,h.top=c/2,h.bottom=-(c/2),h.updateProjectionMatrix()},[l,c]);let u=Math.sqrt(l*l+c*c)/100*(.5+t/2),A=new tw.Vector3,d=new tw.Sphere(new tw.Vector3,u),f=new tw.Matrix3,m=tC.useCallback((e,t,r)=>{t.pointer.set(e.offsetX/t.size.width*2-1,-(2*(e.offsetY/t.size.height))+1),t.raycaster.setFromCamera(t.pointer,h),t.raycaster.ray.intersectSphere(d,A)&&(A.normalize(),f.getNormalMatrix(s.current.camera.matrixWorld),s.current.camera.getWorldPosition(t.raycaster.ray.origin),t.raycaster.ray.direction.set(0,0,1).reflect(A),t.raycaster.ray.direction.x*=-1,t.raycaster.ray.direction.applyNormalMatrix(f).multiplyScalar(-1))},[]);return(0,tb.useFrame)(t=>{e&&t.gl.render(o.current,h)},e),tC.createElement(tC.Fragment,null,tC.createElement("mesh",e2({ref:o},a,{scale:u}),tC.createElement("sphereGeometry",{args:[1,r,r]}),tC.createElement("meshBasicMaterial",null,tC.createElement(v9,{compute:m,attach:"envMap",flip:!0,resolution:n,ref:s},i,tC.createElement(yi,{api:s})))))}function yi({api:e}){let t=new tw.Vector3,r=new tw.Quaternion,i=new tw.Vector3,n=new tw.Euler(0,Math.PI,0);return(0,tb.useFrame)(a=>{a.camera.matrixWorld.decompose(t,r,i),e.current.camera.position.copy(t),e.current.camera.quaternion.setFromEuler(n).premultiply(r)}),null}var on=tI,tI=tI;let yn=oV({blur:0,map:null,sdf:null,blend:0,size:0,resolution:new tw.Vector2},`varying vec2 vUv;
   void main() {
     gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
     vUv = uv;
   }`,`uniform sampler2D sdf;
   uniform sampler2D map;
   uniform float blur;
   uniform float size;
   uniform float time;
   uniform vec2 resolution;
   varying vec2 vUv;
   #include <packing>
   void main() {
     vec2 uv = gl_FragCoord.xy / resolution.xy;
     vec4 t = texture2D(map, uv);
     float k = blur;
     float d = texture2D(sdf, vUv).r/size;
     float alpha = 1.0 - smoothstep(0.0, 1.0, clamp(d/k + 1.0, 0.0, 1.0));
     gl_FragColor = vec4(t.rgb, blur == 0.0 ? t.a : t.a * alpha);
     #include <tonemapping_fragment>
     #include <${oW>=154?"colorspace_fragment":"encodings_fragment"}>
   }`),ya=tC.forwardRef(({children:e,events:t,blur:r=0,eventPriority:i=0,renderPriority:n=0,worldUnits:a=!1,resolution:o=512,...s},l)=>{(0,on.e)({PortalMaterialImpl:yn});let c=tC.useRef(null),{scene:h,gl:u,size:A,viewport:d,setEvents:f}=(0,tI.C)(),m=lQ(o,o),[p,g]=tC.useState(0);(0,tb.useFrame)(()=>{let e=c.current.blend>0?Math.max(1,n):0;p!==e&&g(e)}),tC.useEffect(()=>{void 0!==t&&f({enabled:!t})},[t]);let[v,y]=tC.useState(!0),x=f6(y);tC.useLayoutEffect(()=>{var e;x.current=null==(e=c.current)||null==(e=e.__r3f.parent)?void 0:e.object},[]),tC.useLayoutEffect(()=>{if(x.current&&r&&null===c.current.sdf){let e=new tw.Mesh(x.current.geometry,new tw.MeshBasicMaterial),t=new tw.Box3().setFromBufferAttribute(e.geometry.attributes.position),r=new tw.OrthographicCamera(t.min.x*(1+2/o),t.max.x*(1+2/o),t.max.y*(1+2/o),t.min.y*(1+2/o),.1,1e3);r.position.set(0,0,1),r.lookAt(0,0,0),u.setRenderTarget(m),u.render(e,r);let i=ys(o,o,u)(m.texture),n=new Float32Array(o*o);u.readRenderTargetPixels(i,0,0,o,o,n);let a=1/0;for(let e=0;e<n.length;e++)n[e]<a&&(a=n[e]);a=-a,c.current.size=a,c.current.sdf=i.texture,u.setRenderTarget(null)}},[o,r]),tC.useImperativeHandle(l,()=>c.current);let E=tC.useCallback((e,t,r)=>{var i;if(!x.current)return!1;if(t.pointer.set(e.offsetX/t.size.width*2-1,-(2*(e.offsetY/t.size.height))+1),t.raycaster.setFromCamera(t.pointer,t.camera),(null==(i=c.current)?void 0:i.blend)===0){let[e]=t.raycaster.intersectObject(x.current);if(!e)return t.raycaster.camera=void 0,!1}},[]);return tC.createElement("portalMaterialImpl",e2({ref:c,blur:r,blend:0,resolution:[A.width*d.dpr,A.height*d.dpr],attach:"material"},s),tC.createElement(v6,{attach:"map",frames:v?1/0:0,eventPriority:i,renderPriority:n,compute:E},e,tC.createElement(yo,{events:t,rootScene:h,priority:p,material:c,worldUnits:a})))});function yo({events:e,rootScene:t,material:r,priority:i,worldUnits:n}){let a=(0,tI.C)(e=>e.scene),o=(0,tI.C)(e=>e.setEvents),s=lQ(),l=lQ();tC.useLayoutEffect(()=>{a.matrixAutoUpdate=!1},[]),tC.useEffect(()=>{void 0!==e&&o({enabled:e})},[e]);let[c,h]=tC.useMemo(()=>{let e={value:0};return[new ow(new tw.ShaderMaterial({uniforms:{a:{value:s.texture},b:{value:l.texture},blend:e},vertexShader:`
          varying vec2 vUv;
          void main() {
            vUv = uv;
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
          }`,fragmentShader:`
          uniform sampler2D a;
          uniform sampler2D b;
          uniform float blend;
          varying vec2 vUv;
          #include <packing>
          void main() {
            vec4 ta = texture2D(a, vUv);
            vec4 tb = texture2D(b, vUv);
            gl_FragColor = mix(tb, ta, blend);
            #include <tonemapping_fragment>
            #include <${oW>=154?"colorspace_fragment":"encodings_fragment"}>
          }`})),e]},[]);return(0,tb.useFrame)(e=>{var o,u,A,d,f;let m=null==r||null==(o=r.current)||null==(o=o.__r3f.parent)?void 0:o.object;m&&(n?a.matrixWorld.identity():(i&&(null==(u=r.current)?void 0:u.blend)===1&&m.updateWorldMatrix(!0,!1),a.matrixWorld.copy(m.matrixWorld)),i&&((null==(A=r.current)?void 0:A.blend)>0&&(null==(d=r.current)?void 0:d.blend)<1?(h.value=r.current.blend,e.gl.setRenderTarget(s),e.gl.render(a,e.camera),e.gl.setRenderTarget(l),e.gl.render(t,e.camera),e.gl.setRenderTarget(null),c.render(e.gl)):(null==(f=r.current)?void 0:f.blend)===1&&e.gl.render(a,e.camera)))},i),tC.createElement(tC.Fragment,null)}let ys=(e,t,r)=>{let i=new tw.WebGLRenderTarget(e,t,{minFilter:tw.LinearMipmapLinearFilter,magFilter:tw.LinearFilter,type:tw.FloatType,format:tw.RedFormat,generateMipmaps:!0}),n=new tw.WebGLRenderTarget(e,t,{minFilter:tw.NearestFilter,magFilter:tw.NearestFilter}),a=new tw.WebGLRenderTarget(e,t,{minFilter:tw.NearestFilter,magFilter:tw.NearestFilter}),o=new tw.WebGLRenderTarget(e,t,{minFilter:tw.NearestFilter,magFilter:tw.NearestFilter}),s=new tw.WebGLRenderTarget(e,t,{minFilter:tw.NearestFilter,magFilter:tw.NearestFilter}),l=new tw.WebGLRenderTarget(e,t,{minFilter:tw.NearestFilter,magFilter:tw.NearestFilter,type:tw.FloatType,format:tw.RedFormat}),c=new tw.WebGLRenderTarget(e,t,{minFilter:tw.NearestFilter,magFilter:tw.NearestFilter,type:tw.FloatType,format:tw.RedFormat}),h=new ow(new tw.ShaderMaterial({uniforms:{tex:{value:null}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        uniform sampler2D tex;
        varying vec2 vUv;
        #include <packing>
        void main() {
          gl_FragColor = pack2HalfToRGBA(vUv * (round(texture2D(tex, vUv).x)));
        }`})),u=new ow(new tw.ShaderMaterial({uniforms:{tex:{value:null}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        uniform sampler2D tex;
        varying vec2 vUv;
        #include <packing>
        void main() {
          gl_FragColor = pack2HalfToRGBA(vUv * (1.0 - round(texture2D(tex, vUv).x)));
        }`})),A=new ow(new tw.ShaderMaterial({uniforms:{tex:{value:null},offset:{value:0},level:{value:0},maxSteps:{value:0}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        varying vec2 vUv;
        uniform sampler2D tex;
        uniform float offset;
        uniform float level;
        uniform float maxSteps;
        #include <packing>
        void main() {
          float closestDist = 9999999.9;
          vec2 closestPos = vec2(0.0);
          for (float x = -1.0; x <= 1.0; x += 1.0) {
            for (float y = -1.0; y <= 1.0; y += 1.0) {
              vec2 voffset = vUv;
              voffset += vec2(x, y) * vec2(${1/e}, ${1/t}) * offset;
              vec2 pos = unpackRGBATo2Half(texture2D(tex, voffset));
              float dist = distance(pos.xy, vUv);
              if(pos.x != 0.0 && pos.y != 0.0 && dist < closestDist) {
                closestDist = dist;
                closestPos = pos;
              }
            }
          }
          gl_FragColor = pack2HalfToRGBA(closestPos);
        }`})),d=new ow(new tw.ShaderMaterial({uniforms:{tex:{value:null},size:{value:new tw.Vector2(e,t)}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        varying vec2 vUv;
        uniform sampler2D tex;
        uniform vec2 size;
        #include <packing>
        void main() {
          gl_FragColor = vec4(distance(size * unpackRGBATo2Half(texture2D(tex, vUv)), size * vUv), 0.0, 0.0, 0.0);
        }`})),f=new ow(new tw.ShaderMaterial({uniforms:{inside:{value:c.texture},outside:{value:l.texture},tex:{value:null}},vertexShader:`
        varying vec2 vUv;
        void main() {
          vUv = uv;
          gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }`,fragmentShader:`
        varying vec2 vUv;
        uniform sampler2D inside;
        uniform sampler2D outside;
        uniform sampler2D tex;
        #include <packing>
        void main() {
          float i = texture2D(inside, vUv).x;
          float o =texture2D(outside, vUv).x;
          if (texture2D(tex, vUv).x == 0.0) {
            gl_FragColor = vec4(o, 0.0, 0.0, 0.0);
          } else {
            gl_FragColor = vec4(-i, 0.0, 0.0, 0.0);
          }
        }`}));return m=>{m.minFilter=tw.NearestFilter,m.magFilter=tw.NearestFilter,h.material.uniforms.tex.value=m,r.setRenderTarget(n),h.render(r);let p=Math.ceil(Math.log(Math.max(e,t))/Math.log(2)),g=n,v=null;for(let e=0;e<p;e++){let t=Math.pow(2,p-e-1);v=g===n?o:n,A.material.uniforms.level.value=e,A.material.uniforms.maxSteps.value=p,A.material.uniforms.offset.value=t,A.material.uniforms.tex.value=g.texture,r.setRenderTarget(v),A.render(r),g=v}r.setRenderTarget(l),d.material.uniforms.tex.value=v.texture,d.render(r),u.material.uniforms.tex.value=m,r.setRenderTarget(a),u.render(r),g=a;for(let e=0;e<p;e++){let t=Math.pow(2,p-e-1);v=g===a?s:a,A.material.uniforms.level.value=e,A.material.uniforms.maxSteps.value=p,A.material.uniforms.offset.value=t,A.material.uniforms.tex.value=g.texture,r.setRenderTarget(v),A.render(r),g=v}return r.setRenderTarget(c),d.material.uniforms.tex.value=v.texture,d.render(r),r.setRenderTarget(i),f.material.uniforms.tex.value=m,f.render(r),r.setRenderTarget(null),i}};var rK=tI,tI=tI,o4=tI;let yl={get url(){return`file://${e.P("node_modules/tunnel-rat/node_modules/zustand/esm/vanilla.mjs")}`}},yc=e=>{let t,r=new Set,i=(e,i)=>{let n="function"==typeof e?e(t):e;if(!Object.is(n,t)){let e=t;t=(null!=i?i:"object"!=typeof n||null===n)?n:Object.assign({},t,n),r.forEach(r=>r(t,e))}},n=()=>t,a={setState:i,getState:n,getInitialState:()=>o,subscribe:e=>(r.add(e),()=>r.delete(e)),destroy:()=>{(yl.env?yl.env.MODE:void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),r.clear()}},o=t=e(i,n,a);return a};var yh=e.i(30224);let yu={get url(){return`file://${e.P("node_modules/tunnel-rat/node_modules/zustand/esm/index.mjs")}`}},{useDebugValue:yA}=tC.default,{useSyncExternalStoreWithSelector:yd}=yh.default,yf=!1,ym=e=>{(yu.env?yu.env.MODE:void 0)!=="production"&&"function"!=typeof e&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");let t="function"==typeof e?e?yc(e):yc:e,r=(e,r)=>(function(e,t=e=>e,r){(yu.env?yu.env.MODE:void 0)!=="production"&&r&&!yf&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),yf=!0);let i=yd(e.subscribe,e.getState,e.getServerState||e.getInitialState,t,r);return yA(i),i})(t,e,r);return Object.assign(r,t),r},yp="undefined"!=typeof window&&(null!=(tx=window.document)&&tx.createElement||(null==(tE=window.navigator)?void 0:tE.product)==="ReactNative")?tC.default.useLayoutEffect:tC.default.useEffect,yg=new tw.Color,yv=(eS=(eM=e=>({current:[],version:0,set:e}))?ym(eM):ym,{In:({children:e})=>{let t=eS(e=>e.set),r=eS(e=>e.version);return yp(()=>{t(e=>({version:e.version+1}))},[]),yp(()=>(t(({current:t})=>({current:[...t,e]})),()=>t(({current:t})=>({current:t.filter(t=>t!==e)}))),[e,r]),null},Out:()=>{let e=eS(e=>e.current);return tC.default.createElement(tC.default.Fragment,null,e)}});function yy(e,t){let{right:r,top:i,left:n,bottom:a,width:o,height:s}=t,l=t.bottom<0||i>e.height||r<0||t.left>e.width,c=e.top+e.height;return{position:{width:o,height:s,left:n-e.left,top:i,bottom:c-a,right:r},isOffscreen:l}}function yx(e,{left:t,bottom:r,width:i,height:n}){let a,o,s=i/n;return(o=e.camera)&&o.isOrthographicCamera?e.camera.manual?e.camera.updateProjectionMatrix():(e.camera.left!==-(i/2)||e.camera.right!==i/2||e.camera.top!==n/2||e.camera.bottom!==-(n/2))&&(Object.assign(e.camera,{left:-(i/2),right:i/2,top:n/2,bottom:-(n/2)}),e.camera.updateProjectionMatrix()):e.camera.aspect!==s&&(e.camera.aspect=s,e.camera.updateProjectionMatrix()),a=e.gl.autoClear,e.gl.autoClear=!1,e.gl.setViewport(t,r,i,n),e.gl.setScissor(t,r,i,n),e.gl.setScissorTest(!0),a}function yE(e,t){e.gl.setScissorTest(!1),e.gl.autoClear=t}function yC(e){e.gl.getClearColor(yg),e.gl.setClearColor(yg,e.gl.getClearAlpha()),e.gl.clear(!0,!0)}function yB({visible:e=!0,canvasSize:t,scene:r,index:i,children:n,frames:a,rect:o,track:s}){let l=(0,tI.C)(),[c,h]=tC.useState(!1),u=0;return(0,tb.useFrame)(i=>{if(a===1/0||u<=a){var l;s&&(o.current=null==(l=s.current)?void 0:l.getBoundingClientRect()),u++}if(o.current){let{position:a,isOffscreen:s}=yy(t,o.current);if(c!==s&&h(s),e&&!c&&o.current){let e=yx(i,a);i.gl.render(n?i.scene:r,i.camera),yE(i,e)}}},i),tC.useLayoutEffect(()=>{let r=o.current;if(r&&(!e||!c)){let{position:e}=yy(t,r),i=yx(l,e);yC(l),yE(l,i)}},[e,c]),tC.useEffect(()=>{if(!s)return;let e=o.current,r=l.get().events.connected;return l.setEvents({connected:s.current}),()=>{if(e){let{position:r}=yy(t,e),i=yx(l,r);yC(l),yE(l,i)}l.setEvents({connected:r})}},[s]),tC.createElement(tC.Fragment,null,n,tC.createElement("group",{onPointerOver:()=>null}))}let yw=tC.forwardRef(({track:e,visible:t=!0,index:r=1,id:i,style:n,className:a,frames:o=1/0,children:s,...l},c)=>{var h,u,A,d;let f=tC.useRef(null),{size:m,scene:p}=(0,tI.C)(),[g]=tC.useState(()=>new tw.Scene),[v,y]=tC.useReducer(()=>!0,!1),x=tC.useCallback((t,r)=>{if(f.current&&e&&e.current&&t.target===e.current){let{width:e,height:i,left:n,top:a}=f.current,o=t.clientX-n,s=t.clientY-a;r.pointer.set(o/e*2-1,-(s/i*2)+1),r.raycaster.setFromCamera(r.pointer,r.camera)}},[f,e]);return tC.useEffect(()=>{var t;e&&(f.current=null==(t=e.current)?void 0:t.getBoundingClientRect()),y()},[e]),tC.createElement("group",e2({ref:c},l),v&&(0,o4.o)(tC.createElement(yB,{visible:t,canvasSize:m,frames:o,scene:p,track:e,rect:f,index:r},s),g,{events:{compute:x,priority:r},size:{width:null==(h=f.current)?void 0:h.width,height:null==(u=f.current)?void 0:u.height,top:null==(A=f.current)?void 0:A.top,left:null==(d=f.current)?void 0:d.left}}))}),yI=tC.forwardRef(({as:e="div",id:t,visible:r,className:i,style:n,index:a=1,track:o,frames:s=1/0,children:l,...c},h)=>{let u=tC.useId(),A=tC.useRef(null);return tC.useImperativeHandle(h,()=>A.current),tC.createElement(tC.Fragment,null,tC.createElement(e,e2({ref:A,id:t,className:i,style:n},c)),tC.createElement(yv.In,null,tC.createElement(yw,{visible:r,key:u,track:A,frames:s,index:a},l)))}),yb=((eT=tC.forwardRef((e,t)=>tC.useContext(rK.q)?tC.createElement(yw,e2({ref:t},e)):tC.createElement(yI,e2({ref:t},e)))).Port=()=>tC.createElement(yv.Out,null),eT);var tI=tI,tI=tI;let y_=tC.createContext(null),yM=new tw.Vector3,yS=new tw.Vector3,yT=new tw.Vector3(0,1,0),yD=new tw.Matrix4,yF=({direction:e,axis:t})=>{let{translation:r,translationLimits:i,annotations:n,annotationsClass:a,depthTest:o,scale:s,lineWidth:l,fixed:c,axisColors:h,hoveredColor:u,opacity:A,renderOrder:d,onDragStart:f,onDrag:m,onDragEnd:p,userData:g}=tC.useContext(y_),v=(0,tI.C)(e=>e.controls),y=tC.useRef(null),x=tC.useRef(null),E=tC.useRef(null),C=tC.useRef(0),[B,w]=tC.useState(!1),I=tC.useCallback(i=>{n&&(y.current.innerText=`${r.current[t].toFixed(2)}`,y.current.style.display="block"),i.stopPropagation();let a=new tw.Matrix4().extractRotation(x.current.matrixWorld),o=i.point.clone(),s=new tw.Vector3().setFromMatrixPosition(x.current.matrixWorld),l=e.clone().applyMatrix4(a).normalize();E.current={clickPoint:o,dir:l},C.current=r.current[t],f({component:"Arrow",axis:t,origin:s,directions:[l]}),v&&(v.enabled=!1),i.target.setPointerCapture(i.pointerId)},[n,e,v,f,r,t]),b=tC.useCallback(e=>{if(e.stopPropagation(),B||w(!0),E.current){var a,o;let s,l,c,{clickPoint:h,dir:u}=E.current,[A,d]=(null==i?void 0:i[t])||[void 0,void 0],f=(a=e.ray.origin,o=e.ray.direction,s=u.dot(u),l=u.dot(h)-u.dot(a),0===(c=u.dot(o))?-l/s:(yM.copy(o).multiplyScalar(s/c).sub(u),yS.copy(o).multiplyScalar(l/c).add(a).sub(h),-yM.dot(yS)/yM.dot(yM)));void 0!==A&&(f=Math.max(f,A-C.current)),void 0!==d&&(f=Math.min(f,d-C.current)),r.current[t]=C.current+f,n&&(y.current.innerText=`${r.current[t].toFixed(2)}`),yD.makeTranslation(u.x*f,u.y*f,u.z*f),m(yD)}},[n,m,B,r,i,t]),_=tC.useCallback(e=>{n&&(y.current.style.display="none"),e.stopPropagation(),E.current=null,p(),v&&(v.enabled=!0),e.target.releasePointerCapture(e.pointerId)},[n,v,p]),M=tC.useCallback(e=>{e.stopPropagation(),w(!1)},[]),{cylinderLength:S,coneWidth:T,coneLength:D,matrixL:F}=tC.useMemo(()=>{let t=c?l/s*1.6:s/20,r=c?.2:s/5,i=c?1-r:s-r,n=new tw.Quaternion().setFromUnitVectors(yT,e.clone().normalize());return{cylinderLength:i,coneWidth:t,coneLength:r,matrixL:new tw.Matrix4().makeRotationFromQuaternion(n)}},[e,s,l,c]),R=B?u:h[t];return tC.createElement("group",{ref:x},tC.createElement("group",{matrix:F,matrixAutoUpdate:!1,onPointerDown:I,onPointerMove:b,onPointerUp:_,onPointerOut:M},n&&tC.createElement(tU,{position:[0,-D,0]},tC.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:a,ref:y})),tC.createElement("mesh",{visible:!1,position:[0,(S+D)/2,0],userData:g},tC.createElement("cylinderGeometry",{args:[1.4*T,1.4*T,S+D,8,1]})),tC.createElement(nj,{transparent:!0,raycast:()=>null,depthTest:o,points:[0,0,0,0,S,0],lineWidth:l,side:tw.DoubleSide,color:R,opacity:A,polygonOffset:!0,renderOrder:d,polygonOffsetFactor:-10,fog:!1}),tC.createElement("mesh",{raycast:()=>null,position:[0,S+D/2,0],renderOrder:d},tC.createElement("coneGeometry",{args:[T,D,24,1]}),tC.createElement("meshBasicMaterial",{transparent:!0,depthTest:o,color:R,opacity:A,polygonOffset:!0,polygonOffsetFactor:-10,fog:!1}))))};var tI=tI;let yR=new tw.Vector3,yP=new tw.Vector3,yQ=e=>180*e/Math.PI,yU=e=>{var t;let r,i=(r=Math.floor(e/(t=2*Math.PI)),e-(r=r<0?r+1:r)*t);return 1e-6>Math.abs(i)?0:(i<0&&(i+=2*Math.PI),i)},yz=new tw.Matrix4,yk=new tw.Vector3,yL=new tw.Ray,yO=new tw.Vector3,yG=({dir1:e,dir2:t,axis:r})=>{let{rotationLimits:i,annotations:n,annotationsClass:a,depthTest:o,scale:s,lineWidth:l,fixed:c,axisColors:h,hoveredColor:u,renderOrder:A,opacity:d,onDragStart:f,onDrag:m,onDragEnd:p,userData:g}=tC.useContext(y_),v=(0,tI.C)(e=>e.controls),y=tC.useRef(null),x=tC.useRef(null),E=tC.useRef(0),C=tC.useRef(0),B=tC.useRef(null),[w,I]=tC.useState(!1),b=tC.useCallback(e=>{n&&(y.current.innerText=`${yQ(C.current).toFixed(0)}\xba`,y.current.style.display="block"),e.stopPropagation();let t=e.point.clone(),i=new tw.Vector3().setFromMatrixPosition(x.current.matrixWorld),a=new tw.Vector3().setFromMatrixColumn(x.current.matrixWorld,0).normalize(),o=new tw.Vector3().setFromMatrixColumn(x.current.matrixWorld,1).normalize(),s=new tw.Vector3().setFromMatrixColumn(x.current.matrixWorld,2).normalize(),l=new tw.Plane().setFromNormalAndCoplanarPoint(s,i);B.current={clickPoint:t,origin:i,e1:a,e2:o,normal:s,plane:l},f({component:"Rotator",axis:r,origin:i,directions:[a,o,s]}),v&&(v.enabled=!1),e.target.setPointerCapture(e.pointerId)},[n,v,f,r]),_=tC.useCallback(e=>{if(e.stopPropagation(),w||I(!0),B.current){let t,a,o,s,l,{clickPoint:c,origin:h,e1:u,e2:A,normal:d,plane:f}=B.current,[p,g]=(null==i?void 0:i[r])||[void 0,void 0];yL.copy(e.ray),yL.intersectPlane(f,yO),yL.direction.negate(),yL.intersectPlane(f,yO);let v=(yR.copy(c).sub(h),yP.copy(yO).sub(h),t=u.dot(u),a=A.dot(A),o=yR.dot(u)/t,s=yR.dot(A)/a,l=yP.dot(u)/t,Math.atan2(yP.dot(A)/a,l)-Math.atan2(s,o)),x=yQ(v);e.shiftKey&&(v=(x=10*Math.round(x/10))*Math.PI/180),void 0!==p&&void 0!==g&&g-p<2*Math.PI?(v=(v=yU(v))>Math.PI?v-2*Math.PI:v,v=tw.MathUtils.clamp(v,p-E.current,g-E.current),C.current=E.current+v):(C.current=yU(E.current+v),C.current=C.current>Math.PI?C.current-2*Math.PI:C.current),n&&(x=yQ(C.current),y.current.innerText=`${x.toFixed(0)}\xba`),yz.makeRotationAxis(d,v),yk.copy(h).applyMatrix4(yz).sub(h).negate(),yz.setPosition(yk),m(yz)}},[n,m,w,i,r]),M=tC.useCallback(e=>{n&&(y.current.style.display="none"),e.stopPropagation(),E.current=C.current,B.current=null,p(),v&&(v.enabled=!0),e.target.releasePointerCapture(e.pointerId)},[n,v,p]),S=tC.useCallback(e=>{e.stopPropagation(),I(!1)},[]),T=tC.useMemo(()=>{let r=e.clone().normalize(),i=t.clone().normalize();return new tw.Matrix4().makeBasis(r,i,r.clone().cross(i))},[e,t]),D=c?.65:.65*s,F=tC.useMemo(()=>{let e=[];for(let t=0;t<=32;t++){let r=Math.PI/2*t/32;e.push(new tw.Vector3(Math.cos(r)*D,Math.sin(r)*D,0))}return e},[D]);return tC.createElement("group",{ref:x,onPointerDown:b,onPointerMove:_,onPointerUp:M,onPointerOut:S,matrix:T,matrixAutoUpdate:!1},n&&tC.createElement(tU,{position:[D,D,0]},tC.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:a,ref:y})),tC.createElement(nj,{points:F,lineWidth:4*l,visible:!1,userData:g}),tC.createElement(nj,{transparent:!0,raycast:()=>null,depthTest:o,points:F,lineWidth:l,side:tw.DoubleSide,color:w?u:h[r],opacity:d,polygonOffset:!0,polygonOffsetFactor:-10,renderOrder:A,fog:!1}))};var tI=tI;let yN=new tw.Ray,yH=new tw.Vector3,yV=new tw.Matrix4,yj=({dir1:e,dir2:t,axis:r})=>{let{translation:i,translationLimits:n,annotations:a,annotationsClass:o,depthTest:s,scale:l,lineWidth:c,fixed:h,axisColors:u,hoveredColor:A,opacity:d,renderOrder:f,onDragStart:m,onDrag:p,onDragEnd:g,userData:v}=tC.useContext(y_),y=(0,tI.C)(e=>e.controls),x=tC.useRef(null),E=tC.useRef(null),C=tC.useRef(null),B=tC.useRef(0),w=tC.useRef(0),[I,b]=tC.useState(!1),_=tC.useCallback(e=>{a&&(x.current.innerText=`${i.current[(r+1)%3].toFixed(2)}, ${i.current[(r+2)%3].toFixed(2)}`,x.current.style.display="block"),e.stopPropagation();let t=e.point.clone(),n=new tw.Vector3().setFromMatrixPosition(E.current.matrixWorld),o=new tw.Vector3().setFromMatrixColumn(E.current.matrixWorld,0).normalize(),s=new tw.Vector3().setFromMatrixColumn(E.current.matrixWorld,1).normalize(),l=new tw.Vector3().setFromMatrixColumn(E.current.matrixWorld,2).normalize();C.current={clickPoint:t,e1:o,e2:s,plane:new tw.Plane().setFromNormalAndCoplanarPoint(l,n)},B.current=i.current[(r+1)%3],w.current=i.current[(r+2)%3],m({component:"Slider",axis:r,origin:n,directions:[o,s,l]}),y&&(y.enabled=!1),e.target.setPointerCapture(e.pointerId)},[a,y,m,r]),M=tC.useCallback(e=>{if(e.stopPropagation(),I||b(!0),C.current){let t,o,s,l,c,h,u,A,d,{clickPoint:f,e1:m,e2:g,plane:v}=C.current,[y,E]=(null==n?void 0:n[(r+1)%3])||[void 0,void 0],[I,b]=(null==n?void 0:n[(r+2)%3])||[void 0,void 0];yN.copy(e.ray),yN.intersectPlane(v,yH),yN.direction.negate(),yN.intersectPlane(v,yH),yH.sub(f);let[_,M]=(t=Math.abs(m.x)>=Math.abs(m.y)&&Math.abs(m.x)>=Math.abs(m.z)?0:Math.abs(m.y)>=Math.abs(m.x)&&Math.abs(m.y)>=Math.abs(m.z)?1:2,s=t===(o=[0,1,2].sort((e,t)=>Math.abs(g.getComponent(t))-Math.abs(g.getComponent(e))))[0]?o[1]:o[0],l=m.getComponent(t),c=m.getComponent(s),h=g.getComponent(t),u=g.getComponent(s),A=yH.getComponent(t),d=(yH.getComponent(s)-c/l*A)/(u-c/l*h),[(A-d*h)/l,d]);void 0!==y&&(_=Math.max(_,y-B.current)),void 0!==E&&(_=Math.min(_,E-B.current)),void 0!==I&&(M=Math.max(M,I-w.current)),void 0!==b&&(M=Math.min(M,b-w.current)),i.current[(r+1)%3]=B.current+_,i.current[(r+2)%3]=w.current+M,a&&(x.current.innerText=`${i.current[(r+1)%3].toFixed(2)}, ${i.current[(r+2)%3].toFixed(2)}`),yV.makeTranslation(_*m.x+M*g.x,_*m.y+M*g.y,_*m.z+M*g.z),p(yV)}},[a,p,I,i,n,r]),S=tC.useCallback(e=>{a&&(x.current.style.display="none"),e.stopPropagation(),C.current=null,g(),y&&(y.enabled=!0),e.target.releasePointerCapture(e.pointerId)},[a,y,g]),T=tC.useCallback(e=>{e.stopPropagation(),b(!1)},[]),D=tC.useMemo(()=>{let r=e.clone().normalize(),i=t.clone().normalize();return new tw.Matrix4().makeBasis(r,i,r.clone().cross(i))},[e,t]),F=h?1/7:l/7,R=h?.225:.225*l,P=I?A:u[r],Q=tC.useMemo(()=>[new tw.Vector3(0,0,0),new tw.Vector3(0,R,0),new tw.Vector3(R,R,0),new tw.Vector3(R,0,0),new tw.Vector3(0,0,0)],[R]);return tC.createElement("group",{ref:E,matrix:D,matrixAutoUpdate:!1},a&&tC.createElement(tU,{position:[0,0,0]},tC.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:o,ref:x})),tC.createElement("group",{position:[1.7*F,1.7*F,0]},tC.createElement("mesh",{visible:!0,onPointerDown:_,onPointerMove:M,onPointerUp:S,onPointerOut:T,scale:R,userData:v,renderOrder:f},tC.createElement("planeGeometry",null),tC.createElement("meshBasicMaterial",{transparent:!0,depthTest:s,color:P,polygonOffset:!0,polygonOffsetFactor:-10,side:tw.DoubleSide,fog:!1})),tC.createElement(nj,{position:[-R/2,-R/2,0],transparent:!0,depthTest:s,points:Q,lineWidth:c,color:P,opacity:d,polygonOffset:!0,polygonOffsetFactor:-10,userData:v,fog:!1,renderOrder:f})))};var tI=tI;let yJ=new tw.Vector3,yY=new tw.Vector3,yW=new tw.Vector3(0,1,0),yK=new tw.Vector3,yX=new tw.Matrix4,yq=({direction:e,axis:t})=>{let{scaleLimits:r,annotations:i,annotationsClass:n,depthTest:a,scale:o,lineWidth:s,fixed:l,axisColors:c,hoveredColor:h,opacity:u,renderOrder:A,onDragStart:d,onDrag:f,onDragEnd:m,userData:p}=tC.useContext(y_),g=(0,tI.C)(e=>e.size),v=(0,tI.C)(e=>e.controls),y=tC.useRef(null),x=tC.useRef(null),E=tC.useRef(null),C=tC.useRef(1),B=tC.useRef(1),w=tC.useRef(null),[I,b]=tC.useState(!1),_=l?1.2:1.2*o,M=tC.useCallback(r=>{i&&(y.current.innerText=`${B.current.toFixed(2)}`,y.current.style.display="block"),r.stopPropagation();let n=new tw.Matrix4().extractRotation(x.current.matrixWorld),a=r.point.clone(),s=new tw.Vector3().setFromMatrixPosition(x.current.matrixWorld),c=e.clone().applyMatrix4(n).normalize(),h=x.current.matrixWorld.clone(),u=h.clone().invert();w.current={clickPoint:a,dir:c,mPLG:h,mPLGInv:u,offsetMultiplier:l?1/nm(x.current.getWorldPosition(yJ),o,r.camera,g):1},d({component:"Sphere",axis:t,origin:s,directions:[c]}),v&&(v.enabled=!1),r.target.setPointerCapture(r.pointerId)},[i,v,e,d,t,l,o,g]),S=tC.useCallback(e=>{if(e.stopPropagation(),I||b(!0),w.current){var n,a;let s,c,h,{clickPoint:u,dir:A,mPLG:d,mPLGInv:m,offsetMultiplier:p}=w.current,[g,v]=(null==r?void 0:r[t])||[1e-5,void 0],x=(n=e.ray.origin,a=e.ray.direction,s=A.dot(A),c=A.dot(u)-A.dot(n),(0===(h=A.dot(a))?-c/s:(yJ.copy(a).multiplyScalar(s/h).sub(A),yY.copy(a).multiplyScalar(c/h).add(n).sub(u),-yJ.dot(yY)/yJ.dot(yJ)))*p),I=Math.pow(2,.2*(l?x:x/o));e.shiftKey&&(I=Math.round(10*I)/10),I=Math.max(I,g/C.current),void 0!==v&&(I=Math.min(I,v/C.current)),B.current=C.current*I,E.current.position.set(0,_+x,0),i&&(y.current.innerText=`${B.current.toFixed(2)}`),yK.set(1,1,1),yK.setComponent(t,I),yX.makeScale(yK.x,yK.y,yK.z).premultiply(d).multiply(m),f(yX)}},[i,_,f,I,r,t]),T=tC.useCallback(e=>{i&&(y.current.style.display="none"),e.stopPropagation(),C.current=B.current,w.current=null,E.current.position.set(0,_,0),m(),v&&(v.enabled=!0),e.target.releasePointerCapture(e.pointerId)},[i,v,m,_]),D=tC.useCallback(e=>{e.stopPropagation(),b(!1)},[]),{radius:F,matrixL:R}=tC.useMemo(()=>{let t=l?s/o*1.8:o/22.5,r=new tw.Quaternion().setFromUnitVectors(yW,e.clone().normalize());return{radius:t,matrixL:new tw.Matrix4().makeRotationFromQuaternion(r)}},[e,o,s,l]),P=I?h:c[t];return tC.createElement("group",{ref:x},tC.createElement("group",{matrix:R,matrixAutoUpdate:!1,onPointerDown:M,onPointerMove:S,onPointerUp:T,onPointerOut:D},i&&tC.createElement(tU,{position:[0,_/2,0]},tC.createElement("div",{style:{display:"none",background:"#151520",color:"white",padding:"6px 8px",borderRadius:7,whiteSpace:"nowrap"},className:n,ref:y})),tC.createElement("mesh",{ref:E,position:[0,_,0],renderOrder:A,userData:p},tC.createElement("sphereGeometry",{args:[F,12,12]}),tC.createElement("meshBasicMaterial",{transparent:!0,depthTest:a,color:P,opacity:u,polygonOffset:!0,polygonOffsetFactor:-10}))))},yZ=new tw.Matrix4,y$=new tw.Matrix4,y1=new tw.Matrix4,y0=new tw.Matrix4,y2=new tw.Matrix4,y3=new tw.Matrix4,y4=new tw.Matrix4,y5=new tw.Matrix4,y6=new tw.Matrix4,y8=new tw.Box3,y9=new tw.Box3,y7=new tw.Vector3,xe=new tw.Vector3,xt=new tw.Vector3,xr=new tw.Vector3,xi=new tw.Vector3,xn=new tw.Vector3(1,0,0),xa=new tw.Vector3(0,1,0),xo=new tw.Vector3(0,0,1),xs=tC.forwardRef(({enabled:e=!0,matrix:t,onDragStart:r,onDrag:i,onDragEnd:n,autoTransform:a=!0,anchor:o,disableAxes:s=!1,disableSliders:l=!1,disableRotations:c=!1,disableScaling:h=!1,activeAxes:u=[!0,!0,!0],offset:A=[0,0,0],rotation:d=[0,0,0],scale:f=1,lineWidth:m=4,fixed:p=!1,translationLimits:g,rotationLimits:v,scaleLimits:y,depthTest:x=!0,renderOrder:E=500,axisColors:C=["#ff2060","#20df80","#2080ff"],hoveredColor:B="#ffff40",annotations:w=!1,annotationsClass:I,opacity:b=1,visible:_=!0,userData:M,children:S,...T},D)=>{let F=(0,tI.C)(e=>e.invalidate),R=tC.useRef(null),P=tC.useRef(null),Q=tC.useRef(null),U=tC.useRef(null),z=tC.useRef([0,0,0]),k=tC.useRef(new tw.Vector3(1,1,1)),L=tC.useRef(new tw.Vector3(1,1,1));tC.useLayoutEffect(()=>{o&&(U.current.updateWorldMatrix(!0,!0),y0.copy(U.current.matrixWorld).invert(),y8.makeEmpty(),U.current.traverse(e=>{e.geometry&&(e.geometry.boundingBox||e.geometry.computeBoundingBox(),y3.copy(e.matrixWorld).premultiply(y0),y9.copy(e.geometry.boundingBox),y9.applyMatrix4(y3),y8.union(y9))}),y7.copy(y8.max).add(y8.min).multiplyScalar(.5),xe.copy(y8.max).sub(y8.min).multiplyScalar(.5),xt.copy(xe).multiply(new tw.Vector3(...o)).add(y7),xr.set(...A).add(xt),Q.current.position.copy(xr),F())});let O=tC.useMemo(()=>({onDragStart:e=>{yZ.copy(P.current.matrix),y$.copy(P.current.matrixWorld),r&&r(e),F()},onDrag:e=>{y1.copy(R.current.matrixWorld),y0.copy(y1).invert(),y2.copy(y$).premultiply(e),y3.copy(y2).premultiply(y0),y4.copy(yZ).invert(),y5.copy(y3).multiply(y4),a&&P.current.matrix.copy(y3),i&&i(y3,y5,y2,e),F()},onDragEnd:()=>{n&&n(),F()},translation:z,translationLimits:g,rotationLimits:v,axisColors:C,hoveredColor:B,opacity:b,scale:f,lineWidth:m,fixed:p,depthTest:x,renderOrder:E,userData:M,annotations:w,annotationsClass:I}),[r,i,n,z,g,v,y,x,f,m,p,...C,B,b,M,a,w,I]),G=new tw.Vector3;return(0,tb.useFrame)(e=>{if(p){let t=nm(Q.current.getWorldPosition(G),f,e.camera,e.size);k.current.setScalar(t)}t&&t instanceof tw.Matrix4&&(P.current.matrix=t),P.current.updateWorldMatrix(!0,!0),y6.makeRotationFromEuler(Q.current.rotation).setPosition(Q.current.position).premultiply(P.current.matrixWorld),L.current.setFromMatrixScale(y6),xi.copy(k.current).divide(L.current),(Math.abs(Q.current.scale.x-xi.x)>1e-4||Math.abs(Q.current.scale.y-xi.y)>1e-4||Math.abs(Q.current.scale.z-xi.z)>1e-4)&&(Q.current.scale.copy(xi),e.invalidate())}),tC.useImperativeHandle(D,()=>P.current,[]),tC.createElement(y_.Provider,{value:O},tC.createElement("group",{ref:R},tC.createElement("group",e2({ref:P,matrix:t,matrixAutoUpdate:!1},T),tC.createElement("group",{visible:_,ref:Q,position:A,rotation:d},e&&tC.createElement(tC.Fragment,null,!s&&u[0]&&tC.createElement(yF,{axis:0,direction:xn}),!s&&u[1]&&tC.createElement(yF,{axis:1,direction:xa}),!s&&u[2]&&tC.createElement(yF,{axis:2,direction:xo}),!l&&u[0]&&u[1]&&tC.createElement(yj,{axis:2,dir1:xn,dir2:xa}),!l&&u[0]&&u[2]&&tC.createElement(yj,{axis:1,dir1:xo,dir2:xn}),!l&&u[2]&&u[1]&&tC.createElement(yj,{axis:0,dir1:xa,dir2:xo}),!c&&u[0]&&u[1]&&tC.createElement(yG,{axis:2,dir1:xn,dir2:xa}),!c&&u[0]&&u[2]&&tC.createElement(yG,{axis:1,dir1:xo,dir2:xn}),!c&&u[2]&&u[1]&&tC.createElement(yG,{axis:0,dir1:xa,dir2:xo}),!h&&u[0]&&tC.createElement(yq,{axis:0,direction:xn}),!h&&u[1]&&tC.createElement(yq,{axis:1,direction:xa}),!h&&u[2]&&tC.createElement(yq,{axis:2,direction:xo}))),tC.createElement("group",{ref:U},S))))}),xl=(0,tC.forwardRef)(({options:e={video:!0},...t},r)=>{let i=(0,or.suspend)(()=>navigator.mediaDevices.getDisplayMedia(e),[]);return(0,tC.useEffect)(()=>()=>{null==i||i.getTracks().forEach(e=>e.stop()),(0,or.clear)([])},[i]),tC.createElement(AH,e2({ref:r},t,{src:i}))}),xc=(0,tC.forwardRef)(({constraints:e={audio:!1,video:{facingMode:"user"}},...t},r)=>{let i=(0,or.suspend)(()=>navigator.mediaDevices.getUserMedia(e),[]);return(0,tC.useEffect)(()=>()=>{null==i||i.getTracks().forEach(e=>e.stop()),(0,or.clear)([])},[i]),tC.createElement(AH,e2({ref:r},t,{src:i}))});var tI=tI,tI=tI;let xh=new tw.Vector3(0,0,-1),xu=(eD=new tw.Vector3,eF=new tw.Vector3,eR=new tw.Vector3,eP=new tw.Vector3,eQ=new tw.Vector3,function(e,t,r,i){return eD.copy(e),eF.copy(t),eR.copy(r),eP.copy(eF).sub(eD),eQ.copy(eR).sub(eD),i.crossVectors(eQ,eP).normalize()}),xA=tC.forwardRef(({points:e=xm.SAMPLE_FACELANDMARKER_RESULT.faceLandmarks[0],face:t,facialTransformationMatrix:r,faceBlendshapes:i,offset:n,offsetScalar:a=80,width:o,height:s,depth:l=1,verticalTri:c=[159,386,152],origin:h,eyes:u=!0,eyesAsOrigin:A=!1,debug:d=!1,children:f,...m},p)=>{var g;t&&(e=t.keypoints,console.warn("Facemesh `face` prop is deprecated: use `points` instead"));let v=tC.useRef(null),y=tC.useRef(null),x=tC.useRef(null),E=tC.useRef(null),C=tC.useRef(null),B=tC.useRef(null),w=tC.useRef(null),[I]=tC.useState(()=>new tw.Vector3),[b]=tC.useState(()=>new tw.Object3D),[_]=tC.useState(()=>new tw.Quaternion),[M]=tC.useState(()=>new tw.Vector3),{invalidate:S}=(0,tI.C)();tC.useEffect(()=>{var e;null==(e=C.current)||e.geometry.setIndex(xm.TRIANGULATION)},[]);let[T]=tC.useState(()=>new tw.Vector3);tC.useEffect(()=>{var t,f,m,p,g,D;let F=null==(t=C.current)?void 0:t.geometry;if(!F)return;F.setFromPoints(e),F.setDrawRange(0,xm.TRIANGULATION.length),r?(b.matrix.fromArray(r.data),b.matrix.decompose(b.position,b.quaternion,b.scale),b.rotation.y*=-1,b.rotation.z*=-1,_.setFromEuler(b.rotation),n?(b.position.y*=-1,b.position.z*=-1,null==(m=v.current)||m.position.copy(b.position.divideScalar(a))):null==(p=v.current)||p.position.set(0,0,0)):(xu(e[c[0]],e[c[1]],e[c[2]],I),_.setFromUnitVectors(xh,I));let R=_.clone().invert();if(F.computeBoundingBox(),d&&S(),F.center(),F.applyQuaternion(R),null==(f=E.current)||f.setRotationFromQuaternion(_),u)if(i){if(B.current&&w.current&&x.current)if(A){let e=B.current._computeSphere(F),t=w.current._computeSphere(F);h=(g=e.center,D=t.center,g.clone().add(D).multiplyScalar(.5)).negate(),B.current._update(F,i,e),w.current._update(F,i,t)}else B.current._update(F,i),w.current._update(F,i)}else console.warn("Facemesh `eyes` option only works if `faceBlendshapes` is provided: skipping.");if(x.current){if(void 0!==h)if("number"==typeof h){let e=F.getAttribute("position");M.set(-e.getX(h),-e.getY(h),-e.getZ(h))}else h.isVector3&&M.copy(h);else M.setScalar(0);x.current.position.copy(M)}if(y.current){let e=1;(o||s||l)&&(F.boundingBox.getSize(T),o&&(e=o/T.x),s&&(e=s/T.y),l&&(e=l/T.z)),y.current.scale.setScalar(1!==e?e:1)}F.computeVertexNormals(),F.attributes.position.needsUpdate=!0},[e,r,i,b,n,a,o,s,l,c,h,u,d,S,I,_,T,M]);let D=tC.useMemo(()=>({outerRef:E,meshRef:C,eyeRightRef:B,eyeLeftRef:w}),[]);tC.useImperativeHandle(p,()=>D,[D]);let[F]=tC.useState(()=>new tw.Vector3),R=null==(g=C.current)?void 0:g.geometry.boundingBox,P=(null==R?void 0:R.getSize(F).z)||1;return tC.createElement("group",m,tC.createElement("group",{ref:v},tC.createElement("group",{ref:E},tC.createElement("group",{ref:y},d?tC.createElement(tC.Fragment,null,tC.createElement("axesHelper",{args:[P]}),tC.createElement(nj,{points:[[0,0,0],[0,0,-P]],color:65535})):null,tC.createElement("group",{ref:x},u&&i&&tC.createElement("group",{name:"eyes"},tC.createElement(xf,{side:"left",ref:B,debug:d}),tC.createElement(xf,{side:"right",ref:w,debug:d})),tC.createElement("mesh",{ref:C,name:"face"},f,d?tC.createElement(tC.Fragment,null,R&&tC.createElement("box3Helper",{args:[R]})):null))))))}),xd={contourLandmarks:{right:[33,133,159,145,153],left:[263,362,386,374,380]},blendshapes:{right:[14,16,18,12],left:[13,15,17,11]},color:{right:"red",left:"#00ff00"},fov:{horizontal:100,vertical:90}},xf=tC.forwardRef(({side:e,debug:t=!0},r)=>{let i=tC.useRef(null),n=tC.useRef(null),[a]=tC.useState(()=>new tw.Sphere),o=tC.useCallback(t=>{let r=t.getAttribute("position"),i=xd.contourLandmarks[e].map(e=>new tw.Vector3(r.getX(e),r.getY(e),r.getZ(e)));return a.center.set(0,0,0),i.forEach(e=>a.center.add(e)),a.center.divideScalar(i.length),a.radius=i[0].sub(i[1]).length()/2,a},[a,e]),[s]=tC.useState(()=>new tw.Euler),l=tC.useCallback((t,r,a)=>{i.current&&(null!=a||(a=o(t)),i.current.position.copy(a.center),i.current.scale.setScalar(a.radius));if(r&&n.current){let t=xd.blendshapes[e],i=r.categories[t[0]].score,a=r.categories[t[1]].score,o=r.categories[t[2]].score,l=r.categories[t[3]].score,c=xd.fov.horizontal*tw.MathUtils.DEG2RAD,h=.5*(xd.fov.vertical*tw.MathUtils.DEG2RAD)*(i-a)*("left"===e?1:-1);s.set(.5*c*(l-o),h,0),n.current.setRotationFromEuler(s)}},[o,e,s]),c=tC.useMemo(()=>({eyeMeshRef:i,irisDirRef:n,_computeSphere:o,_update:l}),[o,l]);tC.useImperativeHandle(r,()=>c,[c]);let h=xd.color[e];return tC.createElement("group",null,tC.createElement("group",{ref:i},t&&tC.createElement("axesHelper",null),tC.createElement("group",{ref:n},tC.createElement(tC.Fragment,null,t&&tC.createElement(nj,{points:[[0,0,0],[0,0,-2]],lineWidth:1,color:h})))))}),xm={TRIANGULATION:[127,34,139,11,0,37,232,231,120,72,37,39,128,121,47,232,121,128,104,69,67,175,171,148,157,154,155,118,50,101,73,39,40,9,151,108,48,115,131,194,204,211,74,40,185,80,42,183,40,92,186,230,229,118,202,212,214,83,18,17,76,61,146,160,29,30,56,157,173,106,204,194,135,214,192,203,165,98,21,71,68,51,45,4,144,24,23,77,146,91,205,50,187,201,200,18,91,106,182,90,91,181,85,84,17,206,203,36,148,171,140,92,40,39,193,189,244,159,158,28,247,246,161,236,3,196,54,68,104,193,168,8,117,228,31,189,193,55,98,97,99,126,47,100,166,79,218,155,154,26,209,49,131,135,136,150,47,126,217,223,52,53,45,51,134,211,170,140,67,69,108,43,106,91,230,119,120,226,130,247,63,53,52,238,20,242,46,70,156,78,62,96,46,53,63,143,34,227,173,155,133,123,117,111,44,125,19,236,134,51,216,206,205,154,153,22,39,37,167,200,201,208,36,142,100,57,212,202,20,60,99,28,158,157,35,226,113,160,159,27,204,202,210,113,225,46,43,202,204,62,76,77,137,123,116,41,38,72,203,129,142,64,98,240,49,102,64,41,73,74,212,216,207,42,74,184,169,170,211,170,149,176,105,66,69,122,6,168,123,147,187,96,77,90,65,55,107,89,90,180,101,100,120,63,105,104,93,137,227,15,86,85,129,102,49,14,87,86,55,8,9,100,47,121,145,23,22,88,89,179,6,122,196,88,95,96,138,172,136,215,58,172,115,48,219,42,80,81,195,3,51,43,146,61,171,175,199,81,82,38,53,46,225,144,163,110,246,33,7,52,65,66,229,228,117,34,127,234,107,108,69,109,108,151,48,64,235,62,78,191,129,209,126,111,35,143,163,161,246,117,123,50,222,65,52,19,125,141,221,55,65,3,195,197,25,7,33,220,237,44,70,71,139,122,193,245,247,130,33,71,21,162,153,158,159,170,169,150,188,174,196,216,186,92,144,160,161,2,97,167,141,125,241,164,167,37,72,38,12,145,159,160,38,82,13,63,68,71,226,35,111,158,153,154,101,50,205,206,92,165,209,198,217,165,167,97,220,115,218,133,112,243,239,238,241,214,135,169,190,173,133,171,208,32,125,44,237,86,87,178,85,86,179,84,85,180,83,84,181,201,83,182,137,93,132,76,62,183,61,76,184,57,61,185,212,57,186,214,207,187,34,143,156,79,239,237,123,137,177,44,1,4,201,194,32,64,102,129,213,215,138,59,166,219,242,99,97,2,94,141,75,59,235,24,110,228,25,130,226,23,24,229,22,23,230,26,22,231,112,26,232,189,190,243,221,56,190,28,56,221,27,28,222,29,27,223,30,29,224,247,30,225,238,79,20,166,59,75,60,75,240,147,177,215,20,79,166,187,147,213,112,233,244,233,128,245,128,114,188,114,217,174,131,115,220,217,198,236,198,131,134,177,132,58,143,35,124,110,163,7,228,110,25,356,389,368,11,302,267,452,350,349,302,303,269,357,343,277,452,453,357,333,332,297,175,152,377,384,398,382,347,348,330,303,304,270,9,336,337,278,279,360,418,262,431,304,408,409,310,415,407,270,409,410,450,348,347,422,430,434,313,314,17,306,307,375,387,388,260,286,414,398,335,406,418,364,367,416,423,358,327,251,284,298,281,5,4,373,374,253,307,320,321,425,427,411,421,313,18,321,405,406,320,404,405,315,16,17,426,425,266,377,400,369,322,391,269,417,465,464,386,257,258,466,260,388,456,399,419,284,332,333,417,285,8,346,340,261,413,441,285,327,460,328,355,371,329,392,439,438,382,341,256,429,420,360,364,394,379,277,343,437,443,444,283,275,440,363,431,262,369,297,338,337,273,375,321,450,451,349,446,342,467,293,334,282,458,461,462,276,353,383,308,324,325,276,300,293,372,345,447,382,398,362,352,345,340,274,1,19,456,248,281,436,427,425,381,256,252,269,391,393,200,199,428,266,330,329,287,273,422,250,462,328,258,286,384,265,353,342,387,259,257,424,431,430,342,353,276,273,335,424,292,325,307,366,447,345,271,303,302,423,266,371,294,455,460,279,278,294,271,272,304,432,434,427,272,407,408,394,430,431,395,369,400,334,333,299,351,417,168,352,280,411,325,319,320,295,296,336,319,403,404,330,348,349,293,298,333,323,454,447,15,16,315,358,429,279,14,15,316,285,336,9,329,349,350,374,380,252,318,402,403,6,197,419,318,319,325,367,364,365,435,367,397,344,438,439,272,271,311,195,5,281,273,287,291,396,428,199,311,271,268,283,444,445,373,254,339,263,466,249,282,334,296,449,347,346,264,447,454,336,296,299,338,10,151,278,439,455,292,407,415,358,371,355,340,345,372,390,249,466,346,347,280,442,443,282,19,94,370,441,442,295,248,419,197,263,255,359,440,275,274,300,383,368,351,412,465,263,467,466,301,368,389,380,374,386,395,378,379,412,351,419,436,426,322,373,390,388,2,164,393,370,462,461,164,0,267,302,11,12,374,373,387,268,12,13,293,300,301,446,261,340,385,384,381,330,266,425,426,423,391,429,355,437,391,327,326,440,457,438,341,382,362,459,457,461,434,430,394,414,463,362,396,369,262,354,461,457,316,403,402,315,404,403,314,405,404,313,406,405,421,418,406,366,401,361,306,408,407,291,409,408,287,410,409,432,436,410,434,416,411,264,368,383,309,438,457,352,376,401,274,275,4,421,428,262,294,327,358,433,416,367,289,455,439,462,370,326,2,326,370,305,460,455,254,449,448,255,261,446,253,450,449,252,451,450,256,452,451,341,453,452,413,464,463,441,413,414,258,442,441,257,443,442,259,444,443,260,445,444,467,342,445,459,458,250,289,392,290,290,328,460,376,433,435,250,290,392,411,416,433,341,463,464,453,464,465,357,465,412,343,412,399,360,363,440,437,399,456,420,456,363,401,435,288,372,383,353,339,255,249,448,261,255,133,243,190,133,155,112,33,246,247,33,130,25,398,384,286,362,398,414,362,463,341,263,359,467,263,249,255,466,467,260,75,60,166,238,239,79,162,127,139,72,11,37,121,232,120,73,72,39,114,128,47,233,232,128,103,104,67,152,175,148,173,157,155,119,118,101,74,73,40,107,9,108,49,48,131,32,194,211,184,74,185,191,80,183,185,40,186,119,230,118,210,202,214,84,83,17,77,76,146,161,160,30,190,56,173,182,106,194,138,135,192,129,203,98,54,21,68,5,51,4,145,144,23,90,77,91,207,205,187,83,201,18,181,91,182,180,90,181,16,85,17,205,206,36,176,148,140,165,92,39,245,193,244,27,159,28,30,247,161,174,236,196,103,54,104,55,193,8,111,117,31,221,189,55,240,98,99,142,126,100,219,166,218,112,155,26,198,209,131,169,135,150,114,47,217,224,223,53,220,45,134,32,211,140,109,67,108,146,43,91,231,230,120,113,226,247,105,63,52,241,238,242,124,46,156,95,78,96,70,46,63,116,143,227,116,123,111,1,44,19,3,236,51,207,216,205,26,154,22,165,39,167,199,200,208,101,36,100,43,57,202,242,20,99,56,28,157,124,35,113,29,160,27,211,204,210,124,113,46,106,43,204,96,62,77,227,137,116,73,41,72,36,203,142,235,64,240,48,49,64,42,41,74,214,212,207,183,42,184,210,169,211,140,170,176,104,105,69,193,122,168,50,123,187,89,96,90,66,65,107,179,89,180,119,101,120,68,63,104,234,93,227,16,15,85,209,129,49,15,14,86,107,55,9,120,100,121,153,145,22,178,88,179,197,6,196,89,88,96,135,138,136,138,215,172,218,115,219,41,42,81,5,195,51,57,43,61,208,171,199,41,81,38,224,53,225,24,144,110,105,52,66,118,229,117,227,34,234,66,107,69,10,109,151,219,48,235,183,62,191,142,129,126,116,111,143,7,163,246,118,117,50,223,222,52,94,19,141,222,221,65,196,3,197,45,220,44,156,70,139,188,122,245,139,71,162,145,153,159,149,170,150,122,188,196,206,216,92,163,144,161,164,2,167,242,141,241,0,164,37,11,72,12,144,145,160,12,38,13,70,63,71,31,226,111,157,158,154,36,101,205,203,206,165,126,209,217,98,165,97,237,220,218,237,239,241,210,214,169,140,171,32,241,125,237,179,86,178,180,85,179,181,84,180,182,83,181,194,201,182,177,137,132,184,76,183,185,61,184,186,57,185,216,212,186,192,214,187,139,34,156,218,79,237,147,123,177,45,44,4,208,201,32,98,64,129,192,213,138,235,59,219,141,242,97,97,2,141,240,75,235,229,24,228,31,25,226,230,23,229,231,22,230,232,26,231,233,112,232,244,189,243,189,221,190,222,28,221,223,27,222,224,29,223,225,30,224,113,247,225,99,60,240,213,147,215,60,20,166,192,187,213,243,112,244,244,233,245,245,128,188,188,114,174,134,131,220,174,217,236,236,198,134,215,177,58,156,143,124,25,110,7,31,228,25,264,356,368,0,11,267,451,452,349,267,302,269,350,357,277,350,452,357,299,333,297,396,175,377,381,384,382,280,347,330,269,303,270,151,9,337,344,278,360,424,418,431,270,304,409,272,310,407,322,270,410,449,450,347,432,422,434,18,313,17,291,306,375,259,387,260,424,335,418,434,364,416,391,423,327,301,251,298,275,281,4,254,373,253,375,307,321,280,425,411,200,421,18,335,321,406,321,320,405,314,315,17,423,426,266,396,377,369,270,322,269,413,417,464,385,386,258,248,456,419,298,284,333,168,417,8,448,346,261,417,413,285,326,327,328,277,355,329,309,392,438,381,382,256,279,429,360,365,364,379,355,277,437,282,443,283,281,275,363,395,431,369,299,297,337,335,273,321,348,450,349,359,446,467,283,293,282,250,458,462,300,276,383,292,308,325,283,276,293,264,372,447,346,352,340,354,274,19,363,456,281,426,436,425,380,381,252,267,269,393,421,200,428,371,266,329,432,287,422,290,250,328,385,258,384,446,265,342,386,387,257,422,424,430,445,342,276,422,273,424,306,292,307,352,366,345,268,271,302,358,423,371,327,294,460,331,279,294,303,271,304,436,432,427,304,272,408,395,394,431,378,395,400,296,334,299,6,351,168,376,352,411,307,325,320,285,295,336,320,319,404,329,330,349,334,293,333,366,323,447,316,15,315,331,358,279,317,14,316,8,285,9,277,329,350,253,374,252,319,318,403,351,6,419,324,318,325,397,367,365,288,435,397,278,344,439,310,272,311,248,195,281,375,273,291,175,396,199,312,311,268,276,283,445,390,373,339,295,282,296,448,449,346,356,264,454,337,336,299,337,338,151,294,278,455,308,292,415,429,358,355,265,340,372,388,390,466,352,346,280,295,442,282,354,19,370,285,441,295,195,248,197,457,440,274,301,300,368,417,351,465,251,301,389,385,380,386,394,395,379,399,412,419,410,436,322,387,373,388,326,2,393,354,370,461,393,164,267,268,302,12,386,374,387,312,268,13,298,293,301,265,446,340,380,385,381,280,330,425,322,426,391,420,429,437,393,391,326,344,440,438,458,459,461,364,434,394,428,396,262,274,354,457,317,316,402,316,315,403,315,314,404,314,313,405,313,421,406,323,366,361,292,306,407,306,291,408,291,287,409,287,432,410,427,434,411,372,264,383,459,309,457,366,352,401,1,274,4,418,421,262,331,294,358,435,433,367,392,289,439,328,462,326,94,2,370,289,305,455,339,254,448,359,255,446,254,253,449,253,252,450,252,256,451,256,341,452,414,413,463,286,441,414,286,258,441,258,257,442,257,259,443,259,260,444,260,467,445,309,459,250,305,289,290,305,290,460,401,376,435,309,250,392,376,411,433,453,341,464,357,453,465,343,357,412,437,343,399,344,360,440,420,437,456,360,420,363,361,401,288,265,372,353,390,339,249,339,448,255],SAMPLE_FACE:{keypoints:[{x:356.2804412841797,y:295.1960563659668,z:-23.786449432373047,name:"lips"},{x:354.8859405517578,y:264.69520568847656,z:-36.718435287475586},{x:355.2180862426758,y:275.3360366821289,z:-21.183712482452393},{x:347.349853515625,y:242.4400234222412,z:-25.093655586242676},{x:354.40135955810547,y:256.67933464050293,z:-38.23572635650635},{x:353.7689971923828,y:247.54886627197266,z:-34.5475435256958},{x:352.1288299560547,y:227.34312057495117,z:-13.095386028289795},{x:303.5013198852539,y:234.67002868652344,z:12.500141859054565,name:"rightEye"},{x:351.09378814697266,y:211.87547206878662,z:-6.413471698760986},{x:350.7115936279297,y:202.1251630783081,z:-6.413471698760986},{x:348.33667755126953,y:168.7741756439209,z:6.483500003814697,name:"faceOval"},{x:356.4806365966797,y:299.2995357513428,z:-23.144519329071045},{x:356.5511703491211,y:302.66146659851074,z:-21.020312309265137},{x:356.6239547729492,y:304.1536331176758,z:-18.137459754943848,name:"lips"},{x:356.5807342529297,y:305.1840591430664,z:-18.767719268798828,name:"lips"},{x:356.8241500854492,y:308.25711250305176,z:-20.16829490661621},{x:357.113037109375,y:312.26277351379395,z:-22.10575819015503},{x:357.34962463378906,y:317.1123218536377,z:-21.837315559387207,name:"lips"},{x:357.6658630371094,y:325.51036834716797,z:-16.27002477645874},{x:355.0201416015625,y:269.36279296875,z:-33.73054027557373},{x:348.5237503051758,y:270.33411026000977,z:-24.93025302886963},{x:279.97331619262695,y:213.24176788330078,z:47.759642601013184,name:"faceOval"},{x:322.66529083251953,y:238.5027265548706,z:5.535193085670471},{x:316.0983657836914,y:239.94489669799805,z:5.777376294136047},{x:309.9431610107422,y:240.24518966674805,z:7.510589361190796},{x:301.31994247436523,y:237.86138534545898,z:13.118728399276733},{x:328.14266204833984,y:235.80496788024902,z:6.646900177001953},{x:313.7326431274414,y:222.11161136627197,z:3.9887237548828125},{x:320.45196533203125,y:221.87729358673096,z:4.601476192474365},{x:307.35679626464844,y:223.63793849945068,z:5.932023525238037},{x:303.0031204223633,y:226.3743782043457,z:8.479321002960205},{x:296.80023193359375,y:242.94299125671387,z:15.931552648544312},{x:332.2352981567383,y:340.77341079711914,z:-10.165848731994629},{x:301.38587951660156,y:233.46447944641113,z:14.764405488967896,name:"rightEye"},{x:279.0147018432617,y:244.37155723571777,z:45.77549457550049},{x:289.60548400878906,y:239.1807460784912,z:23.191204071044922},{x:320.32257080078125,y:267.1292781829834,z:-4.954537749290466},{x:347.64583587646484,y:294.4955062866211,z:-23.062820434570313,name:"lips"},{x:349.28138732910156,y:303.1095886230469,z:-20.238323211669922},{x:338.9453125,y:298.19186210632324,z:-19.456336498260498,name:"lips"},{x:333.36788177490234,y:302.6706790924072,z:-14.776077270507813,name:"lips"},{x:342.89188385009766,y:304.3561363220215,z:-17.752301692962646},{x:337.7375030517578,y:306.0098361968994,z:-13.410515785217285},{x:325.6159210205078,y:316.22995376586914,z:-6.681914925575256},{x:349.0104675292969,y:264.9818515777588,z:-36.274919509887695},{x:347.7138900756836,y:257.5664806365967,z:-37.67549514770508},{x:291.79357528686523,y:218.88171672821045,z:11.578094959259033,name:"rightEyebrow"},{x:332.2689437866211,y:247.56946563720703,z:-3.3730539679527283},{x:332.0074462890625,y:267.1201229095459,z:-19.969879388809204},{x:331.27952575683594,y:263.6967658996582,z:-17.47218608856201},{x:301.04373931884766,y:269.56552505493164,z:3.61815482378006},{x:347.4863815307617,y:249.0706443786621,z:-32.633421421051025},{x:307.26118087768555,y:208.2646894454956,z:1.1591226607561111,name:"rightEyebrow"},{x:297.91919708251953,y:212.22604751586914,z:5.914516448974609,name:"rightEyebrow"},{x:285.1651382446289,y:197.98450469970703,z:36.391637325286865,name:"faceOval"},{x:337.04097747802734,y:211.25229835510254,z:-4.548954665660858},{x:326.5912628173828,y:223.16698551177979,z:6.670243740081787},{x:320.05664825439453,y:309.5834255218506,z:-4.055835008621216},{x:289.6866226196289,y:314.617395401001,z:53.875489234924316,name:"faceOval"},{x:337.4256896972656,y:270.8755302429199,z:-17.67060160636902},{x:343.69922637939453,y:273.0000400543213,z:-18.756048679351807},{x:327.4242401123047,y:309.22399520874023,z:-4.703601002693176,name:"lips"},{x:330.37220001220703,y:308.3323001861572,z:-6.442649960517883},{x:293.87027740478516,y:207.7961826324463,z:9.821539521217346,name:"rightEyebrow"},{x:332.11437225341797,y:271.22812271118164,z:-16.64351224899292},{x:320.1197814941406,y:207.40366458892822,z:-2.48164564371109,name:"rightEyebrow"},{x:318.59575271606445,y:201.07443809509277,z:-3.110446035861969,name:"rightEyebrow"},{x:310.72303771972656,y:175.75075149536133,z:13.328815698623657,name:"faceOval"},{x:289.67578887939453,y:202.29835510253906,z:21.370456218719482},{x:315.30879974365234,y:187.35260009765625,z:5.0304025411605835},{x:287.8936767578125,y:216.54793739318848,z:17.81065821647644,name:"rightEyebrow"},{x:283.9391899108887,y:215.01142501831055,z:32.04984903335571},{x:348.35330963134766,y:299.4155788421631,z:-22.47924566268921},{x:341.1790466308594,y:301.8221855163574,z:-18.977805376052856},{x:335.69713592529297,y:304.4266891479492,z:-14.682706594467163},{x:339.4615173339844,y:272.3654365539551,z:-16.38674020767212},{x:328.99600982666016,y:308.86685371398926,z:-5.616893768310547},{x:332.00313568115234,y:309.1875743865967,z:-10.335084199905396},{x:331.0068130493164,y:307.9274368286133,z:-6.681914925575256,name:"lips"},{x:341.13792419433594,y:266.4876937866211,z:-26.56425952911377},{x:339.02950286865234,y:305.6663703918457,z:-12.33674168586731,name:"lips"},{x:344.22935485839844,y:304.9452781677246,z:-15.161235332489014,name:"lips"},{x:350.1844024658203,y:304.374303817749,z:-17.5305438041687,name:"lips"},{x:348.52630615234375,y:325.9562301635742,z:-16.164982318878174},{x:348.6581802368164,y:317.1624183654785,z:-21.510512828826904,name:"lips"},{x:348.9766311645508,y:312.1923065185547,z:-21.708929538726807},{x:349.2427444458008,y:308.0660820007324,z:-19.643079042434692},{x:349.67491149902344,y:305.42747497558594,z:-18.16080331802368,name:"lips"},{x:337.95589447021484,y:306.6535949707031,z:-12.803598642349243,name:"lips"},{x:337.06878662109375,y:307.63169288635254,z:-14.274203777313232},{x:335.77449798583984,y:309.8449516296387,z:-15.698124170303345},{x:334.6099090576172,y:312.7997016906738,z:-14.764405488967896,name:"lips"},{x:327.2330856323242,y:293.80866050720215,z:-11.864047050476074},{x:280.97679138183594,y:279.79928970336914,z:68.90834331512451,name:"faceOval"},{x:355.13843536376953,y:271.7875671386719,z:-25.350427627563477},{x:334.7235870361328,y:307.4656391143799,z:-9.302158951759338,name:"lips"},{x:333.5293960571289,y:307.89782524108887,z:-10.200862884521484},{x:346.29688262939453,y:276.4256286621094,z:-19.748122692108154},{x:335.16246795654297,y:276.22097969055176,z:-12.313398122787476},{x:345.09132385253906,y:274.7082996368408,z:-19.304605722427368},{x:325.4267883300781,y:252.95130729675293,z:-1.6661019623279572},{x:315.347843170166,y:259.05200958251953,z:-.25604281574487686},{x:330.44933319091797,y:267.7570152282715,z:-14.017432928085327},{x:294.96768951416016,y:185.26001930236816,z:23.903164863586426,name:"faceOval"},{x:299.63531494140625,y:192.7913761138916,z:12.640198469161987},{x:304.5452117919922,y:202.4142837524414,z:3.244667649269104,name:"rightEyebrow"},{x:331.6915512084961,y:320.0467872619629,z:-10.632705688476563},{x:334.5911407470703,y:201.27566814422607,z:-6.133356094360352,name:"rightEyebrow"},{x:331.4815902709961,y:185.44180870056152,z:.6627205014228821},{x:328.05816650390625,y:170.8385467529297,z:7.358860373497009,name:"faceOval"},{x:304.49764251708984,y:239.76297855377197,z:10.387605428695679},{x:290.6382179260254,y:248.85257720947266,z:19.03616428375244},{x:331.5682601928711,y:233.20727348327637,z:7.837390303611755},{x:295.5115509033203,y:228.9834451675415,z:14.41426157951355},{x:336.94332122802734,y:241.8259334564209,z:-5.27842104434967},{x:336.2792205810547,y:262.7049922943115,z:-26.12074375152588},{x:284.4102478027344,y:255.3262710571289,z:25.467140674591064},{x:295.1420593261719,y:253.02655220031738,z:12.430112361907959},{x:303.5196113586426,y:254.20703887939453,z:6.139191389083862},{x:315.73450088500977,y:251.64799690246582,z:3.3788898587226868},{x:324.69661712646484,y:247.56494522094727,z:2.3328344523906708},{x:331.57970428466797,y:243.02241325378418,z:1.1423448473215103},{x:345.6210708618164,y:229.9976634979248,z:-10.825285911560059},{x:286.26644134521484,y:270.37991523742676,z:21.708929538726807},{x:290.2525520324707,y:228.4921360015869,z:17.71728754043579},{x:351.65367126464844,y:269.3400764465332,z:-33.450424671173096},{x:333.1378936767578,y:253.88388633728027,z:-7.230473756790161},{x:277.8318977355957,y:246.95331573486328,z:68.20805549621582,name:"faceOval"},{x:336.6680908203125,y:238.10003757476807,z:.7688578963279724},{x:329.95800018310547,y:269.18323516845703,z:-7.207130789756775},{x:299.17491912841797,y:234.13324356079102,z:15.95489501953125},{x:335.61729431152344,y:258.71752738952637,z:-23.016133308410645},{x:284.1079330444336,y:297.0343494415283,z:63.25934886932373,name:"faceOval"},{x:331.44542694091797,y:230.6892442703247,z:9.92658257484436,name:"rightEye"},{x:341.41536712646484,y:253.01264762878418,z:-29.038610458374023},{x:303.5472869873047,y:327.5896739959717,z:16.725212335586548},{x:304.7756576538086,y:337.4389457702637,z:27.38126277923584,name:"faceOval"},{x:280.80501556396484,y:275.32050132751465,z:45.0752067565918},{x:295.43582916259766,y:318.4501647949219,z:26.2608003616333},{x:281.4303207397461,y:228.7355661392212,z:40.94350814819336},{x:331.2549591064453,y:349.4216537475586,z:-7.376367449760437},{x:352.4247741699219,y:271.7330074310303,z:-24.953596591949463},{x:327.5672912597656,y:260.41900634765625,z:-5.456410646438599},{x:284.5432472229004,y:241.7647933959961,z:29.668869972229004},{x:310,y:235.66174507141113,z:8.502663969993591,name:"rightEye"},{x:315.7071113586426,y:235.7572603225708,z:6.938687562942505,name:"rightEye"},{x:330.41088104248047,y:311.04143142700195,z:-9.325502514839172,name:"lips"},{x:288.5377502441406,y:285.31983375549316,z:21.837315559387207},{x:344.55039978027344,y:359.4300842285156,z:-6.705257892608643,name:"faceOval"},{x:323.41880798339844,y:351.67362213134766,z:7.802375555038452,name:"faceOval"},{x:314.64088439941406,y:346.11894607543945,z:16.36339783668518,name:"faceOval"},{x:349.4945526123047,y:184.8434829711914,z:-.21847527474164963},{x:359.24694061279297,y:359.8348903656006,z:-8.403456211090088,name:"faceOval"},{x:321.26182556152344,y:234.64492321014404,z:6.90950870513916,name:"rightEye"},{x:326.318359375,y:232.90250301361084,z:8.029969334602356,name:"rightEye"},{x:329.6211624145508,y:231.6195774078369,z:9.722331762313843,name:"rightEye"},{x:285.9398078918457,y:228.2351303100586,z:24.650139808654785},{x:325.79288482666016,y:227.88007736206055,z:7.469738721847534,name:"rightEye"},{x:320.1699447631836,y:227.5934886932373,z:6.168370842933655,name:"rightEye"},{x:314.85408782958984,y:227.85282611846924,z:6.2675780057907104,name:"rightEye"},{x:309.3084907531738,y:229.1516876220703,z:7.7031683921813965,name:"rightEye"},{x:305.5621337890625,y:230.92366218566895,z:9.722331762313843,name:"rightEye"},{x:277.8681945800781,y:228.5354232788086,z:59.71122741699219,name:"faceOval"},{x:306.1444664001465,y:235.1954698562622,z:10.603528022766113,name:"rightEye"},{x:355.4478454589844,y:281.96210861206055,z:-20.565123558044434},{x:333.02661895751953,y:288.0105400085449,z:-14.72939133644104},{x:337.15728759765625,y:269.2059516906738,z:-19.8414945602417},{x:345.9898376464844,y:283.5453128814697,z:-20.4834246635437},{x:351.48963928222656,y:219.98916149139404,z:-7.0378947257995605},{x:312.39574432373047,y:336.50628089904785,z:8.671900033950806},{x:321.32152557373047,y:343.1755256652832,z:.9067271649837494},{x:343.78379821777344,y:353.2975959777832,z:-14.355905055999756},{x:296.8791389465332,y:327.91497230529785,z:41.01353645324707,name:"faceOval"},{x:329.6939468383789,y:229.27897453308105,z:8.934508562088013,name:"rightEye"},{x:341.6905212402344,y:241.4073657989502,z:-14.589333534240723},{x:359.03079986572266,y:353.48859786987305,z:-15.803166627883911},{x:333.1861877441406,y:356.43213272094727,z:-1.0234417766332626,name:"faceOval"},{x:283.97483825683594,y:291.4318656921387,z:41.94725513458252},{x:343.33770751953125,y:305.830135345459,z:-15.756480693817139,name:"lips"},{x:342.40283966064453,y:307.7453899383545,z:-17.4021577835083},{x:341.53621673583984,y:311.0595703125,z:-19.047834873199463},{x:340.9107208251953,y:315.4837703704834,z:-18.5576331615448,name:"lips"},{x:339.1478729248047,y:323.42233657836914,z:-14.367576837539673},{x:333.3201599121094,y:307.4406337738037,z:-9.617288708686829},{x:331.2411117553711,y:306.9811820983887,z:-9.669809937477112},{x:329.23255920410156,y:306.0508346557617,z:-9.582273960113525,name:"lips"},{x:322.4586486816406,y:301.33323669433594,z:-7.720675468444824},{x:297.1712112426758,y:286.9552803039551,z:8.240055441856384},{x:341.3060760498047,y:235.4432201385498,z:-7.504753470420837},{x:336.9318389892578,y:224.3451976776123,z:5.829898118972778},{x:332.65323638916016,y:226.70403957366943,z:8.105834126472473},{x:334.67357635498047,y:306.4397621154785,z:-8.981193900108337,name:"lips"},{x:297.4601936340332,y:306.29210472106934,z:15.476365089416504},{x:342.9119110107422,y:222.37077713012695,z:-2.754466235637665},{x:335.4629898071289,y:332.20250129699707,z:-11.823196411132813},{x:353.2412338256836,y:240.56339263916016,z:-27.147831916809082},{x:346.3080596923828,y:236.41446590423584,z:-18.452589511871338},{x:352.6475143432617,y:234.1420555114746,z:-19.748122692108154},{x:337.3209762573242,y:253.39937210083008,z:-16.024924516677856},{x:358.6122131347656,y:344.90861892700195,z:-18.592647314071655},{x:358.1117248535156,y:334.64990615844727,z:-17.49552845954895},{x:346.4450454711914,y:335.0321102142334,z:-16.32838249206543},{x:319.17640686035156,y:320.2833938598633,z:-3.276764452457428},{x:325.2540588378906,y:276.2369728088379,z:-6.460157036781311},{x:326.7214584350586,y:327.3939514160156,z:-7.417217493057251},{x:310.7190132141113,y:277.2265148162842,z:-3.5452082753181458},{x:319.78355407714844,y:284.8238182067871,z:-6.4543211460113525},{x:305.773983001709,y:290.83580017089844,z:.06907138042151928},{x:344.4001770019531,y:344.85408782958984,z:-16.946970224380493},{x:333.1879425048828,y:258.74256134033203,z:-11.90489649772644},{x:313.80598068237305,y:327.08919525146484,z:2.2277912497520447},{x:322.9637908935547,y:334.6819496154785,z:-3.3643004298210144},{x:313.4055519104004,y:311.2166690826416,z:-1.1175429821014404},{x:291.0865783691406,y:298.2831001281738,z:22.467575073242188},{x:305.6580924987793,y:313.3707904815674,z:5.561453700065613},{x:288.23760986328125,y:305.9941864013672,z:36.765122413635254},{x:315.10692596435547,y:296.26991271972656,z:-4.604393839836121},{x:337.50518798828125,y:247.5944423675537,z:-10.597691535949707},{x:338.8450622558594,y:265.47778129577637,z:-27.778091430664063},{x:334.25254821777344,y:269.0671920776367,z:-20.938611030578613},{x:341.64512634277344,y:259.6387195587158,z:-32.189905643463135},{x:331.44081115722656,y:219.0976095199585,z:4.207563698291779},{x:320.56339263916016,y:216.49658203125,z:2.930997312068939},{x:311.21912002563477,y:216.57853603363037,z:2.9674705862998962},{x:303.46256256103516,y:218.54614734649658,z:5.357203483581543},{x:297.99999237060547,y:222.505202293396,z:9.325502514839172},{x:294.93839263916016,y:236.39654159545898,z:18.534289598464966},{x:278.87489318847656,y:259.7095584869385,z:45.68212032318115},{x:300.3782653808594,y:245.38593292236328,z:12.278382778167725},{x:307.06348419189453,y:246.36857986450195,z:8.164191246032715},{x:315.5229187011719,y:245.3949737548828,z:5.503097176551819},{x:323.71395111083984,y:242.75178909301758,z:4.6335723996162415},{x:330.2785873413086,y:239.34658527374268,z:4.937030673027039},{x:334.6982192993164,y:236.0460376739502,z:4.823233783245087},{x:279.3412208557129,y:263.5196113586426,z:70.91583728790283,name:"faceOval"},{x:334.65972900390625,y:271.6648578643799,z:-17.775644063949585},{x:342.05677032470703,y:246.99846267700195,z:-20.84523916244507},{x:344.0357971191406,y:264.5701503753662,z:-32.936880588531494},{x:348.25531005859375,y:268.6645030975342,z:-30.695960521697998},{x:344.12227630615234,y:266.34212493896484,z:-29.808926582336426},{x:337.12318420410156,y:274.2556858062744,z:-15.768152475357056},{x:349.49047088623047,y:269.071683883667,z:-32.51670837402344},{x:350.1683044433594,y:271.4691352844238,z:-24.93025302886963},{x:333.9634704589844,y:230.56639194488525,z:8.89949381351471},{x:338.2147979736328,y:231.4807891845703,z:4.6715047955513},{x:340.4712677001953,y:231.74463272094727,z:-.34996166825294495},{x:303.28975677490234,y:232.24980354309082,z:11.916568279266357,name:"rightEye"},{x:299.4649124145508,y:229.53842639923096,z:12.325069904327393},{x:359.09618377685547,y:241.77349090576172,z:-24.650139808654785},{x:399.46216583251953,y:229.89503860473633,z:15.919880867004395,name:"leftEye"},{x:361.38919830322266,y:269.6129894256592,z:-24.510080814361572},{x:416.9973373413086,y:206.0895538330078,z:53.26857566833496,name:"faceOval"},{x:381.32179260253906,y:235.5476474761963,z:7.6214683055877686},{x:387.8068542480469,y:236.25958442687988,z:8.345099091529846},{x:393.95751953125,y:235.8660364151001,z:10.475142002105713},{x:401.84600830078125,y:232.77019500732422,z:16.760226488113403},{x:375.70568084716797,y:233.48456382751465,z:8.234220147132874},{x:388.17752838134766,y:218.94717693328857,z:6.810300946235657},{x:381.64928436279297,y:219.2656660079956,z:6.711093783378601},{x:394.4760513305664,y:219.66821193695068,z:9.173773527145386},{x:398.8843536376953,y:221.8837022781372,z:12.03328251838684},{x:406.5454864501953,y:237.12156772613525,z:19.7131085395813},{x:383.87447357177734,y:337.6932907104492,z:-8.631049990653992},{x:401.2682342529297,y:228.5916566848755,z:18.359217643737793,name:"leftEye"},{x:422.0449447631836,y:236.73934936523438,z:51.16771221160889},{x:412.69153594970703,y:232.80198097229004,z:27.52131938934326},{x:387.3497772216797,y:263.298397064209,z:-2.8609684109687805},{x:364.5124053955078,y:293.39221000671387,z:-22.397546768188477,name:"lips"},{x:363.62987518310547,y:302.1291446685791,z:-19.643079042434692},{x:373.2334518432617,y:295.8647060394287,z:-18.125789165496826,name:"lips"},{x:378.83365631103516,y:299.5177745819092,z:-13.153743743896484,name:"lips"},{x:369.91477966308594,y:302.5704002380371,z:-16.65518283843994},{x:374.9167251586914,y:303.5416603088379,z:-11.963253021240234},{x:387.58888244628906,y:312.2716999053955,z:-4.680258631706238},{x:360.6635284423828,y:264.31986808776855,z:-35.94811677932739},{x:361.04564666748047,y:256.8225860595703,z:-37.278664112091064},{x:408.3855438232422,y:213.52088928222656,z:15.756480693817139,name:"leftEyebrow"},{x:373.2946014404297,y:245.38101196289063,z:-1.9316278398036957},{x:376.83860778808594,y:264.3721103668213,z:-18.510947227478027},{x:376.9546127319336,y:261.0010528564453,z:-15.989909172058105},{x:406.1498260498047,y:263.5030174255371,z:7.072908878326416},{x:360.07205963134766,y:248.3631706237793,z:-32.16656446456909},{x:393.11119079589844,y:205.10473251342773,z:3.7786373496055603,name:"leftEyebrow"},{x:402.12791442871094,y:207.89000988006592,z:9.383859634399414,name:"leftEyebrow"},{x:410.8693313598633,y:191.6182279586792,z:41.27030849456787,name:"faceOval"},{x:364.9509811401367,y:210.40483474731445,z:-3.758212625980377},{x:375.94444274902344,y:221.1331844329834,z:8.368442058563232},{x:392.1904754638672,y:305.0360298156738,z:-1.752179116010666},{x:419.50225830078125,y:307.25592613220215,z:58.96425247192383,name:"faceOval"},{x:372.0027160644531,y:268.7212657928467,z:-16.631840467453003},{x:366.1614227294922,y:271.6237449645996,z:-18.219159841537476},{x:385.00938415527344,y:305.3863334655762,z:-2.567722797393799},{x:381.99771881103516,y:304.9723720550537,z:-4.575215280056},{x:405.078125,y:203.21216583251953,z:13.713973760604858,name:"leftEyebrow"},{x:377.13207244873047,y:268.4710121154785,z:-15.266278982162476},{x:380.9713363647461,y:205.36980628967285,z:-.7250899076461792,name:"leftEyebrow"},{x:381.7788314819336,y:198.9268398284912,z:-1.184653863310814,name:"leftEyebrow"},{x:385.5204772949219,y:172.1484375,z:16.04826807975769,name:"faceOval"},{x:407.94189453125,y:196.76236152648926,z:25.723915100097656},{x:383.03890228271484,y:184.5157527923584,z:7.393874526023865},{x:411.61781311035156,y:210.79241752624512,z:22.315845489501953,name:"leftEyebrow"},{x:414.30870056152344,y:208.4643030166626,z:37.021894454956055},{x:364.28722381591797,y:298.35777282714844,z:-21.86065673828125},{x:371.3682556152344,y:299.78848457336426,z:-17.834001779556274},{x:376.88201904296875,y:301.6696071624756,z:-13.153743743896484},{x:370.2193832397461,y:270.49095153808594,z:-15.569736957550049},{x:383.5081100463867,y:305.2726364135742,z:-3.673594295978546},{x:380.73760986328125,y:305.96869468688965,z:-8.660228252410889},{x:381.2334442138672,y:304.63574409484863,z:-4.820316135883331,name:"lips"},{x:368.1698989868164,y:264.8884963989258,z:-25.653886795043945},{x:373.5087203979492,y:303.4233856201172,z:-10.95950722694397,name:"lips"},{x:368.4544372558594,y:303.29601287841797,z:-14.169161319732666,name:"lips"},{x:362.76554107666016,y:303.5735607147217,z:-16.911956071853638,name:"lips"},{x:366.60980224609375,y:324.8870658874512,z:-15.616422891616821},{x:365.7067108154297,y:315.95678329467773,z:-20.903596878051758,name:"lips"},{x:365.0083923339844,y:311.2232208251953,z:-21.066999435424805},{x:364.1508102416992,y:307.0583438873291,z:-18.907777070999146},{x:363.37512969970703,y:304.5721435546875,z:-17.42550015449524,name:"lips"},{x:374.580078125,y:304.3059539794922,z:-11.40302300453186,name:"lips"},{x:375.55362701416016,y:305.0998020172119,z:-12.861957550048828},{x:377.2437286376953,y:307.1674346923828,z:-14.215847253799438},{x:378.68587493896484,y:309.9015712738037,z:-13.223772048950195,name:"lips"},{x:383.8992691040039,y:290.29629707336426,z:-9.97326910495758},{x:423.3871841430664,y:271.91688537597656,z:74.37058925628662,name:"faceOval"},{x:377.68043518066406,y:304.62209701538086,z:-7.603961229324341,name:"lips"},{x:379.00428771972656,y:304.9314594268799,z:-8.57852816581726},{x:364.00279998779297,y:275.2813911437988,z:-19.25792098045349},{x:374.68231201171875,y:273.82555961608887,z:-11.28047227859497},{x:365.0354766845703,y:273.4548568725586,z:-18.791062831878662},{x:380.61901092529297,y:249.8848056793213,z:.15501167625188828},{x:391.14158630371094,y:254.7934627532959,z:2.0906515419483185},{x:378.1761169433594,y:264.9612236022949,z:-12.605184316635132},{x:400.9540557861328,y:179.99592304229736,z:27.82477855682373,name:"faceOval"},{x:398.0038833618164,y:188.50656509399414,z:16.094952821731567},{x:394.8717498779297,y:199.0359592437744,z:6.226727366447449,name:"leftEyebrow"},{x:382.10926055908203,y:316.83926582336426,z:-8.946179747581482},{x:366.51588439941406,y:200.32583713531494,z:-5.24632453918457,name:"leftEyebrow"},{x:367.4893569946289,y:183.87210845947266,z:1.9039081037044525},{x:368.6243438720703,y:168.8127565383911,z:8.736093044281006,name:"faceOval"},{x:398.96175384521484,y:234.9675178527832,z:13.713973760604858},{x:412.9645538330078,y:242.23042488098145,z:23.272905349731445},{x:372.05257415771484,y:231.41919136047363,z:9.226294755935669},{x:406.0722351074219,y:223.58965873718262,z:18.370890617370605},{x:368.27442169189453,y:240.2039337158203,z:-4.166713654994965},{x:372.3575210571289,y:260.66442489624023,z:-24.976940155029297},{x:419.2244338989258,y:247.9079246520996,z:30.299127101898193},{x:409.43885803222656,y:246.60913467407227,z:16.398411989212036},{x:401.69139862060547,y:248.76328468322754,z:9.395531415939331},{x:389.7608184814453,y:247.56915092468262,z:5.841569304466248},{x:380.5461883544922,y:244.55984115600586,z:4.263003468513489},{x:373.25817108154297,y:240.80214500427246,z:2.5356262922286987},{x:358.77086639404297,y:229.35615062713623,z:-10.387605428695679},{x:419.5793914794922,y:262.8478717803955,z:26.5175724029541},{x:410.8808898925781,y:222.51372814178467,z:22.199130058288574},{x:358.45714569091797,y:268.91467094421387,z:-33.17030906677246},{x:373.4129333496094,y:251.6385841369629,z:-5.771540403366089},{x:422.5408172607422,y:239.23919677734375,z:74.04378890991211,name:"faceOval"},{x:367.8171920776367,y:236.58040523529053,z:1.820748895406723},{x:378.51959228515625,y:266.2532329559326,z:-5.74819803237915},{x:403.3472442626953,y:229.05112266540527,z:19.689764976501465},{x:372.34840393066406,y:256.6451168060303,z:-21.872329711914063},{x:422.54566192626953,y:289.1587829589844,z:68.67491245269775,name:"faceOval"},{x:371.9297409057617,y:228.90116214752197,z:11.432201862335205,name:"leftEye"},{x:366.21360778808594,y:251.6158962249756,z:-28.19826364517212},{x:409.1571807861328,y:321.3156223297119,z:20.2266526222229},{x:408.52943420410156,y:331.44238471984863,z:31.09278917312622,name:"faceOval"},{x:424.2788314819336,y:267.1992301940918,z:50.467424392700195},{x:415.60352325439453,y:311.6528606414795,z:30.579242706298828},{x:418.12793731689453,y:221.59927368164063,z:46.26569747924805},{x:385.68286895751953,y:346.0184955596924,z:-5.70151150226593},{x:357.82936096191406,y:271.3758373260498,z:-24.836881160736084},{x:379.588623046875,y:257.5071716308594,z:-3.755294680595398},{x:417.4592590332031,y:234.71948146820068,z:34.5475435256958},{x:393.4684371948242,y:231.58967971801758,z:11.408859491348267,name:"leftEye"},{x:387.8864288330078,y:232.14245796203613,z:9.51808214187622,name:"leftEye"},{x:382.4981689453125,y:307.5654888153076,z:-7.522260546684265,name:"lips"},{x:419.00169372558594,y:277.8332805633545,z:26.424202919006348},{x:373.62953186035156,y:357.6375102996826,z:-5.75986921787262,name:"faceOval"},{x:392.8708267211914,y:347.72446632385254,z:10.154176950454712,name:"faceOval"},{x:400.3953552246094,y:341.0005187988281,z:19.39797878265381,name:"faceOval"},{x:382.25440979003906,y:231.66935920715332,z:8.998700976371765,name:"leftEye"},{x:377.14550018310547,y:230.4228687286377,z:9.804032444953918,name:"leftEye"},{x:373.8358688354492,y:229.64950561523438,z:11.292144060134888,name:"leftEye"},{x:414.5794677734375,y:221.67891025543213,z:29.412097930908203},{x:377.00672149658203,y:225.66201210021973,z:9.360517263412476,name:"leftEye"},{x:382.29530334472656,y:224.8431158065796,z:8.32175612449646,name:"leftEye"},{x:387.5133514404297,y:224.49507236480713,z:8.917000889778137,name:"leftEye"},{x:393.15906524658203,y:225.24795055389404,z:10.737749338150024,name:"leftEye"},{x:397.05554962158203,y:226.55359268188477,z:13.002015352249146,name:"leftEye"},{x:420.5299377441406,y:221.014666557312,z:65.40690422058105,name:"faceOval"},{x:397.06920623779297,y:230.6661558151245,z:13.807345628738403,name:"leftEye"},{x:377.94647216796875,y:285.1647090911865,z:-13.305472135543823},{x:372.1118927001953,y:267.1267318725586,z:-18.83774757385254},{x:364.9968719482422,y:282.24411964416504,z:-19.818150997161865},{x:401.973876953125,y:331.20131492614746,z:11.566424369812012},{x:394.3083190917969,y:338.86693954467773,z:3.142542541027069},{x:373.9820861816406,y:351.4504623413086,z:-13.50388765335083},{x:414.3888854980469,y:321.24735832214355,z:45.51872253417969,name:"faceOval"},{x:373.44234466552734,y:227.33163356781006,z:10.626870393753052,name:"leftEye"},{x:364.0731430053711,y:240.31539916992188,z:-13.807345628738403},{x:384.2658233642578,y:353.3793067932129,z:.7385850697755814,name:"faceOval"},{x:423.20526123046875,y:283.5176181793213,z:47.152724266052246},{x:369.42798614501953,y:304.0898895263672,z:-14.647691249847412,name:"lips"},{x:370.63812255859375,y:305.90051651000977,z:-16.211668252944946},{x:371.91192626953125,y:309.0167713165283,z:-17.84567356109619},{x:373.0583953857422,y:313.3545398712158,z:-17.378815412521362,name:"lips"},{x:375.39905548095703,y:321.09289169311523,z:-13.118728399276733},{x:379.2567825317383,y:304.3582534790039,z:-7.924926280975342},{x:381.18797302246094,y:303.7031364440918,z:-7.843226194381714},{x:383.0918502807617,y:302.4884605407715,z:-7.6506465673446655,name:"lips"},{x:389.09461975097656,y:297.1475315093994,z:-5.5497825145721436},{x:411.6408920288086,y:280.24898529052734,z:12.02161192893982},{x:363.3110809326172,y:234.27620887756348,z:-6.775286793708801},{x:366.0474395751953,y:223.29872131347656,z:6.827808618545532},{x:370.34427642822266,y:225.1457118988037,z:9.558931589126587},{x:377.5371551513672,y:303.60079765319824,z:-7.358860373497009,name:"lips"},{x:412.9557800292969,y:299.53579902648926,z:19.39797878265381},{x:360.0810241699219,y:221.72012329101563,z:-2.153385728597641},{x:379.82784271240234,y:329.47723388671875,z:-10.48097848892212},{x:359.08477783203125,y:235.7911491394043,z:-18.079102039337158},{x:369.6688461303711,y:251.5407943725586,z:-14.962821006774902},{x:369.5555114746094,y:333.5307312011719,z:-15.67478060722351},{x:394.0193176269531,y:315.6973171234131,z:-.9920747578144073},{x:383.78997802734375,y:272.7268695831299,z:-4.689012169837952},{x:387.67765045166016,y:323.6722755432129,z:-5.640236139297485},{x:397.8769302368164,y:272.1331214904785,z:-.9395531564950943},{x:389.87476348876953,y:280.5630111694336,z:-4.29218202829361},{x:403.83888244628906,y:285.1167869567871,z:3.0229100584983826},{x:372.5467300415039,y:343.1070327758789,z:-16.153310537338257},{x:374.1112518310547,y:256.3721466064453,z:-10.574349164962769},{x:399.73785400390625,y:321.77515983581543,z:4.849494695663452},{x:392.03365325927734,y:330.56447982788086,z:-1.3407598435878754},{x:398.59134674072266,y:305.93902587890625,z:1.517290621995926},{x:417.95997619628906,y:290.9716987609863,z:26.89105987548828},{x:406.04541778564453,y:307.35154151916504,z:8.666064143180847},{x:420.75328826904297,y:298.40752601623535,z:41.78385257720947},{x:395.4522705078125,y:291.4153575897217,z:-2.1752697229385376},{x:368.6452102661133,y:245.8882999420166,z:-9.453888535499573},{x:370.34900665283203,y:263.56690406799316,z:-26.75100326538086},{x:374.98477935791016,y:266.6126346588135,z:-19.77146625518799},{x:366.99840545654297,y:258.12140464782715,z:-31.372904777526855},{x:371.00616455078125,y:217.63479709625244,z:5.60522198677063},{x:381.30577087402344,y:214.14087295532227,z:4.983716309070587},{x:390.1496124267578,y:213.38221549987793,z:5.593550801277161},{x:397.7696990966797,y:214.3659782409668,z:8.57852816581726},{x:403.1652069091797,y:217.65509605407715,z:13.013685941696167},{x:407.3551940917969,y:230.72525024414063,z:22.444231510162354},{x:424.0876770019531,y:251.7839241027832,z:51.16771221160889},{x:403.50196838378906,y:239.88757610321045,z:15.803166627883911},{x:397.31719970703125,y:241.49806022644043,z:11.233787536621094},{x:388.99425506591797,y:241.4366912841797,z:7.948269248008728},{x:380.7804489135742,y:239.78078842163086,z:6.600214838981628},{x:374.01336669921875,y:237.11946487426758,z:6.349278092384338},{x:369.39125061035156,y:234.35351371765137,z:5.987462401390076},{x:422.9730987548828,y:255.76455116271973,z:76.61150932312012,name:"faceOval"},{x:374.73915100097656,y:269.24214363098145,z:-16.608498096466064},{x:364.61681365966797,y:245.71088790893555,z:-20.02823829650879},{x:365.3834533691406,y:263.34174156188965,z:-32.32996463775635},{x:361.58252716064453,y:267.8273677825928,z:-30.345816612243652},{x:365.37208557128906,y:265.0249671936035,z:-29.178667068481445},{x:372.72605895996094,y:272.05135345458984,z:-14.834434986114502},{x:360.48614501953125,y:268.34827423095703,z:-32.189905643463135},{x:359.9516296386719,y:270.8049201965332,z:-24.650139808654785},{x:369.5049285888672,y:229.01945114135742,z:10.107489824295044},{x:365.5447769165039,y:230.24096488952637,z:5.593550801277161},{x:363.50669860839844,y:230.6208372116089,z:.43622106313705444},{x:399.3529510498047,y:227.65677452087402,z:15.35965085029602,name:"leftEye"},{x:402.5693130493164,y:224.60190296173096,z:15.931552648544312}],box:{xMin:277.8318977355957,yMin:168.7741756439209,xMax:424.2788314819336,yMax:359.8348903656006,width:146.4469337463379,height:191.0607147216797}},SAMPLE_FACELANDMARKER_RESULT:{faceLandmarks:[[{x:.5760777592658997,y:.8639070391654968,z:-.030997956171631813},{x:.572094738483429,y:.7886289358139038,z:-.07189624011516571},{x:.5723551511764526,y:.8075382709503174,z:-.03578168898820877},{x:.5548420548439026,y:.7188365459442139,z:-.057787876576185226},{x:.5706077814102173,y:.7674974799156189,z:-.07740399986505508},{x:.5681378245353699,y:.7387768030166626,z:-.07356284558773041},{x:.5621535181999207,y:.6681165099143982,z:-.04189874976873398},{x:.46613582968711853,y:.6679812073707581,z:.011289681307971478},{x:.5579932928085327,y:.6174106597900391,z:-.03502821549773216},{x:.5563451647758484,y:.5905600190162659,z:-.03928658738732338},{x:.5487832427024841,y:.4900572597980499,z:-.029898937791585922},{x:.5765544176101685,y:.8692144751548767,z:-.02831427752971649},{x:.5771114230155945,y:.873644232749939,z:-.02345779910683632},{x:.5771905779838562,y:.877016007900238,z:-.016658689826726913},{x:.5778058767318726,y:.8770116567611694,z:-.014505492523312569},{x:.5783766508102417,y:.8835000991821289,z:-.015996402129530907},{x:.5792440176010132,y:.8913810849189758,z:-.01924579218029976},{x:.5796768069267273,y:.8996334671974182,z:-.018261712044477463},{x:.5817288160324097,y:.9255813956260681,z:-.007126849144697189},{x:.5726592540740967,y:.7992473244667053,z:-.0643521398305893},{x:.5579419136047363,y:.7996989488601685,z:-.04566684365272522},{x:.4216199815273285,y:.5958762764930725,z:.06776496022939682},{x:.5052269697189331,y:.6796539425849915,z:-.0010737782577052712},{x:.49243026971817017,y:.6838865876197815,z:-5227324436418712e-19},{x:.4796970784664154,y:.6856290102005005,z:.002684245817363262},{x:.4618356227874756,y:.6764569878578186,z:.013439622707664967},{x:.5160380601882935,y:.6737282276153564,z:-17607348127057776e-21},{x:.48070961236953735,y:.6255870461463928,z:-.008339674212038517},{x:.49719780683517456,y:.6256808042526245,z:-.008027955889701843},{x:.46674346923828125,y:.6317623853683472,z:-.004460199736058712},{x:.4582492709159851,y:.641118049621582,z:.0011905613355338573},{x:.45408669114112854,y:.6911458969116211,z:.020514748990535736},{x:.535312294960022,y:.9619986414909363,z:.012499462813138962},{x:.4608460068702698,y:.6628725528717041,z:.01517564244568348},{x:.4206731915473938,y:.6828458309173584,z:.07848648726940155},{x:.4390624463558197,y:.6796106696128845,z:.03283142298460007},{x:.5029968619346619,y:.7701570391654968,z:-.009734481573104858},{x:.5595027208328247,y:.8607323169708252,z:-.030043255537748337},{x:.5621269941329956,y:.8738374710083008,z:-.021709579974412918},{x:.5451499819755554,y:.865527331829071,z:-.022014077752828598},{x:.5351184010505676,y:.8705098032951355,z:-.011602800339460373},{x:.5495014190673828,y:.8744956254959106,z:-.016490943729877472},{x:.5395170450210571,y:.8759440779685974,z:-.007333362940698862},{x:.5183624029159546,y:.8959754705429077,z:.010520773939788342},{x:.5604349374771118,y:.7895449995994568,z:-.07082037627696991},{x:.557381272315979,y:.7687489986419678,z:-.07590588927268982},{x:.4432901442050934,y:.6308897733688354,z:.0027153254486620426},{x:.5258325338363647,y:.7151225805282593,z:-.014676518738269806},{x:.5271827578544617,y:.7833116054534912,z:-.037643320858478546},{x:.5257382988929749,y:.7717816233634949,z:-.03401920944452286},{x:.46516409516334534,y:.7705106735229492,z:.0065747760236263275},{x:.5558893084526062,y:.7420997619628906,z:-.0694495290517807},{x:.4720408320426941,y:.6066038608551025,z:-.021204356104135513},{x:.45432573556900024,y:.6158540844917297,z:-.011054684408009052},{x:.4305151402950287,y:.5608053803443909,z:.0396830290555954},{x:.5310865640640259,y:.6157484650611877,z:-.03081176057457924},{x:.5114666223526001,y:.6329749226570129,z:-.00335998204536736},{x:.506435751914978,y:.8786543607711792,z:.012980876490473747},{x:.4480472207069397,y:.8640613555908203,z:.12569651007652283},{x:.5372058153152466,y:.7942581176757813,z:-.03168361634016037},{x:.5488379597663879,y:.8001630306243896,z:-.03280917927622795},{x:.5213388204574585,y:.8794381618499756,z:.011892606504261494},{x:.5242055654525757,y:.8789222240447998,z:.008370225317776203},{x:.4477175176143646,y:.6039950251579285,z:-.0050799972377717495},{x:.526964008808136,y:.7916748523712158,z:-.02968614175915718},{x:.4971255660057068,y:.6050706505775452,z:-.028175678104162216},{x:.4938119053840637,y:.5882453918457031,z:-.03210941329598427},{x:.4757143557071686,y:.5094879865646362,z:-.01300730835646391},{x:.43947282433509827,y:.5816648006439209,z:.01415177434682846},{x:.485664039850235,y:.5477864146232605,z:-.023685332387685776},{x:.43635931611061096,y:.6226438283920288,z:.013606148771941662},{x:.42910251021385193,y:.6102726459503174,z:.03926564007997513},{x:.5605402588844299,y:.8680099248886108,z:-.027318159118294716},{x:.5474816560745239,y:.8702861070632935,z:-.019686367362737656},{x:.5373021364212036,y:.8728838562965393,z:-.010484928265213966},{x:.540735125541687,y:.7979167103767395,z:-.029073253273963928},{x:.5228585004806519,y:.87913578748703,z:.009915109723806381},{x:.530497670173645,y:.8815253973007202,z:.0020524784922599792},{x:.5259912610054016,y:.8790552616119385,z:.007895970717072487},{x:.5433906316757202,y:.7882310748100281,z:-.05121905356645584},{x:.541388213634491,y:.8777219653129578,z:-.00466804439201951},{x:.5515822172164917,y:.8767023086547852,z:-.010475946590304375},{x:.5637003779411316,y:.877059817314148,z:-.015273625031113625},{x:.5640299320220947,y:.9263423085212708,z:-.00658724969252944},{x:.5642300248146057,y:.8993074893951416,z:-.017653480172157288},{x:.5637336373329163,y:.8910360932350159,z:-.01852807030081749},{x:.5637134313583374,y:.8837276697158813,z:-.01482592523097992},{x:.564205527305603,y:.8768964409828186,z:-.01331155002117157},{x:.5419867634773254,y:.8778373599052429,z:-.0037720394320786},{x:.5404468774795532,y:.880696177482605,z:-.005610354244709015},{x:.5392338633537292,y:.8845721483230591,z:-.007352025713771582},{x:.538469672203064,y:.8891173601150513,z:-.005154991988092661},{x:.5189250111579895,y:.8452741503715515,z:-.009755070321261883},{x:.4258975088596344,y:.7662280797958374,z:.1387351155281067},{x:.5725725293159485,y:.8041572570800781,z:-.04583907872438431},{x:.5342061519622803,y:.8785833120346069,z:.002659974154084921},{x:.5324031114578247,y:.8804071545600891,z:.0017832003068178892},{x:.5538818836212158,y:.8078407645225525,z:-.03254539892077446},{x:.5325431823730469,y:.8026832938194275,z:-.019140373915433884},{x:.5514076948165894,y:.8043903112411499,z:-.03313535451889038},{x:.5131856203079224,y:.7284771800041199,z:-.009399853646755219},{x:.49331504106521606,y:.7443980574607849,z:-.005225230939686298},{x:.5239617824554443,y:.7807451486587524,z:-.025881027802824974},{x:.4473606050014496,y:.5315827131271362,z:.011164786294102669},{x:.45718759298324585,y:.5604941248893738,z:-.005943301599472761},{x:.4670005738735199,y:.5909327268600464,z:-.019681761041283607},{x:.5311570167541504,y:.9076261520385742,z:.00389476353302598},{x:.5249923467636108,y:.5893563628196716,z:-.037981919944286346},{x:.5166932344436646,y:.5429551005363464,z:-.03319704160094261},{x:.5085030198097229,y:.49676206707954407,z:-.02691275253891945},{x:.4687720239162445,y:.6834565997123718,z:.008113506250083447},{x:.4426414966583252,y:.7069531679153442,z:.028577271848917007},{x:.5230373740196228,y:.6675713658332825,z:.001773772411979735},{x:.4481240212917328,y:.6527872085571289,z:.012414850294589996},{x:.5339856743812561,y:.7012367844581604,z:-.020220188423991203},{x:.5347223281860352,y:.7761190533638,z:-.05141595005989075},{x:.4315067231655121,y:.7211957573890686,z:.04381405934691429},{x:.45203351974487305,y:.7206180095672607,z:.017288070172071457},{x:.46892452239990234,y:.7265436053276062,z:.005602988880127668},{x:.49314674735069275,y:.7202282547950745,z:-6408205372281373e-19},{x:.5104925632476807,y:.7091827392578125,z:-.00362918758764863},{x:.5232142210006714,y:.698553740978241,z:-.00787867046892643},{x:.5497883558273315,y:.6743605136871338,z:-.036349106580019},{x:.43658503890037537,y:.7627100348472595,z:.042555369436740875},{x:.4397648870944977,y:.6528646349906921,z:.017956094816327095},{x:.5653332471847534,y:.7992802858352661,z:-.06365057826042175},{x:.5285563468933105,y:.736810564994812,z:-.018836988136172295},{x:.4180678725242615,y:.6792560815811157,z:.12284679710865021},{x:.5328429937362671,y:.6865872144699097,z:-.010484723374247551},{x:.5230283141136169,y:.7809416055679321,z:-.011922398582100868},{x:.4551771283149719,y:.6650775074958801,z:.01774493046104908},{x:.5337203741073608,y:.7618928551673889,z:-.04697106033563614},{x:.43463975191116333,y:.8133478164672852,z:.1354849934577942},{x:.5225707292556763,y:.6605283617973328,z:.004980515688657761},{x:.5441933870315552,y:.7497199773788452,z:-.06091512367129326},{x:.4774007797241211,y:.9159183502197266,z:.059622734785079956},{x:.48068761825561523,y:.9364941716194153,z:.08404944837093353},{x:.4268292486667633,y:.7657528519630432,z:.09051097184419632},{x:.46051913499832153,y:.8880485892295837,z:.0738474428653717},{x:.4243420660495758,y:.6434382200241089,z:.06230505183339119},{x:.5342157483100891,y:.9835634231567383,z:.021662971004843712},{x:.5668109655380249,y:.8042187094688416,z:-.044937074184417725},{x:.5176341533660889,y:.7530587315559387,z:-.012967454269528389},{x:.430206298828125,y:.6835605502128601,z:.04612284153699875},{x:.4794231951236725,y:.6732114553451538,z:.003970044665038586},{x:.49073347449302673,y:.6722435355186462,z:8692514384165406e-19},{x:.5294116139411926,y:.884677529335022,z:.004413890186697245},{x:.4430122375488281,y:.80235356092453,z:.04987282305955887},{x:.5603825449943542,y:1.0092442035675049,z:.026417359709739685},{x:.5186598300933838,y:.9828659892082214,z:.0513598807156086},{x:.5010536909103394,y:.9640932679176331,z:.06591596454381943},{x:.5524769425392151,y:.539441704750061,z:-.035816047340631485},{x:.5879997611045837,y:1.0091472864151,z:.02285068854689598},{x:.5016193985939026,y:.6684437990188599,z:28415941051207483e-20},{x:.511952817440033,y:.6642197370529175,z:.0021144719794392586},{x:.5194343328475952,y:.6623469591140747,z:.004674181342124939},{x:.4321230351924896,y:.6496355533599854,z:.03124697133898735},{x:.508686363697052,y:.6479565501213074,z:-44765998609364033e-20},{x:.4963986277580261,y:.6431032419204712,z:-.0032507688738405704},{x:.4845542013645172,y:.6430778503417969,z:-.002903624437749386},{x:.4733612537384033,y:.647506833076477,z:23347247042693198e-20},{x:.4668654501438141,y:.653346598148346,z:.004762572236359119},{x:.41815051436424255,y:.633708119392395,z:.09809435904026031},{x:.47159942984580994,y:.6711485385894775,z:.007849935442209244},{x:.5734396576881409,y:.8256140351295471,z:-.03155219927430153},{x:.5306524038314819,y:.8337990641593933,z:-.018351426348090172},{x:.5371729135513306,y:.7910830974578857,z:-.037286680191755295},{x:.5549534559249878,y:.8275275826454163,z:-.030664825811982155},{x:.5597432255744934,y:.6418541669845581,z:-.03318847343325615},{x:.4958484172821045,y:.9429569244384766,z:.048340678215026855},{x:.5140507817268372,y:.9634028077125549,z:.03589847311377525},{x:.5587693452835083,y:.9951097369194031,z:.00908728688955307},{x:.46411189436912537,y:.9051855206489563,z:.10601935535669327},{x:.5181609392166138,y:.6554316878318787,z:.002546071307733655},{x:.5436590909957886,y:.7085841298103333,z:-.03844436630606651},{x:.5872187614440918,y:.9960382580757141,z:.0063423276878893375},{x:.5379653573036194,y:.9989125728607178,z:.03636329993605614},{x:.4350326955318451,y:.8088565468788147,z:.09147704392671585},{x:.5523084998130798,y:.8773422837257385,z:-.009068487212061882},{x:.5510149598121643,y:.8816931843757629,z:-.011043853126466274},{x:.5503793954849243,y:.88776695728302,z:-.01348799467086792},{x:.5501549243927002,y:.8954370617866516,z:-.012142189778387547},{x:.546072781085968,y:.9192524552345276,z:-.003157563041895628},{x:.5314661860466003,y:.8771666884422302,z:5075141089037061e-19},{x:.5293324589729309,y:.8762547969818115,z:39177737198770046e-20},{x:.5275698900222778,y:.8750609755516052,z:47732755774632096e-21},{x:.5104271173477173,y:.8607332110404968,z:.0012934643309563398},{x:.45938700437545776,y:.8134918212890625,z:.023569690063595772},{x:.5418947339057922,y:.6864100694656372,z:-.027333909645676613},{x:.531914234161377,y:.6456130743026733,z:-.005434140563011169},{x:.523697018623352,y:.647885262966156,z:-2466466394253075e-19},{x:.5338191390037537,y:.8783687353134155,z:.002268768846988678},{x:.46226605772972107,y:.8610277771949768,z:.04718952998518944},{x:.5434442758560181,y:.6456181406974792,z:-.02327350154519081},{x:.5399754643440247,y:.940219521522522,z:.005075343884527683},{x:.5661457777023315,y:.71457839012146,z:-.06242101639509201},{x:.5523148775100708,y:.6974870562553406,z:-.04863070324063301},{x:.5639959573745728,y:.6923378109931946,z:-.05180761218070984},{x:.5367592573165894,y:.7423217296600342,z:-.03623027727007866},{x:.5853689908981323,y:.9752064943313599,z:-.002361974213272333},{x:.5835235118865967,y:.9493685960769653,z:-.003941743168979883},{x:.5615018606185913,y:.949194610118866,z:-.0015953965485095978},{x:.5068561434745789,y:.9048219323158264,z:.01862684078514576},{x:.5134067535400391,y:.7971825003623962,z:-.008485661819577217},{x:.5223897099494934,y:.925589919090271,z:.01249657291918993},{x:.48500555753707886,y:.7959478497505188,z:-.0032065745908766985},{x:.5037734508514404,y:.8184596300125122,z:-.004932103678584099},{x:.4766361117362976,y:.828806459903717,z:.01027688942849636},{x:.5589827299118042,y:.974656343460083,z:9666886180639267e-19},{x:.5294582843780518,y:.7541216611862183,z:-.025603046640753746},{x:.4973002076148987,y:.9208990931510925,z:.031931452453136444},{x:.5163551568984985,y:.9432790875434875,z:.024321340024471283},{x:.49399662017822266,y:.8814862370491028,z:.018687399104237556},{x:.44948166608810425,y:.836137592792511,z:.05702034756541252},{x:.47898444533348083,y:.8836610913276672,z:.03150695189833641},{x:.4454479217529297,y:.8499438166618347,z:.08868525922298431},{x:.49572959542274475,y:.8452823758125305,z:.0036111653316766024},{x:.5362502336502075,y:.7222585678100586,z:-.027912352234125137},{x:.5393770337104797,y:.7850722074508667,z:-.05415399745106697},{x:.531399667263031,y:.7898418307304382,z:-.03883346915245056},{x:.5451627373695374,y:.7717036604881287,z:-.06480253487825394},{x:.5206395983695984,y:.6287745833396912,z:-.010521138086915016},{x:.4974782466888428,y:.6191938519477844,z:-.014098240062594414},{x:.4774145185947418,y:.6193130612373352,z:-.013643337413668633},{x:.4616098403930664,y:.6259890198707581,z:-.008448202162981033},{x:.4516478478908539,y:.6368461847305298,z:9050309745362028e-20},{x:.4485096037387848,y:.6719120740890503,z:.022984720766544342},{x:.42177659273147583,y:.7240667343139648,z:.08511673659086227},{x:.4616215229034424,y:.6988231539726257,z:.014238474890589714},{x:.4755798876285553,y:.7034608721733093,z:.00625590980052948},{x:.4924992024898529,y:.7005885243415833,z:9391739731654525e-19},{x:.5082254409790039,y:.693384051322937,z:-9464038303121924e-19},{x:.5203112959861755,y:.6849707961082458,z:-.0022114769089967012},{x:.52867591381073,y:.6779075860977173,z:-.002962538506835699},{x:.4213953912258148,y:.7219811677932739,z:.1350894570350647},{x:.5320829749107361,y:.794858992099762,z:-.03181503340601921},{x:.5452795028686523,y:.7286570072174072,z:-.04771539941430092},{x:.5496407747268677,y:.7866933345794678,z:-.06452003121376038},{x:.557040274143219,y:.7962084412574768,z:-.05837344378232956},{x:.549176812171936,y:.7895247936248779,z:-.057761140167713165},{x:.5362890362739563,y:.8005836606025696,z:-.026903774589300156},{x:.560200035572052,y:.7983731031417847,z:-.06172555685043335},{x:.5616944432258606,y:.8022753596305847,z:-.045200999826192856},{x:.5273328423500061,y:.6611284017562866,z:.0029021520167589188},{x:.534850537776947,y:.6660012006759644,z:-.005215510260313749},{x:.5394860506057739,y:.6701375246047974,z:-.014931917190551758},{x:.4634307324886322,y:.658291757106781,z:.009295716881752014},{x:.4538393020629883,y:.6519932150840759,z:.00930330716073513},{x:.5776031613349915,y:.7159298658370972,z:-.057365912944078445},{x:.6504855155944824,y:.6461779475212097,z:.014184834435582161},{x:.5860154032707214,y:.7962266206741333,z:-.04522843658924103},{x:.6842049360275269,y:.5631637573242188,z:.07207967340946198},{x:.6152560710906982,y:.6674962639808655,z:7529259892180562e-19},{x:.6280948519706726,y:.6684326529502869,z:.0016892586136236787},{x:.6408625245094299,y:.6663892269134521,z:.005331226624548435},{x:.6557814478874207,y:.6534678936004639,z:.01646413467824459},{x:.6035663485527039,y:.6639701724052429,z:.0013799630105495453},{x:.6329053044319153,y:.608010470867157,z:-.006195899099111557},{x:.6167260408401489,y:.6117533445358276,z:-.006319951266050339},{x:.6471013426780701,y:.6112449765205383,z:-.0017843559617176652},{x:.6560901999473572,y:.6185776591300964,z:.004047257360070944},{x:.6666946411132813,y:.6651176810264587,z:.023647578433156013},{x:.6311345100402832,y:.9495396018028259,z:.014004078693687916},{x:.6544655561447144,y:.6397901773452759,z:.01809609681367874},{x:.6965808868408203,y:.6482675075531006,z:.08304904401302338},{x:.679817259311676,y:.650188148021698,z:.03632688894867897},{x:.6336516737937927,y:.7541458010673523,z:-.007742783520370722},{x:.5921701192855835,y:.8567668199539185,z:-.029399123042821884},{x:.591663658618927,y:.870215654373169,z:-.02103729173541069},{x:.6068367958068848,y:.8584195375442505,z:-.020668085664510727},{x:.6176617741584778,y:.860965371131897,z:-.009790095500648022},{x:.6040634512901306,y:.8686612844467163,z:-.015289564616978168},{x:.6143736839294434,y:.8671170473098755,z:-.005712216719985008},{x:.6373105049133301,y:.8815656900405884,z:.012672550976276398},{x:.5832505822181702,y:.7866312861442566,z:-.07051534950733185},{x:.5836675763130188,y:.7658692598342896,z:-.07566110789775848},{x:.6709531545639038,y:.604898989200592,z:.005951565690338612},{x:.6029891967773438,y:.705652117729187,z:-.013388276100158691},{x:.6131622195243835,y:.7728396058082581,z:-.036248479038476944},{x:.6123163104057312,y:.7612020373344421,z:-.03264721855521202},{x:.6696187853813171,y:.744706928730011,z:.009673702530562878},{x:.5803102254867554,y:.7385968565940857,z:-.0689152330160141},{x:.6404349207878113,y:.5877999663352966,z:-.01929756999015808},{x:.6588467955589294,y:.5929454565048218,z:-.008487257175147533},{x:.6720337867736816,y:.530631422996521,z:.043437421321868896},{x:.584305465221405,y:.6099005341529846,z:-.030301367864012718},{x:.6034283638000488,y:.6217452883720398,z:-.001970183802768588},{x:.6460927724838257,y:.8608663082122803,z:.015541625209152699},{x:.6957815289497375,y:.8326103091239929,z:.13015234470367432},{x:.6043362617492676,y:.7861682772636414,z:-.030476901680231094},{x:.594293475151062,y:.7942103147506714,z:-.032218821346759796},{x:.6324057579040527,y:.8665139675140381,z:.014255806803703308},{x:.6296147704124451,y:.8667733669281006,z:.010388285852968693},{x:.663644552230835,y:.5798642635345459,z:-.0022301070857793093},{x:.6140630841255188,y:.7809288501739502,z:-.02835679054260254},{x:.615908145904541,y:.5921698212623596,z:-.026804860681295395},{x:.617181122303009,y:.5748661756515503,z:-.03060605563223362},{x:.6222207546234131,y:.49137672781944275,z:-.011151673272252083},{x:.6669357419013977,y:.5541607141494751,z:.017466170713305473},{x:.6182981729507446,y:.5320425629615784,z:-.021793590858578682},{x:.6760554313659668,y:.595052182674408,z:.017115700989961624},{x:.6801463961601257,y:.5800720453262329,z:.043127160519361496},{x:.5922210812568665,y:.8644017577171326,z:-.02662893570959568},{x:.6054555177688599,y:.8637874722480774,z:-.018363753333687782},{x:.6161889433860779,y:.8641164898872375,z:-.008808949030935764},{x:.6017249822616577,y:.7901403307914734,z:-.028126630932092667},{x:.631446123123169,y:.8664817810058594,z:.012112865224480629},{x:.6249198913574219,y:.8716511130332947,z:.003882825840264559},{x:.6281915903091431,y:.867301881313324,z:.009891441091895103},{x:.5986843109130859,y:.7813931703567505,z:-.050227612257003784},{x:.6126407384872437,y:.869275689125061,z:-.0031255714129656553},{x:.6027271151542664,y:.8711842894554138,z:-.009324162267148495},{x:.59088134765625,y:.8742044568061829,z:-.014608660712838173},{x:.5984604358673096,y:.9216185212135315,z:-.005981989670544863},{x:.5950398445129395,y:.8964707255363464,z:-.01703473925590515},{x:.5941568613052368,y:.8882410526275635,z:-.017784785479307175},{x:.5928806662559509,y:.8803883194923401,z:-.014153128489851952},{x:.5909661054611206,y:.8748103976249695,z:-.012609979137778282},{x:.6128016710281372,y:.8702545762062073,z:-.0022550546564161777},{x:.6150846481323242,y:.8726804256439209,z:-.00414019962772727},{x:.6173093914985657,y:.8770190477371216,z:-.005970994010567665},{x:.619335412979126,y:.8814800977706909,z:-.0036864024586975574},{x:.6292637586593628,y:.8314558267593384,z:-.007714875973761082},{x:.702275276184082,y:.7320667505264282,z:.1433621346950531},{x:.6204835176467896,y:.8689177632331848,z:.0044869170524179935},{x:.6223508715629578,y:.8704851269721985,z:.00352082890458405},{x:.590448260307312,y:.8029727935791016,z:-.03200828656554222},{x:.6097423434257507,y:.7933741211891174,z:-.018042555078864098},{x:.59229576587677,y:.7993767261505127,z:-.032564569264650345},{x:.6171364188194275,y:.7153720259666443,z:-.007672437466681004},{x:.6389747858047485,y:.726390540599823,z:-.002999067772179842},{x:.6151940226554871,y:.769412100315094,z:-.024427521973848343},{x:.6526776552200317,y:.505868136882782,z:.01412637997418642},{x:.6475822329521179,y:.5375454425811768,z:-.0033899128902703524},{x:.6433356404304504,y:.5714520215988159,z:-.017428796738386154},{x:.626949667930603,y:.8962116837501526,z:.005602736957371235},{x:.5868416428565979,y:.5829002261161804,z:-.03727729618549347},{x:.5877229571342468,y:.5345035791397095,z:-.032396964728832245},{x:.5887066125869751,y:.48655083775520325,z:-.025856535881757736},{x:.6507197618484497,y:.6612282991409302,z:.011114613153040409},{x:.6803066730499268,y:.677992045879364,z:.032125361263751984},{x:.5963194370269775,y:.6598632335662842,z:.002976928371936083},{x:.667536199092865,y:.6274255514144897,z:.015618261881172657},{x:.5930740833282471,y:.6940041780471802,z:-.019217798486351967},{x:.6053346395492554,y:.7676517963409424,z:-.050308309495449066},{x:.6934473514556885,y:.6884298920631409,z:.04794462397694588},{x:.6738007664680481,y:.6934011578559875,z:.020697161555290222},{x:.6588084697723389,y:.7033141851425171,z:.008462334051728249},{x:.6346072554588318,y:.7029502391815186,z:.001542167621664703},{x:.6157816648483276,y:.6966525912284851,z:-.002009218093007803},{x:.6015574336051941,y:.688928484916687,z:-.006588225718587637},{x:.5746836066246033,y:.6711069345474243,z:-.03597589209675789},{x:.6947521567344666,y:.7309479117393494,z:.046707939356565475},{x:.6759101152420044,y:.6249120831489563,z:.021654341369867325},{x:.5794773101806641,y:.7971615195274353,z:-.06339326500892639},{x:.6041849851608276,y:.727514922618866,z:-.017512541264295578},{x:.6968844532966614,y:.6440950036048889,z:.12727996706962585},{x:.5910853147506714,y:.679325520992279,z:-.009497715160250664},{x:.6157375574111938,y:.7695677280426025,z:-.010624290443956852},{x:.6606494784355164,y:.6410489678382874,z:.0208158977329731},{x:.6040687561035156,y:.7531470656394958,z:-.045887019485235214},{x:.7012156248092651,y:.780247151851654,z:.14028730988502502},{x:.595149576663971,y:.6527782678604126,z:.006308757700026035},{x:.5925500392913818,y:.7436665892601013,z:-.060151755809783936},{x:.6780198812484741,y:.8905693888664246,z:.0626060739159584},{x:.676746666431427,y:.9113880395889282,z:.08726003766059875},{x:.7030686140060425,y:.7312687635421753,z:.09529774636030197},{x:.688987135887146,y:.8588417172431946,z:.07752864807844162},{x:.6883691549301147,y:.6109960675239563,z:.06669612973928452},{x:.6358906030654907,y:.9702065587043762,z:.023120900616049767},{x:.5781539678573608,y:.8023634552955627,z:-.044763918966054916},{x:.6170316934585571,y:.7408350706100464,z:-.011375460773706436},{x:.688542366027832,y:.6516284346580505,z:.050206027925014496},{x:.6385149359703064,y:.6540714502334595,z:.006462941411882639},{x:.6279382109642029,y:.6563615798950195,z:.003062846139073372},{x:.6268895268440247,y:.8736732006072998,z:.00627936702221632},{x:.6944946050643921,y:.7709181308746338,z:.053824134171009064},{x:.614617109298706,y:1.0022112131118774,z:.02719894051551819},{x:.6493719220161438,y:.9665167927742004,z:.053563784807920456},{x:.6624587178230286,y:.943530797958374,z:.068605437874794},{x:.6162528991699219,y:.6558693051338196,z:.002187855076044798},{x:.6058168411254883,y:.654328465461731,z:.0036193584091961384},{x:.5987918972969055,y:.6536934971809387,z:.006134530063718557},{x:.6831037402153015,y:.6195642948150635,z:.03511790186166763},{x:.6062582731246948,y:.6356398463249207,z:.001280312892049551},{x:.6174948811531067,y:.62776118516922,z:-.0013642468256875873},{x:.6297246217727661,y:.6253792643547058,z:-7034156005829573e-19},{x:.6407091617584229,y:.627578616142273,z:.0028144705574959517},{x:.6479622721672058,y:.6322650909423828,z:.00750273372977972},{x:.6915091276168823,y:.5990704298019409,z:.10270945727825165},{x:.6457163095474243,y:.6504453420639038,z:.010696077719330788},{x:.6164222955703735,y:.8231936097145081,z:-.016772059723734856},{x:.6042401194572449,y:.7830976843833923,z:-.03630910441279411},{x:.5922216773033142,y:.8228387236595154,z:-.029992375522851944},{x:.6646111011505127,y:.92097008228302,z:.050967294722795486},{x:.651232898235321,y:.9460107088088989,z:.038000158965587616},{x:.6140977144241333,y:.9882472157478333,z:.009882091544568539},{x:.6870781183242798,y:.8768675327301025,z:.10980932414531708},{x:.5986856818199158,y:.6456438899040222,z:.003999010659754276},{x:.585981547832489,y:.7034481763839722,z:-.0377722829580307},{x:.6342031359672546,y:.9867448806762695,z:.03786521404981613},{x:.7013950943946838,y:.776049017906189,z:.09598205983638763},{x:.6030206680297852,y:.8719133138656616,z:-.007931148633360863},{x:.6050592064857483,y:.8767156004905701,z:-.009791925549507141},{x:.6073468923568726,y:.8831382393836975,z:-.012361008673906326},{x:.6087977290153503,y:.890143632888794,z:-.01098148338496685},{x:.6147705316543579,y:.9110084772109985,z:-.0018823575228452682},{x:.622577965259552,y:.8670604825019836,z:.002609190298244357},{x:.6241236329078674,y:.8651344180107117,z:.0025534380692988634},{x:.6257084608078003,y:.8638408184051514,z:.0023300074972212315},{x:.639931321144104,y:.8449671268463135,z:.0038123116828501225},{x:.6810906529426575,y:.7856625318527222,z:.02717764675617218},{x:.583532452583313,y:.6811994910240173,z:-.026588857173919678},{x:.5855660438537598,y:.6393819451332092,z:-.004512844607234001},{x:.5932201743125916,y:.6398029327392578,z:8020466193556786e-19},{x:.6200879812240601,y:.8683351874351501,z:.00417016725987196},{x:.6842559576034546,y:.8330534100532532,z:.050836317241191864},{x:.5754412412643433,y:.6418221592903137,z:-.022838059812784195},{x:.6232790350914001,y:.9295297265052795,z:.006339520215988159},{x:.5764067769050598,y:.694546639919281,z:-.04825803264975548},{x:.59778892993927,y:.7343927621841431,z:-.035004377365112305},{x:.6042810678482056,y:.9441440105438232,z:-.0010970570147037506},{x:.6496372222900391,y:.8869078159332275,z:.021036235615611076},{x:.6274012327194214,y:.7830310463905334,z:-.006658440921455622},{x:.637792706489563,y:.9104999899864197,z:.014290250837802887},{x:.6549934148788452,y:.7748609185218811,z:-6672973395325243e-19},{x:.6404005289077759,y:.801220715045929,z:-.0026642554439604282},{x:.6671456694602966,y:.8045546412467957,z:.013180811889469624},{x:.6107483506202698,y:.9680658578872681,z:.001778992242179811},{x:.6060343980789185,y:.744587242603302,z:-.024382334202528},{x:.6602751612663269,y:.8998945355415344,z:.0344940721988678},{x:.6463775038719177,y:.9262562394142151,z:.02617623284459114},{x:.6579852104187012,y:.8602304458618164,z:.021586716175079346},{x:.6926165223121643,y:.8053340315818787,z:.061075080186128616},{x:.6724731922149658,y:.8594399690628052,z:.03457934781908989},{x:.6975721716880798,y:.8183245062828064,z:.09300774335861206},{x:.6512877941131592,y:.8258221745491028,z:.006324059329926968},{x:.594887375831604,y:.7148372530937195,z:-.026898479089140892},{x:.6017440557479858,y:.7773507833480835,z:-.05312420800328255},{x:.6096571683883667,y:.7806998491287231,z:-.037646256387233734},{x:.5952993035316467,y:.7654367685317993,z:-.06398405134677887},{x:.5950021147727966,y:.6201304793357849,z:-.009297547861933708},{x:.6165438890457153,y:.6052900552749634,z:-.012455573305487633},{x:.6362661719322205,y:.6015968918800354,z:-.011649220250546932},{x:.6522727608680725,y:.6046400666236877,z:-.005903332494199276},{x:.6625409722328186,y:.6128141283988953,z:.0030042496509850025},{x:.6688099503517151,y:.6457712054252625,z:.026322703808546066},{x:.7013440728187561,y:.6893666386604309,z:.08984331786632538},{x:.6608623266220093,y:.6749406456947327,z:.0172116681933403},{x:.6482325196266174,y:.6823726296424866,z:.008881398476660252},{x:.6313265562057495,y:.6842025518417358,z:.0031308617908507586},{x:.6147016286849976,y:.6809731721878052,z:7630771724507213e-19},{x:.6018834114074707,y:.6755372285842896,z:-8834321051836014e-19},{x:.5925027132034302,y:.670681357383728,z:-.001968748401850462},{x:.700127363204956,y:.6871103644371033,z:.13980500400066376},{x:.6095665693283081,y:.7853189706802368,z:-.03074747882783413},{x:.5880423784255981,y:.7229287028312683,z:-.04691500961780548},{x:.5930182337760925,y:.7811514139175415,z:-.06398335844278336},{x:.5867722034454346,y:.7922660112380981,z:-.05794971063733101},{x:.5933279991149902,y:.7842848896980286,z:-.05714067071676254},{x:.6063535809516907,y:.7920218706130981,z:-.02590685710310936},{x:.5839452743530273,y:.794978141784668,z:-.0615212507545948},{x:.5828126072883606,y:.8000800013542175,z:-.0449722595512867},{x:.5909603834152222,y:.6541213393211365,z:.003991890233010054},{x:.5852181911468506,y:.6602938771247864,z:-.004428438376635313},{x:.5825737714767456,y:.6651063561439514,z:-.014345290139317513},{x:.6517343521118164,y:.6362385153770447,z:.012151890434324741},{x:.6615052819252014,y:.6281577944755554,z:.0123682152479887},{x:.4856873154640198,y:.6568945646286011,z:720038078725338e-18},{x:.49988406896591187,y:.6547410488128662,z:6949726957827806e-19},{x:.48438939452171326,y:.6392973065376282,z:705525919329375e-18},{x:.47143134474754333,y:.6589511632919312,z:6980331381782889e-19},{x:.48704618215560913,y:.6752797961235046,z:6921177846379578e-19},{x:.6243702173233032,y:.640461802482605,z:-6592126737814397e-20},{x:.6390967965126038,y:.6385173797607422,z:-16105435497593135e-20},{x:.6230536699295044,y:.6224825382232666,z:-16136496560648084e-20},{x:.6095397472381592,y:.641917884349823,z:-1803556369850412e-19},{x:.6250996589660645,y:.6586247682571411,z:-1785515050869435e-19}]],faceBlendshapes:[{categories:[{index:0,score:5187174338061595e-21,categoryName:"_neutral",displayName:""},{index:1,score:.24521504342556,categoryName:"browDownLeft",displayName:""},{index:2,score:.1987743377685547,categoryName:"browDownRight",displayName:""},{index:3,score:.013400448486208916,categoryName:"browInnerUp",displayName:""},{index:4,score:.012361560948193073,categoryName:"browOuterUpLeft",displayName:""},{index:5,score:.019305096939206123,categoryName:"browOuterUpRight",displayName:""},{index:6,score:28426356948330067e-21,categoryName:"cheekPuff",displayName:""},{index:7,score:34500112633395474e-23,categoryName:"cheekSquintLeft",displayName:""},{index:8,score:483789051486383e-21,categoryName:"cheekSquintRight",displayName:""},{index:9,score:.07650448381900787,categoryName:"eyeBlinkLeft",displayName:""},{index:10,score:.05070012807846069,categoryName:"eyeBlinkRight",displayName:""},{index:11,score:.13978900015354156,categoryName:"eyeLookDownLeft",displayName:""},{index:12,score:.14198613166809082,categoryName:"eyeLookDownRight",displayName:""},{index:13,score:.2177766114473343,categoryName:"eyeLookInLeft",displayName:""},{index:14,score:.014739357866346836,categoryName:"eyeLookInRight",displayName:""},{index:15,score:.02361512929201126,categoryName:"eyeLookOutLeft",displayName:""},{index:16,score:.19679604470729828,categoryName:"eyeLookOutRight",displayName:""},{index:17,score:.04874616861343384,categoryName:"eyeLookUpLeft",displayName:""},{index:18,score:.049392376095056534,categoryName:"eyeLookUpRight",displayName:""},{index:19,score:.34944331645965576,categoryName:"eyeSquintLeft",displayName:""},{index:20,score:.2939716875553131,categoryName:"eyeSquintRight",displayName:""},{index:21,score:.005955042317509651,categoryName:"eyeWideLeft",displayName:""},{index:22,score:.006776117719709873,categoryName:"eyeWideRight",displayName:""},{index:23,score:16942436559475027e-21,categoryName:"jawForward",displayName:""},{index:24,score:.0045165494084358215,categoryName:"jawLeft",displayName:""},{index:25,score:.07803940027952194,categoryName:"jawOpen",displayName:""},{index:26,score:2090057751047425e-20,categoryName:"jawRight",displayName:""},{index:27,score:.06032035872340202,categoryName:"mouthClose",displayName:""},{index:28,score:.00228882092051208,categoryName:"mouthDimpleLeft",displayName:""},{index:29,score:.00781762320548296,categoryName:"mouthDimpleRight",displayName:""},{index:30,score:.0017093931091949344,categoryName:"mouthFrownLeft",displayName:""},{index:31,score:.0019319106359034777,categoryName:"mouthFrownRight",displayName:""},{index:32,score:8485237776767462e-20,categoryName:"mouthFunnel",displayName:""},{index:33,score:9051355300471187e-19,categoryName:"mouthLeft",displayName:""},{index:34,score:3630454302765429e-19,categoryName:"mouthLowerDownLeft",displayName:""},{index:35,score:17601238505449146e-20,categoryName:"mouthLowerDownRight",displayName:""},{index:36,score:.12865161895751953,categoryName:"mouthPressLeft",displayName:""},{index:37,score:.20137207210063934,categoryName:"mouthPressRight",displayName:""},{index:38,score:.0022203284315764904,categoryName:"mouthPucker",displayName:""},{index:39,score:9096377179957926e-19,categoryName:"mouthRight",displayName:""},{index:40,score:.34189721941947937,categoryName:"mouthRollLower",displayName:""},{index:41,score:.11409689486026764,categoryName:"mouthRollUpper",displayName:""},{index:42,score:.17172536253929138,categoryName:"mouthShrugLower",displayName:""},{index:43,score:.004038424696773291,categoryName:"mouthShrugUpper",displayName:""},{index:44,score:23205230536404997e-20,categoryName:"mouthSmileLeft",displayName:""},{index:45,score:19313619122840464e-20,categoryName:"mouthSmileRight",displayName:""},{index:46,score:.0018571305554360151,categoryName:"mouthStretchLeft",displayName:""},{index:47,score:.0023813238367438316,categoryName:"mouthStretchRight",displayName:""},{index:48,score:24323100660694763e-21,categoryName:"mouthUpperUpLeft",displayName:""},{index:49,score:3161552012898028e-20,categoryName:"mouthUpperUpRight",displayName:""},{index:50,score:108198406678639e-21,categoryName:"noseSneerLeft",displayName:""},{index:51,score:12652527630052646e-22,categoryName:"noseSneerRight",displayName:""}],headIndex:-1,headName:""}],facialTransformationMatrixes:[{rows:4,columns:4,data:[.9947517514228821,.10230544209480286,.0013679931871592999,0,-.10230997204780579,.9947447776794434,.003816320328041911,0,-970348424743861e-18,-.0039362297393381596,.9999914169311523,0,2.8888821601867676,-7.808934211730957,-30.52109146118164,1]}]}},xp=(0,tC.createContext)({}),xg={basePath:"https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.17/wasm",options:{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task",delegate:"GPU"},runningMode:"VIDEO",outputFaceBlendshapes:!0,outputFacialTransformationMatrixes:!0}},xv=(0,tC.forwardRef)(({basePath:t=xg.basePath,options:r=xg.options,children:i},n)=>{let a=JSON.stringify(r),o=(0,or.suspend)(async()=>{let{FilesetResolver:i,FaceLandmarker:n}=await e.A(26368),a=await i.forVisionTasks(t);return n.createFromOptions(a,r)},[t,a]);return(0,tC.useEffect)(()=>()=>{null==o||o.close(),(0,or.clear)([t,a])},[o,t,a]),(0,tC.useImperativeHandle)(n,()=>o,[o]),tC.createElement(xp.Provider,{value:o},i)});function xy(){return(0,tC.useContext)(xp)}function xx(e,t){return e.clone().add(t).multiplyScalar(.5)}function xE(e,t,r){let i=e.localToWorld(t);return r.worldToLocal(i)}let xC=(0,tC.createContext)({}),xB=(0,tC.forwardRef)(({camera:e,videoTexture:t={start:!0},manualDetect:r=!1,faceLandmarkerResult:i,manualUpdate:n=!1,makeDefault:a,smoothTime:o=.25,offset:s=!0,offsetScalar:l=80,eyes:c=!1,eyesAsOrigin:h=!0,depth:u=.15,debug:A=!1,facemesh:d},f)=>{var m,p;let g=(0,tI.C)(e=>e.scene),v=(0,tI.C)(e=>e.camera),y=(0,tI.C)(e=>e.set),x=(0,tI.C)(e=>e.get),E=e||v,C=(0,tC.useRef)(null),[B]=(0,tC.useState)(()=>new tw.Object3D),[w]=(0,tC.useState)(()=>new tw.Vector3),[I]=(0,tC.useState)(()=>new tw.Vector3),[b]=(0,tC.useState)(()=>new tw.Vector3),[_]=(0,tC.useState)(()=>new tw.Vector3),M=(0,tC.useCallback)(()=>{B.parent=E.parent;let e=C.current;if(e){let{outerRef:t,eyeRightRef:r,eyeLeftRef:i}=e;if(r.current&&i.current){let{irisDirRef:e}=r.current,{irisDirRef:n}=i.current;e.current&&n.current&&t.current&&(w.copy(xE(e.current,new tw.Vector3(0,0,0),t.current)),I.copy(xE(n.current,new tw.Vector3(0,0,0),t.current)),B.position.copy(xE(t.current,xx(w,I),E.parent||g)),b.copy(xE(e.current,new tw.Vector3(0,0,1),t.current)),_.copy(xE(n.current,new tw.Vector3(0,0,1),t.current)),B.lookAt(t.current.localToWorld(xx(b,_))))}else t.current&&(B.position.copy(xE(t.current,new tw.Vector3(0,0,0),E.parent||g)),B.lookAt(t.current.localToWorld(new tw.Vector3(0,0,1))))}return B},[E,I,_,w,b,g,B]),[S]=(0,tC.useState)(()=>new tw.Object3D),T=(0,tC.useCallback)(function(e,t){E&&(null!=t||(t=M()),o>0?(iN.damp3(S.position,t.position,o,e,void 0,void 0,1e-9),iN.dampE(S.rotation,t.rotation,o,e,void 0,void 0,1e-9)):(S.position.copy(t.position),S.rotation.copy(t.rotation)),E.position.copy(S.position),E.rotation.copy(S.rotation))},[E,M,o,S.position,S.rotation]);(0,tb.useFrame)((e,t)=>{n||T(t)});let D=(0,tC.useRef)(null),[F,R]=(0,tC.useState)(),P=xy(),Q=(0,tC.useCallback)((e,t)=>{let r=D.current;if(!r)return;let i=r.source.data;R(null==P?void 0:P.detectForVideo(i,e))},[P]),U=(0,tC.useMemo)(()=>Object.assign(Object.create(tw.EventDispatcher.prototype),{computeTarget:M,update:T,facemeshApiRef:C}),[M,T]);(0,tC.useImperativeHandle)(f,()=>U,[U]),(0,tC.useEffect)(()=>{if(a){let e=x().controls;return y({controls:U}),()=>y({controls:e})}},[a,U,x,y]);let z=null!=i?i:F,k=null==z?void 0:z.faceLandmarks[0],L=null==z||null==(m=z.facialTransformationMatrixes)?void 0:m[0],O=null==z||null==(p=z.faceBlendshapes)?void 0:p[0],G={onVideoFrame:Q,...t};return tC.createElement(xC.Provider,{value:U},!r&&tC.createElement(tC.Suspense,{fallback:null},"src"in G?tC.createElement(AH,e2({ref:D},G)):tC.createElement(xc,e2({ref:D},G))),tC.createElement(xA,e2({ref:C,children:tC.createElement("meshNormalMaterial",{side:tw.DoubleSide})},d,{points:k,depth:u,facialTransformationMatrix:L,faceBlendshapes:O,eyes:c,eyesAsOrigin:h,offset:s,offsetScalar:l,debug:A,"rotation-z":Math.PI,visible:A})))}),xw=()=>(0,tC.useContext)(xC);e.s(["AccumulativeShadows",()=>gb,"AdaptiveDpr",()=>v0,"AdaptiveEvents",()=>v2,"ArcballControls",()=>cA,"AsciiRenderer",()=>lb,"BBAnchor",()=>mn,"Backdrop",()=>gR,"BakeShadows",()=>vK,"Billboard",()=>nc,"Bounds",()=>pL,"Box",()=>pA,"Bvh",()=>f3,"CameraControls",()=>cQ,"CameraControlsImpl",()=>e0,"CameraShake",()=>pV,"Capsule",()=>pS,"CatmullRomLine",()=>nK,"Caustics",()=>gO,"Center",()=>mc,"Circle",()=>pd,"Clone",()=>sm,"Cloud",()=>vs,"CloudInstance",()=>vo,"Clouds",()=>va,"ComputedAttribute",()=>sd,"Cone",()=>pf,"ContactShadows",()=>gB,"CubeCamera",()=>lO,"CubeTexture",()=>hh,"CubicBezierLine",()=>nW,"CurveModifier",()=>mk,"CycleRaycast",()=>tz,"Cylinder",()=>pm,"Decal",()=>sM,"Detailed",()=>vY,"DetectGPU",()=>ds,"DeviceOrientationControls",()=>lJ,"Dodecahedron",()=>pb,"DragControls",()=>rW,"Edges",()=>o1,"Effects",()=>oO,"Environment",()=>gx,"EnvironmentCube",()=>gg,"EnvironmentMap",()=>gp,"EnvironmentPortal",()=>gv,"Example",()=>mh,"Extrude",()=>p_,"FaceControls",()=>xB,"FaceLandmarker",()=>xv,"FaceLandmarkerDefaults",()=>xg,"Facemesh",()=>xA,"FacemeshDatas",()=>xm,"FacemeshEye",()=>xf,"FacemeshEyeDefaults",()=>xd,"Fbo",()=>lU,"Fbx",()=>As,"FirstPersonControls",()=>cP,"Fisheye",()=>yr,"Float",()=>pj,"FlyControls",()=>lq,"GizmoHelper",()=>cZ,"GizmoViewcube",()=>hr,"GizmoViewport",()=>ha,"Gltf",()=>lw,"GradientTexture",()=>oN,"GradientType",()=>oG,"Grid",()=>hl,"Helper",()=>AK,"Html",()=>tU,"Hud",()=>cN,"Icosahedron",()=>pw,"Image",()=>o$,"Instance",()=>mI,"InstancedAttribute",()=>mS,"Instances",()=>mb,"IsObject",()=>oj,"KeyboardControls",()=>iq,"Ktx2",()=>Az,"Lathe",()=>pM,"Lightformer",()=>gK,"Line",()=>nj,"Loader",()=>tJ,"MapControls",()=>l6,"MarchingCube",()=>sC,"MarchingCubes",()=>sE,"MarchingPlane",()=>sB,"Mask",()=>ye,"MatcapTexture",()=>vp,"Merged",()=>m_,"MeshDiscardMaterial",()=>pi,"MeshDistortMaterial",()=>mG,"MeshPortalMaterial",()=>ya,"MeshReflectorMaterial",()=>mX,"MeshRefractionMaterial",()=>m9,"MeshTransmissionMaterial",()=>pr,"MeshWobbleMaterial",()=>mV,"MotionPathControls",()=>cO,"MultiMaterial",()=>pn,"NormalTexture",()=>vv,"Octahedron",()=>pI,"OrbitControls",()=>l8,"OrthographicCamera",()=>lz,"Outlines",()=>o3,"PerformanceMonitor",()=>v4,"PerspectiveCamera",()=>lk,"PivotControls",()=>xs,"Plane",()=>pg,"Point",()=>vL,"PointMaterial",()=>pl,"PointMaterialImpl",()=>ps,"PointerLockControls",()=>cS,"Points",()=>vG,"PointsBuffer",()=>vO,"Polyhedron",()=>pB,"PositionMesh",()=>mg,"PositionPoint",()=>vP,"PositionalAudio",()=>nq,"Preload",()=>vW,"PresentationControls",()=>iK,"Progress",()=>tV,"QuadraticBezierLine",()=>nY,"RandomizedLight",()=>g_,"RenderCubeTexture",()=>v9,"RenderTexture",()=>v6,"Resize",()=>pQ,"Ring",()=>pC,"RoundedBox",()=>pD,"RoundedBoxGeometry",()=>pF,"Sampler",()=>sA,"ScreenQuad",()=>pP,"ScreenSizer",()=>ng,"ScreenSpace",()=>nh,"ScreenVideoTexture",()=>xl,"Scroll",()=>iW,"ScrollControls",()=>ij,"Segment",()=>vJ,"SegmentObject",()=>vV,"Segments",()=>vH,"Select",()=>ns,"Shadow",()=>gP,"ShadowAlpha",()=>vM,"Shape",()=>pT,"Sky",()=>g0,"SoftShadows",()=>ph,"Sparkles",()=>vf,"Sphere",()=>pp,"Splat",()=>lP,"SpotLight",()=>gW,"SpotLightShadow",()=>gY,"SpriteAnimator",()=>mR,"Stage",()=>gD,"Stars",()=>g5,"Stats",()=>A1,"StatsGl",()=>A2,"Svg",()=>sD,"Tetrahedron",()=>pE,"Text",()=>oi,"Text3D",()=>oy,"Texture",()=>oY,"Torus",()=>py,"TorusKnot",()=>px,"TrackballControls",()=>ct,"Trail",()=>ss,"TrailTexture",()=>ml,"TransformControls",()=>cy,"Tube",()=>pv,"VideoTexture",()=>AH,"View",()=>yb,"WebcamVideoTexture",()=>xc,"Wireframe",()=>v_,"accumulativeContext",()=>gw,"calcPosFromAngles",()=>g1,"calculateScaleFactor",()=>nm,"checkIfFrameIsEmpty",()=>AJ,"createInstances",()=>mM,"getFirstFrame",()=>Aj,"isWebGL2Available",()=>oL,"meshBounds",()=>v1,"shaderMaterial",()=>oV,"useAnimations",()=>f5,"useAspect",()=>A4,"useBVH",()=>f2,"useBounds",()=>pO,"useBoxProjectedEnv",()=>mt,"useCamera",()=>A5,"useContextBridge",()=>f4,"useCubeCamera",()=>lL,"useCubeTexture",()=>hc,"useCursor",()=>tk,"useDepthBuffer",()=>A3,"useDetectGPU",()=>da,"useEnvironment",()=>gc,"useFBO",()=>lQ,"useFBX",()=>Ao,"useFaceControls",()=>xw,"useFaceLandmarker",()=>xy,"useFont",()=>og,"useGLTF",()=>lB,"useGizmoContext",()=>cV,"useHelper",()=>AW,"useIntersect",()=>f6,"useKTX2",()=>AU,"useKeyboardControls",()=>iZ,"useMask",()=>yt,"useMatcapTexture",()=>vm,"useMotion",()=>ck,"useNormalTexture",()=>vg,"usePerformanceMonitor",()=>v5,"useProgress",()=>tH,"useScroll",()=>iV,"useSelect",()=>nl,"useSpriteAnimator",()=>mD,"useSpriteLoader",()=>AY,"useSurfaceSampler",()=>su,"useTexture",()=>oJ,"useTrail",()=>so,"useTrailTexture",()=>ms,"useVideoTexture",()=>AN],98749)},77211,e=>{e.n(e.i(98749))}]);